import{C as g,a1 as l,T as a,B as b,O as C,$ as I,a3 as D}from"./Simfile-DgZSKnU-.js";import{A as u}from"./AnimatedSprite-3wI3HXkZ.js";import{s as B,B as c,b as A,H as v}from"./app.js";import{T as E,H as w}from"./HoldBody-DrZoJoRZ.js";const F="/smeditor/assets/active-BLmbQPrv.png",L="/smeditor/assets/downBodyActive-CeXH5Pwt.png",U="/smeditor/assets/downBodyInactive-Ds9SCZlu.png",M="/smeditor/assets/downBottomCapActive-DOcujr4h.png",$="/smeditor/assets/downBottomCapInactive-DIWVmScI.png",P="/smeditor/assets/inactive-C7gNwEvl.png",k="/smeditor/assets/leftBodyActive-BsHwXMBw.png",O="/smeditor/assets/leftBodyInactive-BROiuCSc.png",S="/smeditor/assets/leftBottomCapActive-kXzfWWap.png",j="/smeditor/assets/leftBottomCapInactive-DlScbwkA.png",z="/smeditor/assets/rightBodyActive-D3huM5hx.png",V="/smeditor/assets/rightBodyInactive-BMAOHtF6.png",J="/smeditor/assets/rightBottomCapActive-BQWRg9Jy.png",Y="/smeditor/assets/rightBottomCapInactive-D63Oa-I_.png",X="/smeditor/assets/upBodyActive-DWdXfG6_.png",W="/smeditor/assets/upBodyInactive-dJq7tEWt.png",G="/smeditor/assets/upBottomCapActive-Ny8BU3NM.png",Z="/smeditor/assets/upBottomCapInactive-xeW_6Bl-.png",Q="/smeditor/assets/active-BYjnDnbz.png",q="/smeditor/assets/downBodyActive-DH2LVAmN.png",K="/smeditor/assets/downBodyInactive-D_bjF4A1.png",tt="/smeditor/assets/downBottomCapActive-tAg5sJze.png",et="/smeditor/assets/downBottomCapInactive-CdsjNRrK.png",ot="/smeditor/assets/inactive-Bse1Fu3-.png",st="/smeditor/assets/leftBodyActive-CrBnwZew.png",it="/smeditor/assets/leftBodyInactive-DUGbrGqk.png",nt="/smeditor/assets/leftBottomCapActive-B1-hwiPp.png",at="/smeditor/assets/leftBottomCapInactive-C4kPGgRn.png",rt="/smeditor/assets/rightBodyActive-E0h2K1c_.png",lt="/smeditor/assets/rightBodyInactive-BCZLT32N.png",ct="/smeditor/assets/rightBottomCapActive-Hs7F7CnZ.png",pt="/smeditor/assets/rightBottomCapInactive-BvEyRT_J.png",mt="/smeditor/assets/upBodyActive-C58HneSs.png",dt="/smeditor/assets/upBodyInactive-6519cAaz.png",ht="/smeditor/assets/upBottomCapActive-Bbi5HYaQ.png",_t="/smeditor/assets/upBottomCapInactive-XzNT96CD.png",gt="/smeditor/assets/hold-EGU68PZL.png",vt="/smeditor/assets/mine-D-Y3SPzO.png",wt="/smeditor/assets/particles-FJreiJxR.png",ft="/smeditor/assets/w0-B_RuMQmT.png",ut="/smeditor/assets/w1-DtVm41dD.png",Bt="/smeditor/assets/w2-m5S2AGDD.png",bt="/smeditor/assets/w3-C0m_3L4l.png",Ct="/smeditor/assets/w4-DN7iSv1R.png",At="/smeditor/assets/w5-xLUBURnq.png",yt="/smeditor/assets/hold-EGU68PZL.png",xt="/smeditor/assets/mine-D-Y3SPzO.png",It="/smeditor/assets/particles-FJreiJxR.png",Tt=a.from(yt),Nt=B(a.from(xt),16,1,160,1024)[0],Rt=a.from(It),N=["w0","w1","w2","w3","w4","w5"],R={};N.forEach(t=>R[t]=a.from(new URL(Object.assign({"./flash/hold.png":gt,"./flash/mine.png":vt,"./flash/particles.png":wt,"./flash/w0.png":ft,"./flash/w1.png":ut,"./flash/w2.png":Bt,"./flash/w3.png":bt,"./flash/w4.png":Ct,"./flash/w5.png":At})[`./flash/${t}.png`],import.meta.url).href));class Ht extends g{holdExplosion=new l(Tt);particles=new l(Rt);mine=new u(Nt);standard={};anims=new Set;particleAnim;mineAnim;constructor(e,s,n){super();const i=.5;N.forEach(o=>{const r=new l(R[o]);r.anchor.set(.5),r.alpha=0,r.blendMode=b.ADD,this.standard[o]=r,this.addChild(r)}),e.on(this,"hit",o=>{if(s==o.columnNumber){const r=this.standard[o.judgement.id];if(!r)return;this.anims.forEach(p=>c.finish(p)),this.anims.clear(),this.anims.add(c.animate(r,{0:{alpha:.875,"scale.x":.8*i,"scale.y":.8*i},"0.5":{alpha:.875,"scale.x":1.1*i,"scale.y":1.1*i},1:{alpha:0,"scale.x":1.1*i,"scale.y":1.1*i}},.12))}}),e.on(this,"held",o=>{s==o.columnNumber&&(this.anims.forEach(r=>c.finish(r)),this.anims.clear(),this.anims.add(c.animate(this.standard.w0,{0:{alpha:.875,"scale.x":.8*i,"scale.y":.8*i},"0.5":{alpha:.875,"scale.x":1.1*i,"scale.y":1.1*i},1:{alpha:0,"scale.x":1.1*i,"scale.y":1.1*i}},.12)))}),e.on(this,"holdon",o=>{s==o.columnNumber&&(this.holdExplosion.visible=!0)}),e.on(this,"holdoff",o=>{s==o.columnNumber&&(this.holdExplosion.visible=!1)}),e.on(this,"rollon",o=>{s==o.columnNumber&&(this.holdExplosion.visible=!0)}),e.on(this,"rolloff",o=>{s==o.columnNumber&&(this.holdExplosion.visible=!1)}),e.onUpdate(this,()=>{this.holdExplosion.alpha=Math.sin(Date.now()/1e3*Math.PI*2*20)*.1+1}),this.holdExplosion.visible=!1,this.holdExplosion.anchor.set(.5),this.holdExplosion.scale.set(.5),this.addChild(this.holdExplosion),this.particles.alpha=0,this.particles.blendMode=b.ADD,this.particles.anchor.set(.5),e.on(this,"hit",o=>{if(s==o.columnNumber){if(this.particles.rotation=Math.random()*Math.PI*2,c.finish(this.particleAnim),!["w0","w1","w2","w3"].includes(o.judgement.id))return;this.particleAnim=c.animate(this.particles,{0:{alpha:.6,"scale.x":1*i,"scale.y":1*i},"0.7":{alpha:.6,"scale.x":1.2*i,"scale.y":1.2*i},1:{alpha:0,"scale.x":1.2*i,"scale.y":1.2*i}},.185,A(.16,.73,.63,.75))}}),this.addChild(this.particles),this.mine.anchor.x=.5,this.mine.scale.set(.5),this.mine.rotation=-y[n]*Math.PI/180,this.mine.animationSpeed=1/3,this.mine.alpha=0,this.addChild(this.mine),e.on(this,"hitmine",o=>{s==o.columnNumber&&(c.finish(this.mineAnim),this.mine.anchor.y=C.chart.reverse?1:0,this.mine.currentFrame=0,this.mine.play(),this.mineAnim=c.animate(this.mine,{0:{alpha:1},"0.5":{alpha:1},1:{alpha:0}},.6))})}}const Dt="/smeditor/assets/colors-CIJFAT9V.png",Et="/smeditor/assets/mask-B5Nte-Ap.png",Ft="/smeditor/assets/note-BJbSI1IR.png",Lt="/smeditor/assets/outline-XCD-Xm0R.png",Ut="/smeditor/assets/stroke-Bn4xyPLY.png",Mt="/smeditor/assets/top-D7kI7bgu.png",_={};["colors","mask","note","outline","stroke","top"].forEach(t=>_[t]=a.from(new URL(Object.assign({"./tap/colors.png":Dt,"./tap/mask.png":Et,"./tap/note.png":Ft,"./tap/outline.png":Lt,"./tap/stroke.png":Ut,"./tap/top.png":Mt})[`./tap/${t}.png`],import.meta.url).href));const $t=B(_.top,4,1,384,384)[0],T=[-80,0,80];class m{static arrowFrameTex;static arrowFrameContainer=new g;static arrowTex;static arrowContainer=new g;static loaded=!1;static async initArrowTex(){if(!this.loaded){m.arrowFrameTex=I.create({width:64,height:64,resolution:C.performance.resolution}),m.arrowTex=I.create({width:64*3,height:64,resolution:C.performance.resolution});{const e=new l(_.note);e.width=64,e.height=64;const s=new l(_.outline);s.width=64,s.height=64;const n=new l(_.stroke);n.width=64,n.height=64,this.arrowFrameContainer.addChild(e,s,n)}for(let e=0;e<3;e++){const s=new l(this.arrowFrameTex);s.x=e*64;const n=new l(_.mask);n.scale.set(1/6),n.x=e*64,n.y=32,n.anchor.y=.5,n.alpha=1;const i=new E(_.colors,256,1024);i.tileScale.y=1/4,i.uvRespectAnchor=!0,i.x=e*64,i.y=32,i.tilePosition.y=128+T[e],i.anchor.y=.5,i.height=64,i.width=64,i.alpha=1,i.mask=n,i.name="c"+e;const o=new u($t);o.scale.set(1/6),o.x=e*64,o.y=32,o.anchor.y=.5,o.alpha=1,o.name="t"+e,this.arrowContainer.addChild(s,i,n,o)}this.loaded=!0}}static setArrowTexTime(e){if(!this.loaded)return;const s=e.chartManager.chartView.getVisualBeat(),n=(s%1+1)%1,i=(s%4+4)%4;for(let o=0;o<3;o++)this.arrowContainer.getChildByName("c"+o).tilePosition.y=128+T[o]-i/4*256,this.arrowContainer.getChildByName("t"+o).currentFrame=Math.floor(n*4);e.renderer.render(m.arrowFrameContainer,{renderTexture:m.arrowFrameTex}),e.renderer.render(m.arrowContainer,{renderTexture:m.arrowTex})}static setNoteTex(e,s){let n=[4,8].indexOf(s?.quant??4);n==-1&&(n=2),e.texture=new a(m.arrowTex.baseTexture,new D(n*64,0,64,64))}}const Pt="/smeditor/assets/mine-C9r_hVo3.png",kt="/smeditor/assets/spark-C9NkweLB.png",Ot="/smeditor/assets/receptor-B6t4H6qx.png",St="/smeditor/assets/receptorFlash-y71fQZxV.png",jt=a.from(Ot),zt=a.from(St),Vt=a.from(Pt),Jt=B(a.from(kt),4,4,160,128).flat(),Yt={Left:0,Down:5,Up:8,Right:13},d={},h={},f={Hold:{Active:a.from(new URL("/smeditor/assets/active-BLmbQPrv.png",import.meta.url).href),Inactive:a.from(new URL("/smeditor/assets/inactive-C7gNwEvl.png",import.meta.url).href)},Roll:{Active:a.from(new URL("/smeditor/assets/active-BYjnDnbz.png",import.meta.url).href),Inactive:a.from(new URL("/smeditor/assets/inactive-Bse1Fu3-.png",import.meta.url).href)}};for(const t of["Left","Down","Up","Right"])for(const e of["Body","BottomCap"])for(const s of["Active","Inactive"])d[t]===void 0&&(d[t]={}),d[t][s]===void 0&&(d[t][s]={}),d[t][s][e]=a.from(new URL(Object.assign({"./hold/active.png":F,"./hold/downBodyActive.png":L,"./hold/downBodyInactive.png":U,"./hold/downBottomCapActive.png":M,"./hold/downBottomCapInactive.png":$,"./hold/inactive.png":P,"./hold/leftBodyActive.png":k,"./hold/leftBodyInactive.png":O,"./hold/leftBottomCapActive.png":S,"./hold/leftBottomCapInactive.png":j,"./hold/rightBodyActive.png":z,"./hold/rightBodyInactive.png":V,"./hold/rightBottomCapActive.png":J,"./hold/rightBottomCapInactive.png":Y,"./hold/upBodyActive.png":X,"./hold/upBodyInactive.png":W,"./hold/upBottomCapActive.png":G,"./hold/upBottomCapInactive.png":Z})[`./hold/${t.toLowerCase()}${e}${s}.png`],import.meta.url).href),h[t]===void 0&&(h[t]={}),h[t][s]===void 0&&(h[t][s]={}),h[t][s][e]=a.from(new URL(Object.assign({"./roll/active.png":Q,"./roll/downBodyActive.png":q,"./roll/downBodyInactive.png":K,"./roll/downBottomCapActive.png":tt,"./roll/downBottomCapInactive.png":et,"./roll/inactive.png":ot,"./roll/leftBodyActive.png":st,"./roll/leftBodyInactive.png":it,"./roll/leftBottomCapActive.png":nt,"./roll/leftBottomCapInactive.png":at,"./roll/rightBodyActive.png":rt,"./roll/rightBodyInactive.png":lt,"./roll/rightBottomCapActive.png":ct,"./roll/rightBottomCapInactive.png":pt,"./roll/upBodyActive.png":mt,"./roll/upBodyInactive.png":dt,"./roll/upBottomCapActive.png":ht,"./roll/upBottomCapInactive.png":_t})[`./roll/${t.toLowerCase()}${e}${s}.png`],import.meta.url).href);const y={Left:90,Down:0,Up:180,Right:-90},Xt=["Receptor","Tap","Lift","Fake","Hold Inactive Head","Hold Active Head","Roll Inactive Head","Roll Active Head","NoteFlash"],qt={elements:{Left:{Receptor:t=>{let e,s;const n=B(jt,2,1,404,404),i=new g,o=new u(n[0]);o.width=64,o.height=64,o.anchor.set(.5),t.noteskin.on(o,"ghosttap",p=>{p.columnNumber==t.columnNumber&&(c.finish(e),e=c.animate(o,{0:{alpha:.9,width:.85*64,height:.85*64},1:{alpha:1,width:64,height:64}},.11))});const r=new l(zt);return r.blendMode=b.ADD,r.width=64,r.height=64,r.anchor.set(.5),r.alpha=0,t.noteskin.on(i,"press",p=>{p.columnNumber==t.columnNumber&&(c.finish(s),s=c.animate(r,{0:{alpha:0,width:.85*64,height:.85*64},1:{alpha:.6,width:64,height:64}},.12,A(.5,1,.89,1)))}),t.noteskin.on(i,"lift",p=>{p.columnNumber==t.columnNumber&&(c.finish(s),s=c.animate(r,{0:{alpha:"inherit",width:"inherit",height:"inherit"},1:{alpha:0,width:64*1.2,height:64}},.12,A(.11,0,.5,1)))}),t.noteskin.onUpdate(i,p=>{const x=p.chart.getNotedata()[0]?.beat;if(x===void 0||p.getVisualBeat()<x-8){o.currentFrame=1;return}const H=(p.getVisualBeat()%1+1)%1;o.currentFrame=H<.2?0:1}),i.addChild(o,r),i},Tap:t=>{const e=new l(a.WHITE);return m.setNoteTex(e,t.note),e.anchor.set(.5),e},NoteFlash:t=>new Ht(t.noteskin,t.columnNumber,t.columnName),Fake:{element:"Tap"},Lift:{element:"Tap"},Mine:t=>{const e=new g,s=new l(Vt);s.anchor.set(.5),s.width=64,s.height=64,s.rotation=y[t.columnName]*Math.PI/180;const n=new u(Jt);return n.anchor.set(.5),n.scale.set(.5),e.addChild(s,n),t.noteskin.onUpdate(e,i=>{const o=i.getVisualTime();n.currentFrame=((Math.floor(o*20)+Yt[t.columnName])%16+16)%16}),e},"Hold Active Head":()=>{const t=new l(f.Hold.Active);return t.anchor.set(.5),t.scale.set(1/6),t},"Hold Inactive Head":()=>{const t=new l(f.Hold.Inactive);return t.anchor.set(.5),t.scale.set(1/6),t},"Hold Active Body":t=>new w(d[t.columnName].Active.Body),"Hold Inactive Body":t=>new w(d[t.columnName].Inactive.Body),"Hold Active TopCap":()=>new l(a.EMPTY),"Hold Inactive TopCap":()=>new l(a.EMPTY),"Hold Active BottomCap":t=>new v(d[t.columnName].Active.BottomCap),"Hold Inactive BottomCap":t=>new v(d[t.columnName].Inactive.BottomCap),"Roll Active Head":()=>{const t=new l(f.Roll.Active);return t.anchor.set(.5),t.scale.set(1/6),t},"Roll Inactive Head":()=>{const t=new l(f.Roll.Inactive);return t.anchor.set(.5),t.scale.set(1/6),t},"Roll Active Body":t=>new w(h[t.columnName].Active.Body),"Roll Inactive Body":t=>new w(h[t.columnName].Inactive.Body),"Roll Active TopCap":()=>new l(a.EMPTY),"Roll Inactive TopCap":()=>new l(a.EMPTY),"Roll Active BottomCap":t=>new v(h[t.columnName].Active.BottomCap),"Roll Inactive BottomCap":t=>new v(h[t.columnName].Inactive.BottomCap)}},load:function(t,e){const s=t.columnName;t.columnName="Left";const n=this.loadElement(t,e);return Xt.includes(t.element)&&(n.rotation=y[s]*Math.PI/180),n},init(){m.initArrowTex()},update(t){m.setArrowTexTime(t.chartManager.app)},metrics:{HoldBodyBottomOffset:-16,RollBodyBottomOffset:-16}};export{qt as default,y as rotationMap};
