import{C as f,Y as _,O as T,T as i,a2 as g,_ as l,B as d}from"./Simfile-DjFoTeyG.js";import{A as w}from"./AnimatedSprite-DPy_i0lu.js";import{s as m,B as p,A as U}from"./app.js";import{A as H}from"./HoldBody-DwovWILe.js";const R="/smeditor/assets/Center-BL4DQV0a.png",L="/smeditor/assets/DownLeft-Dv780hUZ.png",y="/smeditor/assets/DownRight-B6gvcS76.png",M="/smeditor/assets/UpLeft-hBDkZcEo.png",O="/smeditor/assets/UpRight-DdnVFhNk.png",I="/smeditor/assets/Center-DEnNgMrZ.png",E="/smeditor/assets/DownLeft-CCQpM5KI.png",S="/smeditor/assets/DownRight-D8WWRxGH.png",F="/smeditor/assets/UpLeft-DCVIFOE4.png",N="/smeditor/assets/UpRight-LoaMP83y.png",P="/smeditor/assets/Center-y78VMvJ2.png",V="/smeditor/assets/DownLeft-DQvAtmv4.png",$="/smeditor/assets/DownRight-C9zgHSqS.png",k="/smeditor/assets/UpLeft-DdwIun7e.png",W="/smeditor/assets/UpRight-CD7gotAG.png",v={},c=["DownLeft","UpLeft","Center","UpRight","DownRight"];for(const e of c)v[e]=m(i.from(new URL(Object.assign({"./tap/Center.png":I,"./tap/DownLeft.png":E,"./tap/DownRight.png":S,"./tap/UpLeft.png":F,"./tap/UpRight.png":N})[`./tap/${e}.png`],import.meta.url).href),3,2,96,96).flat();const D={};for(const e of c)D[e]=m(i.from(new URL(Object.assign({"./roll/Center.png":P,"./roll/DownLeft.png":V,"./roll/DownRight.png":$,"./roll/UpLeft.png":k,"./roll/UpRight.png":W})[`./roll/${e}.png`],import.meta.url).href),3,2,96,96).flat();const Y=m(i.from(new URL("/smeditor/assets/mine-CXNV-Tkv.png",import.meta.url).href),3,2,96,96).flat();class a{static noteTex;static noteContainer=new f;static rollTex;static rollContainer=new f;static mineTex;static mine;static loaded=!1;static async initArrowTex(){if(!this.loaded){a.noteTex=_.create({width:96*5,height:96,resolution:T.performance.resolution}),a.rollTex=_.create({width:96*5,height:96,resolution:T.performance.resolution}),a.mineTex=_.create({width:96,height:96,resolution:T.performance.resolution});for(const t of c)this.createSprite(this.noteContainer,t,v);for(const t of c)this.createSprite(this.rollContainer,t,D);this.mine=new w(Y),this.loaded=!0}}static createSprite(t,o,n){const s=c.indexOf(o)*96,r=new w(n[o]);r.x=s,t.addChild(r)}static setArrowTexTime(t){if(!this.loaded)return;const o=t.chartManager.chartView.getVisualTime(),n=Math.floor((o%.3+.3)%.3/.3*6);this.noteContainer.children.forEach(s=>s.currentFrame=n),this.rollContainer.children.forEach(s=>s.currentFrame=n),this.mine.currentFrame=n,t.renderer.render(a.noteContainer,{renderTexture:a.noteTex}),t.renderer.render(a.rollContainer,{renderTexture:a.rollTex}),t.renderer.render(a.mine,{renderTexture:a.mineTex})}static setNoteTex(t,o,n){if(o===void 0)return i.WHITE;if(o.type=="Mine")t.texture=this.mineTex;else{const s=c.indexOf(n)*96;t.texture=new i(this.noteTex.baseTexture,new g(s,0,96,96))}}static setRollTex(t,o){const n=c.indexOf(o)*96;t.texture=new i(this.rollTex.baseTexture,new g(n,0,96,96))}}const j="/smeditor/assets/receptors-ClMPK2PG.png",G="/smeditor/assets/flash-ByX5hBNr.png",Q="/smeditor/assets/mine-CPFI4p0C.png",Z="/smeditor/assets/press-CPrTUdcs.png",z=m(i.from(G),5,1,128,128)[0],J=i.from(Q),b=m(i.from(Z),5,2,96,96),K=["w0","w1","w2","w3"];class X extends f{press;pressAnim;hitContainer=new f;tap;note;flash;hitAnim;anims=new Set;constructor(t,o,n){super();const s=1/1.5;this.press=new l(b[1][u.indexOf(o)]),this.press.alpha=0,this.press.anchor.set(.5),this.tap=new l(b[0][u.indexOf(o)]),this.tap.blendMode=d.ADD,this.tap.scale.set(s),this.tap.anchor.set(.5),this.note=new w(v[o]),this.note.scale.set(s),this.note.blendMode=d.ADD,this.note.animationSpeed=1/3,this.note.play(),this.note.anchor.set(.5),this.flash=new w(z),this.flash.scale.set(2),this.flash.blendMode=d.ADD,this.flash.animationSpeed=1/3,this.flash.loop=!1,this.flash.visible=!1,this.flash.anchor.set(.5),this.flash.onComplete=()=>{this.flash.visible=!1,this.flash.stop()},this.hitContainer.alpha=0,this.hitContainer.addChild(this.tap,this.note),t.on(this,"ghosttap",r=>{n==r.columnNumber&&(p.finish(this.pressAnim),this.pressAnim=p.animate(this.press,{0:{alpha:1,"scale.x":1*s,"scale.y":1*s},1:{alpha:0,"scale.x":1.3*s,"scale.y":1.3*s}},.25))}),t.on(this,"hit",r=>{if(n==r.columnNumber){if(!K.includes(r.judgement.id))return;p.finish(this.pressAnim),p.finish(this.hitAnim),this.hitAnim=p.animate(this.hitContainer,{0:{alpha:1,"scale.x":1,"scale.y":1},1:{alpha:0,"scale.x":1.2,"scale.y":1.2}},.4),this.flash.visible=!0,this.flash.currentFrame=0,this.flash.play()}}),t.on(this,"hitmine",r=>{if(n==r.columnNumber){const h=new l(J);h.alpha=0,h.anchor.set(.5),h.blendMode=d.ADD,this.addChild(h),p.animate(h,{0:{alpha:1,rotation:0},"0.5":{alpha:1,rotation:90*Math.PI/180},1:{alpha:0,rotation:180*Math.PI/180}},.4,void 0,()=>h.destroy())}}),this.addChild(this.press,this.hitContainer,this.flash)}}const A=m(i.from(j),5,2,96,96),u=["DownLeft","UpLeft","Center","UpRight","DownRight"],C={},x=96;for(const e of u){const t=i.from(new URL(Object.assign({"./hold/Center.png":R,"./hold/DownLeft.png":L,"./hold/DownRight.png":y,"./hold/UpLeft.png":M,"./hold/UpRight.png":O})[`./hold/${e}.png`],import.meta.url).href),o=[],n=[];for(let s=0;s<6;s++)o.push(new i(t.baseTexture,new g(s*96,0,96,288-x))),n.push(new i(t.baseTexture,new g(s*96,288-x,96,x)));C[e]={body:o,cap:n}}const nt={elements:{DownLeft:{Receptor:e=>{const t=new f,o=u.indexOf(e.columnName),n=new l(A[0][o]);n.width=72,n.height=72,n.anchor.set(.5);const s=new l(A[1][o]);return s.width=n.width,s.height=n.height,s.anchor.set(.5),s.blendMode=d.ADD,t.addChild(n,s),e.noteskin.onUpdate(t,r=>{const B=(r.getVisualBeat()%1+1)%1;s.alpha=(1-B)/2}),t},Tap:e=>{const t=new l(i.WHITE);return a.setNoteTex(t,e.note,e.columnName),t.anchor.set(.5),t.width=72,t.height=72,t},Fake:{element:"Tap"},Lift:{element:"Tap"},Mine:{element:"Tap"},NoteFlash:e=>new X(e.noteskin,e.columnName,e.columnNumber),"Hold Active Head":{element:"Tap"},"Hold Inactive Head":{element:"Tap"},"Hold Active Body":e=>{const t=new H(C[e.columnName].body,72);return e.noteskin.onUpdate(t,o=>{const n=o.getVisualTime(),s=Math.floor((n%.3+.3)%.3/.3*6);t.currentFrame=s}),t},"Hold Inactive Body":{element:"Hold Active Body"},"Hold Active TopCap":()=>new l(i.EMPTY),"Hold Inactive TopCap":()=>new l(i.EMPTY),"Hold Active BottomCap":e=>{const t=new U(C[e.columnName].cap,72);return e.noteskin.onUpdate(t,o=>{const n=o.getVisualTime(),s=Math.floor((n%.3+.3)%.3/.3*6);t.currentFrame=s}),t},"Hold Inactive BottomCap":{element:"Hold Active BottomCap"},"Roll Active Head":e=>{const t=new l(i.WHITE);return a.setRollTex(t,e.columnName),t.anchor.set(.5),t.width=72,t.height=72,t},"Roll Inactive Head":{element:"Roll Active Head"},"Roll Active Body":{element:"Hold Active Body"},"Roll Inactive Body":{element:"Hold Active Body"},"Roll Active TopCap":()=>new l(i.EMPTY),"Roll Inactive TopCap":()=>new l(i.EMPTY),"Roll Active BottomCap":{element:"Hold Active BottomCap"},"Roll Inactive BottomCap":{element:"Hold Active BottomCap"}}},load:function(e,t){return e.columnName="DownLeft",this.loadElement(e,t)},init(){a.initArrowTex()},update(e){a.setArrowTexTime(e.chartManager.app)},metrics:{HoldBodyBottomOffset:-36,RollBodyBottomOffset:-36}};export{nt as default,u as texOrder};
