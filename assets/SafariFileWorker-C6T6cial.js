(function(){"use strict";onmessage=async r=>{const[e,t,a]=r.data,i=await c(t);if(!i){postMessage({id:e,success:!1,error:"Couldn't locate file"});return}const n=await i.createSyncAccessHandle();n.write(a),n.flush(),n.close(),postMessage({id:e,success:!0})};async function s(r,e,t){if(t||=await navigator.storage.getDirectory(),r==""||r==".")return t;const a=o(r).split("/"),i=a.shift();try{const n=await t.getDirectoryHandle(i,e);return n?a.length==0?n:s(a.join("/"),e,n):void 0}catch(n){console.error(`Failed to get directory ${r} (${i}): `+n);return}}async function c(r,e){try{const t=o(r).split("/"),a=t.pop(),i=await s(t.join("/"),e);return i?await i.getFileHandle(a,e):void 0}catch(t){console.error("Failed to get file "+r+": "+t);return}}function o(r){let e=r.split("/");for(e=e.filter(t=>t!="."&&t!="");e.indexOf("..")>-1;){const t=e.indexOf("..");if(t==0)throw Error("Path"+e.join("/")+"is invalid!");e.splice(t-1,2)}return e.join("/")}})();
