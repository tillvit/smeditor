import{b as f,x as _,O as T,a0 as m,L as i,P as g,J as l,X as d,Q as p,a1 as B}from"./ChartManager-Ba9C56Ca.js";import{A as w}from"./AnimatedSprite-ic1saOJv.js";import{A as H}from"./HoldBody-Be0k50pL.js";const R="/smeditor/assets/Center-BL4DQV0a.png",L="/smeditor/assets/DownLeft-Dv780hUZ.png",y="/smeditor/assets/DownRight-B6gvcS76.png",M="/smeditor/assets/UpLeft-hBDkZcEo.png",O="/smeditor/assets/UpRight-DdnVFhNk.png",I="/smeditor/assets/Center-DEnNgMrZ.png",E="/smeditor/assets/DownLeft-CCQpM5KI.png",S="/smeditor/assets/DownRight-D8WWRxGH.png",F="/smeditor/assets/UpLeft-DCVIFOE4.png",P="/smeditor/assets/UpRight-LoaMP83y.png",N="/smeditor/assets/Center-y78VMvJ2.png",V="/smeditor/assets/DownLeft-DQvAtmv4.png",$="/smeditor/assets/DownRight-C9zgHSqS.png",k="/smeditor/assets/UpLeft-DdwIun7e.png",W="/smeditor/assets/UpRight-CD7gotAG.png",v={},c=["DownLeft","UpLeft","Center","UpRight","DownRight"];for(const t of c)v[t]=m(i.from(new URL(Object.assign({"./tap/Center.png":I,"./tap/DownLeft.png":E,"./tap/DownRight.png":S,"./tap/UpLeft.png":F,"./tap/UpRight.png":P})[`./tap/${t}.png`],import.meta.url).href),3,2,96,96).flat();const A={};for(const t of c)A[t]=m(i.from(new URL(Object.assign({"./roll/Center.png":N,"./roll/DownLeft.png":V,"./roll/DownRight.png":$,"./roll/UpLeft.png":k,"./roll/UpRight.png":W})[`./roll/${t}.png`],import.meta.url).href),3,2,96,96).flat();const j=m(i.from(new URL("/smeditor/assets/mine-CXNV-Tkv.png",import.meta.url).href),3,2,96,96).flat();class a{static noteTex;static noteContainer=new f;static rollTex;static rollContainer=new f;static mineTex;static mine;static loaded=!1;static async initArrowTex(){if(!this.loaded){a.noteTex=_.create({width:96*5,height:96,resolution:T.performance.resolution}),a.rollTex=_.create({width:96*5,height:96,resolution:T.performance.resolution}),a.mineTex=_.create({width:96,height:96,resolution:T.performance.resolution});for(const e of c)this.createSprite(this.noteContainer,e,v);for(const e of c)this.createSprite(this.rollContainer,e,A);this.mine=new w(j),this.loaded=!0}}static createSprite(e,o,n){const s=c.indexOf(o)*96,r=new w(n[o]);r.x=s,e.addChild(r)}static setArrowTexTime(e){if(!this.loaded)return;const o=e.chartManager.chartView.getVisualTime(),n=Math.floor((o%.3+.3)%.3/.3*6);this.noteContainer.children.forEach(s=>s.currentFrame=n),this.rollContainer.children.forEach(s=>s.currentFrame=n),this.mine.currentFrame=n,e.renderer.render(a.noteContainer,{renderTexture:a.noteTex}),e.renderer.render(a.rollContainer,{renderTexture:a.rollTex}),e.renderer.render(a.mine,{renderTexture:a.mineTex})}static setNoteTex(e,o,n){if(o===void 0)return i.WHITE;if(o.type=="Mine")e.texture=this.mineTex;else{const s=c.indexOf(n)*96;e.texture=new i(this.noteTex.baseTexture,new g(s,0,96,96))}}static setRollTex(e,o){const n=c.indexOf(o)*96;e.texture=new i(this.rollTex.baseTexture,new g(n,0,96,96))}}const Q="/smeditor/assets/receptors-ClMPK2PG.png",Y="/smeditor/assets/flash-ByX5hBNr.png",G="/smeditor/assets/mine-CPFI4p0C.png",J="/smeditor/assets/press-CPrTUdcs.png",X=m(i.from(Y),5,1,128,128)[0],Z=i.from(G),b=m(i.from(J),5,2,96,96),z=["w0","w1","w2","w3"];class K extends f{press;pressAnim;hitContainer=new f;tap;note;flash;hitAnim;anims=new Set;constructor(e,o,n){super();const s=1/1.5;this.press=new l(b[1][u.indexOf(o)]),this.press.alpha=0,this.press.anchor.set(.5),this.tap=new l(b[0][u.indexOf(o)]),this.tap.blendMode=d.ADD,this.tap.scale.set(s),this.tap.anchor.set(.5),this.note=new w(v[o]),this.note.scale.set(s),this.note.blendMode=d.ADD,this.note.animationSpeed=1/3,this.note.play(),this.note.anchor.set(.5),this.flash=new w(X),this.flash.scale.set(2),this.flash.blendMode=d.ADD,this.flash.animationSpeed=1/3,this.flash.loop=!1,this.flash.visible=!1,this.flash.anchor.set(.5),this.flash.onComplete=()=>{this.flash.visible=!1,this.flash.stop()},this.hitContainer.alpha=0,this.hitContainer.addChild(this.tap,this.note),e.on(this,"ghosttap",r=>{n==r.columnNumber&&(p.finish(this.pressAnim),this.pressAnim=p.animate(this.press,{0:{alpha:1,"scale.x":1*s,"scale.y":1*s},1:{alpha:0,"scale.x":1.3*s,"scale.y":1.3*s}},.25))}),e.on(this,"hit",r=>{if(n==r.columnNumber){if(!z.includes(r.judgement.id))return;p.finish(this.pressAnim),p.finish(this.hitAnim),this.hitAnim=p.animate(this.hitContainer,{0:{alpha:1,"scale.x":1,"scale.y":1},1:{alpha:0,"scale.x":1.2,"scale.y":1.2}},.4),this.flash.visible=!0,this.flash.currentFrame=0,this.flash.play()}}),e.on(this,"hitmine",r=>{if(n==r.columnNumber){const h=new l(Z);h.alpha=0,h.anchor.set(.5),h.blendMode=d.ADD,this.addChild(h),p.animate(h,{0:{alpha:1,rotation:0},"0.5":{alpha:1,rotation:90*Math.PI/180},1:{alpha:0,rotation:180*Math.PI/180}},.4,void 0,()=>h.destroy())}}),this.addChild(this.press,this.hitContainer,this.flash)}}const D=m(i.from(Q),5,2,96,96),u=["DownLeft","UpLeft","Center","UpRight","DownRight"],C={},x=96;for(const t of u){const e=i.from(new URL(Object.assign({"./hold/Center.png":R,"./hold/DownLeft.png":L,"./hold/DownRight.png":y,"./hold/UpLeft.png":M,"./hold/UpRight.png":O})[`./hold/${t}.png`],import.meta.url).href),o=[],n=[];for(let s=0;s<6;s++)o.push(new i(e.baseTexture,new g(s*96,0,96,288-x))),n.push(new i(e.baseTexture,new g(s*96,288-x,96,x)));C[t]={body:o,cap:n}}const se={elements:{DownLeft:{Receptor:t=>{const e=new f,o=u.indexOf(t.columnName),n=new l(D[0][o]);n.width=72,n.height=72,n.anchor.set(.5);const s=new l(D[1][o]);return s.width=n.width,s.height=n.height,s.anchor.set(.5),s.blendMode=d.ADD,e.addChild(n,s),t.noteskin.onUpdate(e,r=>{const U=(r.getVisualBeat()%1+1)%1;s.alpha=(1-U)/2}),e},Tap:t=>{const e=new l(i.WHITE);return a.setNoteTex(e,t.note,t.columnName),e.anchor.set(.5),e.width=72,e.height=72,e},Fake:{element:"Tap"},Lift:{element:"Tap"},Mine:{element:"Tap"},NoteFlash:t=>new K(t.noteskin,t.columnName,t.columnNumber),"Hold Active Head":{element:"Tap"},"Hold Inactive Head":{element:"Tap"},"Hold Active Body":t=>{const e=new H(C[t.columnName].body,72);return t.noteskin.onUpdate(e,o=>{const n=o.getVisualTime(),s=Math.floor((n%.3+.3)%.3/.3*6);e.currentFrame=s}),e},"Hold Inactive Body":{element:"Hold Active Body"},"Hold Active TopCap":()=>new l(i.EMPTY),"Hold Inactive TopCap":()=>new l(i.EMPTY),"Hold Active BottomCap":t=>{const e=new B(C[t.columnName].cap,72);return t.noteskin.onUpdate(e,o=>{const n=o.getVisualTime(),s=Math.floor((n%.3+.3)%.3/.3*6);e.currentFrame=s}),e},"Hold Inactive BottomCap":{element:"Hold Active BottomCap"},"Roll Active Head":t=>{const e=new l(i.WHITE);return a.setRollTex(e,t.columnName),e.anchor.set(.5),e.width=72,e.height=72,e},"Roll Inactive Head":{element:"Roll Active Head"},"Roll Active Body":{element:"Hold Active Body"},"Roll Inactive Body":{element:"Hold Active Body"},"Roll Active TopCap":()=>new l(i.EMPTY),"Roll Inactive TopCap":()=>new l(i.EMPTY),"Roll Active BottomCap":{element:"Hold Active BottomCap"},"Roll Inactive BottomCap":{element:"Hold Active BottomCap"}}},load:function(t,e){return t.columnName="DownLeft",this.loadElement(t,e)},init(){a.initArrowTex()},update(t){a.setArrowTexTime(t.chartManager.app)},metrics:{HoldBodyBottomOffset:-36,RollBodyBottomOffset:-36}};export{se as default,u as texOrder};
