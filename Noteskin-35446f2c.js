import{q as i,X as b,b as g,y as l,L as B,H as r,J as A,O as y,u as I,z as R,Q as v}from"./ChartManager-fa2e8ac3.js";import{A as u}from"./AnimatedSprite-208bf5e7.js";import{T as $,H as f}from"./HoldBody-4faa0670.js";const M="/smeditor/assets/active-d06e5c33.png",U="/smeditor/assets/downBodyActive-8cf886d3.png",F="/smeditor/assets/downBodyInactive-7465edd0.png",L="/smeditor/assets/downBottomCapActive-b10d1f0d.png",k="/smeditor/assets/downBottomCapInactive-12cafebe.png",P="/smeditor/assets/inactive-a4aecb82.png",O="/smeditor/assets/leftBodyActive-5d89f111.png",D="/smeditor/assets/leftBodyInactive-1110dc77.png",S="/smeditor/assets/leftBottomCapActive-f759c91c.png",j="/smeditor/assets/leftBottomCapInactive-a4ac7bba.png",V="/smeditor/assets/rightBodyActive-8af7624b.png",z="/smeditor/assets/rightBodyInactive-695480aa.png",Y="/smeditor/assets/rightBottomCapActive-6edeea1e.png",X="/smeditor/assets/rightBottomCapInactive-d674960e.png",q="/smeditor/assets/upBodyActive-c813881f.png",J="/smeditor/assets/upBodyInactive-0222237a.png",Q="/smeditor/assets/upBottomCapActive-19e4c05d.png",W="/smeditor/assets/upBottomCapInactive-23aae747.png",G="/smeditor/assets/active-29dd632a.png",K="/smeditor/assets/downBodyActive-77f6502e.png",Z="/smeditor/assets/downBodyInactive-a5759c62.png",tt="/smeditor/assets/downBottomCapActive-57ef4d54.png",et="/smeditor/assets/downBottomCapInactive-13ddf252.png",ot="/smeditor/assets/inactive-48f23de3.png",st="/smeditor/assets/leftBodyActive-fd4e902b.png",at="/smeditor/assets/leftBodyInactive-8fe6311e.png",nt="/smeditor/assets/leftBottomCapActive-057c49fb.png",it="/smeditor/assets/leftBottomCapInactive-df6350c7.png",ct="/smeditor/assets/rightBodyActive-751fadec.png",lt="/smeditor/assets/rightBodyInactive-46202369.png",rt="/smeditor/assets/rightBottomCapActive-a736d803.png",dt="/smeditor/assets/rightBottomCapInactive-a64cea2c.png",pt="/smeditor/assets/upBodyActive-b06d82f3.png",ht="/smeditor/assets/upBodyInactive-4ef75342.png",mt="/smeditor/assets/upBottomCapActive-07fb7c6e.png",_t="/smeditor/assets/upBottomCapInactive-75f78aac.png",gt="/smeditor/assets/hold-4cf23d59.png",vt="/smeditor/assets/mine-f6147b04.png",ft="/smeditor/assets/particles-18ec6c1d.png",wt="/smeditor/assets/w0-6f86addb.png",ut="/smeditor/assets/w1-c8c43b0f.png",bt="/smeditor/assets/w2-37282ba8.png",Bt="/smeditor/assets/w3-3c2ca2d8.png",At="/smeditor/assets/w4-ce0f95de.png",yt="/smeditor/assets/w5-23173d4f.png",Ct="/smeditor/assets/hold-4cf23d59.png",xt="/smeditor/assets/mine-f6147b04.png",It="/smeditor/assets/particles-18ec6c1d.png",Tt=i.from(Ct),Nt=b(i.from(xt),16,1,160,1024)[0],Ht=i.from(It),N=["w0","w1","w2","w3","w4","w5"],H={};N.forEach(t=>H[t]=i.from(new URL(Object.assign({"./flash/hold.png":gt,"./flash/mine.png":vt,"./flash/particles.png":ft,"./flash/w0.png":wt,"./flash/w1.png":ut,"./flash/w2.png":bt,"./flash/w3.png":Bt,"./flash/w4.png":At,"./flash/w5.png":yt})[`./flash/${t}.png`],self.location).href));class Et extends g{holdExplosion=new l(Tt);particles=new l(Ht);mine=new u(Nt);standard={};anims=new Set;particleAnim;mineAnim;constructor(e,s,n){super();const a=.5;N.forEach(o=>{const c=new l(H[o]);c.anchor.set(.5),c.alpha=0,c.blendMode=B.ADD,this.standard[o]=c,this.addChild(c)}),e.on(this,"hit",o=>{if(s==o.columnNumber){const c=this.standard[o.judgement.id];if(!c)return;this.anims.forEach(d=>r.finish(d)),this.anims.clear(),this.anims.add(r.animate(c,{0:{alpha:.875,"scale.x":.8*a,"scale.y":.8*a},"0.5":{alpha:.875,"scale.x":1.1*a,"scale.y":1.1*a},1:{alpha:0,"scale.x":1.1*a,"scale.y":1.1*a}},.12))}}),e.on(this,"held",o=>{s==o.columnNumber&&(this.anims.forEach(c=>r.finish(c)),this.anims.clear(),this.anims.add(r.animate(this.standard.w0,{0:{alpha:.875,"scale.x":.8*a,"scale.y":.8*a},"0.5":{alpha:.875,"scale.x":1.1*a,"scale.y":1.1*a},1:{alpha:0,"scale.x":1.1*a,"scale.y":1.1*a}},.12)))}),e.on(this,"holdon",o=>{s==o.columnNumber&&(this.holdExplosion.visible=!0)}),e.on(this,"holdoff",o=>{s==o.columnNumber&&(this.holdExplosion.visible=!1)}),e.on(this,"rollon",o=>{s==o.columnNumber&&(this.holdExplosion.visible=!0)}),e.on(this,"rolloff",o=>{s==o.columnNumber&&(this.holdExplosion.visible=!1)}),e.onUpdate(this,()=>{this.holdExplosion.alpha=Math.sin(Date.now()/1e3*Math.PI*2*20)*.1+1}),this.holdExplosion.visible=!1,this.holdExplosion.anchor.set(.5),this.holdExplosion.scale.set(.5),this.addChild(this.holdExplosion),this.particles.alpha=0,this.particles.blendMode=B.ADD,this.particles.anchor.set(.5),e.on(this,"hit",o=>{if(s==o.columnNumber){if(this.particles.rotation=Math.random()*Math.PI*2,r.finish(this.particleAnim),!["w0","w1","w2","w3"].includes(o.judgement.id))return;this.particleAnim=r.animate(this.particles,{0:{alpha:.6,"scale.x":1*a,"scale.y":1*a},"0.7":{alpha:.6,"scale.x":1.2*a,"scale.y":1.2*a},1:{alpha:0,"scale.x":1.2*a,"scale.y":1.2*a}},.185,A(.16,.73,.63,.75))}}),this.addChild(this.particles),this.mine.anchor.x=.5,this.mine.scale.set(.5),this.mine.rotation=-C[n]*Math.PI/180,this.mine.animationSpeed=1/3,this.mine.alpha=0,this.addChild(this.mine),e.on(this,"hitmine",o=>{s==o.columnNumber&&(r.finish(this.mineAnim),this.mine.anchor.y=y.chart.reverse?1:0,this.mine.currentFrame=0,this.mine.play(),this.mineAnim=r.animate(this.mine,{0:{alpha:1},"0.5":{alpha:1},1:{alpha:0}},.6))})}}const Rt="/smeditor/assets/colors-63f923d2.png",$t="/smeditor/assets/mask-f1b4d033.png",Mt="/smeditor/assets/note-07e5d79f.png",Ut="/smeditor/assets/outline-72e881a7.png",Ft="/smeditor/assets/stroke-1f54ba14.png",Lt="/smeditor/assets/top-74da30ae.png",_={};["colors","mask","note","outline","stroke","top"].forEach(t=>_[t]=i.from(new URL(Object.assign({"./tap/colors.png":Rt,"./tap/mask.png":$t,"./tap/note.png":Mt,"./tap/outline.png":Ut,"./tap/stroke.png":Ft,"./tap/top.png":Lt})[`./tap/${t}.png`],self.location).href));const kt=b(_.top,4,1,384,384)[0],T=[-80,0,80];class p{static arrowFrameTex;static arrowFrameContainer=new g;static arrowTex;static arrowContainer=new g;static loaded=!1;static async initArrowTex(){if(!this.loaded){p.arrowFrameTex=I.create({width:64,height:64,resolution:y.performance.resolution}),p.arrowTex=I.create({width:64*3,height:64,resolution:y.performance.resolution});{const e=new l(_.note);e.width=64,e.height=64;const s=new l(_.outline);s.width=64,s.height=64;const n=new l(_.stroke);n.width=64,n.height=64,this.arrowFrameContainer.addChild(e,s,n)}for(let e=0;e<3;e++){const s=new l(this.arrowFrameTex);s.x=e*64;const n=new l(_.mask);n.scale.set(1/6),n.x=e*64,n.y=32,n.anchor.y=.5,n.alpha=1;const a=new $(_.colors,256,1024);a.tileScale.y=1/4,a.uvRespectAnchor=!0,a.x=e*64,a.y=32,a.tilePosition.y=128+T[e],a.anchor.y=.5,a.height=64,a.width=64,a.alpha=1,a.mask=n,a.name="c"+e;const o=new u(kt);o.scale.set(1/6),o.x=e*64,o.y=32,o.anchor.y=.5,o.alpha=1,o.name="t"+e,this.arrowContainer.addChild(s,a,n,o)}this.loaded=!0}}static setArrowTexTime(e){if(!this.loaded)return;const s=e.chartManager.chartView.getVisualBeat(),n=(s%1+1)%1,a=(s%4+4)%4;for(let o=0;o<3;o++)this.arrowContainer.getChildByName("c"+o).tilePosition.y=128+T[o]-a/4*256,this.arrowContainer.getChildByName("t"+o).currentFrame=Math.floor(n*4);e.renderer.render(p.arrowFrameContainer,{renderTexture:p.arrowFrameTex}),e.renderer.render(p.arrowContainer,{renderTexture:p.arrowTex})}static setNoteTex(e,s){let n=[4,8].indexOf(s?.quant??4);n==-1&&(n=2),e.texture=new i(p.arrowTex.baseTexture,new R(n*64,0,64,64))}}const Pt="/smeditor/assets/mine-335f4545.png",Ot="/smeditor/assets/spark-2c59cc0e.png",Dt="/smeditor/assets/receptor-a0a69b2b.png",St="/smeditor/assets/receptorFlash-c7675c53.png",jt=i.from(Dt),Vt=i.from(St),zt=i.from(Pt),Yt=b(i.from(Ot),4,4,160,128).flat(),Xt={Left:0,Down:5,Up:8,Right:13},h={},m={},w={Hold:{Active:i.from(new URL("/smeditor/assets/active-d06e5c33.png",self.location).href),Inactive:i.from(new URL("/smeditor/assets/inactive-a4aecb82.png",self.location).href)},Roll:{Active:i.from(new URL("/smeditor/assets/active-29dd632a.png",self.location).href),Inactive:i.from(new URL("/smeditor/assets/inactive-48f23de3.png",self.location).href)}};for(const t of["Left","Down","Up","Right"])for(const e of["Body","BottomCap"])for(const s of["Active","Inactive"])h[t]===void 0&&(h[t]={}),h[t][s]===void 0&&(h[t][s]={}),h[t][s][e]=i.from(new URL(Object.assign({"./hold/active.png":M,"./hold/downBodyActive.png":U,"./hold/downBodyInactive.png":F,"./hold/downBottomCapActive.png":L,"./hold/downBottomCapInactive.png":k,"./hold/inactive.png":P,"./hold/leftBodyActive.png":O,"./hold/leftBodyInactive.png":D,"./hold/leftBottomCapActive.png":S,"./hold/leftBottomCapInactive.png":j,"./hold/rightBodyActive.png":V,"./hold/rightBodyInactive.png":z,"./hold/rightBottomCapActive.png":Y,"./hold/rightBottomCapInactive.png":X,"./hold/upBodyActive.png":q,"./hold/upBodyInactive.png":J,"./hold/upBottomCapActive.png":Q,"./hold/upBottomCapInactive.png":W})[`./hold/${t.toLowerCase()}${e}${s}.png`],self.location).href),m[t]===void 0&&(m[t]={}),m[t][s]===void 0&&(m[t][s]={}),m[t][s][e]=i.from(new URL(Object.assign({"./roll/active.png":G,"./roll/downBodyActive.png":K,"./roll/downBodyInactive.png":Z,"./roll/downBottomCapActive.png":tt,"./roll/downBottomCapInactive.png":et,"./roll/inactive.png":ot,"./roll/leftBodyActive.png":st,"./roll/leftBodyInactive.png":at,"./roll/leftBottomCapActive.png":nt,"./roll/leftBottomCapInactive.png":it,"./roll/rightBodyActive.png":ct,"./roll/rightBodyInactive.png":lt,"./roll/rightBottomCapActive.png":rt,"./roll/rightBottomCapInactive.png":dt,"./roll/upBodyActive.png":pt,"./roll/upBodyInactive.png":ht,"./roll/upBottomCapActive.png":mt,"./roll/upBottomCapInactive.png":_t})[`./roll/${t.toLowerCase()}${e}${s}.png`],self.location).href);const C={Left:90,Down:0,Up:180,Right:-90},qt=["Receptor","Tap","Lift","Fake","Hold Inactive Head","Hold Active Head","Roll Inactive Head","Roll Active Head","NoteFlash"],Gt={elements:{Left:{Receptor:t=>{let e,s;const n=b(jt,2,1,404,404),a=new g,o=new u(n[0]);o.width=64,o.height=64,o.anchor.set(.5),t.noteskin.on(o,"ghosttap",d=>{d.columnNumber==t.columnNumber&&(r.finish(e),e=r.animate(o,{0:{alpha:.9,width:.85*64,height:.85*64},1:{alpha:1,width:64,height:64}},.11))});const c=new l(Vt);return c.blendMode=B.ADD,c.width=64,c.height=64,c.anchor.set(.5),c.alpha=0,t.noteskin.on(a,"press",d=>{d.columnNumber==t.columnNumber&&(r.finish(s),s=r.animate(c,{0:{alpha:0,width:.85*64,height:.85*64},1:{alpha:.6,width:64,height:64}},.12,A(.5,1,.89,1)))}),t.noteskin.on(a,"lift",d=>{d.columnNumber==t.columnNumber&&(r.finish(s),s=r.animate(c,{0:{alpha:"inherit",width:"inherit",height:"inherit"},1:{alpha:0,width:64*1.2,height:64}},.12,A(.11,0,.5,1)))}),t.noteskin.onUpdate(a,d=>{const x=d.chart.getNotedata()[0]?.beat;if(x===void 0||d.getVisualBeat()<x-8){o.currentFrame=1;return}const E=(d.getVisualBeat()%1+1)%1;o.currentFrame=E<.2?0:1}),a.addChild(o,c),a},Tap:t=>{const e=new l(i.WHITE);return p.setNoteTex(e,t.note),e.anchor.set(.5),e},NoteFlash:t=>new Et(t.noteskin,t.columnNumber,t.columnName),Fake:{element:"Tap"},Lift:{element:"Tap"},Mine:t=>{const e=new g,s=new l(zt);s.anchor.set(.5),s.width=64,s.height=64,s.rotation=C[t.columnName]*Math.PI/180;const n=new u(Yt);return n.anchor.set(.5),n.scale.set(.5),e.addChild(s,n),t.noteskin.onUpdate(e,a=>{const o=a.getVisualTime();n.currentFrame=((Math.floor(o*20)+Xt[t.columnName])%16+16)%16}),e},"Hold Active Head":()=>{const t=new l(w.Hold.Active);return t.anchor.set(.5),t.scale.set(1/6),t},"Hold Inactive Head":()=>{const t=new l(w.Hold.Inactive);return t.anchor.set(.5),t.scale.set(1/6),t},"Hold Active Body":t=>new f(h[t.columnName].Active.Body),"Hold Inactive Body":t=>new f(h[t.columnName].Inactive.Body),"Hold Active TopCap":()=>new l(i.EMPTY),"Hold Inactive TopCap":()=>new l(i.EMPTY),"Hold Active BottomCap":t=>new v(h[t.columnName].Active.BottomCap),"Hold Inactive BottomCap":t=>new v(h[t.columnName].Inactive.BottomCap),"Roll Active Head":()=>{const t=new l(w.Roll.Active);return t.anchor.set(.5),t.scale.set(1/6),t},"Roll Inactive Head":()=>{const t=new l(w.Roll.Inactive);return t.anchor.set(.5),t.scale.set(1/6),t},"Roll Active Body":t=>new f(m[t.columnName].Active.Body),"Roll Inactive Body":t=>new f(m[t.columnName].Inactive.Body),"Roll Active TopCap":()=>new l(i.EMPTY),"Roll Inactive TopCap":()=>new l(i.EMPTY),"Roll Active BottomCap":t=>new v(m[t.columnName].Active.BottomCap),"Roll Inactive BottomCap":t=>new v(m[t.columnName].Inactive.BottomCap)}},load:function(t,e){const s=t.columnName;t.columnName="Left";const n=this.loadElement(t,e);return qt.includes(t.element)&&(n.rotation=C[s]*Math.PI/180),n},init(){p.initArrowTex()},update(t){p.setArrowTexTime(t.chartManager.app)},metrics:{HoldBodyBottomOffset:-16,RollBodyBottomOffset:-16}};export{Gt as default,C as rotationMap};
