import{a0 as d,v as i,b as f,y as u,O as T,P as g,L as l,X as m,Q as p,a1 as U}from"./ChartManager-c45f7ffb.js";import{A as w}from"./AnimatedSprite-30d05248.js";import{A as H}from"./HoldBody-a092651e.js";const L="/smeditor/assets/Center-1b6bfec9.png",y="/smeditor/assets/DownLeft-242c6bf3.png",B="/smeditor/assets/DownRight-a869fa38.png",M="/smeditor/assets/UpLeft-d457a441.png",O="/smeditor/assets/UpRight-fda6b516.png",I="/smeditor/assets/Center-cb4b6c25.png",E="/smeditor/assets/DownLeft-94341616.png",S="/smeditor/assets/DownRight-3c57e4fa.png",F="/smeditor/assets/UpLeft-752b6821.png",$="/smeditor/assets/UpRight-91e454bc.png",N="/smeditor/assets/Center-55e9b68a.png",P="/smeditor/assets/DownLeft-19d91486.png",V="/smeditor/assets/DownRight-e2cf2b7d.png",j="/smeditor/assets/UpLeft-28515625.png",k="/smeditor/assets/UpRight-8a892589.png",v={},c=["DownLeft","UpLeft","Center","UpRight","DownRight"];for(const t of c)v[t]=d(i.from(new URL(Object.assign({"./tap/Center.png":I,"./tap/DownLeft.png":E,"./tap/DownRight.png":S,"./tap/UpLeft.png":F,"./tap/UpRight.png":$})[`./tap/${t}.png`],self.location).href),3,2,96,96).flat();const D={};for(const t of c)D[t]=d(i.from(new URL(Object.assign({"./roll/Center.png":N,"./roll/DownLeft.png":P,"./roll/DownRight.png":V,"./roll/UpLeft.png":j,"./roll/UpRight.png":k})[`./roll/${t}.png`],self.location).href),3,2,96,96).flat();const Y=d(i.from(new URL("/smeditor/assets/mine-0e34ec01.png",self.location).href),3,2,96,96).flat();class a{static noteTex;static noteContainer=new f;static rollTex;static rollContainer=new f;static mineTex;static mine;static loaded=!1;static async initArrowTex(){if(!this.loaded){a.noteTex=u.create({width:96*5,height:96,resolution:T.performance.resolution}),a.rollTex=u.create({width:96*5,height:96,resolution:T.performance.resolution}),a.mineTex=u.create({width:96,height:96,resolution:T.performance.resolution});for(const e of c)this.createSprite(this.noteContainer,e,v);for(const e of c)this.createSprite(this.rollContainer,e,D);this.mine=new w(Y),this.loaded=!0}}static createSprite(e,o,n){const s=c.indexOf(o)*96,r=new w(n[o]);r.x=s,e.addChild(r)}static setArrowTexTime(e){if(!this.loaded)return;const o=e.chartManager.chartView.getVisualTime(),n=Math.floor((o%.3+.3)%.3/.3*6);this.noteContainer.children.forEach(s=>s.currentFrame=n),this.rollContainer.children.forEach(s=>s.currentFrame=n),this.mine.currentFrame=n,e.renderer.render(a.noteContainer,{renderTexture:a.noteTex}),e.renderer.render(a.rollContainer,{renderTexture:a.rollTex}),e.renderer.render(a.mine,{renderTexture:a.mineTex})}static setNoteTex(e,o,n){if(o===void 0)return i.WHITE;if(o.type=="Mine")e.texture=this.mineTex;else{const s=c.indexOf(n)*96;e.texture=new i(this.noteTex.baseTexture,new g(s,0,96,96))}}static setRollTex(e,o){const n=c.indexOf(o)*96;e.texture=new i(this.rollTex.baseTexture,new g(n,0,96,96))}}const W="/smeditor/assets/receptors-0a59df78.png",z="/smeditor/assets/flash-e524b5bd.png",J="/smeditor/assets/mine-590d445e.png",Q="/smeditor/assets/press-feed8aa6.png",X=d(i.from(z),5,1,128,128)[0],q=i.from(J),C=d(i.from(Q),5,2,96,96),G=["w0","w1","w2","w3"];class K extends f{press;pressAnim;hitContainer=new f;tap;note;flash;hitAnim;anims=new Set;constructor(e,o,n){super();const s=1/1.5;this.press=new l(C[1][_.indexOf(o)]),this.press.alpha=0,this.press.anchor.set(.5),this.tap=new l(C[0][_.indexOf(o)]),this.tap.blendMode=m.ADD,this.tap.scale.set(s),this.tap.anchor.set(.5),this.note=new w(v[o]),this.note.scale.set(s),this.note.blendMode=m.ADD,this.note.animationSpeed=1/3,this.note.play(),this.note.anchor.set(.5),this.flash=new w(X),this.flash.scale.set(2),this.flash.blendMode=m.ADD,this.flash.animationSpeed=1/3,this.flash.loop=!1,this.flash.visible=!1,this.flash.anchor.set(.5),this.flash.onComplete=()=>{this.flash.visible=!1,this.flash.stop()},this.hitContainer.alpha=0,this.hitContainer.addChild(this.tap,this.note),e.on(this,"ghosttap",r=>{n==r.columnNumber&&(p.finish(this.pressAnim),this.pressAnim=p.animate(this.press,{0:{alpha:1,"scale.x":1*s,"scale.y":1*s},1:{alpha:0,"scale.x":1.3*s,"scale.y":1.3*s}},.25))}),e.on(this,"hit",r=>{if(n==r.columnNumber){if(!G.includes(r.judgement.id))return;p.finish(this.pressAnim),p.finish(this.hitAnim),this.hitAnim=p.animate(this.hitContainer,{0:{alpha:1,"scale.x":1,"scale.y":1},1:{alpha:0,"scale.x":1.2,"scale.y":1.2}},.4),this.flash.visible=!0,this.flash.currentFrame=0,this.flash.play()}}),e.on(this,"hitmine",r=>{if(n==r.columnNumber){const h=new l(q);h.alpha=0,h.anchor.set(.5),h.blendMode=m.ADD,this.addChild(h),p.animate(h,{0:{alpha:1,rotation:0},"0.5":{alpha:1,rotation:90*Math.PI/180},1:{alpha:0,rotation:180*Math.PI/180}},.4,void 0,()=>h.destroy())}}),this.addChild(this.press,this.hitContainer,this.flash)}}const A=d(i.from(W),5,2,96,96),_=["DownLeft","UpLeft","Center","UpRight","DownRight"],b={},x=96;for(const t of _){const e=i.from(new URL(Object.assign({"./hold/Center.png":L,"./hold/DownLeft.png":y,"./hold/DownRight.png":B,"./hold/UpLeft.png":M,"./hold/UpRight.png":O})[`./hold/${t}.png`],self.location).href),o=[],n=[];for(let s=0;s<6;s++)o.push(new i(e.baseTexture,new g(s*96,0,96,288-x))),n.push(new i(e.baseTexture,new g(s*96,288-x,96,x)));b[t]={body:o,cap:n}}const se={elements:{DownLeft:{Receptor:t=>{const e=new f,o=_.indexOf(t.columnName),n=new l(A[0][o]);n.width=72,n.height=72,n.anchor.set(.5);const s=new l(A[1][o]);return s.width=n.width,s.height=n.height,s.anchor.set(.5),s.blendMode=m.ADD,e.addChild(n,s),t.noteskin.onUpdate(e,r=>{const R=(r.getVisualBeat()%1+1)%1;s.alpha=(1-R)/2}),e},Tap:t=>{const e=new l(i.WHITE);return a.setNoteTex(e,t.note,t.columnName),e.anchor.set(.5),e.width=72,e.height=72,e},Fake:{element:"Tap"},Lift:{element:"Tap"},Mine:{element:"Tap"},NoteFlash:t=>new K(t.noteskin,t.columnName,t.columnNumber),"Hold Active Head":{element:"Tap"},"Hold Inactive Head":{element:"Tap"},"Hold Active Body":t=>{const e=new H(b[t.columnName].body,72);return t.noteskin.onUpdate(e,o=>{const n=o.getVisualTime(),s=Math.floor((n%.3+.3)%.3/.3*6);e.currentFrame=s}),e},"Hold Inactive Body":{element:"Hold Active Body"},"Hold Active TopCap":()=>new l(i.EMPTY),"Hold Inactive TopCap":()=>new l(i.EMPTY),"Hold Active BottomCap":t=>{const e=new U(b[t.columnName].cap,72);return t.noteskin.onUpdate(e,o=>{const n=o.getVisualTime(),s=Math.floor((n%.3+.3)%.3/.3*6);e.currentFrame=s}),e},"Hold Inactive BottomCap":{element:"Hold Active BottomCap"},"Roll Active Head":t=>{const e=new l(i.WHITE);return a.setRollTex(e,t.columnName),e.anchor.set(.5),e.width=72,e.height=72,e},"Roll Inactive Head":{element:"Roll Active Head"},"Roll Active Body":{element:"Hold Active Body"},"Roll Inactive Body":{element:"Hold Active Body"},"Roll Active TopCap":()=>new l(i.EMPTY),"Roll Inactive TopCap":()=>new l(i.EMPTY),"Roll Active BottomCap":{element:"Hold Active BottomCap"},"Roll Inactive BottomCap":{element:"Hold Active BottomCap"}}},load:function(t,e){return t.columnName="DownLeft",this.loadElement(t,e)},init(){a.initArrowTex()},update(t){a.setArrowTexTime(t.chartManager.app)},metrics:{HoldBodyBottomOffset:-36,RollBodyBottomOffset:-36}};export{se as default,_ as texOrder};
