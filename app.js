const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["memory-BIfFwPK3.js","Simfile-CQi2bJch.js","assets/Simfile-Bi8zDpmu.css","downloader-C0o52Hx3.js","FileSystemWritableFileStream-D05uA35V.js","web-streams-ponyfill-BfVhaP7e.js","NodeFileHandler-C3wcEEbV.js","Noteskin-CzSCMjM2.js","HoldBody-n8_eff45.js","Noteskin-Dh3zA_cV.js","Noteskin-4RlPM8HL.js","AnimatedSprite-BENjrsZF.js","Noteskin-DlQiOh82.js","Noteskin-EER82b4p.js","Noteskin-BXpQSKgH.js","Noteskin-DHpT2qg6.js","Noteskin-BvUBNE7r.js","Noteskin-CnY-tyuu.js","Noteskin-BHuyla-7.js","Noteskin-B_jYTiyf.js","Noteskin-CKesfFF2.js","Noteskin-DF6KNVAG.js","Noteskin-Bnk-FYsf.js","Noteskin-CYo9De3k.js","Noteskin-BMTRjynq.js"])))=>i.map(i=>d[i]);
import{M as Yu,a as Ku,b as Xu,T as Ce,C as fe,B as Ac,c as F,g as Jn,d as gi,O as y,I as me,e as Se,F as he,f as St,h as Ut,i as Us,j as Oe,k as _t,G as bt,t as Xe,p as Nn,r as ue,W as de,E as re,l as et,D as hi,m as Zu,n as Ao,A as Et,o as Qu,q as yn,S as kc,s as ko,u as Sc,v as Ha,w as pt,x as Ci,y as Tc,z as Ju,H as $i,J as Hn,K as Xt,L as ed,N as Yt,Q as wn,P as ei,R as So,U as ea,V as Ai,X as ye,Y as Ae,Z as zn,_ as _s,$ as er,a0 as dn,a1 as ui,a2 as bi,a3 as Ws,a4 as Vn,a5 as td,a6 as Mc,a7 as Sa,a8 as To,a9 as id,aa as Mo,ab as nd,ac as Lc,ad as sa,ae as Lo,af as ad,ag as rd,ah as sd,ai as tr,aj as od}from"./Simfile-CQi2bJch.js";class ld extends Yu{constructor(e=100,t=100,n=10,a=10){super(),this.segWidth=n,this.segHeight=a,this.width=e,this.height=t,this.build()}build(){const e=this.segWidth*this.segHeight,t=[],n=[],a=[],r=this.segWidth-1,s=this.segHeight-1,o=this.width/r,l=this.height/s;for(let f=0;f<e;f++){const c=f%this.segWidth,d=f/this.segWidth|0;t.push(c*o,d*l),n.push(c/r,d/s)}const u=r*s;for(let f=0;f<u;f++){const c=f%r,d=f/r|0,h=d*this.segWidth+c,p=d*this.segWidth+c+1,m=(d+1)*this.segWidth+c,g=(d+1)*this.segWidth+c+1;a.push(h,p,m,p,g,m)}this.buffers[0].data=new Float32Array(t),this.buffers[1].data=new Float32Array(n),this.indexBuffer.data=new Uint16Array(a),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}}class cd extends Ku{constructor(e,t,n){const a=new ld(e.width,e.height,t,n),r=new Xu(Ce.WHITE);super(a,r),this.texture=e,this.autoResize=!0}textureUpdated(){this._textureID=this.shader.texture._updateID;const e=this.geometry,{width:t,height:n}=this.shader.texture;this.autoResize&&(e.width!==t||e.height!==n)&&(e.width=this.shader.texture.width,e.height=this.shader.texture.height,e.build())}set texture(e){this.shader.texture!==e&&(this.shader.texture=e,this._textureID=-1,e.baseTexture.valid?this.textureUpdated():e.once("update",this.textureUpdated,this))}get texture(){return this.shader.texture}_render(e){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),super._render(e)}destroy(e){this.shader.texture.off("update",this.textureUpdated,this),super.destroy(e)}}const oa=10;class Dc extends cd{constructor(e,t,n,a,r){super(Ce.WHITE,4,4),this._origWidth=e.orig.width,this._origHeight=e.orig.height,this._width=this._origWidth,this._height=this._origHeight,this._leftWidth=t??e.defaultBorders?.left??oa,this._rightWidth=a??e.defaultBorders?.right??oa,this._topHeight=n??e.defaultBorders?.top??oa,this._bottomHeight=r??e.defaultBorders?.bottom??oa,this.texture=e}textureUpdated(){this._textureID=this.shader.texture._updateID,this._refresh()}get vertices(){return this.geometry.getBuffer("aVertexPosition").data}set vertices(e){this.geometry.getBuffer("aVertexPosition").data=e}updateHorizontalVertices(){const e=this.vertices,t=this._getMinScale();e[9]=e[11]=e[13]=e[15]=this._topHeight*t,e[17]=e[19]=e[21]=e[23]=this._height-this._bottomHeight*t,e[25]=e[27]=e[29]=e[31]=this._height}updateVerticalVertices(){const e=this.vertices,t=this._getMinScale();e[2]=e[10]=e[18]=e[26]=this._leftWidth*t,e[4]=e[12]=e[20]=e[28]=this._width-this._rightWidth*t,e[6]=e[14]=e[22]=e[30]=this._width}_getMinScale(){const e=this._leftWidth+this._rightWidth,t=this._width>e?1:this._width/e,n=this._topHeight+this._bottomHeight,a=this._height>n?1:this._height/n;return Math.min(t,a)}get width(){return this._width}set width(e){this._width=e,this._refresh()}get height(){return this._height}set height(e){this._height=e,this._refresh()}get leftWidth(){return this._leftWidth}set leftWidth(e){this._leftWidth=e,this._refresh()}get rightWidth(){return this._rightWidth}set rightWidth(e){this._rightWidth=e,this._refresh()}get topHeight(){return this._topHeight}set topHeight(e){this._topHeight=e,this._refresh()}get bottomHeight(){return this._bottomHeight}set bottomHeight(e){this._bottomHeight=e,this._refresh()}_refresh(){const e=this.texture,t=this.geometry.buffers[1].data;this._origWidth=e.orig.width,this._origHeight=e.orig.height;const n=1/this._origWidth,a=1/this._origHeight;t[0]=t[8]=t[16]=t[24]=0,t[1]=t[3]=t[5]=t[7]=0,t[6]=t[14]=t[22]=t[30]=1,t[25]=t[27]=t[29]=t[31]=1,t[2]=t[10]=t[18]=t[26]=n*this._leftWidth,t[4]=t[12]=t[20]=t[28]=1-n*this._rightWidth,t[9]=t[11]=t[13]=t[15]=a*this._topHeight,t[17]=t[19]=t[21]=t[23]=1-a*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()}}class Gs extends fe{constructor(e=1500,t,n=16384,a=!1){super();const r=16384;n>r&&(n=r),this._properties=[!1,!0,!1,!1,!1],this._maxSize=e,this._batchSize=n,this._buffers=null,this._bufferUpdateIDs=[],this._updateID=0,this.interactiveChildren=!1,this.blendMode=Ac.NORMAL,this.autoResize=a,this.roundPixels=!0,this.baseTexture=null,this.setProperties(t),this._tintColor=new F(0),this.tintRgb=new Float32Array(3),this.tint=16777215}setProperties(e){e&&(this._properties[0]="vertices"in e||"scale"in e?!!e.vertices||!!e.scale:this._properties[0],this._properties[1]="position"in e?!!e.position:this._properties[1],this._properties[2]="rotation"in e?!!e.rotation:this._properties[2],this._properties[3]="uvs"in e?!!e.uvs:this._properties[3],this._properties[4]="tint"in e||"alpha"in e?!!e.tint||!!e.alpha:this._properties[4])}updateTransform(){this.displayObjectUpdateTransform()}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e),this._tintColor.toRgbArray(this.tintRgb)}render(e){!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable||(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",()=>this.onChildrenChange(0))),e.batch.setObjectRenderer(e.plugins.particle),e.plugins.particle.render(this))}onChildrenChange(e){const t=Math.floor(e/this._batchSize);for(;this._bufferUpdateIDs.length<t;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[t]=++this._updateID}dispose(){if(this._buffers){for(let e=0;e<this._buffers.length;++e)this._buffers[e].destroy();this._buffers=null}}destroy(e){super.destroy(e),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null}}var la={exports:{}},ir,Do;function za(){if(Do)return ir;Do=1;const i="2.0.0",e=256,t=Number.MAX_SAFE_INTEGER||9007199254740991,n=16,a=e-6;return ir={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:a,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:i,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},ir}var nr,Bo;function Va(){if(Bo)return nr;Bo=1;var i={};return nr=typeof process=="object"&&i&&i.NODE_DEBUG&&/\bsemver\b/i.test(i.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{},nr}var Fo;function ta(){return Fo||(Fo=1,function(i,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:a}=za(),r=Va();e=i.exports={};const s=e.re=[],o=e.safeRe=[],l=e.src=[],u=e.t={};let f=0;const c="[a-zA-Z0-9-]",d=[["\\s",1],["\\d",a],[c,n]],h=m=>{for(const[g,b]of d)m=m.split(`${g}*`).join(`${g}{0,${b}}`).split(`${g}+`).join(`${g}{1,${b}}`);return m},p=(m,g,b)=>{const x=h(g),w=f++;r(m,w,g),u[m]=w,l[w]=g,s[w]=new RegExp(g,b?"g":void 0),o[w]=new RegExp(x,b?"g":void 0)};p("NUMERICIDENTIFIER","0|[1-9]\\d*"),p("NUMERICIDENTIFIERLOOSE","\\d+"),p("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${c}*`),p("MAINVERSION",`(${l[u.NUMERICIDENTIFIER]})\\.(${l[u.NUMERICIDENTIFIER]})\\.(${l[u.NUMERICIDENTIFIER]})`),p("MAINVERSIONLOOSE",`(${l[u.NUMERICIDENTIFIERLOOSE]})\\.(${l[u.NUMERICIDENTIFIERLOOSE]})\\.(${l[u.NUMERICIDENTIFIERLOOSE]})`),p("PRERELEASEIDENTIFIER",`(?:${l[u.NUMERICIDENTIFIER]}|${l[u.NONNUMERICIDENTIFIER]})`),p("PRERELEASEIDENTIFIERLOOSE",`(?:${l[u.NUMERICIDENTIFIERLOOSE]}|${l[u.NONNUMERICIDENTIFIER]})`),p("PRERELEASE",`(?:-(${l[u.PRERELEASEIDENTIFIER]}(?:\\.${l[u.PRERELEASEIDENTIFIER]})*))`),p("PRERELEASELOOSE",`(?:-?(${l[u.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${l[u.PRERELEASEIDENTIFIERLOOSE]})*))`),p("BUILDIDENTIFIER",`${c}+`),p("BUILD",`(?:\\+(${l[u.BUILDIDENTIFIER]}(?:\\.${l[u.BUILDIDENTIFIER]})*))`),p("FULLPLAIN",`v?${l[u.MAINVERSION]}${l[u.PRERELEASE]}?${l[u.BUILD]}?`),p("FULL",`^${l[u.FULLPLAIN]}$`),p("LOOSEPLAIN",`[v=\\s]*${l[u.MAINVERSIONLOOSE]}${l[u.PRERELEASELOOSE]}?${l[u.BUILD]}?`),p("LOOSE",`^${l[u.LOOSEPLAIN]}$`),p("GTLT","((?:<|>)?=?)"),p("XRANGEIDENTIFIERLOOSE",`${l[u.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),p("XRANGEIDENTIFIER",`${l[u.NUMERICIDENTIFIER]}|x|X|\\*`),p("XRANGEPLAIN",`[v=\\s]*(${l[u.XRANGEIDENTIFIER]})(?:\\.(${l[u.XRANGEIDENTIFIER]})(?:\\.(${l[u.XRANGEIDENTIFIER]})(?:${l[u.PRERELEASE]})?${l[u.BUILD]}?)?)?`),p("XRANGEPLAINLOOSE",`[v=\\s]*(${l[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[u.XRANGEIDENTIFIERLOOSE]})(?:${l[u.PRERELEASELOOSE]})?${l[u.BUILD]}?)?)?`),p("XRANGE",`^${l[u.GTLT]}\\s*${l[u.XRANGEPLAIN]}$`),p("XRANGELOOSE",`^${l[u.GTLT]}\\s*${l[u.XRANGEPLAINLOOSE]}$`),p("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),p("COERCE",`${l[u.COERCEPLAIN]}(?:$|[^\\d])`),p("COERCEFULL",l[u.COERCEPLAIN]+`(?:${l[u.PRERELEASE]})?(?:${l[u.BUILD]})?(?:$|[^\\d])`),p("COERCERTL",l[u.COERCE],!0),p("COERCERTLFULL",l[u.COERCEFULL],!0),p("LONETILDE","(?:~>?)"),p("TILDETRIM",`(\\s*)${l[u.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",p("TILDE",`^${l[u.LONETILDE]}${l[u.XRANGEPLAIN]}$`),p("TILDELOOSE",`^${l[u.LONETILDE]}${l[u.XRANGEPLAINLOOSE]}$`),p("LONECARET","(?:\\^)"),p("CARETTRIM",`(\\s*)${l[u.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",p("CARET",`^${l[u.LONECARET]}${l[u.XRANGEPLAIN]}$`),p("CARETLOOSE",`^${l[u.LONECARET]}${l[u.XRANGEPLAINLOOSE]}$`),p("COMPARATORLOOSE",`^${l[u.GTLT]}\\s*(${l[u.LOOSEPLAIN]})$|^$`),p("COMPARATOR",`^${l[u.GTLT]}\\s*(${l[u.FULLPLAIN]})$|^$`),p("COMPARATORTRIM",`(\\s*)${l[u.GTLT]}\\s*(${l[u.LOOSEPLAIN]}|${l[u.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",p("HYPHENRANGE",`^\\s*(${l[u.XRANGEPLAIN]})\\s+-\\s+(${l[u.XRANGEPLAIN]})\\s*$`),p("HYPHENRANGELOOSE",`^\\s*(${l[u.XRANGEPLAINLOOSE]})\\s+-\\s+(${l[u.XRANGEPLAINLOOSE]})\\s*$`),p("STAR","(<|>)?=?\\s*\\*"),p("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),p("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(la,la.exports)),la.exports}var ar,Io;function qs(){if(Io)return ar;Io=1;const i=Object.freeze({loose:!0}),e=Object.freeze({});return ar=n=>n?typeof n!="object"?i:n:e,ar}var rr,Ro;function Bc(){if(Ro)return rr;Ro=1;const i=/^[0-9]+$/,e=(n,a)=>{const r=i.test(n),s=i.test(a);return r&&s&&(n=+n,a=+a),n===a?0:r&&!s?-1:s&&!r?1:n<a?-1:1};return rr={compareIdentifiers:e,rcompareIdentifiers:(n,a)=>e(a,n)},rr}var sr,Po;function Ct(){if(Po)return sr;Po=1;const i=Va(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:t}=za(),{safeRe:n,t:a}=ta(),r=qs(),{compareIdentifiers:s}=Bc();class o{constructor(u,f){if(f=r(f),u instanceof o){if(u.loose===!!f.loose&&u.includePrerelease===!!f.includePrerelease)return u;u=u.version}else if(typeof u!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof u}".`);if(u.length>e)throw new TypeError(`version is longer than ${e} characters`);i("SemVer",u,f),this.options=f,this.loose=!!f.loose,this.includePrerelease=!!f.includePrerelease;const c=u.trim().match(f.loose?n[a.LOOSE]:n[a.FULL]);if(!c)throw new TypeError(`Invalid Version: ${u}`);if(this.raw=u,this.major=+c[1],this.minor=+c[2],this.patch=+c[3],this.major>t||this.major<0)throw new TypeError("Invalid major version");if(this.minor>t||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>t||this.patch<0)throw new TypeError("Invalid patch version");c[4]?this.prerelease=c[4].split(".").map(d=>{if(/^[0-9]+$/.test(d)){const h=+d;if(h>=0&&h<t)return h}return d}):this.prerelease=[],this.build=c[5]?c[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(u){if(i("SemVer.compare",this.version,this.options,u),!(u instanceof o)){if(typeof u=="string"&&u===this.version)return 0;u=new o(u,this.options)}return u.version===this.version?0:this.compareMain(u)||this.comparePre(u)}compareMain(u){return u instanceof o||(u=new o(u,this.options)),s(this.major,u.major)||s(this.minor,u.minor)||s(this.patch,u.patch)}comparePre(u){if(u instanceof o||(u=new o(u,this.options)),this.prerelease.length&&!u.prerelease.length)return-1;if(!this.prerelease.length&&u.prerelease.length)return 1;if(!this.prerelease.length&&!u.prerelease.length)return 0;let f=0;do{const c=this.prerelease[f],d=u.prerelease[f];if(i("prerelease compare",f,c,d),c===void 0&&d===void 0)return 0;if(d===void 0)return 1;if(c===void 0)return-1;if(c===d)continue;return s(c,d)}while(++f)}compareBuild(u){u instanceof o||(u=new o(u,this.options));let f=0;do{const c=this.build[f],d=u.build[f];if(i("build compare",f,c,d),c===void 0&&d===void 0)return 0;if(d===void 0)return 1;if(c===void 0)return-1;if(c===d)continue;return s(c,d)}while(++f)}inc(u,f,c){switch(u){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",f,c);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",f,c);break;case"prepatch":this.prerelease.length=0,this.inc("patch",f,c),this.inc("pre",f,c);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",f,c),this.inc("pre",f,c);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const d=Number(c)?1:0;if(!f&&c===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[d];else{let h=this.prerelease.length;for(;--h>=0;)typeof this.prerelease[h]=="number"&&(this.prerelease[h]++,h=-2);if(h===-1){if(f===this.prerelease.join(".")&&c===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(d)}}if(f){let h=[f,d];c===!1&&(h=[f]),s(this.prerelease[0],f)===0?isNaN(this.prerelease[1])&&(this.prerelease=h):this.prerelease=h}break}default:throw new Error(`invalid increment argument: ${u}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return sr=o,sr}var or,Oo;function gn(){if(Oo)return or;Oo=1;const i=Ct();return or=(t,n,a=!1)=>{if(t instanceof i)return t;try{return new i(t,n)}catch(r){if(!a)return null;throw r}},or}var lr,No;function ud(){if(No)return lr;No=1;const i=gn();return lr=(t,n)=>{const a=i(t,n);return a?a.version:null},lr}var cr,Ho;function dd(){if(Ho)return cr;Ho=1;const i=gn();return cr=(t,n)=>{const a=i(t.trim().replace(/^[=v]+/,""),n);return a?a.version:null},cr}var ur,zo;function hd(){if(zo)return ur;zo=1;const i=Ct();return ur=(t,n,a,r,s)=>{typeof a=="string"&&(s=r,r=a,a=void 0);try{return new i(t instanceof i?t.version:t,a).inc(n,r,s).version}catch{return null}},ur}var dr,Vo;function fd(){if(Vo)return dr;Vo=1;const i=gn();return dr=(t,n)=>{const a=i(t,null,!0),r=i(n,null,!0),s=a.compare(r);if(s===0)return null;const o=s>0,l=o?a:r,u=o?r:a,f=!!l.prerelease.length;if(!!u.prerelease.length&&!f)return!u.patch&&!u.minor?"major":l.patch?"patch":l.minor?"minor":"major";const d=f?"pre":"";return a.major!==r.major?d+"major":a.minor!==r.minor?d+"minor":a.patch!==r.patch?d+"patch":"prerelease"},dr}var hr,Uo;function pd(){if(Uo)return hr;Uo=1;const i=Ct();return hr=(t,n)=>new i(t,n).major,hr}var fr,Wo;function md(){if(Wo)return fr;Wo=1;const i=Ct();return fr=(t,n)=>new i(t,n).minor,fr}var pr,Go;function gd(){if(Go)return pr;Go=1;const i=Ct();return pr=(t,n)=>new i(t,n).patch,pr}var mr,qo;function bd(){if(qo)return mr;qo=1;const i=gn();return mr=(t,n)=>{const a=i(t,n);return a&&a.prerelease.length?a.prerelease:null},mr}var gr,jo;function Zt(){if(jo)return gr;jo=1;const i=Ct();return gr=(t,n,a)=>new i(t,a).compare(new i(n,a)),gr}var br,$o;function yd(){if($o)return br;$o=1;const i=Zt();return br=(t,n,a)=>i(n,t,a),br}var yr,Yo;function wd(){if(Yo)return yr;Yo=1;const i=Zt();return yr=(t,n)=>i(t,n,!0),yr}var wr,Ko;function js(){if(Ko)return wr;Ko=1;const i=Ct();return wr=(t,n,a)=>{const r=new i(t,a),s=new i(n,a);return r.compare(s)||r.compareBuild(s)},wr}var vr,Xo;function vd(){if(Xo)return vr;Xo=1;const i=js();return vr=(t,n)=>t.sort((a,r)=>i(a,r,n)),vr}var xr,Zo;function xd(){if(Zo)return xr;Zo=1;const i=js();return xr=(t,n)=>t.sort((a,r)=>i(r,a,n)),xr}var _r,Qo;function Ua(){if(Qo)return _r;Qo=1;const i=Zt();return _r=(t,n,a)=>i(t,n,a)>0,_r}var Er,Jo;function $s(){if(Jo)return Er;Jo=1;const i=Zt();return Er=(t,n,a)=>i(t,n,a)<0,Er}var Cr,el;function Fc(){if(el)return Cr;el=1;const i=Zt();return Cr=(t,n,a)=>i(t,n,a)===0,Cr}var Ar,tl;function Ic(){if(tl)return Ar;tl=1;const i=Zt();return Ar=(t,n,a)=>i(t,n,a)!==0,Ar}var kr,il;function Ys(){if(il)return kr;il=1;const i=Zt();return kr=(t,n,a)=>i(t,n,a)>=0,kr}var Sr,nl;function Ks(){if(nl)return Sr;nl=1;const i=Zt();return Sr=(t,n,a)=>i(t,n,a)<=0,Sr}var Tr,al;function Rc(){if(al)return Tr;al=1;const i=Fc(),e=Ic(),t=Ua(),n=Ys(),a=$s(),r=Ks();return Tr=(o,l,u,f)=>{switch(l){case"===":return typeof o=="object"&&(o=o.version),typeof u=="object"&&(u=u.version),o===u;case"!==":return typeof o=="object"&&(o=o.version),typeof u=="object"&&(u=u.version),o!==u;case"":case"=":case"==":return i(o,u,f);case"!=":return e(o,u,f);case">":return t(o,u,f);case">=":return n(o,u,f);case"<":return a(o,u,f);case"<=":return r(o,u,f);default:throw new TypeError(`Invalid operator: ${l}`)}},Tr}var Mr,rl;function _d(){if(rl)return Mr;rl=1;const i=Ct(),e=gn(),{safeRe:t,t:n}=ta();return Mr=(r,s)=>{if(r instanceof i)return r;if(typeof r=="number"&&(r=String(r)),typeof r!="string")return null;s=s||{};let o=null;if(!s.rtl)o=r.match(s.includePrerelease?t[n.COERCEFULL]:t[n.COERCE]);else{const h=s.includePrerelease?t[n.COERCERTLFULL]:t[n.COERCERTL];let p;for(;(p=h.exec(r))&&(!o||o.index+o[0].length!==r.length);)(!o||p.index+p[0].length!==o.index+o[0].length)&&(o=p),h.lastIndex=p.index+p[1].length+p[2].length;h.lastIndex=-1}if(o===null)return null;const l=o[2],u=o[3]||"0",f=o[4]||"0",c=s.includePrerelease&&o[5]?`-${o[5]}`:"",d=s.includePrerelease&&o[6]?`+${o[6]}`:"";return e(`${l}.${u}.${f}${c}${d}`,s)},Mr}var Lr,sl;function Ed(){if(sl)return Lr;sl=1;class i{constructor(){this.max=1e3,this.map=new Map}get(t){const n=this.map.get(t);if(n!==void 0)return this.map.delete(t),this.map.set(t,n),n}delete(t){return this.map.delete(t)}set(t,n){if(!this.delete(t)&&n!==void 0){if(this.map.size>=this.max){const r=this.map.keys().next().value;this.delete(r)}this.map.set(t,n)}return this}}return Lr=i,Lr}var Dr,ol;function Qt(){if(ol)return Dr;ol=1;const i=/\s+/g;class e{constructor(S,$){if($=a($),S instanceof e)return S.loose===!!$.loose&&S.includePrerelease===!!$.includePrerelease?S:new e(S.raw,$);if(S instanceof r)return this.raw=S.value,this.set=[[S]],this.formatted=void 0,this;if(this.options=$,this.loose=!!$.loose,this.includePrerelease=!!$.includePrerelease,this.raw=S.trim().replace(i," "),this.set=this.raw.split("||").map(L=>this.parseRange(L.trim())).filter(L=>L.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const L=this.set[0];if(this.set=this.set.filter(W=>!m(W[0])),this.set.length===0)this.set=[L];else if(this.set.length>1){for(const W of this.set)if(W.length===1&&g(W[0])){this.set=[W];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let S=0;S<this.set.length;S++){S>0&&(this.formatted+="||");const $=this.set[S];for(let L=0;L<$.length;L++)L>0&&(this.formatted+=" "),this.formatted+=$[L].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(S){const L=((this.options.includePrerelease&&h)|(this.options.loose&&p))+":"+S,W=n.get(L);if(W)return W;const V=this.options.loose,J=V?l[u.HYPHENRANGELOOSE]:l[u.HYPHENRANGE];S=S.replace(J,M(this.options.includePrerelease)),s("hyphen replace",S),S=S.replace(l[u.COMPARATORTRIM],f),s("comparator trim",S),S=S.replace(l[u.TILDETRIM],c),s("tilde trim",S),S=S.replace(l[u.CARETTRIM],d),s("caret trim",S);let N=S.split(" ").map(ee=>x(ee,this.options)).join(" ").split(/\s+/).map(ee=>ae(ee,this.options));V&&(N=N.filter(ee=>(s("loose invalid filter",ee,this.options),!!ee.match(l[u.COMPARATORLOOSE])))),s("range list",N);const R=new Map,ne=N.map(ee=>new r(ee,this.options));for(const ee of ne){if(m(ee))return[ee];R.set(ee.value,ee)}R.size>1&&R.has("")&&R.delete("");const ie=[...R.values()];return n.set(L,ie),ie}intersects(S,$){if(!(S instanceof e))throw new TypeError("a Range is required");return this.set.some(L=>b(L,$)&&S.set.some(W=>b(W,$)&&L.every(V=>W.every(J=>V.intersects(J,$)))))}test(S){if(!S)return!1;if(typeof S=="string")try{S=new o(S,this.options)}catch{return!1}for(let $=0;$<this.set.length;$++)if(P(this.set[$],S,this.options))return!0;return!1}}Dr=e;const t=Ed(),n=new t,a=qs(),r=Wa(),s=Va(),o=Ct(),{safeRe:l,t:u,comparatorTrimReplace:f,tildeTrimReplace:c,caretTrimReplace:d}=ta(),{FLAG_INCLUDE_PRERELEASE:h,FLAG_LOOSE:p}=za(),m=v=>v.value==="<0.0.0-0",g=v=>v.value==="",b=(v,S)=>{let $=!0;const L=v.slice();let W=L.pop();for(;$&&L.length;)$=L.every(V=>W.intersects(V,S)),W=L.pop();return $},x=(v,S)=>(s("comp",v,S),v=B(v,S),s("caret",v),v=E(v,S),s("tildes",v),v=O(v,S),s("xrange",v),v=Y(v,S),s("stars",v),v),w=v=>!v||v.toLowerCase()==="x"||v==="*",E=(v,S)=>v.trim().split(/\s+/).map($=>C($,S)).join(" "),C=(v,S)=>{const $=S.loose?l[u.TILDELOOSE]:l[u.TILDE];return v.replace($,(L,W,V,J,N)=>{s("tilde",v,L,W,V,J,N);let R;return w(W)?R="":w(V)?R=`>=${W}.0.0 <${+W+1}.0.0-0`:w(J)?R=`>=${W}.${V}.0 <${W}.${+V+1}.0-0`:N?(s("replaceTilde pr",N),R=`>=${W}.${V}.${J}-${N} <${W}.${+V+1}.0-0`):R=`>=${W}.${V}.${J} <${W}.${+V+1}.0-0`,s("tilde return",R),R})},B=(v,S)=>v.trim().split(/\s+/).map($=>D($,S)).join(" "),D=(v,S)=>{s("caret",v,S);const $=S.loose?l[u.CARETLOOSE]:l[u.CARET],L=S.includePrerelease?"-0":"";return v.replace($,(W,V,J,N,R)=>{s("caret",v,W,V,J,N,R);let ne;return w(V)?ne="":w(J)?ne=`>=${V}.0.0${L} <${+V+1}.0.0-0`:w(N)?V==="0"?ne=`>=${V}.${J}.0${L} <${V}.${+J+1}.0-0`:ne=`>=${V}.${J}.0${L} <${+V+1}.0.0-0`:R?(s("replaceCaret pr",R),V==="0"?J==="0"?ne=`>=${V}.${J}.${N}-${R} <${V}.${J}.${+N+1}-0`:ne=`>=${V}.${J}.${N}-${R} <${V}.${+J+1}.0-0`:ne=`>=${V}.${J}.${N}-${R} <${+V+1}.0.0-0`):(s("no pr"),V==="0"?J==="0"?ne=`>=${V}.${J}.${N}${L} <${V}.${J}.${+N+1}-0`:ne=`>=${V}.${J}.${N}${L} <${V}.${+J+1}.0-0`:ne=`>=${V}.${J}.${N} <${+V+1}.0.0-0`),s("caret return",ne),ne})},O=(v,S)=>(s("replaceXRanges",v,S),v.split(/\s+/).map($=>H($,S)).join(" ")),H=(v,S)=>{v=v.trim();const $=S.loose?l[u.XRANGELOOSE]:l[u.XRANGE];return v.replace($,(L,W,V,J,N,R)=>{s("xRange",v,L,W,V,J,N,R);const ne=w(V),ie=ne||w(J),ee=ie||w(N),Te=ee;return W==="="&&Te&&(W=""),R=S.includePrerelease?"-0":"",ne?W===">"||W==="<"?L="<0.0.0-0":L="*":W&&Te?(ie&&(J=0),N=0,W===">"?(W=">=",ie?(V=+V+1,J=0,N=0):(J=+J+1,N=0)):W==="<="&&(W="<",ie?V=+V+1:J=+J+1),W==="<"&&(R="-0"),L=`${W+V}.${J}.${N}${R}`):ie?L=`>=${V}.0.0${R} <${+V+1}.0.0-0`:ee&&(L=`>=${V}.${J}.0${R} <${V}.${+J+1}.0-0`),s("xRange return",L),L})},Y=(v,S)=>(s("replaceStars",v,S),v.trim().replace(l[u.STAR],"")),ae=(v,S)=>(s("replaceGTE0",v,S),v.trim().replace(l[S.includePrerelease?u.GTE0PRE:u.GTE0],"")),M=v=>(S,$,L,W,V,J,N,R,ne,ie,ee,Te)=>(w(L)?$="":w(W)?$=`>=${L}.0.0${v?"-0":""}`:w(V)?$=`>=${L}.${W}.0${v?"-0":""}`:J?$=`>=${$}`:$=`>=${$}${v?"-0":""}`,w(ne)?R="":w(ie)?R=`<${+ne+1}.0.0-0`:w(ee)?R=`<${ne}.${+ie+1}.0-0`:Te?R=`<=${ne}.${ie}.${ee}-${Te}`:v?R=`<${ne}.${ie}.${+ee+1}-0`:R=`<=${R}`,`${$} ${R}`.trim()),P=(v,S,$)=>{for(let L=0;L<v.length;L++)if(!v[L].test(S))return!1;if(S.prerelease.length&&!$.includePrerelease){for(let L=0;L<v.length;L++)if(s(v[L].semver),v[L].semver!==r.ANY&&v[L].semver.prerelease.length>0){const W=v[L].semver;if(W.major===S.major&&W.minor===S.minor&&W.patch===S.patch)return!0}return!1}return!0};return Dr}var Br,ll;function Wa(){if(ll)return Br;ll=1;const i=Symbol("SemVer ANY");class e{static get ANY(){return i}constructor(f,c){if(c=t(c),f instanceof e){if(f.loose===!!c.loose)return f;f=f.value}f=f.trim().split(/\s+/).join(" "),s("comparator",f,c),this.options=c,this.loose=!!c.loose,this.parse(f),this.semver===i?this.value="":this.value=this.operator+this.semver.version,s("comp",this)}parse(f){const c=this.options.loose?n[a.COMPARATORLOOSE]:n[a.COMPARATOR],d=f.match(c);if(!d)throw new TypeError(`Invalid comparator: ${f}`);this.operator=d[1]!==void 0?d[1]:"",this.operator==="="&&(this.operator=""),d[2]?this.semver=new o(d[2],this.options.loose):this.semver=i}toString(){return this.value}test(f){if(s("Comparator.test",f,this.options.loose),this.semver===i||f===i)return!0;if(typeof f=="string")try{f=new o(f,this.options)}catch{return!1}return r(f,this.operator,this.semver,this.options)}intersects(f,c){if(!(f instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new l(f.value,c).test(this.value):f.operator===""?f.value===""?!0:new l(this.value,c).test(f.semver):(c=t(c),c.includePrerelease&&(this.value==="<0.0.0-0"||f.value==="<0.0.0-0")||!c.includePrerelease&&(this.value.startsWith("<0.0.0")||f.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&f.operator.startsWith(">")||this.operator.startsWith("<")&&f.operator.startsWith("<")||this.semver.version===f.semver.version&&this.operator.includes("=")&&f.operator.includes("=")||r(this.semver,"<",f.semver,c)&&this.operator.startsWith(">")&&f.operator.startsWith("<")||r(this.semver,">",f.semver,c)&&this.operator.startsWith("<")&&f.operator.startsWith(">")))}}Br=e;const t=qs(),{safeRe:n,t:a}=ta(),r=Rc(),s=Va(),o=Ct(),l=Qt();return Br}var Fr,cl;function Ga(){if(cl)return Fr;cl=1;const i=Qt();return Fr=(t,n,a)=>{try{n=new i(n,a)}catch{return!1}return n.test(t)},Fr}var Ir,ul;function Cd(){if(ul)return Ir;ul=1;const i=Qt();return Ir=(t,n)=>new i(t,n).set.map(a=>a.map(r=>r.value).join(" ").trim().split(" ")),Ir}var Rr,dl;function Ad(){if(dl)return Rr;dl=1;const i=Ct(),e=Qt();return Rr=(n,a,r)=>{let s=null,o=null,l=null;try{l=new e(a,r)}catch{return null}return n.forEach(u=>{l.test(u)&&(!s||o.compare(u)===-1)&&(s=u,o=new i(s,r))}),s},Rr}var Pr,hl;function kd(){if(hl)return Pr;hl=1;const i=Ct(),e=Qt();return Pr=(n,a,r)=>{let s=null,o=null,l=null;try{l=new e(a,r)}catch{return null}return n.forEach(u=>{l.test(u)&&(!s||o.compare(u)===1)&&(s=u,o=new i(s,r))}),s},Pr}var Or,fl;function Sd(){if(fl)return Or;fl=1;const i=Ct(),e=Qt(),t=Ua();return Or=(a,r)=>{a=new e(a,r);let s=new i("0.0.0");if(a.test(s)||(s=new i("0.0.0-0"),a.test(s)))return s;s=null;for(let o=0;o<a.set.length;++o){const l=a.set[o];let u=null;l.forEach(f=>{const c=new i(f.semver.version);switch(f.operator){case">":c.prerelease.length===0?c.patch++:c.prerelease.push(0),c.raw=c.format();case"":case">=":(!u||t(c,u))&&(u=c);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${f.operator}`)}}),u&&(!s||t(s,u))&&(s=u)}return s&&a.test(s)?s:null},Or}var Nr,pl;function Td(){if(pl)return Nr;pl=1;const i=Qt();return Nr=(t,n)=>{try{return new i(t,n).range||"*"}catch{return null}},Nr}var Hr,ml;function Xs(){if(ml)return Hr;ml=1;const i=Ct(),e=Wa(),{ANY:t}=e,n=Qt(),a=Ga(),r=Ua(),s=$s(),o=Ks(),l=Ys();return Hr=(f,c,d,h)=>{f=new i(f,h),c=new n(c,h);let p,m,g,b,x;switch(d){case">":p=r,m=o,g=s,b=">",x=">=";break;case"<":p=s,m=l,g=r,b="<",x="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(a(f,c,h))return!1;for(let w=0;w<c.set.length;++w){const E=c.set[w];let C=null,B=null;if(E.forEach(D=>{D.semver===t&&(D=new e(">=0.0.0")),C=C||D,B=B||D,p(D.semver,C.semver,h)?C=D:g(D.semver,B.semver,h)&&(B=D)}),C.operator===b||C.operator===x||(!B.operator||B.operator===b)&&m(f,B.semver))return!1;if(B.operator===x&&g(f,B.semver))return!1}return!0},Hr}var zr,gl;function Md(){if(gl)return zr;gl=1;const i=Xs();return zr=(t,n,a)=>i(t,n,">",a),zr}var Vr,bl;function Ld(){if(bl)return Vr;bl=1;const i=Xs();return Vr=(t,n,a)=>i(t,n,"<",a),Vr}var Ur,yl;function Dd(){if(yl)return Ur;yl=1;const i=Qt();return Ur=(t,n,a)=>(t=new i(t,a),n=new i(n,a),t.intersects(n,a)),Ur}var Wr,wl;function Bd(){if(wl)return Wr;wl=1;const i=Ga(),e=Zt();return Wr=(t,n,a)=>{const r=[];let s=null,o=null;const l=t.sort((d,h)=>e(d,h,a));for(const d of l)i(d,n,a)?(o=d,s||(s=d)):(o&&r.push([s,o]),o=null,s=null);s&&r.push([s,null]);const u=[];for(const[d,h]of r)d===h?u.push(d):!h&&d===l[0]?u.push("*"):h?d===l[0]?u.push(`<=${h}`):u.push(`${d} - ${h}`):u.push(`>=${d}`);const f=u.join(" || "),c=typeof n.raw=="string"?n.raw:String(n);return f.length<c.length?f:n},Wr}var Gr,vl;function Fd(){if(vl)return Gr;vl=1;const i=Qt(),e=Wa(),{ANY:t}=e,n=Ga(),a=Zt(),r=(c,d,h={})=>{if(c===d)return!0;c=new i(c,h),d=new i(d,h);let p=!1;e:for(const m of c.set){for(const g of d.set){const b=l(m,g,h);if(p=p||b!==null,b)continue e}if(p)return!1}return!0},s=[new e(">=0.0.0-0")],o=[new e(">=0.0.0")],l=(c,d,h)=>{if(c===d)return!0;if(c.length===1&&c[0].semver===t){if(d.length===1&&d[0].semver===t)return!0;h.includePrerelease?c=s:c=o}if(d.length===1&&d[0].semver===t){if(h.includePrerelease)return!0;d=o}const p=new Set;let m,g;for(const O of c)O.operator===">"||O.operator===">="?m=u(m,O,h):O.operator==="<"||O.operator==="<="?g=f(g,O,h):p.add(O.semver);if(p.size>1)return null;let b;if(m&&g){if(b=a(m.semver,g.semver,h),b>0)return null;if(b===0&&(m.operator!==">="||g.operator!=="<="))return null}for(const O of p){if(m&&!n(O,String(m),h)||g&&!n(O,String(g),h))return null;for(const H of d)if(!n(O,String(H),h))return!1;return!0}let x,w,E,C,B=g&&!h.includePrerelease&&g.semver.prerelease.length?g.semver:!1,D=m&&!h.includePrerelease&&m.semver.prerelease.length?m.semver:!1;B&&B.prerelease.length===1&&g.operator==="<"&&B.prerelease[0]===0&&(B=!1);for(const O of d){if(C=C||O.operator===">"||O.operator===">=",E=E||O.operator==="<"||O.operator==="<=",m){if(D&&O.semver.prerelease&&O.semver.prerelease.length&&O.semver.major===D.major&&O.semver.minor===D.minor&&O.semver.patch===D.patch&&(D=!1),O.operator===">"||O.operator===">="){if(x=u(m,O,h),x===O&&x!==m)return!1}else if(m.operator===">="&&!n(m.semver,String(O),h))return!1}if(g){if(B&&O.semver.prerelease&&O.semver.prerelease.length&&O.semver.major===B.major&&O.semver.minor===B.minor&&O.semver.patch===B.patch&&(B=!1),O.operator==="<"||O.operator==="<="){if(w=f(g,O,h),w===O&&w!==g)return!1}else if(g.operator==="<="&&!n(g.semver,String(O),h))return!1}if(!O.operator&&(g||m)&&b!==0)return!1}return!(m&&E&&!g&&b!==0||g&&C&&!m&&b!==0||D||B)},u=(c,d,h)=>{if(!c)return d;const p=a(c.semver,d.semver,h);return p>0?c:p<0||d.operator===">"&&c.operator===">="?d:c},f=(c,d,h)=>{if(!c)return d;const p=a(c.semver,d.semver,h);return p<0?c:p>0||d.operator==="<"&&c.operator==="<="?d:c};return Gr=r,Gr}var qr,xl;function Id(){if(xl)return qr;xl=1;const i=ta(),e=za(),t=Ct(),n=Bc(),a=gn(),r=ud(),s=dd(),o=hd(),l=fd(),u=pd(),f=md(),c=gd(),d=bd(),h=Zt(),p=yd(),m=wd(),g=js(),b=vd(),x=xd(),w=Ua(),E=$s(),C=Fc(),B=Ic(),D=Ys(),O=Ks(),H=Rc(),Y=_d(),ae=Wa(),M=Qt(),P=Ga(),v=Cd(),S=Ad(),$=kd(),L=Sd(),W=Td(),V=Xs(),J=Md(),N=Ld(),R=Dd(),ne=Bd(),ie=Fd();return qr={parse:a,valid:r,clean:s,inc:o,diff:l,major:u,minor:f,patch:c,prerelease:d,compare:h,rcompare:p,compareLoose:m,compareBuild:g,sort:b,rsort:x,gt:w,lt:E,eq:C,neq:B,gte:D,lte:O,cmp:H,coerce:Y,Comparator:ae,Range:M,satisfies:P,toComparators:v,maxSatisfying:S,minSatisfying:$,minVersion:L,validRange:W,outside:V,gtr:J,ltr:N,intersects:R,simplifyRange:ne,subset:ie,SemVer:t,re:i.re,src:i.src,tokens:i.t,SEMVER_SPEC_VERSION:e.SEMVER_SPEC_VERSION,RELEASE_TYPES:e.RELEASE_TYPES,compareIdentifiers:n.compareIdentifiers,rcompareIdentifiers:n.rcompareIdentifiers},qr}var Rd=Id();const _l=Jn(Rd),Pd="modulepreload",Od=function(i){return"/smeditor/"+i},El={},Ge=function(e,t,n){let a=Promise.resolve();if(t&&t.length>0){let s=function(u){return Promise.all(u.map(f=>Promise.resolve(f).then(c=>({status:"fulfilled",value:c}),c=>({status:"rejected",reason:c}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=o?.nonce||o?.getAttribute("nonce");a=s(t.map(u=>{if(u=Od(u),u in El)return;El[u]=!0;const f=u.endsWith(".css"),c=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${c}`))return;const d=document.createElement("link");if(d.rel=f?"stylesheet":Pd,f||(d.as="script"),d.crossOrigin="",d.href=u,l&&d.setAttribute("nonce",l),document.head.appendChild(d),f)return new Promise((h,p)=>{d.addEventListener("load",h),d.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${u}`)))})}))}function r(s){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s}return a.then(s=>{for(const o of s||[])o.status==="rejected"&&r(o.reason);return e().catch(r)})};function Nd(i={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:n,onRegistered:a,onRegisteredSW:r,onRegisterError:s}=i;let o,l;const u=async(c=!0)=>{await l};async function f(){if("serviceWorker"in navigator){if(o=await Ge(async()=>{const{Workbox:c}=await import("./workbox-window.prod.es5-B9K5rw8f.js");return{Workbox:c}},[]).then(({Workbox:c})=>new c("/smeditor/sw.js",{scope:"/smeditor/",type:"classic"})).catch(c=>{s?.(c)}),!o)return;o.addEventListener("activated",c=>{(c.isUpdate||c.isExternal)&&window.location.reload()}),o.addEventListener("installed",c=>{c.isUpdate||n?.()}),o.register({immediate:e}).then(c=>{r?r("/smeditor/sw.js",c):a?.(c)}).catch(c=>{s?.(c)})}}return l=f(),u}var jr={exports:{}},Cl;function Hd(){return Cl||(Cl=1,function(i){(function(){function e(A,I,te){return A.call.apply(A.bind,arguments)}function t(A,I,te){if(!A)throw Error();if(2<arguments.length){var Z=Array.prototype.slice.call(arguments,2);return function(){var se=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(se,Z),A.apply(I,se)}}return function(){return A.apply(I,arguments)}}function n(A,I,te){return n=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?e:t,n.apply(null,arguments)}var a=Date.now||function(){return+new Date};function r(A,I){this.a=A,this.o=I||A,this.c=this.o.document}var s=!!window.FontFace;function o(A,I,te,Z){if(I=A.c.createElement(I),te)for(var se in te)te.hasOwnProperty(se)&&(se=="style"?I.style.cssText=te[se]:I.setAttribute(se,te[se]));return Z&&I.appendChild(A.c.createTextNode(Z)),I}function l(A,I,te){A=A.c.getElementsByTagName(I)[0],A||(A=document.documentElement),A.insertBefore(te,A.lastChild)}function u(A){A.parentNode&&A.parentNode.removeChild(A)}function f(A,I,te){I=I||[],te=te||[];for(var Z=A.className.split(/\s+/),se=0;se<I.length;se+=1){for(var pe=!1,we=0;we<Z.length;we+=1)if(I[se]===Z[we]){pe=!0;break}pe||Z.push(I[se])}for(I=[],se=0;se<Z.length;se+=1){for(pe=!1,we=0;we<te.length;we+=1)if(Z[se]===te[we]){pe=!0;break}pe||I.push(Z[se])}A.className=I.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function c(A,I){for(var te=A.className.split(/\s+/),Z=0,se=te.length;Z<se;Z++)if(te[Z]==I)return!0;return!1}function d(A){return A.o.location.hostname||A.a.location.hostname}function h(A,I,te){function Z(){Pe&&se&&pe&&(Pe(we),Pe=null)}I=o(A,"link",{rel:"stylesheet",href:I,media:"all"});var se=!1,pe=!0,we=null,Pe=te||null;s?(I.onload=function(){se=!0,Z()},I.onerror=function(){se=!0,we=Error("Stylesheet failed to load"),Z()}):setTimeout(function(){se=!0,Z()},0),l(A,"head",I)}function p(A,I,te,Z){var se=A.c.getElementsByTagName("head")[0];if(se){var pe=o(A,"script",{src:I}),we=!1;return pe.onload=pe.onreadystatechange=function(){we||this.readyState&&this.readyState!="loaded"&&this.readyState!="complete"||(we=!0,te&&te(null),pe.onload=pe.onreadystatechange=null,pe.parentNode.tagName=="HEAD"&&se.removeChild(pe))},se.appendChild(pe),setTimeout(function(){we||(we=!0,te&&te(Error("Script load timeout")))},Z||5e3),pe}return null}function m(){this.a=0,this.c=null}function g(A){return A.a++,function(){A.a--,x(A)}}function b(A,I){A.c=I,x(A)}function x(A){A.a==0&&A.c&&(A.c(),A.c=null)}function w(A){this.a=A||"-"}w.prototype.c=function(A){for(var I=[],te=0;te<arguments.length;te++)I.push(arguments[te].replace(/[\W_]+/g,"").toLowerCase());return I.join(this.a)};function E(A,I){this.c=A,this.f=4,this.a="n";var te=(I||"n4").match(/^([nio])([1-9])$/i);te&&(this.a=te[1],this.f=parseInt(te[2],10))}function C(A){return O(A)+" "+(A.f+"00")+" 300px "+B(A.c)}function B(A){var I=[];A=A.split(/,\s*/);for(var te=0;te<A.length;te++){var Z=A[te].replace(/['"]/g,"");Z.indexOf(" ")!=-1||/^\d/.test(Z)?I.push("'"+Z+"'"):I.push(Z)}return I.join(",")}function D(A){return A.a+A.f}function O(A){var I="normal";return A.a==="o"?I="oblique":A.a==="i"&&(I="italic"),I}function H(A){var I=4,te="n",Z=null;return A&&((Z=A.match(/(normal|oblique|italic)/i))&&Z[1]&&(te=Z[1].substr(0,1).toLowerCase()),(Z=A.match(/([1-9]00|normal|bold)/i))&&Z[1]&&(/bold/i.test(Z[1])?I=7:/[1-9]00/.test(Z[1])&&(I=parseInt(Z[1].substr(0,1),10)))),te+I}function Y(A,I){this.c=A,this.f=A.o.document.documentElement,this.h=I,this.a=new w("-"),this.j=I.events!==!1,this.g=I.classes!==!1}function ae(A){A.g&&f(A.f,[A.a.c("wf","loading")]),P(A,"loading")}function M(A){if(A.g){var I=c(A.f,A.a.c("wf","active")),te=[],Z=[A.a.c("wf","loading")];I||te.push(A.a.c("wf","inactive")),f(A.f,te,Z)}P(A,"inactive")}function P(A,I,te){A.j&&A.h[I]&&(te?A.h[I](te.c,D(te)):A.h[I]())}function v(){this.c={}}function S(A,I,te){var Z=[],se;for(se in I)if(I.hasOwnProperty(se)){var pe=A.c[se];pe&&Z.push(pe(I[se],te))}return Z}function $(A,I){this.c=A,this.f=I,this.a=o(this.c,"span",{"aria-hidden":"true"},this.f)}function L(A){l(A.c,"body",A.a)}function W(A){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+B(A.c)+";"+("font-style:"+O(A)+";font-weight:"+(A.f+"00")+";")}function V(A,I,te,Z,se,pe){this.g=A,this.j=I,this.a=Z,this.c=te,this.f=se||3e3,this.h=pe||void 0}V.prototype.start=function(){var A=this.c.o.document,I=this,te=a(),Z=new Promise(function(we,Pe){function He(){a()-te>=I.f?Pe():A.fonts.load(C(I.a),I.h).then(function(Qe){1<=Qe.length?we():setTimeout(He,25)},function(){Pe()})}He()}),se=null,pe=new Promise(function(we,Pe){se=setTimeout(Pe,I.f)});Promise.race([pe,Z]).then(function(){se&&(clearTimeout(se),se=null),I.g(I.a)},function(){I.j(I.a)})};function J(A,I,te,Z,se,pe,we){this.v=A,this.B=I,this.c=te,this.a=Z,this.s=we||"BESbswy",this.f={},this.w=se||3e3,this.u=pe||null,this.m=this.j=this.h=this.g=null,this.g=new $(this.c,this.s),this.h=new $(this.c,this.s),this.j=new $(this.c,this.s),this.m=new $(this.c,this.s),A=new E(this.a.c+",serif",D(this.a)),A=W(A),this.g.a.style.cssText=A,A=new E(this.a.c+",sans-serif",D(this.a)),A=W(A),this.h.a.style.cssText=A,A=new E("serif",D(this.a)),A=W(A),this.j.a.style.cssText=A,A=new E("sans-serif",D(this.a)),A=W(A),this.m.a.style.cssText=A,L(this.g),L(this.h),L(this.j),L(this.m)}var N={D:"serif",C:"sans-serif"},R=null;function ne(){if(R===null){var A=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);R=!!A&&(536>parseInt(A[1],10)||parseInt(A[1],10)===536&&11>=parseInt(A[2],10))}return R}J.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=a(),ee(this)};function ie(A,I,te){for(var Z in N)if(N.hasOwnProperty(Z)&&I===A.f[N[Z]]&&te===A.f[N[Z]])return!0;return!1}function ee(A){var I=A.g.a.offsetWidth,te=A.h.a.offsetWidth,Z;(Z=I===A.f.serif&&te===A.f["sans-serif"])||(Z=ne()&&ie(A,I,te)),Z?a()-A.A>=A.w?ne()&&ie(A,I,te)&&(A.u===null||A.u.hasOwnProperty(A.a.c))?Ne(A,A.v):Ne(A,A.B):Te(A):Ne(A,A.v)}function Te(A){setTimeout(n(function(){ee(this)},A),50)}function Ne(A,I){setTimeout(n(function(){u(this.g.a),u(this.h.a),u(this.j.a),u(this.m.a),I(this.a)},A),0)}function ve(A,I,te){this.c=A,this.a=I,this.f=0,this.m=this.j=!1,this.s=te}var be=null;ve.prototype.g=function(A){var I=this.a;I.g&&f(I.f,[I.a.c("wf",A.c,D(A).toString(),"active")],[I.a.c("wf",A.c,D(A).toString(),"loading"),I.a.c("wf",A.c,D(A).toString(),"inactive")]),P(I,"fontactive",A),this.m=!0,Le(this)},ve.prototype.h=function(A){var I=this.a;if(I.g){var te=c(I.f,I.a.c("wf",A.c,D(A).toString(),"active")),Z=[],se=[I.a.c("wf",A.c,D(A).toString(),"loading")];te||Z.push(I.a.c("wf",A.c,D(A).toString(),"inactive")),f(I.f,Z,se)}P(I,"fontinactive",A),Le(this)};function Le(A){--A.f==0&&A.j&&(A.m?(A=A.a,A.g&&f(A.f,[A.a.c("wf","active")],[A.a.c("wf","loading"),A.a.c("wf","inactive")]),P(A,"active")):M(A.a))}function Be(A){this.j=A,this.a=new v,this.h=0,this.f=this.g=!0}Be.prototype.load=function(A){this.c=new r(this.j,A.context||this.j),this.g=A.events!==!1,this.f=A.classes!==!1,rt(this,new Y(this.c,A),A)};function at(A,I,te,Z,se){var pe=--A.h==0;(A.f||A.g)&&setTimeout(function(){var we=se||null,Pe=Z||null||{};if(te.length===0&&pe)M(I.a);else{I.f+=te.length,pe&&(I.j=pe);var He,Qe=[];for(He=0;He<te.length;He++){var je=te[He],lt=Pe[je.c],Gt=I.a,Qi=je;if(Gt.g&&f(Gt.f,[Gt.a.c("wf",Qi.c,D(Qi).toString(),"loading")]),P(Gt,"fontloading",Qi),Gt=null,be===null)if(window.FontFace){var Qi=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),$u=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);be=Qi?42<parseInt(Qi[1],10):!$u}else be=!1;be?Gt=new V(n(I.g,I),n(I.h,I),I.c,je,I.s,lt):Gt=new J(n(I.g,I),n(I.h,I),I.c,je,I.s,we,lt),Qe.push(Gt)}for(He=0;He<Qe.length;He++)Qe[He].start()}},0)}function rt(A,I,te){var se=[],Z=te.timeout;ae(I);var se=S(A.a,te,A.c),pe=new ve(A.c,I,Z);for(A.h=se.length,I=0,te=se.length;I<te;I++)se[I].load(function(we,Pe,He){at(A,pe,we,Pe,He)})}function _(A,I){this.c=A,this.a=I}_.prototype.load=function(A){function I(){if(pe["__mti_fntLst"+Z]){var we=pe["__mti_fntLst"+Z](),Pe=[],He;if(we)for(var Qe=0;Qe<we.length;Qe++){var je=we[Qe].fontfamily;we[Qe].fontStyle!=null&&we[Qe].fontWeight!=null?(He=we[Qe].fontStyle+we[Qe].fontWeight,Pe.push(new E(je,He))):Pe.push(new E(je))}A(Pe)}else setTimeout(function(){I()},50)}var te=this,Z=te.a.projectId,se=te.a.version;if(Z){var pe=te.c.o;p(this.c,(te.a.api||"https://fast.fonts.net/jsapi")+"/"+Z+".js"+(se?"?v="+se:""),function(we){we?A([]):(pe["__MonotypeConfiguration__"+Z]=function(){return te.a},I())}).id="__MonotypeAPIScript__"+Z}else A([])};function X(A,I){this.c=A,this.a=I}X.prototype.load=function(A){var I,te,Z=this.a.urls||[],se=this.a.families||[],pe=this.a.testStrings||{},we=new m;for(I=0,te=Z.length;I<te;I++)h(this.c,Z[I],g(we));var Pe=[];for(I=0,te=se.length;I<te;I++)if(Z=se[I].split(":"),Z[1])for(var He=Z[1].split(","),Qe=0;Qe<He.length;Qe+=1)Pe.push(new E(Z[0],He[Qe]));else Pe.push(new E(Z[0]));b(we,function(){A(Pe,pe)})};function G(A,I){A?this.c=A:this.c=T,this.a=[],this.f=[],this.g=I||""}var T="https://fonts.googleapis.com/css";function k(A,I){for(var te=I.length,Z=0;Z<te;Z++){var se=I[Z].split(":");se.length==3&&A.f.push(se.pop());var pe="";se.length==2&&se[1]!=""&&(pe=":"),A.a.push(se.join(pe))}}function z(A){if(A.a.length==0)throw Error("No fonts to load!");if(A.c.indexOf("kit=")!=-1)return A.c;for(var I=A.a.length,te=[],Z=0;Z<I;Z++)te.push(A.a[Z].replace(/ /g,"+"));return I=A.c+"?family="+te.join("%7C"),0<A.f.length&&(I+="&subset="+A.f.join(",")),0<A.g.length&&(I+="&text="+encodeURIComponent(A.g)),I}function j(A){this.f=A,this.a=[],this.c={}}var Q={latin:"BESbswy","latin-ext":"çöüğş",cyrillic:"йяЖ",greek:"αβΣ",khmer:"កខគ",Hanuman:"កខគ"},U={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},oe={i:"i",italic:"i",n:"n",normal:"n"},ce=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function le(A){for(var I=A.f.length,te=0;te<I;te++){var Z=A.f[te].split(":"),se=Z[0].replace(/\+/g," "),pe=["n4"];if(2<=Z.length){var we,Pe=Z[1];if(we=[],Pe)for(var Pe=Pe.split(","),He=Pe.length,Qe=0;Qe<He;Qe++){var je;if(je=Pe[Qe],je.match(/^[\w-]+$/)){var lt=ce.exec(je.toLowerCase());if(lt==null)je="";else{if(je=lt[2],je=je==null||je==""?"n":oe[je],lt=lt[1],lt==null||lt=="")lt="4";else var Gt=U[lt],lt=Gt||(isNaN(lt)?"4":lt.substr(0,1));je=[je,lt].join("")}}else je="";je&&we.push(je)}0<we.length&&(pe=we),Z.length==3&&(Z=Z[2],we=[],Z=Z?Z.split(","):we,0<Z.length&&(Z=Q[Z[0]])&&(A.c[se]=Z))}for(A.c[se]||(Z=Q[se])&&(A.c[se]=Z),Z=0;Z<pe.length;Z+=1)A.a.push(new E(se,pe[Z]))}}function ge(A,I){this.c=A,this.a=I}var qe={Arimo:!0,Cousine:!0,Tinos:!0};ge.prototype.load=function(A){var I=new m,te=this.c,Z=new G(this.a.api,this.a.text),se=this.a.families;k(Z,se);var pe=new j(se);le(pe),h(te,z(Z),g(I)),b(I,function(){A(pe.a,pe.c,qe)})};function De(A,I){this.c=A,this.a=I}De.prototype.load=function(A){var I=this.a.id,te=this.c.o;I?p(this.c,(this.a.api||"https://use.typekit.net")+"/"+I+".js",function(Z){if(Z)A([]);else if(te.Typekit&&te.Typekit.config&&te.Typekit.config.fn){Z=te.Typekit.config.fn;for(var se=[],pe=0;pe<Z.length;pe+=2)for(var we=Z[pe],Pe=Z[pe+1],He=0;He<Pe.length;He++)se.push(new E(we,Pe[He]));try{te.Typekit.load({events:!1,classes:!1,async:!0})}catch{}A(se)}},2e3):A([])};function xt(A,I){this.c=A,this.f=I,this.a=[]}xt.prototype.load=function(A){var I=this.f.id,te=this.c.o,Z=this;I?(te.__webfontfontdeckmodule__||(te.__webfontfontdeckmodule__={}),te.__webfontfontdeckmodule__[I]=function(se,pe){for(var we=0,Pe=pe.fonts.length;we<Pe;++we){var He=pe.fonts[we];Z.a.push(new E(He.name,H("font-weight:"+He.weight+";font-style:"+He.style)))}A(Z.a)},p(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+d(this.c)+"/"+I+".js",function(se){se&&A([])})):A([])};var At=new Be(window);At.a.c.custom=function(A,I){return new X(I,A)},At.a.c.fontdeck=function(A,I){return new xt(I,A)},At.a.c.monotype=function(A,I){return new _(I,A)},At.a.c.typekit=function(A,I){return new De(I,A)},At.a.c.google=function(A,I){return new ge(I,A)};var Lt={load:n(At.load,At)};i.exports?i.exports=Lt:(window.WebFont=Lt,window.WebFontConfig&&At.load(window.WebFontConfig))})()}(jr)),jr.exports}var zd=Hd();const Vd=Jn(zd),Mn={INVALID:["seeking position failed.","InvalidStateError"],GONE:["A requested file or directory could not be found at the time an operation was processed.","NotFoundError"],MISMATCH:["The path supplied exists, but was not an entry of requested type.","TypeMismatchError"],MOD_ERR:["The object can not be modified in this way.","InvalidModificationError"],SYNTAX:i=>[`Failed to execute 'write' on 'UnderlyingSinkBase': Invalid params passed. ${i}`,"SyntaxError"],DISALLOWED:["The request is not allowed by the user agent or the platform in the current context.","NotAllowedError"]},Ud=i=>typeof i=="object"&&typeof i.type<"u";async function Wd(i){var e,t,n;const{FolderHandle:a,FileHandle:r}=await Ge(async()=>{const{FolderHandle:u,FileHandle:f}=await import("./memory-BIfFwPK3.js");return{FolderHandle:u,FileHandle:f}},__vite__mapDeps([0,1,2])),{FileSystemDirectoryHandle:s}=await Ge(async()=>{const{FileSystemDirectoryHandle:u}=await Promise.resolve().then(()=>N0);return{FileSystemDirectoryHandle:u}},void 0),o=(t=(e=i[0].webkitRelativePath)===null||e===void 0?void 0:e.split("/",1)[0])!==null&&t!==void 0?t:"",l=new a(o,!1);for(let u=0;u<i.length;u++){const f=i[u],c=!((n=f.webkitRelativePath)===null||n===void 0)&&n.length?f.webkitRelativePath.split("/"):["",f.name];c.shift();const d=c.pop(),h=c.reduce((p,m)=>(p._entries[m]||(p._entries[m]=new a(m,!1)),p._entries[m]),l);h._entries[d]=new r(f.name,f,!1)}return new s(l)}async function Gd(i){const{FileHandle:e}=await Ge(async()=>{const{FileHandle:a}=await import("./memory-BIfFwPK3.js");return{FileHandle:a}},__vite__mapDeps([0,1,2])),{FileSystemFileHandle:t}=await Ge(async()=>{const{FileSystemFileHandle:a}=await Promise.resolve().then(()=>Mu);return{FileSystemFileHandle:a}},void 0);return Array.from(i).map(a=>new t(new e(a.name,a,!1)))}const Pc=Object.freeze(Object.defineProperty({__proto__:null,errors:Mn,isChunkObject:Ud,makeDirHandleFromFileList:Wd,makeFileHandlesFromFileList:Gd},Symbol.toStringTag,{value:"Module"}));var $r={};/*! howler.js v2.2.4 | (c) 2013-2020, James Simpson of GoldFire Studios | MIT License | howlerjs.com */var Al;function qd(){return Al||(Al=1,function(i){(function(){var e=function(){this.init()};e.prototype={init:function(){var c=this||t;return c._counter=1e3,c._html5AudioPool=[],c.html5PoolSize=10,c._codecs={},c._howls=[],c._muted=!1,c._volume=1,c._canPlayEvent="canplaythrough",c._navigator=typeof window<"u"&&window.navigator?window.navigator:null,c.masterGain=null,c.noAudio=!1,c.usingWebAudio=!0,c.autoSuspend=!0,c.ctx=null,c.autoUnlock=!0,c._setup(),c},volume:function(c){var d=this||t;if(c=parseFloat(c),d.ctx||f(),c!==void 0&&c>=0&&c<=1){if(d._volume=c,d._muted)return d;d.usingWebAudio&&d.masterGain.gain.setValueAtTime(c,t.ctx.currentTime);for(var h=0;h<d._howls.length;h++)if(!d._howls[h]._webAudio)for(var p=d._howls[h]._getSoundIds(),m=0;m<p.length;m++){var g=d._howls[h]._soundById(p[m]);g&&g._node&&(g._node.volume=g._volume*c)}return d}return d._volume},mute:function(c){var d=this||t;d.ctx||f(),d._muted=c,d.usingWebAudio&&d.masterGain.gain.setValueAtTime(c?0:d._volume,t.ctx.currentTime);for(var h=0;h<d._howls.length;h++)if(!d._howls[h]._webAudio)for(var p=d._howls[h]._getSoundIds(),m=0;m<p.length;m++){var g=d._howls[h]._soundById(p[m]);g&&g._node&&(g._node.muted=!!c||g._muted)}return d},stop:function(){for(var c=this||t,d=0;d<c._howls.length;d++)c._howls[d].stop();return c},unload:function(){for(var c=this||t,d=c._howls.length-1;d>=0;d--)c._howls[d].unload();return c.usingWebAudio&&c.ctx&&c.ctx.close!==void 0&&(c.ctx.close(),c.ctx=null,f()),c},codecs:function(c){return(this||t)._codecs[c.replace(/^x-/,"")]},_setup:function(){var c=this||t;if(c.state=c.ctx&&c.ctx.state||"suspended",c._autoSuspend(),!c.usingWebAudio)if(typeof Audio<"u")try{var d=new Audio;d.oncanplaythrough===void 0&&(c._canPlayEvent="canplay")}catch{c.noAudio=!0}else c.noAudio=!0;try{var d=new Audio;d.muted&&(c.noAudio=!0)}catch{}return c.noAudio||c._setupCodecs(),c},_setupCodecs:function(){var c=this||t,d=null;try{d=typeof Audio<"u"?new Audio:null}catch{return c}if(!d||typeof d.canPlayType!="function")return c;var h=d.canPlayType("audio/mpeg;").replace(/^no$/,""),p=c._navigator?c._navigator.userAgent:"",m=p.match(/OPR\/(\d+)/g),g=m&&parseInt(m[0].split("/")[1],10)<33,b=p.indexOf("Safari")!==-1&&p.indexOf("Chrome")===-1,x=p.match(/Version\/(.*?) /),w=b&&x&&parseInt(x[1],10)<15;return c._codecs={mp3:!(g||!h&&!d.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!h,opus:!!d.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(d.canPlayType('audio/wav; codecs="1"')||d.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!d.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!d.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(d.canPlayType("audio/x-m4a;")||d.canPlayType("audio/m4a;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(d.canPlayType("audio/x-m4b;")||d.canPlayType("audio/m4b;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(d.canPlayType("audio/x-mp4;")||d.canPlayType("audio/mp4;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(w||!d.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(w||!d.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!d.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(d.canPlayType("audio/x-flac;")||d.canPlayType("audio/flac;")).replace(/^no$/,"")},c},_unlockAudio:function(){var c=this||t;if(!c._audioUnlocked&&c.ctx){c._audioUnlocked=!1,c.autoUnlock=!1,c._mobileUnloaded||c.ctx.sampleRate===44100||(c._mobileUnloaded=!0,c.unload()),c._scratchBuffer=c.ctx.createBuffer(1,1,22050);var d=function(h){for(;c._html5AudioPool.length<c.html5PoolSize;)try{var p=new Audio;p._unlocked=!0,c._releaseHtml5Audio(p)}catch{c.noAudio=!0;break}for(var m=0;m<c._howls.length;m++)if(!c._howls[m]._webAudio)for(var g=c._howls[m]._getSoundIds(),b=0;b<g.length;b++){var x=c._howls[m]._soundById(g[b]);x&&x._node&&!x._node._unlocked&&(x._node._unlocked=!0,x._node.load())}c._autoResume();var w=c.ctx.createBufferSource();w.buffer=c._scratchBuffer,w.connect(c.ctx.destination),w.start===void 0?w.noteOn(0):w.start(0),typeof c.ctx.resume=="function"&&c.ctx.resume(),w.onended=function(){w.disconnect(0),c._audioUnlocked=!0,document.removeEventListener("touchstart",d,!0),document.removeEventListener("touchend",d,!0),document.removeEventListener("click",d,!0),document.removeEventListener("keydown",d,!0);for(var E=0;E<c._howls.length;E++)c._howls[E]._emit("unlock")}};return document.addEventListener("touchstart",d,!0),document.addEventListener("touchend",d,!0),document.addEventListener("click",d,!0),document.addEventListener("keydown",d,!0),c}},_obtainHtml5Audio:function(){var c=this||t;if(c._html5AudioPool.length)return c._html5AudioPool.pop();var d=new Audio().play();return d&&typeof Promise<"u"&&(d instanceof Promise||typeof d.then=="function")&&d.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(c){var d=this||t;return c._unlocked&&d._html5AudioPool.push(c),d},_autoSuspend:function(){var c=this;if(c.autoSuspend&&c.ctx&&c.ctx.suspend!==void 0&&t.usingWebAudio){for(var d=0;d<c._howls.length;d++)if(c._howls[d]._webAudio){for(var h=0;h<c._howls[d]._sounds.length;h++)if(!c._howls[d]._sounds[h]._paused)return c}return c._suspendTimer&&clearTimeout(c._suspendTimer),c._suspendTimer=setTimeout(function(){if(c.autoSuspend){c._suspendTimer=null,c.state="suspending";var p=function(){c.state="suspended",c._resumeAfterSuspend&&(delete c._resumeAfterSuspend,c._autoResume())};c.ctx.suspend().then(p,p)}},3e4),c}},_autoResume:function(){var c=this;if(c.ctx&&c.ctx.resume!==void 0&&t.usingWebAudio)return c.state==="running"&&c.ctx.state!=="interrupted"&&c._suspendTimer?(clearTimeout(c._suspendTimer),c._suspendTimer=null):c.state==="suspended"||c.state==="running"&&c.ctx.state==="interrupted"?(c.ctx.resume().then(function(){c.state="running";for(var d=0;d<c._howls.length;d++)c._howls[d]._emit("resume")}),c._suspendTimer&&(clearTimeout(c._suspendTimer),c._suspendTimer=null)):c.state==="suspending"&&(c._resumeAfterSuspend=!0),c}};var t=new e,n=function(c){var d=this;if(!c.src||c.src.length===0)return void console.error("An array of source files must be passed with any new Howl.");d.init(c)};n.prototype={init:function(c){var d=this;return t.ctx||f(),d._autoplay=c.autoplay||!1,d._format=typeof c.format!="string"?c.format:[c.format],d._html5=c.html5||!1,d._muted=c.mute||!1,d._loop=c.loop||!1,d._pool=c.pool||5,d._preload=typeof c.preload!="boolean"&&c.preload!=="metadata"||c.preload,d._rate=c.rate||1,d._sprite=c.sprite||{},d._src=typeof c.src!="string"?c.src:[c.src],d._volume=c.volume!==void 0?c.volume:1,d._xhr={method:c.xhr&&c.xhr.method?c.xhr.method:"GET",headers:c.xhr&&c.xhr.headers?c.xhr.headers:null,withCredentials:!(!c.xhr||!c.xhr.withCredentials)&&c.xhr.withCredentials},d._duration=0,d._state="unloaded",d._sounds=[],d._endTimers={},d._queue=[],d._playLock=!1,d._onend=c.onend?[{fn:c.onend}]:[],d._onfade=c.onfade?[{fn:c.onfade}]:[],d._onload=c.onload?[{fn:c.onload}]:[],d._onloaderror=c.onloaderror?[{fn:c.onloaderror}]:[],d._onplayerror=c.onplayerror?[{fn:c.onplayerror}]:[],d._onpause=c.onpause?[{fn:c.onpause}]:[],d._onplay=c.onplay?[{fn:c.onplay}]:[],d._onstop=c.onstop?[{fn:c.onstop}]:[],d._onmute=c.onmute?[{fn:c.onmute}]:[],d._onvolume=c.onvolume?[{fn:c.onvolume}]:[],d._onrate=c.onrate?[{fn:c.onrate}]:[],d._onseek=c.onseek?[{fn:c.onseek}]:[],d._onunlock=c.onunlock?[{fn:c.onunlock}]:[],d._onresume=[],d._webAudio=t.usingWebAudio&&!d._html5,t.ctx!==void 0&&t.ctx&&t.autoUnlock&&t._unlockAudio(),t._howls.push(d),d._autoplay&&d._queue.push({event:"play",action:function(){d.play()}}),d._preload&&d._preload!=="none"&&d.load(),d},load:function(){var c=this,d=null;if(t.noAudio)return void c._emit("loaderror",null,"No audio support.");typeof c._src=="string"&&(c._src=[c._src]);for(var h=0;h<c._src.length;h++){var p,m;if(c._format&&c._format[h])p=c._format[h];else{if(typeof(m=c._src[h])!="string"){c._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}p=/^data:audio\/([^;,]+);/i.exec(m),p||(p=/\.([^.]+)$/.exec(m.split("?",1)[0])),p&&(p=p[1].toLowerCase())}if(p||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),p&&t.codecs(p)){d=c._src[h];break}}return d?(c._src=d,c._state="loading",window.location.protocol==="https:"&&d.slice(0,5)==="http:"&&(c._html5=!0,c._webAudio=!1),new a(c),c._webAudio&&s(c),c):void c._emit("loaderror",null,"No codec support for selected audio sources.")},play:function(c,d){var h=this,p=null;if(typeof c=="number")p=c,c=null;else{if(typeof c=="string"&&h._state==="loaded"&&!h._sprite[c])return null;if(c===void 0&&(c="__default",!h._playLock)){for(var m=0,g=0;g<h._sounds.length;g++)h._sounds[g]._paused&&!h._sounds[g]._ended&&(m++,p=h._sounds[g]._id);m===1?c=null:p=null}}var b=p?h._soundById(p):h._inactiveSound();if(!b)return null;if(p&&!c&&(c=b._sprite||"__default"),h._state!=="loaded"){b._sprite=c,b._ended=!1;var x=b._id;return h._queue.push({event:"play",action:function(){h.play(x)}}),x}if(p&&!b._paused)return d||h._loadQueue("play"),b._id;h._webAudio&&t._autoResume();var w=Math.max(0,b._seek>0?b._seek:h._sprite[c][0]/1e3),E=Math.max(0,(h._sprite[c][0]+h._sprite[c][1])/1e3-w),C=1e3*E/Math.abs(b._rate),B=h._sprite[c][0]/1e3,D=(h._sprite[c][0]+h._sprite[c][1])/1e3;b._sprite=c,b._ended=!1;var O=function(){b._paused=!1,b._seek=w,b._start=B,b._stop=D,b._loop=!(!b._loop&&!h._sprite[c][2])};if(w>=D)return void h._ended(b);var H=b._node;if(h._webAudio){var Y=function(){h._playLock=!1,O(),h._refreshBuffer(b);var v=b._muted||h._muted?0:b._volume;H.gain.setValueAtTime(v,t.ctx.currentTime),b._playStart=t.ctx.currentTime,H.bufferSource.start===void 0?b._loop?H.bufferSource.noteGrainOn(0,w,86400):H.bufferSource.noteGrainOn(0,w,E):b._loop?H.bufferSource.start(0,w,86400):H.bufferSource.start(0,w,E),C!==1/0&&(h._endTimers[b._id]=setTimeout(h._ended.bind(h,b),C)),d||setTimeout(function(){h._emit("play",b._id),h._loadQueue()},0)};t.state==="running"&&t.ctx.state!=="interrupted"?Y():(h._playLock=!0,h.once("resume",Y),h._clearTimer(b._id))}else{var ae=function(){H.currentTime=w,H.muted=b._muted||h._muted||t._muted||H.muted,H.volume=b._volume*t.volume(),H.playbackRate=b._rate;try{var v=H.play();if(v&&typeof Promise<"u"&&(v instanceof Promise||typeof v.then=="function")?(h._playLock=!0,O(),v.then(function(){h._playLock=!1,H._unlocked=!0,d?h._loadQueue():h._emit("play",b._id)}).catch(function(){h._playLock=!1,h._emit("playerror",b._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),b._ended=!0,b._paused=!0})):d||(h._playLock=!1,O(),h._emit("play",b._id)),H.playbackRate=b._rate,H.paused)return void h._emit("playerror",b._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");c!=="__default"||b._loop?h._endTimers[b._id]=setTimeout(h._ended.bind(h,b),C):(h._endTimers[b._id]=function(){h._ended(b),H.removeEventListener("ended",h._endTimers[b._id],!1)},H.addEventListener("ended",h._endTimers[b._id],!1))}catch(S){h._emit("playerror",b._id,S)}};H.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(H.src=h._src,H.load());var M=window&&window.ejecta||!H.readyState&&t._navigator.isCocoonJS;if(H.readyState>=3||M)ae();else{h._playLock=!0,h._state="loading";var P=function(){h._state="loaded",ae(),H.removeEventListener(t._canPlayEvent,P,!1)};H.addEventListener(t._canPlayEvent,P,!1),h._clearTimer(b._id)}}return b._id},pause:function(c){var d=this;if(d._state!=="loaded"||d._playLock)return d._queue.push({event:"pause",action:function(){d.pause(c)}}),d;for(var h=d._getSoundIds(c),p=0;p<h.length;p++){d._clearTimer(h[p]);var m=d._soundById(h[p]);if(m&&!m._paused&&(m._seek=d.seek(h[p]),m._rateSeek=0,m._paused=!0,d._stopFade(h[p]),m._node))if(d._webAudio){if(!m._node.bufferSource)continue;m._node.bufferSource.stop===void 0?m._node.bufferSource.noteOff(0):m._node.bufferSource.stop(0),d._cleanBuffer(m._node)}else isNaN(m._node.duration)&&m._node.duration!==1/0||m._node.pause();arguments[1]||d._emit("pause",m?m._id:null)}return d},stop:function(c,d){var h=this;if(h._state!=="loaded"||h._playLock)return h._queue.push({event:"stop",action:function(){h.stop(c)}}),h;for(var p=h._getSoundIds(c),m=0;m<p.length;m++){h._clearTimer(p[m]);var g=h._soundById(p[m]);g&&(g._seek=g._start||0,g._rateSeek=0,g._paused=!0,g._ended=!0,h._stopFade(p[m]),g._node&&(h._webAudio?g._node.bufferSource&&(g._node.bufferSource.stop===void 0?g._node.bufferSource.noteOff(0):g._node.bufferSource.stop(0),h._cleanBuffer(g._node)):isNaN(g._node.duration)&&g._node.duration!==1/0||(g._node.currentTime=g._start||0,g._node.pause(),g._node.duration===1/0&&h._clearSound(g._node))),d||h._emit("stop",g._id))}return h},mute:function(c,d){var h=this;if(h._state!=="loaded"||h._playLock)return h._queue.push({event:"mute",action:function(){h.mute(c,d)}}),h;if(d===void 0){if(typeof c!="boolean")return h._muted;h._muted=c}for(var p=h._getSoundIds(d),m=0;m<p.length;m++){var g=h._soundById(p[m]);g&&(g._muted=c,g._interval&&h._stopFade(g._id),h._webAudio&&g._node?g._node.gain.setValueAtTime(c?0:g._volume,t.ctx.currentTime):g._node&&(g._node.muted=!!t._muted||c),h._emit("mute",g._id))}return h},volume:function(){var c,d,h=this,p=arguments;if(p.length===0)return h._volume;p.length===1||p.length===2&&p[1]===void 0?h._getSoundIds().indexOf(p[0])>=0?d=parseInt(p[0],10):c=parseFloat(p[0]):p.length>=2&&(c=parseFloat(p[0]),d=parseInt(p[1],10));var m;if(!(c!==void 0&&c>=0&&c<=1))return m=d?h._soundById(d):h._sounds[0],m?m._volume:0;if(h._state!=="loaded"||h._playLock)return h._queue.push({event:"volume",action:function(){h.volume.apply(h,p)}}),h;d===void 0&&(h._volume=c),d=h._getSoundIds(d);for(var g=0;g<d.length;g++)(m=h._soundById(d[g]))&&(m._volume=c,p[2]||h._stopFade(d[g]),h._webAudio&&m._node&&!m._muted?m._node.gain.setValueAtTime(c,t.ctx.currentTime):m._node&&!m._muted&&(m._node.volume=c*t.volume()),h._emit("volume",m._id));return h},fade:function(c,d,h,p){var m=this;if(m._state!=="loaded"||m._playLock)return m._queue.push({event:"fade",action:function(){m.fade(c,d,h,p)}}),m;c=Math.min(Math.max(0,parseFloat(c)),1),d=Math.min(Math.max(0,parseFloat(d)),1),h=parseFloat(h),m.volume(c,p);for(var g=m._getSoundIds(p),b=0;b<g.length;b++){var x=m._soundById(g[b]);if(x){if(p||m._stopFade(g[b]),m._webAudio&&!x._muted){var w=t.ctx.currentTime,E=w+h/1e3;x._volume=c,x._node.gain.setValueAtTime(c,w),x._node.gain.linearRampToValueAtTime(d,E)}m._startFadeInterval(x,c,d,h,g[b],p===void 0)}}return m},_startFadeInterval:function(c,d,h,p,m,g){var b=this,x=d,w=h-d,E=Math.abs(w/.01),C=Math.max(4,E>0?p/E:p),B=Date.now();c._fadeTo=h,c._interval=setInterval(function(){var D=(Date.now()-B)/p;B=Date.now(),x+=w*D,x=Math.round(100*x)/100,x=w<0?Math.max(h,x):Math.min(h,x),b._webAudio?c._volume=x:b.volume(x,c._id,!0),g&&(b._volume=x),(h<d&&x<=h||h>d&&x>=h)&&(clearInterval(c._interval),c._interval=null,c._fadeTo=null,b.volume(h,c._id),b._emit("fade",c._id))},C)},_stopFade:function(c){var d=this,h=d._soundById(c);return h&&h._interval&&(d._webAudio&&h._node.gain.cancelScheduledValues(t.ctx.currentTime),clearInterval(h._interval),h._interval=null,d.volume(h._fadeTo,c),h._fadeTo=null,d._emit("fade",c)),d},loop:function(){var c,d,h,p=this,m=arguments;if(m.length===0)return p._loop;if(m.length===1){if(typeof m[0]!="boolean")return!!(h=p._soundById(parseInt(m[0],10)))&&h._loop;c=m[0],p._loop=c}else m.length===2&&(c=m[0],d=parseInt(m[1],10));for(var g=p._getSoundIds(d),b=0;b<g.length;b++)(h=p._soundById(g[b]))&&(h._loop=c,p._webAudio&&h._node&&h._node.bufferSource&&(h._node.bufferSource.loop=c,c&&(h._node.bufferSource.loopStart=h._start||0,h._node.bufferSource.loopEnd=h._stop,p.playing(g[b])&&(p.pause(g[b],!0),p.play(g[b],!0)))));return p},rate:function(){var c,d,h=this,p=arguments;if(p.length===0)d=h._sounds[0]._id;else if(p.length===1){var m=h._getSoundIds(),g=m.indexOf(p[0]);g>=0?d=parseInt(p[0],10):c=parseFloat(p[0])}else p.length===2&&(c=parseFloat(p[0]),d=parseInt(p[1],10));var b;if(typeof c!="number")return b=h._soundById(d),b?b._rate:h._rate;if(h._state!=="loaded"||h._playLock)return h._queue.push({event:"rate",action:function(){h.rate.apply(h,p)}}),h;d===void 0&&(h._rate=c),d=h._getSoundIds(d);for(var x=0;x<d.length;x++)if(b=h._soundById(d[x])){h.playing(d[x])&&(b._rateSeek=h.seek(d[x]),b._playStart=h._webAudio?t.ctx.currentTime:b._playStart),b._rate=c,h._webAudio&&b._node&&b._node.bufferSource?b._node.bufferSource.playbackRate.setValueAtTime(c,t.ctx.currentTime):b._node&&(b._node.playbackRate=c);var w=h.seek(d[x]),E=(h._sprite[b._sprite][0]+h._sprite[b._sprite][1])/1e3-w,C=1e3*E/Math.abs(b._rate);!h._endTimers[d[x]]&&b._paused||(h._clearTimer(d[x]),h._endTimers[d[x]]=setTimeout(h._ended.bind(h,b),C)),h._emit("rate",b._id)}return h},seek:function(){var c,d,h=this,p=arguments;if(p.length===0)h._sounds.length&&(d=h._sounds[0]._id);else if(p.length===1){var m=h._getSoundIds(),g=m.indexOf(p[0]);g>=0?d=parseInt(p[0],10):h._sounds.length&&(d=h._sounds[0]._id,c=parseFloat(p[0]))}else p.length===2&&(c=parseFloat(p[0]),d=parseInt(p[1],10));if(d===void 0)return 0;if(typeof c=="number"&&(h._state!=="loaded"||h._playLock))return h._queue.push({event:"seek",action:function(){h.seek.apply(h,p)}}),h;var b=h._soundById(d);if(b){if(!(typeof c=="number"&&c>=0)){if(h._webAudio){var x=h.playing(d)?t.ctx.currentTime-b._playStart:0,w=b._rateSeek?b._rateSeek-b._seek:0;return b._seek+(w+x*Math.abs(b._rate))}return b._node.currentTime}var E=h.playing(d);E&&h.pause(d,!0),b._seek=c,b._ended=!1,h._clearTimer(d),h._webAudio||!b._node||isNaN(b._node.duration)||(b._node.currentTime=c);var C=function(){E&&h.play(d,!0),h._emit("seek",d)};if(E&&!h._webAudio){var B=function(){h._playLock?setTimeout(B,0):C()};setTimeout(B,0)}else C()}return h},playing:function(c){var d=this;if(typeof c=="number"){var h=d._soundById(c);return!!h&&!h._paused}for(var p=0;p<d._sounds.length;p++)if(!d._sounds[p]._paused)return!0;return!1},duration:function(c){var d=this,h=d._duration,p=d._soundById(c);return p&&(h=d._sprite[p._sprite][1]/1e3),h},state:function(){return this._state},unload:function(){for(var c=this,d=c._sounds,h=0;h<d.length;h++)d[h]._paused||c.stop(d[h]._id),c._webAudio||(c._clearSound(d[h]._node),d[h]._node.removeEventListener("error",d[h]._errorFn,!1),d[h]._node.removeEventListener(t._canPlayEvent,d[h]._loadFn,!1),d[h]._node.removeEventListener("ended",d[h]._endFn,!1),t._releaseHtml5Audio(d[h]._node)),delete d[h]._node,c._clearTimer(d[h]._id);var p=t._howls.indexOf(c);p>=0&&t._howls.splice(p,1);var m=!0;for(h=0;h<t._howls.length;h++)if(t._howls[h]._src===c._src||c._src.indexOf(t._howls[h]._src)>=0){m=!1;break}return r&&m&&delete r[c._src],t.noAudio=!1,c._state="unloaded",c._sounds=[],c=null,null},on:function(c,d,h,p){var m=this,g=m["_on"+c];return typeof d=="function"&&g.push(p?{id:h,fn:d,once:p}:{id:h,fn:d}),m},off:function(c,d,h){var p=this,m=p["_on"+c],g=0;if(typeof d=="number"&&(h=d,d=null),d||h)for(g=0;g<m.length;g++){var b=h===m[g].id;if(d===m[g].fn&&b||!d&&b){m.splice(g,1);break}}else if(c)p["_on"+c]=[];else{var x=Object.keys(p);for(g=0;g<x.length;g++)x[g].indexOf("_on")===0&&Array.isArray(p[x[g]])&&(p[x[g]]=[])}return p},once:function(c,d,h){var p=this;return p.on(c,d,h,1),p},_emit:function(c,d,h){for(var p=this,m=p["_on"+c],g=m.length-1;g>=0;g--)m[g].id&&m[g].id!==d&&c!=="load"||(setTimeout(function(b){b.call(this,d,h)}.bind(p,m[g].fn),0),m[g].once&&p.off(c,m[g].fn,m[g].id));return p._loadQueue(c),p},_loadQueue:function(c){var d=this;if(d._queue.length>0){var h=d._queue[0];h.event===c&&(d._queue.shift(),d._loadQueue()),c||h.action()}return d},_ended:function(c){var d=this,h=c._sprite;if(!d._webAudio&&c._node&&!c._node.paused&&!c._node.ended&&c._node.currentTime<c._stop)return setTimeout(d._ended.bind(d,c),100),d;var p=!(!c._loop&&!d._sprite[h][2]);if(d._emit("end",c._id),!d._webAudio&&p&&d.stop(c._id,!0).play(c._id),d._webAudio&&p){d._emit("play",c._id),c._seek=c._start||0,c._rateSeek=0,c._playStart=t.ctx.currentTime;var m=1e3*(c._stop-c._start)/Math.abs(c._rate);d._endTimers[c._id]=setTimeout(d._ended.bind(d,c),m)}return d._webAudio&&!p&&(c._paused=!0,c._ended=!0,c._seek=c._start||0,c._rateSeek=0,d._clearTimer(c._id),d._cleanBuffer(c._node),t._autoSuspend()),d._webAudio||p||d.stop(c._id,!0),d},_clearTimer:function(c){var d=this;if(d._endTimers[c]){if(typeof d._endTimers[c]!="function")clearTimeout(d._endTimers[c]);else{var h=d._soundById(c);h&&h._node&&h._node.removeEventListener("ended",d._endTimers[c],!1)}delete d._endTimers[c]}return d},_soundById:function(c){for(var d=this,h=0;h<d._sounds.length;h++)if(c===d._sounds[h]._id)return d._sounds[h];return null},_inactiveSound:function(){var c=this;c._drain();for(var d=0;d<c._sounds.length;d++)if(c._sounds[d]._ended)return c._sounds[d].reset();return new a(c)},_drain:function(){var c=this,d=c._pool,h=0,p=0;if(!(c._sounds.length<d)){for(p=0;p<c._sounds.length;p++)c._sounds[p]._ended&&h++;for(p=c._sounds.length-1;p>=0;p--){if(h<=d)return;c._sounds[p]._ended&&(c._webAudio&&c._sounds[p]._node&&c._sounds[p]._node.disconnect(0),c._sounds.splice(p,1),h--)}}},_getSoundIds:function(c){var d=this;if(c===void 0){for(var h=[],p=0;p<d._sounds.length;p++)h.push(d._sounds[p]._id);return h}return[c]},_refreshBuffer:function(c){var d=this;return c._node.bufferSource=t.ctx.createBufferSource(),c._node.bufferSource.buffer=r[d._src],c._panner?c._node.bufferSource.connect(c._panner):c._node.bufferSource.connect(c._node),c._node.bufferSource.loop=c._loop,c._loop&&(c._node.bufferSource.loopStart=c._start||0,c._node.bufferSource.loopEnd=c._stop||0),c._node.bufferSource.playbackRate.setValueAtTime(c._rate,t.ctx.currentTime),d},_cleanBuffer:function(c){var d=this,h=t._navigator&&t._navigator.vendor.indexOf("Apple")>=0;if(!c.bufferSource)return d;if(t._scratchBuffer&&c.bufferSource&&(c.bufferSource.onended=null,c.bufferSource.disconnect(0),h))try{c.bufferSource.buffer=t._scratchBuffer}catch{}return c.bufferSource=null,d},_clearSound:function(c){/MSIE |Trident\//.test(t._navigator&&t._navigator.userAgent)||(c.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var a=function(c){this._parent=c,this.init()};a.prototype={init:function(){var c=this,d=c._parent;return c._muted=d._muted,c._loop=d._loop,c._volume=d._volume,c._rate=d._rate,c._seek=0,c._paused=!0,c._ended=!0,c._sprite="__default",c._id=++t._counter,d._sounds.push(c),c.create(),c},create:function(){var c=this,d=c._parent,h=t._muted||c._muted||c._parent._muted?0:c._volume;return d._webAudio?(c._node=t.ctx.createGain===void 0?t.ctx.createGainNode():t.ctx.createGain(),c._node.gain.setValueAtTime(h,t.ctx.currentTime),c._node.paused=!0,c._node.connect(t.masterGain)):t.noAudio||(c._node=t._obtainHtml5Audio(),c._errorFn=c._errorListener.bind(c),c._node.addEventListener("error",c._errorFn,!1),c._loadFn=c._loadListener.bind(c),c._node.addEventListener(t._canPlayEvent,c._loadFn,!1),c._endFn=c._endListener.bind(c),c._node.addEventListener("ended",c._endFn,!1),c._node.src=d._src,c._node.preload=d._preload===!0?"auto":d._preload,c._node.volume=h*t.volume(),c._node.load()),c},reset:function(){var c=this,d=c._parent;return c._muted=d._muted,c._loop=d._loop,c._volume=d._volume,c._rate=d._rate,c._seek=0,c._rateSeek=0,c._paused=!0,c._ended=!0,c._sprite="__default",c._id=++t._counter,c},_errorListener:function(){var c=this;c._parent._emit("loaderror",c._id,c._node.error?c._node.error.code:0),c._node.removeEventListener("error",c._errorFn,!1)},_loadListener:function(){var c=this,d=c._parent;d._duration=Math.ceil(10*c._node.duration)/10,Object.keys(d._sprite).length===0&&(d._sprite={__default:[0,1e3*d._duration]}),d._state!=="loaded"&&(d._state="loaded",d._emit("load"),d._loadQueue()),c._node.removeEventListener(t._canPlayEvent,c._loadFn,!1)},_endListener:function(){var c=this,d=c._parent;d._duration===1/0&&(d._duration=Math.ceil(10*c._node.duration)/10,d._sprite.__default[1]===1/0&&(d._sprite.__default[1]=1e3*d._duration),d._ended(c)),c._node.removeEventListener("ended",c._endFn,!1)}};var r={},s=function(c){var d=c._src;if(r[d])return c._duration=r[d].duration,void u(c);if(/^data:[^;]+;base64,/.test(d)){for(var h=atob(d.split(",")[1]),p=new Uint8Array(h.length),m=0;m<h.length;++m)p[m]=h.charCodeAt(m);l(p.buffer,c)}else{var g=new XMLHttpRequest;g.open(c._xhr.method,d,!0),g.withCredentials=c._xhr.withCredentials,g.responseType="arraybuffer",c._xhr.headers&&Object.keys(c._xhr.headers).forEach(function(b){g.setRequestHeader(b,c._xhr.headers[b])}),g.onload=function(){var b=(g.status+"")[0];if(b!=="0"&&b!=="2"&&b!=="3")return void c._emit("loaderror",null,"Failed loading audio file with status: "+g.status+".");l(g.response,c)},g.onerror=function(){c._webAudio&&(c._html5=!0,c._webAudio=!1,c._sounds=[],delete r[d],c.load())},o(g)}},o=function(c){try{c.send()}catch{c.onerror()}},l=function(c,d){var h=function(){d._emit("loaderror",null,"Decoding audio data failed.")},p=function(m){m&&d._sounds.length>0?(r[d._src]=m,u(d,m)):h()};typeof Promise<"u"&&t.ctx.decodeAudioData.length===1?t.ctx.decodeAudioData(c).then(p).catch(h):t.ctx.decodeAudioData(c,p,h)},u=function(c,d){d&&!c._duration&&(c._duration=d.duration),Object.keys(c._sprite).length===0&&(c._sprite={__default:[0,1e3*c._duration]}),c._state!=="loaded"&&(c._state="loaded",c._emit("load"),c._loadQueue())},f=function(){if(t.usingWebAudio){try{typeof AudioContext<"u"?t.ctx=new AudioContext:typeof webkitAudioContext<"u"?t.ctx=new webkitAudioContext:t.usingWebAudio=!1}catch{t.usingWebAudio=!1}t.ctx||(t.usingWebAudio=!1);var c=/iP(hone|od|ad)/.test(t._navigator&&t._navigator.platform),d=t._navigator&&t._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),h=d?parseInt(d[1],10):null;if(c&&h&&h<9){var p=/safari/.test(t._navigator&&t._navigator.userAgent.toLowerCase());t._navigator&&!p&&(t.usingWebAudio=!1)}t.usingWebAudio&&(t.masterGain=t.ctx.createGain===void 0?t.ctx.createGainNode():t.ctx.createGain(),t.masterGain.gain.setValueAtTime(t._muted?0:t._volume,t.ctx.currentTime),t.masterGain.connect(t.ctx.destination)),t._setup()}};i.Howler=t,i.Howl=n,typeof gi<"u"?(gi.HowlerGlobal=e,gi.Howler=t,gi.Howl=n,gi.Sound=a):typeof window<"u"&&(window.HowlerGlobal=e,window.Howler=t,window.Howl=n,window.Sound=a)})()}($r)),$r}var Es=qd();const jd="data:audio/wav;base64,UklGRkYEAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAATElTVBoAAABJTkZPSVNGVA0AAABMYXZmNjAuMy4xMDAAAGRhdGEABAAAAIDfjHvG/eK+8VP5Bvyg/v3+Dv8O/1v+8P59B0sXqgoxBa4BQgEEAIMATAAyAE4AnwA8APf/oH+tf3J/6F74LWgXiQpfBbABbAGy/+b/4f+X/w+AAIAKjAzF7uIk8Ln4efsB/jf+Of66/kv+Ev84/6sBbf+eAMn/IADgACQA3gBXABMBrP9/ACIAvgraEnAIfwVbAdYCxf5zAVr/iQBb/6cAMP9KAKtP4H9VaPUyfhjgC0EFigNcAL4AqP/qABoA5wAc/T7yE/iK/CX94v+A/a3+4P7n/eX+cv0b/w7/v/4AgGK2Qdso7ub2vfsQ/ef96/6b/u//+/1UANb9sIAAgJq/3N4+8MX37PtP/fD+Hf5S/zf+c/80/f3DWsiL5Cby0fm5/OT9IQAG/y0A1P6S/1z/jP//f/9/un+oY5kwqheUC5oFXAGAAFv/WwDN/xQBRf9mgACAWoT+weri4/BI+aH7Xv+l/Zr/Nf3k/xT9/3/1ff9/OkPbIUEPXQiVBN4AiQDT//YA0/8JAA2AAICvgIWfetA55xX0Mfmz/Az+w/5H/4r+Zf8r/015Q1d6KlgVZwkkBqUBigHH/q4A6/7WACL/qgBtHDFPaCbnE/sIigQNAloBpf8qALn/aP9vAMj+mABm5FLnpvMc+iz99f51/wH/zP4c/wcAjf+X/zD/+CAbf51Znio6FNwI5AS5AdUAnf8g/93/yv6lAJH/R4AAgDetL9ZL7LH1VPum/Lr+JP+Y/5z+0v4b/pP+AdF63vruUPj4+7r9nP6Y/Qz/Bv5Q/3P+jf+i/ln8K+1/9y769f1I/RQAxP4RABT+5/8x/mH/ff6k//hB7n/0U6opvRPDCUkEOgF5ASD/PwBI/4cAsP9iAEgHfg1JBb4DCwGVAJz/iQCX/30Awf8LAND/HADc/xLy0+8l+K/7/v06/+b+Bf/W/sH+x/7U/tv+k/4A/yoVChNQCeEDSgLoAEEABQA9ABUABADR/xUAx/8WAHvQ7dWg6v/1wfpZ/eb9OP/6/h7/7f76/sz+zf7X/tkgHR0mDiMHGwP+AC4A9v8xAAoAQgDi/ywA9v9aABMAIAGa/+b/+v8TALT/5v8gAPT/8f8OAC4ANAAFAA3pyuQE8+D5Rf3y/Rr/5f7H/rP+g/7t/q7+Iv/Q/oAALQB9AAcAJQAJAPv/2v/O/yAAWgAbAFkBSAP+ATMCCgIGAY0AKwAzADEAMABIABMAHAC4/17/x/4J//T+Uv9b/6b/wP/Y//D/3v8QAPz/7v8GAEAAFQA4ACoAEwAIAAIABwD9//L/CAADAAkADgAWABMAGwAPAA0ACwAQAAgABQAJAAoAAwD///b/9f/y/+n/9//2//f//f/9/w==",Oc="/smeditor/assets/metronome_high-C7Kf-JE0.wav",Nc="/smeditor/assets/metronome_low-BSgffp0_.wav",$d="/smeditor/assets/mine-Dy-Y9L9c.wav",qa=[".aac",".mid",".midi",".mp3",".oga",".ogg",".opus",".wav",".webm",".weba",".flac",".aiff"],Oi=[".bmp",".gif",".jpeg",".jpg",".png",".tif",".tiff",".webp"];var Me=(i=>(i[i.NONE=0]="NONE",i[i.LEFT_HEEL=1]="LEFT_HEEL",i[i.LEFT_TOE=2]="LEFT_TOE",i[i.RIGHT_HEEL=3]="RIGHT_HEEL",i[i.RIGHT_TOE=4]="RIGHT_TOE",i))(Me||{});const Yd=[".","L","l","R","r"],Kd=["None","Left Heel","Left Toe","Right Heel","Right Toe"];class ot{windowManager;minimizeElement;closeElement;closed=!1;options;windowElement;viewElement;constructor(e){this.options=e;const t=document.createElement("div"),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div");t.appendChild(a),t.appendChild(n),t.style.width=e.width/16+"rem",t.style.left=window.innerWidth/2-e.width/2*y.general.uiScale+"px",t.style.top=window.innerHeight/2-e.height/2*y.general.uiScale+"px",t.classList.add("window"),e.win_id&&(t.dataset.win_id=e.win_id),n.classList.add("view"),n.style.height=e.height/16+"rem",n.style.width=e.width/16+"rem",a.classList.add("navbar"),e.title!==""&&a.appendChild(r);const s=me.getIcon("MINIMIZE",15),o=me.getIcon("CLOSE_WINDOW",15);s.classList.add("unselectable"),s.draggable=!1,s.onclick=()=>{n.style.height!="0px"?n.style.height="0px":n.style.height=e.height+"px",this.clampPosition()},o.classList.add("unselectable"),o.draggable=!1,o.onclick=()=>this.closeWindow(),a.appendChild(s),a.appendChild(o),this.minimizeElement=s,this.closeElement=o,e.disableClose&&(s.style.display="none",o.style.display="none"),r.innerText=e.title,r.classList.add("title"),t.addEventListener("mousedown",()=>this.focus()),e.blocking&&(window.addEventListener("mousedown",this.block,!0),document.getElementById("blocker").style.display="block",t.dataset.blocking="block"),r.addEventListener("mousedown",()=>{window.addEventListener("mousemove",this.handleDrag),window.addEventListener("mouseup",()=>window.removeEventListener("mousemove",this.handleDrag))}),this.focus(),t.classList.add("focused"),this.windowElement=t,this.viewElement=n}addToManager(e){this.windowManager=e,e.view.appendChild(this.windowElement),this.focus()}onClose(){}closeWindow(){this.windowManager&&(this.closed=!0,this.onClose(),this.windowManager.removeWindow(this),this.windowElement.classList.add("exiting"),window.removeEventListener("mousedown",this.block,!0),this.options.blocking&&this.windowManager.windows.filter(e=>e.options.blocking).length==0&&(document.getElementById("blocker").style.display="none"),setTimeout(()=>this.windowManager.view.removeChild(this.windowElement),40))}focus(){if(this.windowManager==null)return;this.windowManager.unfocusAll(),this.windowElement.classList.add("focused");const e=Array.from(this.windowManager.view.children).map(t=>t).filter(t=>t!=this.windowElement);e.sort((t,n)=>parseInt(t.style.zIndex)-parseInt(n.style.zIndex)),e.push(this.windowElement);for(let t=0;t<e.length;t++)e[t].style.zIndex=((e[t].dataset.blocking?10001:0)+t).toString()}unfocus(){this.windowManager!=null&&this.windowElement.classList.remove("focused")}block=e=>{!e.target||this.windowElement.contains(e.target)||(e.stopImmediatePropagation(),e.preventDefault())};handleDrag=e=>{const t=parseInt(this.windowElement.style.left.slice(0,-2))+e.movementX,n=parseInt(this.windowElement.style.top.slice(0,-2))+e.movementY;this.windowElement.style.left=t+"px",this.windowElement.style.top=n+"px",this.clampPosition()};clampPosition(){if(this.windowManager==null)return;const e=parseInt(this.windowElement.style.left.slice(0,-2)),t=parseInt(this.windowElement.style.top.slice(0,-2)),n=this.windowManager.app.view.getBoundingClientRect();this.windowElement.style.left=Se(e,n.left,n.width-this.windowElement.clientWidth+n.left)+"px",this.windowElement.style.top=Se(t,n.top,n.height-this.windowElement.clientHeight+n.top)+"px"}move(e,t){this.windowElement.style.left=e+"px",this.windowElement.style.top=t+"px"}setDisableClose(e){e?(this.minimizeElement.style.display="none",this.closeElement.style.display="none"):(this.minimizeElement.style.display="",this.closeElement.style.display="")}setBlocking(e){e?(this.windowElement.dataset.blocking="block",document.getElementById("blocker").style.display="block",window.addEventListener("mousedown",this.block,!0)):(this.windowElement.dataset.blocking="",document.getElementById("blocker").style.display="none",window.removeEventListener("mousedown",this.block,!0)),this.focus()}}class Xd extends ot{app;constructor(e){super({title:"About",width:300,height:170,win_id:"about"}),this.app=e,this.initView()}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("div");t.classList.add("about-container");const n=document.createElement("div");n.classList.add("logo-container");const a=document.createElement("img");a.src="/smeditor/assets/icon/logo.png";const r=document.createElement("div");r.innerText="SMEditor";const s=document.createElement("div");s.style.textAlign="center",s.innerText="Open source online web tool to view and edit StepMania charts (.sm/.ssc files). Maintained by tillvit";const o=document.createElement("div");if(o.style.fontSize="0.875rem",o.style.color="var(--text-color-secondary)",o.innerText=`Core v${window.app.VERSION}`,window.nw){const l=nw.require("nw.gui");o.innerText+=` | App v${l.App.manifest.version}`}t.appendChild(n),n.appendChild(a),n.appendChild(r),t.appendChild(s),t.appendChild(o),e.appendChild(t),this.viewElement.appendChild(e)}}const kl={videoHeight:{label:"Video Height",input:{type:"dropdown",items:["360p","480p","720p","1080p"],advanced:!0,transformers:{serialize:i=>`${i}p`,deserialize:i=>parseInt(i.slice(0,-1))}}},fps:{label:"FPS",input:{type:"dropdown",items:[24,30,60],advanced:!1}},bitrate:{label:"Bitrate",input:{type:"display-slider",transformers:{serialize:i=>Math.log(i),deserialize:i=>Math.round(Math.exp(i)/1e3)*1e3,display:i=>Math.round(Math.exp(i)/1e3)+" kbps"},min:Math.log(1e6),max:Math.log(2e7),step:1e-5,displayWidth:80,width:80}},aspectRatio:{label:"Aspect Ratio",input:{type:"dropdown",items:["4 / 3","16 / 9","16 / 10"],advanced:!0,transformers:{serialize:i=>{const e={"4 / 3":1.3333333333333333,"16 / 9":1.7777777777777777,"16 / 10":1.6};return Object.keys(e).find(t=>{if(Math.abs(e[t]-i)<1e-4)return!0})},deserialize:i=>({"4 / 3":1.3333333333333333,"16 / 9":1.7777777777777777,"16 / 10":1.6})[i]}}}},Zd={hideBarlines:{label:"Hide barlines and events",input:{type:"checkbox"}},playbackRate:{label:"Playback Rate",input:{type:"number",min:10,max:300,step:10,precision:3,minPrecision:0,transformers:{serialize:i=>i*100,deserialize:i=>i/100}}},assistTick:{label:"Assist Tick",input:{type:"checkbox"}},metronome:{label:"Metronome",input:{type:"checkbox"}}};var Zs=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},K=(i,e,t)=>(Zs(i,e,"read from private field"),t?t.call(i):e.get(i)),Ie=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},yt=(i,e,t,n)=>(Zs(i,e,"write to private field"),e.set(i,t),t),tt=(i,e,t)=>(Zs(i,e,"access private method"),t),Ve=new Uint8Array(8),wi=new DataView(Ve.buffer),Ht=i=>[(i%256+256)%256],Ye=i=>(wi.setUint16(0,i,!1),[Ve[0],Ve[1]]),Qd=i=>(wi.setInt16(0,i,!1),[Ve[0],Ve[1]]),Hc=i=>(wi.setUint32(0,i,!1),[Ve[1],Ve[2],Ve[3]]),_e=i=>(wi.setUint32(0,i,!1),[Ve[0],Ve[1],Ve[2],Ve[3]]),Jd=i=>(wi.setUint32(0,Math.floor(i/2**32),!1),wi.setUint32(4,i,!1),[Ve[0],Ve[1],Ve[2],Ve[3],Ve[4],Ve[5],Ve[6],Ve[7]]),Qs=i=>(wi.setInt16(0,2**8*i,!1),[Ve[0],Ve[1]]),si=i=>(wi.setInt32(0,2**16*i,!1),[Ve[0],Ve[1],Ve[2],Ve[3]]),Yr=i=>(wi.setInt32(0,2**30*i,!1),[Ve[0],Ve[1],Ve[2],Ve[3]]),ai=(i,e=!1)=>{let t=Array(i.length).fill(null).map((n,a)=>i.charCodeAt(a));return e&&t.push(0),t},Yi=i=>i&&i[i.length-1],Un=(i,e,t=!0)=>{let n=i*e;return t?Math.round(n):n},zc=i=>{let e=i*(Math.PI/180),t=Math.cos(e),n=Math.sin(e);return[t,n,0,-n,t,0,0,0,1]},eh=zc(0),Vc=i=>[si(i[0]),si(i[1]),Yr(i[2]),si(i[3]),si(i[4]),Yr(i[5]),si(i[6]),si(i[7]),Yr(i[8])],Ln=i=>!i||typeof i!="object"?i:Array.isArray(i)?i.map(Ln):Object.fromEntries(Object.entries(i).map(([e,t])=>[e,Ln(t)])),wt=(i,e,t)=>({type:i,contents:e&&new Uint8Array(e.flat(10)),children:t}),vt=(i,e,t,n,a)=>wt(i,[Ht(e),Hc(t),n??[]],a),th=i=>i?wt("ftyp",[ai("isom"),_e(0),ai("iso4"),ai("hvc1")]):wt("ftyp",[ai("isom"),_e(0),ai("isom"),ai("avc1"),ai("mp41")]),Sl=i=>({type:"mdat",largeSize:i}),ih=i=>({type:"free",size:i}),Kr=(i,e)=>wt("moov",null,[nh(e,i),...i.map(t=>ah(t,e))]),nh=(i,e)=>{let t=Un(Math.max(0,...e.filter(a=>a.samples.length>0).map(a=>Yi(a.samples).timestamp+Yi(a.samples).duration)),ks),n=Math.max(...e.map(a=>a.id))+1;return vt("mvhd",0,0,[_e(i),_e(i),_e(ks),_e(t),si(1),Qs(1),Array(10).fill(0),Vc(eh),Array(24).fill(0),_e(n)])},ah=(i,e)=>wt("trak",null,[rh(i,e),sh(i,e)]),rh=(i,e)=>{let t=Yi(i.samples),n=Un(t?t.timestamp+t.duration:0,ks);return vt("tkhd",0,3,[_e(e),_e(e),_e(i.id),_e(0),_e(n),Array(8).fill(0),Ye(0),Ye(0),Qs(i.info.type==="audio"?1:0),Ye(0),Vc(zc(i.info.type==="video"?i.info.rotation:0)),si(i.info.type==="video"?i.info.width:0),si(i.info.type==="video"?i.info.height:0)])},sh=(i,e)=>wt("mdia",null,[oh(i,e),lh(i.info.type==="video"?"vide":"soun"),ch(i)]),oh=(i,e)=>{let t=Yi(i.samples),n=Un(t?t.timestamp+t.duration:0,i.timescale);return vt("mdhd",0,0,[_e(e),_e(e),_e(i.timescale),_e(n),Ye(21956),Ye(0)])},lh=i=>vt("hdlr",0,0,[ai("mhlr"),ai(i),_e(0),_e(0),_e(0),ai("mp4-muxer-hdlr")]),ch=i=>wt("minf",null,[i.info.type==="video"?uh():dh(),hh(),mh(i)]),uh=()=>vt("vmhd",0,1,[Ye(0),Ye(0),Ye(0),Ye(0)]),dh=()=>vt("smhd",0,0,[Ye(0),Ye(0)]),hh=()=>wt("dinf",null,[fh()]),fh=()=>vt("dref",0,0,[_e(1)],[ph()]),ph=()=>vt("url ",0,1),mh=i=>wt("stbl",null,[gh(i),Ah(i),kh(i),Sh(i),Th(i),Mh(i)]),gh=i=>vt("stsd",0,0,[_e(1)],[i.info.type==="video"?bh(Lh[i.info.codec],i):_h(Bh[i.info.codec],i)]),bh=(i,e)=>wt(i,[Array(6).fill(0),Ye(1),Ye(0),Ye(0),Array(12).fill(0),Ye(e.info.width),Ye(e.info.height),_e(4718592),_e(4718592),_e(0),Ye(1),Array(32).fill(0),Ye(24),Qd(65535)],[Dh[e.info.codec](e)]),yh=i=>i.codecPrivate&&wt("avcC",[...i.codecPrivate]),wh=i=>i.codecPrivate&&wt("hvcC",[...i.codecPrivate]),vh=i=>i.codecPrivate&&wt("vpcC",[...i.codecPrivate]),xh=i=>i.codecPrivate&&wt("av1C",[...i.codecPrivate]),_h=(i,e)=>wt(i,[Array(6).fill(0),Ye(1),Ye(0),Ye(0),_e(0),Ye(e.info.numberOfChannels),Ye(16),Ye(0),Ye(0),si(e.info.sampleRate)],[Fh[e.info.codec](e)]),Eh=i=>vt("esds",0,0,[_e(58753152),Ht(32+i.codecPrivate.byteLength),Ye(1),Ht(0),_e(75530368),Ht(18+i.codecPrivate.byteLength),Ht(64),Ht(21),Hc(0),_e(130071),_e(130071),_e(92307584),Ht(i.codecPrivate.byteLength),...i.codecPrivate,_e(109084800),Ht(1),Ht(2)]),Ch=i=>wt("dOps",[Ht(0),Ht(i.info.numberOfChannels),Ye(3840),_e(i.info.sampleRate),Qs(0),Ht(0)]),Ah=i=>vt("stts",0,0,[_e(i.timeToSampleTable.length),i.timeToSampleTable.map(e=>[_e(e.sampleCount),_e(e.sampleDelta)])]),kh=i=>{if(i.samples.every(t=>t.type==="key"))return null;let e=[...i.samples.entries()].filter(([,t])=>t.type==="key");return vt("stss",0,0,[_e(e.length),e.map(([t])=>_e(t+1))])},Sh=i=>vt("stsc",0,0,[_e(i.compactlyCodedChunkTable.length),i.compactlyCodedChunkTable.map(e=>[_e(e.firstChunk),_e(e.samplesPerChunk),_e(1)])]),Th=i=>vt("stsz",0,0,[_e(0),_e(i.samples.length),i.samples.map(e=>_e(e.size))]),Mh=i=>i.finalizedChunks.length>0&&Yi(i.finalizedChunks).offset>=2**32?vt("co64",0,0,[_e(i.finalizedChunks.length),i.finalizedChunks.map(e=>Jd(e.offset))]):vt("stco",0,0,[_e(i.finalizedChunks.length),i.finalizedChunks.map(e=>_e(e.offset))]),Lh={avc:"avc1",hevc:"hvc1",vp9:"vp09",av1:"av01"},Dh={avc:yh,hevc:wh,vp9:vh,av1:xh},Bh={aac:"mp4a",opus:"Opus"},Fh={aac:Eh,opus:Ch},Uc=class{constructor(){this.buffer=null}},Wc=class{constructor(i,e,t){this.onData=i,this.onDone=e,this.options=t}},Ih=class{constructor(i,e){this.stream=i,this.options=e}},Ni,rn,Js=class{constructor(){this.pos=0,Ie(this,Ni,new Uint8Array(8)),Ie(this,rn,new DataView(K(this,Ni).buffer)),this.offsets=new WeakMap}seek(i){this.pos=i}writeU32(i){K(this,rn).setUint32(0,i,!1),this.write(K(this,Ni).subarray(0,4))}writeU64(i){K(this,rn).setUint32(0,Math.floor(i/2**32),!1),K(this,rn).setUint32(4,i,!1),this.write(K(this,Ni).subarray(0,8))}writeAscii(i){for(let e=0;e<i.length;e++)K(this,rn).setUint8(e%8,i.charCodeAt(e)),e%8===7&&this.write(K(this,Ni));i.length%8!==0&&this.write(K(this,Ni).subarray(0,i.length%8))}writeBox(i){if(this.offsets.set(i,this.pos),i.contents&&!i.children)this.writeBoxHeader(i,i.size??i.contents.byteLength+8),this.write(i.contents);else{let e=this.pos;if(this.writeBoxHeader(i,0),i.contents&&this.write(i.contents),i.children)for(let a of i.children)a&&this.writeBox(a);let t=this.pos,n=i.size??t-e;this.seek(e),this.writeBoxHeader(i,n),this.seek(t)}}writeBoxHeader(i,e){this.writeU32(i.largeSize?1:e),this.writeAscii(i.type),i.largeSize&&this.writeU64(e)}measureBoxHeader(i){return 8+(i.largeSize?8:0)}patchBox(i){let e=this.pos;this.seek(this.offsets.get(i)),this.writeBox(i),this.seek(e)}measureBox(i){if(i.contents&&!i.children)return this.measureBoxHeader(i)+i.contents.byteLength;{let e=this.measureBoxHeader(i);if(i.contents&&(e+=i.contents.byteLength),i.children)for(let t of i.children)t&&(e+=this.measureBox(t));return e}}};Ni=new WeakMap;rn=new WeakMap;var va,Gi,Wn,En,xa,Cs,Rh=class extends Js{constructor(i){super(),Ie(this,xa),Ie(this,va,void 0),Ie(this,Gi,new ArrayBuffer(2**16)),Ie(this,Wn,new Uint8Array(K(this,Gi))),Ie(this,En,0),yt(this,va,i)}write(i){tt(this,xa,Cs).call(this,this.pos+i.byteLength),K(this,Wn).set(i,this.pos),this.pos+=i.byteLength,yt(this,En,Math.max(K(this,En),this.pos))}finalize(){tt(this,xa,Cs).call(this,this.pos),K(this,va).buffer=K(this,Gi).slice(0,Math.max(K(this,En),this.pos))}};va=new WeakMap;Gi=new WeakMap;Wn=new WeakMap;En=new WeakMap;xa=new WeakSet;Cs=function(i){let e=K(this,Gi).byteLength;for(;e<i;)e*=2;if(e===K(this,Gi).byteLength)return;let t=new ArrayBuffer(e),n=new Uint8Array(t);n.set(K(this,Wn),0),yt(this,Gi,t),yt(this,Wn,n)};var Cn,Hi,Gc=class extends Js{constructor(i){super(),Ie(this,Cn,void 0),Ie(this,Hi,[]),yt(this,Cn,i)}write(i){K(this,Hi).push({data:i.slice(),start:this.pos}),this.pos+=i.byteLength}flush(){if(K(this,Hi).length===0)return;let i=[],e=[...K(this,Hi)].sort((t,n)=>t.start-n.start);i.push({start:e[0].start,size:e[0].data.byteLength});for(let t=1;t<e.length;t++){let n=i[i.length-1],a=e[t];a.start<=n.start+n.size?n.size=Math.max(n.size,a.start+a.data.byteLength-n.start):i.push({start:a.start,size:a.data.byteLength})}for(let t of i){t.data=new Uint8Array(t.size);for(let n of K(this,Hi))t.start<=n.start&&n.start<t.start+t.size&&t.data.set(n.data,n.start-t.start);K(this,Cn).onData(t.data,t.start)}K(this,Hi).length=0}finalize(){K(this,Cn).onDone?.()}};Cn=new WeakMap;Hi=new WeakMap;var Ph=2**24,Oh=2,Dn,Kt,Bt,Ta,As,eo,qc,to,jc,Bn,Ma,$c=class extends Js{constructor(i){if(super(),Ie(this,Ta),Ie(this,eo),Ie(this,to),Ie(this,Bn),Ie(this,Dn,void 0),Ie(this,Kt,void 0),Ie(this,Bt,[]),yt(this,Dn,i),yt(this,Kt,i.options?.chunkSize??Ph),!Number.isInteger(K(this,Kt))||K(this,Kt)<2**10)throw new Error("Invalid StreamTarget options: chunkSize must be an integer not smaller than 1024.")}write(i){tt(this,Ta,As).call(this,i,this.pos),tt(this,Bn,Ma).call(this),this.pos+=i.byteLength}finalize(){tt(this,Bn,Ma).call(this,!0),K(this,Dn).onDone?.()}};Dn=new WeakMap;Kt=new WeakMap;Bt=new WeakMap;Ta=new WeakSet;As=function(i,e){let t=K(this,Bt).findIndex(o=>o.start<=e&&e<o.start+K(this,Kt));t===-1&&(t=tt(this,to,jc).call(this,e));let n=K(this,Bt)[t],a=e-n.start,r=i.subarray(0,Math.min(K(this,Kt)-a,i.byteLength));n.data.set(r,a);let s={start:a,end:a+r.byteLength};if(tt(this,eo,qc).call(this,n,s),n.written[0].start===0&&n.written[0].end===K(this,Kt)&&(n.shouldFlush=!0),K(this,Bt).length>Oh){for(let o=0;o<K(this,Bt).length-1;o++)K(this,Bt)[o].shouldFlush=!0;tt(this,Bn,Ma).call(this)}r.byteLength<i.byteLength&&tt(this,Ta,As).call(this,i.subarray(r.byteLength),e+r.byteLength)};eo=new WeakSet;qc=function(i,e){let t=0,n=i.written.length-1,a=-1;for(;t<=n;){let r=Math.floor(t+(n-t+1)/2);i.written[r].start<=e.start?(t=r+1,a=r):n=r-1}for(i.written.splice(a+1,0,e),(a===-1||i.written[a].end<e.start)&&a++;a<i.written.length-1&&i.written[a].end>=i.written[a+1].start;)i.written[a].end=Math.max(i.written[a].end,i.written[a+1].end),i.written.splice(a+1,1)};to=new WeakSet;jc=function(i){let t={start:Math.floor(i/K(this,Kt))*K(this,Kt),data:new Uint8Array(K(this,Kt)),written:[],shouldFlush:!1};return K(this,Bt).push(t),K(this,Bt).sort((n,a)=>n.start-a.start),K(this,Bt).indexOf(t)};Bn=new WeakSet;Ma=function(i=!1){for(let e=0;e<K(this,Bt).length;e++){let t=K(this,Bt)[e];if(!(!t.shouldFlush&&!i)){for(let n of t.written)K(this,Dn).onData(t.data.subarray(n.start,n.end),t.start+n.start);K(this,Bt).splice(e--,1)}}};var Nh=class extends $c{constructor(i){super(new Wc((e,t)=>i.stream.write({type:"write",data:e,position:t}),void 0,{chunkSize:i.options?.chunkSize}))}},ks=1e3,Hh=["avc","hevc","vp9","av1"],zh=["aac","opus"],Vh=2082844800,Uh=.5,Wh=["strict","offset"],Re,Ue,La,Dt,ki,Si,An,Fn,In,Ss,Yc,Ts,Kc,io,Xc,Ms,Zc,no,Qc,_a,Ls,ao,Jc,Rn,Da,Gn,ja,Ea,Ds,Gh=class{constructor(i){if(Ie(this,Ss),Ie(this,Ts),Ie(this,io),Ie(this,Ms),Ie(this,no),Ie(this,_a),Ie(this,ao),Ie(this,Rn),Ie(this,Gn),Ie(this,Ea),Ie(this,Re,void 0),Ie(this,Ue,void 0),Ie(this,La,void 0),Ie(this,Dt,void 0),Ie(this,ki,null),Ie(this,Si,null),Ie(this,An,Math.floor(Date.now()/1e3)+Vh),Ie(this,Fn,[]),Ie(this,In,!1),tt(this,Ss,Yc).call(this,i),i.video=Ln(i.video),i.audio=Ln(i.audio),i.fastStart=Ln(i.fastStart),this.target=i.target,yt(this,Re,{firstTimestampBehavior:"strict",...i}),i.target instanceof Uc)yt(this,Ue,new Rh(i.target));else if(i.target instanceof Wc)yt(this,Ue,i.target.options?.chunked?new $c(i.target):new Gc(i.target));else if(i.target instanceof Ih)yt(this,Ue,new Nh(i.target));else throw new Error(`Invalid target: ${i.target}`);tt(this,Ts,Kc).call(this),tt(this,Ms,Zc).call(this)}addVideoChunk(i,e,t){let n=new Uint8Array(i.byteLength);i.copyTo(n),this.addVideoChunkRaw(n,i.type,t??i.timestamp,i.duration,e)}addVideoChunkRaw(i,e,t,n,a){if(tt(this,Ea,Ds).call(this),!K(this,Re).video)throw new Error("No video track declared.");if(typeof K(this,Re).fastStart=="object"&&K(this,ki).samples.length===K(this,Re).fastStart.expectedVideoChunks)throw new Error(`Cannot add more video chunks than specified in 'fastStart' (${K(this,Re).fastStart.expectedVideoChunks}).`);tt(this,_a,Ls).call(this,K(this,ki),i,e,t,n,a)}addAudioChunk(i,e,t){let n=new Uint8Array(i.byteLength);i.copyTo(n),this.addAudioChunkRaw(n,i.type,t??i.timestamp,i.duration,e)}addAudioChunkRaw(i,e,t,n,a){if(tt(this,Ea,Ds).call(this),!K(this,Re).audio)throw new Error("No audio track declared.");if(typeof K(this,Re).fastStart=="object"&&K(this,Si).samples.length===K(this,Re).fastStart.expectedAudioChunks)throw new Error(`Cannot add more audio chunks than specified in 'fastStart' (${K(this,Re).fastStart.expectedAudioChunks}).`);tt(this,_a,Ls).call(this,K(this,Si),i,e,t,n,a)}finalize(){if(K(this,In))throw new Error("Cannot finalize a muxer more than once.");K(this,ki)&&tt(this,Rn,Da).call(this,K(this,ki)),K(this,Si)&&tt(this,Rn,Da).call(this,K(this,Si));let i=[K(this,ki),K(this,Si)].filter(Boolean);if(K(this,Re).fastStart==="in-memory"){let e;for(let n=0;n<2;n++){let a=Kr(i,K(this,An)),r=K(this,Ue).measureBox(a);e=K(this,Ue).measureBox(K(this,Dt));let s=K(this,Ue).pos+r+e;for(let o of K(this,Fn)){o.offset=s;for(let l of o.sampleData)s+=l.byteLength,e+=l.byteLength}if(s<2**32)break;e>=2**32&&(K(this,Dt).largeSize=!0)}let t=Kr(i,K(this,An));K(this,Ue).writeBox(t),K(this,Dt).size=e,K(this,Ue).writeBox(K(this,Dt));for(let n of K(this,Fn)){for(let a of n.sampleData)K(this,Ue).write(a);n.sampleData=null}}else{let e=K(this,Ue).offsets.get(K(this,Dt)),t=K(this,Ue).pos-e;K(this,Dt).size=t,K(this,Dt).largeSize=t>=2**32,K(this,Ue).patchBox(K(this,Dt));let n=Kr(i,K(this,An));if(typeof K(this,Re).fastStart=="object"){K(this,Ue).seek(K(this,La)),K(this,Ue).writeBox(n);let a=e-K(this,Ue).pos;K(this,Ue).writeBox(ih(a))}else K(this,Ue).writeBox(n)}tt(this,Gn,ja).call(this),K(this,Ue).finalize(),yt(this,In,!0)}};Re=new WeakMap;Ue=new WeakMap;La=new WeakMap;Dt=new WeakMap;ki=new WeakMap;Si=new WeakMap;An=new WeakMap;Fn=new WeakMap;In=new WeakMap;Ss=new WeakSet;Yc=function(i){if(i.video){if(!Hh.includes(i.video.codec))throw new Error(`Unsupported video codec: ${i.video.codec}`);if(i.video.rotation!==void 0&&![0,90,180,270].includes(i.video.rotation))throw new Error(`Invalid video rotation: ${i.video.rotation}. Has to be 0, 90, 180 or 270.`)}if(i.audio&&!zh.includes(i.audio.codec))throw new Error(`Unsupported audio codec: ${i.audio.codec}`);if(i.firstTimestampBehavior&&!Wh.includes(i.firstTimestampBehavior))throw new Error(`Invalid first timestamp behavior: ${i.firstTimestampBehavior}`);if(typeof i.fastStart=="object"){if(i.video&&i.fastStart.expectedVideoChunks===void 0)throw new Error("'fastStart' is an object but is missing property 'expectedVideoChunks'.");if(i.audio&&i.fastStart.expectedAudioChunks===void 0)throw new Error("'fastStart' is an object but is missing property 'expectedAudioChunks'.")}else if(![!1,"in-memory"].includes(i.fastStart))throw new Error("'fastStart' option must be false, 'in-memory' or an object.")};Ts=new WeakSet;Kc=function(){let i=K(this,Re).video?.codec==="hevc";if(K(this,Ue).writeBox(th(i)),yt(this,La,K(this,Ue).pos),K(this,Re).fastStart==="in-memory")yt(this,Dt,Sl(!1));else{if(typeof K(this,Re).fastStart=="object"){let e=tt(this,io,Xc).call(this);K(this,Ue).seek(K(this,Ue).pos+e)}yt(this,Dt,Sl(!0)),K(this,Ue).writeBox(K(this,Dt))}tt(this,Gn,ja).call(this)};io=new WeakSet;Xc=function(){if(typeof K(this,Re).fastStart!="object")return;let i=0,e=[K(this,Re).fastStart.expectedVideoChunks,K(this,Re).fastStart.expectedAudioChunks];for(let t of e)t&&(i+=8*Math.ceil(2/3*t),i+=4*t,i+=12*Math.ceil(2/3*t),i+=4*t,i+=8*t);return i+=4096,i};Ms=new WeakSet;Zc=function(){if(K(this,Re).video&&yt(this,ki,{id:1,info:{type:"video",codec:K(this,Re).video.codec,width:K(this,Re).video.width,height:K(this,Re).video.height,rotation:K(this,Re).video.rotation??0},timescale:720,codecPrivate:new Uint8Array(0),samples:[],finalizedChunks:[],currentChunk:null,firstTimestamp:void 0,lastTimestamp:-1,timeToSampleTable:[],lastTimescaleUnits:null,compactlyCodedChunkTable:[]}),K(this,Re).audio){let i=tt(this,no,Qc).call(this,2,K(this,Re).audio.sampleRate,K(this,Re).audio.numberOfChannels);yt(this,Si,{id:K(this,Re).video?2:1,info:{type:"audio",codec:K(this,Re).audio.codec,numberOfChannels:K(this,Re).audio.numberOfChannels,sampleRate:K(this,Re).audio.sampleRate},timescale:K(this,Re).audio.sampleRate,codecPrivate:i,samples:[],finalizedChunks:[],currentChunk:null,firstTimestamp:void 0,lastTimestamp:-1,timeToSampleTable:[],lastTimescaleUnits:null,compactlyCodedChunkTable:[]})}};no=new WeakSet;Qc=function(i,e,t){let a=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350].indexOf(e),r=t,s="";s+=i.toString(2).padStart(5,"0"),s+=a.toString(2).padStart(4,"0"),a===15&&(s+=e.toString(2).padStart(24,"0")),s+=r.toString(2).padStart(4,"0");let o=Math.ceil(s.length/8)*8;s=s.padEnd(o,"0");let l=new Uint8Array(s.length/8);for(let u=0;u<s.length;u+=8)l[u/8]=parseInt(s.slice(u,u+8),2);return l};_a=new WeakSet;Ls=function(i,e,t,n,a,r){let s=n/1e6,o=a/1e6;if(i.firstTimestamp===void 0&&(i.firstTimestamp=s),s=tt(this,ao,Jc).call(this,s,i),i.lastTimestamp=s,(!i.currentChunk||s-i.currentChunk.startTimestamp>=Uh)&&(i.currentChunk&&tt(this,Rn,Da).call(this,i),i.currentChunk={startTimestamp:s,sampleData:[],sampleCount:0}),i.currentChunk.sampleData.push(e),i.currentChunk.sampleCount++,r?.decoderConfig?.description&&(i.codecPrivate=new Uint8Array(r.decoderConfig.description)),i.samples.push({timestamp:s,duration:o,size:e.byteLength,type:t}),i.lastTimescaleUnits!==null){let l=Un(s,i.timescale,!1),u=Math.round(l-i.lastTimescaleUnits);i.lastTimescaleUnits+=u;let f=Yi(i.timeToSampleTable);f.sampleCount===1?(f.sampleDelta=u,f.sampleCount++):f.sampleDelta===u?f.sampleCount++:(f.sampleCount--,i.timeToSampleTable.push({sampleCount:2,sampleDelta:u}))}else i.lastTimescaleUnits=0,i.timeToSampleTable.push({sampleCount:1,sampleDelta:Un(o,i.timescale)})};ao=new WeakSet;Jc=function(i,e){if(K(this,Re).firstTimestampBehavior==="strict"&&e.lastTimestamp===-1&&i!==0)throw new Error(`The first chunk for your media track must have a timestamp of 0 (received ${i}). Non-zero first timestamps are often caused by directly piping frames or audio data from a MediaStreamTrack into the encoder. Their timestamps are typically relative to the age of the document, which is probably what you want.

If you want to offset all timestamps of a track such that the first one is zero, set firstTimestampBehavior: 'offset' in the options.
`);if(K(this,Re).firstTimestampBehavior==="offset"&&(i-=e.firstTimestamp),i<e.lastTimestamp)throw new Error(`Timestamps must be monotonically increasing (went from ${e.lastTimestamp*1e6} to ${i*1e6}).`);return i};Rn=new WeakSet;Da=function(i){if(i.currentChunk){if((i.compactlyCodedChunkTable.length===0||Yi(i.compactlyCodedChunkTable).samplesPerChunk!==i.currentChunk.sampleCount)&&i.compactlyCodedChunkTable.push({firstChunk:i.finalizedChunks.length+1,samplesPerChunk:i.currentChunk.sampleCount}),i.finalizedChunks.push(i.currentChunk),K(this,Fn).push(i.currentChunk),K(this,Re).fastStart==="in-memory"){i.currentChunk.offset=0;return}i.currentChunk.offset=K(this,Ue).pos;for(let e of i.currentChunk.sampleData)K(this,Ue).write(e);i.currentChunk.sampleData=null,tt(this,Gn,ja).call(this)}};Gn=new WeakSet;ja=function(){K(this,Ue)instanceof Gc&&K(this,Ue).flush()};Ea=new WeakSet;Ds=function(){if(K(this,In))throw new Error("Cannot add new video or audio chunks after the file has been finalized.")};class qh{app;options;encoder;ac;muxer;recording=!1;renderInterval;cachedBarlines;_currentFrame=0;blob;totalFrames;constructor(e,t){this.options={aspectRatio:4/3,videoHeight:1080,fps:60,bitrate:4e7,playbackRate:1,assistTick:!1,metronome:!1,hideBarlines:!1,startTime:0,endTime:10,...t},this.app=e,this.muxer=new Gh({target:new Uc,video:{codec:"avc",width:Math.round(this.options.videoHeight*this.options.aspectRatio/2)*2,height:this.options.videoHeight},audio:{codec:"aac",numberOfChannels:this.app.chartManager.chartAudio.getBuffer().numberOfChannels,sampleRate:this.app.chartManager.chartAudio.getSampleRate()},fastStart:"in-memory"}),this.encoder=new VideoEncoder({output:(n,a)=>void this.muxer.addVideoChunk(n,a),error:n=>{throw n}}),this.encoder.configure({codec:"avc1.420028",width:Math.round(this.options.videoHeight*this.options.aspectRatio/2)*2,height:this.options.videoHeight,bitrate:this.options.bitrate,hardwareAcceleration:"prefer-hardware",framerate:this.options.fps}),this.ac=new AudioEncoder({output:(n,a)=>void this.muxer.addAudioChunk(n,a),error:n=>{throw n}}),this.ac.configure({codec:"mp4a.40.2",bitrate:192e3,numberOfChannels:this.app.chartManager.chartAudio.getBuffer().numberOfChannels,sampleRate:this.app.chartManager.chartAudio.getSampleRate()}),this.totalFrames=Math.ceil((this.options.endTime-this.options.startTime)*this.options.fps),this.cachedBarlines=he.barlines}async renderBufferWithModifications(e,t){const n=new OfflineAudioContext(e.numberOfChannels,Math.ceil(e.duration*t.sampleRate/t.rate),t.sampleRate),a=n.createGain();a.gain.setValueAtTime(t.volume,0);const r=n.createBufferSource();r.buffer=e,r.playbackRate.setValueAtTime(t.rate,0),r.connect(a),a.connect(n.destination),r.start();const s=await n.startRendering();return r.stop(),s}async createAssistSounds(e,t,n,a){const r=new AudioBuffer({length:Math.ceil((t-e)*n/a),sampleRate:n,numberOfChannels:2}),s=this.app.chartManager.loadedChart,o=s.getBeatFromSeconds(e),l=s.getBeatFromSeconds(t),u=s.getNotedataInRange(o,l);if(this.options.assistTick){let f=this.app.chartManager.assistTick.getBuffer();f=await this.renderBufferWithModifications(f,{volume:y.audio.soundEffectVolume*y.audio.masterVolume,sampleRate:n,rate:1});let c=-1;for(const d of u)if(d.beat!=c&&(c=d.beat,s.gameType.gameLogic.shouldAssistTick(d))){const h=Math.floor((d.second-e)*n/a);for(let p=0;p<r.numberOfChannels;p++){const m=r.getChannelData(p);for(let g=0;g<f.length&&!(h+g>=m.length);g++)m[h+g]+=f.getChannelData(p%f.numberOfChannels)[g]}}}if(this.options.metronome){let f=this.app.chartManager.me_high.getBuffer();f=await this.renderBufferWithModifications(f,{volume:y.audio.soundEffectVolume*y.audio.masterVolume,sampleRate:n,rate:1});let c=this.app.chartManager.me_low.getBuffer();c=await this.renderBufferWithModifications(c,{volume:y.audio.soundEffectVolume*y.audio.masterVolume,sampleRate:n,rate:1});let d=null;for(const[h,p]of s.timingData.getMeasureBeats(o,l)){const m=s.timingData.getSecondsFromBeat(h);if(d!==null&&m==d)continue;d=m;const g=p?f:c,b=Math.floor((m-e)*n/a);for(let x=0;x<r.numberOfChannels;x++){const w=r.getChannelData(x);for(let E=0;E<g.length&&!(b+E>=w.length);E++)w[b+E]+=g.getChannelData(x%g.numberOfChannels)[E]}}}return r}async start(){console.time("capture");const e=this.app.chartManager.loadedChart;document.body.classList.remove("animated"),this.app.chartManager.setMode(q.View),he.barlines=!this.options.hideBarlines,this.app.capturing=!0,this.app.chartManager.chartAudio.isPlaying()&&this.app.chartManager.playPause(),this.options.endTime===void 0&&(this.options.endTime=this.app.chartManager.loadedChart?.getLastSecond()??this.app.chartManager.chartAudio.getBuffer().length/this.app.chartManager.chartAudio.getBuffer().sampleRate),this._currentFrame=0,this.app.onResize(this.options.videoHeight*this.options.aspectRatio,this.options.videoHeight),this.app.view.style.width=window.innerWidth+"px",this.app.view.style.height=window.innerHeight+"px",St.shared.stop();let t=this.app.chartManager.chartAudio.getBuffer();const n=Math.floor(this.options.startTime*t.sampleRate),a=Math.ceil(this.options.endTime*t.sampleRate),r=a-n,s=new AudioBuffer({length:r,sampleRate:t.sampleRate,numberOfChannels:t.numberOfChannels});for(let f=0;f<t.numberOfChannels;f++){const c=t.getChannelData(f);s.copyToChannel(c.subarray(Math.max(0,n),a),f,Math.max(0,-n))}t=await this.renderBufferWithModifications(s,{volume:y.audio.songVolume*y.audio.masterVolume,sampleRate:s.sampleRate,rate:this.options.playbackRate});let o=0;o=Ut(e.getNotedata(),this.options.startTime,f=>f.second)+1,o>=1&&this.options.startTime<=e.getNotedata()[o-1].second&&o--;let l=[];const u=await this.createAssistSounds(this.options.startTime,this.options.endTime,t.sampleRate,this.options.playbackRate);return new Promise(f=>{this.recording=!0,this.renderInterval=setInterval(()=>{if(this.recording&&this.encoder.encodeQueueSize<300){const c=this._currentFrame/this.options.fps*this.options.playbackRate+this.options.startTime;if(c>this.options.endTime){f(this.stop());return}this.app.chartManager.time=c;const d=e.getNotedata();for(;o<d.length&&c>d[o].second;){const E=d[o];e.gameType.gameLogic.shouldAssistTick(E)&&(this.app.chartManager.chartView.doJudgement(E,0,Us),Oe(E)&&(E.type=="Hold"?this.app.chartManager.chartView.getNotefield().activateHold(E.col):E.type=="Roll"&&this.app.chartManager.chartView.getNotefield().activateRoll(E.col),l.push(E))),o++}l=l.filter(E=>this.app.chartManager.beat<E.beat+E.hold?!0:(E.type=="Hold"&&this.app.chartManager.chartView.getNotefield().releaseHold(E.col),E.type=="Roll"&&this.app.chartManager.chartView.getNotefield().releaseRoll(E.col),this.app.chartManager.chartView.doJudgement(E,null,_t.getCollection(y.play.timingCollection).getHeldJudgement(E)),!1)),St.shared.update(St.shared.lastTime+1e3/this.options.fps),this.app.renderer.render(this.app.stage);const h=new VideoFrame(this.app.view,{timestamp:this._currentFrame/this.options.fps*1e6}),p=(c-this.options.startTime)/this.options.playbackRate,m=Math.floor(p*t.sampleRate),g=Math.ceil((p+1/this.options.fps)*t.sampleRate),b=g-m,x=new Float32Array(b*t.numberOfChannels);for(let E=0;E<t.numberOfChannels;E++){const C=t.getChannelData(E);if(x.set(C.subarray(m,g),E*b),this.options.metronome||this.options.assistTick){const B=u.getChannelData(E);for(let D=m;D<g&&!(D>=B.length);D++)x[E*b+D-m]+=B[D]}}const w=new AudioData({data:x,format:"f32-planar",numberOfChannels:t.numberOfChannels,numberOfFrames:b,sampleRate:t.sampleRate,timestamp:this._currentFrame/this.options.fps*1e6});this._currentFrame+=1,this.encoder.encode(h),this.ac.encode(w),w.close(),this.options.updateCallback?.({currentRenderFrame:this._currentFrame,currentEncodeQueue:this.encoder.encodeQueueSize,totalFrames:this.totalFrames,currentVideoFrame:h}),h.close()}},10)})}async stop(){clearInterval(this.renderInterval),St.shared.start(),this.app.chartManager.setMode(q.Edit),this.app.updateSize(),this.recording=!1,this.app.capturing=!1,he.barlines=this.cachedBarlines;const e=setInterval(()=>{this.options.updateCallback?.({currentRenderFrame:this.totalFrames,currentEncodeQueue:this.encoder.encodeQueueSize,totalFrames:this.totalFrames,currentVideoFrame:null})},100);await this.encoder?.flush(),await this.ac?.flush(),this.muxer.finalize(),clearInterval(e);const{buffer:t}=this.muxer.target,n=new Blob([t],{type:"video/mp4"});this.blob=n;const a=URL.createObjectURL(n);return y.general.smoothAnimations&&document.body.classList.add("animated"),console.timeEnd("capture"),this.options.onFinish?.(a),a}get currentRenderFrame(){return this._currentFrame}get currentEncodeQueue(){return this.encoder.encodeQueueSize}get size(){return this.blob?this.blob.size:0}}const Mi={"dance-single":[{label:"Left",keys:["Left","A"]},{label:"Down",keys:["Down","S"]},{label:"Up",keys:["Up","W"]},{label:"Right",keys:["Right","D"]}],"dance-double":[{label:"P1 Left",keys:["Left"]},{label:"P1 Down",keys:["Down"]},{label:"P1 Up",keys:["Up"]},{label:"P1 Right",keys:["Right"]},{label:"P2 Left",keys:["A"]},{label:"P2 Down",keys:["S"]},{label:"P2 Up",keys:["W"]},{label:"P2 Right",keys:["D"]}],"dance-couple":[{label:"P1 Left",keys:["Left"]},{label:"P1 Down",keys:["Down"]},{label:"P1 Up",keys:["Up"]},{label:"P1 Right",keys:["Right"]},{label:"P2 Left",keys:["A"]},{label:"P2 Down",keys:["S"]},{label:"P2 Up",keys:["W"]},{label:"P2 Right",keys:["D"]}],"dance-solo":[{label:"Left",keys:["Left","A"]},{label:"UpLeft",keys:["Q"]},{label:"Down",keys:["Down","S"]},{label:"Up",keys:["Up","W"]},{label:"UpRight",keys:["E"]},{label:"Right",keys:["Right","D"]}],"dance-solodouble":[{label:"P1 Left",keys:["A"]},{label:"P1 UpLeft",keys:["Q"]},{label:"P1 Down",keys:["S"]},{label:"P1 Up",keys:["W"]},{label:"P1 UpRight",keys:["E"]},{label:"P1 Right",keys:["D"]},{label:"P2 Left",keys:["J"]},{label:"P2 UpLeft",keys:["U"]},{label:"P2 Down",keys:["K"]},{label:"P2 Up",keys:["I"]},{label:"P2 UpRight",keys:["O"]},{label:"P2 Right",keys:["L"]}],"dance-threepanel":[{label:"UpLeft",keys:["Left","Q"]},{label:"Down",keys:["Down","S"]},{label:"UpRight",keys:["Right","E"]}],"dance-threedouble":[{label:"P1 UpLeft",keys:["Left"]},{label:"P1 Down",keys:["Down"]},{label:"P1 UpRight",keys:["Right"]},{label:"P2 UpLeft",keys:["Q"]},{label:"P2 Down",keys:["S"]},{label:"P2 UpRight",keys:["E"]}],"pump-single":[{label:"DownLeft",keys:["Z"]},{label:"UpLeft",keys:["Q"]},{label:"Center",keys:["S"]},{label:"UpRight",keys:["E"]},{label:"DownRight",keys:["C"]}],"pump-double":[{label:"P1 DownLeft",keys:["Z"]},{label:"P1 UpLeft",keys:["Q"]},{label:"P1 Center",keys:["S"]},{label:"P1 UpRight",keys:["E"]},{label:"P1 DownRight",keys:["C"]},{label:"P2 DownLeft",keys:["V"]},{label:"P2 UpLeft",keys:["R"]},{label:"P2 Center",keys:["G"]},{label:"P2 UpRight",keys:["Y"]},{label:"P2 DownRight",keys:["N"]}],"pump-versus":[{label:"P1 DownLeft",keys:["Z"]},{label:"P1 UpLeft",keys:["Q"]},{label:"P1 Center",keys:["S"]},{label:"P1 UpRight",keys:["E"]},{label:"P1 DownRight",keys:["C"]},{label:"P2 DownLeft",keys:["V"]},{label:"P2 UpLeft",keys:["R"]},{label:"P2 Center",keys:["G"]},{label:"P2 UpRight",keys:["Y"]},{label:"P2 DownRight",keys:["N"]}],"pump-couple":[{label:"P1 DownLeft",keys:["Z"]},{label:"P1 UpLeft",keys:["Q"]},{label:"P1 Center",keys:["S"]},{label:"P1 UpRight",keys:["E"]},{label:"P1 DownRight",keys:["C"]},{label:"P2 DownLeft",keys:["V"]},{label:"P2 UpLeft",keys:["R"]},{label:"P2 Center",keys:["G"]},{label:"P2 UpRight",keys:["Y"]},{label:"P2 DownRight",keys:["N"]}],"pump-halfdouble":[{label:"P1 Center",keys:["S"]},{label:"P1 UpRight",keys:["E"]},{label:"P1 DownRight",keys:["C"]},{label:"P2 DownLeft",keys:["V"]},{label:"P2 UpLeft",keys:["R"]},{label:"P2 Center",keys:["G"]}]};class xe{static app;static userKeybinds=new Map;static userGameplayKeybinds=new Map;static enabled=!0;static load(e){this.app=e;try{this.loadKeybinds()}catch(t){console.error("Failed to load user keybinds!"),console.error(t.stack),this.userKeybinds.clear(),this.userGameplayKeybinds.clear()}window.addEventListener("keydown",t=>this.checkKey(t,"keydown")),window.addEventListener("keyup",t=>this.checkKey(t,"keyup"))}static checkKey(e,t){if(!this.enabled||e.target.classList.contains("inlineEdit")||e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement||e.target instanceof HTMLButtonElement||["Meta","Control","Shift","Alt"].includes(e.key))return;const n=[];for(let s=0;s<Na.length;s++)e[Na[s]]&&n.push(Aa[s]);const a=xe.getKeyNameFromEvent(e);if((this.app.chartManager.getMode()==q.Play||this.app.chartManager.getMode()==q.Record)&&this.app.chartManager.loadedChart?.gameType&&!e.repeat){const s=Mi[this.app.chartManager.loadedChart?.gameType.id]??[],o=this.userGameplayKeybinds.get(this.app.chartManager.loadedChart?.gameType.id)??[],l=Object.values(s).findIndex((u,f)=>(o[f]??u.keys).some(c=>a==c));if(l!=-1){if(e.preventDefault(),this.app.windowManager.getFocusedWindow()?.options?.win_id=="keybind_options"||this.app.windowManager.isBlocked())return;this.app.chartManager[t=="keydown"?"judgeCol":"judgeColUp"](l);return}}const r=Object.keys(We).filter(s=>!["cut","copy","paste","pasteReplace"].includes(s)).filter(s=>{for(const o of this.getCombosForKeybind(s))if(this.compareModifiers(o.mods,n)&&o.key==a)return!0;return!1}).map(s=>We[s]);if(r.length>0){if(r.every(s=>s.preventDefault!=!1)&&e.preventDefault(),this.app.windowManager.getFocusedWindow()?.options?.win_id=="keybind_options"||this.app.windowManager.isBlocked())return;for(const s of r){let o=s.disabled;if(o instanceof Function&&(o=o(this.app)),!o&&!(s.disableRepeat&&e.repeat)){t=="keydown"?s.callback(this.app):s.callbackKeyUp?.(this.app);return}}}}static getKeyNameFromEvent(e){if(e.which>=65&&e.which<=90)return String.fromCharCode(e.which).toUpperCase();let t=e.code;return t.startsWith("Digit")&&(t=t.slice(5)),t.startsWith("Key")&&(t=t.slice(3)),t in pc&&(t=pc[t]),t}static getKeybindString(e){return this.getCombosForKeybind(e).map(t=>this.getComboString(t)).join(" / ")}static getComboString(e){const t=Aa.filter(n=>e.mods.includes(n)).map(n=>mm[n]).join("");return t+(t!=""?" ":"")+(Nu[e.key]??e.key)}static getCombosForKeybind(e){return e in We?this.userKeybinds.get(e)??We[e].combos:(console.log("Couldn't find keybind with id "+e),[])}static getKeysForGameType(e){const t=bt.getGameType(e);return t?new Array(t.numCols).fill(null).map((n,a)=>this.userGameplayKeybinds.get(e)?.[a]??Mi[e]?.[a].keys??[]):(console.log("Couldn't find game type with id "+e),[])}static compareModifiers(e,t){if(e.length!=t.length)return!1;for(const n of Aa)if((e.includes(n)?1:0)+(t.includes(n)?1:0)==1)return!1;return!0}static compareCombos(e,t){return e.key==t.key&&this.compareModifiers(e.mods,t.mods)}static loadKeybinds(){const e=localStorage.getItem("keybinds");if(e){const n=JSON.parse(e);if(typeof n!="object")return console.error("Couldn't load keybinds from storage");for(const[a,r]of Object.entries(n)){if(!(a in We)){console.warn("Couldn't load keybind "+a+": key doesn't exist");continue}Array.isArray(r)||console.warn("Couldn't load keybind "+a+": value is not an array"),this.userKeybinds.set(a,r.filter(s=>typeof s.key!="string"||!Array.isArray(s.mods)?(console.warn("Couldn't load keycombo for keybind "+a+": "+JSON.stringify(s)),!1):!0))}}const t=localStorage.getItem("keybindsGP");if(t){const n=JSON.parse(t);if(typeof n!="object")return console.error("Couldn't load gameplay keybinds from storage");for(const[a,r]of Object.entries(n)){if(!bt.getGameType(a)){console.warn("Couldn't load gameplay keybinds for gameType "+a+": gameType doesn't exist");continue}Array.isArray(r)||console.warn("Couldn't load gameplay keybind "+a+": value is not an array"),this.userGameplayKeybinds.set(a,r.map((s,o)=>!Array.isArray(s)&&s!==null?(console.warn("Couldn't load gameplay keys for type "+a+" col "+o+": "+JSON.stringify(s)),null):s))}}}static clearSave(){localStorage.removeItem("keybinds"),localStorage.removeItem("keybindsGP")}static setKeybind(e,t){this.userKeybinds.has(e)||this.userKeybinds.set(e,[...We[e].combos]),this.userKeybinds.get(e)?.push(t),this.checkIsDefault(e),this.saveKeybinds()}static removeKeybind(e,t){this.userKeybinds.has(e)||this.userKeybinds.set(e,[...We[e].combos]),this.userKeybinds.set(e,this.userKeybinds.get(e).filter(n=>!this.compareCombos(n,t))),this.checkIsDefault(e),this.saveKeybinds()}static revertKeybind(e){this.userKeybinds.delete(e),this.saveKeybinds()}static revertGameplayKeybind(e,t){this.userGameplayKeybinds.has(e)&&(this.userGameplayKeybinds.get(e)[t]=null,this.userGameplayKeybinds.get(e).every(n=>n===null)&&this.userGameplayKeybinds.delete(e)),this.saveKeybinds()}static setGameplayKeybind(e,t,n){this.userGameplayKeybinds.has(e)||this.userGameplayKeybinds.set(e,new Array(bt.getGameType(e).numCols).fill(null)),this.userGameplayKeybinds.get(e)[t]==null&&(this.userGameplayKeybinds.get(e)[t]=[...Mi[e]?.[t].keys??[]]),this.userGameplayKeybinds.get(e)[t].push(n),this.checkIsDefaultGameplay(e,t),this.saveKeybinds()}static removeGameplayKeybind(e,t,n){this.userGameplayKeybinds.has(e)||this.userGameplayKeybinds.set(e,new Array(bt.getGameType(e).numCols).fill(null)),this.userGameplayKeybinds.get(e)[t]==null&&(this.userGameplayKeybinds.get(e)[t]=[...Mi[e]?.[t].keys??[]]),this.userGameplayKeybinds.get(e)[t]=this.userGameplayKeybinds.get(e)[t].filter(a=>a!=n),this.checkIsDefaultGameplay(e,t),this.saveKeybinds()}static checkIsDefault(e){if(!this.userKeybinds.has(e))return!0;const t=this.userKeybinds.get(e),n=[...We[e].combos];return t.length!=n.length?!1:t.map(a=>this.getComboString(a)).sort().join("∆")==n.map(a=>this.getComboString(a)).sort().join("∆")?(this.userKeybinds.delete(e),!0):!1}static checkIsDefaultGameplay(e,t){if(!this.userGameplayKeybinds.has(e)||this.userGameplayKeybinds.get(e)[t]===null)return!0;const n=this.userGameplayKeybinds.get(e)[t],a=[...Mi[e]?.[t].keys??[]];return n.length!=a.length?!1:n.sort().join("∆")==a.sort().join("∆")?(this.userGameplayKeybinds.get(e)[t]=null,this.userGameplayKeybinds.get(e).every(r=>r===null)&&this.userGameplayKeybinds.delete(e),!0):!1}static saveKeybinds(){const e={};for(const[n,a]of this.userKeybinds.entries())e[n]=a;localStorage.setItem("keybinds",JSON.stringify(e));const t={};for(const[n,a]of this.userGameplayKeybinds.entries())t[n]=a;localStorage.setItem("keybindsGP",JSON.stringify(t))}static getKeybindTooltip(e){return this.getCombosForKeybind(e).map(n=>{let a=this.getComboString(n);return a==""?"":(a=a.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"),"<button class='pref-keybind-combo'>"+a+"</button>")}).join("")}static evaluateTaggedTooltip(e,t){t=t.map(a=>a.startsWith("\\")?a.slice(1):this.getKeybindTooltip(a));const n=[];for(let a=0;a<t.length;a++)n.push(e[a]),n.push(t[a]);return n.push(e[t.length+1]),"<div style='display: flex; align-items: center; gap: 0.375rem'>"+n.join("")+"</div>"}static createKeybindTooltip(e){return(t,...n)=>{Xe(e,{allowHTML:!0,onShow:a=>{a.setContent(this.evaluateTaggedTooltip(t,n))}})}}static disableKeybinds(){this.enabled=!1}static enableKeybinds(){this.enabled=!0}}class ct{view;input;options;lastVal="";constructor(e,t){this.view=e,this.view.classList.add("spinner"),this.options={value:0,precision:3,step:null,minPrecision:null,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,...t},this.view.onfocus=()=>{n.focus()};const n=document.createElement("input");n.classList.add("spinner-input"),n.type="text",n.autocomplete="off",n.spellcheck=!1,n.onblur=()=>{if(n.value===this.lastVal)return;if(n.value===""){this.options.onchange?.(void 0);return}const o=Nn(n.value);if(o===null){n.value=this.lastVal;return}const l=ue(Se(o,this.options.min,this.options.max),this.options.precision);n.value=this.formatValue(l),this.options.onchange?.(l)},n.onkeydown=o=>{o.key=="Enter"&&n.blur(),o.key=="Escape"&&(n.value=this.lastVal,n.blur())},n.onfocus=()=>{this.lastVal=n.value},this.input=n,this.value=this.options.value,e.appendChild(n);const a=document.createElement("div");a.classList.add("spinner-btns"),e.appendChild(a);const r=document.createElement("button");r.classList.add("spinner-up"),r.appendChild(me.getIcon("CHEVRON",10)),r.tabIndex=-1,r.onclick=o=>{let l=this.options.step??y.general.spinnerStep;if(o.getModifierState("Shift")&&(l/=10),parseFloat(n.value)+l>this.options.max){n.value=this.formatValue(this.options.max),this.options.onchange?.(this.options.max);return}n.value=this.formatValue(parseFloat(n.value)+l),this.options.onchange?.(parseFloat(n.value))},a.appendChild(r);const s=document.createElement("button");s.classList.add("spinner-down"),s.appendChild(me.getIcon("CHEVRON",10)),s.tabIndex=-1,s.onclick=o=>{let l=this.options.step??y.general.spinnerStep;if(o.getModifierState("Shift")&&(l/=10),parseFloat(n.value)-l<this.options.min){n.value=this.formatValue(this.options.min),this.options.onchange?.(this.options.min);return}n.value=this.formatValue(parseFloat(n.value)-l),this.options.onchange?.(parseFloat(n.value))},a.appendChild(s)}static create(e){return new ct(document.createElement("div"),e)}formatValue(e){const t=e.toString().split(".")[1]?.length??0;return this.options.minPrecision!==null&&this.options.minPrecision>=t?ue(e,this.options.minPrecision).toFixed(this.options.minPrecision):this.options.minPrecision!==null&&this.options.precision>=t?e.toString():ue(e,this.options.precision).toFixed(this.options.precision)}get value(){return parseFloat(this.input.value)}set value(e){parseFloat(this.input.value)!=ue(e,this.options.precision)&&(this.input.value=this.formatValue(e))}get step(){return this.options.step}set step(e){this.options.step=e}get min(){return this.options.min}set min(e){this.options.min=e}get max(){return this.options.max}set max(e){this.options.max=e}get precision(){return this.options.precision}set precision(e){this.options.precision=e}get minPrecision(){return this.options.minPrecision}set minPrecision(e){this.options.minPrecision=e}get onchange(){return this.options.onchange}set onchange(e){this.options.onchange=e}get disabled(){return this.input.disabled}set disabled(e){this.input.disabled=e}}const Tl=["accent-color","editor-bg","widget-bg","editable-overlay-hover","editable-overlay-active","text-color","text-color-secondary","text-color-detail","text-color-disabled","primary-bg","primary-border","primary-bg-active","primary-bg-hover","secondary-bg","secondary-border","secondary-bg-active","secondary-bg-hover","tooltip-bg","input-bg","input-bg-active","input-bg-hover","input-border","navbar-bg","navbar-bg-inactive","window-bg","window-border"],jh=["primary-bg","secondary-bg","text-color","accent-color","widget-bg","editor-bg","editable-overlay-active","input-bg","window-bg"],$h=[{name:"primary-bg",ids:[{id:"primary-bg",label:"base"},{id:"primary-bg-active",label:"active"},{id:"primary-bg-hover",label:"hover"},{id:"primary-border",label:"border"}]},{name:"secondary-bg",ids:[{id:"secondary-bg",label:"base"},{id:"secondary-bg-active",label:"active"},{id:"secondary-bg-hover",label:"hover"},{id:"secondary-border",label:"border"}]},{name:"text-color",ids:[{id:"text-color",label:"primary"},{id:"text-color-secondary",label:"secondary"},{id:"text-color-detail",label:"detail"},{id:"text-color-disabled",label:"disabled"}]},{name:"other",ids:[{id:"accent-color",label:"accent-color"},{id:"widget-bg",label:"widget-bg"},{id:"tooltip-bg",label:"tooltip-bg"},{id:"editor-bg",label:"editor-bg"}]},{name:"editable-overlay",ids:[{id:"editable-overlay-hover",label:"hover"},{id:"editable-overlay-active",label:"active"}]},{name:"input",ids:[{id:"input-bg",label:"background"},{id:"input-bg-active",label:"active"},{id:"input-bg-hover",label:"hover"},{id:"input-border",label:"border"}]},{name:"window",ids:[{id:"window-bg",label:"background"},{id:"window-border",label:"border"}]},{name:"window-navbar",ids:[{id:"navbar-bg",label:"active"},{id:"navbar-bg-inactive",label:"inactive"}]}],Ml={"accent-color":"Color used for focus input rings, confirm buttons","text-color":"Base text color","text-color-secondary":"Secondary text color, used for text in recent files, menubar keybinds","text-color-detail":"Detail text color, used for text in timing event boxes","text-color-disabled":"Used for texts relating to empty/disabled things (ex. no files in directory picker)","primary-bg":"Primary background, used for menubar, context/dropdown menus","primary-border":"","primary-bg-active":"","primary-bg-hover":"","navbar-bg":"Window navbar background","navbar-bg-inactive":"","window-bg":"Window background","window-border":"","secondary-bg":"Secondary background, used for subareas in menus","secondary-border":"","secondary-bg-active":"","secondary-bg-hover":"","editable-overlay-hover":"Overlay on top of editable items (status widget buttons, playback option toggles, textareas)","editable-overlay-active":"","input-bg":"Background color for input","input-bg-active":"","input-bg-hover":"","input-border":"","widget-bg":"Widget background","tooltip-bg":"Color of these tooltips","editor-bg":"Editor background"},Xr={"primary-bg":{"primary-border":function(i){return this.lighten(i,10).setAlpha(187/255)},"primary-bg-active":function(i){return this.lighten(i,10)},"primary-bg-hover":function(i){return this.lighten(i,30)},"widget-bg":function(i){return this.add(i,-50).setAlpha(136/255)},"window-bg":function(i){return this.lighten(i,-10)},"text-color":function(i){return this.average(i)>.5?new F("#000"):new F("#fff")},"input-bg":function(i){return this.average(i)<.5?new F("#000"):new F("#fff")},"input-border":function(i){return this.average(i)>.5?this.add(i,-30).setAlpha(119/255):this.add(i,30).setAlpha(119/255)},"tooltip-bg":function(i){return this.lighten(i,-10).setAlpha(238/255)},"secondary-bg":function(i){return this.lighten(i,-20)},"editor-bg":function(i){return this.lighten(i,-60)}},"window-bg":{"navbar-bg":function(i){return new F(i)}},"secondary-bg":{"secondary-border":function(i){return this.lighten(i,10).setAlpha(187/255)},"secondary-bg-active":function(i){return this.lighten(i,50)},"secondary-bg-hover":function(i){return this.lighten(i,30)}},"navbar-bg":{"navbar-bg-inactive":function(i){return this.lighten(i,-33)}},"text-color":{"text-color-secondary":function(i){return new F(i).setAlpha(119/255)},"text-color-detail":function(i){return new F(i).setAlpha(68/255)},"text-color-disabled":function(i){return new F(i).setAlpha(136/255)}},"input-bg":{"input-border":function(i){return this.lighten(i,10).setAlpha(187/255)},"input-bg-active":function(i){return this.lighten(i,50)},"input-bg-hover":function(i){return this.lighten(i,30)}}},zi={default:{"accent-color":new F("rgb(23, 131, 208)"),"text-color":new F("#fff"),"text-color-secondary":new F("#888"),"text-color-detail":new F("#757a89"),"text-color-disabled":new F("#888"),"primary-bg":new F("#555"),"primary-border":new F("#444"),"primary-bg-active":new F("#575757"),"primary-bg-hover":new F("#666"),"navbar-bg":new F("#3d3d3d"),"navbar-bg-inactive":new F("#626262"),"window-bg":new F("#3d3d3d"),"window-border":new F("#00000000"),"secondary-bg":new F("#373737"),"secondary-border":new F("#333"),"secondary-bg-active":new F("#555"),"secondary-bg-hover":new F("#454545"),"editable-overlay-hover":new F("rgb(255, 255, 255, 0.1)"),"editable-overlay-active":new F("rgb(255, 255, 255, 0.2)"),"input-bg":new F("rgba(35, 35, 35, 0.309)"),"input-bg-active":new F("rgba(50, 50, 50, 0.309)"),"input-bg-hover":new F("rgba(79, 79, 79, 0.309)"),"input-border":new F("rgba(0, 0, 0, 0.3)"),"widget-bg":new F("rgba(0, 0, 0, 0.5)"),"tooltip-bg":new F("rgba(20, 20, 20, 0.95)"),"editor-bg":new F("#18191c")},dusk:{"accent-color":new F("#b34e97ff"),"text-color":new F("#ffffffff"),"text-color-secondary":new F("#ffffff77"),"text-color-detail":new F("#ffffff44"),"text-color-disabled":new F("#ffffff88"),"primary-bg":new F("#1b0131ff"),"primary-border":new F("#1e0136bb"),"primary-bg-active":new F("#2f0057ff"),"primary-bg-hover":new F("#230140ff"),"navbar-bg":new F("#18012cff"),"navbar-bg-inactive":new F("#10011dff"),"window-bg":new F("#18012cff"),"window-border":new F("#00000000"),"secondary-bg":new F("#160127ff"),"secondary-border":new F("#18012bbb"),"secondary-bg-active":new F("#310a52ff"),"secondary-bg-hover":new F("#25033fff"),"editable-overlay-hover":new F("#e79dff1a"),"editable-overlay-active":new F("#e79dff33"),"input-bg":new F("#000000ff"),"input-bg-active":new F("#000000ff"),"input-bg-hover":new F("#000000ff"),"input-border":new F("#391f4f77"),"widget-bg":new F("#00000088"),"tooltip-bg":new F("#18012cee"),"editor-bg":new F("#0b0014ff")},nord:{"accent-color":new F("#1783d0ff"),"text-color":new F("#d9dee8ff"),"text-color-secondary":new F("#d9dee878"),"text-color-detail":new F("#d9dee845"),"text-color-disabled":new F("#d9dee887"),"primary-bg":new F("#2e3440ff"),"primary-border":new F("#323946ba"),"primary-bg-active":new F("#636d83ff"),"primary-bg-hover":new F("#485061ff"),"navbar-bg":new F("#292e39ff"),"navbar-bg-inactive":new F("#2f333cff"),"window-bg":new F("#292e39ff"),"window-border":new F("#00000000"),"secondary-bg":new F("#242933ff"),"secondary-border":new F("#272d38ba"),"secondary-bg-active":new F("#444d5fff"),"secondary-bg-hover":new F("#3f4755ff"),"editable-overlay-hover":new F("#ffffff1a"),"editable-overlay-active":new F("#ffffff33"),"input-bg":new F("#1212124f"),"input-bg-active":new F("#141414ff"),"input-bg-hover":new F("#171717ff"),"input-border":new F("#121212ff"),"widget-bg":new F("#00020e87"),"tooltip-bg":new F("#292e39ed"),"editor-bg":new F("#18191cff")},light:{"accent-color":new F("#ff594cff"),"text-color":new F("#000000ff"),"text-color-secondary":new F("#00000078"),"text-color-detail":new F("#00000045"),"text-color-disabled":new F("#00000087"),"primary-bg":new F("#ffffffff"),"primary-border":new F("#b5b5b5ff"),"primary-bg-active":new F("#ebebebff"),"primary-bg-hover":new F("#ffd4d1ff"),"navbar-bg":new F("#edededff"),"navbar-bg-inactive":new F("#d1d1d1ff"),"window-bg":new F("#edededff"),"window-border":new F("#00000000"),"secondary-bg":new F("#d9d9d9ff"),"secondary-border":new F("#c7c7c7ff"),"secondary-bg-active":new F("#f0f0f0ff"),"secondary-bg-hover":new F("#e3e3e3ff"),"editable-overlay-hover":new F("#ff594c3d"),"editable-overlay-active":new F("#ff594c73"),"input-bg":new F("#ebebebff"),"input-bg-active":new F("#e0e0e0ff"),"input-bg-hover":new F("#ffffffff"),"input-border":new F("#9e9e9eff"),"widget-bg":new F("#f7f7f7e5"),"tooltip-bg":new F("#ffffffff"),"editor-bg":new F("#cfcfcfff")},rust:{"accent-color":new F("#b37100ff"),"text-color":new F("#ffd7bdf2"),"text-color-secondary":new F("#ffd7bd78"),"text-color-detail":new F("#ffd7bd45"),"text-color-disabled":new F("#ffd7bd87"),"primary-bg":new F("#3c2e2aff"),"primary-border":new F("#42332eff"),"primary-bg-active":new F("#68524bff"),"primary-bg-hover":new F("#4e3c37ff"),"navbar-bg":new F("#362926ff"),"navbar-bg-inactive":new F("#241b19ff"),"window-bg":new F("#58413cff"),"window-border":new F("#00000000"),"secondary-bg":new F("#40302ba1"),"secondary-border":new F("#46352fff"),"secondary-bg-active":new F("#614a42ff"),"secondary-bg-hover":new F("#533e38ff"),"editable-overlay-hover":new F("#fff8e01a"),"editable-overlay-active":new F("#fff8e033"),"input-bg":new F("#231515ff"),"input-bg-active":new F("#271717ff"),"input-bg-hover":new F("#2e1b1bff"),"input-border":new F("#4b413fff"),"widget-bg":new F("#311e1cdd"),"tooltip-bg":new F("#362926ff"),"editor-bg":new F("#181211ff")},tron:{"accent-color":new F("#00ccffff"),"text-color":new F("#ffffffff"),"text-color-secondary":new F("#ffffffe4"),"text-color-detail":new F("#ffffff5b"),"text-color-disabled":new F("#ffffff88"),"primary-bg":new F("#000000ff"),"primary-border":new F("#ff7b00c9"),"primary-bg-active":new F("#00e1ff98"),"primary-bg-hover":new F("#ff751a5a"),"navbar-bg":new F("#000000ff"),"navbar-bg-inactive":new F("#000000ff"),"window-bg":new F("#000000ff"),"window-border":new F("#ff880085"),"secondary-bg":new F("#121212ff"),"secondary-border":new F("#ff8800aa"),"secondary-bg-active":new F("#00e1ffa3"),"secondary-bg-hover":new F("#ff7e145a"),"editable-overlay-hover":new F("#ffffff1a"),"editable-overlay-active":new F("#ffffff33"),"input-bg":new F("#000000ff"),"input-bg-active":new F("#000000ff"),"input-bg-hover":new F("#000000ff"),"input-border":new F("#1e1e1eff"),"widget-bg":new F("#000000ad"),"tooltip-bg":new F("#000000ff"),"editor-bg":new F("#000000ff")},gilded:{"accent-color":new F("#ffc014ff"),"text-color":new F("#e6e6e6ff"),"text-color-secondary":new F("#ffffff6b"),"text-color-detail":new F("#e6e6e645"),"text-color-disabled":new F("#e6e6e687"),"primary-bg":new F("#232325ff"),"primary-border":new F("#272729ff"),"primary-bg-active":new F("#ffc0145b"),"primary-bg-hover":new F("#ffc01421"),"navbar-bg":new F("#202021ff"),"navbar-bg-inactive":new F("#151516ff"),"window-bg":new F("#202021ff"),"window-border":new F("#00000000"),"secondary-bg":new F("#1c1c1eff"),"secondary-border":new F("#1f1f21ff"),"secondary-bg-active":new F("#1f1f21ff"),"secondary-bg-hover":new F("#242427ff"),"editable-overlay-hover":new F("#ffffff1a"),"editable-overlay-active":new F("#ffffff33"),"input-bg":new F("#0d0d0dff"),"input-bg-active":new F("#0e0e0eff"),"input-bg-hover":new F("#111111ff"),"input-border":new F("#0e0e0eff"),"widget-bg":new F("#171717db"),"tooltip-bg":new F("#202021ff"),"editor-bg":new F("#0e0e0fff")}};class Fe{static _themes=zi;static _userThemes={};static _initialized=!1;static style;static currentTheme;static initialize(){this._createThemeStyle(),this._loadUserThemes(),this._initialized=!0}static _createThemeStyle(){const e=document.createElement("style");document.getElementsByTagName("head")[0].appendChild(e),this.style=e}static _loadUserThemes(){let e={};try{e=JSON.parse(localStorage.getItem("themes")??"{}")}catch{console.warn("Error loading user themes")}const t={};for(const[n,a]of Object.entries(e))t[n]=this.validateTheme(a);this._userThemes=t}static _saveUserThemes(){const e=Object.fromEntries(Object.entries(this._userThemes).map(([t,n])=>[t,this.convertThemeToString(n)]));localStorage.setItem("themes",JSON.stringify(e))}static validateTheme(e){const t={...zi.default};if(typeof e!="object")return t;for(const n of Tl)if(e[n]!==void 0)try{t[n]=new F(e[n])}catch{console.warn(`Invalid color ${e[n]} for ${n}`)}return t}static getThemes(){return{...this._themes,...this._userThemes}}static getBuiltinThemes(){return this._themes}static getUserThemes(){return this._userThemes}static loadTheme(e){this._initialized||this.initialize();let t=this.getThemes()[e];t||(de.createFormatted("Error loading theme: Invalid theme id","error"),t=zi.default),y.general.theme=e,this._applyTheme(t)}static _applyTheme(e){const t=`body{${Tl.map(n=>`--${n}: ${(e[n]??zi.default[n]).toHexa()};`).join("")}}`;this.style.innerHTML=t,this.currentTheme={...e},re.emit("themeChanged")}static loadThemeFromColors(e){this._applyTheme(this.validateTheme(e))}static getCurrentTheme(){return this.currentTheme}static convertThemeToString(e){return Object.fromEntries(Object.entries(e).map(([t,n])=>[t,n.toHexa()]))}static exportCurrentTheme(e){return e={code:!1,spaces:!1,...e},e.code?JSON.stringify(Object.fromEntries(Object.entries(this.currentTheme).map(([t,n])=>[t,`^new Color('${n.toHexa()}')^`])),null,e.spaces?2:0).replaceAll('"^',"").replaceAll('^"',""):JSON.stringify(this.convertThemeToString(this.currentTheme),null,e.spaces?2:0)}static createUserTheme(e,t){this.getThemes()[e]===void 0&&(t?this._userThemes[e]={...t}:this._userThemes[e]={...zi.default},this._saveUserThemes())}static setUserTheme(e,t){this._userThemes[e]!==void 0&&(this._userThemes[e]={...t},this._saveUserThemes())}static deleteUserTheme(e){this._userThemes[e]!==void 0&&(delete this._userThemes[e],this.loadTheme("default"),this._saveUserThemes())}static renameUserTheme(e,t){this._userThemes[e]!==void 0&&this.getThemes()[t]===void 0&&(this._userThemes[t]=this._userThemes[e],delete this._userThemes[e],this._saveUserThemes())}static parseThemeText(e){let t;try{t=JSON.parse(e)}catch{return null}return this.validateTheme(t)}static getColor(e){return this.currentTheme?.[e]??zi.default[e]}}function ro(i,e,t){return(i<<16)+(e<<8)+t}function so(i,e){let t=i>>16,n=i>>8&255,a=i&255;return t=Se(Math.round(t*e),0,255),n=Se(Math.round(n*e),0,255),a=Se(Math.round(a*e),0,255),ro(t,n,a)}function Yh(i,e){let t=i>>16,n=i>>8&255,a=i&255;return t=Se(Math.round(t+e),0,255),n=Se(Math.round(n+e),0,255),a=Se(Math.round(a+e),0,255),ro(t,n,a)}function Bs(i){return(i.red+i.green+i.blue)/3}function Ba(i,e,t){const[n,a,r]=i.match(/\w\w/g).map(d=>parseInt(d,16)),[s,o,l]=e.match(/\w\w/g).map(d=>parseInt(d,16)),u=Math.round(n+(s-n)*t).toString(16).padStart(2,"0"),f=Math.round(a+(o-a)*t).toString(16).padStart(2,"0"),c=Math.round(r+(l-r)*t).toString(16).padStart(2,"0");return"#"+u+f+c}function jt(i,e,t){const n=et(i.red,e.red,t),a=et(i.green,e.green,t),r=et(i.blue,e.blue,t),s=et(i.alpha,e.alpha,t);return new F([n,a,r,s])}const Pn=new Map;re.on("themeChanged",()=>{for(const[i,e]of Pn.entries()){const t=Fe.getColor(i);e.forEach(n=>{n.destroyed||(n.tint=t.toNumber(),n.alpha=t.alpha)}),Pn.set(i,e.filter(n=>!n.destroyed))}});function ze(i,e){Pn.has(e)||Pn.set(e,[]),Pn.get(e).push(i);const t=Fe.getColor(e);i.tint=t.toNumber(),i.alpha=t.alpha}function Zr(i){const{r:e,g:t,b:n,a}=i.toRgba(),r=Math.max(e,t,n),s=Math.min(e,t,n);let o=0,l=0;const u=(r+s)/2;if(r==s)o=l=0;else{const f=r-s;switch(l=u>.5?f/(2-r-s):f/(r+s),r){case e:o=(t-n)/f+(t<n?6:0);break;case t:o=(n-e)/f+2;break;case n:o=(e-t)/f+4;break}o/=6}return[o,l,u,a]}function ca(i){const{r:e,g:t,b:n,a}=i.toRgba(),r=Math.max(e,t,n),s=Math.min(e,t,n);let o=0,l=0;const u=r,f=r-s;if(l=r==0?0:f/r,r==s)o=0;else{switch(r){case e:o=(t-n)/f+(t<n?6:0);break;case t:o=(n-e)/f+2;break;case n:o=(e-t)/f+4;break}o/=6}return[o,l,u,a]}function qn(i,e){try{return new F(i)}catch{return new F("black")}}class eu extends HTMLDivElement{colorElement;set color(e){this.colorElement.style.background=e.toHexa()}}function Qr(){const i=document.createElement("div");i.classList.add("color-picker-transparent"),Object.setPrototypeOf(i,eu.prototype);const e=document.createElement("div");return e.style.width="100%",e.style.height="100%",i.colorElement=e,i.appendChild(e),i}class ln extends HTMLDivElement{inputs;opts;getValue;onupdate;static create(e){const t=document.createElement("div");Object.setPrototypeOf(t,ln.prototype),t.opts=e.inputs,t.inputs={},t.getValue=e.getValue.bind(t),t.onupdate=e.onupdate,t.classList.add("color-format");const n=document.createElement("div");n.classList.add("color-format-label"),n.innerText=e.label;const a=document.createElement("div");return a.classList.add("color-format-inputs"),Object.entries(e.inputs).forEach(([r,s])=>{const o=document.createElement("input");o.type="text";let l="";o.onfocus=()=>{l=o.value},o.onkeydown=u=>{u.key=="Enter"&&(o.blur(),u.preventDefault()),u.key=="Escape"&&(o.value=l,o.blur(),u.stopImmediatePropagation())},o.oninput=()=>{s.isValid(o.value)!==null&&t.onupdate?.(t.getValue())},o.onblur=()=>{const u=s.isValid(o.value);u===null?o.value=l:o.value=u,t.onupdate?.(t.getValue())},t.inputs[r]=o,a.appendChild(o)}),t.replaceChildren(n,a),t}setValue(e){Object.entries(this.inputs).forEach(([t,n])=>{document.activeElement!=n&&(n.value=this.opts[t].setValue(e))})}}const It=(i,e,t)=>n=>{t!==void 0&&n.endsWith(t)&&(n=n.slice(0,n.length-t.length));let a;try{a=parseInt(n)}catch{return null}return Se(a,i,e)+""},Rt=(i,e,t,n)=>{let a;n!==void 0&&i.endsWith(n)&&(i=i.slice(0,i.length-n.length));try{a=parseInt(i)}catch{return e}return Se(a,e,t)};class $a extends eu{_value;_hue=0;_sat=0;_val=0;_alp=1;popup;matrix;matrixDot;matrixDragging=!1;hueDragging=!1;hueThumb;alphaDragging=!1;alphaBg;alphaThumb;previewNew;formats=[];onColorChange;static create(e){const t=Qr();return Object.setPrototypeOf(t,$a.prototype),t.value=qn(e.value),t.classList.add("color-picker"),t.formats=[],e.height!==void 0&&(t.style.height=e.height/16+"rem"),e.width!==void 0&&(t.style.width=e.width/16+"rem"),t.addEventListener("click",()=>{t.createPopup()}),t}updatePreview(){this.color=this._value}get value(){return this._value}set value(e){this._value=e;const t=ca(this._value);this._hue=t[0],this._sat=t[1],this._val=t[2],this._alp=t[3],this.updatePreview(),this.updatePopup()}get hue(){return this._hue}set hue(e){this._hue=e,this.updateColor()}get sat(){return this._sat}set sat(e){this._sat=e,this.updateColor()}get val(){return this._val}set val(e){this._val=e,this.updateColor()}get alpha(){return this._alp}set alpha(e){this._alp=e,this.updateColor()}updateColor(){this._value=new F({h:this._hue*360,s:this._sat*100,v:this._val*100,a:this._alp}),this.updatePreview(),this.updatePopup()}createPopup(){if(this.popup){this.closePopup();return}const e=document.createElement("div");e.classList.add("color-picker-popup");const t=document.createElement("div");t.classList.add("color-picker-area");const[n,a]=this.createMatrix();this.matrix=n,this.matrixDot=a,a.style.background="#f00";const[r,s]=this.createSlider({ondrag:()=>this.hueDragging=!0,offdrag:()=>this.hueDragging=!1,change:C=>{this.hue=C,this.onColorChange?.(this._value)}});this.hueThumb=s,r.style.background="linear-gradient(to right, red 0%, #ff0 17%, lime 33%, cyan 50%, blue 66%, #f0f 83%, red 100%)";const[o,l]=this.createSlider({ondrag:()=>this.alphaDragging=!0,offdrag:()=>this.alphaDragging=!1,change:C=>{this.alpha=C,this.onColorChange?.(this._value)}});this.alphaThumb=l,o.classList.add("color-picker-transparent");const u=document.createElement("div");u.classList.add("color-slider"),o.appendChild(u),this.alphaBg=u,t.replaceChildren(n,r,o);const f=document.createElement("div");f.classList.add("color-picker-area");const c=ln.create({label:"HEX",inputs:{hex:{setValue:C=>C.alpha!=1?C.toHexa():C.toHex(),isValid:C=>{const B=/#?([0-9a-fA-F]+)/.exec(C);return B&&[3,4,6,8].includes(B[1].length)?(C[0]!="#"&&(C="#"+C),C):null}}},getValue(){let C=this.inputs.hex.value;return C[0]!="#"&&(C="#"+C),new F(C)},onupdate:C=>{this.value=C,this.onColorChange?.(this._value)}});this.formats.push(c),f.appendChild(c);const d=ln.create({label:"RGBA",inputs:{r:{setValue:C=>Math.round(C.red*255).toString(),isValid:It(0,255)},g:{setValue:C=>Math.round(C.green*255).toString(),isValid:It(0,255)},b:{setValue:C=>Math.round(C.blue*255).toString(),isValid:It(0,255)},a:{setValue:C=>Math.round(C.alpha*100)+"%",isValid:It(0,100,"%")}},getValue(){return new F({r:Rt(this.inputs.r.value,0,255),g:Rt(this.inputs.g.value,0,255),b:Rt(this.inputs.b.value,0,255),a:Rt(this.inputs.a.value,0,100,"%")/100})},onupdate:C=>{this.value=C,this.onColorChange?.(this._value)}});this.formats.push(d),f.appendChild(d);const h=ln.create({label:"HSVA",inputs:{h:{setValue:C=>Math.round(ca(C)[0]*360)+"º",isValid:It(0,360,"º")},s:{setValue:C=>Math.round(ca(C)[1]*100)+"%",isValid:It(0,100,"%")},v:{setValue:C=>Math.round(ca(C)[2]*100)+"%",isValid:It(0,100,"%")},a:{setValue:C=>Math.round(C.alpha*100)+"%",isValid:It(0,100,"%")}},getValue(){return new F({h:Rt(this.inputs.h.value,0,360,"º"),s:Rt(this.inputs.s.value,0,100,"%"),v:Rt(this.inputs.v.value,0,100,"%"),a:Rt(this.inputs.a.value,0,100,"%")/100})},onupdate:C=>{this.value=C,this.onColorChange?.(this._value)}});this.formats.push(h),f.appendChild(h);const p=ln.create({label:"HSLA",inputs:{h:{setValue:C=>Math.round(Zr(C)[0]*360)+"º",isValid:It(0,360,"º")},s:{setValue:C=>Math.round(Zr(C)[1]*100)+"%",isValid:It(0,100,"%")},l:{setValue:C=>Math.round(Zr(C)[2]*100)+"%",isValid:It(0,100,"%")},a:{setValue:C=>Math.round(C.alpha*100)+"%",isValid:It(0,100,"%")}},getValue(){return new F({h:Rt(this.inputs.h.value,0,360,"º"),s:Rt(this.inputs.s.value,0,100,"%"),l:Rt(this.inputs.l.value,0,100,"%"),a:Rt(this.inputs.a.value,0,100,"%")/100})},onupdate:C=>{this.value=C,this.onColorChange?.(this._value)}});this.formats.push(p),f.appendChild(p);const m=document.createElement("div");m.classList.add("color-picker-preview");const g=Qr(),b=Qr();b.color=this._value,g.color=this._value,m.replaceChildren(g,b),this.previewNew=g,f.appendChild(m),e.replaceChildren(t,f),this.popup=e,this.updatePopup();const x=this._value,w=C=>{C.key=="Escape"&&(C.stopImmediatePropagation(),window.removeEventListener("keydown",w),window.removeEventListener("mousedown",E),this.closePopup(),this.value=x,this.onColorChange?.(this._value))},E=C=>{e.contains(C.target)||(window.removeEventListener("keydown",w),window.removeEventListener("mousedown",E),this.closePopup())};window.addEventListener("keydown",w),window.addEventListener("mousedown",E),document.getElementById("popups").appendChild(e),setTimeout(()=>this.movePosition())}updatePopup(){if(!this.popup)return;this.matrix.style.backgroundColor=`hsl(${this._hue*360} 100% 50%)`,this.matrixDot.style.backgroundColor=this._value.toHex(),this.matrixDragging||(this.matrixDot.style.left=this._sat*200/16+"rem",this.matrixDot.style.top=(1-this._val)*200/16+"rem"),this.hueDragging||(this.hueThumb.style.left=this._hue*200/16+"rem");const e=`rgba(${this._value.red*255}, ${this._value.green*255}, ${this._value.blue*255}`;this.alphaBg.style.background=`linear-gradient(to right, ${e}, 0 ), ${e}, 1))`,this.alphaDragging||(this.alphaThumb.style.left=this._alp*200/16+"rem"),this.formats.forEach(t=>t.setValue(this._value)),this.previewNew.color=this._value}closePopup(){const e=this.popup;this.popup=void 0,e&&(e.classList.add("exiting"),setTimeout(()=>{e.remove()},500))}createMatrix(){const e=document.createElement("div");e.classList.add("color-matrix"),e.style.backgroundColor="#ff0000";const t=document.createElement("div");t.classList.add("color-matrix-x");const n=document.createElement("div");n.classList.add("color-matrix-y");const a=document.createElement("div");a.classList.add("color-matrix-dot"),e.appendChild(a),e.replaceChildren(t,n,a),e.onmousedown=o=>{window.addEventListener("mousemove",r),window.addEventListener("mouseup",s),r(o),this.matrixDragging=!0};const r=o=>{const l=e.getBoundingClientRect(),u=Se((o.clientX-l.left)/l.width,0,1),f=Se((o.clientY-l.top)/l.height,0,1);a.style.left=u*l.width+"px",a.style.top=f*l.height+"px",this._sat=u,this.val=1-f,this.onColorChange?.(this._value)},s=()=>{window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",s),this.matrixDragging=!1};return[e,a]}createSlider(e){const t=document.createElement("div");t.classList.add("color-slider");const n=document.createElement("div");n.classList.add("color-slider-thumb"),t.appendChild(n),t.onmousedown=s=>{window.addEventListener("mousemove",a),window.addEventListener("mouseup",r),a(s),e.ondrag?.(),this.onColorChange?.(this._value)};const a=s=>{const o=t.getBoundingClientRect(),l=Se((s.clientX-o.left)/o.width,0,1);n.style.left=l*o.width+"px",e.change(l)},r=()=>{window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",r),e.offdrag?.()};return[t,n]}movePosition(){const e=this.getBoundingClientRect(),t=e.left+e.width/2-this.popup.clientWidth/2,n=e.top+e.height+10,a=15,r=window.innerWidth-this.popup.clientWidth-15;this.popup.style.left=`${Se(t,a,r)}px`,this.popup.style.top=`${n}px`,n+this.popup.clientHeight>window.innerHeight-15&&(this.popup.style.transformOrigin="bottom center",this.popup.style.top=`${e.top-this.popup.clientHeight-10}px`)}isActive(){return this.popup!==void 0}}class Li{view;slider;text;options;constructor(e,t){this.view=e,this.options=t,this.view.classList.add("slider");const n=document.createElement("input");n.classList.add("slider-input"),n.type="range",n.min=t.min.toString(),n.max=t.max.toString(),n.step=t.step.toString(),n.value=(t.value??(t.min+t.max)/2).toString(),n.oninput=()=>{a.innerText=this.formatValue(parseFloat(n.value))+"",this.options.onChange?.(parseFloat(n.value))},t.width!==void 0&&(n.style.width=t.width/16+"rem"),this.slider=n,e.appendChild(n);const a=document.createElement("div");a.innerText=this.formatValue(parseFloat(n.value))+"",a.style.width=`${(this.options.displayWidth??32)/16}rem`,this.text=a,e.appendChild(a)}get value(){return parseFloat(this.slider.value)}setValue(e){this.slider.value=e+"",this.text.innerText=this.formatValue(parseFloat(this.slider.value))+""}static create(e){return new Li(document.createElement("div"),e)}formatValue(e){return this.options.transformer?this.options.transformer(e):this.options.precision===void 0?ue(e,3).toString():ue(e,this.options.precision).toFixed(this.options.precision)}}function tu(i,e,t){switch(e.type){case"checkbox":{const n=document.createElement("input"),a=e.onChange;return n.type="checkbox",n.checked=t,n.onblur=null,n.onchange=()=>{a?.(i,n.checked)},n.classList.add("pref-input","right"),n.onkeydown=r=>{r.key=="Enter"&&n.blur()},n}case"dropdown":if(e.advanced){const n=e.transformers.deserialize,a=e.transformers.serialize,r=e.onChange,s=hi.create(e.items,a(t));return s.onChange(o=>{r?.(i,n(o))}),s.view}else{const n=e.onChange,a=hi.create(e.items,t);return a.onChange(r=>{n?.(i,r)}),a.view}case"number":{const n=e.transformers?.deserialize??(o=>o),a=e.transformers?.serialize??(o=>o),r=e.onChange,s=ct.create({value:a(t),...e,onchange:o=>{if(!o){s.value=a(o);return}r?.(i,n(o))}});return s.view}case"slider":{const n=e.transformers?.deserialize??(c=>c),a=e.transformers?.serialize??(c=>c),r=e.onChange,s=document.createElement("div");s.style.display="flex",s.style.alignItems="center";const o=document.createElement("input");o.type="range",o.min=e.min?.toString()??"",o.max=e.max?.toString()??"",o.step=e.step?.toString()??"1",o.value=a(t).toString();const l=document.createElement("input");l.type="text",l.value=(Math.round(a(t)*1e3)/1e3).toString();const u=e.hardMin??e.min??-Number.MAX_VALUE,f=e.hardMax??e.max??Number.MAX_VALUE;return l.onblur=()=>{let c=Nn(l.value);if(c===null){l.value=(Math.round(a(t)*1e3)/1e3).toString();return}c=Se(c,u,f),l.value=ue(c,3).toString(),l.blur(),l.value==""&&(l.value=a(c).toString()),o.value=c.toString(),r?.(i,n(c))},o.oninput=()=>{const c=parseFloat(o.value);l.value=ue(c,3).toString(),r?.(i,n(c))},l.style.width="3rem",l.onkeydown=c=>{c.key=="Enter"&&l.blur()},s.appendChild(o),s.appendChild(l),s}case"display-slider":{const n=e.transformers?.deserialize??(l=>l),a=e.transformers?.serialize??(l=>l),r=e.transformers?.display??(l=>l),s=e.onChange;return Li.create({...e,value:a(t),transformer:l=>r(l),onChange:l=>{s?.(i,n(l))}}).view}case"text":{const n=e.onChange,a=document.createElement("input");return a.type="text",a.value=t.toString(),a.onblur=()=>{n?.(i,a.value)},a.onkeydown=r=>{r.key=="Enter"&&a.blur()},a}case"color":{const n=e.onChange,a=$a.create({value:t});return a.onColorChange=r=>{n?.(i,r)},a}}}class Kh extends ot{app;captureOptions={aspectRatio:4/3,videoHeight:720,fps:60,bitrate:4e6,playbackRate:1,assistTick:!1,metronome:!1,hideBarlines:!1};startBeat=0;endBeat=1;presetDropdown;exportButton;optionsView;captureView;captureCanvas;videoContainer;progressLabel;progressBar;currentCapture;videoURL;stopButton;returnButton;downloadButton;estimateInterval;regionHandler;constructor(e){super({title:"Export Recording",width:600,height:400,disableClose:!1,win_id:"capture",blocking:!1}),this.app=e,this.app.chartManager.startRegion!==void 0&&this.app.chartManager.endRegion!==void 0?(this.startBeat=this.app.chartManager.startRegion,this.endBeat=this.app.chartManager.endRegion):(this.startBeat=0,this.endBeat=this.app.chartManager.loadedChart.getLastBeat()),this.initView()}onClose(){re.off("regionChanged",this.regionHandler),this.currentCapture&&this.currentCapture.stop()}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");if(e.classList.add("padding"),this.initOptionsView(),this.initCaptureView(),e.replaceChildren(this.optionsView,this.captureView),!VideoEncoder||!AudioEncoder){const t=document.createElement("div");t.classList.add("capture-error");const n=document.createElement("h3");n.innerText="Your browser doesn't seem to support web encoding.";const a=document.createElement("p");a.innerText="Please try a different browser or use the desktop app.",t.replaceChildren(n,a),this.optionsView.style.filter="blur(10px)",this.optionsView.style.pointerEvents="none",e.appendChild(t),this.exportButton.disabled=!0}this.viewElement.appendChild(e)}initOptionsView(){const e=document.createElement("div");e.classList.add("capture-options-container");const t=document.createElement("div");t.style.display="flex",t.style.flexDirection="row",t.style.gap="2rem",t.style.alignItems="flex-start";const n=document.createElement("div");n.classList.add("capture-options");const a=document.createElement("div");a.classList.add("capture-options-label"),a.innerText="Record Range";const{item:r,update:s}=this.buildBeatSecondInput("Start",m=>{this.startBeat=m,this.startBeat>this.endBeat&&(this.startBeat=this.endBeat,s(this.startBeat)),this.updateSizeEstimate()}),{item:o,update:l}=this.buildBeatSecondInput("End",m=>{this.endBeat=m,this.endBeat<this.startBeat&&(this.endBeat=this.startBeat,l(this.endBeat)),this.updateSizeEstimate()});s(this.startBeat),l(this.endBeat);const u=(m,g)=>{this.startBeat=m,this.endBeat=g,s(m),l(g)};this.regionHandler=u.bind(this),re.on("regionChanged",this.regionHandler),n.replaceChildren(a,r,o);let f=this.buildOptions("Video Options",kl);const c=this.buildOptions("View Options",Zd),d=document.createElement("div");d.classList.add("pref-item");const h=document.createElement("div");h.classList.add("pref-item-label","label"),h.innerText="Quality Preset",this.presetDropdown=hi.create(["Minimal","Low","Medium","High"],"Medium"),this.presetDropdown.onChange(m=>{const g=()=>{const b=this.buildOptions("Video Options",kl);b.firstElementChild?.insertAdjacentElement("afterend",d),f.replaceWith(b),f=b,this.updateSizeEstimate()};switch(m){case"Minimal":this.captureOptions={...this.captureOptions,videoHeight:360,fps:24,bitrate:1e6},g();break;case"Low":this.captureOptions={...this.captureOptions,videoHeight:480,fps:30,bitrate:25e5},g();break;case"Medium":this.captureOptions={...this.captureOptions,videoHeight:720,fps:60,bitrate:4e6},g();break;case"High":this.captureOptions={...this.captureOptions,videoHeight:1080,fps:60,bitrate:8e6},g();break}}),f.firstElementChild?.insertAdjacentElement("afterend",d),d.replaceChildren(h,this.presetDropdown.view),t.replaceChildren(f,c);const p=document.createElement("button");p.innerText="Export Recording",p.classList.add("confirm"),p.onclick=async()=>{this.startCapture()},this.exportButton=p,e.replaceChildren(n,t,p),this.optionsView=e,this.updateSizeEstimate()}initCaptureView(){const e=document.createElement("div");e.classList.add("capture-view");const t=document.createElement("div");t.classList.add("capture-video-container");const n=document.createElement("canvas");n.width=560,n.height=320,n.style.width="35rem",n.style.height="20rem",n.style.filter="brightness(0.6) saturate(0.5)",t.appendChild(n);const a=document.createElement("div");a.classList.add("capture-video-overlay");const r=document.createElement("div");r.innerText="Rendering...",r.style.textAlign="center",this.progressLabel=r,a.appendChild(r);const s=document.createElement("div");s.classList.add("capture-progress-bar"),this.progressBar=s,a.appendChild(s),t.appendChild(a);const o=document.createElement("div");o.style.display="flex",o.style.flexDirection="row",o.style.gap="1rem",o.style.justifyContent="center",o.style.marginTop="1rem";const l=document.createElement("button");l.innerText="Stop exporting",l.classList.add("delete"),l.style.flex="1",l.onclick=()=>{this.currentCapture&&(this.currentCapture.stop(),l.disabled=!0)},this.stopButton=l;const u=document.createElement("button");u.innerText="Export another video",u.style.flex="1",u.onclick=()=>{this.captureView.style.display="none",this.optionsView.style.display="",this.videoContainer.childNodes.forEach(c=>{c.style.display="",c instanceof HTMLVideoElement&&(URL.revokeObjectURL(c.src),c.pause(),c.remove())})},u.style.display="none",this.returnButton=u;const f=document.createElement("button");f.innerText="Download video",f.style.flex="1",f.classList.add("confirm"),f.onclick=()=>{if(this.videoURL){const c=document.createElement("a");c.href=this.videoURL;const d=new Date;c.download=`SME-${d.toISOString().slice(0,10)}-${d.toTimeString().slice(0,8).replaceAll(":","-")}.mp4`,c.click()}},f.style.display="none",this.downloadButton=f,o.replaceChildren(l,u,f),e.replaceChildren(t,o),this.captureCanvas=n,this.videoContainer=t,this.captureView=e,e.style.display="none"}startCapture(){xe.disableKeybinds(),this.stopButton.disabled=!1,this.stopButton.style.display="",this.returnButton.style.display="none",this.downloadButton.style.display="none",this.setDisableClose(!0),this.setBlocking(!0);const e=this.captureCanvas.getContext("2d"),t=[];let n=-1,a=0;this.estimateInterval=setInterval(()=>{if(!this.currentCapture)return;const r=this.currentCapture.currentRenderFrame-this.currentCapture.currentEncodeQueue;t.push(r-a),a=r,t.length>20&&t.shift();const o=t.reduce((u,f)=>u+f,0)/t.length,l=this.currentCapture.totalFrames-r;n=Math.round(l/o)},1e3),this.captureView.style.display="",this.optionsView.style.display="none";try{const r=new qh(this.app,{...this.captureOptions,startTime:this.app.chartManager.loadedChart.getSecondsFromBeat(this.startBeat)-1,endTime:this.app.chartManager.loadedChart.getSecondsFromBeat(this.endBeat)+1,updateCallback:s=>{const o=(s.currentRenderFrame-s.currentEncodeQueue)/s.totalFrames;this.progressBar.style.background=`linear-gradient(90deg, var(--accent-color) 0 ${o*100}%, var(--input-bg) ${o*100}% 100%)`;const l=s.currentRenderFrame==s.totalFrames?"Encoding":"Rendering";this.progressLabel.innerText=`${l}...`,n>=0&&l==="Rendering"&&(this.progressLabel.innerText+=` (est. ${Zu(n)})`),!(!e||!s.currentVideoFrame)&&(e.clearRect(0,0,this.captureCanvas.width,this.captureCanvas.height),createImageBitmap(s.currentVideoFrame).then(u=>{const f=u.height/this.captureCanvas.height,c=u.width/f,d=(this.captureCanvas.width-c)/2;e.drawImage(u,0,0,u.width,u.height,d,0,c,this.captureCanvas.height)}))},onFinish:s=>{this.stopCapture(s)}});this.currentCapture=r,r.start().catch(s=>{console.error("Error starting capture:",s),this.stopCapture("")})}catch(r){console.error("Error starting capture:",r),this.stopCapture("")}}stopCapture(e){if(this.setDisableClose(!1),this.setBlocking(!1),xe.enableKeybinds(),this.videoURL=e,this.stopButton.style.display="none",this.returnButton.style.display="",e!=""?(this.downloadButton.style.display="",this.downloadButton.innerText=`Download video (${Ao(this.currentCapture.size)})`):this.progressLabel.innerText="Failed to export video! Check console for details.",clearInterval(this.estimateInterval),this.currentCapture=void 0,this.closed||e=="")return;const t=document.createElement("video");t.src=e,t.controls=!0,t.style.height="20rem",this.videoContainer.childNodes.forEach(n=>{n.style.display="none"}),this.videoContainer.appendChild(t)}buildBeatSecondInput(e,t){const n=document.createElement("div");n.classList.add("pref-item");const a=document.createElement("div");a.classList.add("pref-item-label","label"),a.innerText=e,n.appendChild(a);const r=document.createElement("div"),s=document.createElement("div");s.appendChild(document.createTextNode("Beat: "));const o=document.createElement("div");o.appendChild(document.createTextNode("Second: ")),s.style.display="flex",o.style.display="flex",s.style.gap="0.85rem",o.style.gap="0.85rem",s.style.flexDirection="row",o.style.flexDirection="row",r.style.display="flex",r.style.flexDirection="row",r.style.gap="1.5rem";const l=c=>{const d=this.app.chartManager.loadedChart.getSecondsFromBeat(c);f.value=d,u.value=c},u=ct.create({value:0,onchange:c=>{c!==void 0&&(l(c),t(c))}}),f=ct.create({value:0,onchange:c=>{c!==void 0&&(l(this.app.chartManager.loadedChart.getBeatFromSeconds(c)),t(this.app.chartManager.loadedChart.getBeatFromSeconds(c)))}});return r.replaceChildren(s,o),s.appendChild(u.view),o.appendChild(f.view),n.appendChild(r),{item:n,update:l}}updateSizeEstimate(){const e=this.captureOptions.bitrate,t=this.app.chartManager.loadedChart.getSecondsFromBeat(this.endBeat)-this.app.chartManager.loadedChart.getSecondsFromBeat(this.startBeat)+2,n=Math.round(e*t/8);this.exportButton.innerText=`Export Recording (Est. ${Ao(n)})`}buildOptions(e,t){const n=document.createElement("div");n.classList.add("capture-options");const a=document.createElement("div");return a.classList.add("capture-options-label"),a.innerText=e,n.appendChild(a),Object.entries(t).forEach(([r,s])=>{const o=document.createElement("div");o.classList.add("pref-item");const l=document.createElement("div");l.classList.add("pref-item-label","label"),l.innerText=s.label,o.appendChild(l);const u=tu(this.app,{...s.input,onChange:(f,c)=>{Object.assign(this.captureOptions,{[r]:c}),["videoHeight","fps","bitrate"].includes(r)&&this.presetDropdown.setSelected("Custom"),this.updateSizeEstimate()}},this.captureOptions[r]);o.appendChild(u),n.appendChild(o)}),n}}const Ll={};function Xh(i){let e=Ll[i];if(e)return e;e=Ll[i]=[];for(let t=0;t<128;t++){const n=String.fromCharCode(t);e.push(n)}for(let t=0;t<i.length;t++){const n=i.charCodeAt(t);e[n]="%"+("0"+n.toString(16).toUpperCase()).slice(-2)}return e}function fn(i,e){typeof e!="string"&&(e=fn.defaultChars);const t=Xh(e);return i.replace(/(%[a-f0-9]{2})+/gi,function(n){let a="";for(let r=0,s=n.length;r<s;r+=3){const o=parseInt(n.slice(r+1,r+3),16);if(o<128){a+=t[o];continue}if((o&224)===192&&r+3<s){const l=parseInt(n.slice(r+4,r+6),16);if((l&192)===128){const u=o<<6&1984|l&63;u<128?a+="��":a+=String.fromCharCode(u),r+=3;continue}}if((o&240)===224&&r+6<s){const l=parseInt(n.slice(r+4,r+6),16),u=parseInt(n.slice(r+7,r+9),16);if((l&192)===128&&(u&192)===128){const f=o<<12&61440|l<<6&4032|u&63;f<2048||f>=55296&&f<=57343?a+="���":a+=String.fromCharCode(f),r+=6;continue}}if((o&248)===240&&r+9<s){const l=parseInt(n.slice(r+4,r+6),16),u=parseInt(n.slice(r+7,r+9),16),f=parseInt(n.slice(r+10,r+12),16);if((l&192)===128&&(u&192)===128&&(f&192)===128){let c=o<<18&1835008|l<<12&258048|u<<6&4032|f&63;c<65536||c>1114111?a+="����":(c-=65536,a+=String.fromCharCode(55296+(c>>10),56320+(c&1023))),r+=9;continue}}a+="�"}return a})}fn.defaultChars=";/?:@&=+$,#";fn.componentChars="";const Dl={};function Zh(i){let e=Dl[i];if(e)return e;e=Dl[i]=[];for(let t=0;t<128;t++){const n=String.fromCharCode(t);/^[0-9a-z]$/i.test(n)?e.push(n):e.push("%"+("0"+t.toString(16).toUpperCase()).slice(-2))}for(let t=0;t<i.length;t++)e[i.charCodeAt(t)]=i[t];return e}function ia(i,e,t){typeof e!="string"&&(t=e,e=ia.defaultChars),typeof t>"u"&&(t=!0);const n=Zh(e);let a="";for(let r=0,s=i.length;r<s;r++){const o=i.charCodeAt(r);if(t&&o===37&&r+2<s&&/^[0-9a-f]{2}$/i.test(i.slice(r+1,r+3))){a+=i.slice(r,r+3),r+=2;continue}if(o<128){a+=n[o];continue}if(o>=55296&&o<=57343){if(o>=55296&&o<=56319&&r+1<s){const l=i.charCodeAt(r+1);if(l>=56320&&l<=57343){a+=encodeURIComponent(i[r]+i[r+1]),r++;continue}}a+="%EF%BF%BD";continue}a+=encodeURIComponent(i[r])}return a}ia.defaultChars=";/?:@&=+$,-_.!~*'()#";ia.componentChars="-_.!~*'()";function oo(i){let e="";return e+=i.protocol||"",e+=i.slashes?"//":"",e+=i.auth?i.auth+"@":"",i.hostname&&i.hostname.indexOf(":")!==-1?e+="["+i.hostname+"]":e+=i.hostname||"",e+=i.port?":"+i.port:"",e+=i.pathname||"",e+=i.search||"",e+=i.hash||"",e}function Fa(){this.protocol=null,this.slashes=null,this.auth=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.pathname=null}const Qh=/^([a-z0-9.+-]+:)/i,Jh=/:[0-9]*$/,ef=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,tf=["<",">",'"',"`"," ","\r",`
`,"	"],nf=["{","}","|","\\","^","`"].concat(tf),af=["'"].concat(nf),Bl=["%","/","?",";","#"].concat(af),Fl=["/","?","#"],rf=255,Il=/^[+a-z0-9A-Z_-]{0,63}$/,sf=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,Rl={javascript:!0,"javascript:":!0},Pl={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function lo(i,e){if(i&&i instanceof Fa)return i;const t=new Fa;return t.parse(i,e),t}Fa.prototype.parse=function(i,e){let t,n,a,r=i;if(r=r.trim(),!e&&i.split("#").length===1){const u=ef.exec(r);if(u)return this.pathname=u[1],u[2]&&(this.search=u[2]),this}let s=Qh.exec(r);if(s&&(s=s[0],t=s.toLowerCase(),this.protocol=s,r=r.substr(s.length)),(e||s||r.match(/^\/\/[^@\/]+@[^@\/]+/))&&(a=r.substr(0,2)==="//",a&&!(s&&Rl[s])&&(r=r.substr(2),this.slashes=!0)),!Rl[s]&&(a||s&&!Pl[s])){let u=-1;for(let p=0;p<Fl.length;p++)n=r.indexOf(Fl[p]),n!==-1&&(u===-1||n<u)&&(u=n);let f,c;u===-1?c=r.lastIndexOf("@"):c=r.lastIndexOf("@",u),c!==-1&&(f=r.slice(0,c),r=r.slice(c+1),this.auth=f),u=-1;for(let p=0;p<Bl.length;p++)n=r.indexOf(Bl[p]),n!==-1&&(u===-1||n<u)&&(u=n);u===-1&&(u=r.length),r[u-1]===":"&&u--;const d=r.slice(0,u);r=r.slice(u),this.parseHost(d),this.hostname=this.hostname||"";const h=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!h){const p=this.hostname.split(/\./);for(let m=0,g=p.length;m<g;m++){const b=p[m];if(b&&!b.match(Il)){let x="";for(let w=0,E=b.length;w<E;w++)b.charCodeAt(w)>127?x+="x":x+=b[w];if(!x.match(Il)){const w=p.slice(0,m),E=p.slice(m+1),C=b.match(sf);C&&(w.push(C[1]),E.unshift(C[2])),E.length&&(r=E.join(".")+r),this.hostname=w.join(".");break}}}}this.hostname.length>rf&&(this.hostname=""),h&&(this.hostname=this.hostname.substr(1,this.hostname.length-2))}const o=r.indexOf("#");o!==-1&&(this.hash=r.substr(o),r=r.slice(0,o));const l=r.indexOf("?");return l!==-1&&(this.search=r.substr(l),r=r.slice(0,l)),r&&(this.pathname=r),Pl[t]&&this.hostname&&!this.pathname&&(this.pathname=""),this};Fa.prototype.parseHost=function(i){let e=Jh.exec(i);e&&(e=e[0],e!==":"&&(this.port=e.substr(1)),i=i.substr(0,i.length-e.length)),i&&(this.hostname=i)};const of=Object.freeze(Object.defineProperty({__proto__:null,decode:fn,encode:ia,format:oo,parse:lo},Symbol.toStringTag,{value:"Module"})),iu=/[\0-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,nu=/[\0-\x1F\x7F-\x9F]/,lf=/[\xAD\u0600-\u0605\u061C\u06DD\u070F\u0890\u0891\u08E2\u180E\u200B-\u200F\u202A-\u202E\u2060-\u2064\u2066-\u206F\uFEFF\uFFF9-\uFFFB]|\uD804[\uDCBD\uDCCD]|\uD80D[\uDC30-\uDC3F]|\uD82F[\uDCA0-\uDCA3]|\uD834[\uDD73-\uDD7A]|\uDB40[\uDC01\uDC20-\uDC7F]/,co=/[!-#%-\*,-\/:;\?@\[-\]_\{\}\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061D-\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1B7D\u1B7E\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52-\u2E5D\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59\uDF86-\uDF89]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDEB9\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2\uDF00-\uDF09]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDF43-\uDF4F\uDFFF]|\uD809[\uDC70-\uDC74]|\uD80B[\uDFF1\uDFF2]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]/,au=/[\$\+<->\^`\|~\xA2-\xA6\xA8\xA9\xAC\xAE-\xB1\xB4\xB8\xD7\xF7\u02C2-\u02C5\u02D2-\u02DF\u02E5-\u02EB\u02ED\u02EF-\u02FF\u0375\u0384\u0385\u03F6\u0482\u058D-\u058F\u0606-\u0608\u060B\u060E\u060F\u06DE\u06E9\u06FD\u06FE\u07F6\u07FE\u07FF\u0888\u09F2\u09F3\u09FA\u09FB\u0AF1\u0B70\u0BF3-\u0BFA\u0C7F\u0D4F\u0D79\u0E3F\u0F01-\u0F03\u0F13\u0F15-\u0F17\u0F1A-\u0F1F\u0F34\u0F36\u0F38\u0FBE-\u0FC5\u0FC7-\u0FCC\u0FCE\u0FCF\u0FD5-\u0FD8\u109E\u109F\u1390-\u1399\u166D\u17DB\u1940\u19DE-\u19FF\u1B61-\u1B6A\u1B74-\u1B7C\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2044\u2052\u207A-\u207C\u208A-\u208C\u20A0-\u20C0\u2100\u2101\u2103-\u2106\u2108\u2109\u2114\u2116-\u2118\u211E-\u2123\u2125\u2127\u2129\u212E\u213A\u213B\u2140-\u2144\u214A-\u214D\u214F\u218A\u218B\u2190-\u2307\u230C-\u2328\u232B-\u2426\u2440-\u244A\u249C-\u24E9\u2500-\u2767\u2794-\u27C4\u27C7-\u27E5\u27F0-\u2982\u2999-\u29D7\u29DC-\u29FB\u29FE-\u2B73\u2B76-\u2B95\u2B97-\u2BFF\u2CE5-\u2CEA\u2E50\u2E51\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFF\u3004\u3012\u3013\u3020\u3036\u3037\u303E\u303F\u309B\u309C\u3190\u3191\u3196-\u319F\u31C0-\u31E3\u31EF\u3200-\u321E\u322A-\u3247\u3250\u3260-\u327F\u328A-\u32B0\u32C0-\u33FF\u4DC0-\u4DFF\uA490-\uA4C6\uA700-\uA716\uA720\uA721\uA789\uA78A\uA828-\uA82B\uA836-\uA839\uAA77-\uAA79\uAB5B\uAB6A\uAB6B\uFB29\uFBB2-\uFBC2\uFD40-\uFD4F\uFDCF\uFDFC-\uFDFF\uFE62\uFE64-\uFE66\uFE69\uFF04\uFF0B\uFF1C-\uFF1E\uFF3E\uFF40\uFF5C\uFF5E\uFFE0-\uFFE6\uFFE8-\uFFEE\uFFFC\uFFFD]|\uD800[\uDD37-\uDD3F\uDD79-\uDD89\uDD8C-\uDD8E\uDD90-\uDD9C\uDDA0\uDDD0-\uDDFC]|\uD802[\uDC77\uDC78\uDEC8]|\uD805\uDF3F|\uD807[\uDFD5-\uDFF1]|\uD81A[\uDF3C-\uDF3F\uDF45]|\uD82F\uDC9C|\uD833[\uDF50-\uDFC3]|\uD834[\uDC00-\uDCF5\uDD00-\uDD26\uDD29-\uDD64\uDD6A-\uDD6C\uDD83\uDD84\uDD8C-\uDDA9\uDDAE-\uDDEA\uDE00-\uDE41\uDE45\uDF00-\uDF56]|\uD835[\uDEC1\uDEDB\uDEFB\uDF15\uDF35\uDF4F\uDF6F\uDF89\uDFA9\uDFC3]|\uD836[\uDC00-\uDDFF\uDE37-\uDE3A\uDE6D-\uDE74\uDE76-\uDE83\uDE85\uDE86]|\uD838[\uDD4F\uDEFF]|\uD83B[\uDCAC\uDCB0\uDD2E\uDEF0\uDEF1]|\uD83C[\uDC00-\uDC2B\uDC30-\uDC93\uDCA0-\uDCAE\uDCB1-\uDCBF\uDCC1-\uDCCF\uDCD1-\uDCF5\uDD0D-\uDDAD\uDDE6-\uDE02\uDE10-\uDE3B\uDE40-\uDE48\uDE50\uDE51\uDE60-\uDE65\uDF00-\uDFFF]|\uD83D[\uDC00-\uDED7\uDEDC-\uDEEC\uDEF0-\uDEFC\uDF00-\uDF76\uDF7B-\uDFD9\uDFE0-\uDFEB\uDFF0]|\uD83E[\uDC00-\uDC0B\uDC10-\uDC47\uDC50-\uDC59\uDC60-\uDC87\uDC90-\uDCAD\uDCB0\uDCB1\uDD00-\uDE53\uDE60-\uDE6D\uDE70-\uDE7C\uDE80-\uDE88\uDE90-\uDEBD\uDEBF-\uDEC5\uDECE-\uDEDB\uDEE0-\uDEE8\uDEF0-\uDEF8\uDF00-\uDF92\uDF94-\uDFCA]/,ru=/[ \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000]/,cf=Object.freeze(Object.defineProperty({__proto__:null,Any:iu,Cc:nu,Cf:lf,P:co,S:au,Z:ru},Symbol.toStringTag,{value:"Module"})),uf=new Uint16Array('ᵁ<Õıʊҝջאٵ۞ޢߖࠏ੊ઑඡ๭༉༦჊ረዡᐕᒝᓃᓟᔥ\0\0\0\0\0\0ᕫᛍᦍᰒᷝ὾⁠↰⊍⏀⏻⑂⠤⤒ⴈ⹈⿎〖㊺㘹㞬㣾㨨㩱㫠㬮ࠀEMabcfglmnoprstu\\bfms¦³¹ÈÏlig耻Æ䃆P耻&䀦cute耻Á䃁reve;䄂Āiyx}rc耻Â䃂;䐐r;쀀𝔄rave耻À䃀pha;䎑acr;䄀d;橓Āgp¡on;䄄f;쀀𝔸plyFunction;恡ing耻Å䃅Ācs¾Ãr;쀀𝒜ign;扔ilde耻Ã䃃ml耻Ä䃄ЀaceforsuåûþėĜĢħĪĀcrêòkslash;或Ŷöø;櫧ed;挆y;䐑ƀcrtąċĔause;戵noullis;愬a;䎒r;쀀𝔅pf;쀀𝔹eve;䋘còēmpeq;扎܀HOacdefhilorsuōőŖƀƞƢƵƷƺǜȕɳɸɾcy;䐧PY耻©䂩ƀcpyŝŢźute;䄆Ā;iŧŨ拒talDifferentialD;慅leys;愭ȀaeioƉƎƔƘron;䄌dil耻Ç䃇rc;䄈nint;戰ot;䄊ĀdnƧƭilla;䂸terDot;䂷òſi;䎧rcleȀDMPTǇǋǑǖot;抙inus;抖lus;投imes;抗oĀcsǢǸkwiseContourIntegral;戲eCurlyĀDQȃȏoubleQuote;思uote;怙ȀlnpuȞȨɇɕonĀ;eȥȦ户;橴ƀgitȯȶȺruent;扡nt;戯ourIntegral;戮ĀfrɌɎ;愂oduct;成nterClockwiseContourIntegral;戳oss;樯cr;쀀𝒞pĀ;Cʄʅ拓ap;才րDJSZacefiosʠʬʰʴʸˋ˗ˡ˦̳ҍĀ;oŹʥtrahd;椑cy;䐂cy;䐅cy;䐏ƀgrsʿ˄ˇger;怡r;憡hv;櫤Āayː˕ron;䄎;䐔lĀ;t˝˞戇a;䎔r;쀀𝔇Āaf˫̧Ācm˰̢riticalȀADGT̖̜̀̆cute;䂴oŴ̋̍;䋙bleAcute;䋝rave;䁠ilde;䋜ond;拄ferentialD;慆Ѱ̽\0\0\0͔͂\0Ѕf;쀀𝔻ƀ;DE͈͉͍䂨ot;惜qual;扐blèCDLRUVͣͲ΂ϏϢϸontourIntegraìȹoɴ͹\0\0ͻ»͉nArrow;懓Āeo·ΤftƀARTΐΖΡrrow;懐ightArrow;懔eåˊngĀLRΫτeftĀARγιrrow;柸ightArrow;柺ightArrow;柹ightĀATϘϞrrow;懒ee;抨pɁϩ\0\0ϯrrow;懑ownArrow;懕erticalBar;戥ǹABLRTaВЪаўѿͼrrowƀ;BUНОТ憓ar;椓pArrow;懵reve;䌑eft˒к\0ц\0ѐightVector;楐eeVector;楞ectorĀ;Bљњ憽ar;楖ightǔѧ\0ѱeeVector;楟ectorĀ;BѺѻ懁ar;楗eeĀ;A҆҇护rrow;憧ĀctҒҗr;쀀𝒟rok;䄐ࠀNTacdfglmopqstuxҽӀӄӋӞӢӧӮӵԡԯԶՒ՝ՠեG;䅊H耻Ð䃐cute耻É䃉ƀaiyӒӗӜron;䄚rc耻Ê䃊;䐭ot;䄖r;쀀𝔈rave耻È䃈ement;戈ĀapӺӾcr;䄒tyɓԆ\0\0ԒmallSquare;旻erySmallSquare;斫ĀgpԦԪon;䄘f;쀀𝔼silon;䎕uĀaiԼՉlĀ;TՂՃ橵ilde;扂librium;懌Āci՗՚r;愰m;橳a;䎗ml耻Ë䃋Āipժկsts;戃onentialE;慇ʀcfiosօֈ֍ֲ׌y;䐤r;쀀𝔉lledɓ֗\0\0֣mallSquare;旼erySmallSquare;斪Ͱֺ\0ֿ\0\0ׄf;쀀𝔽All;戀riertrf;愱cò׋؀JTabcdfgorstר׬ׯ׺؀ؒؖ؛؝أ٬ٲcy;䐃耻>䀾mmaĀ;d׷׸䎓;䏜reve;䄞ƀeiy؇،ؐdil;䄢rc;䄜;䐓ot;䄠r;쀀𝔊;拙pf;쀀𝔾eater̀EFGLSTصلَٖٛ٦qualĀ;Lؾؿ扥ess;招ullEqual;执reater;檢ess;扷lantEqual;橾ilde;扳cr;쀀𝒢;扫ЀAacfiosuڅڋږڛڞڪھۊRDcy;䐪Āctڐڔek;䋇;䁞irc;䄤r;愌lbertSpace;愋ǰگ\0ڲf;愍izontalLine;攀Āctۃۅòکrok;䄦mpńېۘownHumðįqual;扏܀EJOacdfgmnostuۺ۾܃܇܎ܚܞܡܨ݄ݸދޏޕcy;䐕lig;䄲cy;䐁cute耻Í䃍Āiyܓܘrc耻Î䃎;䐘ot;䄰r;愑rave耻Ì䃌ƀ;apܠܯܿĀcgܴܷr;䄪inaryI;慈lieóϝǴ݉\0ݢĀ;eݍݎ戬Āgrݓݘral;戫section;拂isibleĀCTݬݲomma;恣imes;恢ƀgptݿރވon;䄮f;쀀𝕀a;䎙cr;愐ilde;䄨ǫޚ\0ޞcy;䐆l耻Ï䃏ʀcfosuެ޷޼߂ߐĀiyޱ޵rc;䄴;䐙r;쀀𝔍pf;쀀𝕁ǣ߇\0ߌr;쀀𝒥rcy;䐈kcy;䐄΀HJacfosߤߨ߽߬߱ࠂࠈcy;䐥cy;䐌ppa;䎚Āey߶߻dil;䄶;䐚r;쀀𝔎pf;쀀𝕂cr;쀀𝒦րJTaceflmostࠥࠩࠬࡐࡣ঳সে্਷ੇcy;䐉耻<䀼ʀcmnpr࠷࠼ࡁࡄࡍute;䄹bda;䎛g;柪lacetrf;愒r;憞ƀaeyࡗ࡜ࡡron;䄽dil;䄻;䐛Āfsࡨ॰tԀACDFRTUVarࡾࢩࢱࣦ࣠ࣼयज़ΐ४Ānrࢃ࢏gleBracket;柨rowƀ;BR࢙࢚࢞憐ar;懤ightArrow;懆eiling;挈oǵࢷ\0ࣃbleBracket;柦nǔࣈ\0࣒eeVector;楡ectorĀ;Bࣛࣜ懃ar;楙loor;挊ightĀAV࣯ࣵrrow;憔ector;楎Āerँगeƀ;AVउऊऐ抣rrow;憤ector;楚iangleƀ;BEतथऩ抲ar;槏qual;抴pƀDTVषूौownVector;楑eeVector;楠ectorĀ;Bॖॗ憿ar;楘ectorĀ;B॥०憼ar;楒ightáΜs̀EFGLSTॾঋকঝঢভqualGreater;拚ullEqual;扦reater;扶ess;檡lantEqual;橽ilde;扲r;쀀𝔏Ā;eঽা拘ftarrow;懚idot;䄿ƀnpw৔ਖਛgȀLRlr৞৷ਂਐeftĀAR০৬rrow;柵ightArrow;柷ightArrow;柶eftĀarγਊightáοightáϊf;쀀𝕃erĀLRਢਬeftArrow;憙ightArrow;憘ƀchtਾੀੂòࡌ;憰rok;䅁;扪Ѐacefiosuਗ਼੝੠੷੼અઋ઎p;椅y;䐜Ādl੥੯iumSpace;恟lintrf;愳r;쀀𝔐nusPlus;戓pf;쀀𝕄cò੶;䎜ҀJacefostuણધભીଔଙඑ඗ඞcy;䐊cute;䅃ƀaey઴હાron;䅇dil;䅅;䐝ƀgswે૰଎ativeƀMTV૓૟૨ediumSpace;怋hiĀcn૦૘ë૙eryThiî૙tedĀGL૸ଆreaterGreateòٳessLesóੈLine;䀊r;쀀𝔑ȀBnptଢନଷ଺reak;恠BreakingSpace;䂠f;愕ڀ;CDEGHLNPRSTV୕ୖ୪୼஡௫ఄ౞಄ದ೘ൡඅ櫬Āou୛୤ngruent;扢pCap;扭oubleVerticalBar;戦ƀlqxஃஊ஛ement;戉ualĀ;Tஒஓ扠ilde;쀀≂̸ists;戄reater΀;EFGLSTஶஷ஽௉௓௘௥扯qual;扱ullEqual;쀀≧̸reater;쀀≫̸ess;批lantEqual;쀀⩾̸ilde;扵umpń௲௽ownHump;쀀≎̸qual;쀀≏̸eĀfsఊధtTriangleƀ;BEచఛడ拪ar;쀀⧏̸qual;括s̀;EGLSTవశ఼ౄోౘ扮qual;扰reater;扸ess;쀀≪̸lantEqual;쀀⩽̸ilde;扴estedĀGL౨౹reaterGreater;쀀⪢̸essLess;쀀⪡̸recedesƀ;ESಒಓಛ技qual;쀀⪯̸lantEqual;拠ĀeiಫಹverseElement;戌ghtTriangleƀ;BEೋೌ೒拫ar;쀀⧐̸qual;拭ĀquೝഌuareSuĀbp೨೹setĀ;E೰ೳ쀀⊏̸qual;拢ersetĀ;Eഃആ쀀⊐̸qual;拣ƀbcpഓതൎsetĀ;Eഛഞ쀀⊂⃒qual;抈ceedsȀ;ESTലള഻െ抁qual;쀀⪰̸lantEqual;拡ilde;쀀≿̸ersetĀ;E൘൛쀀⊃⃒qual;抉ildeȀ;EFT൮൯൵ൿ扁qual;扄ullEqual;扇ilde;扉erticalBar;戤cr;쀀𝒩ilde耻Ñ䃑;䎝܀Eacdfgmoprstuvලෂ෉෕ෛ෠෧෼ขภยา฿ไlig;䅒cute耻Ó䃓Āiy෎ීrc耻Ô䃔;䐞blac;䅐r;쀀𝔒rave耻Ò䃒ƀaei෮ෲ෶cr;䅌ga;䎩cron;䎟pf;쀀𝕆enCurlyĀDQฎบoubleQuote;怜uote;怘;橔Āclวฬr;쀀𝒪ash耻Ø䃘iŬื฼de耻Õ䃕es;樷ml耻Ö䃖erĀBP๋๠Āar๐๓r;怾acĀek๚๜;揞et;掴arenthesis;揜Ҁacfhilors๿ງຊຏຒດຝະ໼rtialD;戂y;䐟r;쀀𝔓i;䎦;䎠usMinus;䂱Āipຢອncareplanåڝf;愙Ȁ;eio຺ູ໠໤檻cedesȀ;EST່້໏໚扺qual;檯lantEqual;扼ilde;找me;怳Ādp໩໮uct;戏ortionĀ;aȥ໹l;戝Āci༁༆r;쀀𝒫;䎨ȀUfos༑༖༛༟OT耻"䀢r;쀀𝔔pf;愚cr;쀀𝒬؀BEacefhiorsu༾གྷཇའཱིྦྷྪྭ႖ႩႴႾarr;椐G耻®䂮ƀcnrཎནབute;䅔g;柫rĀ;tཛྷཝ憠l;椖ƀaeyཧཬཱron;䅘dil;䅖;䐠Ā;vླྀཹ愜erseĀEUྂྙĀlq྇ྎement;戋uilibrium;懋pEquilibrium;楯r»ཹo;䎡ghtЀACDFTUVa࿁࿫࿳ဢဨၛႇϘĀnr࿆࿒gleBracket;柩rowƀ;BL࿜࿝࿡憒ar;懥eftArrow;懄eiling;按oǵ࿹\0စbleBracket;柧nǔည\0နeeVector;楝ectorĀ;Bဝသ懂ar;楕loor;挋Āerိ၃eƀ;AVဵံြ抢rrow;憦ector;楛iangleƀ;BEၐၑၕ抳ar;槐qual;抵pƀDTVၣၮၸownVector;楏eeVector;楜ectorĀ;Bႂႃ憾ar;楔ectorĀ;B႑႒懀ar;楓Āpuႛ႞f;愝ndImplies;楰ightarrow;懛ĀchႹႼr;愛;憱leDelayed;槴ڀHOacfhimoqstuფჱჷჽᄙᄞᅑᅖᅡᅧᆵᆻᆿĀCcჩხHcy;䐩y;䐨FTcy;䐬cute;䅚ʀ;aeiyᄈᄉᄎᄓᄗ檼ron;䅠dil;䅞rc;䅜;䐡r;쀀𝔖ortȀDLRUᄪᄴᄾᅉownArrow»ОeftArrow»࢚ightArrow»࿝pArrow;憑gma;䎣allCircle;战pf;쀀𝕊ɲᅭ\0\0ᅰt;戚areȀ;ISUᅻᅼᆉᆯ斡ntersection;抓uĀbpᆏᆞsetĀ;Eᆗᆘ抏qual;抑ersetĀ;Eᆨᆩ抐qual;抒nion;抔cr;쀀𝒮ar;拆ȀbcmpᇈᇛሉላĀ;sᇍᇎ拐etĀ;Eᇍᇕqual;抆ĀchᇠህeedsȀ;ESTᇭᇮᇴᇿ扻qual;檰lantEqual;扽ilde;承Tháྌ;我ƀ;esሒሓሣ拑rsetĀ;Eሜም抃qual;抇et»ሓրHRSacfhiorsሾቄ቉ቕ቞ቱቶኟዂወዑORN耻Þ䃞ADE;愢ĀHc቎ቒcy;䐋y;䐦Ābuቚቜ;䀉;䎤ƀaeyብቪቯron;䅤dil;䅢;䐢r;쀀𝔗Āeiቻ኉ǲኀ\0ኇefore;戴a;䎘Ācn኎ኘkSpace;쀀  Space;怉ldeȀ;EFTካኬኲኼ戼qual;扃ullEqual;扅ilde;扈pf;쀀𝕋ipleDot;惛Āctዖዛr;쀀𝒯rok;䅦ૡዷጎጚጦ\0ጬጱ\0\0\0\0\0ጸጽ፷ᎅ\0᏿ᐄᐊᐐĀcrዻጁute耻Ú䃚rĀ;oጇገ憟cir;楉rǣጓ\0጖y;䐎ve;䅬Āiyጞጣrc耻Û䃛;䐣blac;䅰r;쀀𝔘rave耻Ù䃙acr;䅪Ādiፁ፩erĀBPፈ፝Āarፍፐr;䁟acĀekፗፙ;揟et;掵arenthesis;揝onĀ;P፰፱拃lus;抎Āgp፻፿on;䅲f;쀀𝕌ЀADETadps᎕ᎮᎸᏄϨᏒᏗᏳrrowƀ;BDᅐᎠᎤar;椒ownArrow;懅ownArrow;憕quilibrium;楮eeĀ;AᏋᏌ报rrow;憥ownáϳerĀLRᏞᏨeftArrow;憖ightArrow;憗iĀ;lᏹᏺ䏒on;䎥ing;䅮cr;쀀𝒰ilde;䅨ml耻Ü䃜ҀDbcdefosvᐧᐬᐰᐳᐾᒅᒊᒐᒖash;披ar;櫫y;䐒ashĀ;lᐻᐼ抩;櫦Āerᑃᑅ;拁ƀbtyᑌᑐᑺar;怖Ā;iᑏᑕcalȀBLSTᑡᑥᑪᑴar;戣ine;䁼eparator;杘ilde;所ThinSpace;怊r;쀀𝔙pf;쀀𝕍cr;쀀𝒱dash;抪ʀcefosᒧᒬᒱᒶᒼirc;䅴dge;拀r;쀀𝔚pf;쀀𝕎cr;쀀𝒲Ȁfiosᓋᓐᓒᓘr;쀀𝔛;䎞pf;쀀𝕏cr;쀀𝒳ҀAIUacfosuᓱᓵᓹᓽᔄᔏᔔᔚᔠcy;䐯cy;䐇cy;䐮cute耻Ý䃝Āiyᔉᔍrc;䅶;䐫r;쀀𝔜pf;쀀𝕐cr;쀀𝒴ml;䅸ЀHacdefosᔵᔹᔿᕋᕏᕝᕠᕤcy;䐖cute;䅹Āayᕄᕉron;䅽;䐗ot;䅻ǲᕔ\0ᕛoWidtè૙a;䎖r;愨pf;愤cr;쀀𝒵௡ᖃᖊᖐ\0ᖰᖶᖿ\0\0\0\0ᗆᗛᗫᙟ᙭\0ᚕ᚛ᚲᚹ\0ᚾcute耻á䃡reve;䄃̀;Ediuyᖜᖝᖡᖣᖨᖭ戾;쀀∾̳;房rc耻â䃢te肻´̆;䐰lig耻æ䃦Ā;r²ᖺ;쀀𝔞rave耻à䃠ĀepᗊᗖĀfpᗏᗔsym;愵èᗓha;䎱ĀapᗟcĀclᗤᗧr;䄁g;樿ɤᗰ\0\0ᘊʀ;adsvᗺᗻᗿᘁᘇ戧nd;橕;橜lope;橘;橚΀;elmrszᘘᘙᘛᘞᘿᙏᙙ戠;榤e»ᘙsdĀ;aᘥᘦ戡ѡᘰᘲᘴᘶᘸᘺᘼᘾ;榨;榩;榪;榫;榬;榭;榮;榯tĀ;vᙅᙆ戟bĀ;dᙌᙍ抾;榝Āptᙔᙗh;戢»¹arr;捼Āgpᙣᙧon;䄅f;쀀𝕒΀;Eaeiop዁ᙻᙽᚂᚄᚇᚊ;橰cir;橯;扊d;手s;䀧roxĀ;e዁ᚒñᚃing耻å䃥ƀctyᚡᚦᚨr;쀀𝒶;䀪mpĀ;e዁ᚯñʈilde耻ã䃣ml耻ä䃤Āciᛂᛈoninôɲnt;樑ࠀNabcdefiklnoprsu᛭ᛱᜰ᜼ᝃᝈ᝸᝽០៦ᠹᡐᜍ᤽᥈ᥰot;櫭Ācrᛶ᜞kȀcepsᜀᜅᜍᜓong;扌psilon;䏶rime;怵imĀ;e᜚᜛戽q;拍Ŷᜢᜦee;抽edĀ;gᜬᜭ挅e»ᜭrkĀ;t፜᜷brk;掶Āoyᜁᝁ;䐱quo;怞ʀcmprtᝓ᝛ᝡᝤᝨausĀ;eĊĉptyv;榰séᜌnoõēƀahwᝯ᝱ᝳ;䎲;愶een;扬r;쀀𝔟g΀costuvwឍឝឳេ៕៛៞ƀaiuបពរðݠrc;旯p»፱ƀdptឤឨឭot;樀lus;樁imes;樂ɱឹ\0\0ើcup;樆ar;昅riangleĀdu៍្own;施p;斳plus;樄eåᑄåᒭarow;植ƀako៭ᠦᠵĀcn៲ᠣkƀlst៺֫᠂ozenge;槫riangleȀ;dlr᠒᠓᠘᠝斴own;斾eft;旂ight;斸k;搣Ʊᠫ\0ᠳƲᠯ\0ᠱ;斒;斑4;斓ck;斈ĀeoᠾᡍĀ;qᡃᡆ쀀=⃥uiv;쀀≡⃥t;挐Ȁptwxᡙᡞᡧᡬf;쀀𝕓Ā;tᏋᡣom»Ꮜtie;拈؀DHUVbdhmptuvᢅᢖᢪᢻᣗᣛᣬ᣿ᤅᤊᤐᤡȀLRlrᢎᢐᢒᢔ;敗;敔;敖;敓ʀ;DUduᢡᢢᢤᢦᢨ敐;敦;敩;敤;敧ȀLRlrᢳᢵᢷᢹ;敝;敚;敜;教΀;HLRhlrᣊᣋᣍᣏᣑᣓᣕ救;敬;散;敠;敫;敢;敟ox;槉ȀLRlrᣤᣦᣨᣪ;敕;敒;攐;攌ʀ;DUduڽ᣷᣹᣻᣽;敥;敨;攬;攴inus;抟lus;択imes;抠ȀLRlrᤙᤛᤝ᤟;敛;敘;攘;攔΀;HLRhlrᤰᤱᤳᤵᤷ᤻᤹攂;敪;敡;敞;攼;攤;攜Āevģ᥂bar耻¦䂦Ȁceioᥑᥖᥚᥠr;쀀𝒷mi;恏mĀ;e᜚᜜lƀ;bhᥨᥩᥫ䁜;槅sub;柈Ŭᥴ᥾lĀ;e᥹᥺怢t»᥺pƀ;Eeįᦅᦇ;檮Ā;qۜۛೡᦧ\0᧨ᨑᨕᨲ\0ᨷᩐ\0\0᪴\0\0᫁\0\0ᬡᬮ᭍᭒\0᯽\0ᰌƀcpr᦭ᦲ᧝ute;䄇̀;abcdsᦿᧀᧄ᧊᧕᧙戩nd;橄rcup;橉Āau᧏᧒p;橋p;橇ot;橀;쀀∩︀Āeo᧢᧥t;恁îړȀaeiu᧰᧻ᨁᨅǰ᧵\0᧸s;橍on;䄍dil耻ç䃧rc;䄉psĀ;sᨌᨍ橌m;橐ot;䄋ƀdmnᨛᨠᨦil肻¸ƭptyv;榲t脀¢;eᨭᨮ䂢räƲr;쀀𝔠ƀceiᨽᩀᩍy;䑇ckĀ;mᩇᩈ朓ark»ᩈ;䏇r΀;Ecefms᩟᩠ᩢᩫ᪤᪪᪮旋;槃ƀ;elᩩᩪᩭ䋆q;扗eɡᩴ\0\0᪈rrowĀlr᩼᪁eft;憺ight;憻ʀRSacd᪒᪔᪖᪚᪟»ཇ;擈st;抛irc;抚ash;抝nint;樐id;櫯cir;槂ubsĀ;u᪻᪼晣it»᪼ˬ᫇᫔᫺\0ᬊonĀ;eᫍᫎ䀺Ā;qÇÆɭ᫙\0\0᫢aĀ;t᫞᫟䀬;䁀ƀ;fl᫨᫩᫫戁îᅠeĀmx᫱᫶ent»᫩eóɍǧ᫾\0ᬇĀ;dኻᬂot;橭nôɆƀfryᬐᬔᬗ;쀀𝕔oäɔ脀©;sŕᬝr;愗Āaoᬥᬩrr;憵ss;朗Ācuᬲᬷr;쀀𝒸Ābpᬼ᭄Ā;eᭁᭂ櫏;櫑Ā;eᭉᭊ櫐;櫒dot;拯΀delprvw᭠᭬᭷ᮂᮬᯔ᯹arrĀlr᭨᭪;椸;椵ɰ᭲\0\0᭵r;拞c;拟arrĀ;p᭿ᮀ憶;椽̀;bcdosᮏᮐᮖᮡᮥᮨ截rcap;橈Āauᮛᮞp;橆p;橊ot;抍r;橅;쀀∪︀Ȁalrv᮵ᮿᯞᯣrrĀ;mᮼᮽ憷;椼yƀevwᯇᯔᯘqɰᯎ\0\0ᯒreã᭳uã᭵ee;拎edge;拏en耻¤䂤earrowĀlrᯮ᯳eft»ᮀight»ᮽeäᯝĀciᰁᰇoninôǷnt;戱lcty;挭ঀAHabcdefhijlorstuwz᰸᰻᰿ᱝᱩᱵᲊᲞᲬᲷ᳻᳿ᴍᵻᶑᶫᶻ᷆᷍rò΁ar;楥Ȁglrs᱈ᱍ᱒᱔ger;怠eth;愸òᄳhĀ;vᱚᱛ怐»ऊūᱡᱧarow;椏aã̕Āayᱮᱳron;䄏;䐴ƀ;ao̲ᱼᲄĀgrʿᲁr;懊tseq;橷ƀglmᲑᲔᲘ耻°䂰ta;䎴ptyv;榱ĀirᲣᲨsht;楿;쀀𝔡arĀlrᲳᲵ»ࣜ»သʀaegsv᳂͸᳖᳜᳠mƀ;oș᳊᳔ndĀ;ș᳑uit;晦amma;䏝in;拲ƀ;io᳧᳨᳸䃷de脀÷;o᳧ᳰntimes;拇nø᳷cy;䑒cɯᴆ\0\0ᴊrn;挞op;挍ʀlptuwᴘᴝᴢᵉᵕlar;䀤f;쀀𝕕ʀ;emps̋ᴭᴷᴽᵂqĀ;d͒ᴳot;扑inus;戸lus;戔quare;抡blebarwedgåúnƀadhᄮᵝᵧownarrowóᲃarpoonĀlrᵲᵶefôᲴighôᲶŢᵿᶅkaro÷གɯᶊ\0\0ᶎrn;挟op;挌ƀcotᶘᶣᶦĀryᶝᶡ;쀀𝒹;䑕l;槶rok;䄑Ādrᶰᶴot;拱iĀ;fᶺ᠖斿Āah᷀᷃ròЩaòྦangle;榦Āci᷒ᷕy;䑟grarr;柿ऀDacdefglmnopqrstuxḁḉḙḸոḼṉṡṾấắẽỡἪἷὄ὎὚ĀDoḆᴴoôᲉĀcsḎḔute耻é䃩ter;橮ȀaioyḢḧḱḶron;䄛rĀ;cḭḮ扖耻ê䃪lon;払;䑍ot;䄗ĀDrṁṅot;扒;쀀𝔢ƀ;rsṐṑṗ檚ave耻è䃨Ā;dṜṝ檖ot;檘Ȁ;ilsṪṫṲṴ檙nters;揧;愓Ā;dṹṺ檕ot;檗ƀapsẅẉẗcr;䄓tyƀ;svẒẓẕ戅et»ẓpĀ1;ẝẤĳạả;怄;怅怃ĀgsẪẬ;䅋p;怂ĀgpẴẸon;䄙f;쀀𝕖ƀalsỄỎỒrĀ;sỊị拕l;槣us;橱iƀ;lvỚớở䎵on»ớ;䏵ȀcsuvỪỳἋἣĀioữḱrc»Ḯɩỹ\0\0ỻíՈantĀglἂἆtr»ṝess»Ṻƀaeiἒ἖Ἒls;䀽st;扟vĀ;DȵἠD;橸parsl;槥ĀDaἯἳot;打rr;楱ƀcdiἾὁỸr;愯oô͒ĀahὉὋ;䎷耻ð䃰Āmrὓὗl耻ë䃫o;悬ƀcipὡὤὧl;䀡sôծĀeoὬὴctatioîՙnentialåչৡᾒ\0ᾞ\0ᾡᾧ\0\0ῆῌ\0ΐ\0ῦῪ \0 ⁚llingdotseñṄy;䑄male;晀ƀilrᾭᾳ῁lig;耀ﬃɩᾹ\0\0᾽g;耀ﬀig;耀ﬄ;쀀𝔣lig;耀ﬁlig;쀀fjƀaltῙ῜ῡt;晭ig;耀ﬂns;斱of;䆒ǰ΅\0ῳf;쀀𝕗ĀakֿῷĀ;vῼ´拔;櫙artint;樍Āao‌⁕Ācs‑⁒α‚‰‸⁅⁈\0⁐β•‥‧‪‬\0‮耻½䂽;慓耻¼䂼;慕;慙;慛Ƴ‴\0‶;慔;慖ʴ‾⁁\0\0⁃耻¾䂾;慗;慜5;慘ƶ⁌\0⁎;慚;慝8;慞l;恄wn;挢cr;쀀𝒻ࢀEabcdefgijlnorstv₂₉₟₥₰₴⃰⃵⃺⃿℃ℒℸ̗ℾ⅒↞Ā;lٍ₇;檌ƀcmpₐₕ₝ute;䇵maĀ;dₜ᳚䎳;檆reve;䄟Āiy₪₮rc;䄝;䐳ot;䄡Ȁ;lqsؾق₽⃉ƀ;qsؾٌ⃄lanô٥Ȁ;cdl٥⃒⃥⃕c;檩otĀ;o⃜⃝檀Ā;l⃢⃣檂;檄Ā;e⃪⃭쀀⋛︀s;檔r;쀀𝔤Ā;gٳ؛mel;愷cy;䑓Ȁ;Eajٚℌℎℐ;檒;檥;檤ȀEaesℛℝ℩ℴ;扩pĀ;p℣ℤ檊rox»ℤĀ;q℮ℯ檈Ā;q℮ℛim;拧pf;쀀𝕘Āci⅃ⅆr;愊mƀ;el٫ⅎ⅐;檎;檐茀>;cdlqr׮ⅠⅪⅮⅳⅹĀciⅥⅧ;檧r;橺ot;拗Par;榕uest;橼ʀadelsↄⅪ←ٖ↛ǰ↉\0↎proø₞r;楸qĀlqؿ↖lesó₈ií٫Āen↣↭rtneqq;쀀≩︀Å↪ԀAabcefkosy⇄⇇⇱⇵⇺∘∝∯≨≽ròΠȀilmr⇐⇔⇗⇛rsðᒄf»․ilôکĀdr⇠⇤cy;䑊ƀ;cwࣴ⇫⇯ir;楈;憭ar;意irc;䄥ƀalr∁∎∓rtsĀ;u∉∊晥it»∊lip;怦con;抹r;쀀𝔥sĀew∣∩arow;椥arow;椦ʀamopr∺∾≃≞≣rr;懿tht;戻kĀlr≉≓eftarrow;憩ightarrow;憪f;쀀𝕙bar;怕ƀclt≯≴≸r;쀀𝒽asè⇴rok;䄧Ābp⊂⊇ull;恃hen»ᱛૡ⊣\0⊪\0⊸⋅⋎\0⋕⋳\0\0⋸⌢⍧⍢⍿\0⎆⎪⎴cute耻í䃭ƀ;iyݱ⊰⊵rc耻î䃮;䐸Ācx⊼⊿y;䐵cl耻¡䂡ĀfrΟ⋉;쀀𝔦rave耻ì䃬Ȁ;inoܾ⋝⋩⋮Āin⋢⋦nt;樌t;戭fin;槜ta;愩lig;䄳ƀaop⋾⌚⌝ƀcgt⌅⌈⌗r;䄫ƀelpܟ⌏⌓inåގarôܠh;䄱f;抷ed;䆵ʀ;cfotӴ⌬⌱⌽⍁are;愅inĀ;t⌸⌹戞ie;槝doô⌙ʀ;celpݗ⍌⍐⍛⍡al;抺Āgr⍕⍙eróᕣã⍍arhk;樗rod;樼Ȁcgpt⍯⍲⍶⍻y;䑑on;䄯f;쀀𝕚a;䎹uest耻¿䂿Āci⎊⎏r;쀀𝒾nʀ;EdsvӴ⎛⎝⎡ӳ;拹ot;拵Ā;v⎦⎧拴;拳Ā;iݷ⎮lde;䄩ǫ⎸\0⎼cy;䑖l耻ï䃯̀cfmosu⏌⏗⏜⏡⏧⏵Āiy⏑⏕rc;䄵;䐹r;쀀𝔧ath;䈷pf;쀀𝕛ǣ⏬\0⏱r;쀀𝒿rcy;䑘kcy;䑔Ѐacfghjos␋␖␢␧␭␱␵␻ppaĀ;v␓␔䎺;䏰Āey␛␠dil;䄷;䐺r;쀀𝔨reen;䄸cy;䑅cy;䑜pf;쀀𝕜cr;쀀𝓀஀ABEHabcdefghjlmnoprstuv⑰⒁⒆⒍⒑┎┽╚▀♎♞♥♹♽⚚⚲⛘❝❨➋⟀⠁⠒ƀart⑷⑺⑼rò৆òΕail;椛arr;椎Ā;gঔ⒋;檋ar;楢ॣ⒥\0⒪\0⒱\0\0\0\0\0⒵Ⓔ\0ⓆⓈⓍ\0⓹ute;䄺mptyv;榴raîࡌbda;䎻gƀ;dlࢎⓁⓃ;榑åࢎ;檅uo耻«䂫rЀ;bfhlpst࢙ⓞⓦⓩ⓫⓮⓱⓵Ā;f࢝ⓣs;椟s;椝ë≒p;憫l;椹im;楳l;憢ƀ;ae⓿─┄檫il;椙Ā;s┉┊檭;쀀⪭︀ƀabr┕┙┝rr;椌rk;杲Āak┢┬cĀek┨┪;䁻;䁛Āes┱┳;榋lĀdu┹┻;榏;榍Ȁaeuy╆╋╖╘ron;䄾Ādi═╔il;䄼ìࢰâ┩;䐻Ȁcqrs╣╦╭╽a;椶uoĀ;rนᝆĀdu╲╷har;楧shar;楋h;憲ʀ;fgqs▋▌উ◳◿扤tʀahlrt▘▤▷◂◨rrowĀ;t࢙□aé⓶arpoonĀdu▯▴own»њp»०eftarrows;懇ightƀahs◍◖◞rrowĀ;sࣴࢧarpoonó྘quigarro÷⇰hreetimes;拋ƀ;qs▋ও◺lanôবʀ;cdgsব☊☍☝☨c;檨otĀ;o☔☕橿Ā;r☚☛檁;檃Ā;e☢☥쀀⋚︀s;檓ʀadegs☳☹☽♉♋pproøⓆot;拖qĀgq♃♅ôউgtò⒌ôছiíলƀilr♕࣡♚sht;楼;쀀𝔩Ā;Eজ♣;檑š♩♶rĀdu▲♮Ā;l॥♳;楪lk;斄cy;䑙ʀ;achtੈ⚈⚋⚑⚖rò◁orneòᴈard;楫ri;旺Āio⚟⚤dot;䅀ustĀ;a⚬⚭掰che»⚭ȀEaes⚻⚽⛉⛔;扨pĀ;p⛃⛄檉rox»⛄Ā;q⛎⛏檇Ā;q⛎⚻im;拦Ѐabnoptwz⛩⛴⛷✚✯❁❇❐Ānr⛮⛱g;柬r;懽rëࣁgƀlmr⛿✍✔eftĀar০✇ightá৲apsto;柼ightá৽parrowĀlr✥✩efô⓭ight;憬ƀafl✶✹✽r;榅;쀀𝕝us;樭imes;樴š❋❏st;戗áፎƀ;ef❗❘᠀旊nge»❘arĀ;l❤❥䀨t;榓ʀachmt❳❶❼➅➇ròࢨorneòᶌarĀ;d྘➃;業;怎ri;抿̀achiqt➘➝ੀ➢➮➻quo;怹r;쀀𝓁mƀ;egল➪➬;檍;檏Ābu┪➳oĀ;rฟ➹;怚rok;䅂萀<;cdhilqrࠫ⟒☹⟜⟠⟥⟪⟰Āci⟗⟙;檦r;橹reå◲mes;拉arr;楶uest;橻ĀPi⟵⟹ar;榖ƀ;ef⠀भ᠛旃rĀdu⠇⠍shar;楊har;楦Āen⠗⠡rtneqq;쀀≨︀Å⠞܀Dacdefhilnopsu⡀⡅⢂⢎⢓⢠⢥⢨⣚⣢⣤ઃ⣳⤂Dot;戺Ȁclpr⡎⡒⡣⡽r耻¯䂯Āet⡗⡙;時Ā;e⡞⡟朠se»⡟Ā;sျ⡨toȀ;dluျ⡳⡷⡻owîҌefôएðᏑker;斮Āoy⢇⢌mma;権;䐼ash;怔asuredangle»ᘦr;쀀𝔪o;愧ƀcdn⢯⢴⣉ro耻µ䂵Ȁ;acdᑤ⢽⣀⣄sôᚧir;櫰ot肻·Ƶusƀ;bd⣒ᤃ⣓戒Ā;uᴼ⣘;横ţ⣞⣡p;櫛ò−ðઁĀdp⣩⣮els;抧f;쀀𝕞Āct⣸⣽r;쀀𝓂pos»ᖝƀ;lm⤉⤊⤍䎼timap;抸ఀGLRVabcdefghijlmoprstuvw⥂⥓⥾⦉⦘⧚⧩⨕⨚⩘⩝⪃⪕⪤⪨⬄⬇⭄⭿⮮ⰴⱧⱼ⳩Āgt⥇⥋;쀀⋙̸Ā;v⥐௏쀀≫⃒ƀelt⥚⥲⥶ftĀar⥡⥧rrow;懍ightarrow;懎;쀀⋘̸Ā;v⥻ే쀀≪⃒ightarrow;懏ĀDd⦎⦓ash;抯ash;抮ʀbcnpt⦣⦧⦬⦱⧌la»˞ute;䅄g;쀀∠⃒ʀ;Eiop඄⦼⧀⧅⧈;쀀⩰̸d;쀀≋̸s;䅉roø඄urĀ;a⧓⧔普lĀ;s⧓ସǳ⧟\0⧣p肻 ଷmpĀ;e௹ఀʀaeouy⧴⧾⨃⨐⨓ǰ⧹\0⧻;橃on;䅈dil;䅆ngĀ;dൾ⨊ot;쀀⩭̸p;橂;䐽ash;怓΀;Aadqsxஒ⨩⨭⨻⩁⩅⩐rr;懗rĀhr⨳⨶k;椤Ā;oᏲᏰot;쀀≐̸uiöୣĀei⩊⩎ar;椨í஘istĀ;s஠டr;쀀𝔫ȀEest௅⩦⩹⩼ƀ;qs஼⩭௡ƀ;qs஼௅⩴lanô௢ií௪Ā;rஶ⪁»ஷƀAap⪊⪍⪑rò⥱rr;憮ar;櫲ƀ;svྍ⪜ྌĀ;d⪡⪢拼;拺cy;䑚΀AEadest⪷⪺⪾⫂⫅⫶⫹rò⥦;쀀≦̸rr;憚r;急Ȁ;fqs఻⫎⫣⫯tĀar⫔⫙rro÷⫁ightarro÷⪐ƀ;qs఻⪺⫪lanôౕĀ;sౕ⫴»శiíౝĀ;rవ⫾iĀ;eచథiäඐĀpt⬌⬑f;쀀𝕟膀¬;in⬙⬚⬶䂬nȀ;Edvஉ⬤⬨⬮;쀀⋹̸ot;쀀⋵̸ǡஉ⬳⬵;拷;拶iĀ;vಸ⬼ǡಸ⭁⭃;拾;拽ƀaor⭋⭣⭩rȀ;ast୻⭕⭚⭟lleì୻l;쀀⫽⃥;쀀∂̸lint;樔ƀ;ceಒ⭰⭳uåಥĀ;cಘ⭸Ā;eಒ⭽ñಘȀAait⮈⮋⮝⮧rò⦈rrƀ;cw⮔⮕⮙憛;쀀⤳̸;쀀↝̸ghtarrow»⮕riĀ;eೋೖ΀chimpqu⮽⯍⯙⬄୸⯤⯯Ȁ;cerല⯆ഷ⯉uå൅;쀀𝓃ortɭ⬅\0\0⯖ará⭖mĀ;e൮⯟Ā;q൴൳suĀbp⯫⯭å೸åഋƀbcp⯶ⰑⰙȀ;Ees⯿ⰀഢⰄ抄;쀀⫅̸etĀ;eഛⰋqĀ;qണⰀcĀ;eലⰗñസȀ;EesⰢⰣൟⰧ抅;쀀⫆̸etĀ;e൘ⰮqĀ;qൠⰣȀgilrⰽⰿⱅⱇìௗlde耻ñ䃱çృiangleĀlrⱒⱜeftĀ;eచⱚñదightĀ;eೋⱥñ೗Ā;mⱬⱭ䎽ƀ;esⱴⱵⱹ䀣ro;愖p;怇ҀDHadgilrsⲏⲔⲙⲞⲣⲰⲶⳓⳣash;抭arr;椄p;쀀≍⃒ash;抬ĀetⲨⲬ;쀀≥⃒;쀀>⃒nfin;槞ƀAetⲽⳁⳅrr;椂;쀀≤⃒Ā;rⳊⳍ쀀<⃒ie;쀀⊴⃒ĀAtⳘⳜrr;椃rie;쀀⊵⃒im;쀀∼⃒ƀAan⳰⳴ⴂrr;懖rĀhr⳺⳽k;椣Ā;oᏧᏥear;椧ቓ᪕\0\0\0\0\0\0\0\0\0\0\0\0\0ⴭ\0ⴸⵈⵠⵥ⵲ⶄᬇ\0\0ⶍⶫ\0ⷈⷎ\0ⷜ⸙⸫⸾⹃Ācsⴱ᪗ute耻ó䃳ĀiyⴼⵅrĀ;c᪞ⵂ耻ô䃴;䐾ʀabios᪠ⵒⵗǈⵚlac;䅑v;樸old;榼lig;䅓Ācr⵩⵭ir;榿;쀀𝔬ͯ⵹\0\0⵼\0ⶂn;䋛ave耻ò䃲;槁Ābmⶈ෴ar;榵Ȁacitⶕ⶘ⶥⶨrò᪀Āir⶝ⶠr;榾oss;榻nå๒;槀ƀaeiⶱⶵⶹcr;䅍ga;䏉ƀcdnⷀⷅǍron;䎿;榶pf;쀀𝕠ƀaelⷔ⷗ǒr;榷rp;榹΀;adiosvⷪⷫⷮ⸈⸍⸐⸖戨rò᪆Ȁ;efmⷷⷸ⸂⸅橝rĀ;oⷾⷿ愴f»ⷿ耻ª䂪耻º䂺gof;抶r;橖lope;橗;橛ƀclo⸟⸡⸧ò⸁ash耻ø䃸l;折iŬⸯ⸴de耻õ䃵esĀ;aǛ⸺s;樶ml耻ö䃶bar;挽ૡ⹞\0⹽\0⺀⺝\0⺢⺹\0\0⻋ຜ\0⼓\0\0⼫⾼\0⿈rȀ;astЃ⹧⹲຅脀¶;l⹭⹮䂶leìЃɩ⹸\0\0⹻m;櫳;櫽y;䐿rʀcimpt⺋⺏⺓ᡥ⺗nt;䀥od;䀮il;怰enk;怱r;쀀𝔭ƀimo⺨⺰⺴Ā;v⺭⺮䏆;䏕maô੶ne;明ƀ;tv⺿⻀⻈䏀chfork»´;䏖Āau⻏⻟nĀck⻕⻝kĀ;h⇴⻛;愎ö⇴sҀ;abcdemst⻳⻴ᤈ⻹⻽⼄⼆⼊⼎䀫cir;樣ir;樢Āouᵀ⼂;樥;橲n肻±ຝim;樦wo;樧ƀipu⼙⼠⼥ntint;樕f;쀀𝕡nd耻£䂣Ԁ;Eaceinosu່⼿⽁⽄⽇⾁⾉⾒⽾⾶;檳p;檷uå໙Ā;c໎⽌̀;acens່⽙⽟⽦⽨⽾pproø⽃urlyeñ໙ñ໎ƀaes⽯⽶⽺pprox;檹qq;檵im;拨iíໟmeĀ;s⾈ຮ怲ƀEas⽸⾐⽺ð⽵ƀdfp໬⾙⾯ƀals⾠⾥⾪lar;挮ine;挒urf;挓Ā;t໻⾴ï໻rel;抰Āci⿀⿅r;쀀𝓅;䏈ncsp;怈̀fiopsu⿚⋢⿟⿥⿫⿱r;쀀𝔮pf;쀀𝕢rime;恗cr;쀀𝓆ƀaeo⿸〉〓tĀei⿾々rnionóڰnt;樖stĀ;e【】䀿ñἙô༔઀ABHabcdefhilmnoprstux぀けさすムㄎㄫㅇㅢㅲㆎ㈆㈕㈤㈩㉘㉮㉲㊐㊰㊷ƀartぇおがròႳòϝail;検aròᱥar;楤΀cdenqrtとふへみわゔヌĀeuねぱ;쀀∽̱te;䅕iãᅮmptyv;榳gȀ;del࿑らるろ;榒;榥å࿑uo耻»䂻rր;abcfhlpstw࿜ガクシスゼゾダッデナp;極Ā;f࿠ゴs;椠;椳s;椞ë≝ð✮l;楅im;楴l;憣;憝Āaiパフil;椚oĀ;nホボ戶aló༞ƀabrョリヮrò៥rk;杳ĀakンヽcĀekヹ・;䁽;䁝Āes㄂㄄;榌lĀduㄊㄌ;榎;榐Ȁaeuyㄗㄜㄧㄩron;䅙Ādiㄡㄥil;䅗ì࿲âヺ;䑀Ȁclqsㄴㄷㄽㅄa;椷dhar;楩uoĀ;rȎȍh;憳ƀacgㅎㅟངlȀ;ipsླྀㅘㅛႜnåႻarôྩt;断ƀilrㅩဣㅮsht;楽;쀀𝔯ĀaoㅷㆆrĀduㅽㅿ»ѻĀ;l႑ㆄ;楬Ā;vㆋㆌ䏁;䏱ƀgns㆕ㇹㇼht̀ahlrstㆤㆰ㇂㇘㇤㇮rrowĀ;t࿜ㆭaéトarpoonĀduㆻㆿowîㅾp»႒eftĀah㇊㇐rrowó࿪arpoonóՑightarrows;應quigarro÷ニhreetimes;拌g;䋚ingdotseñἲƀahm㈍㈐㈓rò࿪aòՑ;怏oustĀ;a㈞㈟掱che»㈟mid;櫮Ȁabpt㈲㈽㉀㉒Ānr㈷㈺g;柭r;懾rëဃƀafl㉇㉊㉎r;榆;쀀𝕣us;樮imes;樵Āap㉝㉧rĀ;g㉣㉤䀩t;榔olint;樒arò㇣Ȁachq㉻㊀Ⴜ㊅quo;怺r;쀀𝓇Ābu・㊊oĀ;rȔȓƀhir㊗㊛㊠reåㇸmes;拊iȀ;efl㊪ၙᠡ㊫方tri;槎luhar;楨;愞ൡ㋕㋛㋟㌬㌸㍱\0㍺㎤\0\0㏬㏰\0㐨㑈㑚㒭㒱㓊㓱\0㘖\0\0㘳cute;䅛quï➺Ԁ;Eaceinpsyᇭ㋳㋵㋿㌂㌋㌏㌟㌦㌩;檴ǰ㋺\0㋼;檸on;䅡uåᇾĀ;dᇳ㌇il;䅟rc;䅝ƀEas㌖㌘㌛;檶p;檺im;择olint;樓iíሄ;䑁otƀ;be㌴ᵇ㌵担;橦΀Aacmstx㍆㍊㍗㍛㍞㍣㍭rr;懘rĀhr㍐㍒ë∨Ā;oਸ਼਴t耻§䂧i;䀻war;椩mĀin㍩ðnuóñt;朶rĀ;o㍶⁕쀀𝔰Ȁacoy㎂㎆㎑㎠rp;景Āhy㎋㎏cy;䑉;䑈rtɭ㎙\0\0㎜iäᑤaraì⹯耻­䂭Āgm㎨㎴maƀ;fv㎱㎲㎲䏃;䏂Ѐ;deglnprካ㏅㏉㏎㏖㏞㏡㏦ot;橪Ā;q኱ኰĀ;E㏓㏔檞;檠Ā;E㏛㏜檝;檟e;扆lus;樤arr;楲aròᄽȀaeit㏸㐈㐏㐗Āls㏽㐄lsetmé㍪hp;樳parsl;槤Ādlᑣ㐔e;挣Ā;e㐜㐝檪Ā;s㐢㐣檬;쀀⪬︀ƀflp㐮㐳㑂tcy;䑌Ā;b㐸㐹䀯Ā;a㐾㐿槄r;挿f;쀀𝕤aĀdr㑍ЂesĀ;u㑔㑕晠it»㑕ƀcsu㑠㑹㒟Āau㑥㑯pĀ;sᆈ㑫;쀀⊓︀pĀ;sᆴ㑵;쀀⊔︀uĀbp㑿㒏ƀ;esᆗᆜ㒆etĀ;eᆗ㒍ñᆝƀ;esᆨᆭ㒖etĀ;eᆨ㒝ñᆮƀ;afᅻ㒦ְrť㒫ֱ»ᅼaròᅈȀcemt㒹㒾㓂㓅r;쀀𝓈tmîñiì㐕aræᆾĀar㓎㓕rĀ;f㓔ឿ昆Āan㓚㓭ightĀep㓣㓪psiloîỠhé⺯s»⡒ʀbcmnp㓻㕞ሉ㖋㖎Ҁ;Edemnprs㔎㔏㔑㔕㔞㔣㔬㔱㔶抂;櫅ot;檽Ā;dᇚ㔚ot;櫃ult;櫁ĀEe㔨㔪;櫋;把lus;檿arr;楹ƀeiu㔽㕒㕕tƀ;en㔎㕅㕋qĀ;qᇚ㔏eqĀ;q㔫㔨m;櫇Ābp㕚㕜;櫕;櫓c̀;acensᇭ㕬㕲㕹㕻㌦pproø㋺urlyeñᇾñᇳƀaes㖂㖈㌛pproø㌚qñ㌗g;晪ڀ123;Edehlmnps㖩㖬㖯ሜ㖲㖴㗀㗉㗕㗚㗟㗨㗭耻¹䂹耻²䂲耻³䂳;櫆Āos㖹㖼t;檾ub;櫘Ā;dሢ㗅ot;櫄sĀou㗏㗒l;柉b;櫗arr;楻ult;櫂ĀEe㗤㗦;櫌;抋lus;櫀ƀeiu㗴㘉㘌tƀ;enሜ㗼㘂qĀ;qሢ㖲eqĀ;q㗧㗤m;櫈Ābp㘑㘓;櫔;櫖ƀAan㘜㘠㘭rr;懙rĀhr㘦㘨ë∮Ā;oਫ਩war;椪lig耻ß䃟௡㙑㙝㙠ዎ㙳㙹\0㙾㛂\0\0\0\0\0㛛㜃\0㜉㝬\0\0\0㞇ɲ㙖\0\0㙛get;挖;䏄rë๟ƀaey㙦㙫㙰ron;䅥dil;䅣;䑂lrec;挕r;쀀𝔱Ȁeiko㚆㚝㚵㚼ǲ㚋\0㚑eĀ4fኄኁaƀ;sv㚘㚙㚛䎸ym;䏑Ācn㚢㚲kĀas㚨㚮pproø዁im»ኬsðኞĀas㚺㚮ð዁rn耻þ䃾Ǭ̟㛆⋧es膀×;bd㛏㛐㛘䃗Ā;aᤏ㛕r;樱;樰ƀeps㛡㛣㜀á⩍Ȁ;bcf҆㛬㛰㛴ot;挶ir;櫱Ā;o㛹㛼쀀𝕥rk;櫚á㍢rime;怴ƀaip㜏㜒㝤dåቈ΀adempst㜡㝍㝀㝑㝗㝜㝟ngleʀ;dlqr㜰㜱㜶㝀㝂斵own»ᶻeftĀ;e⠀㜾ñम;扜ightĀ;e㊪㝋ñၚot;旬inus;樺lus;樹b;槍ime;樻ezium;揢ƀcht㝲㝽㞁Āry㝷㝻;쀀𝓉;䑆cy;䑛rok;䅧Āio㞋㞎xô᝷headĀlr㞗㞠eftarro÷ࡏightarrow»ཝऀAHabcdfghlmoprstuw㟐㟓㟗㟤㟰㟼㠎㠜㠣㠴㡑㡝㡫㢩㣌㣒㣪㣶ròϭar;楣Ācr㟜㟢ute耻ú䃺òᅐrǣ㟪\0㟭y;䑞ve;䅭Āiy㟵㟺rc耻û䃻;䑃ƀabh㠃㠆㠋ròᎭlac;䅱aòᏃĀir㠓㠘sht;楾;쀀𝔲rave耻ù䃹š㠧㠱rĀlr㠬㠮»ॗ»ႃlk;斀Āct㠹㡍ɯ㠿\0\0㡊rnĀ;e㡅㡆挜r»㡆op;挏ri;旸Āal㡖㡚cr;䅫肻¨͉Āgp㡢㡦on;䅳f;쀀𝕦̀adhlsuᅋ㡸㡽፲㢑㢠ownáᎳarpoonĀlr㢈㢌efô㠭ighô㠯iƀ;hl㢙㢚㢜䏅»ᏺon»㢚parrows;懈ƀcit㢰㣄㣈ɯ㢶\0\0㣁rnĀ;e㢼㢽挝r»㢽op;挎ng;䅯ri;旹cr;쀀𝓊ƀdir㣙㣝㣢ot;拰lde;䅩iĀ;f㜰㣨»᠓Āam㣯㣲rò㢨l耻ü䃼angle;榧ހABDacdeflnoprsz㤜㤟㤩㤭㦵㦸㦽㧟㧤㧨㧳㧹㧽㨁㨠ròϷarĀ;v㤦㤧櫨;櫩asèϡĀnr㤲㤷grt;榜΀eknprst㓣㥆㥋㥒㥝㥤㦖appá␕othinçẖƀhir㓫⻈㥙opô⾵Ā;hᎷ㥢ïㆍĀiu㥩㥭gmá㎳Ābp㥲㦄setneqĀ;q㥽㦀쀀⊊︀;쀀⫋︀setneqĀ;q㦏㦒쀀⊋︀;쀀⫌︀Āhr㦛㦟etá㚜iangleĀlr㦪㦯eft»थight»ၑy;䐲ash»ံƀelr㧄㧒㧗ƀ;beⷪ㧋㧏ar;抻q;扚lip;拮Ābt㧜ᑨaòᑩr;쀀𝔳tré㦮suĀbp㧯㧱»ജ»൙pf;쀀𝕧roð໻tré㦴Ācu㨆㨋r;쀀𝓋Ābp㨐㨘nĀEe㦀㨖»㥾nĀEe㦒㨞»㦐igzag;榚΀cefoprs㨶㨻㩖㩛㩔㩡㩪irc;䅵Ādi㩀㩑Ābg㩅㩉ar;機eĀ;qᗺ㩏;扙erp;愘r;쀀𝔴pf;쀀𝕨Ā;eᑹ㩦atèᑹcr;쀀𝓌ૣណ㪇\0㪋\0㪐㪛\0\0㪝㪨㪫㪯\0\0㫃㫎\0㫘ៜ៟tré៑r;쀀𝔵ĀAa㪔㪗ròσrò৶;䎾ĀAa㪡㪤ròθrò৫að✓is;拻ƀdptឤ㪵㪾Āfl㪺ឩ;쀀𝕩imåឲĀAa㫇㫊ròώròਁĀcq㫒ីr;쀀𝓍Āpt៖㫜ré។Ѐacefiosu㫰㫽㬈㬌㬑㬕㬛㬡cĀuy㫶㫻te耻ý䃽;䑏Āiy㬂㬆rc;䅷;䑋n耻¥䂥r;쀀𝔶cy;䑗pf;쀀𝕪cr;쀀𝓎Ācm㬦㬩y;䑎l耻ÿ䃿Ԁacdefhiosw㭂㭈㭔㭘㭤㭩㭭㭴㭺㮀cute;䅺Āay㭍㭒ron;䅾;䐷ot;䅼Āet㭝㭡træᕟa;䎶r;쀀𝔷cy;䐶grarr;懝pf;쀀𝕫cr;쀀𝓏Ājn㮅㮇;怍j;怌'.split("").map(i=>i.charCodeAt(0))),df=new Uint16Array("Ȁaglq	\x1Bɭ\0\0p;䀦os;䀧t;䀾t;䀼uot;䀢".split("").map(i=>i.charCodeAt(0)));var Jr;const hf=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]),ff=(Jr=String.fromCodePoint)!==null&&Jr!==void 0?Jr:function(i){let e="";return i>65535&&(i-=65536,e+=String.fromCharCode(i>>>10&1023|55296),i=56320|i&1023),e+=String.fromCharCode(i),e};function pf(i){var e;return i>=55296&&i<=57343||i>1114111?65533:(e=hf.get(i))!==null&&e!==void 0?e:i}var mt;(function(i){i[i.NUM=35]="NUM",i[i.SEMI=59]="SEMI",i[i.EQUALS=61]="EQUALS",i[i.ZERO=48]="ZERO",i[i.NINE=57]="NINE",i[i.LOWER_A=97]="LOWER_A",i[i.LOWER_F=102]="LOWER_F",i[i.LOWER_X=120]="LOWER_X",i[i.LOWER_Z=122]="LOWER_Z",i[i.UPPER_A=65]="UPPER_A",i[i.UPPER_F=70]="UPPER_F",i[i.UPPER_Z=90]="UPPER_Z"})(mt||(mt={}));const mf=32;var Ii;(function(i){i[i.VALUE_LENGTH=49152]="VALUE_LENGTH",i[i.BRANCH_LENGTH=16256]="BRANCH_LENGTH",i[i.JUMP_TABLE=127]="JUMP_TABLE"})(Ii||(Ii={}));function Fs(i){return i>=mt.ZERO&&i<=mt.NINE}function gf(i){return i>=mt.UPPER_A&&i<=mt.UPPER_F||i>=mt.LOWER_A&&i<=mt.LOWER_F}function bf(i){return i>=mt.UPPER_A&&i<=mt.UPPER_Z||i>=mt.LOWER_A&&i<=mt.LOWER_Z||Fs(i)}function yf(i){return i===mt.EQUALS||bf(i)}var ft;(function(i){i[i.EntityStart=0]="EntityStart",i[i.NumericStart=1]="NumericStart",i[i.NumericDecimal=2]="NumericDecimal",i[i.NumericHex=3]="NumericHex",i[i.NamedEntity=4]="NamedEntity"})(ft||(ft={}));var Di;(function(i){i[i.Legacy=0]="Legacy",i[i.Strict=1]="Strict",i[i.Attribute=2]="Attribute"})(Di||(Di={}));class wf{constructor(e,t,n){this.decodeTree=e,this.emitCodePoint=t,this.errors=n,this.state=ft.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=Di.Strict}startEntity(e){this.decodeMode=e,this.state=ft.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1}write(e,t){switch(this.state){case ft.EntityStart:return e.charCodeAt(t)===mt.NUM?(this.state=ft.NumericStart,this.consumed+=1,this.stateNumericStart(e,t+1)):(this.state=ft.NamedEntity,this.stateNamedEntity(e,t));case ft.NumericStart:return this.stateNumericStart(e,t);case ft.NumericDecimal:return this.stateNumericDecimal(e,t);case ft.NumericHex:return this.stateNumericHex(e,t);case ft.NamedEntity:return this.stateNamedEntity(e,t)}}stateNumericStart(e,t){return t>=e.length?-1:(e.charCodeAt(t)|mf)===mt.LOWER_X?(this.state=ft.NumericHex,this.consumed+=1,this.stateNumericHex(e,t+1)):(this.state=ft.NumericDecimal,this.stateNumericDecimal(e,t))}addToNumericResult(e,t,n,a){if(t!==n){const r=n-t;this.result=this.result*Math.pow(a,r)+parseInt(e.substr(t,r),a),this.consumed+=r}}stateNumericHex(e,t){const n=t;for(;t<e.length;){const a=e.charCodeAt(t);if(Fs(a)||gf(a))t+=1;else return this.addToNumericResult(e,n,t,16),this.emitNumericEntity(a,3)}return this.addToNumericResult(e,n,t,16),-1}stateNumericDecimal(e,t){const n=t;for(;t<e.length;){const a=e.charCodeAt(t);if(Fs(a))t+=1;else return this.addToNumericResult(e,n,t,10),this.emitNumericEntity(a,2)}return this.addToNumericResult(e,n,t,10),-1}emitNumericEntity(e,t){var n;if(this.consumed<=t)return(n=this.errors)===null||n===void 0||n.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(e===mt.SEMI)this.consumed+=1;else if(this.decodeMode===Di.Strict)return 0;return this.emitCodePoint(pf(this.result),this.consumed),this.errors&&(e!==mt.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed}stateNamedEntity(e,t){const{decodeTree:n}=this;let a=n[this.treeIndex],r=(a&Ii.VALUE_LENGTH)>>14;for(;t<e.length;t++,this.excess++){const s=e.charCodeAt(t);if(this.treeIndex=vf(n,a,this.treeIndex+Math.max(1,r),s),this.treeIndex<0)return this.result===0||this.decodeMode===Di.Attribute&&(r===0||yf(s))?0:this.emitNotTerminatedNamedEntity();if(a=n[this.treeIndex],r=(a&Ii.VALUE_LENGTH)>>14,r!==0){if(s===mt.SEMI)return this.emitNamedEntityData(this.treeIndex,r,this.consumed+this.excess);this.decodeMode!==Di.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1}emitNotTerminatedNamedEntity(){var e;const{result:t,decodeTree:n}=this,a=(n[t]&Ii.VALUE_LENGTH)>>14;return this.emitNamedEntityData(t,a,this.consumed),(e=this.errors)===null||e===void 0||e.missingSemicolonAfterCharacterReference(),this.consumed}emitNamedEntityData(e,t,n){const{decodeTree:a}=this;return this.emitCodePoint(t===1?a[e]&~Ii.VALUE_LENGTH:a[e+1],n),t===3&&this.emitCodePoint(a[e+2],n),n}end(){var e;switch(this.state){case ft.NamedEntity:return this.result!==0&&(this.decodeMode!==Di.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case ft.NumericDecimal:return this.emitNumericEntity(0,2);case ft.NumericHex:return this.emitNumericEntity(0,3);case ft.NumericStart:return(e=this.errors)===null||e===void 0||e.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case ft.EntityStart:return 0}}}function su(i){let e="";const t=new wf(i,n=>e+=ff(n));return function(a,r){let s=0,o=0;for(;(o=a.indexOf("&",o))>=0;){e+=a.slice(s,o),t.startEntity(r);const u=t.write(a,o+1);if(u<0){s=o+t.end();break}s=o+u,o=u===0?s+1:s}const l=e+a.slice(s);return e="",l}}function vf(i,e,t,n){const a=(e&Ii.BRANCH_LENGTH)>>7,r=e&Ii.JUMP_TABLE;if(a===0)return r!==0&&n===r?t:-1;if(r){const l=n-r;return l<0||l>=a?-1:i[t+l]-1}let s=t,o=s+a-1;for(;s<=o;){const l=s+o>>>1,u=i[l];if(u<n)s=l+1;else if(u>n)o=l-1;else return i[l+a]}return-1}const xf=su(uf);su(df);function ou(i,e=Di.Legacy){return xf(i,e)}function _f(i){return Object.prototype.toString.call(i)}function uo(i){return _f(i)==="[object String]"}const Ef=Object.prototype.hasOwnProperty;function Cf(i,e){return Ef.call(i,e)}function Ya(i){return Array.prototype.slice.call(arguments,1).forEach(function(t){if(t){if(typeof t!="object")throw new TypeError(t+"must be object");Object.keys(t).forEach(function(n){i[n]=t[n]})}}),i}function lu(i,e,t){return[].concat(i.slice(0,e),t,i.slice(e+1))}function ho(i){return!(i>=55296&&i<=57343||i>=64976&&i<=65007||(i&65535)===65535||(i&65535)===65534||i>=0&&i<=8||i===11||i>=14&&i<=31||i>=127&&i<=159||i>1114111)}function Ia(i){if(i>65535){i-=65536;const e=55296+(i>>10),t=56320+(i&1023);return String.fromCharCode(e,t)}return String.fromCharCode(i)}const cu=/\\([!"#$%&'()*+,\-./:;<=>?@[\\\]^_`{|}~])/g,Af=/&([a-z#][a-z0-9]{1,31});/gi,kf=new RegExp(cu.source+"|"+Af.source,"gi"),Sf=/^#((?:x[a-f0-9]{1,8}|[0-9]{1,8}))$/i;function Tf(i,e){if(e.charCodeAt(0)===35&&Sf.test(e)){const n=e[1].toLowerCase()==="x"?parseInt(e.slice(2),16):parseInt(e.slice(1),10);return ho(n)?Ia(n):i}const t=ou(i);return t!==i?t:i}function Mf(i){return i.indexOf("\\")<0?i:i.replace(cu,"$1")}function pn(i){return i.indexOf("\\")<0&&i.indexOf("&")<0?i:i.replace(kf,function(e,t,n){return t||Tf(e,n)})}const Lf=/[&<>"]/,Df=/[&<>"]/g,Bf={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};function Ff(i){return Bf[i]}function Ri(i){return Lf.test(i)?i.replace(Df,Ff):i}const If=/[.?*+^$[\]\\(){}|-]/g;function Rf(i){return i.replace(If,"\\$&")}function Ze(i){switch(i){case 9:case 32:return!0}return!1}function jn(i){if(i>=8192&&i<=8202)return!0;switch(i){case 9:case 10:case 11:case 12:case 13:case 32:case 160:case 5760:case 8239:case 8287:case 12288:return!0}return!1}function $n(i){return co.test(i)||au.test(i)}function Yn(i){switch(i){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 58:case 59:case 60:case 61:case 62:case 63:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 124:case 125:case 126:return!0;default:return!1}}function Ka(i){return i=i.trim().replace(/\s+/g," "),"ẞ".toLowerCase()==="Ṿ"&&(i=i.replace(/ẞ/g,"ß")),i.toLowerCase().toUpperCase()}const Pf={mdurl:of,ucmicro:cf},Of=Object.freeze(Object.defineProperty({__proto__:null,arrayReplaceAt:lu,assign:Ya,escapeHtml:Ri,escapeRE:Rf,fromCodePoint:Ia,has:Cf,isMdAsciiPunct:Yn,isPunctChar:$n,isSpace:Ze,isString:uo,isValidEntityCode:ho,isWhiteSpace:jn,lib:Pf,normalizeReference:Ka,unescapeAll:pn,unescapeMd:Mf},Symbol.toStringTag,{value:"Module"}));function Nf(i,e,t){let n,a,r,s;const o=i.posMax,l=i.pos;for(i.pos=e+1,n=1;i.pos<o;){if(r=i.src.charCodeAt(i.pos),r===93&&(n--,n===0)){a=!0;break}if(s=i.pos,i.md.inline.skipToken(i),r===91){if(s===i.pos-1)n++;else if(t)return i.pos=l,-1}}let u=-1;return a&&(u=i.pos),i.pos=l,u}function Hf(i,e,t){let n,a=e;const r={ok:!1,pos:0,str:""};if(i.charCodeAt(a)===60){for(a++;a<t;){if(n=i.charCodeAt(a),n===10||n===60)return r;if(n===62)return r.pos=a+1,r.str=pn(i.slice(e+1,a)),r.ok=!0,r;if(n===92&&a+1<t){a+=2;continue}a++}return r}let s=0;for(;a<t&&(n=i.charCodeAt(a),!(n===32||n<32||n===127));){if(n===92&&a+1<t){if(i.charCodeAt(a+1)===32)break;a+=2;continue}if(n===40&&(s++,s>32))return r;if(n===41){if(s===0)break;s--}a++}return e===a||s!==0||(r.str=pn(i.slice(e,a)),r.pos=a,r.ok=!0),r}function zf(i,e,t,n){let a,r=e;const s={ok:!1,can_continue:!1,pos:0,str:"",marker:0};if(n)s.str=n.str,s.marker=n.marker;else{if(r>=t)return s;let o=i.charCodeAt(r);if(o!==34&&o!==39&&o!==40)return s;e++,r++,o===40&&(o=41),s.marker=o}for(;r<t;){if(a=i.charCodeAt(r),a===s.marker)return s.pos=r+1,s.str+=pn(i.slice(e,r)),s.ok=!0,s;if(a===40&&s.marker===41)return s;a===92&&r+1<t&&r++,r++}return s.can_continue=!0,s.str+=pn(i.slice(e,r)),s}const Vf=Object.freeze(Object.defineProperty({__proto__:null,parseLinkDestination:Hf,parseLinkLabel:Nf,parseLinkTitle:zf},Symbol.toStringTag,{value:"Module"})),fi={};fi.code_inline=function(i,e,t,n,a){const r=i[e];return"<code"+a.renderAttrs(r)+">"+Ri(r.content)+"</code>"};fi.code_block=function(i,e,t,n,a){const r=i[e];return"<pre"+a.renderAttrs(r)+"><code>"+Ri(i[e].content)+`</code></pre>
`};fi.fence=function(i,e,t,n,a){const r=i[e],s=r.info?pn(r.info).trim():"";let o="",l="";if(s){const f=s.split(/(\s+)/g);o=f[0],l=f.slice(2).join("")}let u;if(t.highlight?u=t.highlight(r.content,o,l)||Ri(r.content):u=Ri(r.content),u.indexOf("<pre")===0)return u+`
`;if(s){const f=r.attrIndex("class"),c=r.attrs?r.attrs.slice():[];f<0?c.push(["class",t.langPrefix+o]):(c[f]=c[f].slice(),c[f][1]+=" "+t.langPrefix+o);const d={attrs:c};return`<pre><code${a.renderAttrs(d)}>${u}</code></pre>
`}return`<pre><code${a.renderAttrs(r)}>${u}</code></pre>
`};fi.image=function(i,e,t,n,a){const r=i[e];return r.attrs[r.attrIndex("alt")][1]=a.renderInlineAsText(r.children,t,n),a.renderToken(i,e,t)};fi.hardbreak=function(i,e,t){return t.xhtmlOut?`<br />
`:`<br>
`};fi.softbreak=function(i,e,t){return t.breaks?t.xhtmlOut?`<br />
`:`<br>
`:`
`};fi.text=function(i,e){return Ri(i[e].content)};fi.html_block=function(i,e){return i[e].content};fi.html_inline=function(i,e){return i[e].content};function bn(){this.rules=Ya({},fi)}bn.prototype.renderAttrs=function(e){let t,n,a;if(!e.attrs)return"";for(a="",t=0,n=e.attrs.length;t<n;t++)a+=" "+Ri(e.attrs[t][0])+'="'+Ri(e.attrs[t][1])+'"';return a};bn.prototype.renderToken=function(e,t,n){const a=e[t];let r="";if(a.hidden)return"";a.block&&a.nesting!==-1&&t&&e[t-1].hidden&&(r+=`
`),r+=(a.nesting===-1?"</":"<")+a.tag,r+=this.renderAttrs(a),a.nesting===0&&n.xhtmlOut&&(r+=" /");let s=!1;if(a.block&&(s=!0,a.nesting===1&&t+1<e.length)){const o=e[t+1];(o.type==="inline"||o.hidden||o.nesting===-1&&o.tag===a.tag)&&(s=!1)}return r+=s?`>
`:">",r};bn.prototype.renderInline=function(i,e,t){let n="";const a=this.rules;for(let r=0,s=i.length;r<s;r++){const o=i[r].type;typeof a[o]<"u"?n+=a[o](i,r,e,t,this):n+=this.renderToken(i,r,e)}return n};bn.prototype.renderInlineAsText=function(i,e,t){let n="";for(let a=0,r=i.length;a<r;a++)switch(i[a].type){case"text":n+=i[a].content;break;case"image":n+=this.renderInlineAsText(i[a].children,e,t);break;case"html_inline":case"html_block":n+=i[a].content;break;case"softbreak":case"hardbreak":n+=`
`;break}return n};bn.prototype.render=function(i,e,t){let n="";const a=this.rules;for(let r=0,s=i.length;r<s;r++){const o=i[r].type;o==="inline"?n+=this.renderInline(i[r].children,e,t):typeof a[o]<"u"?n+=a[o](i,r,e,t,this):n+=this.renderToken(i,r,e,t)}return n};function Mt(){this.__rules__=[],this.__cache__=null}Mt.prototype.__find__=function(i){for(let e=0;e<this.__rules__.length;e++)if(this.__rules__[e].name===i)return e;return-1};Mt.prototype.__compile__=function(){const i=this,e=[""];i.__rules__.forEach(function(t){t.enabled&&t.alt.forEach(function(n){e.indexOf(n)<0&&e.push(n)})}),i.__cache__={},e.forEach(function(t){i.__cache__[t]=[],i.__rules__.forEach(function(n){n.enabled&&(t&&n.alt.indexOf(t)<0||i.__cache__[t].push(n.fn))})})};Mt.prototype.at=function(i,e,t){const n=this.__find__(i),a=t||{};if(n===-1)throw new Error("Parser rule not found: "+i);this.__rules__[n].fn=e,this.__rules__[n].alt=a.alt||[],this.__cache__=null};Mt.prototype.before=function(i,e,t,n){const a=this.__find__(i),r=n||{};if(a===-1)throw new Error("Parser rule not found: "+i);this.__rules__.splice(a,0,{name:e,enabled:!0,fn:t,alt:r.alt||[]}),this.__cache__=null};Mt.prototype.after=function(i,e,t,n){const a=this.__find__(i),r=n||{};if(a===-1)throw new Error("Parser rule not found: "+i);this.__rules__.splice(a+1,0,{name:e,enabled:!0,fn:t,alt:r.alt||[]}),this.__cache__=null};Mt.prototype.push=function(i,e,t){const n=t||{};this.__rules__.push({name:i,enabled:!0,fn:e,alt:n.alt||[]}),this.__cache__=null};Mt.prototype.enable=function(i,e){Array.isArray(i)||(i=[i]);const t=[];return i.forEach(function(n){const a=this.__find__(n);if(a<0){if(e)return;throw new Error("Rules manager: invalid rule name "+n)}this.__rules__[a].enabled=!0,t.push(n)},this),this.__cache__=null,t};Mt.prototype.enableOnly=function(i,e){Array.isArray(i)||(i=[i]),this.__rules__.forEach(function(t){t.enabled=!1}),this.enable(i,e)};Mt.prototype.disable=function(i,e){Array.isArray(i)||(i=[i]);const t=[];return i.forEach(function(n){const a=this.__find__(n);if(a<0){if(e)return;throw new Error("Rules manager: invalid rule name "+n)}this.__rules__[a].enabled=!1,t.push(n)},this),this.__cache__=null,t};Mt.prototype.getRules=function(i){return this.__cache__===null&&this.__compile__(),this.__cache__[i]||[]};function Jt(i,e,t){this.type=i,this.tag=e,this.attrs=null,this.map=null,this.nesting=t,this.level=0,this.children=null,this.content="",this.markup="",this.info="",this.meta=null,this.block=!1,this.hidden=!1}Jt.prototype.attrIndex=function(e){if(!this.attrs)return-1;const t=this.attrs;for(let n=0,a=t.length;n<a;n++)if(t[n][0]===e)return n;return-1};Jt.prototype.attrPush=function(e){this.attrs?this.attrs.push(e):this.attrs=[e]};Jt.prototype.attrSet=function(e,t){const n=this.attrIndex(e),a=[e,t];n<0?this.attrPush(a):this.attrs[n]=a};Jt.prototype.attrGet=function(e){const t=this.attrIndex(e);let n=null;return t>=0&&(n=this.attrs[t][1]),n};Jt.prototype.attrJoin=function(e,t){const n=this.attrIndex(e);n<0?this.attrPush([e,t]):this.attrs[n][1]=this.attrs[n][1]+" "+t};function uu(i,e,t){this.src=i,this.env=t,this.tokens=[],this.inlineMode=!1,this.md=e}uu.prototype.Token=Jt;const Uf=/\r\n?|\n/g,Wf=/\0/g;function Gf(i){let e;e=i.src.replace(Uf,`
`),e=e.replace(Wf,"�"),i.src=e}function qf(i){let e;i.inlineMode?(e=new i.Token("inline","",0),e.content=i.src,e.map=[0,1],e.children=[],i.tokens.push(e)):i.md.block.parse(i.src,i.md,i.env,i.tokens)}function jf(i){const e=i.tokens;for(let t=0,n=e.length;t<n;t++){const a=e[t];a.type==="inline"&&i.md.inline.parse(a.content,i.md,i.env,a.children)}}function $f(i){return/^<a[>\s]/i.test(i)}function Yf(i){return/^<\/a\s*>/i.test(i)}function Kf(i){const e=i.tokens;if(i.md.options.linkify)for(let t=0,n=e.length;t<n;t++){if(e[t].type!=="inline"||!i.md.linkify.pretest(e[t].content))continue;let a=e[t].children,r=0;for(let s=a.length-1;s>=0;s--){const o=a[s];if(o.type==="link_close"){for(s--;a[s].level!==o.level&&a[s].type!=="link_open";)s--;continue}if(o.type==="html_inline"&&($f(o.content)&&r>0&&r--,Yf(o.content)&&r++),!(r>0)&&o.type==="text"&&i.md.linkify.test(o.content)){const l=o.content;let u=i.md.linkify.match(l);const f=[];let c=o.level,d=0;u.length>0&&u[0].index===0&&s>0&&a[s-1].type==="text_special"&&(u=u.slice(1));for(let h=0;h<u.length;h++){const p=u[h].url,m=i.md.normalizeLink(p);if(!i.md.validateLink(m))continue;let g=u[h].text;u[h].schema?u[h].schema==="mailto:"&&!/^mailto:/i.test(g)?g=i.md.normalizeLinkText("mailto:"+g).replace(/^mailto:/,""):g=i.md.normalizeLinkText(g):g=i.md.normalizeLinkText("http://"+g).replace(/^http:\/\//,"");const b=u[h].index;if(b>d){const C=new i.Token("text","",0);C.content=l.slice(d,b),C.level=c,f.push(C)}const x=new i.Token("link_open","a",1);x.attrs=[["href",m]],x.level=c++,x.markup="linkify",x.info="auto",f.push(x);const w=new i.Token("text","",0);w.content=g,w.level=c,f.push(w);const E=new i.Token("link_close","a",-1);E.level=--c,E.markup="linkify",E.info="auto",f.push(E),d=u[h].lastIndex}if(d<l.length){const h=new i.Token("text","",0);h.content=l.slice(d),h.level=c,f.push(h)}e[t].children=a=lu(a,s,f)}}}}const du=/\+-|\.\.|\?\?\?\?|!!!!|,,|--/,Xf=/\((c|tm|r)\)/i,Zf=/\((c|tm|r)\)/ig,Qf={c:"©",r:"®",tm:"™"};function Jf(i,e){return Qf[e.toLowerCase()]}function ep(i){let e=0;for(let t=i.length-1;t>=0;t--){const n=i[t];n.type==="text"&&!e&&(n.content=n.content.replace(Zf,Jf)),n.type==="link_open"&&n.info==="auto"&&e--,n.type==="link_close"&&n.info==="auto"&&e++}}function tp(i){let e=0;for(let t=i.length-1;t>=0;t--){const n=i[t];n.type==="text"&&!e&&du.test(n.content)&&(n.content=n.content.replace(/\+-/g,"±").replace(/\.{2,}/g,"…").replace(/([?!])…/g,"$1..").replace(/([?!]){4,}/g,"$1$1$1").replace(/,{2,}/g,",").replace(/(^|[^-])---(?=[^-]|$)/mg,"$1—").replace(/(^|\s)--(?=\s|$)/mg,"$1–").replace(/(^|[^-\s])--(?=[^-\s]|$)/mg,"$1–")),n.type==="link_open"&&n.info==="auto"&&e--,n.type==="link_close"&&n.info==="auto"&&e++}}function ip(i){let e;if(i.md.options.typographer)for(e=i.tokens.length-1;e>=0;e--)i.tokens[e].type==="inline"&&(Xf.test(i.tokens[e].content)&&ep(i.tokens[e].children),du.test(i.tokens[e].content)&&tp(i.tokens[e].children))}const np=/['"]/,Ol=/['"]/g,Nl="’";function ua(i,e,t){return i.slice(0,e)+t+i.slice(e+1)}function ap(i,e){let t;const n=[];for(let a=0;a<i.length;a++){const r=i[a],s=i[a].level;for(t=n.length-1;t>=0&&!(n[t].level<=s);t--);if(n.length=t+1,r.type!=="text")continue;let o=r.content,l=0,u=o.length;e:for(;l<u;){Ol.lastIndex=l;const f=Ol.exec(o);if(!f)break;let c=!0,d=!0;l=f.index+1;const h=f[0]==="'";let p=32;if(f.index-1>=0)p=o.charCodeAt(f.index-1);else for(t=a-1;t>=0&&!(i[t].type==="softbreak"||i[t].type==="hardbreak");t--)if(i[t].content){p=i[t].content.charCodeAt(i[t].content.length-1);break}let m=32;if(l<u)m=o.charCodeAt(l);else for(t=a+1;t<i.length&&!(i[t].type==="softbreak"||i[t].type==="hardbreak");t++)if(i[t].content){m=i[t].content.charCodeAt(0);break}const g=Yn(p)||$n(String.fromCharCode(p)),b=Yn(m)||$n(String.fromCharCode(m)),x=jn(p),w=jn(m);if(w?c=!1:b&&(x||g||(c=!1)),x?d=!1:g&&(w||b||(d=!1)),m===34&&f[0]==='"'&&p>=48&&p<=57&&(d=c=!1),c&&d&&(c=g,d=b),!c&&!d){h&&(r.content=ua(r.content,f.index,Nl));continue}if(d)for(t=n.length-1;t>=0;t--){let E=n[t];if(n[t].level<s)break;if(E.single===h&&n[t].level===s){E=n[t];let C,B;h?(C=e.md.options.quotes[2],B=e.md.options.quotes[3]):(C=e.md.options.quotes[0],B=e.md.options.quotes[1]),r.content=ua(r.content,f.index,B),i[E.token].content=ua(i[E.token].content,E.pos,C),l+=B.length-1,E.token===a&&(l+=C.length-1),o=r.content,u=o.length,n.length=t;continue e}}c?n.push({token:a,pos:f.index,single:h,level:s}):d&&h&&(r.content=ua(r.content,f.index,Nl))}}}function rp(i){if(i.md.options.typographer)for(let e=i.tokens.length-1;e>=0;e--)i.tokens[e].type!=="inline"||!np.test(i.tokens[e].content)||ap(i.tokens[e].children,i)}function sp(i){let e,t;const n=i.tokens,a=n.length;for(let r=0;r<a;r++){if(n[r].type!=="inline")continue;const s=n[r].children,o=s.length;for(e=0;e<o;e++)s[e].type==="text_special"&&(s[e].type="text");for(e=t=0;e<o;e++)s[e].type==="text"&&e+1<o&&s[e+1].type==="text"?s[e+1].content=s[e].content+s[e+1].content:(e!==t&&(s[t]=s[e]),t++);e!==t&&(s.length=t)}}const es=[["normalize",Gf],["block",qf],["inline",jf],["linkify",Kf],["replacements",ip],["smartquotes",rp],["text_join",sp]];function fo(){this.ruler=new Mt;for(let i=0;i<es.length;i++)this.ruler.push(es[i][0],es[i][1])}fo.prototype.process=function(i){const e=this.ruler.getRules("");for(let t=0,n=e.length;t<n;t++)e[t](i)};fo.prototype.State=uu;function pi(i,e,t,n){this.src=i,this.md=e,this.env=t,this.tokens=n,this.bMarks=[],this.eMarks=[],this.tShift=[],this.sCount=[],this.bsCount=[],this.blkIndent=0,this.line=0,this.lineMax=0,this.tight=!1,this.ddIndent=-1,this.listIndent=-1,this.parentType="root",this.level=0;const a=this.src;for(let r=0,s=0,o=0,l=0,u=a.length,f=!1;s<u;s++){const c=a.charCodeAt(s);if(!f)if(Ze(c)){o++,c===9?l+=4-l%4:l++;continue}else f=!0;(c===10||s===u-1)&&(c!==10&&s++,this.bMarks.push(r),this.eMarks.push(s),this.tShift.push(o),this.sCount.push(l),this.bsCount.push(0),f=!1,o=0,l=0,r=s+1)}this.bMarks.push(a.length),this.eMarks.push(a.length),this.tShift.push(0),this.sCount.push(0),this.bsCount.push(0),this.lineMax=this.bMarks.length-1}pi.prototype.push=function(i,e,t){const n=new Jt(i,e,t);return n.block=!0,t<0&&this.level--,n.level=this.level,t>0&&this.level++,this.tokens.push(n),n};pi.prototype.isEmpty=function(e){return this.bMarks[e]+this.tShift[e]>=this.eMarks[e]};pi.prototype.skipEmptyLines=function(e){for(let t=this.lineMax;e<t&&!(this.bMarks[e]+this.tShift[e]<this.eMarks[e]);e++);return e};pi.prototype.skipSpaces=function(e){for(let t=this.src.length;e<t;e++){const n=this.src.charCodeAt(e);if(!Ze(n))break}return e};pi.prototype.skipSpacesBack=function(e,t){if(e<=t)return e;for(;e>t;)if(!Ze(this.src.charCodeAt(--e)))return e+1;return e};pi.prototype.skipChars=function(e,t){for(let n=this.src.length;e<n&&this.src.charCodeAt(e)===t;e++);return e};pi.prototype.skipCharsBack=function(e,t,n){if(e<=n)return e;for(;e>n;)if(t!==this.src.charCodeAt(--e))return e+1;return e};pi.prototype.getLines=function(e,t,n,a){if(e>=t)return"";const r=new Array(t-e);for(let s=0,o=e;o<t;o++,s++){let l=0;const u=this.bMarks[o];let f=u,c;for(o+1<t||a?c=this.eMarks[o]+1:c=this.eMarks[o];f<c&&l<n;){const d=this.src.charCodeAt(f);if(Ze(d))d===9?l+=4-(l+this.bsCount[o])%4:l++;else if(f-u<this.tShift[o])l++;else break;f++}l>n?r[s]=new Array(l-n+1).join(" ")+this.src.slice(f,c):r[s]=this.src.slice(f,c)}return r.join("")};pi.prototype.Token=Jt;const op=65536;function ts(i,e){const t=i.bMarks[e]+i.tShift[e],n=i.eMarks[e];return i.src.slice(t,n)}function Hl(i){const e=[],t=i.length;let n=0,a=i.charCodeAt(n),r=!1,s=0,o="";for(;n<t;)a===124&&(r?(o+=i.substring(s,n-1),s=n):(e.push(o+i.substring(s,n)),o="",s=n+1)),r=a===92,n++,a=i.charCodeAt(n);return e.push(o+i.substring(s)),e}function lp(i,e,t,n){if(e+2>t)return!1;let a=e+1;if(i.sCount[a]<i.blkIndent||i.sCount[a]-i.blkIndent>=4)return!1;let r=i.bMarks[a]+i.tShift[a];if(r>=i.eMarks[a])return!1;const s=i.src.charCodeAt(r++);if(s!==124&&s!==45&&s!==58||r>=i.eMarks[a])return!1;const o=i.src.charCodeAt(r++);if(o!==124&&o!==45&&o!==58&&!Ze(o)||s===45&&Ze(o))return!1;for(;r<i.eMarks[a];){const E=i.src.charCodeAt(r);if(E!==124&&E!==45&&E!==58&&!Ze(E))return!1;r++}let l=ts(i,e+1),u=l.split("|");const f=[];for(let E=0;E<u.length;E++){const C=u[E].trim();if(!C){if(E===0||E===u.length-1)continue;return!1}if(!/^:?-+:?$/.test(C))return!1;C.charCodeAt(C.length-1)===58?f.push(C.charCodeAt(0)===58?"center":"right"):C.charCodeAt(0)===58?f.push("left"):f.push("")}if(l=ts(i,e).trim(),l.indexOf("|")===-1||i.sCount[e]-i.blkIndent>=4)return!1;u=Hl(l),u.length&&u[0]===""&&u.shift(),u.length&&u[u.length-1]===""&&u.pop();const c=u.length;if(c===0||c!==f.length)return!1;if(n)return!0;const d=i.parentType;i.parentType="table";const h=i.md.block.ruler.getRules("blockquote"),p=i.push("table_open","table",1),m=[e,0];p.map=m;const g=i.push("thead_open","thead",1);g.map=[e,e+1];const b=i.push("tr_open","tr",1);b.map=[e,e+1];for(let E=0;E<u.length;E++){const C=i.push("th_open","th",1);f[E]&&(C.attrs=[["style","text-align:"+f[E]]]);const B=i.push("inline","",0);B.content=u[E].trim(),B.children=[],i.push("th_close","th",-1)}i.push("tr_close","tr",-1),i.push("thead_close","thead",-1);let x,w=0;for(a=e+2;a<t&&!(i.sCount[a]<i.blkIndent);a++){let E=!1;for(let B=0,D=h.length;B<D;B++)if(h[B](i,a,t,!0)){E=!0;break}if(E||(l=ts(i,a).trim(),!l)||i.sCount[a]-i.blkIndent>=4||(u=Hl(l),u.length&&u[0]===""&&u.shift(),u.length&&u[u.length-1]===""&&u.pop(),w+=c-u.length,w>op))break;if(a===e+2){const B=i.push("tbody_open","tbody",1);B.map=x=[e+2,0]}const C=i.push("tr_open","tr",1);C.map=[a,a+1];for(let B=0;B<c;B++){const D=i.push("td_open","td",1);f[B]&&(D.attrs=[["style","text-align:"+f[B]]]);const O=i.push("inline","",0);O.content=u[B]?u[B].trim():"",O.children=[],i.push("td_close","td",-1)}i.push("tr_close","tr",-1)}return x&&(i.push("tbody_close","tbody",-1),x[1]=a),i.push("table_close","table",-1),m[1]=a,i.parentType=d,i.line=a,!0}function cp(i,e,t){if(i.sCount[e]-i.blkIndent<4)return!1;let n=e+1,a=n;for(;n<t;){if(i.isEmpty(n)){n++;continue}if(i.sCount[n]-i.blkIndent>=4){n++,a=n;continue}break}i.line=a;const r=i.push("code_block","code",0);return r.content=i.getLines(e,a,4+i.blkIndent,!1)+`
`,r.map=[e,i.line],!0}function up(i,e,t,n){let a=i.bMarks[e]+i.tShift[e],r=i.eMarks[e];if(i.sCount[e]-i.blkIndent>=4||a+3>r)return!1;const s=i.src.charCodeAt(a);if(s!==126&&s!==96)return!1;let o=a;a=i.skipChars(a,s);let l=a-o;if(l<3)return!1;const u=i.src.slice(o,a),f=i.src.slice(a,r);if(s===96&&f.indexOf(String.fromCharCode(s))>=0)return!1;if(n)return!0;let c=e,d=!1;for(;c++,!(c>=t||(a=o=i.bMarks[c]+i.tShift[c],r=i.eMarks[c],a<r&&i.sCount[c]<i.blkIndent));)if(i.src.charCodeAt(a)===s&&!(i.sCount[c]-i.blkIndent>=4)&&(a=i.skipChars(a,s),!(a-o<l)&&(a=i.skipSpaces(a),!(a<r)))){d=!0;break}l=i.sCount[e],i.line=c+(d?1:0);const h=i.push("fence","code",0);return h.info=f,h.content=i.getLines(e+1,c,l,!0),h.markup=u,h.map=[e,i.line],!0}function dp(i,e,t,n){let a=i.bMarks[e]+i.tShift[e],r=i.eMarks[e];const s=i.lineMax;if(i.sCount[e]-i.blkIndent>=4||i.src.charCodeAt(a)!==62)return!1;if(n)return!0;const o=[],l=[],u=[],f=[],c=i.md.block.ruler.getRules("blockquote"),d=i.parentType;i.parentType="blockquote";let h=!1,p;for(p=e;p<t;p++){const w=i.sCount[p]<i.blkIndent;if(a=i.bMarks[p]+i.tShift[p],r=i.eMarks[p],a>=r)break;if(i.src.charCodeAt(a++)===62&&!w){let C=i.sCount[p]+1,B,D;i.src.charCodeAt(a)===32?(a++,C++,D=!1,B=!0):i.src.charCodeAt(a)===9?(B=!0,(i.bsCount[p]+C)%4===3?(a++,C++,D=!1):D=!0):B=!1;let O=C;for(o.push(i.bMarks[p]),i.bMarks[p]=a;a<r;){const H=i.src.charCodeAt(a);if(Ze(H))H===9?O+=4-(O+i.bsCount[p]+(D?1:0))%4:O++;else break;a++}h=a>=r,l.push(i.bsCount[p]),i.bsCount[p]=i.sCount[p]+1+(B?1:0),u.push(i.sCount[p]),i.sCount[p]=O-C,f.push(i.tShift[p]),i.tShift[p]=a-i.bMarks[p];continue}if(h)break;let E=!1;for(let C=0,B=c.length;C<B;C++)if(c[C](i,p,t,!0)){E=!0;break}if(E){i.lineMax=p,i.blkIndent!==0&&(o.push(i.bMarks[p]),l.push(i.bsCount[p]),f.push(i.tShift[p]),u.push(i.sCount[p]),i.sCount[p]-=i.blkIndent);break}o.push(i.bMarks[p]),l.push(i.bsCount[p]),f.push(i.tShift[p]),u.push(i.sCount[p]),i.sCount[p]=-1}const m=i.blkIndent;i.blkIndent=0;const g=i.push("blockquote_open","blockquote",1);g.markup=">";const b=[e,0];g.map=b,i.md.block.tokenize(i,e,p);const x=i.push("blockquote_close","blockquote",-1);x.markup=">",i.lineMax=s,i.parentType=d,b[1]=i.line;for(let w=0;w<f.length;w++)i.bMarks[w+e]=o[w],i.tShift[w+e]=f[w],i.sCount[w+e]=u[w],i.bsCount[w+e]=l[w];return i.blkIndent=m,!0}function hp(i,e,t,n){const a=i.eMarks[e];if(i.sCount[e]-i.blkIndent>=4)return!1;let r=i.bMarks[e]+i.tShift[e];const s=i.src.charCodeAt(r++);if(s!==42&&s!==45&&s!==95)return!1;let o=1;for(;r<a;){const u=i.src.charCodeAt(r++);if(u!==s&&!Ze(u))return!1;u===s&&o++}if(o<3)return!1;if(n)return!0;i.line=e+1;const l=i.push("hr","hr",0);return l.map=[e,i.line],l.markup=Array(o+1).join(String.fromCharCode(s)),!0}function zl(i,e){const t=i.eMarks[e];let n=i.bMarks[e]+i.tShift[e];const a=i.src.charCodeAt(n++);if(a!==42&&a!==45&&a!==43)return-1;if(n<t){const r=i.src.charCodeAt(n);if(!Ze(r))return-1}return n}function Vl(i,e){const t=i.bMarks[e]+i.tShift[e],n=i.eMarks[e];let a=t;if(a+1>=n)return-1;let r=i.src.charCodeAt(a++);if(r<48||r>57)return-1;for(;;){if(a>=n)return-1;if(r=i.src.charCodeAt(a++),r>=48&&r<=57){if(a-t>=10)return-1;continue}if(r===41||r===46)break;return-1}return a<n&&(r=i.src.charCodeAt(a),!Ze(r))?-1:a}function fp(i,e){const t=i.level+2;for(let n=e+2,a=i.tokens.length-2;n<a;n++)i.tokens[n].level===t&&i.tokens[n].type==="paragraph_open"&&(i.tokens[n+2].hidden=!0,i.tokens[n].hidden=!0,n+=2)}function pp(i,e,t,n){let a,r,s,o,l=e,u=!0;if(i.sCount[l]-i.blkIndent>=4||i.listIndent>=0&&i.sCount[l]-i.listIndent>=4&&i.sCount[l]<i.blkIndent)return!1;let f=!1;n&&i.parentType==="paragraph"&&i.sCount[l]>=i.blkIndent&&(f=!0);let c,d,h;if((h=Vl(i,l))>=0){if(c=!0,s=i.bMarks[l]+i.tShift[l],d=Number(i.src.slice(s,h-1)),f&&d!==1)return!1}else if((h=zl(i,l))>=0)c=!1;else return!1;if(f&&i.skipSpaces(h)>=i.eMarks[l])return!1;if(n)return!0;const p=i.src.charCodeAt(h-1),m=i.tokens.length;c?(o=i.push("ordered_list_open","ol",1),d!==1&&(o.attrs=[["start",d]])):o=i.push("bullet_list_open","ul",1);const g=[l,0];o.map=g,o.markup=String.fromCharCode(p);let b=!1;const x=i.md.block.ruler.getRules("list"),w=i.parentType;for(i.parentType="list";l<t;){r=h,a=i.eMarks[l];const E=i.sCount[l]+h-(i.bMarks[l]+i.tShift[l]);let C=E;for(;r<a;){const S=i.src.charCodeAt(r);if(S===9)C+=4-(C+i.bsCount[l])%4;else if(S===32)C++;else break;r++}const B=r;let D;B>=a?D=1:D=C-E,D>4&&(D=1);const O=E+D;o=i.push("list_item_open","li",1),o.markup=String.fromCharCode(p);const H=[l,0];o.map=H,c&&(o.info=i.src.slice(s,h-1));const Y=i.tight,ae=i.tShift[l],M=i.sCount[l],P=i.listIndent;if(i.listIndent=i.blkIndent,i.blkIndent=O,i.tight=!0,i.tShift[l]=B-i.bMarks[l],i.sCount[l]=C,B>=a&&i.isEmpty(l+1)?i.line=Math.min(i.line+2,t):i.md.block.tokenize(i,l,t,!0),(!i.tight||b)&&(u=!1),b=i.line-l>1&&i.isEmpty(i.line-1),i.blkIndent=i.listIndent,i.listIndent=P,i.tShift[l]=ae,i.sCount[l]=M,i.tight=Y,o=i.push("list_item_close","li",-1),o.markup=String.fromCharCode(p),l=i.line,H[1]=l,l>=t||i.sCount[l]<i.blkIndent||i.sCount[l]-i.blkIndent>=4)break;let v=!1;for(let S=0,$=x.length;S<$;S++)if(x[S](i,l,t,!0)){v=!0;break}if(v)break;if(c){if(h=Vl(i,l),h<0)break;s=i.bMarks[l]+i.tShift[l]}else if(h=zl(i,l),h<0)break;if(p!==i.src.charCodeAt(h-1))break}return c?o=i.push("ordered_list_close","ol",-1):o=i.push("bullet_list_close","ul",-1),o.markup=String.fromCharCode(p),g[1]=l,i.line=l,i.parentType=w,u&&fp(i,m),!0}function mp(i,e,t,n){let a=i.bMarks[e]+i.tShift[e],r=i.eMarks[e],s=e+1;if(i.sCount[e]-i.blkIndent>=4||i.src.charCodeAt(a)!==91)return!1;function o(x){const w=i.lineMax;if(x>=w||i.isEmpty(x))return null;let E=!1;if(i.sCount[x]-i.blkIndent>3&&(E=!0),i.sCount[x]<0&&(E=!0),!E){const D=i.md.block.ruler.getRules("reference"),O=i.parentType;i.parentType="reference";let H=!1;for(let Y=0,ae=D.length;Y<ae;Y++)if(D[Y](i,x,w,!0)){H=!0;break}if(i.parentType=O,H)return null}const C=i.bMarks[x]+i.tShift[x],B=i.eMarks[x];return i.src.slice(C,B+1)}let l=i.src.slice(a,r+1);r=l.length;let u=-1;for(a=1;a<r;a++){const x=l.charCodeAt(a);if(x===91)return!1;if(x===93){u=a;break}else if(x===10){const w=o(s);w!==null&&(l+=w,r=l.length,s++)}else if(x===92&&(a++,a<r&&l.charCodeAt(a)===10)){const w=o(s);w!==null&&(l+=w,r=l.length,s++)}}if(u<0||l.charCodeAt(u+1)!==58)return!1;for(a=u+2;a<r;a++){const x=l.charCodeAt(a);if(x===10){const w=o(s);w!==null&&(l+=w,r=l.length,s++)}else if(!Ze(x))break}const f=i.md.helpers.parseLinkDestination(l,a,r);if(!f.ok)return!1;const c=i.md.normalizeLink(f.str);if(!i.md.validateLink(c))return!1;a=f.pos;const d=a,h=s,p=a;for(;a<r;a++){const x=l.charCodeAt(a);if(x===10){const w=o(s);w!==null&&(l+=w,r=l.length,s++)}else if(!Ze(x))break}let m=i.md.helpers.parseLinkTitle(l,a,r);for(;m.can_continue;){const x=o(s);if(x===null)break;l+=x,a=r,r=l.length,s++,m=i.md.helpers.parseLinkTitle(l,a,r,m)}let g;for(a<r&&p!==a&&m.ok?(g=m.str,a=m.pos):(g="",a=d,s=h);a<r;){const x=l.charCodeAt(a);if(!Ze(x))break;a++}if(a<r&&l.charCodeAt(a)!==10&&g)for(g="",a=d,s=h;a<r;){const x=l.charCodeAt(a);if(!Ze(x))break;a++}if(a<r&&l.charCodeAt(a)!==10)return!1;const b=Ka(l.slice(1,u));return b?(n||(typeof i.env.references>"u"&&(i.env.references={}),typeof i.env.references[b]>"u"&&(i.env.references[b]={title:g,href:c}),i.line=s),!0):!1}const gp=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],bp="[a-zA-Z_:][a-zA-Z0-9:._-]*",yp="[^\"'=<>`\\x00-\\x20]+",wp="'[^']*'",vp='"[^"]*"',xp="(?:"+yp+"|"+wp+"|"+vp+")",_p="(?:\\s+"+bp+"(?:\\s*=\\s*"+xp+")?)",hu="<[A-Za-z][A-Za-z0-9\\-]*"+_p+"*\\s*\\/?>",fu="<\\/[A-Za-z][A-Za-z0-9\\-]*\\s*>",Ep="<!---?>|<!--(?:[^-]|-[^-]|--[^>])*-->",Cp="<[?][\\s\\S]*?[?]>",Ap="<![A-Za-z][^>]*>",kp="<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",Sp=new RegExp("^(?:"+hu+"|"+fu+"|"+Ep+"|"+Cp+"|"+Ap+"|"+kp+")"),Tp=new RegExp("^(?:"+hu+"|"+fu+")"),Ji=[[/^<(script|pre|style|textarea)(?=(\s|>|$))/i,/<\/(script|pre|style|textarea)>/i,!0],[/^<!--/,/-->/,!0],[/^<\?/,/\?>/,!0],[/^<![A-Z]/,/>/,!0],[/^<!\[CDATA\[/,/\]\]>/,!0],[new RegExp("^</?("+gp.join("|")+")(?=(\\s|/?>|$))","i"),/^$/,!0],[new RegExp(Tp.source+"\\s*$"),/^$/,!1]];function Mp(i,e,t,n){let a=i.bMarks[e]+i.tShift[e],r=i.eMarks[e];if(i.sCount[e]-i.blkIndent>=4||!i.md.options.html||i.src.charCodeAt(a)!==60)return!1;let s=i.src.slice(a,r),o=0;for(;o<Ji.length&&!Ji[o][0].test(s);o++);if(o===Ji.length)return!1;if(n)return Ji[o][2];let l=e+1;if(!Ji[o][1].test(s)){for(;l<t&&!(i.sCount[l]<i.blkIndent);l++)if(a=i.bMarks[l]+i.tShift[l],r=i.eMarks[l],s=i.src.slice(a,r),Ji[o][1].test(s)){s.length!==0&&l++;break}}i.line=l;const u=i.push("html_block","",0);return u.map=[e,l],u.content=i.getLines(e,l,i.blkIndent,!0),!0}function Lp(i,e,t,n){let a=i.bMarks[e]+i.tShift[e],r=i.eMarks[e];if(i.sCount[e]-i.blkIndent>=4)return!1;let s=i.src.charCodeAt(a);if(s!==35||a>=r)return!1;let o=1;for(s=i.src.charCodeAt(++a);s===35&&a<r&&o<=6;)o++,s=i.src.charCodeAt(++a);if(o>6||a<r&&!Ze(s))return!1;if(n)return!0;r=i.skipSpacesBack(r,a);const l=i.skipCharsBack(r,35,a);l>a&&Ze(i.src.charCodeAt(l-1))&&(r=l),i.line=e+1;const u=i.push("heading_open","h"+String(o),1);u.markup="########".slice(0,o),u.map=[e,i.line];const f=i.push("inline","",0);f.content=i.src.slice(a,r).trim(),f.map=[e,i.line],f.children=[];const c=i.push("heading_close","h"+String(o),-1);return c.markup="########".slice(0,o),!0}function Dp(i,e,t){const n=i.md.block.ruler.getRules("paragraph");if(i.sCount[e]-i.blkIndent>=4)return!1;const a=i.parentType;i.parentType="paragraph";let r=0,s,o=e+1;for(;o<t&&!i.isEmpty(o);o++){if(i.sCount[o]-i.blkIndent>3)continue;if(i.sCount[o]>=i.blkIndent){let h=i.bMarks[o]+i.tShift[o];const p=i.eMarks[o];if(h<p&&(s=i.src.charCodeAt(h),(s===45||s===61)&&(h=i.skipChars(h,s),h=i.skipSpaces(h),h>=p))){r=s===61?1:2;break}}if(i.sCount[o]<0)continue;let d=!1;for(let h=0,p=n.length;h<p;h++)if(n[h](i,o,t,!0)){d=!0;break}if(d)break}if(!r)return!1;const l=i.getLines(e,o,i.blkIndent,!1).trim();i.line=o+1;const u=i.push("heading_open","h"+String(r),1);u.markup=String.fromCharCode(s),u.map=[e,i.line];const f=i.push("inline","",0);f.content=l,f.map=[e,i.line-1],f.children=[];const c=i.push("heading_close","h"+String(r),-1);return c.markup=String.fromCharCode(s),i.parentType=a,!0}function Bp(i,e,t){const n=i.md.block.ruler.getRules("paragraph"),a=i.parentType;let r=e+1;for(i.parentType="paragraph";r<t&&!i.isEmpty(r);r++){if(i.sCount[r]-i.blkIndent>3||i.sCount[r]<0)continue;let u=!1;for(let f=0,c=n.length;f<c;f++)if(n[f](i,r,t,!0)){u=!0;break}if(u)break}const s=i.getLines(e,r,i.blkIndent,!1).trim();i.line=r;const o=i.push("paragraph_open","p",1);o.map=[e,i.line];const l=i.push("inline","",0);return l.content=s,l.map=[e,i.line],l.children=[],i.push("paragraph_close","p",-1),i.parentType=a,!0}const da=[["table",lp,["paragraph","reference"]],["code",cp],["fence",up,["paragraph","reference","blockquote","list"]],["blockquote",dp,["paragraph","reference","blockquote","list"]],["hr",hp,["paragraph","reference","blockquote","list"]],["list",pp,["paragraph","reference","blockquote"]],["reference",mp],["html_block",Mp,["paragraph","reference","blockquote"]],["heading",Lp,["paragraph","reference","blockquote"]],["lheading",Dp],["paragraph",Bp]];function Xa(){this.ruler=new Mt;for(let i=0;i<da.length;i++)this.ruler.push(da[i][0],da[i][1],{alt:(da[i][2]||[]).slice()})}Xa.prototype.tokenize=function(i,e,t){const n=this.ruler.getRules(""),a=n.length,r=i.md.options.maxNesting;let s=e,o=!1;for(;s<t&&(i.line=s=i.skipEmptyLines(s),!(s>=t||i.sCount[s]<i.blkIndent));){if(i.level>=r){i.line=t;break}const l=i.line;let u=!1;for(let f=0;f<a;f++)if(u=n[f](i,s,t,!1),u){if(l>=i.line)throw new Error("block rule didn't increment state.line");break}if(!u)throw new Error("none of the block rules matched");i.tight=!o,i.isEmpty(i.line-1)&&(o=!0),s=i.line,s<t&&i.isEmpty(s)&&(o=!0,s++,i.line=s)}};Xa.prototype.parse=function(i,e,t,n){if(!i)return;const a=new this.State(i,e,t,n);this.tokenize(a,a.line,a.lineMax)};Xa.prototype.State=pi;function na(i,e,t,n){this.src=i,this.env=t,this.md=e,this.tokens=n,this.tokens_meta=Array(n.length),this.pos=0,this.posMax=this.src.length,this.level=0,this.pending="",this.pendingLevel=0,this.cache={},this.delimiters=[],this._prev_delimiters=[],this.backticks={},this.backticksScanned=!1,this.linkLevel=0}na.prototype.pushPending=function(){const i=new Jt("text","",0);return i.content=this.pending,i.level=this.pendingLevel,this.tokens.push(i),this.pending="",i};na.prototype.push=function(i,e,t){this.pending&&this.pushPending();const n=new Jt(i,e,t);let a=null;return t<0&&(this.level--,this.delimiters=this._prev_delimiters.pop()),n.level=this.level,t>0&&(this.level++,this._prev_delimiters.push(this.delimiters),this.delimiters=[],a={delimiters:this.delimiters}),this.pendingLevel=this.level,this.tokens.push(n),this.tokens_meta.push(a),n};na.prototype.scanDelims=function(i,e){const t=this.posMax,n=this.src.charCodeAt(i),a=i>0?this.src.charCodeAt(i-1):32;let r=i;for(;r<t&&this.src.charCodeAt(r)===n;)r++;const s=r-i,o=r<t?this.src.charCodeAt(r):32,l=Yn(a)||$n(String.fromCharCode(a)),u=Yn(o)||$n(String.fromCharCode(o)),f=jn(a),c=jn(o),d=!c&&(!u||f||l),h=!f&&(!l||c||u);return{can_open:d&&(e||!h||l),can_close:h&&(e||!d||u),length:s}};na.prototype.Token=Jt;function Fp(i){switch(i){case 10:case 33:case 35:case 36:case 37:case 38:case 42:case 43:case 45:case 58:case 60:case 61:case 62:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 125:case 126:return!0;default:return!1}}function Ip(i,e){let t=i.pos;for(;t<i.posMax&&!Fp(i.src.charCodeAt(t));)t++;return t===i.pos?!1:(e||(i.pending+=i.src.slice(i.pos,t)),i.pos=t,!0)}const Rp=/(?:^|[^a-z0-9.+-])([a-z][a-z0-9.+-]*)$/i;function Pp(i,e){if(!i.md.options.linkify||i.linkLevel>0)return!1;const t=i.pos,n=i.posMax;if(t+3>n||i.src.charCodeAt(t)!==58||i.src.charCodeAt(t+1)!==47||i.src.charCodeAt(t+2)!==47)return!1;const a=i.pending.match(Rp);if(!a)return!1;const r=a[1],s=i.md.linkify.matchAtStart(i.src.slice(t-r.length));if(!s)return!1;let o=s.url;if(o.length<=r.length)return!1;o=o.replace(/\*+$/,"");const l=i.md.normalizeLink(o);if(!i.md.validateLink(l))return!1;if(!e){i.pending=i.pending.slice(0,-r.length);const u=i.push("link_open","a",1);u.attrs=[["href",l]],u.markup="linkify",u.info="auto";const f=i.push("text","",0);f.content=i.md.normalizeLinkText(o);const c=i.push("link_close","a",-1);c.markup="linkify",c.info="auto"}return i.pos+=o.length-r.length,!0}function Op(i,e){let t=i.pos;if(i.src.charCodeAt(t)!==10)return!1;const n=i.pending.length-1,a=i.posMax;if(!e)if(n>=0&&i.pending.charCodeAt(n)===32)if(n>=1&&i.pending.charCodeAt(n-1)===32){let r=n-1;for(;r>=1&&i.pending.charCodeAt(r-1)===32;)r--;i.pending=i.pending.slice(0,r),i.push("hardbreak","br",0)}else i.pending=i.pending.slice(0,-1),i.push("softbreak","br",0);else i.push("softbreak","br",0);for(t++;t<a&&Ze(i.src.charCodeAt(t));)t++;return i.pos=t,!0}const po=[];for(let i=0;i<256;i++)po.push(0);"\\!\"#$%&'()*+,./:;<=>?@[]^_`{|}~-".split("").forEach(function(i){po[i.charCodeAt(0)]=1});function Np(i,e){let t=i.pos;const n=i.posMax;if(i.src.charCodeAt(t)!==92||(t++,t>=n))return!1;let a=i.src.charCodeAt(t);if(a===10){for(e||i.push("hardbreak","br",0),t++;t<n&&(a=i.src.charCodeAt(t),!!Ze(a));)t++;return i.pos=t,!0}let r=i.src[t];if(a>=55296&&a<=56319&&t+1<n){const o=i.src.charCodeAt(t+1);o>=56320&&o<=57343&&(r+=i.src[t+1],t++)}const s="\\"+r;if(!e){const o=i.push("text_special","",0);a<256&&po[a]!==0?o.content=r:o.content=s,o.markup=s,o.info="escape"}return i.pos=t+1,!0}function Hp(i,e){let t=i.pos;if(i.src.charCodeAt(t)!==96)return!1;const a=t;t++;const r=i.posMax;for(;t<r&&i.src.charCodeAt(t)===96;)t++;const s=i.src.slice(a,t),o=s.length;if(i.backticksScanned&&(i.backticks[o]||0)<=a)return e||(i.pending+=s),i.pos+=o,!0;let l=t,u;for(;(u=i.src.indexOf("`",l))!==-1;){for(l=u+1;l<r&&i.src.charCodeAt(l)===96;)l++;const f=l-u;if(f===o){if(!e){const c=i.push("code_inline","code",0);c.markup=s,c.content=i.src.slice(t,u).replace(/\n/g," ").replace(/^ (.+) $/,"$1")}return i.pos=l,!0}i.backticks[f]=u}return i.backticksScanned=!0,e||(i.pending+=s),i.pos+=o,!0}function zp(i,e){const t=i.pos,n=i.src.charCodeAt(t);if(e||n!==126)return!1;const a=i.scanDelims(i.pos,!0);let r=a.length;const s=String.fromCharCode(n);if(r<2)return!1;let o;r%2&&(o=i.push("text","",0),o.content=s,r--);for(let l=0;l<r;l+=2)o=i.push("text","",0),o.content=s+s,i.delimiters.push({marker:n,length:0,token:i.tokens.length-1,end:-1,open:a.can_open,close:a.can_close});return i.pos+=a.length,!0}function Ul(i,e){let t;const n=[],a=e.length;for(let r=0;r<a;r++){const s=e[r];if(s.marker!==126||s.end===-1)continue;const o=e[s.end];t=i.tokens[s.token],t.type="s_open",t.tag="s",t.nesting=1,t.markup="~~",t.content="",t=i.tokens[o.token],t.type="s_close",t.tag="s",t.nesting=-1,t.markup="~~",t.content="",i.tokens[o.token-1].type==="text"&&i.tokens[o.token-1].content==="~"&&n.push(o.token-1)}for(;n.length;){const r=n.pop();let s=r+1;for(;s<i.tokens.length&&i.tokens[s].type==="s_close";)s++;s--,r!==s&&(t=i.tokens[s],i.tokens[s]=i.tokens[r],i.tokens[r]=t)}}function Vp(i){const e=i.tokens_meta,t=i.tokens_meta.length;Ul(i,i.delimiters);for(let n=0;n<t;n++)e[n]&&e[n].delimiters&&Ul(i,e[n].delimiters)}const pu={tokenize:zp,postProcess:Vp};function Up(i,e){const t=i.pos,n=i.src.charCodeAt(t);if(e||n!==95&&n!==42)return!1;const a=i.scanDelims(i.pos,n===42);for(let r=0;r<a.length;r++){const s=i.push("text","",0);s.content=String.fromCharCode(n),i.delimiters.push({marker:n,length:a.length,token:i.tokens.length-1,end:-1,open:a.can_open,close:a.can_close})}return i.pos+=a.length,!0}function Wl(i,e){const t=e.length;for(let n=t-1;n>=0;n--){const a=e[n];if(a.marker!==95&&a.marker!==42||a.end===-1)continue;const r=e[a.end],s=n>0&&e[n-1].end===a.end+1&&e[n-1].marker===a.marker&&e[n-1].token===a.token-1&&e[a.end+1].token===r.token+1,o=String.fromCharCode(a.marker),l=i.tokens[a.token];l.type=s?"strong_open":"em_open",l.tag=s?"strong":"em",l.nesting=1,l.markup=s?o+o:o,l.content="";const u=i.tokens[r.token];u.type=s?"strong_close":"em_close",u.tag=s?"strong":"em",u.nesting=-1,u.markup=s?o+o:o,u.content="",s&&(i.tokens[e[n-1].token].content="",i.tokens[e[a.end+1].token].content="",n--)}}function Wp(i){const e=i.tokens_meta,t=i.tokens_meta.length;Wl(i,i.delimiters);for(let n=0;n<t;n++)e[n]&&e[n].delimiters&&Wl(i,e[n].delimiters)}const mu={tokenize:Up,postProcess:Wp};function Gp(i,e){let t,n,a,r,s="",o="",l=i.pos,u=!0;if(i.src.charCodeAt(i.pos)!==91)return!1;const f=i.pos,c=i.posMax,d=i.pos+1,h=i.md.helpers.parseLinkLabel(i,i.pos,!0);if(h<0)return!1;let p=h+1;if(p<c&&i.src.charCodeAt(p)===40){for(u=!1,p++;p<c&&(t=i.src.charCodeAt(p),!(!Ze(t)&&t!==10));p++);if(p>=c)return!1;if(l=p,a=i.md.helpers.parseLinkDestination(i.src,p,i.posMax),a.ok){for(s=i.md.normalizeLink(a.str),i.md.validateLink(s)?p=a.pos:s="",l=p;p<c&&(t=i.src.charCodeAt(p),!(!Ze(t)&&t!==10));p++);if(a=i.md.helpers.parseLinkTitle(i.src,p,i.posMax),p<c&&l!==p&&a.ok)for(o=a.str,p=a.pos;p<c&&(t=i.src.charCodeAt(p),!(!Ze(t)&&t!==10));p++);}(p>=c||i.src.charCodeAt(p)!==41)&&(u=!0),p++}if(u){if(typeof i.env.references>"u")return!1;if(p<c&&i.src.charCodeAt(p)===91?(l=p+1,p=i.md.helpers.parseLinkLabel(i,p),p>=0?n=i.src.slice(l,p++):p=h+1):p=h+1,n||(n=i.src.slice(d,h)),r=i.env.references[Ka(n)],!r)return i.pos=f,!1;s=r.href,o=r.title}if(!e){i.pos=d,i.posMax=h;const m=i.push("link_open","a",1),g=[["href",s]];m.attrs=g,o&&g.push(["title",o]),i.linkLevel++,i.md.inline.tokenize(i),i.linkLevel--,i.push("link_close","a",-1)}return i.pos=p,i.posMax=c,!0}function qp(i,e){let t,n,a,r,s,o,l,u,f="";const c=i.pos,d=i.posMax;if(i.src.charCodeAt(i.pos)!==33||i.src.charCodeAt(i.pos+1)!==91)return!1;const h=i.pos+2,p=i.md.helpers.parseLinkLabel(i,i.pos+1,!1);if(p<0)return!1;if(r=p+1,r<d&&i.src.charCodeAt(r)===40){for(r++;r<d&&(t=i.src.charCodeAt(r),!(!Ze(t)&&t!==10));r++);if(r>=d)return!1;for(u=r,o=i.md.helpers.parseLinkDestination(i.src,r,i.posMax),o.ok&&(f=i.md.normalizeLink(o.str),i.md.validateLink(f)?r=o.pos:f=""),u=r;r<d&&(t=i.src.charCodeAt(r),!(!Ze(t)&&t!==10));r++);if(o=i.md.helpers.parseLinkTitle(i.src,r,i.posMax),r<d&&u!==r&&o.ok)for(l=o.str,r=o.pos;r<d&&(t=i.src.charCodeAt(r),!(!Ze(t)&&t!==10));r++);else l="";if(r>=d||i.src.charCodeAt(r)!==41)return i.pos=c,!1;r++}else{if(typeof i.env.references>"u")return!1;if(r<d&&i.src.charCodeAt(r)===91?(u=r+1,r=i.md.helpers.parseLinkLabel(i,r),r>=0?a=i.src.slice(u,r++):r=p+1):r=p+1,a||(a=i.src.slice(h,p)),s=i.env.references[Ka(a)],!s)return i.pos=c,!1;f=s.href,l=s.title}if(!e){n=i.src.slice(h,p);const m=[];i.md.inline.parse(n,i.md,i.env,m);const g=i.push("image","img",0),b=[["src",f],["alt",""]];g.attrs=b,g.children=m,g.content=n,l&&b.push(["title",l])}return i.pos=r,i.posMax=d,!0}const jp=/^([a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)$/,$p=/^([a-zA-Z][a-zA-Z0-9+.-]{1,31}):([^<>\x00-\x20]*)$/;function Yp(i,e){let t=i.pos;if(i.src.charCodeAt(t)!==60)return!1;const n=i.pos,a=i.posMax;for(;;){if(++t>=a)return!1;const s=i.src.charCodeAt(t);if(s===60)return!1;if(s===62)break}const r=i.src.slice(n+1,t);if($p.test(r)){const s=i.md.normalizeLink(r);if(!i.md.validateLink(s))return!1;if(!e){const o=i.push("link_open","a",1);o.attrs=[["href",s]],o.markup="autolink",o.info="auto";const l=i.push("text","",0);l.content=i.md.normalizeLinkText(r);const u=i.push("link_close","a",-1);u.markup="autolink",u.info="auto"}return i.pos+=r.length+2,!0}if(jp.test(r)){const s=i.md.normalizeLink("mailto:"+r);if(!i.md.validateLink(s))return!1;if(!e){const o=i.push("link_open","a",1);o.attrs=[["href",s]],o.markup="autolink",o.info="auto";const l=i.push("text","",0);l.content=i.md.normalizeLinkText(r);const u=i.push("link_close","a",-1);u.markup="autolink",u.info="auto"}return i.pos+=r.length+2,!0}return!1}function Kp(i){return/^<a[>\s]/i.test(i)}function Xp(i){return/^<\/a\s*>/i.test(i)}function Zp(i){const e=i|32;return e>=97&&e<=122}function Qp(i,e){if(!i.md.options.html)return!1;const t=i.posMax,n=i.pos;if(i.src.charCodeAt(n)!==60||n+2>=t)return!1;const a=i.src.charCodeAt(n+1);if(a!==33&&a!==63&&a!==47&&!Zp(a))return!1;const r=i.src.slice(n).match(Sp);if(!r)return!1;if(!e){const s=i.push("html_inline","",0);s.content=r[0],Kp(s.content)&&i.linkLevel++,Xp(s.content)&&i.linkLevel--}return i.pos+=r[0].length,!0}const Jp=/^&#((?:x[a-f0-9]{1,6}|[0-9]{1,7}));/i,e0=/^&([a-z][a-z0-9]{1,31});/i;function t0(i,e){const t=i.pos,n=i.posMax;if(i.src.charCodeAt(t)!==38||t+1>=n)return!1;if(i.src.charCodeAt(t+1)===35){const r=i.src.slice(t).match(Jp);if(r){if(!e){const s=r[1][0].toLowerCase()==="x"?parseInt(r[1].slice(1),16):parseInt(r[1],10),o=i.push("text_special","",0);o.content=ho(s)?Ia(s):Ia(65533),o.markup=r[0],o.info="entity"}return i.pos+=r[0].length,!0}}else{const r=i.src.slice(t).match(e0);if(r){const s=ou(r[0]);if(s!==r[0]){if(!e){const o=i.push("text_special","",0);o.content=s,o.markup=r[0],o.info="entity"}return i.pos+=r[0].length,!0}}}return!1}function Gl(i){const e={},t=i.length;if(!t)return;let n=0,a=-2;const r=[];for(let s=0;s<t;s++){const o=i[s];if(r.push(0),(i[n].marker!==o.marker||a!==o.token-1)&&(n=s),a=o.token,o.length=o.length||0,!o.close)continue;e.hasOwnProperty(o.marker)||(e[o.marker]=[-1,-1,-1,-1,-1,-1]);const l=e[o.marker][(o.open?3:0)+o.length%3];let u=n-r[n]-1,f=u;for(;u>l;u-=r[u]+1){const c=i[u];if(c.marker===o.marker&&c.open&&c.end<0){let d=!1;if((c.close||o.open)&&(c.length+o.length)%3===0&&(c.length%3!==0||o.length%3!==0)&&(d=!0),!d){const h=u>0&&!i[u-1].open?r[u-1]+1:0;r[s]=s-u+h,r[u]=h,o.open=!1,c.end=s,c.close=!1,f=-1,a=-2;break}}}f!==-1&&(e[o.marker][(o.open?3:0)+(o.length||0)%3]=f)}}function i0(i){const e=i.tokens_meta,t=i.tokens_meta.length;Gl(i.delimiters);for(let n=0;n<t;n++)e[n]&&e[n].delimiters&&Gl(e[n].delimiters)}function n0(i){let e,t,n=0;const a=i.tokens,r=i.tokens.length;for(e=t=0;e<r;e++)a[e].nesting<0&&n--,a[e].level=n,a[e].nesting>0&&n++,a[e].type==="text"&&e+1<r&&a[e+1].type==="text"?a[e+1].content=a[e].content+a[e+1].content:(e!==t&&(a[t]=a[e]),t++);e!==t&&(a.length=t)}const is=[["text",Ip],["linkify",Pp],["newline",Op],["escape",Np],["backticks",Hp],["strikethrough",pu.tokenize],["emphasis",mu.tokenize],["link",Gp],["image",qp],["autolink",Yp],["html_inline",Qp],["entity",t0]],ns=[["balance_pairs",i0],["strikethrough",pu.postProcess],["emphasis",mu.postProcess],["fragments_join",n0]];function aa(){this.ruler=new Mt;for(let i=0;i<is.length;i++)this.ruler.push(is[i][0],is[i][1]);this.ruler2=new Mt;for(let i=0;i<ns.length;i++)this.ruler2.push(ns[i][0],ns[i][1])}aa.prototype.skipToken=function(i){const e=i.pos,t=this.ruler.getRules(""),n=t.length,a=i.md.options.maxNesting,r=i.cache;if(typeof r[e]<"u"){i.pos=r[e];return}let s=!1;if(i.level<a){for(let o=0;o<n;o++)if(i.level++,s=t[o](i,!0),i.level--,s){if(e>=i.pos)throw new Error("inline rule didn't increment state.pos");break}}else i.pos=i.posMax;s||i.pos++,r[e]=i.pos};aa.prototype.tokenize=function(i){const e=this.ruler.getRules(""),t=e.length,n=i.posMax,a=i.md.options.maxNesting;for(;i.pos<n;){const r=i.pos;let s=!1;if(i.level<a){for(let o=0;o<t;o++)if(s=e[o](i,!1),s){if(r>=i.pos)throw new Error("inline rule didn't increment state.pos");break}}if(s){if(i.pos>=n)break;continue}i.pending+=i.src[i.pos++]}i.pending&&i.pushPending()};aa.prototype.parse=function(i,e,t,n){const a=new this.State(i,e,t,n);this.tokenize(a);const r=this.ruler2.getRules(""),s=r.length;for(let o=0;o<s;o++)r[o](a)};aa.prototype.State=na;function a0(i){const e={};i=i||{},e.src_Any=iu.source,e.src_Cc=nu.source,e.src_Z=ru.source,e.src_P=co.source,e.src_ZPCc=[e.src_Z,e.src_P,e.src_Cc].join("|"),e.src_ZCc=[e.src_Z,e.src_Cc].join("|");const t="[><｜]";return e.src_pseudo_letter="(?:(?!"+t+"|"+e.src_ZPCc+")"+e.src_Any+")",e.src_ip4="(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)",e.src_auth="(?:(?:(?!"+e.src_ZCc+"|[@/\\[\\]()]).)+@)?",e.src_port="(?::(?:6(?:[0-4]\\d{3}|5(?:[0-4]\\d{2}|5(?:[0-2]\\d|3[0-5])))|[1-5]?\\d{1,4}))?",e.src_host_terminator="(?=$|"+t+"|"+e.src_ZPCc+")(?!"+(i["---"]?"-(?!--)|":"-|")+"_|:\\d|\\.-|\\.(?!$|"+e.src_ZPCc+"))",e.src_path="(?:[/?#](?:(?!"+e.src_ZCc+"|"+t+`|[()[\\]{}.,"'?!\\-;]).|\\[(?:(?!`+e.src_ZCc+"|\\]).)*\\]|\\((?:(?!"+e.src_ZCc+"|[)]).)*\\)|\\{(?:(?!"+e.src_ZCc+'|[}]).)*\\}|\\"(?:(?!'+e.src_ZCc+`|["]).)+\\"|\\'(?:(?!`+e.src_ZCc+"|[']).)+\\'|\\'(?="+e.src_pseudo_letter+"|[-])|\\.{2,}[a-zA-Z0-9%/&]|\\.(?!"+e.src_ZCc+"|[.]|$)|"+(i["---"]?"\\-(?!--(?:[^-]|$))(?:-*)|":"\\-+|")+",(?!"+e.src_ZCc+"|$)|;(?!"+e.src_ZCc+"|$)|\\!+(?!"+e.src_ZCc+"|[!]|$)|\\?(?!"+e.src_ZCc+"|[?]|$))+|\\/)?",e.src_email_name='[\\-;:&=\\+\\$,\\.a-zA-Z0-9_][\\-;:&=\\+\\$,\\"\\.a-zA-Z0-9_]*',e.src_xn="xn--[a-z0-9\\-]{1,59}",e.src_domain_root="(?:"+e.src_xn+"|"+e.src_pseudo_letter+"{1,63})",e.src_domain="(?:"+e.src_xn+"|(?:"+e.src_pseudo_letter+")|(?:"+e.src_pseudo_letter+"(?:-|"+e.src_pseudo_letter+"){0,61}"+e.src_pseudo_letter+"))",e.src_host="(?:(?:(?:(?:"+e.src_domain+")\\.)*"+e.src_domain+"))",e.tpl_host_fuzzy="(?:"+e.src_ip4+"|(?:(?:(?:"+e.src_domain+")\\.)+(?:%TLDS%)))",e.tpl_host_no_ip_fuzzy="(?:(?:(?:"+e.src_domain+")\\.)+(?:%TLDS%))",e.src_host_strict=e.src_host+e.src_host_terminator,e.tpl_host_fuzzy_strict=e.tpl_host_fuzzy+e.src_host_terminator,e.src_host_port_strict=e.src_host+e.src_port+e.src_host_terminator,e.tpl_host_port_fuzzy_strict=e.tpl_host_fuzzy+e.src_port+e.src_host_terminator,e.tpl_host_port_no_ip_fuzzy_strict=e.tpl_host_no_ip_fuzzy+e.src_port+e.src_host_terminator,e.tpl_host_fuzzy_test="localhost|www\\.|\\.\\d{1,3}\\.|(?:\\.(?:%TLDS%)(?:"+e.src_ZPCc+"|>|$))",e.tpl_email_fuzzy="(^|"+t+'|"|\\(|'+e.src_ZCc+")("+e.src_email_name+"@"+e.tpl_host_fuzzy_strict+")",e.tpl_link_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|｜]|"+e.src_ZPCc+"))((?![$+<=>^`|｜])"+e.tpl_host_port_fuzzy_strict+e.src_path+")",e.tpl_link_no_ip_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|｜]|"+e.src_ZPCc+"))((?![$+<=>^`|｜])"+e.tpl_host_port_no_ip_fuzzy_strict+e.src_path+")",e}function Is(i){return Array.prototype.slice.call(arguments,1).forEach(function(t){t&&Object.keys(t).forEach(function(n){i[n]=t[n]})}),i}function Za(i){return Object.prototype.toString.call(i)}function r0(i){return Za(i)==="[object String]"}function s0(i){return Za(i)==="[object Object]"}function o0(i){return Za(i)==="[object RegExp]"}function ql(i){return Za(i)==="[object Function]"}function l0(i){return i.replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}const gu={fuzzyLink:!0,fuzzyEmail:!0,fuzzyIP:!1};function c0(i){return Object.keys(i||{}).reduce(function(e,t){return e||gu.hasOwnProperty(t)},!1)}const u0={"http:":{validate:function(i,e,t){const n=i.slice(e);return t.re.http||(t.re.http=new RegExp("^\\/\\/"+t.re.src_auth+t.re.src_host_port_strict+t.re.src_path,"i")),t.re.http.test(n)?n.match(t.re.http)[0].length:0}},"https:":"http:","ftp:":"http:","//":{validate:function(i,e,t){const n=i.slice(e);return t.re.no_http||(t.re.no_http=new RegExp("^"+t.re.src_auth+"(?:localhost|(?:(?:"+t.re.src_domain+")\\.)+"+t.re.src_domain_root+")"+t.re.src_port+t.re.src_host_terminator+t.re.src_path,"i")),t.re.no_http.test(n)?e>=3&&i[e-3]===":"||e>=3&&i[e-3]==="/"?0:n.match(t.re.no_http)[0].length:0}},"mailto:":{validate:function(i,e,t){const n=i.slice(e);return t.re.mailto||(t.re.mailto=new RegExp("^"+t.re.src_email_name+"@"+t.re.src_host_strict,"i")),t.re.mailto.test(n)?n.match(t.re.mailto)[0].length:0}}},d0="a[cdefgilmnoqrstuwxz]|b[abdefghijmnorstvwyz]|c[acdfghiklmnoruvwxyz]|d[ejkmoz]|e[cegrstu]|f[ijkmor]|g[abdefghilmnpqrstuwy]|h[kmnrtu]|i[delmnoqrst]|j[emop]|k[eghimnprwyz]|l[abcikrstuvy]|m[acdeghklmnopqrstuvwxyz]|n[acefgilopruz]|om|p[aefghklmnrstwy]|qa|r[eosuw]|s[abcdeghijklmnortuvxyz]|t[cdfghjklmnortvwz]|u[agksyz]|v[aceginu]|w[fs]|y[et]|z[amw]",h0="biz|com|edu|gov|net|org|pro|web|xxx|aero|asia|coop|info|museum|name|shop|рф".split("|");function f0(i){i.__index__=-1,i.__text_cache__=""}function p0(i){return function(e,t){const n=e.slice(t);return i.test(n)?n.match(i)[0].length:0}}function jl(){return function(i,e){e.normalize(i)}}function Ra(i){const e=i.re=a0(i.__opts__),t=i.__tlds__.slice();i.onCompile(),i.__tlds_replaced__||t.push(d0),t.push(e.src_xn),e.src_tlds=t.join("|");function n(o){return o.replace("%TLDS%",e.src_tlds)}e.email_fuzzy=RegExp(n(e.tpl_email_fuzzy),"i"),e.link_fuzzy=RegExp(n(e.tpl_link_fuzzy),"i"),e.link_no_ip_fuzzy=RegExp(n(e.tpl_link_no_ip_fuzzy),"i"),e.host_fuzzy_test=RegExp(n(e.tpl_host_fuzzy_test),"i");const a=[];i.__compiled__={};function r(o,l){throw new Error('(LinkifyIt) Invalid schema "'+o+'": '+l)}Object.keys(i.__schemas__).forEach(function(o){const l=i.__schemas__[o];if(l===null)return;const u={validate:null,link:null};if(i.__compiled__[o]=u,s0(l)){o0(l.validate)?u.validate=p0(l.validate):ql(l.validate)?u.validate=l.validate:r(o,l),ql(l.normalize)?u.normalize=l.normalize:l.normalize?r(o,l):u.normalize=jl();return}if(r0(l)){a.push(o);return}r(o,l)}),a.forEach(function(o){i.__compiled__[i.__schemas__[o]]&&(i.__compiled__[o].validate=i.__compiled__[i.__schemas__[o]].validate,i.__compiled__[o].normalize=i.__compiled__[i.__schemas__[o]].normalize)}),i.__compiled__[""]={validate:null,normalize:jl()};const s=Object.keys(i.__compiled__).filter(function(o){return o.length>0&&i.__compiled__[o]}).map(l0).join("|");i.re.schema_test=RegExp("(^|(?!_)(?:[><｜]|"+e.src_ZPCc+"))("+s+")","i"),i.re.schema_search=RegExp("(^|(?!_)(?:[><｜]|"+e.src_ZPCc+"))("+s+")","ig"),i.re.schema_at_start=RegExp("^"+i.re.schema_search.source,"i"),i.re.pretest=RegExp("("+i.re.schema_test.source+")|("+i.re.host_fuzzy_test.source+")|@","i"),f0(i)}function m0(i,e){const t=i.__index__,n=i.__last_index__,a=i.__text_cache__.slice(t,n);this.schema=i.__schema__.toLowerCase(),this.index=t+e,this.lastIndex=n+e,this.raw=a,this.text=a,this.url=a}function Rs(i,e){const t=new m0(i,e);return i.__compiled__[t.schema].normalize(t,i),t}function Ft(i,e){if(!(this instanceof Ft))return new Ft(i,e);e||c0(i)&&(e=i,i={}),this.__opts__=Is({},gu,e),this.__index__=-1,this.__last_index__=-1,this.__schema__="",this.__text_cache__="",this.__schemas__=Is({},u0,i),this.__compiled__={},this.__tlds__=h0,this.__tlds_replaced__=!1,this.re={},Ra(this)}Ft.prototype.add=function(e,t){return this.__schemas__[e]=t,Ra(this),this};Ft.prototype.set=function(e){return this.__opts__=Is(this.__opts__,e),this};Ft.prototype.test=function(e){if(this.__text_cache__=e,this.__index__=-1,!e.length)return!1;let t,n,a,r,s,o,l,u,f;if(this.re.schema_test.test(e)){for(l=this.re.schema_search,l.lastIndex=0;(t=l.exec(e))!==null;)if(r=this.testSchemaAt(e,t[2],l.lastIndex),r){this.__schema__=t[2],this.__index__=t.index+t[1].length,this.__last_index__=t.index+t[0].length+r;break}}return this.__opts__.fuzzyLink&&this.__compiled__["http:"]&&(u=e.search(this.re.host_fuzzy_test),u>=0&&(this.__index__<0||u<this.__index__)&&(n=e.match(this.__opts__.fuzzyIP?this.re.link_fuzzy:this.re.link_no_ip_fuzzy))!==null&&(s=n.index+n[1].length,(this.__index__<0||s<this.__index__)&&(this.__schema__="",this.__index__=s,this.__last_index__=n.index+n[0].length))),this.__opts__.fuzzyEmail&&this.__compiled__["mailto:"]&&(f=e.indexOf("@"),f>=0&&(a=e.match(this.re.email_fuzzy))!==null&&(s=a.index+a[1].length,o=a.index+a[0].length,(this.__index__<0||s<this.__index__||s===this.__index__&&o>this.__last_index__)&&(this.__schema__="mailto:",this.__index__=s,this.__last_index__=o))),this.__index__>=0};Ft.prototype.pretest=function(e){return this.re.pretest.test(e)};Ft.prototype.testSchemaAt=function(e,t,n){return this.__compiled__[t.toLowerCase()]?this.__compiled__[t.toLowerCase()].validate(e,n,this):0};Ft.prototype.match=function(e){const t=[];let n=0;this.__index__>=0&&this.__text_cache__===e&&(t.push(Rs(this,n)),n=this.__last_index__);let a=n?e.slice(n):e;for(;this.test(a);)t.push(Rs(this,n)),a=a.slice(this.__last_index__),n+=this.__last_index__;return t.length?t:null};Ft.prototype.matchAtStart=function(e){if(this.__text_cache__=e,this.__index__=-1,!e.length)return null;const t=this.re.schema_at_start.exec(e);if(!t)return null;const n=this.testSchemaAt(e,t[2],t[0].length);return n?(this.__schema__=t[2],this.__index__=t.index+t[1].length,this.__last_index__=t.index+t[0].length+n,Rs(this,0)):null};Ft.prototype.tlds=function(e,t){return e=Array.isArray(e)?e:[e],t?(this.__tlds__=this.__tlds__.concat(e).sort().filter(function(n,a,r){return n!==r[a-1]}).reverse(),Ra(this),this):(this.__tlds__=e.slice(),this.__tlds_replaced__=!0,Ra(this),this)};Ft.prototype.normalize=function(e){e.schema||(e.url="http://"+e.url),e.schema==="mailto:"&&!/^mailto:/i.test(e.url)&&(e.url="mailto:"+e.url)};Ft.prototype.onCompile=function(){};const hn=2147483647,oi=36,mo=1,Kn=26,g0=38,b0=700,bu=72,yu=128,wu="-",y0=/^xn--/,w0=/[^\0-\x7F]/,v0=/[\x2E\u3002\uFF0E\uFF61]/g,x0={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},as=oi-mo,li=Math.floor,rs=String.fromCharCode;function Ti(i){throw new RangeError(x0[i])}function _0(i,e){const t=[];let n=i.length;for(;n--;)t[n]=e(i[n]);return t}function vu(i,e){const t=i.split("@");let n="";t.length>1&&(n=t[0]+"@",i=t[1]),i=i.replace(v0,".");const a=i.split("."),r=_0(a,e).join(".");return n+r}function xu(i){const e=[];let t=0;const n=i.length;for(;t<n;){const a=i.charCodeAt(t++);if(a>=55296&&a<=56319&&t<n){const r=i.charCodeAt(t++);(r&64512)==56320?e.push(((a&1023)<<10)+(r&1023)+65536):(e.push(a),t--)}else e.push(a)}return e}const E0=i=>String.fromCodePoint(...i),C0=function(i){return i>=48&&i<58?26+(i-48):i>=65&&i<91?i-65:i>=97&&i<123?i-97:oi},$l=function(i,e){return i+22+75*(i<26)-((e!=0)<<5)},_u=function(i,e,t){let n=0;for(i=t?li(i/b0):i>>1,i+=li(i/e);i>as*Kn>>1;n+=oi)i=li(i/as);return li(n+(as+1)*i/(i+g0))},Eu=function(i){const e=[],t=i.length;let n=0,a=yu,r=bu,s=i.lastIndexOf(wu);s<0&&(s=0);for(let o=0;o<s;++o)i.charCodeAt(o)>=128&&Ti("not-basic"),e.push(i.charCodeAt(o));for(let o=s>0?s+1:0;o<t;){const l=n;for(let f=1,c=oi;;c+=oi){o>=t&&Ti("invalid-input");const d=C0(i.charCodeAt(o++));d>=oi&&Ti("invalid-input"),d>li((hn-n)/f)&&Ti("overflow"),n+=d*f;const h=c<=r?mo:c>=r+Kn?Kn:c-r;if(d<h)break;const p=oi-h;f>li(hn/p)&&Ti("overflow"),f*=p}const u=e.length+1;r=_u(n-l,u,l==0),li(n/u)>hn-a&&Ti("overflow"),a+=li(n/u),n%=u,e.splice(n++,0,a)}return String.fromCodePoint(...e)},Cu=function(i){const e=[];i=xu(i);const t=i.length;let n=yu,a=0,r=bu;for(const l of i)l<128&&e.push(rs(l));const s=e.length;let o=s;for(s&&e.push(wu);o<t;){let l=hn;for(const f of i)f>=n&&f<l&&(l=f);const u=o+1;l-n>li((hn-a)/u)&&Ti("overflow"),a+=(l-n)*u,n=l;for(const f of i)if(f<n&&++a>hn&&Ti("overflow"),f===n){let c=a;for(let d=oi;;d+=oi){const h=d<=r?mo:d>=r+Kn?Kn:d-r;if(c<h)break;const p=c-h,m=oi-h;e.push(rs($l(h+p%m,0))),c=li(p/m)}e.push(rs($l(c,0))),r=_u(a,u,o===s),a=0,++o}++a,++n}return e.join("")},A0=function(i){return vu(i,function(e){return y0.test(e)?Eu(e.slice(4).toLowerCase()):e})},k0=function(i){return vu(i,function(e){return w0.test(e)?"xn--"+Cu(e):e})},Au={version:"2.3.1",ucs2:{decode:xu,encode:E0},decode:Eu,encode:Cu,toASCII:k0,toUnicode:A0},S0={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"“”‘’",highlight:null,maxNesting:100},components:{core:{},block:{},inline:{}}},T0={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"“”‘’",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline","text_join"]},block:{rules:["paragraph"]},inline:{rules:["text"],rules2:["balance_pairs","fragments_join"]}}},M0={options:{html:!0,xhtmlOut:!0,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"“”‘’",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline","text_join"]},block:{rules:["blockquote","code","fence","heading","hr","html_block","lheading","list","reference","paragraph"]},inline:{rules:["autolink","backticks","emphasis","entity","escape","html_inline","image","link","newline","text"],rules2:["balance_pairs","emphasis","fragments_join"]}}},L0={default:S0,zero:T0,commonmark:M0},D0=/^(vbscript|javascript|file|data):/,B0=/^data:image\/(gif|png|jpeg|webp);/;function F0(i){const e=i.trim().toLowerCase();return D0.test(e)?B0.test(e):!0}const ku=["http:","https:","mailto:"];function I0(i){const e=lo(i,!0);if(e.hostname&&(!e.protocol||ku.indexOf(e.protocol)>=0))try{e.hostname=Au.toASCII(e.hostname)}catch{}return ia(oo(e))}function R0(i){const e=lo(i,!0);if(e.hostname&&(!e.protocol||ku.indexOf(e.protocol)>=0))try{e.hostname=Au.toUnicode(e.hostname)}catch{}return fn(oo(e),fn.defaultChars+"%")}function Wt(i,e){if(!(this instanceof Wt))return new Wt(i,e);e||uo(i)||(e=i||{},i="default"),this.inline=new aa,this.block=new Xa,this.core=new fo,this.renderer=new bn,this.linkify=new Ft,this.validateLink=F0,this.normalizeLink=I0,this.normalizeLinkText=R0,this.utils=Of,this.helpers=Ya({},Vf),this.options={},this.configure(i),e&&this.set(e)}Wt.prototype.set=function(i){return Ya(this.options,i),this};Wt.prototype.configure=function(i){const e=this;if(uo(i)){const t=i;if(i=L0[t],!i)throw new Error('Wrong `markdown-it` preset "'+t+'", check name')}if(!i)throw new Error("Wrong `markdown-it` preset, can't be empty");return i.options&&e.set(i.options),i.components&&Object.keys(i.components).forEach(function(t){i.components[t].rules&&e[t].ruler.enableOnly(i.components[t].rules),i.components[t].rules2&&e[t].ruler2.enableOnly(i.components[t].rules2)}),this};Wt.prototype.enable=function(i,e){let t=[];Array.isArray(i)||(i=[i]),["core","block","inline"].forEach(function(a){t=t.concat(this[a].ruler.enable(i,!0))},this),t=t.concat(this.inline.ruler2.enable(i,!0));const n=i.filter(function(a){return t.indexOf(a)<0});if(n.length&&!e)throw new Error("MarkdownIt. Failed to enable unknown rule(s): "+n);return this};Wt.prototype.disable=function(i,e){let t=[];Array.isArray(i)||(i=[i]),["core","block","inline"].forEach(function(a){t=t.concat(this[a].ruler.disable(i,!0))},this),t=t.concat(this.inline.ruler2.disable(i,!0));const n=i.filter(function(a){return t.indexOf(a)<0});if(n.length&&!e)throw new Error("MarkdownIt. Failed to disable unknown rule(s): "+n);return this};Wt.prototype.use=function(i){const e=[this].concat(Array.prototype.slice.call(arguments,1));return i.apply(i,e),this};Wt.prototype.parse=function(i,e){if(typeof i!="string")throw new Error("Input data should be a String");const t=new this.core.State(i,this,e);return this.core.process(t),t.tokens};Wt.prototype.render=function(i,e){return e=e||{},this.renderer.render(this.parse(i,e),this.options,e)};Wt.prototype.parseInline=function(i,e){const t=new this.core.State(i,this,e);return t.inlineMode=!0,this.core.process(t),t.tokens};Wt.prototype.renderInline=function(i,e){return e=e||{},this.renderer.render(this.parseInline(i,e),this.options,e)};class Su extends ot{app;constructor(e){super({title:"Changelog",width:600,height:500,win_id:"changelog"}),this.app=e,this.initView()}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("div");t.classList.add("markdown-container"),fetch("/smeditor/assets/app/changelog.json").then(r=>r.json()).then(r=>{t.innerHTML=r.map(s=>`# ${s.version}
---
`+s.changelog).map(s=>`<div>${Wt().render(s)}</div>`).join("")}),e.appendChild(t);const n=document.createElement("div");n.classList.add("menu-options"),n.style.justifyContent="flex-end";const a=document.createElement("button");a.innerText="Close",a.onclick=()=>{this.closeWindow()},a.classList.add("confirm"),n.append(a),e.appendChild(n),this.viewElement.appendChild(e)}}const Yl=globalThis.showDirectoryPicker;async function P0(i={}){if(Yl&&!i._preferPolyfill)return Yl(i);const e=document.createElement("input");e.type="file",e.webkitdirectory=!0,e.multiple=!0,e.style.position="fixed",e.style.top="-100000px",e.style.left="-100000px",document.body.appendChild(e);const{makeDirHandleFromFileList:t}=await Ge(async()=>{const{makeDirHandleFromFileList:n}=await Promise.resolve().then(()=>Pc);return{makeDirHandleFromFileList:n}},void 0);return new Promise((n,a)=>{e.addEventListener("change",()=>{t(e.files).then(n).catch(a),document.body.removeChild(e)}),e.click()})}const Kl=globalThis.showOpenFilePicker;async function Tu(i={}){if(Kl&&!i._preferPolyfill)return Kl(i);const e=document.createElement("input");e.type="file",e.multiple=!!i.multiple,e.accept=(i.accepts||[]).map(n=>[...(n.extensions||[]).map(a=>"."+a),...n.mimeTypes||[]]).flat().join(","),e.style.position="fixed",e.style.top="-100000px",e.style.left="-100000px",document.body.appendChild(e);const{makeFileHandlesFromFileList:t}=await Ge(async()=>{const{makeFileHandlesFromFileList:n}=await Promise.resolve().then(()=>Pc);return{makeFileHandlesFromFileList:n}},void 0);return new Promise((n,a)=>{e.addEventListener("change",()=>{t(e.files).then(n).catch(a),document.body.removeChild(e)}),e.click()})}const Xl=globalThis.showSaveFilePicker;async function O0(i={}){if(Xl&&!i._preferPolyfill)return Xl(i);const{FileSystemFileHandle:e}=await Ge(async()=>{const{FileSystemFileHandle:n}=await Promise.resolve().then(()=>Mu);return{FileSystemFileHandle:n}},void 0),{FileHandle:t}=await Ge(async()=>{const{FileHandle:n}=await import("./downloader-C0o52Hx3.js");return{FileHandle:n}},__vite__mapDeps([3,1,2]));return new e(new t(i.suggestedName))}const en=Symbol("adapter");let go=class{constructor(e){this.kind=e.kind,this.name=e.name,this[en]=e}get isFile(){return this.kind==="file"}get isDirectory(){return this.kind==="directory"}async queryPermission(e={mode:"read"}){const t=this[en];if(t.queryPermission)return t.queryPermission(e);if(e.mode==="read")return"granted";if(e.mode==="readwrite")return t.writable?"granted":"denied";throw new TypeError(`Mode ${e.mode} must be 'read' or 'readwrite'`)}async requestPermission(e={mode:"read"}){const t=this[en];if(t.requestPermission)return t.requestPermission(e);if(e.mode==="read")return"granted";if(e.mode==="readwrite")return t.writable?"granted":"denied";throw new TypeError(`Mode ${e.mode} must be 'read' or 'readwrite'`)}async isSameEntry(e){return this===e?!0:this.kind!==e.kind||!e[en]?!1:await this[en].isSameEntry(e[en])}};Object.defineProperty(go.prototype,Symbol.toStringTag,{value:"FileSystemHandle",writable:!1,enumerable:!1,configurable:!0});const ss=Symbol("adapter");let Xn=class extends go{constructor(e){super(e),this.kind="file",this[ss]=e}async createWritable(e={}){const{FileSystemWritableFileStream:t}=await Ge(async()=>{const{FileSystemWritableFileStream:n}=await import("./FileSystemWritableFileStream-D05uA35V.js");return{FileSystemWritableFileStream:n}},__vite__mapDeps([4,5]));return new t(await this[ss].createWritable(e))}async getFile(){return this[ss].getFile()}};Object.defineProperty(Xn.prototype,Symbol.toStringTag,{value:"FileSystemFileHandle",writable:!1,enumerable:!1,configurable:!0});Object.defineProperties(Xn.prototype,{createWritable:{enumerable:!0},getFile:{enumerable:!0}});const Mu=Object.freeze(Object.defineProperty({__proto__:null,FileSystemFileHandle:Xn},Symbol.toStringTag,{value:"Module"})),tn=Symbol("adapter");class Ki extends go{constructor(e){super(e),this.kind="directory",this[tn]=e}async getDirectoryHandle(e,t={}){if(e==="")throw new TypeError("Name can't be an empty string.");if(e==="."||e===".."||e.includes("/"))throw new TypeError("Name contains invalid characters.");return new Ki(await this[tn].getDirectoryHandle(e,t))}getDirectory(e,t={}){return this.getDirectoryHandle(e,t)}async*entries(){for await(const[e,t]of this[tn].entries())yield[t.name,t.kind==="file"?new Xn(t):new Ki(t)]}async*getEntries(){return this.entries()}async*keys(){for await(const[e]of this[tn].entries())yield e}async*values(){for await(const[e,t]of this.entries())yield t}async getFileHandle(e,t={}){if(e==="")throw new TypeError("Name can't be an empty string.");if(e==="."||e===".."||e.includes("/"))throw new TypeError("Name contains invalid characters.");return t.create=!!t.create,new Xn(await this[tn].getFileHandle(e,t))}getFile(e,t={}){return this.getFileHandle(e,t)}async removeEntry(e,t={}){if(e==="")throw new TypeError("Name can't be an empty string.");if(e==="."||e===".."||e.includes("/"))throw new TypeError("Name contains invalid characters.");return t.recursive=!!t.recursive,this[tn].removeEntry(e,t)}async resolve(e){if(await e.isSameEntry(this))return[];const t=[{handle:this,path:[]}];for(;t.length;){let{handle:n,path:a}=t.pop();for await(const r of n.values()){if(await r.isSameEntry(e))return[...a,r.name];r.kind==="directory"&&t.push({handle:r,path:[...a,r.name]})}}return null}[Symbol.asyncIterator](){return this.entries()}}Object.defineProperty(Ki.prototype,Symbol.toStringTag,{value:"FileSystemDirectoryHandle",writable:!1,enumerable:!1,configurable:!0});Object.defineProperties(Ki.prototype,{getDirectoryHandle:{enumerable:!0},entries:{enumerable:!0},getFileHandle:{enumerable:!0},removeEntry:{enumerable:!0}});const N0=Object.freeze(Object.defineProperty({__proto__:null,FileSystemDirectoryHandle:Ki},Symbol.toStringTag,{value:"Module"}));async function Zl(i,e={}){var t,n,a,r;if(!i){if(!(!((t=globalThis.navigator)===null||t===void 0)&&t.storage)&&((n=globalThis.location)===null||n===void 0?void 0:n.protocol)==="http:")throw new Error("Native getDirectory not supported in HTTP context. Please use HTTPS instead or provide an adapter.");if(!(!((r=(a=globalThis.navigator)===null||a===void 0?void 0:a.storage)===null||r===void 0)&&r.getDirectory))throw new Error("Native StorageManager.getDirectory() is not supported in current environment. Please provide an adapter instead.");return globalThis.navigator.storage.getDirectory()}const s=await i,o=typeof s=="function"?await s(e):await s.default(e);return new Ki(o)}var os,ls;const H0={adapter:{native:typeof((ls=(os=globalThis.navigator)===null||os===void 0?void 0:os.storage)===null||ls===void 0?void 0:ls.getDirectory)=="function"}},Ql=i=>typeof i=="object"&&i!=null&&i.nodeType===1,Jl=(i,e)=>(!e||i!=="hidden")&&i!=="visible"&&i!=="clip",cs=(i,e)=>{if(i.clientHeight<i.scrollHeight||i.clientWidth<i.scrollWidth){const t=getComputedStyle(i,null);return Jl(t.overflowY,e)||Jl(t.overflowX,e)||(n=>{const a=(r=>{if(!r.ownerDocument||!r.ownerDocument.defaultView)return null;try{return r.ownerDocument.defaultView.frameElement}catch{return null}})(n);return!!a&&(a.clientHeight<n.scrollHeight||a.clientWidth<n.scrollWidth)})(i)}return!1},ha=(i,e,t,n,a,r,s,o)=>r<i&&s>e||r>i&&s<e?0:r<=i&&o<=t||s>=e&&o>=t?r-i-n:s>e&&o<t||r<i&&o>t?s-e+a:0,z0=i=>{const e=i.parentElement;return e??(i.getRootNode().host||null)},ec=(i,e)=>{var t,n,a,r;if(typeof document>"u")return[];const{scrollMode:s,block:o,inline:l,boundary:u,skipOverflowHiddenElements:f}=e,c=typeof u=="function"?u:$=>$!==u;if(!Ql(i))throw new TypeError("Invalid target");const d=document.scrollingElement||document.documentElement,h=[];let p=i;for(;Ql(p)&&c(p);){if(p=z0(p),p===d){h.push(p);break}p!=null&&p===document.body&&cs(p)&&!cs(document.documentElement)||p!=null&&cs(p,f)&&h.push(p)}const m=(n=(t=window.visualViewport)==null?void 0:t.width)!=null?n:innerWidth,g=(r=(a=window.visualViewport)==null?void 0:a.height)!=null?r:innerHeight,{scrollX:b,scrollY:x}=window,{height:w,width:E,top:C,right:B,bottom:D,left:O}=i.getBoundingClientRect(),{top:H,right:Y,bottom:ae,left:M}=($=>{const L=window.getComputedStyle($);return{top:parseFloat(L.scrollMarginTop)||0,right:parseFloat(L.scrollMarginRight)||0,bottom:parseFloat(L.scrollMarginBottom)||0,left:parseFloat(L.scrollMarginLeft)||0}})(i);let P=o==="start"||o==="nearest"?C-H:o==="end"?D+ae:C+w/2-H+ae,v=l==="center"?O+E/2-M+Y:l==="end"?B+Y:O-M;const S=[];for(let $=0;$<h.length;$++){const L=h[$],{height:W,width:V,top:J,right:N,bottom:R,left:ne}=L.getBoundingClientRect();if(s==="if-needed"&&C>=0&&O>=0&&D<=g&&B<=m&&C>=J&&D<=R&&O>=ne&&B<=N)return S;const ie=getComputedStyle(L),ee=parseInt(ie.borderLeftWidth,10),Te=parseInt(ie.borderTopWidth,10),Ne=parseInt(ie.borderRightWidth,10),ve=parseInt(ie.borderBottomWidth,10);let be=0,Le=0;const Be="offsetWidth"in L?L.offsetWidth-L.clientWidth-ee-Ne:0,at="offsetHeight"in L?L.offsetHeight-L.clientHeight-Te-ve:0,rt="offsetWidth"in L?L.offsetWidth===0?0:V/L.offsetWidth:0,_="offsetHeight"in L?L.offsetHeight===0?0:W/L.offsetHeight:0;if(d===L)be=o==="start"?P:o==="end"?P-g:o==="nearest"?ha(x,x+g,g,Te,ve,x+P,x+P+w,w):P-g/2,Le=l==="start"?v:l==="center"?v-m/2:l==="end"?v-m:ha(b,b+m,m,ee,Ne,b+v,b+v+E,E),be=Math.max(0,be+x),Le=Math.max(0,Le+b);else{be=o==="start"?P-J-Te:o==="end"?P-R+ve+at:o==="nearest"?ha(J,R,W,Te,ve+at,P,P+w,w):P-(J+W/2)+at/2,Le=l==="start"?v-ne-ee:l==="center"?v-(ne+V/2)+Be/2:l==="end"?v-N+Ne+Be:ha(ne,N,V,ee,Ne+Be,v,v+E,E);const{scrollLeft:X,scrollTop:G}=L;be=_===0?0:Math.max(0,Math.min(G+be/_,L.scrollHeight-W/_+at)),Le=rt===0?0:Math.max(0,Math.min(X+Le/rt,L.scrollWidth-V/rt+Be)),P+=G-be,v+=X-Le}S.push({el:L,top:be,left:Le})}return S},V0=i=>i===!1?{block:"end",inline:"nearest"}:(e=>e===Object(e)&&Object.keys(e).length!==0)(i)?i:{block:"start",inline:"nearest"};function On(i,e){if(!i.isConnected||!(a=>{let r=a;for(;r&&r.parentNode;){if(r.parentNode===document)return!0;r=r.parentNode instanceof ShadowRoot?r.parentNode.host:r.parentNode}return!1})(i))return;const t=(a=>{const r=window.getComputedStyle(a);return{top:parseFloat(r.scrollMarginTop)||0,right:parseFloat(r.scrollMarginRight)||0,bottom:parseFloat(r.scrollMarginBottom)||0,left:parseFloat(r.scrollMarginLeft)||0}})(i);if((a=>typeof a=="object"&&typeof a.behavior=="function")(e))return e.behavior(ec(i,e));const n=typeof e=="boolean"||e==null?void 0:e.behavior;for(const{el:a,top:r,left:s}of ec(i,V0(e))){const o=r-t.top+t.bottom,l=s-t.left+t.right;a.scroll({top:o,left:l,behavior:n})}}function kt(i,e){if(window.nw)return nw.require("path").basename(i,e);let t=bo(i)[2];return e&&t.slice(-1*e.length)===e&&(t=t.slice(0,t.length-e.length)),t}function st(i){if(window.nw)return nw.require("path").dirname(i);const e=bo(i),t=e[0];let n=e[1];return!t&&!n?"":(n&&(n=n.slice(0,n.length-1)),t+n)}function Tt(i){return window.nw?nw.require("path").extname(i):bo(i)[3]}const U0=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^/]+?|)(\.[^./]*|))(?:[/]*)$/;function bo(i){return U0.exec(i).slice(1)}const{GONE:Lu}=Mn;FileSystemFileHandle;class yo{_path;kind="file";name;isFile=!0;isDirectory=!1;constructor(e){this._path=e,this.name=new URL(e).pathname.split("/").pop()??""}async getFile(){return fetch(this._path).then(e=>e.blob()).then(e=>new File([e],this.name)).catch(()=>{throw new DOMException(...Lu)})}async createWritable(){throw Error("Cannot call createWriteable from a URLFileHandle")}async isSameEntry(e){return FileSystemHandle instanceof yo?e._path==this._path:!1}async queryPermission(){return"granted"}async requestPermission(){return"granted"}}class W0{async handleDropEvent(e,t){throw Error("Cannot call handleDropEvent from a URLFileHandler")}async getDirectoryHandle(e,t,n){throw Error("Cannot call getDirectoryHandle from a URLFileHandler")}async hasFile(e){return fetch(e).then(t=>t.ok).catch(()=>!1)}async getFileHandle(e,t){try{if(!await this.hasFile(e))throw new DOMException(...Lu);return new yo(e)}catch(n){console.error("Failed to get file "+e+": "+n);return}}async getFileHandleRelativeTo(e,t){const n=new URL(e);Tt(n.pathname)!=""&&(n.pathname=n.pathname.split("/").slice(0,-1).join("/")),n.pathname+="/"+t;try{return this.getFileHandle(n.toString())}catch(a){console.error("Failed to get relative file "+n+": "+a);return}}async getDirectoryFiles(e){throw Error("Cannot call getDirectoryFiles from a URLFileHandler")}async getDirectoryFolders(e){throw Error("Cannot call getDirectoryFolders from a URLFileHandler")}async writeFile(e,t){throw Error("Cannot save to a URL file!")}async removeFile(e){throw Error("Cannot remove a URL file!")}getRelativePath(e,t){throw Error("Cannot call getRelativePath from a URLFileHandler")}resolvePath(){throw Error("Cannot call resolvePath from a URLFileHandler")}}function fa(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var us={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var tc;function G0(){return tc||(tc=1,function(i,e){(function(t){i.exports=t()})(function(){return function t(n,a,r){function s(u,f){if(!a[u]){if(!n[u]){var c=typeof fa=="function"&&fa;if(!f&&c)return c(u,!0);if(o)return o(u,!0);var d=new Error("Cannot find module '"+u+"'");throw d.code="MODULE_NOT_FOUND",d}var h=a[u]={exports:{}};n[u][0].call(h.exports,function(p){var m=n[u][1][p];return s(m||p)},h,h.exports,t,n,a,r)}return a[u].exports}for(var o=typeof fa=="function"&&fa,l=0;l<r.length;l++)s(r[l]);return s}({1:[function(t,n,a){var r=t("./utils"),s=t("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.encode=function(l){for(var u,f,c,d,h,p,m,g=[],b=0,x=l.length,w=x,E=r.getTypeOf(l)!=="string";b<l.length;)w=x-b,c=E?(u=l[b++],f=b<x?l[b++]:0,b<x?l[b++]:0):(u=l.charCodeAt(b++),f=b<x?l.charCodeAt(b++):0,b<x?l.charCodeAt(b++):0),d=u>>2,h=(3&u)<<4|f>>4,p=1<w?(15&f)<<2|c>>6:64,m=2<w?63&c:64,g.push(o.charAt(d)+o.charAt(h)+o.charAt(p)+o.charAt(m));return g.join("")},a.decode=function(l){var u,f,c,d,h,p,m=0,g=0,b="data:";if(l.substr(0,b.length)===b)throw new Error("Invalid base64 input, it looks like a data url.");var x,w=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===o.charAt(64)&&w--,l.charAt(l.length-2)===o.charAt(64)&&w--,w%1!=0)throw new Error("Invalid base64 input, bad content length.");for(x=s.uint8array?new Uint8Array(0|w):new Array(0|w);m<l.length;)u=o.indexOf(l.charAt(m++))<<2|(d=o.indexOf(l.charAt(m++)))>>4,f=(15&d)<<4|(h=o.indexOf(l.charAt(m++)))>>2,c=(3&h)<<6|(p=o.indexOf(l.charAt(m++))),x[g++]=u,h!==64&&(x[g++]=f),p!==64&&(x[g++]=c);return x}},{"./support":30,"./utils":32}],2:[function(t,n,a){var r=t("./external"),s=t("./stream/DataWorker"),o=t("./stream/Crc32Probe"),l=t("./stream/DataLengthProbe");function u(f,c,d,h,p){this.compressedSize=f,this.uncompressedSize=c,this.crc32=d,this.compression=h,this.compressedContent=p}u.prototype={getContentWorker:function(){var f=new s(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),c=this;return f.on("end",function(){if(this.streamInfo.data_length!==c.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),f},getCompressedWorker:function(){return new s(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},u.createWorkerFrom=function(f,c,d){return f.pipe(new o).pipe(new l("uncompressedSize")).pipe(c.compressWorker(d)).pipe(new l("compressedSize")).withStreamInfo("compression",c)},n.exports=u},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,n,a){var r=t("./stream/GenericWorker");a.STORE={magic:"\0\0",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},a.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,n,a){var r=t("./utils"),s=function(){for(var o,l=[],u=0;u<256;u++){o=u;for(var f=0;f<8;f++)o=1&o?3988292384^o>>>1:o>>>1;l[u]=o}return l}();n.exports=function(o,l){return o!==void 0&&o.length?r.getTypeOf(o)!=="string"?function(u,f,c,d){var h=s,p=d+c;u^=-1;for(var m=d;m<p;m++)u=u>>>8^h[255&(u^f[m])];return-1^u}(0|l,o,o.length,0):function(u,f,c,d){var h=s,p=d+c;u^=-1;for(var m=d;m<p;m++)u=u>>>8^h[255&(u^f.charCodeAt(m))];return-1^u}(0|l,o,o.length,0):0}},{"./utils":32}],5:[function(t,n,a){a.base64=!1,a.binary=!1,a.dir=!1,a.createFolders=!0,a.date=null,a.compression=null,a.compressionOptions=null,a.comment=null,a.unixPermissions=null,a.dosPermissions=null},{}],6:[function(t,n,a){var r=null;r=typeof Promise<"u"?Promise:t("lie"),n.exports={Promise:r}},{lie:37}],7:[function(t,n,a){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",s=t("pako"),o=t("./utils"),l=t("./stream/GenericWorker"),u=r?"uint8array":"array";function f(c,d){l.call(this,"FlateWorker/"+c),this._pako=null,this._pakoAction=c,this._pakoOptions=d,this.meta={}}a.magic="\b\0",o.inherits(f,l),f.prototype.processChunk=function(c){this.meta=c.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(u,c.data),!1)},f.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},f.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},f.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var c=this;this._pako.onData=function(d){c.push({data:d,meta:c.meta})}},a.compressWorker=function(c){return new f("Deflate",c)},a.uncompressWorker=function(){return new f("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,n,a){function r(h,p){var m,g="";for(m=0;m<p;m++)g+=String.fromCharCode(255&h),h>>>=8;return g}function s(h,p,m,g,b,x){var w,E,C=h.file,B=h.compression,D=x!==u.utf8encode,O=o.transformTo("string",x(C.name)),H=o.transformTo("string",u.utf8encode(C.name)),Y=C.comment,ae=o.transformTo("string",x(Y)),M=o.transformTo("string",u.utf8encode(Y)),P=H.length!==C.name.length,v=M.length!==Y.length,S="",$="",L="",W=C.dir,V=C.date,J={crc32:0,compressedSize:0,uncompressedSize:0};p&&!m||(J.crc32=h.crc32,J.compressedSize=h.compressedSize,J.uncompressedSize=h.uncompressedSize);var N=0;p&&(N|=8),D||!P&&!v||(N|=2048);var R=0,ne=0;W&&(R|=16),b==="UNIX"?(ne=798,R|=function(ee,Te){var Ne=ee;return ee||(Ne=Te?16893:33204),(65535&Ne)<<16}(C.unixPermissions,W)):(ne=20,R|=function(ee){return 63&(ee||0)}(C.dosPermissions)),w=V.getUTCHours(),w<<=6,w|=V.getUTCMinutes(),w<<=5,w|=V.getUTCSeconds()/2,E=V.getUTCFullYear()-1980,E<<=4,E|=V.getUTCMonth()+1,E<<=5,E|=V.getUTCDate(),P&&($=r(1,1)+r(f(O),4)+H,S+="up"+r($.length,2)+$),v&&(L=r(1,1)+r(f(ae),4)+M,S+="uc"+r(L.length,2)+L);var ie="";return ie+=`
\0`,ie+=r(N,2),ie+=B.magic,ie+=r(w,2),ie+=r(E,2),ie+=r(J.crc32,4),ie+=r(J.compressedSize,4),ie+=r(J.uncompressedSize,4),ie+=r(O.length,2),ie+=r(S.length,2),{fileRecord:c.LOCAL_FILE_HEADER+ie+O+S,dirRecord:c.CENTRAL_FILE_HEADER+r(ne,2)+ie+r(ae.length,2)+"\0\0\0\0"+r(R,4)+r(g,4)+O+S+ae}}var o=t("../utils"),l=t("../stream/GenericWorker"),u=t("../utf8"),f=t("../crc32"),c=t("../signature");function d(h,p,m,g){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=m,this.encodeFileName=g,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(d,l),d.prototype.push=function(h){var p=h.meta.percent||0,m=this.entriesCount,g=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,l.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:m?(p+100*(m-g-1))/m:100}}))},d.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var p=this.streamFiles&&!h.file.dir;if(p){var m=s(h,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(h){this.accumulate=!1;var p=this.streamFiles&&!h.file.dir,m=s(h,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),p)this.push({data:function(g){return c.DATA_DESCRIPTOR+r(g.crc32,4)+r(g.compressedSize,4)+r(g.uncompressedSize,4)}(h),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var h=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var m=this.bytesWritten-h,g=function(b,x,w,E,C){var B=o.transformTo("string",C(E));return c.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(b,2)+r(b,2)+r(x,4)+r(w,4)+r(B.length,2)+B}(this.dirRecords.length,m,h,this.zipComment,this.encodeFileName);this.push({data:g,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(h){this._sources.push(h);var p=this;return h.on("data",function(m){p.processChunk(m)}),h.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),h.on("error",function(m){p.error(m)}),this},d.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(h){var p=this._sources;if(!l.prototype.error.call(this,h))return!1;for(var m=0;m<p.length;m++)try{p[m].error(h)}catch{}return!0},d.prototype.lock=function(){l.prototype.lock.call(this);for(var h=this._sources,p=0;p<h.length;p++)h[p].lock()},n.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,n,a){var r=t("../compressions"),s=t("./ZipFileWorker");a.generateWorker=function(o,l,u){var f=new s(l.streamFiles,u,l.platform,l.encodeFileName),c=0;try{o.forEach(function(d,h){c++;var p=function(x,w){var E=x||w,C=r[E];if(!C)throw new Error(E+" is not a valid compression method !");return C}(h.options.compression,l.compression),m=h.options.compressionOptions||l.compressionOptions||{},g=h.dir,b=h.date;h._compressWorker(p,m).withStreamInfo("file",{name:d,dir:g,date:b,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(f)}),f.entriesCount=c}catch(d){f.error(d)}return f}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,n,a){function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new r;for(var o in this)typeof this[o]!="function"&&(s[o]=this[o]);return s}}(r.prototype=t("./object")).loadAsync=t("./load"),r.support=t("./support"),r.defaults=t("./defaults"),r.version="3.10.1",r.loadAsync=function(s,o){return new r().loadAsync(s,o)},r.external=t("./external"),n.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,n,a){var r=t("./utils"),s=t("./external"),o=t("./utf8"),l=t("./zipEntries"),u=t("./stream/Crc32Probe"),f=t("./nodejsUtils");function c(d){return new s.Promise(function(h,p){var m=d.decompressed.getContentWorker().pipe(new u);m.on("error",function(g){p(g)}).on("end",function(){m.streamInfo.crc32!==d.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}n.exports=function(d,h){var p=this;return h=r.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),f.isNode&&f.isStream(d)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",d,!0,h.optimizedBinaryString,h.base64).then(function(m){var g=new l(h);return g.load(m),g}).then(function(m){var g=[s.Promise.resolve(m)],b=m.files;if(h.checkCRC32)for(var x=0;x<b.length;x++)g.push(c(b[x]));return s.Promise.all(g)}).then(function(m){for(var g=m.shift(),b=g.files,x=0;x<b.length;x++){var w=b[x],E=w.fileNameStr,C=r.resolve(w.fileNameStr);p.file(C,w.decompressed,{binary:!0,optimizedBinaryString:!0,date:w.date,dir:w.dir,comment:w.fileCommentStr.length?w.fileCommentStr:null,unixPermissions:w.unixPermissions,dosPermissions:w.dosPermissions,createFolders:h.createFolders}),w.dir||(p.file(C).unsafeOriginalName=E)}return g.zipComment.length&&(p.comment=g.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,n,a){var r=t("../utils"),s=t("../stream/GenericWorker");function o(l,u){s.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(u)}r.inherits(o,s),o.prototype._bindStream=function(l){var u=this;(this._stream=l).pause(),l.on("data",function(f){u.push({data:f,meta:{percent:0}})}).on("error",function(f){u.isPaused?this.generatedError=f:u.error(f)}).on("end",function(){u.isPaused?u._upstreamEnded=!0:u.end()})},o.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,n,a){var r=t("readable-stream").Readable;function s(o,l,u){r.call(this,l),this._helper=o;var f=this;o.on("data",function(c,d){f.push(c)||f._helper.pause(),u&&u(d)}).on("error",function(c){f.emit("error",c)}).on("end",function(){f.push(null)})}t("../utils").inherits(s,r),s.prototype._read=function(){this._helper.resume()},n.exports=s},{"../utils":32,"readable-stream":16}],14:[function(t,n,a){n.exports={isNode:typeof Buffer<"u",newBufferFrom:function(r,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(r,s);if(typeof r=="number")throw new Error('The "data" argument must not be a number');return new Buffer(r,s)},allocBuffer:function(r){if(Buffer.alloc)return Buffer.alloc(r);var s=new Buffer(r);return s.fill(0),s},isBuffer:function(r){return Buffer.isBuffer(r)},isStream:function(r){return r&&typeof r.on=="function"&&typeof r.pause=="function"&&typeof r.resume=="function"}}},{}],15:[function(t,n,a){function r(C,B,D){var O,H=o.getTypeOf(B),Y=o.extend(D||{},f);Y.date=Y.date||new Date,Y.compression!==null&&(Y.compression=Y.compression.toUpperCase()),typeof Y.unixPermissions=="string"&&(Y.unixPermissions=parseInt(Y.unixPermissions,8)),Y.unixPermissions&&16384&Y.unixPermissions&&(Y.dir=!0),Y.dosPermissions&&16&Y.dosPermissions&&(Y.dir=!0),Y.dir&&(C=b(C)),Y.createFolders&&(O=g(C))&&x.call(this,O,!0);var ae=H==="string"&&Y.binary===!1&&Y.base64===!1;D&&D.binary!==void 0||(Y.binary=!ae),(B instanceof c&&B.uncompressedSize===0||Y.dir||!B||B.length===0)&&(Y.base64=!1,Y.binary=!0,B="",Y.compression="STORE",H="string");var M=null;M=B instanceof c||B instanceof l?B:p.isNode&&p.isStream(B)?new m(C,B):o.prepareContent(C,B,Y.binary,Y.optimizedBinaryString,Y.base64);var P=new d(C,M,Y);this.files[C]=P}var s=t("./utf8"),o=t("./utils"),l=t("./stream/GenericWorker"),u=t("./stream/StreamHelper"),f=t("./defaults"),c=t("./compressedObject"),d=t("./zipObject"),h=t("./generate"),p=t("./nodejsUtils"),m=t("./nodejs/NodejsStreamInputAdapter"),g=function(C){C.slice(-1)==="/"&&(C=C.substring(0,C.length-1));var B=C.lastIndexOf("/");return 0<B?C.substring(0,B):""},b=function(C){return C.slice(-1)!=="/"&&(C+="/"),C},x=function(C,B){return B=B!==void 0?B:f.createFolders,C=b(C),this.files[C]||r.call(this,C,null,{dir:!0,createFolders:B}),this.files[C]};function w(C){return Object.prototype.toString.call(C)==="[object RegExp]"}var E={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(C){var B,D,O;for(B in this.files)O=this.files[B],(D=B.slice(this.root.length,B.length))&&B.slice(0,this.root.length)===this.root&&C(D,O)},filter:function(C){var B=[];return this.forEach(function(D,O){C(D,O)&&B.push(O)}),B},file:function(C,B,D){if(arguments.length!==1)return C=this.root+C,r.call(this,C,B,D),this;if(w(C)){var O=C;return this.filter(function(Y,ae){return!ae.dir&&O.test(Y)})}var H=this.files[this.root+C];return H&&!H.dir?H:null},folder:function(C){if(!C)return this;if(w(C))return this.filter(function(H,Y){return Y.dir&&C.test(H)});var B=this.root+C,D=x.call(this,B),O=this.clone();return O.root=D.name,O},remove:function(C){C=this.root+C;var B=this.files[C];if(B||(C.slice(-1)!=="/"&&(C+="/"),B=this.files[C]),B&&!B.dir)delete this.files[C];else for(var D=this.filter(function(H,Y){return Y.name.slice(0,C.length)===C}),O=0;O<D.length;O++)delete this.files[D[O].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(C){var B,D={};try{if((D=o.extend(C||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=D.type.toLowerCase(),D.compression=D.compression.toUpperCase(),D.type==="binarystring"&&(D.type="string"),!D.type)throw new Error("No output type specified.");o.checkSupport(D.type),D.platform!=="darwin"&&D.platform!=="freebsd"&&D.platform!=="linux"&&D.platform!=="sunos"||(D.platform="UNIX"),D.platform==="win32"&&(D.platform="DOS");var O=D.comment||this.comment||"";B=h.generateWorker(this,D,O)}catch(H){(B=new l("error")).error(H)}return new u(B,D.type||"string",D.mimeType)},generateAsync:function(C,B){return this.generateInternalStream(C).accumulate(B)},generateNodeStream:function(C,B){return(C=C||{}).type||(C.type="nodebuffer"),this.generateInternalStream(C).toNodejsStream(B)}};n.exports=E},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,n,a){n.exports=t("stream")},{stream:void 0}],17:[function(t,n,a){var r=t("./DataReader");function s(o){r.call(this,o);for(var l=0;l<this.data.length;l++)o[l]=255&o[l]}t("../utils").inherits(s,r),s.prototype.byteAt=function(o){return this.data[this.zero+o]},s.prototype.lastIndexOfSignature=function(o){for(var l=o.charCodeAt(0),u=o.charCodeAt(1),f=o.charCodeAt(2),c=o.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===l&&this.data[d+1]===u&&this.data[d+2]===f&&this.data[d+3]===c)return d-this.zero;return-1},s.prototype.readAndCheckSignature=function(o){var l=o.charCodeAt(0),u=o.charCodeAt(1),f=o.charCodeAt(2),c=o.charCodeAt(3),d=this.readData(4);return l===d[0]&&u===d[1]&&f===d[2]&&c===d[3]},s.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./DataReader":18}],18:[function(t,n,a){var r=t("../utils");function s(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var l,u=0;for(this.checkOffset(o),l=this.index+o-1;l>=this.index;l--)u=(u<<8)+this.byteAt(l);return this.index+=o,u},readString:function(o){return r.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},n.exports=s},{"../utils":32}],19:[function(t,n,a){var r=t("./Uint8ArrayReader");function s(o){r.call(this,o)}t("../utils").inherits(s,r),s.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,n,a){var r=t("./DataReader");function s(o){r.call(this,o)}t("../utils").inherits(s,r),s.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},s.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},s.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},s.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./DataReader":18}],21:[function(t,n,a){var r=t("./ArrayReader");function s(o){r.call(this,o)}t("../utils").inherits(s,r),s.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(t,n,a){var r=t("../utils"),s=t("../support"),o=t("./ArrayReader"),l=t("./StringReader"),u=t("./NodeBufferReader"),f=t("./Uint8ArrayReader");n.exports=function(c){var d=r.getTypeOf(c);return r.checkSupport(d),d!=="string"||s.uint8array?d==="nodebuffer"?new u(c):s.uint8array?new f(r.transformTo("uint8array",c)):new o(r.transformTo("array",c)):new l(c)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,n,a){a.LOCAL_FILE_HEADER="PK",a.CENTRAL_FILE_HEADER="PK",a.CENTRAL_DIRECTORY_END="PK",a.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",a.ZIP64_CENTRAL_DIRECTORY_END="PK",a.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,n,a){var r=t("./GenericWorker"),s=t("../utils");function o(l){r.call(this,"ConvertWorker to "+l),this.destType=l}s.inherits(o,r),o.prototype.processChunk=function(l){this.push({data:s.transformTo(this.destType,l.data),meta:l.meta})},n.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(t,n,a){var r=t("./GenericWorker"),s=t("../crc32");function o(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(o,r),o.prototype.processChunk=function(l){this.streamInfo.crc32=s(l.data,this.streamInfo.crc32||0),this.push(l)},n.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,n,a){var r=t("../utils"),s=t("./GenericWorker");function o(l){s.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}r.inherits(o,s),o.prototype.processChunk=function(l){if(l){var u=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=u+l.data.length}s.prototype.processChunk.call(this,l)},n.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(t,n,a){var r=t("../utils"),s=t("./GenericWorker");function o(l){s.call(this,"DataWorker");var u=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(f){u.dataIsReady=!0,u.data=f,u.max=f&&f.length||0,u.type=r.getTypeOf(f),u.isPaused||u._tickAndRepeat()},function(f){u.error(f)})}r.inherits(o,s),o.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,u=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,u);break;case"uint8array":l=this.data.subarray(this.index,u);break;case"array":case"nodebuffer":l=this.data.slice(this.index,u)}return this.index=u,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(t,n,a){function r(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,o){return this._listeners[s].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,o){if(this._listeners[s])for(var l=0;l<this._listeners[s].length;l++)this._listeners[s][l].call(this,o)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var o=this;return s.on("data",function(l){o.processChunk(l)}),s.on("end",function(){o.end()}),s.on("error",function(l){o.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,o){return this.extraStreamInfo[s]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},n.exports=r},{}],29:[function(t,n,a){var r=t("../utils"),s=t("./ConvertWorker"),o=t("./GenericWorker"),l=t("../base64"),u=t("../support"),f=t("../external"),c=null;if(u.nodestream)try{c=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(p,m){return new f.Promise(function(g,b){var x=[],w=p._internalType,E=p._outputType,C=p._mimeType;p.on("data",function(B,D){x.push(B),m&&m(D)}).on("error",function(B){x=[],b(B)}).on("end",function(){try{var B=function(D,O,H){switch(D){case"blob":return r.newBlob(r.transformTo("arraybuffer",O),H);case"base64":return l.encode(O);default:return r.transformTo(D,O)}}(E,function(D,O){var H,Y=0,ae=null,M=0;for(H=0;H<O.length;H++)M+=O[H].length;switch(D){case"string":return O.join("");case"array":return Array.prototype.concat.apply([],O);case"uint8array":for(ae=new Uint8Array(M),H=0;H<O.length;H++)ae.set(O[H],Y),Y+=O[H].length;return ae;case"nodebuffer":return Buffer.concat(O);default:throw new Error("concat : unsupported type '"+D+"'")}}(w,x),C);g(B)}catch(D){b(D)}x=[]}).resume()})}function h(p,m,g){var b=m;switch(m){case"blob":case"arraybuffer":b="uint8array";break;case"base64":b="string"}try{this._internalType=b,this._outputType=m,this._mimeType=g,r.checkSupport(b),this._worker=p.pipe(new s(b)),p.lock()}catch(x){this._worker=new o("error"),this._worker.error(x)}}h.prototype={accumulate:function(p){return d(this,p)},on:function(p,m){var g=this;return p==="data"?this._worker.on(p,function(b){m.call(g,b.data,b.meta)}):this._worker.on(p,function(){r.delay(m,arguments,g)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(r.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new c(this,{objectMode:this._outputType!=="nodebuffer"},p)}},n.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,n,a){if(a.base64=!0,a.array=!0,a.string=!0,a.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",a.nodebuffer=typeof Buffer<"u",a.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")a.blob=!1;else{var r=new ArrayBuffer(0);try{a.blob=new Blob([r],{type:"application/zip"}).size===0}catch{try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(r),a.blob=s.getBlob("application/zip").size===0}catch{a.blob=!1}}}try{a.nodestream=!!t("readable-stream").Readable}catch{a.nodestream=!1}},{"readable-stream":16}],31:[function(t,n,a){for(var r=t("./utils"),s=t("./support"),o=t("./nodejsUtils"),l=t("./stream/GenericWorker"),u=new Array(256),f=0;f<256;f++)u[f]=252<=f?6:248<=f?5:240<=f?4:224<=f?3:192<=f?2:1;u[254]=u[254]=1;function c(){l.call(this,"utf-8 decode"),this.leftOver=null}function d(){l.call(this,"utf-8 encode")}a.utf8encode=function(h){return s.nodebuffer?o.newBufferFrom(h,"utf-8"):function(p){var m,g,b,x,w,E=p.length,C=0;for(x=0;x<E;x++)(64512&(g=p.charCodeAt(x)))==55296&&x+1<E&&(64512&(b=p.charCodeAt(x+1)))==56320&&(g=65536+(g-55296<<10)+(b-56320),x++),C+=g<128?1:g<2048?2:g<65536?3:4;for(m=s.uint8array?new Uint8Array(C):new Array(C),x=w=0;w<C;x++)(64512&(g=p.charCodeAt(x)))==55296&&x+1<E&&(64512&(b=p.charCodeAt(x+1)))==56320&&(g=65536+(g-55296<<10)+(b-56320),x++),g<128?m[w++]=g:(g<2048?m[w++]=192|g>>>6:(g<65536?m[w++]=224|g>>>12:(m[w++]=240|g>>>18,m[w++]=128|g>>>12&63),m[w++]=128|g>>>6&63),m[w++]=128|63&g);return m}(h)},a.utf8decode=function(h){return s.nodebuffer?r.transformTo("nodebuffer",h).toString("utf-8"):function(p){var m,g,b,x,w=p.length,E=new Array(2*w);for(m=g=0;m<w;)if((b=p[m++])<128)E[g++]=b;else if(4<(x=u[b]))E[g++]=65533,m+=x-1;else{for(b&=x===2?31:x===3?15:7;1<x&&m<w;)b=b<<6|63&p[m++],x--;1<x?E[g++]=65533:b<65536?E[g++]=b:(b-=65536,E[g++]=55296|b>>10&1023,E[g++]=56320|1023&b)}return E.length!==g&&(E.subarray?E=E.subarray(0,g):E.length=g),r.applyFromCharCode(E)}(h=r.transformTo(s.uint8array?"uint8array":"array",h))},r.inherits(c,l),c.prototype.processChunk=function(h){var p=r.transformTo(s.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var m=p;(p=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),p.set(m,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var g=function(x,w){var E;for((w=w||x.length)>x.length&&(w=x.length),E=w-1;0<=E&&(192&x[E])==128;)E--;return E<0||E===0?w:E+u[x[E]]>w?E:w}(p),b=p;g!==p.length&&(s.uint8array?(b=p.subarray(0,g),this.leftOver=p.subarray(g,p.length)):(b=p.slice(0,g),this.leftOver=p.slice(g,p.length))),this.push({data:a.utf8decode(b),meta:h.meta})},c.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:a.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},a.Utf8DecodeWorker=c,r.inherits(d,l),d.prototype.processChunk=function(h){this.push({data:a.utf8encode(h.data),meta:h.meta})},a.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,n,a){var r=t("./support"),s=t("./base64"),o=t("./nodejsUtils"),l=t("./external");function u(m){return m}function f(m,g){for(var b=0;b<m.length;++b)g[b]=255&m.charCodeAt(b);return g}t("setimmediate"),a.newBlob=function(m,g){a.checkSupport("blob");try{return new Blob([m],{type:g})}catch{try{var b=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return b.append(m),b.getBlob(g)}catch{throw new Error("Bug : can't construct the Blob.")}}};var c={stringifyByChunk:function(m,g,b){var x=[],w=0,E=m.length;if(E<=b)return String.fromCharCode.apply(null,m);for(;w<E;)g==="array"||g==="nodebuffer"?x.push(String.fromCharCode.apply(null,m.slice(w,Math.min(w+b,E)))):x.push(String.fromCharCode.apply(null,m.subarray(w,Math.min(w+b,E)))),w+=b;return x.join("")},stringifyByChar:function(m){for(var g="",b=0;b<m.length;b++)g+=String.fromCharCode(m[b]);return g},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function d(m){var g=65536,b=a.getTypeOf(m),x=!0;if(b==="uint8array"?x=c.applyCanBeUsed.uint8array:b==="nodebuffer"&&(x=c.applyCanBeUsed.nodebuffer),x)for(;1<g;)try{return c.stringifyByChunk(m,b,g)}catch{g=Math.floor(g/2)}return c.stringifyByChar(m)}function h(m,g){for(var b=0;b<m.length;b++)g[b]=m[b];return g}a.applyFromCharCode=d;var p={};p.string={string:u,array:function(m){return f(m,new Array(m.length))},arraybuffer:function(m){return p.string.uint8array(m).buffer},uint8array:function(m){return f(m,new Uint8Array(m.length))},nodebuffer:function(m){return f(m,o.allocBuffer(m.length))}},p.array={string:d,array:u,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return o.newBufferFrom(m)}},p.arraybuffer={string:function(m){return d(new Uint8Array(m))},array:function(m){return h(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:u,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return o.newBufferFrom(new Uint8Array(m))}},p.uint8array={string:d,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:u,nodebuffer:function(m){return o.newBufferFrom(m)}},p.nodebuffer={string:d,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return p.nodebuffer.uint8array(m).buffer},uint8array:function(m){return h(m,new Uint8Array(m.length))},nodebuffer:u},a.transformTo=function(m,g){if(g=g||"",!m)return g;a.checkSupport(m);var b=a.getTypeOf(g);return p[b][m](g)},a.resolve=function(m){for(var g=m.split("/"),b=[],x=0;x<g.length;x++){var w=g[x];w==="."||w===""&&x!==0&&x!==g.length-1||(w===".."?b.pop():b.push(w))}return b.join("/")},a.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":r.nodebuffer&&o.isBuffer(m)?"nodebuffer":r.uint8array&&m instanceof Uint8Array?"uint8array":r.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},a.checkSupport=function(m){if(!r[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},a.MAX_VALUE_16BITS=65535,a.MAX_VALUE_32BITS=-1,a.pretty=function(m){var g,b,x="";for(b=0;b<(m||"").length;b++)x+="\\x"+((g=m.charCodeAt(b))<16?"0":"")+g.toString(16).toUpperCase();return x},a.delay=function(m,g,b){setImmediate(function(){m.apply(b||null,g||[])})},a.inherits=function(m,g){function b(){}b.prototype=g.prototype,m.prototype=new b},a.extend=function(){var m,g,b={};for(m=0;m<arguments.length;m++)for(g in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],g)&&b[g]===void 0&&(b[g]=arguments[m][g]);return b},a.prepareContent=function(m,g,b,x,w){return l.Promise.resolve(g).then(function(E){return r.blob&&(E instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(E))!==-1)&&typeof FileReader<"u"?new l.Promise(function(C,B){var D=new FileReader;D.onload=function(O){C(O.target.result)},D.onerror=function(O){B(O.target.error)},D.readAsArrayBuffer(E)}):E}).then(function(E){var C=a.getTypeOf(E);return C?(C==="arraybuffer"?E=a.transformTo("uint8array",E):C==="string"&&(w?E=s.decode(E):b&&x!==!0&&(E=function(B){return f(B,r.uint8array?new Uint8Array(B.length):new Array(B.length))}(E))),E):l.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,n,a){var r=t("./reader/readerFor"),s=t("./utils"),o=t("./signature"),l=t("./zipEntry"),u=t("./support");function f(c){this.files=[],this.loadOptions=c}f.prototype={checkSignature:function(c){if(!this.reader.readAndCheckSignature(c)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(d)+", expected "+s.pretty(c)+")")}},isSignature:function(c,d){var h=this.reader.index;this.reader.setIndex(c);var p=this.reader.readString(4)===d;return this.reader.setIndex(h),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var c=this.reader.readData(this.zipCommentLength),d=u.uint8array?"uint8array":"array",h=s.transformTo(d,c);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var c,d,h,p=this.zip64EndOfCentralSize-44;0<p;)c=this.reader.readInt(2),d=this.reader.readInt(4),h=this.reader.readData(d),this.zip64ExtensibleData[c]={id:c,length:d,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var c,d;for(c=0;c<this.files.length;c++)d=this.files[c],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var c;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(c=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(c);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var c=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(c<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(c);var d=c;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(c=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(c),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var p=d-h;if(0<p)this.isSignature(d,o.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(c){this.reader=r(c)},load:function(c){this.prepareReader(c),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=f},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,n,a){var r=t("./reader/readerFor"),s=t("./utils"),o=t("./compressedObject"),l=t("./crc32"),u=t("./utf8"),f=t("./compressions"),c=t("./support");function d(h,p){this.options=h,this.loadOptions=p}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var p,m;if(h.skip(22),this.fileNameLength=h.readInt(2),m=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(g){for(var b in f)if(Object.prototype.hasOwnProperty.call(f,b)&&f[b].magic===g)return f[b];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,p,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var p=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(p),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=r(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var p,m,g,b=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<b;)p=h.readInt(2),m=h.readInt(2),g=h.readData(m),this.extraFields[p]={id:p,length:m,value:g};h.setIndex(b)},handleUTF8:function(){var h=c.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=u.utf8decode(this.fileName),this.fileCommentStr=u.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var m=s.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var g=this.findExtraFieldUnicodeComment();if(g!==null)this.fileCommentStr=g;else{var b=s.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(b)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var p=r(h.value);return p.readInt(1)!==1||l(this.fileName)!==p.readInt(4)?null:u.utf8decode(p.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var p=r(h.value);return p.readInt(1)!==1||l(this.fileComment)!==p.readInt(4)?null:u.utf8decode(p.readData(h.length-5))}return null}},n.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,n,a){function r(p,m,g){this.name=p,this.dir=g.dir,this.date=g.date,this.comment=g.comment,this.unixPermissions=g.unixPermissions,this.dosPermissions=g.dosPermissions,this._data=m,this._dataBinary=g.binary,this.options={compression:g.compression,compressionOptions:g.compressionOptions}}var s=t("./stream/StreamHelper"),o=t("./stream/DataWorker"),l=t("./utf8"),u=t("./compressedObject"),f=t("./stream/GenericWorker");r.prototype={internalStream:function(p){var m=null,g="string";try{if(!p)throw new Error("No output type specified.");var b=(g=p.toLowerCase())==="string"||g==="text";g!=="binarystring"&&g!=="text"||(g="string"),m=this._decompressWorker();var x=!this._dataBinary;x&&!b&&(m=m.pipe(new l.Utf8EncodeWorker)),!x&&b&&(m=m.pipe(new l.Utf8DecodeWorker))}catch(w){(m=new f("error")).error(w)}return new s(m,g,"")},async:function(p,m){return this.internalStream(p).accumulate(m)},nodeStream:function(p,m){return this.internalStream(p||"nodebuffer").toNodejsStream(m)},_compressWorker:function(p,m){if(this._data instanceof u&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var g=this._decompressWorker();return this._dataBinary||(g=g.pipe(new l.Utf8EncodeWorker)),u.createWorkerFrom(g,p,m)},_decompressWorker:function(){return this._data instanceof u?this._data.getContentWorker():this._data instanceof f?this._data:new o(this._data)}};for(var c=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<c.length;h++)r.prototype[c[h]]=d;n.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,n,a){(function(r){var s,o,l=r.MutationObserver||r.WebKitMutationObserver;if(l){var u=0,f=new l(p),c=r.document.createTextNode("");f.observe(c,{characterData:!0}),s=function(){c.data=u=++u%2}}else if(r.setImmediate||r.MessageChannel===void 0)s="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var m=r.document.createElement("script");m.onreadystatechange=function(){p(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},r.document.documentElement.appendChild(m)}:function(){setTimeout(p,0)};else{var d=new r.MessageChannel;d.port1.onmessage=p,s=function(){d.port2.postMessage(0)}}var h=[];function p(){var m,g;o=!0;for(var b=h.length;b;){for(g=h,h=[],m=-1;++m<b;)g[m]();b=h.length}o=!1}n.exports=function(m){h.push(m)!==1||o||s()}}).call(this,typeof gi<"u"?gi:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,n,a){var r=t("immediate");function s(){}var o={},l=["REJECTED"],u=["FULFILLED"],f=["PENDING"];function c(b){if(typeof b!="function")throw new TypeError("resolver must be a function");this.state=f,this.queue=[],this.outcome=void 0,b!==s&&m(this,b)}function d(b,x,w){this.promise=b,typeof x=="function"&&(this.onFulfilled=x,this.callFulfilled=this.otherCallFulfilled),typeof w=="function"&&(this.onRejected=w,this.callRejected=this.otherCallRejected)}function h(b,x,w){r(function(){var E;try{E=x(w)}catch(C){return o.reject(b,C)}E===b?o.reject(b,new TypeError("Cannot resolve promise with itself")):o.resolve(b,E)})}function p(b){var x=b&&b.then;if(b&&(typeof b=="object"||typeof b=="function")&&typeof x=="function")return function(){x.apply(b,arguments)}}function m(b,x){var w=!1;function E(D){w||(w=!0,o.reject(b,D))}function C(D){w||(w=!0,o.resolve(b,D))}var B=g(function(){x(C,E)});B.status==="error"&&E(B.value)}function g(b,x){var w={};try{w.value=b(x),w.status="success"}catch(E){w.status="error",w.value=E}return w}(n.exports=c).prototype.finally=function(b){if(typeof b!="function")return this;var x=this.constructor;return this.then(function(w){return x.resolve(b()).then(function(){return w})},function(w){return x.resolve(b()).then(function(){throw w})})},c.prototype.catch=function(b){return this.then(null,b)},c.prototype.then=function(b,x){if(typeof b!="function"&&this.state===u||typeof x!="function"&&this.state===l)return this;var w=new this.constructor(s);return this.state!==f?h(w,this.state===u?b:x,this.outcome):this.queue.push(new d(w,b,x)),w},d.prototype.callFulfilled=function(b){o.resolve(this.promise,b)},d.prototype.otherCallFulfilled=function(b){h(this.promise,this.onFulfilled,b)},d.prototype.callRejected=function(b){o.reject(this.promise,b)},d.prototype.otherCallRejected=function(b){h(this.promise,this.onRejected,b)},o.resolve=function(b,x){var w=g(p,x);if(w.status==="error")return o.reject(b,w.value);var E=w.value;if(E)m(b,E);else{b.state=u,b.outcome=x;for(var C=-1,B=b.queue.length;++C<B;)b.queue[C].callFulfilled(x)}return b},o.reject=function(b,x){b.state=l,b.outcome=x;for(var w=-1,E=b.queue.length;++w<E;)b.queue[w].callRejected(x);return b},c.resolve=function(b){return b instanceof this?b:o.resolve(new this(s),b)},c.reject=function(b){var x=new this(s);return o.reject(x,b)},c.all=function(b){var x=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=b.length,E=!1;if(!w)return this.resolve([]);for(var C=new Array(w),B=0,D=-1,O=new this(s);++D<w;)H(b[D],D);return O;function H(Y,ae){x.resolve(Y).then(function(M){C[ae]=M,++B!==w||E||(E=!0,o.resolve(O,C))},function(M){E||(E=!0,o.reject(O,M))})}},c.race=function(b){var x=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=b.length,E=!1;if(!w)return this.resolve([]);for(var C=-1,B=new this(s);++C<w;)D=b[C],x.resolve(D).then(function(O){E||(E=!0,o.resolve(B,O))},function(O){E||(E=!0,o.reject(B,O))});var D;return B}},{immediate:36}],38:[function(t,n,a){var r={};(0,t("./lib/utils/common").assign)(r,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),n.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,n,a){var r=t("./zlib/deflate"),s=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/messages"),u=t("./zlib/zstream"),f=Object.prototype.toString,c=0,d=-1,h=0,p=8;function m(b){if(!(this instanceof m))return new m(b);this.options=s.assign({level:d,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},b||{});var x=this.options;x.raw&&0<x.windowBits?x.windowBits=-x.windowBits:x.gzip&&0<x.windowBits&&x.windowBits<16&&(x.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var w=r.deflateInit2(this.strm,x.level,x.method,x.windowBits,x.memLevel,x.strategy);if(w!==c)throw new Error(l[w]);if(x.header&&r.deflateSetHeader(this.strm,x.header),x.dictionary){var E;if(E=typeof x.dictionary=="string"?o.string2buf(x.dictionary):f.call(x.dictionary)==="[object ArrayBuffer]"?new Uint8Array(x.dictionary):x.dictionary,(w=r.deflateSetDictionary(this.strm,E))!==c)throw new Error(l[w]);this._dict_set=!0}}function g(b,x){var w=new m(x);if(w.push(b,!0),w.err)throw w.msg||l[w.err];return w.result}m.prototype.push=function(b,x){var w,E,C=this.strm,B=this.options.chunkSize;if(this.ended)return!1;E=x===~~x?x:x===!0?4:0,typeof b=="string"?C.input=o.string2buf(b):f.call(b)==="[object ArrayBuffer]"?C.input=new Uint8Array(b):C.input=b,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new s.Buf8(B),C.next_out=0,C.avail_out=B),(w=r.deflate(C,E))!==1&&w!==c)return this.onEnd(w),!(this.ended=!0);C.avail_out!==0&&(C.avail_in!==0||E!==4&&E!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(s.shrinkBuf(C.output,C.next_out))):this.onData(s.shrinkBuf(C.output,C.next_out)))}while((0<C.avail_in||C.avail_out===0)&&w!==1);return E===4?(w=r.deflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===c):E!==2||(this.onEnd(c),!(C.avail_out=0))},m.prototype.onData=function(b){this.chunks.push(b)},m.prototype.onEnd=function(b){b===c&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.msg=this.strm.msg},a.Deflate=m,a.deflate=g,a.deflateRaw=function(b,x){return(x=x||{}).raw=!0,g(b,x)},a.gzip=function(b,x){return(x=x||{}).gzip=!0,g(b,x)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,n,a){var r=t("./zlib/inflate"),s=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/constants"),u=t("./zlib/messages"),f=t("./zlib/zstream"),c=t("./zlib/gzheader"),d=Object.prototype.toString;function h(m){if(!(this instanceof h))return new h(m);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},m||{});var g=this.options;g.raw&&0<=g.windowBits&&g.windowBits<16&&(g.windowBits=-g.windowBits,g.windowBits===0&&(g.windowBits=-15)),!(0<=g.windowBits&&g.windowBits<16)||m&&m.windowBits||(g.windowBits+=32),15<g.windowBits&&g.windowBits<48&&(15&g.windowBits)==0&&(g.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var b=r.inflateInit2(this.strm,g.windowBits);if(b!==l.Z_OK)throw new Error(u[b]);this.header=new c,r.inflateGetHeader(this.strm,this.header)}function p(m,g){var b=new h(g);if(b.push(m,!0),b.err)throw b.msg||u[b.err];return b.result}h.prototype.push=function(m,g){var b,x,w,E,C,B,D=this.strm,O=this.options.chunkSize,H=this.options.dictionary,Y=!1;if(this.ended)return!1;x=g===~~g?g:g===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof m=="string"?D.input=o.binstring2buf(m):d.call(m)==="[object ArrayBuffer]"?D.input=new Uint8Array(m):D.input=m,D.next_in=0,D.avail_in=D.input.length;do{if(D.avail_out===0&&(D.output=new s.Buf8(O),D.next_out=0,D.avail_out=O),(b=r.inflate(D,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&H&&(B=typeof H=="string"?o.string2buf(H):d.call(H)==="[object ArrayBuffer]"?new Uint8Array(H):H,b=r.inflateSetDictionary(this.strm,B)),b===l.Z_BUF_ERROR&&Y===!0&&(b=l.Z_OK,Y=!1),b!==l.Z_STREAM_END&&b!==l.Z_OK)return this.onEnd(b),!(this.ended=!0);D.next_out&&(D.avail_out!==0&&b!==l.Z_STREAM_END&&(D.avail_in!==0||x!==l.Z_FINISH&&x!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(w=o.utf8border(D.output,D.next_out),E=D.next_out-w,C=o.buf2string(D.output,w),D.next_out=E,D.avail_out=O-E,E&&s.arraySet(D.output,D.output,w,E,0),this.onData(C)):this.onData(s.shrinkBuf(D.output,D.next_out)))),D.avail_in===0&&D.avail_out===0&&(Y=!0)}while((0<D.avail_in||D.avail_out===0)&&b!==l.Z_STREAM_END);return b===l.Z_STREAM_END&&(x=l.Z_FINISH),x===l.Z_FINISH?(b=r.inflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===l.Z_OK):x!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(D.avail_out=0))},h.prototype.onData=function(m){this.chunks.push(m)},h.prototype.onEnd=function(m){m===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},a.Inflate=h,a.inflate=p,a.inflateRaw=function(m,g){return(g=g||{}).raw=!0,p(m,g)},a.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,n,a){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";a.assign=function(l){for(var u=Array.prototype.slice.call(arguments,1);u.length;){var f=u.shift();if(f){if(typeof f!="object")throw new TypeError(f+"must be non-object");for(var c in f)f.hasOwnProperty(c)&&(l[c]=f[c])}}return l},a.shrinkBuf=function(l,u){return l.length===u?l:l.subarray?l.subarray(0,u):(l.length=u,l)};var s={arraySet:function(l,u,f,c,d){if(u.subarray&&l.subarray)l.set(u.subarray(f,f+c),d);else for(var h=0;h<c;h++)l[d+h]=u[f+h]},flattenChunks:function(l){var u,f,c,d,h,p;for(u=c=0,f=l.length;u<f;u++)c+=l[u].length;for(p=new Uint8Array(c),u=d=0,f=l.length;u<f;u++)h=l[u],p.set(h,d),d+=h.length;return p}},o={arraySet:function(l,u,f,c,d){for(var h=0;h<c;h++)l[d+h]=u[f+h]},flattenChunks:function(l){return[].concat.apply([],l)}};a.setTyped=function(l){l?(a.Buf8=Uint8Array,a.Buf16=Uint16Array,a.Buf32=Int32Array,a.assign(a,s)):(a.Buf8=Array,a.Buf16=Array,a.Buf32=Array,a.assign(a,o))},a.setTyped(r)},{}],42:[function(t,n,a){var r=t("./common"),s=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var l=new r.Buf8(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;function f(c,d){if(d<65537&&(c.subarray&&o||!c.subarray&&s))return String.fromCharCode.apply(null,r.shrinkBuf(c,d));for(var h="",p=0;p<d;p++)h+=String.fromCharCode(c[p]);return h}l[254]=l[254]=1,a.string2buf=function(c){var d,h,p,m,g,b=c.length,x=0;for(m=0;m<b;m++)(64512&(h=c.charCodeAt(m)))==55296&&m+1<b&&(64512&(p=c.charCodeAt(m+1)))==56320&&(h=65536+(h-55296<<10)+(p-56320),m++),x+=h<128?1:h<2048?2:h<65536?3:4;for(d=new r.Buf8(x),m=g=0;g<x;m++)(64512&(h=c.charCodeAt(m)))==55296&&m+1<b&&(64512&(p=c.charCodeAt(m+1)))==56320&&(h=65536+(h-55296<<10)+(p-56320),m++),h<128?d[g++]=h:(h<2048?d[g++]=192|h>>>6:(h<65536?d[g++]=224|h>>>12:(d[g++]=240|h>>>18,d[g++]=128|h>>>12&63),d[g++]=128|h>>>6&63),d[g++]=128|63&h);return d},a.buf2binstring=function(c){return f(c,c.length)},a.binstring2buf=function(c){for(var d=new r.Buf8(c.length),h=0,p=d.length;h<p;h++)d[h]=c.charCodeAt(h);return d},a.buf2string=function(c,d){var h,p,m,g,b=d||c.length,x=new Array(2*b);for(h=p=0;h<b;)if((m=c[h++])<128)x[p++]=m;else if(4<(g=l[m]))x[p++]=65533,h+=g-1;else{for(m&=g===2?31:g===3?15:7;1<g&&h<b;)m=m<<6|63&c[h++],g--;1<g?x[p++]=65533:m<65536?x[p++]=m:(m-=65536,x[p++]=55296|m>>10&1023,x[p++]=56320|1023&m)}return f(x,p)},a.utf8border=function(c,d){var h;for((d=d||c.length)>c.length&&(d=c.length),h=d-1;0<=h&&(192&c[h])==128;)h--;return h<0||h===0?d:h+l[c[h]]>d?h:d}},{"./common":41}],43:[function(t,n,a){n.exports=function(r,s,o,l){for(var u=65535&r|0,f=r>>>16&65535|0,c=0;o!==0;){for(o-=c=2e3<o?2e3:o;f=f+(u=u+s[l++]|0)|0,--c;);u%=65521,f%=65521}return u|f<<16|0}},{}],44:[function(t,n,a){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,n,a){var r=function(){for(var s,o=[],l=0;l<256;l++){s=l;for(var u=0;u<8;u++)s=1&s?3988292384^s>>>1:s>>>1;o[l]=s}return o}();n.exports=function(s,o,l,u){var f=r,c=u+l;s^=-1;for(var d=u;d<c;d++)s=s>>>8^f[255&(s^o[d])];return-1^s}},{}],46:[function(t,n,a){var r,s=t("../utils/common"),o=t("./trees"),l=t("./adler32"),u=t("./crc32"),f=t("./messages"),c=0,d=4,h=0,p=-2,m=-1,g=4,b=2,x=8,w=9,E=286,C=30,B=19,D=2*E+1,O=15,H=3,Y=258,ae=Y+H+1,M=42,P=113,v=1,S=2,$=3,L=4;function W(_,X){return _.msg=f[X],X}function V(_){return(_<<1)-(4<_?9:0)}function J(_){for(var X=_.length;0<=--X;)_[X]=0}function N(_){var X=_.state,G=X.pending;G>_.avail_out&&(G=_.avail_out),G!==0&&(s.arraySet(_.output,X.pending_buf,X.pending_out,G,_.next_out),_.next_out+=G,X.pending_out+=G,_.total_out+=G,_.avail_out-=G,X.pending-=G,X.pending===0&&(X.pending_out=0))}function R(_,X){o._tr_flush_block(_,0<=_.block_start?_.block_start:-1,_.strstart-_.block_start,X),_.block_start=_.strstart,N(_.strm)}function ne(_,X){_.pending_buf[_.pending++]=X}function ie(_,X){_.pending_buf[_.pending++]=X>>>8&255,_.pending_buf[_.pending++]=255&X}function ee(_,X){var G,T,k=_.max_chain_length,z=_.strstart,j=_.prev_length,Q=_.nice_match,U=_.strstart>_.w_size-ae?_.strstart-(_.w_size-ae):0,oe=_.window,ce=_.w_mask,le=_.prev,ge=_.strstart+Y,qe=oe[z+j-1],De=oe[z+j];_.prev_length>=_.good_match&&(k>>=2),Q>_.lookahead&&(Q=_.lookahead);do if(oe[(G=X)+j]===De&&oe[G+j-1]===qe&&oe[G]===oe[z]&&oe[++G]===oe[z+1]){z+=2,G++;do;while(oe[++z]===oe[++G]&&oe[++z]===oe[++G]&&oe[++z]===oe[++G]&&oe[++z]===oe[++G]&&oe[++z]===oe[++G]&&oe[++z]===oe[++G]&&oe[++z]===oe[++G]&&oe[++z]===oe[++G]&&z<ge);if(T=Y-(ge-z),z=ge-Y,j<T){if(_.match_start=X,Q<=(j=T))break;qe=oe[z+j-1],De=oe[z+j]}}while((X=le[X&ce])>U&&--k!=0);return j<=_.lookahead?j:_.lookahead}function Te(_){var X,G,T,k,z,j,Q,U,oe,ce,le=_.w_size;do{if(k=_.window_size-_.lookahead-_.strstart,_.strstart>=le+(le-ae)){for(s.arraySet(_.window,_.window,le,le,0),_.match_start-=le,_.strstart-=le,_.block_start-=le,X=G=_.hash_size;T=_.head[--X],_.head[X]=le<=T?T-le:0,--G;);for(X=G=le;T=_.prev[--X],_.prev[X]=le<=T?T-le:0,--G;);k+=le}if(_.strm.avail_in===0)break;if(j=_.strm,Q=_.window,U=_.strstart+_.lookahead,oe=k,ce=void 0,ce=j.avail_in,oe<ce&&(ce=oe),G=ce===0?0:(j.avail_in-=ce,s.arraySet(Q,j.input,j.next_in,ce,U),j.state.wrap===1?j.adler=l(j.adler,Q,ce,U):j.state.wrap===2&&(j.adler=u(j.adler,Q,ce,U)),j.next_in+=ce,j.total_in+=ce,ce),_.lookahead+=G,_.lookahead+_.insert>=H)for(z=_.strstart-_.insert,_.ins_h=_.window[z],_.ins_h=(_.ins_h<<_.hash_shift^_.window[z+1])&_.hash_mask;_.insert&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[z+H-1])&_.hash_mask,_.prev[z&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=z,z++,_.insert--,!(_.lookahead+_.insert<H)););}while(_.lookahead<ae&&_.strm.avail_in!==0)}function Ne(_,X){for(var G,T;;){if(_.lookahead<ae){if(Te(_),_.lookahead<ae&&X===c)return v;if(_.lookahead===0)break}if(G=0,_.lookahead>=H&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+H-1])&_.hash_mask,G=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart),G!==0&&_.strstart-G<=_.w_size-ae&&(_.match_length=ee(_,G)),_.match_length>=H)if(T=o._tr_tally(_,_.strstart-_.match_start,_.match_length-H),_.lookahead-=_.match_length,_.match_length<=_.max_lazy_match&&_.lookahead>=H){for(_.match_length--;_.strstart++,_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+H-1])&_.hash_mask,G=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart,--_.match_length!=0;);_.strstart++}else _.strstart+=_.match_length,_.match_length=0,_.ins_h=_.window[_.strstart],_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+1])&_.hash_mask;else T=o._tr_tally(_,0,_.window[_.strstart]),_.lookahead--,_.strstart++;if(T&&(R(_,!1),_.strm.avail_out===0))return v}return _.insert=_.strstart<H-1?_.strstart:H-1,X===d?(R(_,!0),_.strm.avail_out===0?$:L):_.last_lit&&(R(_,!1),_.strm.avail_out===0)?v:S}function ve(_,X){for(var G,T,k;;){if(_.lookahead<ae){if(Te(_),_.lookahead<ae&&X===c)return v;if(_.lookahead===0)break}if(G=0,_.lookahead>=H&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+H-1])&_.hash_mask,G=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart),_.prev_length=_.match_length,_.prev_match=_.match_start,_.match_length=H-1,G!==0&&_.prev_length<_.max_lazy_match&&_.strstart-G<=_.w_size-ae&&(_.match_length=ee(_,G),_.match_length<=5&&(_.strategy===1||_.match_length===H&&4096<_.strstart-_.match_start)&&(_.match_length=H-1)),_.prev_length>=H&&_.match_length<=_.prev_length){for(k=_.strstart+_.lookahead-H,T=o._tr_tally(_,_.strstart-1-_.prev_match,_.prev_length-H),_.lookahead-=_.prev_length-1,_.prev_length-=2;++_.strstart<=k&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+H-1])&_.hash_mask,G=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart),--_.prev_length!=0;);if(_.match_available=0,_.match_length=H-1,_.strstart++,T&&(R(_,!1),_.strm.avail_out===0))return v}else if(_.match_available){if((T=o._tr_tally(_,0,_.window[_.strstart-1]))&&R(_,!1),_.strstart++,_.lookahead--,_.strm.avail_out===0)return v}else _.match_available=1,_.strstart++,_.lookahead--}return _.match_available&&(T=o._tr_tally(_,0,_.window[_.strstart-1]),_.match_available=0),_.insert=_.strstart<H-1?_.strstart:H-1,X===d?(R(_,!0),_.strm.avail_out===0?$:L):_.last_lit&&(R(_,!1),_.strm.avail_out===0)?v:S}function be(_,X,G,T,k){this.good_length=_,this.max_lazy=X,this.nice_length=G,this.max_chain=T,this.func=k}function Le(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=x,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*D),this.dyn_dtree=new s.Buf16(2*(2*C+1)),this.bl_tree=new s.Buf16(2*(2*B+1)),J(this.dyn_ltree),J(this.dyn_dtree),J(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(O+1),this.heap=new s.Buf16(2*E+1),J(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*E+1),J(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Be(_){var X;return _&&_.state?(_.total_in=_.total_out=0,_.data_type=b,(X=_.state).pending=0,X.pending_out=0,X.wrap<0&&(X.wrap=-X.wrap),X.status=X.wrap?M:P,_.adler=X.wrap===2?0:1,X.last_flush=c,o._tr_init(X),h):W(_,p)}function at(_){var X=Be(_);return X===h&&function(G){G.window_size=2*G.w_size,J(G.head),G.max_lazy_match=r[G.level].max_lazy,G.good_match=r[G.level].good_length,G.nice_match=r[G.level].nice_length,G.max_chain_length=r[G.level].max_chain,G.strstart=0,G.block_start=0,G.lookahead=0,G.insert=0,G.match_length=G.prev_length=H-1,G.match_available=0,G.ins_h=0}(_.state),X}function rt(_,X,G,T,k,z){if(!_)return p;var j=1;if(X===m&&(X=6),T<0?(j=0,T=-T):15<T&&(j=2,T-=16),k<1||w<k||G!==x||T<8||15<T||X<0||9<X||z<0||g<z)return W(_,p);T===8&&(T=9);var Q=new Le;return(_.state=Q).strm=_,Q.wrap=j,Q.gzhead=null,Q.w_bits=T,Q.w_size=1<<Q.w_bits,Q.w_mask=Q.w_size-1,Q.hash_bits=k+7,Q.hash_size=1<<Q.hash_bits,Q.hash_mask=Q.hash_size-1,Q.hash_shift=~~((Q.hash_bits+H-1)/H),Q.window=new s.Buf8(2*Q.w_size),Q.head=new s.Buf16(Q.hash_size),Q.prev=new s.Buf16(Q.w_size),Q.lit_bufsize=1<<k+6,Q.pending_buf_size=4*Q.lit_bufsize,Q.pending_buf=new s.Buf8(Q.pending_buf_size),Q.d_buf=1*Q.lit_bufsize,Q.l_buf=3*Q.lit_bufsize,Q.level=X,Q.strategy=z,Q.method=G,at(_)}r=[new be(0,0,0,0,function(_,X){var G=65535;for(G>_.pending_buf_size-5&&(G=_.pending_buf_size-5);;){if(_.lookahead<=1){if(Te(_),_.lookahead===0&&X===c)return v;if(_.lookahead===0)break}_.strstart+=_.lookahead,_.lookahead=0;var T=_.block_start+G;if((_.strstart===0||_.strstart>=T)&&(_.lookahead=_.strstart-T,_.strstart=T,R(_,!1),_.strm.avail_out===0)||_.strstart-_.block_start>=_.w_size-ae&&(R(_,!1),_.strm.avail_out===0))return v}return _.insert=0,X===d?(R(_,!0),_.strm.avail_out===0?$:L):(_.strstart>_.block_start&&(R(_,!1),_.strm.avail_out),v)}),new be(4,4,8,4,Ne),new be(4,5,16,8,Ne),new be(4,6,32,32,Ne),new be(4,4,16,16,ve),new be(8,16,32,32,ve),new be(8,16,128,128,ve),new be(8,32,128,256,ve),new be(32,128,258,1024,ve),new be(32,258,258,4096,ve)],a.deflateInit=function(_,X){return rt(_,X,x,15,8,0)},a.deflateInit2=rt,a.deflateReset=at,a.deflateResetKeep=Be,a.deflateSetHeader=function(_,X){return _&&_.state?_.state.wrap!==2?p:(_.state.gzhead=X,h):p},a.deflate=function(_,X){var G,T,k,z;if(!_||!_.state||5<X||X<0)return _?W(_,p):p;if(T=_.state,!_.output||!_.input&&_.avail_in!==0||T.status===666&&X!==d)return W(_,_.avail_out===0?-5:p);if(T.strm=_,G=T.last_flush,T.last_flush=X,T.status===M)if(T.wrap===2)_.adler=0,ne(T,31),ne(T,139),ne(T,8),T.gzhead?(ne(T,(T.gzhead.text?1:0)+(T.gzhead.hcrc?2:0)+(T.gzhead.extra?4:0)+(T.gzhead.name?8:0)+(T.gzhead.comment?16:0)),ne(T,255&T.gzhead.time),ne(T,T.gzhead.time>>8&255),ne(T,T.gzhead.time>>16&255),ne(T,T.gzhead.time>>24&255),ne(T,T.level===9?2:2<=T.strategy||T.level<2?4:0),ne(T,255&T.gzhead.os),T.gzhead.extra&&T.gzhead.extra.length&&(ne(T,255&T.gzhead.extra.length),ne(T,T.gzhead.extra.length>>8&255)),T.gzhead.hcrc&&(_.adler=u(_.adler,T.pending_buf,T.pending,0)),T.gzindex=0,T.status=69):(ne(T,0),ne(T,0),ne(T,0),ne(T,0),ne(T,0),ne(T,T.level===9?2:2<=T.strategy||T.level<2?4:0),ne(T,3),T.status=P);else{var j=x+(T.w_bits-8<<4)<<8;j|=(2<=T.strategy||T.level<2?0:T.level<6?1:T.level===6?2:3)<<6,T.strstart!==0&&(j|=32),j+=31-j%31,T.status=P,ie(T,j),T.strstart!==0&&(ie(T,_.adler>>>16),ie(T,65535&_.adler)),_.adler=1}if(T.status===69)if(T.gzhead.extra){for(k=T.pending;T.gzindex<(65535&T.gzhead.extra.length)&&(T.pending!==T.pending_buf_size||(T.gzhead.hcrc&&T.pending>k&&(_.adler=u(_.adler,T.pending_buf,T.pending-k,k)),N(_),k=T.pending,T.pending!==T.pending_buf_size));)ne(T,255&T.gzhead.extra[T.gzindex]),T.gzindex++;T.gzhead.hcrc&&T.pending>k&&(_.adler=u(_.adler,T.pending_buf,T.pending-k,k)),T.gzindex===T.gzhead.extra.length&&(T.gzindex=0,T.status=73)}else T.status=73;if(T.status===73)if(T.gzhead.name){k=T.pending;do{if(T.pending===T.pending_buf_size&&(T.gzhead.hcrc&&T.pending>k&&(_.adler=u(_.adler,T.pending_buf,T.pending-k,k)),N(_),k=T.pending,T.pending===T.pending_buf_size)){z=1;break}z=T.gzindex<T.gzhead.name.length?255&T.gzhead.name.charCodeAt(T.gzindex++):0,ne(T,z)}while(z!==0);T.gzhead.hcrc&&T.pending>k&&(_.adler=u(_.adler,T.pending_buf,T.pending-k,k)),z===0&&(T.gzindex=0,T.status=91)}else T.status=91;if(T.status===91)if(T.gzhead.comment){k=T.pending;do{if(T.pending===T.pending_buf_size&&(T.gzhead.hcrc&&T.pending>k&&(_.adler=u(_.adler,T.pending_buf,T.pending-k,k)),N(_),k=T.pending,T.pending===T.pending_buf_size)){z=1;break}z=T.gzindex<T.gzhead.comment.length?255&T.gzhead.comment.charCodeAt(T.gzindex++):0,ne(T,z)}while(z!==0);T.gzhead.hcrc&&T.pending>k&&(_.adler=u(_.adler,T.pending_buf,T.pending-k,k)),z===0&&(T.status=103)}else T.status=103;if(T.status===103&&(T.gzhead.hcrc?(T.pending+2>T.pending_buf_size&&N(_),T.pending+2<=T.pending_buf_size&&(ne(T,255&_.adler),ne(T,_.adler>>8&255),_.adler=0,T.status=P)):T.status=P),T.pending!==0){if(N(_),_.avail_out===0)return T.last_flush=-1,h}else if(_.avail_in===0&&V(X)<=V(G)&&X!==d)return W(_,-5);if(T.status===666&&_.avail_in!==0)return W(_,-5);if(_.avail_in!==0||T.lookahead!==0||X!==c&&T.status!==666){var Q=T.strategy===2?function(U,oe){for(var ce;;){if(U.lookahead===0&&(Te(U),U.lookahead===0)){if(oe===c)return v;break}if(U.match_length=0,ce=o._tr_tally(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++,ce&&(R(U,!1),U.strm.avail_out===0))return v}return U.insert=0,oe===d?(R(U,!0),U.strm.avail_out===0?$:L):U.last_lit&&(R(U,!1),U.strm.avail_out===0)?v:S}(T,X):T.strategy===3?function(U,oe){for(var ce,le,ge,qe,De=U.window;;){if(U.lookahead<=Y){if(Te(U),U.lookahead<=Y&&oe===c)return v;if(U.lookahead===0)break}if(U.match_length=0,U.lookahead>=H&&0<U.strstart&&(le=De[ge=U.strstart-1])===De[++ge]&&le===De[++ge]&&le===De[++ge]){qe=U.strstart+Y;do;while(le===De[++ge]&&le===De[++ge]&&le===De[++ge]&&le===De[++ge]&&le===De[++ge]&&le===De[++ge]&&le===De[++ge]&&le===De[++ge]&&ge<qe);U.match_length=Y-(qe-ge),U.match_length>U.lookahead&&(U.match_length=U.lookahead)}if(U.match_length>=H?(ce=o._tr_tally(U,1,U.match_length-H),U.lookahead-=U.match_length,U.strstart+=U.match_length,U.match_length=0):(ce=o._tr_tally(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++),ce&&(R(U,!1),U.strm.avail_out===0))return v}return U.insert=0,oe===d?(R(U,!0),U.strm.avail_out===0?$:L):U.last_lit&&(R(U,!1),U.strm.avail_out===0)?v:S}(T,X):r[T.level].func(T,X);if(Q!==$&&Q!==L||(T.status=666),Q===v||Q===$)return _.avail_out===0&&(T.last_flush=-1),h;if(Q===S&&(X===1?o._tr_align(T):X!==5&&(o._tr_stored_block(T,0,0,!1),X===3&&(J(T.head),T.lookahead===0&&(T.strstart=0,T.block_start=0,T.insert=0))),N(_),_.avail_out===0))return T.last_flush=-1,h}return X!==d?h:T.wrap<=0?1:(T.wrap===2?(ne(T,255&_.adler),ne(T,_.adler>>8&255),ne(T,_.adler>>16&255),ne(T,_.adler>>24&255),ne(T,255&_.total_in),ne(T,_.total_in>>8&255),ne(T,_.total_in>>16&255),ne(T,_.total_in>>24&255)):(ie(T,_.adler>>>16),ie(T,65535&_.adler)),N(_),0<T.wrap&&(T.wrap=-T.wrap),T.pending!==0?h:1)},a.deflateEnd=function(_){var X;return _&&_.state?(X=_.state.status)!==M&&X!==69&&X!==73&&X!==91&&X!==103&&X!==P&&X!==666?W(_,p):(_.state=null,X===P?W(_,-3):h):p},a.deflateSetDictionary=function(_,X){var G,T,k,z,j,Q,U,oe,ce=X.length;if(!_||!_.state||(z=(G=_.state).wrap)===2||z===1&&G.status!==M||G.lookahead)return p;for(z===1&&(_.adler=l(_.adler,X,ce,0)),G.wrap=0,ce>=G.w_size&&(z===0&&(J(G.head),G.strstart=0,G.block_start=0,G.insert=0),oe=new s.Buf8(G.w_size),s.arraySet(oe,X,ce-G.w_size,G.w_size,0),X=oe,ce=G.w_size),j=_.avail_in,Q=_.next_in,U=_.input,_.avail_in=ce,_.next_in=0,_.input=X,Te(G);G.lookahead>=H;){for(T=G.strstart,k=G.lookahead-(H-1);G.ins_h=(G.ins_h<<G.hash_shift^G.window[T+H-1])&G.hash_mask,G.prev[T&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=T,T++,--k;);G.strstart=T,G.lookahead=H-1,Te(G)}return G.strstart+=G.lookahead,G.block_start=G.strstart,G.insert=G.lookahead,G.lookahead=0,G.match_length=G.prev_length=H-1,G.match_available=0,_.next_in=Q,_.input=U,_.avail_in=j,G.wrap=z,h},a.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,n,a){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,n,a){n.exports=function(r,s){var o,l,u,f,c,d,h,p,m,g,b,x,w,E,C,B,D,O,H,Y,ae,M,P,v,S;o=r.state,l=r.next_in,v=r.input,u=l+(r.avail_in-5),f=r.next_out,S=r.output,c=f-(s-r.avail_out),d=f+(r.avail_out-257),h=o.dmax,p=o.wsize,m=o.whave,g=o.wnext,b=o.window,x=o.hold,w=o.bits,E=o.lencode,C=o.distcode,B=(1<<o.lenbits)-1,D=(1<<o.distbits)-1;e:do{w<15&&(x+=v[l++]<<w,w+=8,x+=v[l++]<<w,w+=8),O=E[x&B];t:for(;;){if(x>>>=H=O>>>24,w-=H,(H=O>>>16&255)===0)S[f++]=65535&O;else{if(!(16&H)){if((64&H)==0){O=E[(65535&O)+(x&(1<<H)-1)];continue t}if(32&H){o.mode=12;break e}r.msg="invalid literal/length code",o.mode=30;break e}Y=65535&O,(H&=15)&&(w<H&&(x+=v[l++]<<w,w+=8),Y+=x&(1<<H)-1,x>>>=H,w-=H),w<15&&(x+=v[l++]<<w,w+=8,x+=v[l++]<<w,w+=8),O=C[x&D];i:for(;;){if(x>>>=H=O>>>24,w-=H,!(16&(H=O>>>16&255))){if((64&H)==0){O=C[(65535&O)+(x&(1<<H)-1)];continue i}r.msg="invalid distance code",o.mode=30;break e}if(ae=65535&O,w<(H&=15)&&(x+=v[l++]<<w,(w+=8)<H&&(x+=v[l++]<<w,w+=8)),h<(ae+=x&(1<<H)-1)){r.msg="invalid distance too far back",o.mode=30;break e}if(x>>>=H,w-=H,(H=f-c)<ae){if(m<(H=ae-H)&&o.sane){r.msg="invalid distance too far back",o.mode=30;break e}if(P=b,(M=0)===g){if(M+=p-H,H<Y){for(Y-=H;S[f++]=b[M++],--H;);M=f-ae,P=S}}else if(g<H){if(M+=p+g-H,(H-=g)<Y){for(Y-=H;S[f++]=b[M++],--H;);if(M=0,g<Y){for(Y-=H=g;S[f++]=b[M++],--H;);M=f-ae,P=S}}}else if(M+=g-H,H<Y){for(Y-=H;S[f++]=b[M++],--H;);M=f-ae,P=S}for(;2<Y;)S[f++]=P[M++],S[f++]=P[M++],S[f++]=P[M++],Y-=3;Y&&(S[f++]=P[M++],1<Y&&(S[f++]=P[M++]))}else{for(M=f-ae;S[f++]=S[M++],S[f++]=S[M++],S[f++]=S[M++],2<(Y-=3););Y&&(S[f++]=S[M++],1<Y&&(S[f++]=S[M++]))}break}}break}}while(l<u&&f<d);l-=Y=w>>3,x&=(1<<(w-=Y<<3))-1,r.next_in=l,r.next_out=f,r.avail_in=l<u?u-l+5:5-(l-u),r.avail_out=f<d?d-f+257:257-(f-d),o.hold=x,o.bits=w}},{}],49:[function(t,n,a){var r=t("../utils/common"),s=t("./adler32"),o=t("./crc32"),l=t("./inffast"),u=t("./inftrees"),f=1,c=2,d=0,h=-2,p=1,m=852,g=592;function b(M){return(M>>>24&255)+(M>>>8&65280)+((65280&M)<<8)+((255&M)<<24)}function x(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function w(M){var P;return M&&M.state?(P=M.state,M.total_in=M.total_out=P.total=0,M.msg="",P.wrap&&(M.adler=1&P.wrap),P.mode=p,P.last=0,P.havedict=0,P.dmax=32768,P.head=null,P.hold=0,P.bits=0,P.lencode=P.lendyn=new r.Buf32(m),P.distcode=P.distdyn=new r.Buf32(g),P.sane=1,P.back=-1,d):h}function E(M){var P;return M&&M.state?((P=M.state).wsize=0,P.whave=0,P.wnext=0,w(M)):h}function C(M,P){var v,S;return M&&M.state?(S=M.state,P<0?(v=0,P=-P):(v=1+(P>>4),P<48&&(P&=15)),P&&(P<8||15<P)?h:(S.window!==null&&S.wbits!==P&&(S.window=null),S.wrap=v,S.wbits=P,E(M))):h}function B(M,P){var v,S;return M?(S=new x,(M.state=S).window=null,(v=C(M,P))!==d&&(M.state=null),v):h}var D,O,H=!0;function Y(M){if(H){var P;for(D=new r.Buf32(512),O=new r.Buf32(32),P=0;P<144;)M.lens[P++]=8;for(;P<256;)M.lens[P++]=9;for(;P<280;)M.lens[P++]=7;for(;P<288;)M.lens[P++]=8;for(u(f,M.lens,0,288,D,0,M.work,{bits:9}),P=0;P<32;)M.lens[P++]=5;u(c,M.lens,0,32,O,0,M.work,{bits:5}),H=!1}M.lencode=D,M.lenbits=9,M.distcode=O,M.distbits=5}function ae(M,P,v,S){var $,L=M.state;return L.window===null&&(L.wsize=1<<L.wbits,L.wnext=0,L.whave=0,L.window=new r.Buf8(L.wsize)),S>=L.wsize?(r.arraySet(L.window,P,v-L.wsize,L.wsize,0),L.wnext=0,L.whave=L.wsize):(S<($=L.wsize-L.wnext)&&($=S),r.arraySet(L.window,P,v-S,$,L.wnext),(S-=$)?(r.arraySet(L.window,P,v-S,S,0),L.wnext=S,L.whave=L.wsize):(L.wnext+=$,L.wnext===L.wsize&&(L.wnext=0),L.whave<L.wsize&&(L.whave+=$))),0}a.inflateReset=E,a.inflateReset2=C,a.inflateResetKeep=w,a.inflateInit=function(M){return B(M,15)},a.inflateInit2=B,a.inflate=function(M,P){var v,S,$,L,W,V,J,N,R,ne,ie,ee,Te,Ne,ve,be,Le,Be,at,rt,_,X,G,T,k=0,z=new r.Buf8(4),j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!M||!M.state||!M.output||!M.input&&M.avail_in!==0)return h;(v=M.state).mode===12&&(v.mode=13),W=M.next_out,$=M.output,J=M.avail_out,L=M.next_in,S=M.input,V=M.avail_in,N=v.hold,R=v.bits,ne=V,ie=J,X=d;e:for(;;)switch(v.mode){case p:if(v.wrap===0){v.mode=13;break}for(;R<16;){if(V===0)break e;V--,N+=S[L++]<<R,R+=8}if(2&v.wrap&&N===35615){z[v.check=0]=255&N,z[1]=N>>>8&255,v.check=o(v.check,z,2,0),R=N=0,v.mode=2;break}if(v.flags=0,v.head&&(v.head.done=!1),!(1&v.wrap)||(((255&N)<<8)+(N>>8))%31){M.msg="incorrect header check",v.mode=30;break}if((15&N)!=8){M.msg="unknown compression method",v.mode=30;break}if(R-=4,_=8+(15&(N>>>=4)),v.wbits===0)v.wbits=_;else if(_>v.wbits){M.msg="invalid window size",v.mode=30;break}v.dmax=1<<_,M.adler=v.check=1,v.mode=512&N?10:12,R=N=0;break;case 2:for(;R<16;){if(V===0)break e;V--,N+=S[L++]<<R,R+=8}if(v.flags=N,(255&v.flags)!=8){M.msg="unknown compression method",v.mode=30;break}if(57344&v.flags){M.msg="unknown header flags set",v.mode=30;break}v.head&&(v.head.text=N>>8&1),512&v.flags&&(z[0]=255&N,z[1]=N>>>8&255,v.check=o(v.check,z,2,0)),R=N=0,v.mode=3;case 3:for(;R<32;){if(V===0)break e;V--,N+=S[L++]<<R,R+=8}v.head&&(v.head.time=N),512&v.flags&&(z[0]=255&N,z[1]=N>>>8&255,z[2]=N>>>16&255,z[3]=N>>>24&255,v.check=o(v.check,z,4,0)),R=N=0,v.mode=4;case 4:for(;R<16;){if(V===0)break e;V--,N+=S[L++]<<R,R+=8}v.head&&(v.head.xflags=255&N,v.head.os=N>>8),512&v.flags&&(z[0]=255&N,z[1]=N>>>8&255,v.check=o(v.check,z,2,0)),R=N=0,v.mode=5;case 5:if(1024&v.flags){for(;R<16;){if(V===0)break e;V--,N+=S[L++]<<R,R+=8}v.length=N,v.head&&(v.head.extra_len=N),512&v.flags&&(z[0]=255&N,z[1]=N>>>8&255,v.check=o(v.check,z,2,0)),R=N=0}else v.head&&(v.head.extra=null);v.mode=6;case 6:if(1024&v.flags&&(V<(ee=v.length)&&(ee=V),ee&&(v.head&&(_=v.head.extra_len-v.length,v.head.extra||(v.head.extra=new Array(v.head.extra_len)),r.arraySet(v.head.extra,S,L,ee,_)),512&v.flags&&(v.check=o(v.check,S,ee,L)),V-=ee,L+=ee,v.length-=ee),v.length))break e;v.length=0,v.mode=7;case 7:if(2048&v.flags){if(V===0)break e;for(ee=0;_=S[L+ee++],v.head&&_&&v.length<65536&&(v.head.name+=String.fromCharCode(_)),_&&ee<V;);if(512&v.flags&&(v.check=o(v.check,S,ee,L)),V-=ee,L+=ee,_)break e}else v.head&&(v.head.name=null);v.length=0,v.mode=8;case 8:if(4096&v.flags){if(V===0)break e;for(ee=0;_=S[L+ee++],v.head&&_&&v.length<65536&&(v.head.comment+=String.fromCharCode(_)),_&&ee<V;);if(512&v.flags&&(v.check=o(v.check,S,ee,L)),V-=ee,L+=ee,_)break e}else v.head&&(v.head.comment=null);v.mode=9;case 9:if(512&v.flags){for(;R<16;){if(V===0)break e;V--,N+=S[L++]<<R,R+=8}if(N!==(65535&v.check)){M.msg="header crc mismatch",v.mode=30;break}R=N=0}v.head&&(v.head.hcrc=v.flags>>9&1,v.head.done=!0),M.adler=v.check=0,v.mode=12;break;case 10:for(;R<32;){if(V===0)break e;V--,N+=S[L++]<<R,R+=8}M.adler=v.check=b(N),R=N=0,v.mode=11;case 11:if(v.havedict===0)return M.next_out=W,M.avail_out=J,M.next_in=L,M.avail_in=V,v.hold=N,v.bits=R,2;M.adler=v.check=1,v.mode=12;case 12:if(P===5||P===6)break e;case 13:if(v.last){N>>>=7&R,R-=7&R,v.mode=27;break}for(;R<3;){if(V===0)break e;V--,N+=S[L++]<<R,R+=8}switch(v.last=1&N,R-=1,3&(N>>>=1)){case 0:v.mode=14;break;case 1:if(Y(v),v.mode=20,P!==6)break;N>>>=2,R-=2;break e;case 2:v.mode=17;break;case 3:M.msg="invalid block type",v.mode=30}N>>>=2,R-=2;break;case 14:for(N>>>=7&R,R-=7&R;R<32;){if(V===0)break e;V--,N+=S[L++]<<R,R+=8}if((65535&N)!=(N>>>16^65535)){M.msg="invalid stored block lengths",v.mode=30;break}if(v.length=65535&N,R=N=0,v.mode=15,P===6)break e;case 15:v.mode=16;case 16:if(ee=v.length){if(V<ee&&(ee=V),J<ee&&(ee=J),ee===0)break e;r.arraySet($,S,L,ee,W),V-=ee,L+=ee,J-=ee,W+=ee,v.length-=ee;break}v.mode=12;break;case 17:for(;R<14;){if(V===0)break e;V--,N+=S[L++]<<R,R+=8}if(v.nlen=257+(31&N),N>>>=5,R-=5,v.ndist=1+(31&N),N>>>=5,R-=5,v.ncode=4+(15&N),N>>>=4,R-=4,286<v.nlen||30<v.ndist){M.msg="too many length or distance symbols",v.mode=30;break}v.have=0,v.mode=18;case 18:for(;v.have<v.ncode;){for(;R<3;){if(V===0)break e;V--,N+=S[L++]<<R,R+=8}v.lens[j[v.have++]]=7&N,N>>>=3,R-=3}for(;v.have<19;)v.lens[j[v.have++]]=0;if(v.lencode=v.lendyn,v.lenbits=7,G={bits:v.lenbits},X=u(0,v.lens,0,19,v.lencode,0,v.work,G),v.lenbits=G.bits,X){M.msg="invalid code lengths set",v.mode=30;break}v.have=0,v.mode=19;case 19:for(;v.have<v.nlen+v.ndist;){for(;be=(k=v.lencode[N&(1<<v.lenbits)-1])>>>16&255,Le=65535&k,!((ve=k>>>24)<=R);){if(V===0)break e;V--,N+=S[L++]<<R,R+=8}if(Le<16)N>>>=ve,R-=ve,v.lens[v.have++]=Le;else{if(Le===16){for(T=ve+2;R<T;){if(V===0)break e;V--,N+=S[L++]<<R,R+=8}if(N>>>=ve,R-=ve,v.have===0){M.msg="invalid bit length repeat",v.mode=30;break}_=v.lens[v.have-1],ee=3+(3&N),N>>>=2,R-=2}else if(Le===17){for(T=ve+3;R<T;){if(V===0)break e;V--,N+=S[L++]<<R,R+=8}R-=ve,_=0,ee=3+(7&(N>>>=ve)),N>>>=3,R-=3}else{for(T=ve+7;R<T;){if(V===0)break e;V--,N+=S[L++]<<R,R+=8}R-=ve,_=0,ee=11+(127&(N>>>=ve)),N>>>=7,R-=7}if(v.have+ee>v.nlen+v.ndist){M.msg="invalid bit length repeat",v.mode=30;break}for(;ee--;)v.lens[v.have++]=_}}if(v.mode===30)break;if(v.lens[256]===0){M.msg="invalid code -- missing end-of-block",v.mode=30;break}if(v.lenbits=9,G={bits:v.lenbits},X=u(f,v.lens,0,v.nlen,v.lencode,0,v.work,G),v.lenbits=G.bits,X){M.msg="invalid literal/lengths set",v.mode=30;break}if(v.distbits=6,v.distcode=v.distdyn,G={bits:v.distbits},X=u(c,v.lens,v.nlen,v.ndist,v.distcode,0,v.work,G),v.distbits=G.bits,X){M.msg="invalid distances set",v.mode=30;break}if(v.mode=20,P===6)break e;case 20:v.mode=21;case 21:if(6<=V&&258<=J){M.next_out=W,M.avail_out=J,M.next_in=L,M.avail_in=V,v.hold=N,v.bits=R,l(M,ie),W=M.next_out,$=M.output,J=M.avail_out,L=M.next_in,S=M.input,V=M.avail_in,N=v.hold,R=v.bits,v.mode===12&&(v.back=-1);break}for(v.back=0;be=(k=v.lencode[N&(1<<v.lenbits)-1])>>>16&255,Le=65535&k,!((ve=k>>>24)<=R);){if(V===0)break e;V--,N+=S[L++]<<R,R+=8}if(be&&(240&be)==0){for(Be=ve,at=be,rt=Le;be=(k=v.lencode[rt+((N&(1<<Be+at)-1)>>Be)])>>>16&255,Le=65535&k,!(Be+(ve=k>>>24)<=R);){if(V===0)break e;V--,N+=S[L++]<<R,R+=8}N>>>=Be,R-=Be,v.back+=Be}if(N>>>=ve,R-=ve,v.back+=ve,v.length=Le,be===0){v.mode=26;break}if(32&be){v.back=-1,v.mode=12;break}if(64&be){M.msg="invalid literal/length code",v.mode=30;break}v.extra=15&be,v.mode=22;case 22:if(v.extra){for(T=v.extra;R<T;){if(V===0)break e;V--,N+=S[L++]<<R,R+=8}v.length+=N&(1<<v.extra)-1,N>>>=v.extra,R-=v.extra,v.back+=v.extra}v.was=v.length,v.mode=23;case 23:for(;be=(k=v.distcode[N&(1<<v.distbits)-1])>>>16&255,Le=65535&k,!((ve=k>>>24)<=R);){if(V===0)break e;V--,N+=S[L++]<<R,R+=8}if((240&be)==0){for(Be=ve,at=be,rt=Le;be=(k=v.distcode[rt+((N&(1<<Be+at)-1)>>Be)])>>>16&255,Le=65535&k,!(Be+(ve=k>>>24)<=R);){if(V===0)break e;V--,N+=S[L++]<<R,R+=8}N>>>=Be,R-=Be,v.back+=Be}if(N>>>=ve,R-=ve,v.back+=ve,64&be){M.msg="invalid distance code",v.mode=30;break}v.offset=Le,v.extra=15&be,v.mode=24;case 24:if(v.extra){for(T=v.extra;R<T;){if(V===0)break e;V--,N+=S[L++]<<R,R+=8}v.offset+=N&(1<<v.extra)-1,N>>>=v.extra,R-=v.extra,v.back+=v.extra}if(v.offset>v.dmax){M.msg="invalid distance too far back",v.mode=30;break}v.mode=25;case 25:if(J===0)break e;if(ee=ie-J,v.offset>ee){if((ee=v.offset-ee)>v.whave&&v.sane){M.msg="invalid distance too far back",v.mode=30;break}Te=ee>v.wnext?(ee-=v.wnext,v.wsize-ee):v.wnext-ee,ee>v.length&&(ee=v.length),Ne=v.window}else Ne=$,Te=W-v.offset,ee=v.length;for(J<ee&&(ee=J),J-=ee,v.length-=ee;$[W++]=Ne[Te++],--ee;);v.length===0&&(v.mode=21);break;case 26:if(J===0)break e;$[W++]=v.length,J--,v.mode=21;break;case 27:if(v.wrap){for(;R<32;){if(V===0)break e;V--,N|=S[L++]<<R,R+=8}if(ie-=J,M.total_out+=ie,v.total+=ie,ie&&(M.adler=v.check=v.flags?o(v.check,$,ie,W-ie):s(v.check,$,ie,W-ie)),ie=J,(v.flags?N:b(N))!==v.check){M.msg="incorrect data check",v.mode=30;break}R=N=0}v.mode=28;case 28:if(v.wrap&&v.flags){for(;R<32;){if(V===0)break e;V--,N+=S[L++]<<R,R+=8}if(N!==(4294967295&v.total)){M.msg="incorrect length check",v.mode=30;break}R=N=0}v.mode=29;case 29:X=1;break e;case 30:X=-3;break e;case 31:return-4;case 32:default:return h}return M.next_out=W,M.avail_out=J,M.next_in=L,M.avail_in=V,v.hold=N,v.bits=R,(v.wsize||ie!==M.avail_out&&v.mode<30&&(v.mode<27||P!==4))&&ae(M,M.output,M.next_out,ie-M.avail_out)?(v.mode=31,-4):(ne-=M.avail_in,ie-=M.avail_out,M.total_in+=ne,M.total_out+=ie,v.total+=ie,v.wrap&&ie&&(M.adler=v.check=v.flags?o(v.check,$,ie,M.next_out-ie):s(v.check,$,ie,M.next_out-ie)),M.data_type=v.bits+(v.last?64:0)+(v.mode===12?128:0)+(v.mode===20||v.mode===15?256:0),(ne==0&&ie===0||P===4)&&X===d&&(X=-5),X)},a.inflateEnd=function(M){if(!M||!M.state)return h;var P=M.state;return P.window&&(P.window=null),M.state=null,d},a.inflateGetHeader=function(M,P){var v;return M&&M.state?(2&(v=M.state).wrap)==0?h:((v.head=P).done=!1,d):h},a.inflateSetDictionary=function(M,P){var v,S=P.length;return M&&M.state?(v=M.state).wrap!==0&&v.mode!==11?h:v.mode===11&&s(1,P,S,0)!==v.check?-3:ae(M,P,S,S)?(v.mode=31,-4):(v.havedict=1,d):h},a.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,n,a){var r=t("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(f,c,d,h,p,m,g,b){var x,w,E,C,B,D,O,H,Y,ae=b.bits,M=0,P=0,v=0,S=0,$=0,L=0,W=0,V=0,J=0,N=0,R=null,ne=0,ie=new r.Buf16(16),ee=new r.Buf16(16),Te=null,Ne=0;for(M=0;M<=15;M++)ie[M]=0;for(P=0;P<h;P++)ie[c[d+P]]++;for($=ae,S=15;1<=S&&ie[S]===0;S--);if(S<$&&($=S),S===0)return p[m++]=20971520,p[m++]=20971520,b.bits=1,0;for(v=1;v<S&&ie[v]===0;v++);for($<v&&($=v),M=V=1;M<=15;M++)if(V<<=1,(V-=ie[M])<0)return-1;if(0<V&&(f===0||S!==1))return-1;for(ee[1]=0,M=1;M<15;M++)ee[M+1]=ee[M]+ie[M];for(P=0;P<h;P++)c[d+P]!==0&&(g[ee[c[d+P]]++]=P);if(D=f===0?(R=Te=g,19):f===1?(R=s,ne-=257,Te=o,Ne-=257,256):(R=l,Te=u,-1),M=v,B=m,W=P=N=0,E=-1,C=(J=1<<(L=$))-1,f===1&&852<J||f===2&&592<J)return 1;for(;;){for(O=M-W,Y=g[P]<D?(H=0,g[P]):g[P]>D?(H=Te[Ne+g[P]],R[ne+g[P]]):(H=96,0),x=1<<M-W,v=w=1<<L;p[B+(N>>W)+(w-=x)]=O<<24|H<<16|Y|0,w!==0;);for(x=1<<M-1;N&x;)x>>=1;if(x!==0?(N&=x-1,N+=x):N=0,P++,--ie[M]==0){if(M===S)break;M=c[d+g[P]]}if($<M&&(N&C)!==E){for(W===0&&(W=$),B+=v,V=1<<(L=M-W);L+W<S&&!((V-=ie[L+W])<=0);)L++,V<<=1;if(J+=1<<L,f===1&&852<J||f===2&&592<J)return 1;p[E=N&C]=$<<24|L<<16|B-m|0}}return N!==0&&(p[B+N]=M-W<<24|64<<16|0),b.bits=$,0}},{"../utils/common":41}],51:[function(t,n,a){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,n,a){var r=t("../utils/common"),s=0,o=1;function l(k){for(var z=k.length;0<=--z;)k[z]=0}var u=0,f=29,c=256,d=c+1+f,h=30,p=19,m=2*d+1,g=15,b=16,x=7,w=256,E=16,C=17,B=18,D=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],O=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],H=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Y=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ae=new Array(2*(d+2));l(ae);var M=new Array(2*h);l(M);var P=new Array(512);l(P);var v=new Array(256);l(v);var S=new Array(f);l(S);var $,L,W,V=new Array(h);function J(k,z,j,Q,U){this.static_tree=k,this.extra_bits=z,this.extra_base=j,this.elems=Q,this.max_length=U,this.has_stree=k&&k.length}function N(k,z){this.dyn_tree=k,this.max_code=0,this.stat_desc=z}function R(k){return k<256?P[k]:P[256+(k>>>7)]}function ne(k,z){k.pending_buf[k.pending++]=255&z,k.pending_buf[k.pending++]=z>>>8&255}function ie(k,z,j){k.bi_valid>b-j?(k.bi_buf|=z<<k.bi_valid&65535,ne(k,k.bi_buf),k.bi_buf=z>>b-k.bi_valid,k.bi_valid+=j-b):(k.bi_buf|=z<<k.bi_valid&65535,k.bi_valid+=j)}function ee(k,z,j){ie(k,j[2*z],j[2*z+1])}function Te(k,z){for(var j=0;j|=1&k,k>>>=1,j<<=1,0<--z;);return j>>>1}function Ne(k,z,j){var Q,U,oe=new Array(g+1),ce=0;for(Q=1;Q<=g;Q++)oe[Q]=ce=ce+j[Q-1]<<1;for(U=0;U<=z;U++){var le=k[2*U+1];le!==0&&(k[2*U]=Te(oe[le]++,le))}}function ve(k){var z;for(z=0;z<d;z++)k.dyn_ltree[2*z]=0;for(z=0;z<h;z++)k.dyn_dtree[2*z]=0;for(z=0;z<p;z++)k.bl_tree[2*z]=0;k.dyn_ltree[2*w]=1,k.opt_len=k.static_len=0,k.last_lit=k.matches=0}function be(k){8<k.bi_valid?ne(k,k.bi_buf):0<k.bi_valid&&(k.pending_buf[k.pending++]=k.bi_buf),k.bi_buf=0,k.bi_valid=0}function Le(k,z,j,Q){var U=2*z,oe=2*j;return k[U]<k[oe]||k[U]===k[oe]&&Q[z]<=Q[j]}function Be(k,z,j){for(var Q=k.heap[j],U=j<<1;U<=k.heap_len&&(U<k.heap_len&&Le(z,k.heap[U+1],k.heap[U],k.depth)&&U++,!Le(z,Q,k.heap[U],k.depth));)k.heap[j]=k.heap[U],j=U,U<<=1;k.heap[j]=Q}function at(k,z,j){var Q,U,oe,ce,le=0;if(k.last_lit!==0)for(;Q=k.pending_buf[k.d_buf+2*le]<<8|k.pending_buf[k.d_buf+2*le+1],U=k.pending_buf[k.l_buf+le],le++,Q===0?ee(k,U,z):(ee(k,(oe=v[U])+c+1,z),(ce=D[oe])!==0&&ie(k,U-=S[oe],ce),ee(k,oe=R(--Q),j),(ce=O[oe])!==0&&ie(k,Q-=V[oe],ce)),le<k.last_lit;);ee(k,w,z)}function rt(k,z){var j,Q,U,oe=z.dyn_tree,ce=z.stat_desc.static_tree,le=z.stat_desc.has_stree,ge=z.stat_desc.elems,qe=-1;for(k.heap_len=0,k.heap_max=m,j=0;j<ge;j++)oe[2*j]!==0?(k.heap[++k.heap_len]=qe=j,k.depth[j]=0):oe[2*j+1]=0;for(;k.heap_len<2;)oe[2*(U=k.heap[++k.heap_len]=qe<2?++qe:0)]=1,k.depth[U]=0,k.opt_len--,le&&(k.static_len-=ce[2*U+1]);for(z.max_code=qe,j=k.heap_len>>1;1<=j;j--)Be(k,oe,j);for(U=ge;j=k.heap[1],k.heap[1]=k.heap[k.heap_len--],Be(k,oe,1),Q=k.heap[1],k.heap[--k.heap_max]=j,k.heap[--k.heap_max]=Q,oe[2*U]=oe[2*j]+oe[2*Q],k.depth[U]=(k.depth[j]>=k.depth[Q]?k.depth[j]:k.depth[Q])+1,oe[2*j+1]=oe[2*Q+1]=U,k.heap[1]=U++,Be(k,oe,1),2<=k.heap_len;);k.heap[--k.heap_max]=k.heap[1],function(De,xt){var At,Lt,A,I,te,Z,se=xt.dyn_tree,pe=xt.max_code,we=xt.stat_desc.static_tree,Pe=xt.stat_desc.has_stree,He=xt.stat_desc.extra_bits,Qe=xt.stat_desc.extra_base,je=xt.stat_desc.max_length,lt=0;for(I=0;I<=g;I++)De.bl_count[I]=0;for(se[2*De.heap[De.heap_max]+1]=0,At=De.heap_max+1;At<m;At++)je<(I=se[2*se[2*(Lt=De.heap[At])+1]+1]+1)&&(I=je,lt++),se[2*Lt+1]=I,pe<Lt||(De.bl_count[I]++,te=0,Qe<=Lt&&(te=He[Lt-Qe]),Z=se[2*Lt],De.opt_len+=Z*(I+te),Pe&&(De.static_len+=Z*(we[2*Lt+1]+te)));if(lt!==0){do{for(I=je-1;De.bl_count[I]===0;)I--;De.bl_count[I]--,De.bl_count[I+1]+=2,De.bl_count[je]--,lt-=2}while(0<lt);for(I=je;I!==0;I--)for(Lt=De.bl_count[I];Lt!==0;)pe<(A=De.heap[--At])||(se[2*A+1]!==I&&(De.opt_len+=(I-se[2*A+1])*se[2*A],se[2*A+1]=I),Lt--)}}(k,z),Ne(oe,qe,k.bl_count)}function _(k,z,j){var Q,U,oe=-1,ce=z[1],le=0,ge=7,qe=4;for(ce===0&&(ge=138,qe=3),z[2*(j+1)+1]=65535,Q=0;Q<=j;Q++)U=ce,ce=z[2*(Q+1)+1],++le<ge&&U===ce||(le<qe?k.bl_tree[2*U]+=le:U!==0?(U!==oe&&k.bl_tree[2*U]++,k.bl_tree[2*E]++):le<=10?k.bl_tree[2*C]++:k.bl_tree[2*B]++,oe=U,qe=(le=0)===ce?(ge=138,3):U===ce?(ge=6,3):(ge=7,4))}function X(k,z,j){var Q,U,oe=-1,ce=z[1],le=0,ge=7,qe=4;for(ce===0&&(ge=138,qe=3),Q=0;Q<=j;Q++)if(U=ce,ce=z[2*(Q+1)+1],!(++le<ge&&U===ce)){if(le<qe)for(;ee(k,U,k.bl_tree),--le!=0;);else U!==0?(U!==oe&&(ee(k,U,k.bl_tree),le--),ee(k,E,k.bl_tree),ie(k,le-3,2)):le<=10?(ee(k,C,k.bl_tree),ie(k,le-3,3)):(ee(k,B,k.bl_tree),ie(k,le-11,7));oe=U,qe=(le=0)===ce?(ge=138,3):U===ce?(ge=6,3):(ge=7,4)}}l(V);var G=!1;function T(k,z,j,Q){ie(k,(u<<1)+(Q?1:0),3),function(U,oe,ce,le){be(U),ne(U,ce),ne(U,~ce),r.arraySet(U.pending_buf,U.window,oe,ce,U.pending),U.pending+=ce}(k,z,j)}a._tr_init=function(k){G||(function(){var z,j,Q,U,oe,ce=new Array(g+1);for(U=Q=0;U<f-1;U++)for(S[U]=Q,z=0;z<1<<D[U];z++)v[Q++]=U;for(v[Q-1]=U,U=oe=0;U<16;U++)for(V[U]=oe,z=0;z<1<<O[U];z++)P[oe++]=U;for(oe>>=7;U<h;U++)for(V[U]=oe<<7,z=0;z<1<<O[U]-7;z++)P[256+oe++]=U;for(j=0;j<=g;j++)ce[j]=0;for(z=0;z<=143;)ae[2*z+1]=8,z++,ce[8]++;for(;z<=255;)ae[2*z+1]=9,z++,ce[9]++;for(;z<=279;)ae[2*z+1]=7,z++,ce[7]++;for(;z<=287;)ae[2*z+1]=8,z++,ce[8]++;for(Ne(ae,d+1,ce),z=0;z<h;z++)M[2*z+1]=5,M[2*z]=Te(z,5);$=new J(ae,D,c+1,d,g),L=new J(M,O,0,h,g),W=new J(new Array(0),H,0,p,x)}(),G=!0),k.l_desc=new N(k.dyn_ltree,$),k.d_desc=new N(k.dyn_dtree,L),k.bl_desc=new N(k.bl_tree,W),k.bi_buf=0,k.bi_valid=0,ve(k)},a._tr_stored_block=T,a._tr_flush_block=function(k,z,j,Q){var U,oe,ce=0;0<k.level?(k.strm.data_type===2&&(k.strm.data_type=function(le){var ge,qe=4093624447;for(ge=0;ge<=31;ge++,qe>>>=1)if(1&qe&&le.dyn_ltree[2*ge]!==0)return s;if(le.dyn_ltree[18]!==0||le.dyn_ltree[20]!==0||le.dyn_ltree[26]!==0)return o;for(ge=32;ge<c;ge++)if(le.dyn_ltree[2*ge]!==0)return o;return s}(k)),rt(k,k.l_desc),rt(k,k.d_desc),ce=function(le){var ge;for(_(le,le.dyn_ltree,le.l_desc.max_code),_(le,le.dyn_dtree,le.d_desc.max_code),rt(le,le.bl_desc),ge=p-1;3<=ge&&le.bl_tree[2*Y[ge]+1]===0;ge--);return le.opt_len+=3*(ge+1)+5+5+4,ge}(k),U=k.opt_len+3+7>>>3,(oe=k.static_len+3+7>>>3)<=U&&(U=oe)):U=oe=j+5,j+4<=U&&z!==-1?T(k,z,j,Q):k.strategy===4||oe===U?(ie(k,2+(Q?1:0),3),at(k,ae,M)):(ie(k,4+(Q?1:0),3),function(le,ge,qe,De){var xt;for(ie(le,ge-257,5),ie(le,qe-1,5),ie(le,De-4,4),xt=0;xt<De;xt++)ie(le,le.bl_tree[2*Y[xt]+1],3);X(le,le.dyn_ltree,ge-1),X(le,le.dyn_dtree,qe-1)}(k,k.l_desc.max_code+1,k.d_desc.max_code+1,ce+1),at(k,k.dyn_ltree,k.dyn_dtree)),ve(k),Q&&be(k)},a._tr_tally=function(k,z,j){return k.pending_buf[k.d_buf+2*k.last_lit]=z>>>8&255,k.pending_buf[k.d_buf+2*k.last_lit+1]=255&z,k.pending_buf[k.l_buf+k.last_lit]=255&j,k.last_lit++,z===0?k.dyn_ltree[2*j]++:(k.matches++,z--,k.dyn_ltree[2*(v[j]+c+1)]++,k.dyn_dtree[2*R(z)]++),k.last_lit===k.lit_bufsize-1},a._tr_align=function(k){ie(k,2,3),ee(k,w,ae),function(z){z.bi_valid===16?(ne(z,z.bi_buf),z.bi_buf=0,z.bi_valid=0):8<=z.bi_valid&&(z.pending_buf[z.pending++]=255&z.bi_buf,z.bi_buf>>=8,z.bi_valid-=8)}(k)}},{"../utils/common":41}],53:[function(t,n,a){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,n,a){(function(r){(function(s,o){if(!s.setImmediate){var l,u,f,c,d=1,h={},p=!1,m=s.document,g=Object.getPrototypeOf&&Object.getPrototypeOf(s);g=g&&g.setTimeout?g:s,l={}.toString.call(s.process)==="[object process]"?function(E){process.nextTick(function(){x(E)})}:function(){if(s.postMessage&&!s.importScripts){var E=!0,C=s.onmessage;return s.onmessage=function(){E=!1},s.postMessage("","*"),s.onmessage=C,E}}()?(c="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",w,!1):s.attachEvent("onmessage",w),function(E){s.postMessage(c+E,"*")}):s.MessageChannel?((f=new MessageChannel).port1.onmessage=function(E){x(E.data)},function(E){f.port2.postMessage(E)}):m&&"onreadystatechange"in m.createElement("script")?(u=m.documentElement,function(E){var C=m.createElement("script");C.onreadystatechange=function(){x(E),C.onreadystatechange=null,u.removeChild(C),C=null},u.appendChild(C)}):function(E){setTimeout(x,0,E)},g.setImmediate=function(E){typeof E!="function"&&(E=new Function(""+E));for(var C=new Array(arguments.length-1),B=0;B<C.length;B++)C[B]=arguments[B+1];var D={callback:E,args:C};return h[d]=D,l(d),d++},g.clearImmediate=b}function b(E){delete h[E]}function x(E){if(p)setTimeout(x,0,E);else{var C=h[E];if(C){p=!0;try{(function(B){var D=B.callback,O=B.args;switch(O.length){case 0:D();break;case 1:D(O[0]);break;case 2:D(O[0],O[1]);break;case 3:D(O[0],O[1],O[2]);break;default:D.apply(o,O)}})(C)}finally{b(E),p=!1}}}}function w(E){E.source===s&&typeof E.data=="string"&&E.data.indexOf(c)===0&&x(+E.data.slice(c.length))}})(typeof self>"u"?r===void 0?this:r:self)}).call(this,typeof gi<"u"?gi:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})}(us)),us.exports}var q0=G0();const j0=Jn(q0);class $0{static worker=new Worker(new URL("/smeditor/assets/SafariFileWorker-C6T6cial.js",import.meta.url),{type:"module"});static workID=0;static map=new Map;static{this.worker.onmessage=e=>{const t=e.data;t.success?this.map.get(t.id)[0]():this.map.get(t.id)[1](t.reason),this.map.delete(t.id)}}static async writeHandle(e,t){const n=this.workID++,a=new Promise((o,l)=>this.map.set(n,[o,l])),r=new TextEncoder,s=typeof t=="string"?r.encode(t).buffer:await t.arrayBuffer();return this.worker.postMessage([n,e,s],[s]),a}}class Y0{_root;async getRoot(){return this._root||(H0.adapter.native?await Zl().then(e=>this._root=e):await Zl(Ge(()=>import("./memory-BIfFwPK3.js"),__vite__mapDeps([0,1,2]))).then(e=>this._root=e)),this._root}async uploadHandle(e,t){let n;if(typeof t=="string"){const a=await this.getDirectoryHandle(t,{create:!0});if(!a)return;n=a}else n=t??await this.getRoot();if(e.kind=="file"){const a=await n.getFileHandle(e.name,{create:!0});await this.writeFile(a,await e.getFile())}else{const a=await n.getDirectoryHandle(e.name,{create:!0}),r=[];for await(const s of e.values())r.push(this.uploadHandle(s,a));await Promise.all(r)}}async uploadFiles(e,t){let n;if(typeof t=="string"){const a=await this.getDirectoryHandle(t,{create:!0});if(!a)return;n=a}else n=t??await this.getRoot();if(e.isFile){const a=e;if(a.name==".DS_Store")return;a.file(async r=>{const s=await n.getFileHandle(r.name,{create:!0});await this.writeHandle(s,r)})}else if(e.isDirectory){const a=e.createReader(),r=await n.getDirectoryHandle(e.name,{create:!0});for await(const s of r.values())await r.removeEntry(s.name,{recursive:!0});a.readEntries(async s=>{const o=[];for(let l=0;l<s.length;l++)o.push(this.uploadFiles(s[l],r));await Promise.all(o)})}}async handleDropEvent(e,t){e.stopPropagation(),e.preventDefault();const n=e.dataTransfer.items;if(!t){t="";for(let s=0;s<n.length;s++){const o=n[s].webkitGetAsEntry();if(o?.isFile&&(o.name.endsWith(".sm")||o.name.endsWith(".ssc"))){t="New Song";break}}}const a=[];for(let s=0;s<n.length;s++){const o=n[s].webkitGetAsEntry();o&&a.push(this.uploadFiles(o,t))}let r;return n.length==1&&n[0].webkitGetAsEntry().isDirectory&&(r=n[0].webkitGetAsEntry().name),await Promise.all(a),r}async uploadDir(e,t){let n;if(typeof t=="string"){const r=await this.getDirectoryHandle(t);if(!r)return;n=r}else n=t??await this.getRoot();const a=await n.getDirectoryHandle(e.name,{create:!0});for await(const r of e.values())if(r.kind=="file"){const s=await a.getFileHandle(r.name,{create:!0}),o=await r.getFile();await this.writeHandle(s,o)}else await this.uploadDir(r,a)}async getDirectoryHandle(e,t,n){if(n||=await this.getRoot(),e=this.resolvePath(...e.split("/")),e==""||e==".")return n;const a=e.split("/"),r=a.shift();try{const s=await n.getDirectoryHandle(r,t);return s?a.length==0?s:this.getDirectoryHandle(a.join("/"),t,s):void 0}catch(s){console.error(`Failed to get directory ${e} (${r}): `+s);return}}async hasFile(e){try{return await this.getFileHandle(e)!==void 0}catch{return!1}}async getFileHandle(e,t){try{const n=this.resolvePath(...e.split("/")).split("/"),a=n.pop(),r=await this.getDirectoryHandle(n.join("/"),t);return r?await r.getFileHandle(a,t):void 0}catch(n){console.error("Failed to get file "+e+": "+n);return}}async getFileHandleRelativeTo(e,t){try{return Tt(e)!=""&&(e=st(e)),this.getFileHandle(this.resolvePath(e,"/",t))}catch(n){console.error("Failed to get relative file "+t+": "+n);return}}async getDirectoryFiles(e){try{let t;if(typeof e=="string"){if(t=await this.getDirectoryHandle(e),!t)return[]}else t=e;const n=[];for await(const a of t.values())a.kind=="file"&&n.push(a);return n}catch(t){return console.error(t),[]}}async getDirectoryFolders(e){try{let t;if(typeof e=="string"){if(t=await this.getDirectoryHandle(e),!t)return[]}else t=e;const n=[];for await(const a of t.values())a.kind=="directory"&&n.push(a);return n}catch(t){return console.error(t),[]}}async writeFile(e,t){let n;if(typeof e=="string"){if(n=await this.getFileHandle(e,{create:!0}),!n){de.createFormatted("Failed to write to "+e+"!","error");return}}else n=e;await this.writeHandle(n,t)}async removeFile(e,t){try{const n=st(e),a=await this.getDirectoryHandle(n);if(!a)return;await a.removeEntry(kt(e),t)}catch(n){console.error(n);return}}async removeDirectory(e){return this.removeFile(e,{recursive:!0})}async remove(e){return Tt(e)==""?this.removeDirectory(e):this.removeFile(e)}resolvePath(...e){let t=e;for(t=t.filter(n=>n!="."&&n!="");t.indexOf("..")>-1;){const n=t.indexOf("..");if(n==0)throw Error("Path "+t.join("/")+" is invalid!");t.splice(n-1,2)}return t.join("/")}async zipDirectory(e,t){const n=t??new j0,a=Tt(e)==""?e:st(e),r=await this.getDirectoryHandle(a);if(r){for(const s of await this.getDirectoryFiles(r))n.file(s.name,await s.getFile());for(const s of await this.getDirectoryFolders(r)){const o=n.folder(s.name);if(!o){console.error("Failed to zip folder "+a+"/"+s.name);continue}await this.zipDirectory(a+"/"+s.name,o)}return n}}async saveDirectory(e){const t=Tt(e)==""?e:st(e);de.create("Exporting "+t+".zip");const n=await O0({_preferPolyfill:!1,suggestedName:`${t}.zip`,types:[{accept:{"application/zip":[".zip"]}}],excludeAcceptAllOption:!1}),a=await this.zipDirectory(e);a&&await a.generateAsync({type:"blob"}).then(async r=>{if(!window.showSaveFilePicker){console.log(r);const s=document.createElement("a"),o=URL.createObjectURL(r);document.body.appendChild(s),s.href=o,s.download=t+".zip",s.click(),s.remove(),window.URL.revokeObjectURL(o);return}await this.writeHandle(n,r)})}async renameFile(e,t){if(e!=t)try{const n=await this.getDirectoryHandle(st(e)),a=await this.getDirectoryHandle(st(t),{create:!0}),r=await this.getFileHandle(e);if(!n||!a||!r)return;await this.copyToHandle(a,r,kt(t)),await n.removeEntry(kt(e))}catch(n){console.error(n)}}async renameDirectory(e,t){if(!t.startsWith(e))try{const n=await this.getDirectoryHandle(st(e)),a=await this.getDirectoryHandle(st(t),{create:!0}),r=await this.getDirectoryHandle(e);if(!n||!a||!r)return;await this.copyToHandle(a,r,kt(t)),await n.removeEntry(kt(e),{recursive:!0})}catch(n){console.error(n)}}async copyToHandle(e,t,n){try{if(t.kind=="directory"){const a=await e.getDirectoryHandle(n??t.name,{create:!0}),r=[];for await(const s of t.values())r.push(this.copyToHandle(a,s));await Promise.all(r)}else{const a=await t.getFile(),r=await e.getFileHandle(n??t.name,{create:!0});await this.writeHandle(r,a)}}catch(a){console.error(a)}}getRelativePath(e,t){const n=e.split("/"),a=t.split("/"),r=Math.min(n.length,a.length);let s=r;for(let l=0;l<r;l++)if(n[l]!==a[l]){s=l;break}if(s==0)return t;let o=[];for(let l=s;l<n.length;l++)o.push("..");return o=o.concat(a.slice(s)),o.join("/")}async writeHandle(e,t){if(e.createWritable){const n=await e.createWritable();await n.write(t),await n.close()}else{const n=await(await this.getRoot()).resolve(e);if(!n)return;await $0.writeHandle(n.join("/"),t)}}}class Ee{static standardHandler;static urlHandler;static async initFileSystem(){this.urlHandler=new W0,this.standardHandler=window.nw?new(await Ge(async()=>{const{NodeFileHandler:e}=await import("./NodeFileHandler-C3wcEEbV.js");return{NodeFileHandler:e}},__vite__mapDeps([6,1,2]))).NodeFileHandler:new Y0}static getStandardHandler(){return this.standardHandler}static getHandler(e){return e!==void 0&&e.startsWith("https://")||e?.startsWith("http://")?this.urlHandler:this.standardHandler}static handleDropEvent(e,t){return this.getHandler().handleDropEvent(e,t)}static getDirectoryHandle(e,t){return Ee.getHandler(e).getDirectoryHandle(e,t)}static hasFile(e){return Ee.getHandler(e).hasFile(e)}static getFileHandle(e,t){return Ee.getHandler(e).getFileHandle(e,t)}static getFileHandleRelativeTo(e,t){return Ee.getHandler(e).getFileHandleRelativeTo(e,t)}static getDirectoryFiles(e){return Ee.getHandler(typeof e=="string"?e:void 0).getDirectoryFiles(e)}static getDirectoryFolders(e){return Ee.getHandler(typeof e=="string"?e:void 0).getDirectoryFolders(e)}static writeFile(e,t){return Ee.getHandler(typeof e=="string"?e:void 0).writeFile(e,t)}static removeFile(e){return Ee.getHandler(e).removeFile(e)}static getRelativePath(e,t){return Ee.getHandler().getRelativePath(e,t)}}class Qa extends ot{app;dirOptions;fileDropPath="";draggedElement;draggedCopy;keyHandler;dropHandler;mouseHandler;dragHandler;constructor(e,t,n){super({title:t.title,width:500,height:400,disableClose:t.disableClose,win_id:"file_selector"+Math.random(),blocking:!0}),this.app=e,this.dirOptions=t,t.accepted_file_types||=[],this.keyHandler=this.handleKeyEvent.bind(this),this.dropHandler=this.handleDropEvent.bind(this),this.mouseHandler=this.handleMouseEvent.bind(this),this.dragHandler=this.handleDragEvent.bind(this),this.initView().then(()=>{n&&this.selectPath(n),t.onload?.()})}async initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("div");t.classList.add("menu-options");const n=document.createElement("div");n.classList.add("menu-left");const a=document.createElement("div");a.classList.add("menu-right"),t.appendChild(n),t.appendChild(a);const r=document.createElement("button");r.innerText="Cancel",r.onclick=()=>{window.removeEventListener("keydown",this.keyHandler,!0),window.removeEventListener("drop",this.dropHandler,!0),this.closeWindow()};const s=document.createElement("button");s.innerText="Select",s.classList.add("confirm"),s.onclick=()=>this.confirmFile(),s.disabled=!0,n.appendChild(r),a.appendChild(s);const o=document.createElement("div");o.classList.add("dir-selector"),o.onclick=b=>{b.target==o&&this.selectElement(void 0)};const l=document.createElement("div");l.classList.add("file-options");const u=document.createElement("button"),f=me.getIcon("ADD_FILE",16);u.appendChild(f),u.appendChild(document.createTextNode("Upload files")),l.appendChild(u),u.onclick=async()=>{const b=this.fileDropPath,x=await Tu({_preferPolyfill:!0,excludeAcceptAllOption:!1,multiple:!0}),E=this.viewElement.querySelector(".info.selected")?.dataset.path??"",C=[];for(const B of x)C.push(Ee.getStandardHandler().uploadHandle(B,E));await Promise.all(C),await this.refreshDirectory(b),this.getAcceptableFile(b).then(B=>this.selectPath(B))};const c=document.createElement("button"),d=me.getIcon("FOLDER",16);c.appendChild(d),c.appendChild(document.createTextNode("Upload folder")),l.appendChild(c),c.onclick=async()=>{const b=this.fileDropPath,x=await P0({_preferPolyfill:!0}),E=this.viewElement.querySelector(".info.selected")?.dataset.path??"";await Ee.getStandardHandler().uploadHandle(x,E),await this.refreshDirectory(b),this.getAcceptableFile(b==""?x.name:b+"/"+x.name).then(C=>this.selectPath(C))};const h=document.createElement("button");h.classList.add("rename");const p=me.getIcon("EDIT",16);h.appendChild(p),h.appendChild(document.createTextNode("Rename")),h.disabled=!0,h.onclick=()=>{const b=this.viewElement.querySelector(".info.selected");b?.dataset.path&&this.startEditing(b.querySelector("textarea"))},l.appendChild(h);const m=document.createElement("button");m.classList.add("delete");const g=me.getIcon("TRASH",16);m.appendChild(g),m.appendChild(document.createTextNode("Delete")),m.disabled=!0,m.onclick=()=>{const b=this.viewElement.querySelector(".info.selected"),x=b?.dataset.path;if(!x)return;const w=b.parentElement.classList.contains("folder");Ee.getStandardHandler()[w?"removeDirectory":"removeFile"](x).then(()=>{const E=this.getElement(x);E&&(E.parentElement?.remove(),m.disabled=!0,h.disabled=!0)})},l.appendChild(m),e.appendChild(o),e.appendChild(l),e.appendChild(t),this.viewElement.appendChild(e),window.addEventListener("keydown",this.keyHandler,!0),window.addEventListener("drop",this.dropHandler,!0),window.addEventListener("mousemove",this.dragHandler,!0),this.viewElement.addEventListener("dragover",this.mouseHandler),await this.createDiv("").then(b=>o.replaceChildren(...b))}async expand(e){if(!e.parentElement.classList.contains("folder"))return;e.parentElement.classList.remove("collapsed");const t=e.nextSibling;await this.createDiv(e.dataset.path).then(n=>{t.replaceChildren(...n)})}collapse(e){if(!e.parentElement.classList.contains("folder"))return;e.parentElement.classList.add("collapsed"),e.nextSibling.replaceChildren()}selectElement(e){if(this.viewElement.querySelector(".info.selected")?.classList.remove("selected"),!e){this.viewElement.querySelector(".delete").disabled=!0,this.viewElement.querySelector(".rename").disabled=!0;return}e.classList.add("selected"),On(e,{scrollMode:"if-needed",block:"nearest",inline:"nearest"});const t=this.viewElement.querySelector("button.confirm"),n=e.dataset.path;t.disabled=!0,n&&(t.disabled=!this.acceptableFileType(n),this.viewElement.querySelector(".delete").disabled=!1,this.viewElement.querySelector(".rename").disabled=!1)}async createDiv(e){const t=await Ee.getStandardHandler().getDirectoryFolders(e);let n=await Ee.getStandardHandler().getDirectoryFiles(e);return t.sort((a,r)=>a.name.toLowerCase().localeCompare(r.name.toLowerCase())),n.sort((a,r)=>a.name.toLowerCase().localeCompare(r.name.toLowerCase())),n=n.filter(a=>Tt(a.name)!=".crswap"),t.map(a=>this.createBaseElement(e,a)).concat(n.map(a=>this.createBaseElement(e,a)))}createBaseElement(e,t){e!=""&&(e+="/");const n=document.createElement("div");n.classList.add("item");const a=document.createElement("div");if(a.classList.add("info"),n.appendChild(a),t.kind=="directory"){const s=me.getIcon("CHEVRON",16);s.classList.add("folder-icon"),a.appendChild(s);const o=document.createElement("div");o.classList.add("children"),n.appendChild(o),n.classList.add("folder"),n.classList.add("collapsed"),a.addEventListener("click",l=>{const u=l.target;u?.classList.contains("options-icon")||u.tagName=="TEXTAREA"&&!u.disabled||(n.classList.contains("collapsed")?this.expand(a):this.collapse(a))})}else{this.acceptableFileType(t.name)||a.classList.add("disabled");const s=me.getIcon(this.getIconId(t.name),16);a.appendChild(s)}a.dataset.path=e+t.name;const r=document.createElement("textarea");return r.rows=1,r.disabled=!0,r.autocomplete="off",r.autocapitalize="off",r.spellcheck=!1,r.innerText=t.name,r.style.pointerEvents="none",r.classList.add("title"),a.appendChild(r),a.addEventListener("click",()=>this.selectElement(a)),a.addEventListener("mousedown",()=>this.startDragging(a)),a.ondblclick=()=>this.confirmFile(),n}confirmFile(){const t=this.viewElement.querySelector(".info.selected")?.dataset.path;t&&this.acceptableFileType(t)&&(this.dirOptions.callback?.(t),window.removeEventListener("keydown",this.keyHandler,!0),window.removeEventListener("drop",this.dropHandler,!0),window.removeEventListener("mousemove",this.dragHandler,!0),this.closeWindow())}acceptableFileType(e){return this.dirOptions.accepted_file_types.length==0||this.dirOptions.accepted_file_types.includes(Tt(e))}getIconId(e){const t=Tt(e);return t==""&&!e.startsWith(".")?"FOLDER":Oi.includes(t)?"IMAGE_FILE":qa.includes(t)?"VOLUME":[".sm",".ssc"].includes(t)?"SM_FILE":"UNKNOWN_FILE"}startEditing(e){const t=e.value,n=!!e.parentElement?.parentElement?.classList.contains("folder"),a=e.parentElement?.dataset.path??"",r=st(a);e.value=a.split("/").at(-1)??"",window.removeEventListener("keydown",this.keyHandler,!0),e.disabled=!1,e.style.pointerEvents="",e.focus(),e.addEventListener("keypress",s=>{s.code=="Enter"&&(s.preventDefault(),s.stopImmediatePropagation(),e.blur())},!0),e.addEventListener("blur",async()=>{if(window.addEventListener("keydown",this.keyHandler,!0),e.disabled=!0,e.style.pointerEvents="none",e.value.startsWith(".")){e.value=t;return}e.value=e.value.replaceAll("/","");const s=r==""?e.value:r+"/"+e.value;s!=a&&(e.parentElement.dataset.path=s,await Ee.getStandardHandler()[n?"renameDirectory":"renameFile"](a,s),this.refreshDirectory(r),e.value.length>32&&(e.value=e.value.slice(0,32)+"..."))})}async refreshDirectory(e){const t=this.viewElement.querySelector(".dir-selector");if(!t)return;let n=t.querySelector("div[data-path='"+this.escapeSelector(e)+"']")?.nextSibling;if(e==""&&(n=t),!n)return;const a=Array.from(n.parentElement.querySelectorAll(".folder:not(.collapsed)")).map(r=>r.children[0].dataset.path);await this.createDiv(e).then(r=>n.replaceChildren(...r)),await Promise.all(a.map(r=>this.expand(t.querySelector("div[data-path='"+this.escapeSelector(r)+"']"))))}getElement(e){const t=this.viewElement.querySelector(".dir-selector");return t?t.querySelector("div[data-path='"+this.escapeSelector(e)+"']"):null}async getAcceptableFile(e){const t=await Ee.getStandardHandler().getDirectoryHandle(e);if(!t)return;const n=[{path:e,handle:t}];for(;n.length>0;){const a=n.shift(),r=a.handle;for await(const s of r.values()){const o=a.path==""?"":a.path+"/";if(s.kind=="directory")n.push({path:o+s.name,handle:s});else if(this.acceptableFileType(s.name))return o+s.name}}}async selectPath(e){if(!e)return;const t=this.viewElement.querySelector(".dir-selector");if(!t)return;const n=e.split("/");n.pop();const a=[];for(;n.length>0;){a.push(n.shift());const s=t.querySelector("div[data-path='"+this.escapeSelector(a.join("/"))+"']");if(!s)return;await this.expand(s)}const r=t.querySelector("div[data-path='"+this.escapeSelector(e)+"']");r&&this.selectElement(r)}handleKeyEvent(e){if(!this.windowElement.classList.contains("focused"))return;const t=this.viewElement.querySelector(".info.selected");if(t==null){if(e.code.startsWith("Arrow")){const n=this.viewElement.querySelector(".info");n&&this.selectElement(n)}return}if(e.code=="ArrowUp"){e.preventDefault(),e.stopImmediatePropagation();const n=t.parentElement;let a=n.previousSibling?.querySelector(".info");a&&!a.parentElement.classList.contains("collapsed")&&a.parentElement.classList.contains("folder")&&(a=a.parentElement.querySelector(".children").lastChild.querySelector(".info")),!a&&n.parentElement.classList.contains("children")&&(a=n.parentElement.parentElement.querySelector(".info")),a&&(this.selectElement(a),On(a,{scrollMode:"if-needed",block:"nearest",inline:"nearest"}))}if(e.code=="ArrowDown"){e.preventDefault(),e.stopImmediatePropagation();const n=t.parentElement;let a;n.classList.contains("folder")&&!n.classList.contains("collapsed")&&(a=n.querySelector(".children").children[0].querySelector(".info")),a||(a=t.parentElement.nextSibling?.querySelector(".info")),!a&&n.parentElement.classList.contains("children")&&(a=n.parentElement.parentElement.nextSibling.querySelector(".info")),a&&(this.selectElement(a),On(a,{scrollMode:"if-needed",block:"nearest",inline:"nearest"}))}if(e.code=="ArrowLeft"&&(e.preventDefault(),e.stopImmediatePropagation(),this.collapse(t)),e.code=="ArrowRight"&&(e.preventDefault(),e.stopImmediatePropagation(),this.expand(t)),e.code=="Enter"&&(e.preventDefault(),e.stopImmediatePropagation(),t.parentElement?.querySelector(".title")&&this.startEditing(t.parentElement?.querySelector(".title"))),e.code=="Delete"||e.code=="Backspace"){const n=this.viewElement.querySelector(".info.selected"),a=n?.dataset.path;if(!a)return;const r=n.parentElement.classList.contains("folder");Ee.getStandardHandler()[r?"removeDirectory":"removeFile"](a).then(()=>{const s=this.getElement(a);s&&(s.parentElement?.remove(),this.viewElement.querySelector(".delete").disabled=!0,this.viewElement.querySelector(".rename").disabled=!0)})}}startDragging(e){const t=e;t.totalMovementX=0,t.totalMovementY=0,this.draggedElement=t;const n=()=>{this.stopDragging(),window.removeEventListener("mouseup",n)};window.addEventListener("mouseup",n)}handleDragEvent(e){if(this.draggedElement){if(this.draggedElement.totalMovementX+=e.movementX,this.draggedElement.totalMovementY+=e.movementY,!this.draggedCopy)if(Math.abs(this.draggedElement.totalMovementX)+Math.abs(this.draggedElement.totalMovementY)>8){this.viewElement.addEventListener("mousemove",this.mouseHandler),this.draggedCopy=this.draggedElement.parentElement.cloneNode(!0),this.draggedCopy.style.position="fixed";const t=this.draggedElement.getBoundingClientRect();this.draggedCopy.style.top=t.top+this.draggedElement.totalMovementY+"px",this.draggedCopy.style.left=t.left+this.draggedElement.totalMovementX+"px",this.draggedCopy.style.width=t.width+"px",this.draggedCopy.style.boxShadow="3px 3px 3px #222",this.draggedCopy.querySelector(".children")&&this.draggedCopy.removeChild(this.draggedCopy.querySelector(".children")),this.viewElement.appendChild(this.draggedCopy)}else return;this.draggedCopy.style.top=parseFloat(this.draggedCopy.style.top.slice(0,-2))+e.movementY+"px",this.draggedCopy.style.left=parseFloat(this.draggedCopy.style.left.slice(0,-2))+e.movementX+"px"}}async stopDragging(){if(this.draggedCopy){this.draggedCopy.remove(),this.viewElement.removeEventListener("mousemove",this.mouseHandler);const e=this.draggedCopy.classList.contains("folder"),t=this.draggedElement.dataset.path,n=this.fileDropPath==""?kt(this.draggedElement.dataset.path):this.fileDropPath+"/"+kt(this.draggedElement.dataset.path);t!=n&&await Ee.getStandardHandler()[e?"renameDirectory":"renameFile"](t,n),await this.refreshDirectory(st(t)),await this.refreshDirectory(st(n)),this.viewElement.querySelector(".outlined")?.classList.remove("outlined"),this.fileDropPath=""}this.draggedCopy=void 0,this.draggedElement=void 0}handleDropEvent(e){e.preventDefault(),e.stopImmediatePropagation(),this.viewElement.querySelector(".outlined")?.classList.remove("outlined"),e.target.closest(".dir-selector")&&Ee.getStandardHandler().handleDropEvent(e,this.fileDropPath).then(async t=>{await this.refreshDirectory(this.fileDropPath),this.getAcceptableFile(t??this.fileDropPath).then(n=>this.selectPath(n)),this.fileDropPath=""})}handleMouseEvent(e){const t=this.viewElement.querySelector(".dir-selector");let n=Array.from(t.querySelectorAll("div.item.folder"));const a=this.viewElement.querySelector(".outlined");n=n.filter(r=>!r.parentElement.closest(".collapsed")),n.reverse(),n.push(t);for(const r of n){const s=r.getBoundingClientRect();if(e.clientX>=s.x&&e.clientX<=s.x+s.width&&e.clientY>=s.y&&e.clientY<=s.y+s.height){a!=r&&a?.classList.remove("outlined");const o=r.querySelector(".info");this.fileDropPath=o?.dataset.path??"",r.classList.contains("dir-selector")&&(this.fileDropPath=""),r.classList.add("outlined");return}}this.viewElement.querySelector(".outlined")?.classList.remove("outlined"),this.fileDropPath=""}escapeSelector(e){return e.replaceAll(/'/g,"\\'")}}function Du(){const i=document.createElement("div");return i.spellcheck=!1,i.contentEditable="true",i.classList.add("inlineEdit"),i.onkeydown=e=>{e.key=="Enter"&&i.blur()},i}function pa(i,e){return{title:i,element:t=>{const n=Du();return n.onblur=()=>{const a=n.innerText,r=t[e];Et.instance.run({action:()=>{t[e]=a,n.innerText=a},undo:()=>{t[e]=r,n.innerText=r}}),n.scrollLeft=0},n.innerText=t[e],n}}}const K0={name:pa("Name","chartName"),credit:pa("Artist","credit"),style:pa("Style","chartStyle"),description:pa("Description","description"),music:{title:"Music File",element:(i,e)=>{const t=document.createElement("div");t.classList.add("flex-row","flex-column-gap","flex-static","hide-buttons");const n=()=>{if(a.innerText==(i.music??e.chartManager.loadedSM.properties.MUSIC??""))return;const u=e.chartManager.chartAudio.isPlaying();if(a.innerText==""||a.innerText==e.chartManager.loadedSM.properties.MUSIC){i.music=void 0,a.innerText=e.chartManager.loadedSM.properties.MUSIC+"",e.chartManager.loadAudio(),u&&e.chartManager.chartAudio.play();return}const f=a.innerText==e.chartManager.loadedSM.properties.MUSIC?void 0:a.innerText,c=i.music;Et.instance.run({action:()=>{i.music=f,a.innerText=f??e.chartManager.loadedSM.properties.MUSIC??"",e.chartManager.loadAudio(),u&&e.chartManager.chartAudio.play()},undo:()=>{i.music=c,a.innerText=c??e.chartManager.loadedSM.properties.MUSIC??"",e.chartManager.loadAudio(),u&&e.chartManager.chartAudio.play()}})},a=Du();a.style.flex="1",a.onblur=n,a.innerText=i.music??e.chartManager.loadedSM.properties.MUSIC??"";const r=document.createElement("button");r.onclick=()=>{const u=st(e.chartManager.smPath);if(window.nw){const f=document.createElement("input");f.type="file",f.accept="audio/*",f.onchange=()=>{a.innerText=Ee.getRelativePath(u,f.value),n()},f.click()}else e.windowManager.openWindow(new Qa(e,{title:"Select an audio file...",accepted_file_types:qa,disableClose:!0,callback:f=>{a.innerText=Ee.getRelativePath(u,f),n()}},u+"/"+(i.music??e.chartManager.loadedSM.properties.MUSIC??"")))};const s=me.getIcon("FOLDER",12);r.appendChild(s);const o=document.createElement("button");o.onclick=()=>{a.innerText!=(e.chartManager.loadedSM.properties.MUSIC??"")&&(a.innerText=e.chartManager.loadedSM.properties.MUSIC??"",n())};const l=me.getIcon("REVERT",12);return o.appendChild(l),t.appendChild(a),t.appendChild(r),t.appendChild(o),t}}};class Zn extends ot{app;buttonOptions;message;resolve;resolved=new Promise(e=>this.resolve=e);constructor(e,t,n,a){super({title:t,width:300,height:100,disableClose:!0,win_id:"confirm",blocking:!0}),this.app=e,this.message=n,this.buttonOptions=a,this.initView()}initView(){this.viewElement.replaceChildren(),this.viewElement.classList.add("confirmation");const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("div");t.classList.add("label"),t.innerText=this.message,e.appendChild(t);const n=document.createElement("div");n.classList.add("menu-options"),this.buttonOptions.forEach(a=>{const r=document.createElement("button");r.innerText=a.label,r.onclick=()=>{a.callback?.(),this.resolve?.(a.label),this.closeWindow()},a.type!="default"&&r.classList.add(a.type),n.append(r)}),e.appendChild(n),this.viewElement.appendChild(e)}}class Bu extends ot{app;gameType;chartList;chartInfo;gameTypeDropdown;smLoadHandler=()=>{this.gameTypeDropdown.setItems(bt.getPriority().map(e=>{const t=this.app.chartManager.loadedSM?.charts[e.id]??[];return e.id+" ("+t.length+")"})),this.gameTypeDropdown.setSelected(this.gameType.id+" ("+(this.app.chartManager.loadedSM?.charts[this.gameType.id]??[]).length+") "),this.gameType=this.app.chartManager.loadedChart?.gameType??this.gameType,this.loadCharts()};constructor(e,t){super({title:"Chart List",width:500,height:400,win_id:"chart_list"}),this.app=e,this.gameType=t??e.chartManager.loadedChart?.gameType??bt.getPriority()[0],this.initView(),re.on("smLoadedAfter",this.smLoadHandler)}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("div");t.classList.add("chart-view-type-wrapper");const n=document.createElement("div");n.classList.add("chart-view-type-label"),n.innerText="Game Type:",this.gameTypeDropdown=hi.create(bt.getPriority().map(r=>{const s=this.app.chartManager.loadedSM?.charts[r.id]??[];return r.id+" ("+s.length+")"}),this.gameType.id+" ("+(this.app.chartManager.loadedSM?.charts[this.gameType.id]??[]).length+") "),this.gameTypeDropdown.onChange(r=>{this.gameType=bt.getGameType(r.split(" ")[0])??this.gameType,this.loadCharts()}),t.appendChild(n),t.appendChild(this.gameTypeDropdown.view);const a=document.createElement("div");a.classList.add("chart-view-scroller"),e.appendChild(t),e.appendChild(a),this.chartList=document.createElement("div"),this.chartList.classList.add("chart-list"),this.chartInfo=document.createElement("div"),this.chartInfo.classList.add("chart-info"),a.appendChild(this.chartList),a.appendChild(this.chartInfo),this.viewElement.appendChild(e),this.loadCharts()}onClose(){re.off("smLoadedAfter",this.smLoadHandler)}loadCharts(){const e=this.app.chartManager.loadedSM?.charts[this.gameType.id]??[],t=[];this.gameTypeDropdown.setItems(bt.getPriority().map(s=>{const o=this.app.chartManager.loadedSM?.charts[s.id]??[];return s.id+" ("+o.length+")"})),this.gameTypeDropdown.setSelected(this.gameType.id+" ("+(this.app.chartManager.loadedSM?.charts[this.gameType.id]??[]).length+") "),e.forEach(s=>{const o=document.createElement("div");o.classList.add("chart-list-item"),o.chart=s,this.app.chartManager.loadedChart==s&&o.classList.add("selected"),o.onclick=()=>{o.chart!=this.app.chartManager.loadedChart&&(this.app.chartManager.loadChart(o.chart),this.chartList.querySelectorAll(".selected").forEach(d=>d.classList.remove("selected")),o.classList.add("selected"))},o.onmouseenter=()=>{this.loadChartDetails(o.chart)},o.onmouseleave=()=>{this.loadChartDetails()};const l=document.createElement("div");l.innerText=s.meter+"",l.classList.add("title",s.difficulty);const u=document.createElement("div");u.classList.add("chart-list-info");const f=document.createElement("div");f.innerText=s.credit,f.classList.add("title","chart-credit");const c=document.createElement("div");c.innerText=s.getNotedata().length+"",c.classList.add("title","chart-step-count"),u.appendChild(f),u.appendChild(c),o.appendChild(l),o.appendChild(u),t.push(o)});const n=document.createElement("div");n.classList.add("chart-list-item");const a=document.createElement("div");a.innerText="+",a.classList.add("title");const r=document.createElement("div");r.classList.add("chart-list-info"),r.innerText="New Blank Chart",n.appendChild(a),n.appendChild(r),n.onclick=()=>{const s=new Qu(this.app.chartManager.loadedSM);s.gameType=this.gameType,this.app.chartManager.loadedSM.addChart(s),this.app.chartManager.loadChart(s),this.loadCharts()},this.chartList.replaceChildren(...t,n),this.loadChartDetails()}loadChartDetails(e){if(e=e??this.app.chartManager.loadedChart,e?.gameType.id!=this.gameType.id){this.chartInfo.replaceChildren();return}if(!e)return;const t=()=>this.app.chartManager.loadedSM.charts[e.gameType.id].sort((m,g)=>yn.indexOf(m.difficulty)==yn.indexOf(g.difficulty)?m.meter-g.meter:yn.indexOf(m.difficulty)-yn.indexOf(g.difficulty)),n=document.createElement("div");n.classList.add("chart-info-main");const a=hi.create(yn,e.difficulty);a.view.classList.add("no-border","white"),a.onChange(m=>{const g=e.difficulty;Et.instance.run({action:()=>{e.difficulty=m,t(),this.loadCharts()},undo:()=>{e.difficulty=g,t(),this.loadCharts()}})});const r=document.createElement("div");r.spellcheck=!1,r.contentEditable="true",r.classList.add("inlineEdit","chart-meter"),r.onkeydown=m=>{m.key=="Enter"&&r.blur()},r.onblur=()=>{let m=Nn(r.innerText);if(m===null){r.innerText=e?.meter+"";return}m=Math.round(Se(1,m,2**31-1));const g=e.meter;Et.instance.run({action:()=>{e.meter=m,e.meterF=m,t(),this.loadCharts()},undo:()=>{e.meter=g,e.meterF=g,t(),this.loadCharts()}}),r.scrollLeft=0},r.innerText=e.meter+"";const s=document.createElement("div");s.classList.add("chart-properties"),n.appendChild(a.view),n.appendChild(r),Object.values(K0).forEach(m=>{const g=document.createElement("div");g.classList.add("label"),g.innerText=m.title;const b=m.element(e,this.app);m.title=="Artist"&&b.addEventListener("blur",()=>this.loadCharts()),s.appendChild(g),s.appendChild(b)});const o=e.stats.noteCounts,l=document.createElement("div");l.classList.add("chart-info-grid-item");const u=document.createElement("div");u.innerText="Peak NPS",u.classList.add("title","chart-info-grid-label");const f=document.createElement("div");f.innerText=e.stats.getMaxNPS().toFixed(2)+"",f.classList.add("title","chart-info-grid-count"),l.appendChild(u),l.appendChild(f);const c=document.createElement("div");c.classList.add("chart-info-grid"),Object.entries(o).forEach(m=>{const g=document.createElement("div");g.classList.add("chart-info-grid-item");const b=document.createElement("div");b.innerText=m[0],b.classList.add("title","chart-info-grid-label");const x=document.createElement("div");x.innerText=m[1]+"",x.classList.add("title","chart-info-grid-count"),g.appendChild(b),g.appendChild(x),c.appendChild(g)});const d=document.createElement("div");d.classList.add("menu-options");const h=document.createElement("button");h.innerText="Duplicate Chart",h.onclick=()=>{const m=Object.assign(Object.create(Object.getPrototypeOf(e)),e);m.setNotedata(e.getNotedata().map(g=>e.computeNote(g))??[]),this.app.chartManager.loadedSM.addChart(m),this.app.chartManager.loadChart(m),this.loadCharts()},d.append(h);const p=document.createElement("button");p.innerText="Delete Chart",p.onclick=()=>{this.app.windowManager.openWindow(new Zn(this.app,"Delete chart","Are you sure you want to delete this chart?",[{type:"default",label:"Cancel"},{type:"delete",label:"Delete",callback:()=>{this.app.chartManager.loadedSM.removeChart(e)&&(this.app.chartManager.loadChart(),this.gameType=this.app.chartManager.loadedChart?.gameType??this.gameType,this.loadCharts())}}]))},p.classList.add("delete"),d.append(p),this.chartInfo.replaceChildren(n,s,l,c,d)}}var ds,ic;function X0(){if(ic)return ds;ic=1;var i=4,e=.001,t=1e-7,n=10,a=11,r=1/(a-1),s=typeof Float32Array=="function";function o(m,g){return 1-3*g+3*m}function l(m,g){return 3*g-6*m}function u(m){return 3*m}function f(m,g,b){return((o(g,b)*m+l(g,b))*m+u(g))*m}function c(m,g,b){return 3*o(g,b)*m*m+2*l(g,b)*m+u(g)}function d(m,g,b,x,w){var E,C,B=0;do C=g+(b-g)/2,E=f(C,x,w)-m,E>0?b=C:g=C;while(Math.abs(E)>t&&++B<n);return C}function h(m,g,b,x){for(var w=0;w<i;++w){var E=c(g,b,x);if(E===0)return g;var C=f(g,b,x)-m;g-=C/E}return g}function p(m){return m}return ds=function(g,b,x,w){if(!(0<=g&&g<=1&&0<=x&&x<=1))throw new Error("bezier x values must be in [0, 1] range");if(g===b&&x===w)return p;for(var E=s?new Float32Array(a):new Array(a),C=0;C<a;++C)E[C]=f(C*r,g,x);function B(D){for(var O=0,H=1,Y=a-1;H!==Y&&E[H]<=D;++H)O+=r;--H;var ae=(D-E[H])/(E[H+1]-E[H]),M=O+ae*r,P=c(M,g,x);return P>=e?h(D,M,g,x):P===0?M:d(D,O,O+r,g,x)}return function(O){return O===0?0:O===1?1:f(B(O),b,w)}},ds}var Z0=X0();const ci=Jn(Z0),Q0=ci(0,0,1,1);function nc(i,e){const t=e?e.split("."):[];for(;t.length&&i;){const n=t.shift(),a=new RegExp("(.+)\\[([0-9]*)\\]").exec(n);if(a!==null&&a.length==3){const r={arrName:a[1],arrIndex:a[2]};i[r.arrName]!==void 0?i=i[r.arrName][r.arrIndex]:i=void 0;continue}i=i[n]}return i}function J0(i,e,t){const n=e?e.split("."):[];for(;n.length&&i;){const a=n.shift(),r=new RegExp("(.+)\\[([0-9]*)\\]").exec(a);if(r!==null&&r.length==3){const s={arrName:r[1],arrIndex:r[2]};i[s.arrName]!==void 0&&n.length===0&&(i[s.arrName][s.arrIndex]=t);continue}i[a]===void 0&&(i[a]={}),n.length===0&&(i[a]=t),i=i[a]}return i}class $t{static animations=new Map;static _id=0;static{St.shared.add(e=>{for(const[t,n]of this.animations.entries())n.obj._destroyed?this.stop(t):(n.progress=Math.min(1,n.progress+n.seconds*e),this.updateObject(n.obj,n.animation,n.curve(n.progress)),n.progress>=1&&(n.onend(n.obj),this.stop(t,1)))})}static updateObject(e,t,n){const a=Object.keys(t).sort((o,l)=>parseFloat(o)-parseFloat(l));let r="0";for(let o=a.length-2;o>=0;o--)if(parseFloat(a[o])<=n){r=a[o];break}let s="1";for(let o=1;o<a.length;o++)if(parseFloat(a[o])>n){s=a[o];break}Object.keys(t[0]).forEach(o=>{let l=t[r][o],u=t[s][o];l==="inherit"&&(t[r][o]=nc(e,o),l=t[r][o]),u==="inherit"&&(t[s][o]=nc(e,o),u=t[s][o]);const f=l+(n-parseFloat(r))/(parseFloat(s)-parseFloat(r))*(u-l);J0(e,o,f)})}static stop(e,t=null){e!==void 0&&(t!==null&&this.animations.get(e)?.obj&&!this.animations.get(e).obj.destroyed&&this.updateObject(this.animations.get(e).obj,this.animations.get(e).animation,t),this.animations.delete(e))}static finish(e){e!==void 0&&this.stop(e,1)}static animate(e,t,n,a,r=()=>{},s){return s||=`${++this._id}`,this.animations.set(s,{obj:e,animation:t,seconds:1/(60*n),progress:0,curve:a!==void 0?a:Q0,onend:r}),this.updateObject(e,t,0),s}}const hs=[{frequency:20,Q:.71},{frequency:75,gain:0},{frequency:100,gain:0,Q:.6},{frequency:250,gain:0,Q:.3},{frequency:1040,gain:0,Q:.41},{frequency:2500,gain:0,Q:.2},{frequency:7500,gain:0},{frequency:2e4,Q:.71}],ac=[{freq:20,label:"20"},{freq:30,label:"30"},{freq:40,label:"40"},{freq:50,label:"50"},{freq:60,label:"60"},{freq:70,label:""},{freq:80,label:"80"},{freq:90,label:""},{freq:100,label:"100"},{freq:200,label:"200"},{freq:300,label:"300"},{freq:400,label:"400"},{freq:500,label:"500"},{freq:600,label:"600"},{freq:700,label:""},{freq:800,label:"800"},{freq:900,label:""},{freq:1e3,label:"1k"},{freq:2e3,label:"2k"},{freq:3e3,label:"3k"},{freq:4e3,label:"4k"},{freq:5e3,label:"5k"},{freq:6e3,label:"6k"},{freq:7e3,label:""},{freq:8e3,label:"8k"},{freq:9e3,label:""},{freq:1e4,label:"10k"},{freq:15e3,label:""},{freq:2e4,label:"20k"}],sn=0,on=0,qi=1200,gt=400,Pa=new Array(qi).fill(0).map((i,e)=>wo(e)),em=new Float32Array(Pa);function Oa(i){return Math.log(i/20)/Math.log(1102.5)*qi}function wo(i){return Math.pow(1102.5,i/qi)*20}function Ui(i){return-i*6+gt/2}function rc(i){return-(i-gt/2)/6}class tm extends ot{app;cachedReponse=new Array(qi).fill(0);onAudioLoad=this.onAudio.bind(this);onThemeChange=this.changeHTMLColors.bind(this);points=[];icons;info;trackedFilter=null;constructor(e){super({title:"Audio Equalizer",width:600,height:245,win_id:"audio-eq"}),this.app=e,this.initView(),this.onAudioLoad(),re.on("audioLoaded",this.onAudioLoad),re.on("themeChanged",this.onThemeChange)}destroy(){re.off("audioLoaded",this.onAudioLoad),re.off("themeChanged",this.onThemeChange)}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("eq-container");const t=document.createElement("div");t.classList.add("icon-container"),this.app.chartManager.chartAudio.getFilters().forEach((w,E)=>{const C=me.getIcon(w.type.toUpperCase(),36,24,Vi[E]);C.classList.add("eq-icon"),C.style.backgroundColor=`${Vi[E]}40`,C.onclick=()=>{this.app.chartManager.chartAudio.getFilter(E).enabled?this.app.chartManager.chartAudio.disableFilter(E):this.app.chartManager.chartAudio.enableFilter(E),this.endTrack(),this.updateIcons()},C.onmouseenter=()=>this.points[E].highlight(),C.onmouseleave=()=>this.points[E].unhighlight(),t.appendChild(C)}),this.icons=t,this.updateIcons();const n=document.createElement("canvas");n.style.width="37.5rem",n.style.height="12.5rem",n.onmousedown=w=>{const E=this.points.filter(C=>C.hitTest(w.offsetX*2/y.general.uiScale,w.offsetY*2/y.general.uiScale)).at(-1);this.endTrack(),E?.mouseDown(w)};const a=document.createElement("div");a.classList.add("eq-info-container");const r=document.createElement("div");r.classList.add("eq-info");const s=document.createElement("div");s.innerText="Type",s.classList.add("eq-info-label");const o=document.createElement("div");o.classList.add("eq-info-value"),r.replaceChildren(s,o);const l=document.createElement("div");l.classList.add("eq-info");const u=document.createElement("div");u.innerText="Frequency",u.classList.add("eq-info-label");const f=document.createElement("div");f.contentEditable="false",f.classList.add("eq-info-value","inlineEdit"),l.replaceChildren(u,f),this.setupInput(f,"frequency",20,22050," Hz");const c=document.createElement("div");c.classList.add("eq-info");const d=document.createElement("div");d.innerText="Gain",d.classList.add("eq-info-label");const h=document.createElement("div");h.contentEditable="false",h.classList.add("eq-info-value","inlineEdit"),c.replaceChildren(d,h),this.setupInput(h,"gain",-24,24," dB",1);const p=document.createElement("div");p.classList.add("eq-info");const m=document.createElement("div");m.innerText="Q",m.classList.add("eq-info-label");const g=document.createElement("div");g.contentEditable="false",g.classList.add("eq-info-value","inlineEdit"),p.replaceChildren(m,g),this.setupInput(g,"Q",1e-4,1e3,"",4);const b=document.createElement("div");b.classList.add("eq-reset","disabled"),b.innerText="Reset",b.onclick=()=>{if(this.trackedFilter==null)for(let w=0;w<hs.length;w++)this.app.chartManager.chartAudio.updateFilter(w,hs[w]),this.app.chartManager.chartAudio.disableFilter(w),this.updateIcons(),this.points[w].refreshPoint();else this.app.chartManager.chartAudio.updateFilter(this.trackedFilter,hs[this.trackedFilter]),this.app.chartManager.chartAudio.disableFilter(this.trackedFilter),this.updateIcons(),this.points[this.trackedFilter].refreshPoint(),this.trackFilter(this.trackedFilter)},a.replaceChildren(r,l,c,p,b),this.info=a,e.replaceChildren(t,n,a),this.viewElement.appendChild(e);const x=this.drawEQ(n);requestAnimationFrame(x),this.changeHTMLColors()}selectText(e){const t=window.getSelection(),n=document.createRange();!t||!n||n.selectNodeContents(e)}setupInput(e,t,n,a,r="",s=0){let o=0;e.onfocus=()=>{o=this.app.chartManager.chartAudio.getFilter(this.trackedFilter)[t].value,e.innerText=ue(o,s)+"",this.selectText(e)},e.onkeydown=l=>{if(l.key=="Enter"){e.blur();return}if(l.key=="Tab"){const f=[...e.parentElement.parentElement.children],c=f.indexOf(e.parentElement);for(let d=1;d<f.length;d++){const p=f[(d+c)%f.length].children[1];if(p.contentEditable==="true"){p.focus();break}}return}if(l.key=="Escape"){e.innerText=o+r,this.app.chartManager.chartAudio.updateFilter(this.trackedFilter,{gain:Se(o,n,a)}),this.points[this.trackedFilter].refreshPoint(),this.getResponse(),e.blur();return}setTimeout(()=>{const u=Nn(e.innerText);u!==null&&(this.app.chartManager.chartAudio.updateFilter(this.trackedFilter,{[t]:Se(u,n,a)}),this.points[this.trackedFilter].refreshPoint(),this.getResponse())})},e.onblur=()=>{Nn(e.innerText)===null&&(this.app.chartManager.chartAudio.updateFilter(this.trackedFilter,{[t]:Se(o,n,a)}),this.points[this.trackedFilter].refreshPoint(),this.getResponse()),e.innerText=ue(this.app.chartManager.chartAudio.getFilter(this.trackedFilter)[t].value,s)+r}}onAudio(){this.points=this.app.chartManager.chartAudio.getFilters().map((e,t)=>new im(this,t)),this.getResponse(),this.updateIcons(),this.endTrack()}getResponse(){this.cachedReponse=this.app.chartManager.chartAudio.getFrequencyResponse(Pa)}drawEQ(e){const t=e.getContext("2d");t.canvas.width=1200,t.canvas.height=400;const n=()=>{if(!this.app.chartManager.chartAudio)return;const a=t.createRadialGradient(e.width/2,e.height/2,0,e.width/2,e.height/2,e.width/2);let r,s;const o=Fe.getColor("accent-color");Bs(Fe.getColor("primary-bg"))>.5?(r=new F("white"),s=new F("black")):(r=new F("black"),s=new F("white"));const l=jt(o,r,.95);a.addColorStop(0,jt(o,r,.9).toHexa()),a.addColorStop(1,l.toHexa()),t.fillStyle=a,t.fillRect(0,0,e.width,e.height),t.fillStyle=jt(o,r,.2).toHex(),this.drawFrequencies(t,this.app.chartManager.chartAudio.getFrequencyData()),this.app.chartManager.chartAudio.hasFilters()&&(t.fillStyle=jt(o,s,.2).toHex()+"50",this.drawFrequencies(t,this.app.chartManager.chartAudio.getFilteredFrequencyData())),t.fillStyle="rgba(200, 200, 200, 0.5)",this.drawResponse(t),t.fillStyle=jt(o,s,.2).toHex()+"80",t.font="22px Assistant",this.drawGrid(t),this.points.forEach(u=>u.draw(t)),e.closest("#windows")&&requestAnimationFrame(n)};return n}drawFrequencies(e,t){for(let n=0;n<qi;n++){const a=wo(n)/this.app.chartManager.chartAudio.getSampleRate()*this.app.chartManager.chartAudio.getFFTSize(),r=t[Math.floor(a)]/255;e.fillRect(sn+n,on+gt-r*gt,1,r*gt)}}drawResponse(e){for(let t=0;t<qi;t++){const n=Math.log(this.cachedReponse[t])/.115241,a=Ui(n);e.fillRect(t+sn,Math.min(a,gt/2)+on,1,Math.max(a,gt/2)-Math.min(a,gt/2))}}drawGrid(e){for(const t of ac)e.fillRect(sn+Oa(t.freq),on,1,gt),e.fillText(t.label,sn+Oa(t.freq)-(t==ac.at(-1)?20:0),on+gt/2);for(let t=-25;t<=25;t+=5){const n=on+Ui(t);e.fillRect(0,n,1200,1),t!=0&&e.fillText(t+"",sn,n)}}changeHTMLColors(){let e;const t=Fe.getColor("accent-color");Bs(Fe.getColor("primary-bg"))>.5?e=new F("white"):e=new F("black");const n=jt(t,e,.95),a=jt(t,e,.5);this.icons.style.backgroundColor=n.toHexa(),this.icons.style.borderImageSource=`linear-gradient(to right, ${n.toHexa()}, ${a.toHexa()}, ${n.toHexa()})`,this.info.style.backgroundColor=n.toHexa(),this.info.style.borderImageSource=`linear-gradient(to right, ${n.toHexa()}, ${a.toHexa()}, ${n.toHexa()})`,this.info.style.color=t.toHexa()}updateIcons(){[...this.icons.children].forEach((e,t)=>{this.app.chartManager.chartAudio.getFilter(t).enabled?e.classList.remove("disabled"):e.classList.add("disabled")}),this.getResponse()}trackFilter(e){this.trackedFilter=e;const t=this.app.chartManager.chartAudio.getFilter(e),[n,a,r,s]=[...this.info.children].map(o=>o.children[1]);n.innerText=t.type,a.innerText=Math.round(t.frequency.value)+" Hz",r.innerText=t.type.endsWith("pass")?"-":ue(t.gain.value,1)+" dB",s.innerText=t.type.endsWith("shelf")?"-":ue(t.Q.value,2)+"",n.style.color=Vi[e],a.style.color=Vi[e],r.style.color=Vi[e],s.style.color=Vi[e],a.contentEditable="true",r.contentEditable=`${!t.type.endsWith("pass")}`,s.contentEditable=`${!t.type.endsWith("shelf")}`}endTrack(){setTimeout(()=>{this.trackedFilter=null,this.points.forEach(r=>r.unhighlight());const[e,t,n,a]=[...this.info.children].map(r=>r.children[1]);e.innerText="",t.innerText="",n.innerText="",a.innerText="",t.contentEditable="false",n.contentEditable="false",a.contentEditable="false"})}}const ma=16,Vi=["#a3001b","#a34f00","#d6d606","#19c402","#02c4ba","#022fc4","#5602c4","#c402b4"];class im{filterIndex;window;dragging=!1;x=0;y=0;type;response=new Float32Array(Pa.length);_empty=new Float32Array(Pa.length);highlighted=!1;pointSize=.4;constructor(e,t){this.filterIndex=t,this.window=e,this.type=this.window.app.chartManager.chartAudio.getFilter(t).type,this.x=Oa(this.window.app.chartManager.chartAudio.getFilter(t).frequency.value??10),this.getY()}hitTest(e,t){return(e-this.x)*(e-this.x)+(t-this.y)*(t-this.y)<=ma*ma}canChangeGain(){return this.type=="lowshelf"||this.type=="highshelf"||this.type=="peaking"}canChangeQ(){return!this.type.endsWith("shelf")}getY(){this.type.endsWith("shelf")?this.y=Ui((this.window.app.chartManager.chartAudio.getFilter(this.filterIndex).gain.value??0)/2):this.canChangeGain()?this.y=Ui(this.window.app.chartManager.chartAudio.getFilter(this.filterIndex).gain.value??0):this.y=gt/2}getGain(){if(this.canChangeGain())return this.type.endsWith("shelf")?rc(this.y)*2:rc(this.y)}mouseDown(e){this.calcResponse(),this.dragging=!0,this.highlighted=!0,this.window.app.chartManager.chartAudio.getFilter(this.filterIndex).enabled||(this.window.app.chartManager.chartAudio.enableFilter(this.filterIndex),this.window.updateIcons());const t=this.x,n=this.y,a=e.clientX,r=e.clientY,s=l=>{this.x=(l.clientX-a)*2+t,this.canChangeGain()?this.y=(l.clientY-r)*2+n:this.y=gt/2,this.x=Se(this.x,0,qi),this.y=Se(this.y,this.type.endsWith("shelf")?gt/4:Ui(24),this.type.endsWith("shelf")?3*gt/4:Ui(-24)),this.window.app.chartManager.chartAudio.updateFilter(this.filterIndex,{frequency:wo(this.x),gain:this.getGain()}),this.window.getResponse(),this.window.trackFilter(this.filterIndex),this.calcResponse()};this.window.trackFilter(this.filterIndex);const o=()=>{$t.animate(this,{0:{pointSize:"inherit"},1:{pointSize:.3}},.3,ci(.11,.71,.41,.86),()=>{},`eq-point${this.filterIndex}`),this.dragging=!1,window.removeEventListener("mousemove",s),window.removeEventListener("mouseup",o)};$t.animate(this,{0:{pointSize:"inherit"},1:{pointSize:.9}},.3,ci(.11,.71,.41,.86),()=>{},`eq-point${this.filterIndex}`),window.addEventListener("mousemove",s),window.addEventListener("mouseup",o)}calcResponse(){this.window.app.chartManager.chartAudio.getFilter(this.filterIndex).getFrequencyResponse(em,this.response,this._empty)}draw(e){const t=this.highlighted||this.window.app.chartManager.chartAudio.getFilter(this.filterIndex).enabled?Vi[this.filterIndex]:"#888888";if(e.fillStyle=t+"60",this.dragging)for(let n=0;n<this.response.length;n++){const a=Math.log(this.response[n])/.115241,r=Ui(a);e.fillRect(n+sn,Math.min(r,gt/2)+on,1,Math.max(r,gt/2)-Math.min(r,gt/2))}e.fillStyle=t+"80",e.beginPath(),e.arc(this.x,this.y,ma,0,2*Math.PI),e.closePath(),e.fill(),e.beginPath(),e.arc(this.x,this.y,ma*this.pointSize,0,2*Math.PI),e.closePath(),e.fill()}refreshPoint(){this.x=Oa(this.window.app.chartManager.chartAudio.getFilter(this.filterIndex).frequency.value??10),this.getY()}highlight(){this.highlighted=!0}unhighlight(){this.highlighted=!1}}const fs={columnOneBased:{label:"1-indexed column numbers",tooltip:"Start counting column numbers from 0 instead of 1."},lengthAsNumberIndex:{label:"Store length in integer keys",tooltip:'Store the length of holds as the last item in each table, instead of using the "length" key.'},padNumbers:{label:"Pad numbers",tooltip:"Pad decimals with trailing zeros."},minify:{label:"Minify",tooltip:"Remove all newlines and spaces."},notitgNoteTypes:{label:"Use NotITG Note Types",tooltip:'Use NotITG note types. (Tap = 1, Hold = 2, Mine = "M")'}},sc={Tap:"1",Hold:"2",Roll:"4",Mine:'"M"',Lift:'"L"',Fake:'"F"'};class nm extends ot{app;selection;outputDiv;exportOptions={include:{Beat:!0,Second:!1,Column:!0,Type:!0,Quantization:!1,Length:!0},options:{columnOneBased:!1,lengthAsNumberIndex:!1,padNumbers:!1,minify:!1,notitgNoteTypes:!1}};constructor(e,t=[]){super({title:"Export Notedata",width:600,height:400,disableClose:!1,win_id:"export_notedata",blocking:!1}),this.app=e,t.length==0&&(t=this.app.chartManager.loadedChart.getNotedata()),this.selection=t,this.initView(),this.export()}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("div");t.classList.add("export-container");const n=document.createElement("div");n.classList.add("export-options");const a=document.createElement("pre");a.classList.add("export-output"),Xe(a,{content:"Click to copy to clipboard"}),Xe(a,{content:"Copied!",trigger:"click",onShow(o){o.setProps({trigger:"mouseenter"})},onHide(o){o.setProps({trigger:"click"})}}),a.addEventListener("click",()=>{navigator.clipboard.writeText(a.innerText)}),this.outputDiv=a;const r=document.createElement("div");r.classList.add("export-section-label"),r.innerText="Include",n.appendChild(r),Object.keys(this.exportOptions.include).forEach(o=>{const l=document.createElement("input");l.type="checkbox",l.id="en-i-"+o,l.checked=this.exportOptions.include[o],l.onchange=()=>{this.exportOptions.include[o]=l.checked,this.export()};const u=document.createElement("label");u.classList.add("export-label"),u.htmlFor=l.id,u.innerText=o;const f=document.createElement("div");f.replaceChildren(l,u),f.classList.add("export-option"),n.appendChild(f)});const s=document.createElement("div");s.classList.add("export-section-label"),s.innerText="Options",n.appendChild(s),Object.keys(this.exportOptions.options).forEach(o=>{const l=document.createElement("input");l.id="en-o-"+o,l.type="checkbox",l.checked=this.exportOptions.options[o],l.onchange=()=>{this.exportOptions.options[o]=l.checked,this.export()};const u=document.createElement("label");u.classList.add("export-label"),u.htmlFor=l.id,u.innerText=fs[o].label;const f=document.createElement("div");f.replaceChildren(l,u),f.classList.add("export-option"),n.appendChild(f),fs[o].tooltip!==void 0&&Xe(f,{content:fs[o].tooltip})}),t.replaceChildren(n,a),e.appendChild(t),this.viewElement.appendChild(e)}export(){let e=`{
`+this.selection.map(t=>{let n="	{";return this.exportOptions.include.Beat&&(n+=this.padNum(t.beat)+","),this.exportOptions.include.Second&&(n+=this.padNum(t.second)+","),this.exportOptions.include.Column&&(this.exportOptions.options.columnOneBased?n+=t.col+1+",":n+=t.col+","),this.exportOptions.include.Type&&(this.exportOptions.options.notitgNoteTypes&&sc[t.type]!==void 0?n+=sc[t.type]+",":n+='"'+t.type+'",'),this.exportOptions.include.Quantization&&(n+=t.quant+","),this.exportOptions.include.Length&&Oe(t)&&(this.exportOptions.options.lengthAsNumberIndex?n+=this.padNum(t.hold)+",":n+="length="+this.padNum(t.hold)+","),n.endsWith(",")&&(n=n.slice(0,-1)),n+="}",this.getNumIncludes()==1&&(n=n.replaceAll("{",""),n=n.replaceAll("}","")),n}).join(`,
`)+`
}`;this.exportOptions.options.minify&&(e=e.replaceAll(/\s/g,"")),this.outputDiv.innerText=e}getNumIncludes(){return Object.values(this.exportOptions.include).map(e=>+e).reduce((e,t)=>e+t,0)}padNum(e){return this.exportOptions.options.padNumbers?(Math.round(e*1e3)/1e3).toFixed(3):Math.round(e*1e3)/1e3}}class mn extends ot{app;allowMods;callback;combo={mods:[],key:""};conflictCheck;listener;static active=!1;constructor(e,t,n,a){super({title:"",width:300,height:168,disableClose:!0,win_id:"keyComboSelector",blocking:!0}),this.app=e,this.allowMods=t,this.callback=n,this.conflictCheck=a??(()=>[]),this.initView(),mn.active=!0}initView(){this.viewElement.replaceChildren(),this.viewElement.classList.add("confirmation");const e=document.createElement("div");e.classList.add("padding"),e.style.gap="0.5rem";const t=document.createElement("div");t.classList.add("label"),t.innerText="Input a key combo and select Ok when finished.",e.appendChild(t);const n=document.createElement("input");n.type="text",n.disabled=!0,n.style.fontSize="1.25rem",n.style.height="1.5rem",n.style.flex="0",n.style.textAlign="center",e.appendChild(n);const a=document.createElement("div");a.classList.add("detail"),a.innerText="No conflicts",a.style.flex="1",e.appendChild(a);const r=document.createElement("div");r.classList.add("menu-options");const s=document.createElement("button");s.innerText="Ok",s.onclick=()=>{this.callback(this.combo),this.closeWindow()},s.classList.add("confirm"),s.disabled=!0;const o=document.createElement("button");o.innerText="Cancel",o.onclick=()=>{this.closeWindow()},r.append(o),r.append(s),e.appendChild(r),this.viewElement.appendChild(e),this.listener=l=>{if(["Meta","Control","Shift","Alt","Escape"].includes(l.key))return;if(this.combo.key=xe.getKeyNameFromEvent(l),this.allowMods){const f=[];for(let c=0;c<Na.length;c++)l[Na[c]]&&f.push(Aa[c]);this.combo.mods=f}n.value=xe.getComboString(this.combo);const u=this.conflictCheck(this.combo);u=="self"?(a.innerText="Combo already binded for this keybind",s.disabled=!0):(s.disabled=!1,u.length>=3?a.innerText=`Conflicts with ${u.length} keybinds`:u.length>=1?a.innerText=`Conflicts with ${u.join(",")}`:a.innerText="No conflicts"),l.preventDefault()},window.addEventListener("keydown",this.listener,!0)}onClose(){window.removeEventListener("keydown",this.listener,!0),mn.active=!1}}class am extends ot{app;observer;conflictMap=this.calculateConflicts();constructor(e){super({title:"Gameplay Keybind Options",width:600,height:400,disableClose:!1,win_id:"gameplay_keybind_options",blocking:!1}),this.app=e,this.initView()}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("div");t.classList.add("pref-container");const n=document.createElement("div");n.classList.add("pref-scrollers");const a=document.createElement("div");a.classList.add("pref-section-scroller");const r=document.createElement("div");r.classList.add("pref-option-scroller"),n.replaceChildren(a,r),this.observer=new IntersectionObserver(s=>{s.forEach(o=>{const l=o.target.dataset.id,u=a.querySelector(`.pref-section[data-id=${l}]`);u&&(o.intersectionRatio>0?u.classList.add("selected"):u.classList.remove("selected"))})},{}),t.replaceChildren(n),a.replaceChildren(...this.createSections()),r.replaceChildren(...this.createOptions()),e.appendChild(t),this.viewElement.appendChild(e)}createSections(){return Object.keys(bt.getTypes()).map(e=>this.createEmptySection(e))}createOptions(){return Object.keys(bt.getTypes()).map(e=>{const t=new Array(bt.getTypes()[e].numCols).fill(null).map((r,s)=>this.createKeybindItem(e,s)),n=document.createElement("div");n.classList.add("pref-group"),n.dataset.id=e;const a=document.createElement("div");return a.classList.add("pref-group-label"),a.innerText=e,n.replaceChildren(a,...t),this.observer.observe(n),n})}createEmptySection(e){const t=document.createElement("div");return t.classList.add("pref-section"),t.dataset.id=e,t.innerText=e,t.onclick=()=>{t.parentElement.parentElement.querySelector(`.pref-group[data-id=${e}]`).scrollIntoView()},t}createKeybindItem(e,t){const n=document.createElement("div");n.classList.add("pref-keybind"),n.dataset.id=e+"-"+t,n.onclick=o=>{o.target.classList.contains("pref-keybind-combo")||n.querySelector(".icon")?.contains(o.target)||this.app.windowManager.openWindow(new mn(this.app,!1,l=>{xe.setGameplayKeybind(e,t,l.key),this.conflictMap=this.calculateConflicts(),n.replaceWith(this.createKeybindItem(e,t))},l=>{const u=this.conflictMap.get(e)?.get(l.key)?.map(f=>Mi[f[0]]?.[f[1]].label??"Column "+f[1])??[];return u.includes(Mi[e]?.[t].label??"Column "+t)?"self":u}))};const a=document.createElement("div");a.classList.add("pref-keybind-label"),a.innerText=Mi[e]?.[t].label??"Column "+t;const r=me.getIcon("REVERT");r.style.width="0.75rem",r.addEventListener("click",()=>{xe.revertGameplayKeybind(e,t),this.conflictMap=this.calculateConflicts(),n.replaceWith(this.createKeybindItem(e,t))}),r.style.display=xe.checkIsDefaultGameplay(e,t)?"none":"block";const s=document.createElement("div");return s.classList.add("pref-keybind-combos"),s.replaceChildren(...xe.getKeysForGameType(e)[t].map(o=>{const l=document.createElement("button");return l.classList.add("pref-keybind-combo"),l.innerText=o,this.conflictMap.get(e).get(o).length>1&&l.classList.add("conflict"),l.onclick=()=>{xe.removeGameplayKeybind(e,t,o),this.conflictMap=this.calculateConflicts(),n.replaceWith(this.createKeybindItem(e,t))},l})),n.replaceChildren(a,r,s),n}calculateConflicts(){const e=new Map;Object.keys(bt.getTypes()).forEach(t=>{const n=new Map;xe.getKeysForGameType(t).forEach((a,r)=>{a.forEach((s,o)=>{n.has(s)||n.set(s,[]),n.get(s).push([t,r,o])})}),e.set(t,n)}),[...this.viewElement.querySelectorAll(".pref-keybind-combo.conflict")].forEach(t=>t.classList.remove("conflict"));for(const t of e.values())for(const n of t.values())n.length!=1&&n.forEach(a=>{const r=this.viewElement.querySelector(`.pref-keybind[data-id=${a[0]}-${a[1]}] .pref-keybind-combos`);r?.children[a[2]]&&r.children[a[2]].classList.add("conflict")});return e}onClose(){this.observer?.disconnect()}}class Fu{static _model;static async getModel(){return this._model||await this._load(),this._model}static async _load(){this._model=[];const e=localStorage.getItem("recentFiles");if(e){try{const t=JSON.parse(e);if(!Array.isArray(t))return;for(const n of t)typeof n!="object"||Array.isArray(n)||typeof n?.name!="string"||typeof n?.path!="string"||this._model.find(a=>a.path==n.path)||this._model.push({name:n.name,path:n.path})}catch{console.log("Failed to load recent file entries");return}await this.saveEntries()}}static async getRecents(){return await this.getModel()}static async addSM(e,t){const n=await this.getModel(),a=n.findIndex(r=>r.path==e);a!=-1&&n.splice(a,1),n.unshift({name:t.properties.TITLE??"Untitled Song",path:e}),this.saveEntries()}static async limitEntries(){(await this.getModel()).splice(15)}static async saveEntries(){this.limitEntries();const e=await Promise.all(this._model.map(t=>Ee.hasFile(t.path)));this._model=this._model.filter((t,n)=>e[n]),localStorage.setItem("recentFiles",JSON.stringify(this._model))}}const rm=`#TITLE:New Song;
#SUBTITLE:;
#ARTIST:;
#TITLETRANSLIT:;
#SUBTITLETRANSLIT:;
#ARTISTTRANSLIT:;
#GENRE:;
#CREDIT:;
#BANNER:;
#BACKGROUND:;
#LYRICSPATH:;
#CDTITLE:;
#MUSIC:;
#OFFSET:0;
#SAMPLESTART:0.000000;
#SAMPLELENGTH:10.000000;
#SELECTABLE:YES;
#BPMS:0.000000=120.000000;
#STOPS:;
#BGCHANGES:;
#FGCHANGES:;
#KEYSOUNDS:;
#ATTACKS:;
`,Iu=[{title:"Metadata",items:[{title:"Title",propName:"TITLE",input:{type:"string"}},{title:"Subtitle",propName:"SUBTITLE",input:{type:"string"}},{title:"Artist",propName:"ARTIST",input:{type:"string"}},{title:"Credit",propName:"CREDIT",input:{type:"string"}},{title:"Genre",propName:"GENRE",input:{type:"string"}},{title:"Origin",propName:"ORIGIN",input:{type:"string"}}]},{title:"Resources",items:[{title:"Audio Track",propName:"MUSIC",input:{type:"file",typeName:"audio",accept:qa,onChange:i=>i.chartManager.loadAudio()}},{title:"Background Image",propName:"BACKGROUND",input:{type:"file",typeName:"image",accept:Oi}},{title:"Banner Image",propName:"BANNER",input:{type:"file",typeName:"image",accept:Oi}},{title:"CD Title",propName:"CDTITLE",input:{type:"file",typeName:"image",accept:Oi}},{title:"CD Image",propName:"CDIMAGE",input:{type:"file",typeName:"image",accept:Oi}},{title:"Jacket",propName:"JACKET",input:{type:"file",typeName:"image",accept:Oi}},{title:"Disc Image",propName:"DISCIMAGE",input:{type:"file",typeName:"image",accept:Oi}}]},{title:"Song",items:[{title:"Song Preview",propName:"SAMPLESTART",input:{type:"custom",create:(i,e,t)=>{const n=()=>{r.value<a.value&&(r.value=a.value);const l=e.properties.SAMPLESTART??"0",u=e.properties.SAMPLELENGTH??"10",f=a.value.toString(),c=(r.value-a.value).toString();t.run({action:()=>{e.properties.SAMPLESTART=f,e.properties.SAMPLELENGTH=c,a.value=parseFloat(f),r.value=parseFloat(f)+parseFloat(c)},undo:()=>{e.properties.SAMPLESTART=l,e.properties.SAMPLELENGTH=u,a.value=parseFloat(l),r.value=parseFloat(l)+parseFloat(u)}})},a=ct.create({value:parseFloat(e.properties.SAMPLESTART??"0"),precision:3,min:0});a.onchange=l=>{if(l===void 0){a.value=parseFloat(e.properties.SAMPLESTART??"0");return}n()};const r=ct.create({value:parseFloat(e.properties.SAMPLESTART??"0")+parseFloat(e.properties.SAMPLELENGTH??"10"),precision:3,min:0});r.onchange=l=>{if(l===void 0){r.value=parseFloat(e.properties.SAMPLESTART??"0")+parseFloat(e.properties.SAMPLELENGTH??"10");return}n()};const s=document.createElement("div"),o=document.createElement("div");return o.innerText="to",s.classList.add("flex-row","flex-column-gap"),s.replaceChildren(a.view,o,r.view),s}}}]}];function Ru(i,e,t,n){switch(n.input.type){case"custom":return n.input.create(i,e,t);case"string":{const a=document.createElement("input");return a.type="text",a.autocomplete="off",a.spellcheck=!1,a.onkeydown=r=>{r.key=="Enter"&&a.blur()},a.onblur=()=>{const r=e.properties[n.propName],s=a.value;t.run({action:()=>{e.properties[n.propName]=s,a.value=s},undo:()=>{e.properties[n.propName]=r,a.value=r??""}})},a.value=e.properties[n.propName]??"",a}case"number":{const a=n.input,r=ct.create({value:parseFloat(e.properties[n.propName]??"15"),...a});return r.onchange=s=>{if(s===void 0){r.value=parseFloat(e.properties[n.propName]??"0");return}const o=e.properties[n.propName],l=s.toString();t.run({action:()=>{e.properties[n.propName]=l,r.value=parseFloat(l)},undo:()=>{e.properties[n.propName]=o,r.value=parseFloat(o??"0")}})},r.view}case"file":{const a=n.input,r=n.input.onChange,s=document.createElement("div");s.classList.add("flex-row","flex-column-gap");const o=document.createElement("input");o.type="text",o.autocomplete="off",o.spellcheck=!1,o.placeholder="click to select a file",o.onclick=c=>{c.preventDefault(),o.blur();const d=st(i.chartManager.smPath);if(window.nw){const h=document.createElement("input");h.type="file",h.accept=a.accept.join(","),h.nwworkingdir=d,h.onchange=()=>{const p=Ee.getRelativePath(d,h.value);f(p)},h.click()}else i.windowManager.openWindow(new Qa(i,{title:`Select a${a.typeName.match(/^[aieouAIEOU].*/)?"n":""} ${a.typeName} file...`,accepted_file_types:a.accept,disableClose:!0,callback:h=>{const p=Ee.getRelativePath(d,h);f(p)}},e.properties[n.propName]?d+"/"+e.properties[n.propName]:i.chartManager.smPath))},o.value=e.properties[n.propName]??"",s.appendChild(o);const l=document.createElement("button");l.style.height="100%",l.classList.add("delete"),l.disabled=!e.properties[n.propName],l.onclick=()=>{f(void 0),l.disabled=!0};const u=me.getIcon("TRASH",12);l.appendChild(u),s.appendChild(l);const f=c=>{const d=e.properties[n.propName]??"";t.run({action:()=>{e.properties[n.propName]=c,o.value=c??"",l.disabled=o.value==""},undo:()=>{e.properties[n.propName]=d,o.value=d,l.disabled=o.value==""}}),r?.(i)};return s}}}class Pu extends ot{app;sm;history;fileTable={};constructor(e){super({title:"New Song",width:450,height:492,disableClose:!0,win_id:"sm_properties",blocking:!0});const t=new Blob([rm],{type:"text/plain"}),n=new File([t],"song.sm",{type:"text/plain"});this.sm=new kc(n),this.history=new Et(e),this.app=e,this.initView()}initView(){this.viewElement.replaceChildren(),this.viewElement.classList.add("sm-properties");const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("div");t.classList.add("label"),t.innerText="Apply to",Iu.forEach(l=>{const u=document.createElement("div");u.classList.add("sm-container");const f=document.createElement("div");f.classList.add("sm-title"),f.innerText=l.title;const c=document.createElement("div");c.classList.add("property-grid"),l.items.forEach(d=>{const h=document.createElement("div");h.classList.add("label"),h.innerText=d.title,c.appendChild(h),d.input.type=="file"?c.appendChild(this.createFileElement(d.propName,d.input.typeName)):c.appendChild(Ru(this.app,this.sm,this.history,d))}),u.appendChild(f),u.appendChild(c),e.appendChild(u)});const n=document.createElement("div");n.classList.add("menu-options");const a=document.createElement("div");a.classList.add("menu-left");const r=document.createElement("div");r.classList.add("menu-right"),n.appendChild(a),n.appendChild(r);const s=document.createElement("button");s.innerText="Cancel",s.onclick=()=>{this.closeWindow()};const o=document.createElement("button");o.innerText="Create",o.classList.add("confirm"),o.onclick=()=>{this.sm.properties.MUSIC===void 0||this.sm.properties.MUSIC===""?this.app.windowManager.openWindow(new Zn(this.app,"No audio file uploaded","Are you sure you want to create a file with no audio?",[{type:"confirm",label:"Yes",callback:()=>{this.createSong(),this.closeWindow()}},{type:"default",label:"No"}])):(this.createSong(),this.closeWindow())},a.appendChild(s),r.appendChild(o),e.appendChild(n),this.viewElement.appendChild(e)}async createSong(){let e=this.sm.properties.TITLE;if(window.nw){const t=nw.require("path"),n=nw.require("process"),a=document.createElement("input");a.type="file",a.nwsaveas=e+".sm",a.onchange=async()=>{const r=t.basename(a.value,t.extname(a.value));e=t.dirname(a.value);const s=t.join(e,r+".sm");await Ee.writeFile(s,this.sm.serialize("sm")),await Promise.all(Object.entries(this.fileTable).map(o=>{const l=t.resolve(t.join(e,o[0])),u=t.resolve(o[1].path);if(!(n.platform=="win32"&&l.toLowerCase()===u.toLowerCase())&&l!==u)return Ee.writeFile(l,o[1])})),await this.app.chartManager.loadSM(s),this.app.windowManager?.getWindowById("select_sm_initial")?.closeWindow()},a.click()}else{if(await Ee.getDirectoryHandle(e)){let t=2;for(;await Ee.getDirectoryHandle(e);)e=`${this.sm.properties.TITLE} ${t++}`}await Ee.writeFile(e+"/song.sm",this.sm.serialize("sm")),await Promise.all(Object.entries(this.fileTable).map(t=>Ee.writeFile(e+`/${t[0]}`,t[1]))),await this.app.chartManager.loadSM(e+"/song.sm"),this.app.windowManager?.getWindowById("select_sm_initial")?.closeWindow()}}createFileElement(e,t){const n=document.createElement("div");n.classList.add("flex-row","flex-column-gap");const a=document.createElement("input");a.type="text",a.autocomplete="off",a.spellcheck=!1,a.placeholder="click to upload a file",a.readOnly=!0,a.onclick=o=>{o.preventDefault(),a.blur();const l=document.createElement("input");l.type="file",l.accept=t=="audio"?"audio/*":"image/*",l.onchange=()=>{const u=l.files?.[0];if(!u)return;this.sm.properties[e]&&this.fileTable[this.sm.properties[e]]&&delete this.fileTable[this.sm.properties[e]];let f=u.name;for(;this.fileTable[u.name]&&(this.fileTable[u.name].size!=u.size||this.fileTable[u.name].type!=u.type);)f="_"+f;this.fileTable[f]=u,a.value=f,this.sm.properties[e]=a.value,r.disabled=!1},l.click()},a.value=this.sm.properties[e]??"",n.appendChild(a);const r=document.createElement("button");r.style.height="100%",r.classList.add("delete"),r.disabled=!0,r.onclick=()=>{this.sm.properties[e]&&this.fileTable[this.sm.properties[e]]&&delete this.fileTable[this.sm.properties[e]],this.sm.properties[e]=void 0,a.value="",r.disabled=!0};const s=me.getIcon("TRASH",12);return r.appendChild(s),n.appendChild(r),n}}class vo extends ot{app;keyHandler;constructor(e,t=!0){super({title:"Open a Song",width:400,height:320,disableClose:t,win_id:"select_sm_initial"}),this.app=e,this.keyHandler=this.handleKeyEvent.bind(this),window.addEventListener("keydown",this.keyHandler),this.initView(),re.on("resize",()=>{this.move(window.innerWidth/2-this.options.width/2*y.general.uiScale,window.innerHeight/2-this.options.height/2*y.general.uiScale)})}onClose(){window.removeEventListener("keydown",this.keyHandler)}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("div");t.classList.add("open-container"),e.appendChild(t);const n=document.createElement("div");n.classList.add("top-container");const a=document.createElement("div");a.classList.add("separator"),a.style.margin="0.5rem";const r=document.createElement("div");r.classList.add("bottom-container"),t.appendChild(n),t.appendChild(a),t.appendChild(r);const s=document.createElement("button");s.style.display="flex",s.style.flexDirection="column",s.style.padding="0.5rem",s.style.backgroundColor="#414352",s.style.color="white",n.appendChild(s);const o=me.getIcon("UPLOAD",30);s.appendChild(o);const l=document.createElement("div");l.innerText=window.nw?"Open an existing song":"Import a song folder",s.appendChild(l),s.onclick=()=>{if(window.nw){const p=document.createElement("input");p.type="file",p.accept=".sm,.ssc",p.onchange=()=>{this.app.chartManager.loadSM(p.value),this.closeWindow()},p.click()}else this.app.windowManager.openWindow(new Qa(this.app,{title:"Select an sm/ssc file...",accepted_file_types:[".sm",".ssc"],disableClose:!0,callback:p=>{this.app.chartManager.loadSM(p),this.closeWindow()}}))};const u=document.createElement("button");u.style.display="flex",u.style.flexDirection="column",u.style.padding="0.5rem",u.style.backgroundColor="#506352",u.style.color="white",n.appendChild(u);const f=me.getIcon("PLUS",30);u.appendChild(f);const c=document.createElement("div");c.innerText="New Song",u.appendChild(c),u.onclick=()=>{this.app.windowManager.openWindow(new Pu(this.app))};const d=document.createElement("div");d.innerText="Recently Opened",d.classList.add("title"),r.appendChild(d);const h=document.createElement("div");h.classList.add("recent-selector"),r.appendChild(h),Fu.getRecents().then(p=>p.forEach(m=>{const g=document.createElement("div");g.classList.add("recent-item");const b=document.createElement("div");b.classList.add("recent-name"),b.innerText=m.name;const x=document.createElement("div");x.classList.add("recent-path"),x.innerText=m.path,g.appendChild(b),g.appendChild(x),g.onclick=()=>{h.querySelectorAll(".selected").forEach(w=>w.classList.remove("selected")),g.classList.add("selected")},g.ondblclick=()=>{this.app.chartManager.loadSM(m.path),this.closeWindow()},h.appendChild(g)})),this.viewElement.appendChild(e)}handleKeyEvent(e){if(!this.windowElement.classList.contains("focused"))return;const t=this.viewElement.querySelector(".selected");if(t){if(e.code=="ArrowUp"){e.preventDefault(),e.stopImmediatePropagation();const n=t.previousElementSibling;n&&(t.parentElement.querySelectorAll(".selected").forEach(a=>a.classList.remove("selected")),n.classList.add("selected"),On(n,{scrollMode:"if-needed",block:"nearest",inline:"nearest"}))}if(e.code=="ArrowDown"){e.preventDefault(),e.stopImmediatePropagation();const n=t.nextElementSibling;n&&(t.parentElement.querySelectorAll(".selected").forEach(a=>a.classList.remove("selected")),n.classList.add("selected"),On(n,{scrollMode:"if-needed",block:"nearest",inline:"nearest"}))}}}}const cn={file:{type:"menu",title:"File",options:[{type:"selection",id:"newSong"},{type:"selection",id:"openSong"},{type:"separator"},{type:"selection",id:"previousSong"},{type:"selection",id:"nextSong"},{type:"separator"},{type:"selection",id:"save"},{type:"selection",id:"export"},{type:"separator"},{type:"selection",id:"capture"}]},edit:{type:"menu",title:"Edit",options:[{type:"selection",id:"cut"},{type:"selection",id:"copy"},{type:"selection",id:"paste"},{type:"selection",id:"pasteReplace"},{type:"separator"},{type:"selection",id:"undo"},{type:"selection",id:"redo"},{type:"separator"},{type:"checkbox",id:"mousePlacement",checked:()=>y.chart.mousePlacement}]},view:{type:"menu",title:"View",options:[{type:"dropdown",title:"Cursor",options:[{type:"selection",id:"cursorUp"},{type:"selection",id:"cursorDown"},{type:"separator"},{type:"selection",id:"previousNote"},{type:"selection",id:"nextNote"},{type:"separator"},{type:"selection",id:"previousMeasure"},{type:"selection",id:"nextMeasure"},{type:"separator"},{type:"selection",id:"previousStream"},{type:"selection",id:"nextStream"},{type:"separator"},{type:"selection",id:"jumpChartStart"},{type:"selection",id:"jumpChartEnd"},{type:"separator"},{type:"selection",id:"jumpSongStart"},{type:"selection",id:"jumpSongEnd"}]},{type:"dropdown",title:"Snap",options:[{type:"selection",id:"decreaseSnap"},{type:"selection",id:"increaseSnap"}]},{type:"dropdown",title:"Scroll",options:[{type:"checkbox",id:"XMod",checked:()=>!y.chart.CMod},{type:"checkbox",id:"CMod",checked:()=>y.chart.CMod},{type:"separator"},{type:"selection",id:"increaseScrollSpeed"},{type:"selection",id:"decreaseScrollSpeed"}]},{type:"dropdown",title:"Zoom",options:[{type:"selection",id:"zoomIn"},{type:"selection",id:"zoomOut"},{type:"separator"},{type:"selection",id:"zoomDefault"}]},{type:"separator"},{type:"selection",id:"playMode"},{type:"selection",id:"playModeStart"},{type:"separator"},{type:"selection",id:"recordMode"},{type:"selection",id:"recordModeStart"},{type:"separator"},{type:"checkbox",id:"reverse",checked:()=>y.chart.reverse},{type:"checkbox",id:"hideWarpedArrows",checked:()=>y.chart.hideWarpedArrows},{type:"checkbox",id:"hideFakedArrows",checked:()=>y.chart.hideFakedArrows},{type:"checkbox",id:"doSpeedChanges",checked:()=>y.chart.doSpeedChanges}]},chart:{type:"menu",title:"Chart",options:[{type:"selection",id:"openChart"},{type:"separator"},{type:"selection",id:"previousChart"},{type:"selection",id:"nextChart"},{type:"separator"},{type:"selection",id:"songProperties"},{type:"separator"},{type:"selection",id:"timingDataRow"}]},selection:{type:"menu",title:"Selection",options:[{type:"dropdown",title:"Convert",options:[{type:"selection",id:"convertHoldsRolls"},{type:"selection",id:"convertRollsHolds"},{type:"selection",id:"swapHoldsRolls"},{type:"separator"},{type:"selection",id:"convertHoldsTaps"},{type:"selection",id:"convertTapsMines"},{type:"selection",id:"convertTapsLifts"},{type:"selection",id:"convertTapsFakes"}]},{type:"dropdown",title:"Mirror",options:[{type:"selection",id:"mirrorHorizontally"},{type:"selection",id:"mirrorVertically"},{type:"selection",id:"mirrorBoth"}]},{type:"dropdown",title:"Stretch",options:[{type:"selection",id:"expand2to1"},{type:"selection",id:"expand3to2"},{type:"selection",id:"expand4to3"},{type:"separator"},{type:"selection",id:"compress1to2"},{type:"selection",id:"compress2to3"},{type:"selection",id:"compress3to4"}]},{type:"dropdown",title:"Shift",options:[{type:"dropdown",title:"Up",options:[{type:"selection",id:"shiftUp4m"},{type:"selection",id:"shiftUp2m"},{type:"selection",id:"shiftUp1m"},{type:"selection",id:"shiftUp4th"},{type:"selection",id:"shiftUp8th"},{type:"selection",id:"shiftUp12th"},{type:"selection",id:"shiftUp16th"},{type:"selection",id:"shiftUp24th"},{type:"selection",id:"shiftUp32nd"},{type:"selection",id:"shiftUp48th"},{type:"selection",id:"shiftUp64th"},{type:"selection",id:"shiftUp96th"},{type:"selection",id:"shiftUp192nd"}]},{type:"dropdown",title:"Down",options:[{type:"selection",id:"shiftDown4m"},{type:"selection",id:"shiftDown2m"},{type:"selection",id:"shiftDown1m"},{type:"selection",id:"shiftDown4th"},{type:"selection",id:"shiftDown8th"},{type:"selection",id:"shiftDown12th"},{type:"selection",id:"shiftDown16th"},{type:"selection",id:"shiftDown24th"},{type:"selection",id:"shiftDown32nd"},{type:"selection",id:"shiftDown48th"},{type:"selection",id:"shiftDown64th"},{type:"selection",id:"shiftDown96th"},{type:"selection",id:"shiftDown192nd"}]}]},{type:"dropdown",title:"Quantize",options:[{type:"selection",id:"quantize4th"},{type:"selection",id:"quantize8th"},{type:"selection",id:"quantize12th"},{type:"selection",id:"quantize16th"},{type:"selection",id:"quantize24th"},{type:"selection",id:"quantize32nd"},{type:"selection",id:"quantize48th"},{type:"selection",id:"quantize64th"},{type:"selection",id:"quantize96th"}]},{type:"dropdown",title:"Timing",options:[{type:"selection",id:"convertSTOPS"},{type:"selection",id:"convertWARPS"},{type:"selection",id:"convertFAKES"},{type:"selection",id:"convertDELAYS"}]},{type:"dropdown",title:"Parity",options:[{type:"selection",id:"parityNone"},{type:"selection",id:"parityLeft"},{type:"selection",id:"parityRight"},{type:"separator"},{type:"selection",id:"parityLeftHeel"},{type:"selection",id:"parityLeftToe"},{type:"selection",id:"parityRightHeel"},{type:"selection",id:"parityRightToe"}]},{type:"separator"},{type:"selection",id:"setSongPreview"},{type:"separator"},{type:"selection",id:"exportNotedata"},{type:"separator"},{type:"selection",id:"selectBeforeCursor"},{type:"selection",id:"selectAfterCursor"},{type:"selection",id:"selectAll"}]},audio:{type:"menu",title:"Audio",options:[{type:"selection",id:"detectSync"},{type:"separator"},{type:"checkbox",id:"assistTick",checked:()=>y.audio.assistTick&&he.assist},{type:"checkbox",id:"metronome",checked:()=>y.audio.metronome&&he.assist},{type:"separator"},{type:"dropdown",title:()=>"Master Volume ("+Math.round(y.audio.masterVolume*100)+"%)",options:[{type:"selection",id:"volumeUp"},{type:"selection",id:"volumeDown"}]},{type:"dropdown",title:()=>"Song Volume ("+Math.round(y.audio.songVolume*100)+"%)",options:[{type:"selection",id:"songVolumeUp"},{type:"selection",id:"songVolumeDown"}]},{type:"dropdown",title:()=>"Effect Volume ("+Math.round(y.audio.soundEffectVolume*100)+"%)",options:[{type:"selection",id:"effectvolumeUp"},{type:"selection",id:"effectvolumeDown"}]},{type:"dropdown",title:()=>"Playback rate ("+Math.round(y.audio.rate*100)+"%)",options:[{type:"selection",id:"rateUp"},{type:"selection",id:"rateDown"},{type:"separator"},{type:"selection",id:"rateDefault"}]},{type:"separator"},{type:"selection",id:"showEq"}]},preferences:{type:"menu",title:"Preferences",options:[{type:"selection",id:"options"},{type:"selection",id:"themes"},{type:"selection",id:"keybinds"},{type:"selection",id:"gameplayKeybinds"},{type:"selection",id:"noteskinWindow"}]},help:{type:"menu",title:"Help",options:[{type:"selection",id:"about"},{type:"selection",id:"openGuide"},{type:"selection",id:"openChangelog"}]}},oc=["cut","copy","paste","pasteReplace"],lc={edit:[{ids:["delete"],after:"redo"},{ids:["toggleEditTiming","toggleAddTiming","previousNoteType","nextNoteType","noteTypeTap","noteTypeMine","noteTypeFake","noteTypeLift","quant4","quant8","quant12","quant16","quant24","quant32","quant48","quant64","quant96","quant192"],after:"mousePlacement"}],view:[{ids:["playback","selectRegion"]}],debug:[{ids:["showFPSCounter","showDebugTimers"]}]};class ni extends ot{static GROUPS;app;observer;searchDropdown;conflictMap=this.calculateConflicts();constructor(e){super({title:"Keybind Options",width:600,height:400,disableClose:!1,win_id:"keybind_options",blocking:!1}),this.app=e,ni.GROUPS||(ni.GROUPS=ni.createGroups()),this.initView()}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("div");t.classList.add("pref-container");const n=document.createElement("div");n.classList.add("pref-search");const a=document.createElement("input");a.classList.add("pref-search-bar"),a.type="text",a.placeholder="Search for a keybind...",a.oninput=()=>{o.replaceChildren(...this.createSections(a.value)),l.replaceChildren(...this.createOptions(a.value))};const r=hi.create(["Name","Key"],"Name");r.onChange(()=>{o.replaceChildren(...this.createSections(a.value)),l.replaceChildren(...this.createOptions(a.value))}),this.searchDropdown=r,n.replaceChildren(a,r.view);const s=document.createElement("div");s.classList.add("pref-scrollers");const o=document.createElement("div");o.classList.add("pref-section-scroller");const l=document.createElement("div");l.classList.add("pref-option-scroller"),s.replaceChildren(o,l),this.observer=new IntersectionObserver(u=>{u.forEach(f=>{const c=f.target.dataset.id,d=o.querySelector(`.pref-section[data-id=${c}]`);d&&(f.intersectionRatio>0?d.classList.add("selected"):d.classList.remove("selected"))})},{}),t.replaceChildren(n,s),o.replaceChildren(...this.createSections()),l.replaceChildren(...this.createOptions()),e.appendChild(t),this.viewElement.appendChild(e)}createSections(e=""){return Object.keys(ni.GROUPS).filter(t=>ni.GROUPS[t].some(n=>this.filterID(e,n))).map(t=>this.createEmptySection(cn[t]?.title??ko(t),t))}createOptions(e=""){return Object.keys(ni.GROUPS).filter(t=>ni.GROUPS[t].some(n=>this.filterID(e,n))).map(t=>{const n=ni.GROUPS[t].filter(s=>this.filterID(e,s)).map(s=>this.createKeybindItem(s)),a=document.createElement("div");a.classList.add("pref-group"),a.dataset.id=t;const r=document.createElement("div");return r.classList.add("pref-group-label"),r.innerText=cn[t]?.title??ko(t),a.replaceChildren(r,...n),this.observer.observe(a),a})}static createGroups(){const e=Object.keys(We),t={};return Object.keys(cn).forEach(n=>{t[n]=this.expandMenubarOptions(cn[n]).map(a=>{const r=e.indexOf(a);return r!=-1&&e.splice(r,1),a}).filter(a=>!oc.includes(a))}),Object.keys(lc).forEach(n=>{t[n]===void 0&&(t[n]=[]),lc[n].forEach(a=>{let r=0;if(a.after){const s=t[n].findIndex(o=>a.after==o)+1;s!=0&&(r=s)}t[n].splice(r,0,...a.ids),a.ids.forEach(s=>{const o=e.indexOf(s);o!=-1&&e.splice(o,1)})})}),oc.forEach(n=>{const a=e.indexOf(n);a!=-1&&e.splice(a,1)}),e.length>0&&(console.warn("Missing keybinds not shown:"),console.warn(e)),t}filterID(e,t){if((this.searchDropdown?.value??"Name")=="Name")return(We[t].bindLabel??We[t].label).toLowerCase().includes(e.toLowerCase());{const n=xe.getCombosForKeybind(t);if(n.some(r=>r.key.toLowerCase().includes(e.toLowerCase()))||n.some(r=>(Nu[r.key]??r.key).toLowerCase().includes(e.toLowerCase())))return!0;let a=e.split(" ").map(r=>r.toLowerCase());return n.some(r=>(a.includes("shift")||a.includes("⇧"))&&!r.mods.includes(kn.SHIFT)||(a.includes("ctrl")||a.includes("control")||a.includes("⌃"))&&!r.mods.includes(kn.CTRL)||(a.includes("meta")||a.includes("cmd")||a.includes("command")||a.includes("⌘"))&&!r.mods.includes(kn.META)||(a.includes("alt")||a.includes("⌥"))&&!r.mods.includes(kn.ALT)?!1:(a=a.filter(s=>!["shift","ctrl","control","meta","cmd","command","alt","⇧","⌃","⌘","⌥",""].includes(s)),a.length==0||a.length==1&&r.key.toLowerCase().includes(a[0])))}}static expandMenubarOptions(e){switch(e.type){case"menu":case"dropdown":return e.options.map(t=>this.expandMenubarOptions(t)).flat();case"selection":case"checkbox":return[e.id];case"separator":return[]}}createEmptySection(e,t){const n=document.createElement("div");return n.classList.add("pref-section"),n.dataset.id=t,n.innerText=e,n.onclick=()=>{n.parentElement.parentElement.querySelector(`.pref-group[data-id=${t}]`).scrollIntoView()},n}createKeybindItem(e){const t=document.createElement("div");t.classList.add("pref-keybind"),t.dataset.id=e,t.onclick=s=>{s.target.classList.contains("pref-keybind-combo")||t.querySelector(".icon")?.contains(s.target)||this.app.windowManager.openWindow(new mn(this.app,!0,o=>{xe.setKeybind(e,o),this.conflictMap=this.calculateConflicts(),t.replaceWith(this.createKeybindItem(e))},o=>{const l=this.conflictMap.get(xe.getComboString(o))?.map(u=>u[0]).map(u=>We[u].bindLabel??We[u].label)??[];return l.includes(e)?"self":l}))};const n=document.createElement("div");n.classList.add("pref-keybind-label"),n.innerText=We[e].bindLabel??We[e].label;const a=me.getIcon("REVERT");a.style.width="0.75rem",a.addEventListener("click",()=>{xe.revertKeybind(e),this.conflictMap=this.calculateConflicts(),t.replaceWith(this.createKeybindItem(e))}),a.style.display=xe.checkIsDefault(e)?"none":"block";const r=document.createElement("div");return r.classList.add("pref-keybind-combos"),r.replaceChildren(...xe.getCombosForKeybind(e).map(s=>{const o=document.createElement("button");return o.classList.add("pref-keybind-combo"),o.innerText=xe.getComboString(s),this.conflictMap.get(xe.getComboString(s)).length>1&&o.classList.add("conflict"),o.onclick=()=>{xe.removeKeybind(e,s),this.conflictMap=this.calculateConflicts(),t.replaceWith(this.createKeybindItem(e))},o})),t.replaceChildren(n,a,r),t}calculateConflicts(){const e=new Map;Object.keys(We).forEach(t=>{xe.getCombosForKeybind(t).forEach((n,a)=>{const r=xe.getComboString(n);e.has(r)||e.set(r,[]),e.get(r).push([t,a])})}),[...this.viewElement.querySelectorAll(".pref-keybind-combo.conflict")].forEach(t=>t.classList.remove("conflict"));for(const t of e.values())t.length!=1&&t.forEach(n=>{const a=this.viewElement.querySelector(`.pref-keybind[data-id=${n[0]}] .pref-keybind-combos`);a?.children[n[1]]&&a.children[n[1]].classList.add("conflict")});return e}onClose(){this.observer?.disconnect()}}class it{static noteskins=new Map;static register(e){for(const t of new Set(e.gameTypes))it.noteskins.has(t)||it.noteskins.set(t,new Map),it.noteskins.get(t).set(e.id,e)}static async getNoteskin(e,t){const n=this.noteskins.get(e.id);if(!n||n.size==0)return;const a=n.get(t)??[...n.values()][0];return n.get(t)||de.createFormatted(`Couldn't find the noteskin ${t}!`,"warn"),await a.load()}static getNoteskinData(e,t){const n=this.noteskins.get(e.id);return!n||n.size==0?void 0:n.get(t)??[...n.values()][0]}static getNoteskins(){return this.noteskins}static getPreviewUrl(e,t){return this.getNoteskinData(e,t).preview}}it.register({id:"default",gameTypes:["dance-single","dance-double","dance-couple","dance-solo","dance-solodouble","dance-threepanel","dance-threedouble"],load:async()=>(await Ge(async()=>{const{default:i}=await import("./Noteskin-CzSCMjM2.js");return{default:i}},__vite__mapDeps([7,1,2,8]))).default,preview:new URL("/smeditor/assets/preview-OxO8T-xD.png",import.meta.url).href,title:"Scalable",subtitle:"Pete-Lawrence"});it.register({id:"cf-chrome",gameTypes:["dance-single","dance-double","dance-couple","dance-solo","dance-solodouble","dance-threepanel","dance-threedouble"],load:async()=>(await Ge(async()=>{const{default:i}=await import("./Noteskin-Dh3zA_cV.js");return{default:i}},__vite__mapDeps([9,1,2,8]))).default,preview:new URL("/smeditor/assets/preview-Bd1omMHV.png",import.meta.url).href,title:"CF_CHROME",subtitle:"Pete-Lawrence"});it.register({id:"ddr-note",gameTypes:["dance-single","dance-double","dance-couple","dance-solo","dance-solodouble","dance-threepanel","dance-threedouble"],load:async()=>(await Ge(async()=>{const{default:i}=await import("./Noteskin-4RlPM8HL.js");return{default:i}},__vite__mapDeps([10,1,2,11,8]))).default,preview:new URL("/smeditor/assets/preview-DdYrG22o.png",import.meta.url).href,title:"DDR-Note",subtitle:"Pete-Lawrence"});it.register({id:"ddr-note-itg",gameTypes:["dance-single","dance-double","dance-couple","dance-solo","dance-solodouble","dance-threepanel","dance-threedouble"],load:async()=>(await Ge(async()=>{const{default:i}=await import("./Noteskin-DlQiOh82.js");return{default:i}},__vite__mapDeps([12,1,2,11,8]))).default,preview:new URL("/smeditor/assets/preview-mEgpRzfG.png",import.meta.url).href,title:"DDR-Note (ITG quants)",subtitle:"Pete-Lawrence"});it.register({id:"ddr-rainbow",gameTypes:["dance-single","dance-double","dance-couple"],load:async()=>(await Ge(async()=>{const{default:i}=await import("./Noteskin-EER82b4p.js");return{default:i}},__vite__mapDeps([13,1,2,11,8]))).default,preview:new URL("/smeditor/assets/preview-CSm_jZ6l.png",import.meta.url).href,title:"DDR-Rainbow",subtitle:"LemmaEOF"});it.register({id:"ddr-rainbow-itg",gameTypes:["dance-single","dance-double","dance-couple"],load:async()=>(await Ge(async()=>{const{default:i}=await import("./Noteskin-BXpQSKgH.js");return{default:i}},__vite__mapDeps([14,1,2,11,8]))).default,preview:new URL("/smeditor/assets/preview-BIggbhNp.png",import.meta.url).href,title:"DDR-Rainbow (ITG quants)",subtitle:"LemmaEOF"});it.register({id:"metal",gameTypes:["dance-single","dance-double","dance-couple","dance-solo","dance-solodouble","dance-threepanel","dance-threedouble"],load:async()=>(await Ge(async()=>{const{default:i}=await import("./Noteskin-DHpT2qg6.js");return{default:i}},__vite__mapDeps([15,1,2,8]))).default,preview:new URL("/smeditor/assets/preview-CGpd3Xps.png",import.meta.url).href,title:"Metal",subtitle:"Pete-Lawrence"});it.register({id:"pastel",gameTypes:["dance-single","dance-double","dance-couple","dance-solo","dance-solodouble","dance-threepanel","dance-threedouble"],load:async()=>(await Ge(async()=>{const{default:i}=await import("./Noteskin-BvUBNE7r.js");return{default:i}},__vite__mapDeps([16,1,2,11,8]))).default,preview:new URL("/smeditor/assets/preview-D-gUhvzF.png",import.meta.url).href,title:"Pastel",subtitle:"halcyoniix"});it.register({id:"dividebyzero",gameTypes:["dance-single","dance-double","dance-couple","dance-solo","dance-solodouble","dance-threepanel","dance-threedouble"],load:async()=>(await Ge(async()=>{const{default:i}=await import("./Noteskin-CnY-tyuu.js");return{default:i}},__vite__mapDeps([17,1,2,11,8]))).default,preview:new URL("/smeditor/assets/preview-BveM7vOk.png",import.meta.url).href,title:"DivideByZero",subtitle:"MinaciousGrace"});it.register({id:"subtractbyzero",gameTypes:["dance-single","dance-double","dance-couple","dance-solo","dance-solodouble","dance-threepanel","dance-threedouble"],load:async()=>(await Ge(async()=>{const{default:i}=await import("./Noteskin-BHuyla-7.js");return{default:i}},__vite__mapDeps([18,1,2,11,8]))).default,preview:new URL("/smeditor/assets/preview-0QJpt-dz.png",import.meta.url).href,title:"SubtractByZero",subtitle:"qwertyzoro/Vague"});it.register({id:"sm4",gameTypes:["dance-single","dance-double","dance-couple","dance-solo","dance-solodouble","dance-threepanel","dance-threedouble"],load:async()=>(await Ge(async()=>{const{default:i}=await import("./Noteskin-B_jYTiyf.js");return{default:i}},__vite__mapDeps([19,1,2,11,8]))).default,preview:new URL("/smeditor/assets/preview-B57yH2sm.png",import.meta.url).href,title:"SM4",subtitle:"from SM4"});it.register({id:"sm4-bold",gameTypes:["dance-single","dance-double","dance-couple","dance-solo","dance-solodouble","dance-threepanel","dance-threedouble"],load:async()=>(await Ge(async()=>{const{default:i}=await import("./Noteskin-CKesfFF2.js");return{default:i}},__vite__mapDeps([20,1,2,11,8]))).default,preview:new URL("/smeditor/assets/preview-WAGM24LC.png",import.meta.url).href,title:"SM4 Bold",subtitle:"from SM4"});it.register({id:"starlight-vivid",gameTypes:["dance-single","dance-double","dance-couple"],load:async()=>(await Ge(async()=>{const{default:i}=await import("./Noteskin-DF6KNVAG.js");return{default:i}},__vite__mapDeps([21,1,2,11,8]))).default,preview:new URL("/smeditor/assets/preview-Co7w1-gB.png",import.meta.url).href,title:"SLNEXXT-vivid",subtitle:"from STARLiGHT-NEXXT"});it.register({id:"default",gameTypes:["pump-single","pump-double","pump-couple","pump-versus","pump-halfdouble"],load:async()=>(await Ge(async()=>{const{default:i}=await import("./Noteskin-Bnk-FYsf.js");return{default:i}},__vite__mapDeps([22,1,2,11,8]))).default,preview:new URL("/smeditor/assets/preview-ChWRgpap.png",import.meta.url).href,title:"Fiesta"});it.register({id:"fourv2",gameTypes:["pump-single","pump-double","pump-couple","pump-versus","pump-halfdouble"],load:async()=>(await Ge(async()=>{const{default:i}=await import("./Noteskin-CYo9De3k.js");return{default:i}},__vite__mapDeps([23,1,2,11,8]))).default,preview:new URL("/smeditor/assets/preview-BC8deddd.png",import.meta.url).href,title:"FourV2",subtitle:"Jousway"});it.register({id:"prime",gameTypes:["pump-single","pump-double","pump-couple","pump-versus","pump-halfdouble"],load:async()=>(await Ge(async()=>{const{default:i}=await import("./Noteskin-BMTRjynq.js");return{default:i}},__vite__mapDeps([24,1,2,11,8]))).default,preview:new URL("/smeditor/assets/preview-CIFre-Xk.png",import.meta.url).href,title:"Prime"});const sm="/smeditor/assets/preview-CAPSxB0Y.png";class om extends ot{app;grid;lastGameType=null;constructor(e){super({title:"Noteskin Selection",width:600,height:400,disableClose:!1,win_id:"noteskin-selection",blocking:!1}),this.app=e,this.initView(),this.loadGrid(),re.on("chartLoaded",()=>{const t=e.chartManager.loadedChart.gameType.id;this.lastGameType!=t&&this.loadGrid()})}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("input");t.classList.add("pref-search-bar"),t.type="text",t.placeholder="Search for a noteskin...",t.oninput=()=>{this.filterGrid(t.value)};const n=document.createElement("div");n.classList.add("noteskin-grid"),this.grid=n,e.replaceChildren(t,n),this.viewElement.appendChild(e)}loadGrid(){if(this.grid.replaceChildren(),!this.app.chartManager.loadedChart)return;const e=this.app.chartManager.loadedChart.gameType;this.lastGameType=e.id;const t=it.getNoteskins().get(e.id);if(t)for(const[n,a]of t.entries()){const r=document.createElement("div"),s=document.createElement("img"),o=document.createElement("div"),l=document.createElement("div"),u=document.createElement("div");r.classList.add("noteskin-cell"),o.classList.add("noteskin-label"),l.classList.add("noteskin-title"),u.classList.add("noteskin-subtitle"),l.innerText=a.title??n,u.innerText=a.subtitle??"",s.src=it.getPreviewUrl(e,n),s.onerror=()=>{s.src=sm},r.replaceChildren(s,o),o.replaceChildren(l,u),this.grid.appendChild(r),n==y.chart.noteskin.name&&(r.classList.add("selected"),setTimeout(()=>{r.scrollIntoView({behavior:y.general.smoothAnimations?"smooth":"instant",block:"center"})})),r.dataset.id=n,r.dataset.title=a.title??"",r.dataset.subtitle=a.subtitle??"",r.onclick=()=>{y.chart.noteskin.name!=n&&(this.app.chartManager.chartView?.swapNoteskin(n),this.removeAllSelections(),r.classList.add("selected"))}}}removeAllSelections(){[...this.grid.querySelectorAll(".selected")].forEach(e=>e.classList.remove("selected"))}filterGrid(e){[...this.grid.children].forEach(t=>{if(!(t instanceof HTMLDivElement))return;const n=t,a=this.containsQuery(e,n.dataset.id)||this.containsQuery(e,n.dataset.title)||this.containsQuery(e,n.dataset.subtitle);n.style.display=a?"":"none"})}containsQuery(e,t){return t?t.toLowerCase().includes(e.trim().toLowerCase()):!1}}class lm extends ot{app;metronomeInterval;startTime;me_high=new Es.Howl({src:Oc,volume:y.audio.soundEffectVolume});me_low=new Es.Howl({src:Nc,volume:y.audio.soundEffectVolume});tickLines=[];resultLines=[];previousOffsets=[];keyHandler;constructor(e){super({title:"Offset Adjuster",width:300,height:200,win_id:"offset",blocking:!0}),this.app=e,this.initView(),this.startTime=performance.now();let t=this.startTime+500;this.tickLines.push({time:t+500,beat:0}),this.tickLines.push({time:t+500*2,beat:1}),this.tickLines.push({time:t+500*3,beat:2}),this.tickLines.push({time:t+500*4,beat:3});let n=0;this.metronomeInterval=setInterval(()=>{const a=performance.now();if(a-t>500){for(t=a,(n%4==0?this.me_high:this.me_low).play();this.tickLines[0]?.time+1e3<a;)this.tickLines.shift();this.tickLines.push({time:t+500*4,beat:n+4}),n++}this.resultLines=this.resultLines.filter(r=>a-r.startTime<8e3)},5),this.keyHandler=a=>{if(a.code.startsWith("Digit")||a.code.startsWith("Key")||a.code=="Space"){let r=this.tickLines[0];const s=performance.now();for(const l of this.tickLines)if(s-l.time+y.play.offset*1e3<300){r=l;break}a.preventDefault();const o=s-r.time+y.play.offset*1e3;o>-300&&(this.tickLines.splice(this.tickLines.indexOf(r),1),this.resultLines.push({startTime:performance.now(),offset:o}),this.previousOffsets.push(o),this.previousOffsets.length==16&&(Sc(this.previousOffsets)<70&&(y.play.offset-=Ha(this.previousOffsets)/1e3),this.previousOffsets=[]))}},window.addEventListener("keydown",this.keyHandler)}initView(){this.viewElement.replaceChildren();const e=document.createElement("canvas");this.viewElement.appendChild(e);const t=this.drawEQ(e);requestAnimationFrame(t)}drawEQ(e){const t=e.getContext("2d");t.canvas.width=250,t.canvas.height=100;const n=()=>{t.fillStyle="rgba(0, 0, 0, 1)",t.fillRect(0,0,e.width,e.height),t.fillStyle="rgb(255, 255, 255)",t.fillRect(e.width/2-1,8,2,e.height-16);const a=performance.now();for(const r of this.resultLines){t.fillStyle="rgba(255, 255, 255, 1)";const s=Math.min(1,4-(a-r.startTime)/2e3);if(r.offset<0&&(t.fillStyle=`rgba(160, ${et(160,0,-r.offset/250)}, ${et(160,0,-r.offset/250)}, ${s})`),r.offset>0&&(t.fillStyle=`rgba(${et(160,0,r.offset/250)}, ${et(160,0,r.offset/250)}, 160, ${s})`),t.fillRect(e.width/2-.5+r.offset/4,12,1,e.height-24),a-r.startTime<250){const o=(a-r.startTime)/250;t.globalAlpha=1-o,t.fillRect(e.width/2-.5-o*3+r.offset/4,12-o*10,1+o*6,e.height-24+o*20)}t.globalAlpha=1}for(const r of this.tickLines){const s=r.time-a-y.play.offset*1e3;t.fillStyle="rgba(255, 255, 255, 0.8)",r.beat%4!=0?t.fillRect(e.width/2-1-s/4,12,2,e.height-24):t.fillRect(e.width/2-2-s/4,12,4,e.height-24)}e.closest("#windows")&&requestAnimationFrame(n)};return n}onClose(){clearInterval(this.metronomeInterval),window.removeEventListener("keydown",this.keyHandler)}}class cm extends ot{app;changeHandler=()=>this.initView();constructor(e){super({title:"Song Properties",width:450,height:486,disableClose:!1,win_id:"sm_properties",blocking:!1}),this.app=e,this.initView(),re.on("smLoaded",this.changeHandler),re.on("undo",this.changeHandler),re.on("redo",this.changeHandler)}onClose(){re.off("smLoaded",this.changeHandler),re.off("undo",this.changeHandler),re.off("redo",this.changeHandler)}initView(){this.viewElement.replaceChildren(),this.viewElement.classList.add("sm-properties");const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("div");t.classList.add("label"),t.innerText="Apply to",Iu.forEach(n=>{const a=document.createElement("div");a.classList.add("sm-container");const r=document.createElement("div");r.classList.add("sm-title"),r.innerText=n.title;const s=document.createElement("div");s.classList.add("property-grid"),n.items.forEach(o=>{const l=document.createElement("div");l.classList.add("label"),l.innerText=o.title,s.appendChild(l),s.appendChild(Ru(this.app,this.app.chartManager.loadedSM,Et.instance,o))}),a.appendChild(r),a.appendChild(s),e.appendChild(a)}),this.viewElement.appendChild(e)}}var ps,cc;function um(){if(cc)return ps;cc=1,ps=s;var i=8192,e=65536,t=new ArrayBuffer(e*4),n=new Float64Array(t,e,i),a=new Float64Array(t,e*2,i/2),r=o({Math,Float64Array},null,t);function s(l){if(!l)throw Error("Input data is not provided, pass an array.");var u=l.length;if(u>i)throw Error("Input length is too big, must be under "+i);var f=Math.floor(Math.log(u)/Math.LN2);if(Math.pow(2,f)!==u)throw Error("Invalid array size, must be a power of 2.");return n.set(l),r(u,f),a.subarray(0,u/2)}function o(l,u,f){var c=6.283185307179586,d=l.Math.sqrt,h=l.Math.sin,p=l.Math.cos,m=l.Math.abs,g=l.Math.SQRT1_2,b=l.Math.imul,x=new l.Float64Array(f),w=new l.Float64Array(f),E=8192,C=16384;function B(O,H){O=O|0,H=H|0;var Y=0,ae=0,M=0,P=0,v=0,S=0,$=0,L=0,W=0,V=0,J=0,N=0,R=0,ne=0,ie=0,ee=0,Te=0,Ne=0,ve=0,be=0,Le=0,Be=0,at=0,rt=0,_=0,X=0,G=0,T=0,k=0,z=0,j=0,Q=0;for(Y=O>>>1,M=2/+(O|0),D(O),z=0,Q=4;(z|0)<(O|0);Q=b(Q,4)){for(j=z;(j|0)<(O|0);j=j+Q|0)be=w[j<<3>>3]-w[j+1<<3>>3],w[j<<3>>3]=w[j<<3>>3]+w[j+1<<3>>3],w[j+1<<3>>3]=be;z=b(2,Q-1)}for(P=2,$=O>>>1;$=$>>>1;){z=0,P=P<<1,Q=P<<1,v=P>>>2,S=P>>>3;do{if((v|0)!=1)for(j=z;(j|0)<(O|0);j=j+Q|0)N=j,R=N+v|0,ne=R+v|0,ie=ne+v|0,L=w[ne<<3>>3]+w[ie<<3>>3],w[ie<<3>>3]=w[ie<<3>>3]-w[ne<<3>>3],w[ne<<3>>3]=w[N<<3>>3]-L,w[N<<3>>3]=w[N<<3>>3]+L,N=N+S|0,R=R+S|0,ne=ne+S|0,ie=ie+S|0,L=w[ne<<3>>3]+w[ie<<3>>3],W=w[ne<<3>>3]-w[ie<<3>>3],L=-L*g,W=W*g,be=+w[R<<3>>3],w[ie<<3>>3]=L+be,w[ne<<3>>3]=L-be,w[R<<3>>3]=w[N<<3>>3]-W,w[N<<3>>3]=w[N<<3>>3]+W;else for(j=z;(j|0)<(O|0);j=j+Q|0)N=j,R=N+v|0,ne=R+v|0,ie=ne+v|0,L=w[ne<<3>>3]+w[ie<<3>>3],w[ie<<3>>3]=w[ie<<3>>3]-w[ne<<3>>3],w[ne<<3>>3]=w[N<<3>>3]-L,w[N<<3>>3]=w[N<<3>>3]+L;z=(Q<<1)-P|0,Q=Q<<2}while((z|0)<(O|0));for(_=c/+(P|0),ae=1;(ae|0)<(S|0);ae=ae+1|0){X=+(ae|0)*_,Be=h(X),Le=p(X),at=4*Le*(Le*Le-.75),rt=4*Be*(.75-Be*Be),z=0,Q=P<<1;do{for(j=z;(j|0)<(O|0);j=j+Q|0)N=j+ae|0,R=N+v|0,ne=R+v|0,ie=ne+v|0,ee=j+v-ae|0,Te=ee+v|0,Ne=Te+v|0,ve=Ne+v|0,W=w[Ne<<3>>3]*Le-w[ne<<3>>3]*Be,L=w[Ne<<3>>3]*Be+w[ne<<3>>3]*Le,J=w[ve<<3>>3]*at-w[ie<<3>>3]*rt,V=w[ve<<3>>3]*rt+w[ie<<3>>3]*at,be=W-J,W=W+J,J=be,w[ve<<3>>3]=W+w[Te<<3>>3],w[ne<<3>>3]=W-w[Te<<3>>3],be=V-L,L=L+V,V=be,w[ie<<3>>3]=V+w[R<<3>>3],w[Ne<<3>>3]=V-w[R<<3>>3],w[Te<<3>>3]=w[N<<3>>3]-L,w[N<<3>>3]=w[N<<3>>3]+L,w[R<<3>>3]=J+w[ee<<3>>3],w[ee<<3>>3]=w[ee<<3>>3]-J;z=(Q<<1)-P|0,Q=Q<<2}while((z|0)<(O|0))}}for(;Y=Y-1|0;)G=+w[Y<<3>>3],T=+w[O-Y-1<<3>>3],k=M*d(G*G+T*T),x[C+Y<<3>>3]=k;x[C+0<<3>>3]=m(M*w[0])}function D(O){O=O|0;var H=0,Y=0,ae=1,M=0,P=0;H=O>>>1,Y=O-1|0,w[0]=x[E+0<<3>>3];do{for(M=M+H|0,w[ae<<3>>3]=x[E+M<<3>>3],w[M<<3>>3]=x[E+ae<<3>>3],ae=ae+1|0,P=H<<1;P=P>>1,((M=M^P)&P)==0;);(M|0)>=(ae|0)&&(w[ae<<3>>3]=x[E+M<<3>>3],w[M<<3>>3]=x[E+ae<<3>>3],w[Y-ae<<3>>3]=x[E+Y-M<<3>>3],w[Y-M<<3>>3]=x[E+Y-ae<<3>>3]),ae=ae+1|0}while((ae|0)<(H|0));w[Y<<3>>3]=x[E+Y<<3>>3]}return B}return ps}var dm=um();const uc=Jn(dm),Pt=800,Je=200,ms=3,vn=125,xn=250,ga=3,hm=.02,nn=6,gs=800,dc=15,Ot=32768,bs=[{frequency:20,weight:.4006009013520281},{frequency:25,weight:.4258037044922291},{frequency:31.5,weight:.4536690484291709},{frequency:40,weight:.4840856831659204},{frequency:50,weight:.5142710208279764},{frequency:63,weight:.5473453749315819},{frequency:80,weight:.5841121495327103},{frequency:100,weight:.6214074879602299},{frequency:125,weight:.6601749463607856},{frequency:160,weight:.7054673721340388},{frequency:200,weight:.7489234225800412},{frequency:250,weight:.7936507936507937},{frequency:315,weight:.8406893652795292},{frequency:400,weight:.889284126278346},{frequency:500,weight:.9291521486643438},{frequency:630,weight:.9675858732462506},{frequency:800,weight:.9985022466300548},{frequency:1e3,weight:.9997500624843789},{frequency:1250,weight:.9564801530368244},{frequency:1600,weight:.9409550693954364},{frequency:2e3,weight:1.0196278358399185},{frequency:2500,weight:1.0955902492467817},{frequency:3150,weight:1.1232799775344005},{frequency:4e3,weight:1.0914051841746248},{frequency:5e3,weight:.9997500624843789},{frequency:6300,weight:.8727907484180668},{frequency:8e3,weight:.7722007722007722},{frequency:1e4,weight:.7369196757553427},{frequency:12500,weight:.7768498737618955},{frequency:16e3,weight:.7698229407236336},{frequency:2e4,weight:.4311738708634257},{frequency:22550,weight:.2},{frequency:25e3,weight:0}];class Ou extends ot{app;onAudioLoad=this.reset.bind(this);onResize=this.resize.bind(this);windowStep=512;fftSize=1024;tempoFftSize=4096;tempoStep=2;monoAudioData;audioLength=0;sampleRate=44100;tempogram=[];tempogramGroups=[];spectrogram=[];spectrogramDifference=[];noveltyCurve=[];noveltyCurveIsolated=[];spectrogramCanvases=[];lowestFinishedBlock=0;numRenderedBlocks=0;peaks=[];_threshold=.3;spectroHeights=[];spectroWeights=[];placeNotesSelectionButton;toggleButton;resetButton;onsetResults;offsetTableLabel;offsetRows=[];bpmRows=[];covers=[];doAnalysis=!1;lastSecond=0;constructor(e){super({title:"Detect Audio Sync",width:400,height:450,win_id:"detect-sync"}),this.app=e,this.initView(),this.reset(),re.on("audioLoaded",this.onAudioLoad),re.on("resize",this.onResize)}onClose(){re.off("audioLoaded",this.onAudioLoad),re.off("resize",this.onResize),this.app.chartManager.chartAudio.offLoad(this.onAudioLoad)}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("sync-container"),e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="center";const t=document.createElement("canvas");t.style.width=`${Pt/2/16}rem`,t.style.height=`${Je/16}rem`;const n=document.createElement("div");n.classList.add("sync-tab-container");const a=document.createElement("div");a.classList.add("sync-tab-option","active"),a.innerText="Analysis Options";const r=document.createElement("div");r.classList.add("sync-tab-option"),r.innerText="Tempo Results";const s=document.createElement("div");s.classList.add("sync-tab-option"),s.innerText="Onset Results",n.replaceChildren(a,r,s),[...n.children].forEach((m,g)=>{m.onclick=()=>{const b=parseFloat(getComputedStyle(document.body.parentElement).fontSize);l.scrollLeft=370*b/16*g,n.querySelectorAll(".active").forEach(x=>x.classList.remove("active")),m.classList.add("active")}});const o=document.createElement("div");o.classList.add("sync-tab-view");const l=document.createElement("div");l.classList.add("sync-tab-scroller");const u=this.createOptionsView(),f=this.createTempoView(),c=this.createOnsetsView(),d=(m,g)=>{const b=document.createElement("div");return b.classList.add("sync-cover"),b.innerText=m,b.style.left=`${g*370/16}rem`,b};this.covers=[d("Clear analysis results to edit",0),d("Start analysis to view",1),d("Start analysis to view",2)],o.appendChild(l),l.replaceChildren(u,this.covers[0],f,this.covers[1],c,this.covers[2]);const h=document.createElement("div");h.classList.add("sync-bottom-container"),this.resetButton=document.createElement("button"),this.resetButton.classList.add("delete"),this.resetButton.innerText="Clear results",this.resetButton.style.width="7.5rem",this.resetButton.disabled=!0,this.resetButton.onclick=()=>{this.resetButton.disabled=!0,a.click(),this.reset()},this.toggleButton=document.createElement("button"),this.toggleButton.innerText="Start analyzing",this.toggleButton.style.width="12.5rem",this.toggleButton.onclick=()=>{this.doAnalysis||r.click(),this.doAnalysis=!this.doAnalysis,this.toggleButton.innerText=this.doAnalysis?"Stop analyzing":this.hasData()?"Resume analyzing":"Start analyzing",this.resetButton.disabled=this.doAnalysis},h.replaceChildren(this.toggleButton,this.resetButton),e.replaceChildren(t,n,o,h),this.viewElement.appendChild(e);const p=this.windowLoop(t);requestAnimationFrame(p)}resize(){const e=this.viewElement.querySelector(".sync-tab-option.active");if(!e)return;const t=[...e.parentElement.children].indexOf(e);if(t<0)return;const n=parseFloat(getComputedStyle(document.body.parentElement).fontSize);this.viewElement.querySelector(".sync-tab-scroller").scrollLeft=370*n/16*t}createOptionsView(){const e=document.createElement("div");e.style.display="flex",e.style.position="relative",e.style.flexDirection="column",e.style.gap="0.2rem",e.style.height="100%";const t=(u,f,c)=>{const d=document.createElement("div");d.style.display="flex",d.style.flexDirection="row",d.style.justifyContent="space-between",d.style.alignItems="center";const h=document.createElement("div");return h.classList.add("label"),h.innerText=u,d.replaceChildren(h,f),Xe(d,{content:c}),d},n=document.createElement("div");n.innerText="Onsets",n.style.fontWeight="600";const a=Li.create({min:Math.log2(128),max:Math.log2(8192),step:1,value:Math.log2(this.fftSize),transformer:u=>2**u,onChange:u=>{this.fftSize=2**u,this.windowStep>this.fftSize&&(this.windowStep=this.fftSize,r.setValue(u)),this.reset()}}),r=Li.create({min:Math.log2(128),max:Math.log2(8192),step:1,value:Math.log2(this.windowStep),transformer:u=>2**u,onChange:u=>{this.windowStep=2**u,this.windowStep>this.fftSize&&(this.windowStep=this.fftSize,r.setValue(Math.log2(this.fftSize))),this.reset()}}),s=document.createElement("div");s.innerText="Tempo",s.style.fontWeight="600",s.style.marginTop="1rem";const o=Li.create({min:Math.log2(128),max:Math.log2(8192),step:1,value:Math.log2(this.tempoFftSize),transformer:u=>2**u,onChange:u=>{this.tempoStep=2**u,this.tempoStep>this.tempoFftSize&&(this.tempoStep=this.tempoFftSize,l.setValue(u)),this.reset()}}),l=Li.create({min:Math.log2(1),max:Math.log2(1024),step:1,value:Math.log2(this.tempoStep),transformer:u=>2**u,onChange:u=>{this.tempoStep=2**u,this.tempoStep>this.tempoFftSize&&(this.tempoStep=this.tempoFftSize,l.setValue(Math.log2(this.tempoFftSize))),this.reset()}});return e.replaceChildren(n,t("FFT Size",a.view,"Determines the amount of audio to analyze at every block. Higher values result in more accurate frequencies, while lower values result in more accurate timings. Defaults to 1024."),t("Window Step",r.view,"Determines the number of blocks per second. Lower values result in more time-accurate spectrograms, but may take more time and mess up tempo analysis. Defaults to 512 and must be lower than FFT Size."),s,t("FFT Size",o.view,"Determines the amount of the onset graph to analyze at every block. Higher values result in more accurate tempos, while lower values result in more accurate timings. Defaults to 4096."),t("Window Step",l.view,"Determines the number of blocks per second. Lower values result in more time-accurate tempograms, but may take more time. Defaults to 2 and must be lower than FFT Size.")),e}createTempoView(){const e=document.createElement("div");e.style.display="flex",e.style.position="relative",e.style.gap="0.625m";const t=document.createElement("div");t.style.flex="1";const n=document.createElement("div");n.classList.add("sync-table-label"),n.innerText="Offsets",this.offsetTableLabel=n;const a=document.createElement("table");a.classList.add("sync-table");const r=document.createElement("tr"),s=document.createElement("th");s.innerText="Offset";const o=document.createElement("th");o.innerText="Confidence",r.replaceChildren(s,o),a.appendChild(r),t.replaceChildren(n,a);const l=document.createElement("div");l.style.flex="1";const u=document.createElement("div");u.classList.add("sync-table-label"),u.innerText="Current Tempos";const f=document.createElement("table");f.classList.add("sync-table");const c=document.createElement("tr"),d=document.createElement("th");d.innerText="BPM";const h=document.createElement("th");h.innerText="Confidence",c.replaceChildren(d,h),f.appendChild(c);for(let p=0;p<5;p++){const m=document.createElement("tr");m.classList.add("empty");const g=document.createElement("td");g.innerText="-";const b=document.createElement("td");b.innerText="-",m.replaceChildren(g,b),a.appendChild(m),this.offsetRows.push(m);const x=m.cloneNode(!0);f.appendChild(x),this.bpmRows.push(x),m.onclick=()=>{let w;try{w=parseFloat(g.innerText)}catch{return}const E=this.app.chartManager.loadedChart.timingData;E.hasChartOffset()?E.setOffset(w):E.songTimingData.setOffset(w)},x.onclick=()=>{let w;try{w=parseFloat(x.firstElementChild.innerText)}catch{return}const E=this.app.chartManager.loadedChart.timingData,C=Math.round(this.app.chartManager.beat*48)/48;E.insertColumnEvents([{type:"BPMS",beat:C,value:w}])}}return l.replaceChildren(u,f),e.replaceChildren(t,l),e}createOnsetsView(){const e=document.createElement("div");e.style.display="flex",e.style.flexDirection="column",e.style.gap="0.625rem",e.style.justifyContent="center",e.style.alignItems="center",e.style.position="relative";const t=document.createElement("div");t.style.display="flex",t.style.justifyContent="space-between",t.style.alignItems="center",t.style.width="100%",Xe(t,{content:"Adjust the threshold for a block to be considered an onset (red line)."});const n=document.createElement("div");n.innerText="Onset Threshold";const a=Li.create({min:0,max:1,step:.01,value:.3,onChange:u=>{this.threshold=u}}),r=document.createElement("div");r.style.color="#888888",r.style.fontStyle="italic",r.style.fontSize="0.75rem",r.style.marginBottom="1rem",r.style.marginTop="-0.375rem",r.innerText="Found 0 onsets",this.onsetResults=r,t.replaceChildren(n,a.view);const s=document.createElement("div");s.style.display="flex",s.style.justifyContent="space-between",s.style.alignItems="center",s.style.width="100%";const o=document.createElement("button");o.innerText="Place onsets as notes",o.onclick=()=>this.placeOnsets();const l=document.createElement("button");return l.innerText="Place onsets as notes in selection",l.disabled=!0,l.onclick=()=>this.placeOnsets(!0),this.placeNotesSelectionButton=l,s.replaceChildren(o,l),e.replaceChildren(t,r,s),e}async reset(){this._threshold=.3,this.doAnalysis=!1,this.toggleButton.disabled=!1,this.toggleButton.style.background="",this.toggleButton.innerText="Start analyzing",this.app.chartManager.chartAudio.onLoad(this.onAudioLoad),await this.getMonoAudioData(),this.sampleRate=this.app.chartManager.chartAudio.getSampleRate(),this.spectroHeights=new Array(this.fftSize).fill(0).map((t,n)=>{const a=n/(this.fftSize/2)*this.sampleRate/2,r=(n+1)/(this.fftSize/2)*this.sampleRate/2,s=Je-Se(Math.log(a/20)/Math.log(this.sampleRate/40)*Je,0,Je),o=Je-Se(Math.log(r/20)/Math.log(this.sampleRate/40)*Je,0,Je);return{y:o,height:s-o}}),this.spectroWeights=new Array(this.fftSize).fill(0).map((t,n)=>{const a=n/(this.fftSize/2)*this.sampleRate/2,r=bs.findIndex(l=>l.frequency>a);if(r<1)return 0;const s=bs[r-1],o=bs[r];return et(s.weight,o.weight,pt(Math.log(1+s.frequency),Math.log(1+o.frequency),Math.log(1+a)))});const e=Math.max(1,Math.ceil(this.audioLength/this.windowStep));this.spectrogramCanvases=[];for(let t=0;t<Math.ceil(e/Ot);t++){const n=new OffscreenCanvas(Math.min(Ot,e-t*Ot),Je*2);this.spectrogramCanvases.push(n)}this.spectrogram=[],this.lowestFinishedBlock=0,this.numRenderedBlocks=0,this.spectrogramDifference=[],this.noveltyCurve=[],this.noveltyCurveIsolated=[],this.peaks=[],this.tempogram=[],this.tempogramGroups=[],this.offsetTableLabel.innerText="Offsets",this.offsetRows.forEach(t=>{t.firstChild.innerText="-",t.lastChild.innerText="-",t.classList.add("empty")}),this.bpmRows.forEach(t=>{t.firstChild.innerText="-",t.lastChild.innerText="-",t.classList.add("empty")})}hasData(){return this.numRenderedBlocks>0}windowLoop(e){const t=e.getContext("2d");t.canvas.width=Pt,t.canvas.height=Je*2,t.imageSmoothingEnabled=!1;const n=()=>{if(this.placeNotesSelectionButton.disabled=this.app.chartManager.startRegion===void 0||this.app.chartManager.endRegion===void 0||this.app.chartManager.startRegion==this.app.chartManager.endRegion,this.covers[0].classList.toggle("active",this.hasData()),this.covers[1].classList.toggle("active",!this.hasData()),this.covers[2].classList.toggle("active",!this.hasData()),!this.app.chartManager.chartAudio)return;const a=Math.ceil(this.audioLength/this.windowStep);if(this.monoAudioData!==void 0&&this.doAnalysis){const d=performance.now();for(;performance.now()-d<dc;){if(this.lowestFinishedBlock>=a){this.tempogram.length==0&&(this.toggleButton.disabled=!0,this.calcTempogram());break}this.spectrogram[this.lowestFinishedBlock]===void 0&&(this.renderBlock(this.lowestFinishedBlock),this.calcDifference(this.lowestFinishedBlock),this.calcIsolatedNovelty(this.lowestFinishedBlock),this.numRenderedBlocks++),this.lowestFinishedBlock++}this.lowestFinishedBlock<a&&(this.toggleButton.style.background=`linear-gradient(90deg, var(--accent-color) 0 ${this.lowestFinishedBlock/a*100}%, var(--input-bg) ${this.lowestFinishedBlock/a*100}% 100%)`,this.toggleButton.innerText=`Stop analyzing (${ue(this.lowestFinishedBlock/a*100,1)}%)`)}t.clearRect(0,0,e.width,e.height);const r=y.chart.speed/40,s=this.app.chartManager.time*this.sampleRate/this.windowStep-Pt*.2/r,o=this.app.chartManager.time*this.sampleRate/this.windowStep+Pt*.8/r;for(let d=Math.floor(s/Ot);d<=Math.floor(o/Ot);d++){const h=this.spectrogramCanvases[d];h&&t.drawImage(h,this.app.chartManager.time*this.sampleRate/this.windowStep-Pt*.2/r-Ot*d,0,Pt/r,Je*2,0,0,Pt,Je*2)}t.globalCompositeOperation="source-atop";let l;Bs(Fe.getColor("primary-bg"))>.5?l=new F("white"):l=new F("black"),t.fillStyle=jt(Fe.getColor("accent-color"),l,.1).toHexa(),t.fillRect(0,0,e.width,e.height),t.globalCompositeOperation="destination-over",t.fillStyle=jt(Fe.getColor("accent-color"),l,.9).toHexa(),t.fillRect(0,0,e.width,e.height),t.globalCompositeOperation="source-over";const u=s*this.windowStep/this.sampleRate,f=o*this.windowStep/this.sampleRate;if(this.app.chartManager.loadedChart){const d=this.app.chartManager.loadedChart.getBeatFromSeconds(u),h=this.app.chartManager.loadedChart.getBeatFromSeconds(Math.min(f,this.app.chartManager.chartAudio.getSongLength()));t.fillStyle="rgba(255, 255, 255, 0.2)";for(const[p,m]of this.app.chartManager.loadedChart.timingData.getMeasureBeats(d,h)){const g=this.app.chartManager.loadedChart.getSecondsFromBeat(p);t.fillRect(pt(u,f,g)*Pt-(m?2:1),0,m?5:3,Je*1.5)}}t.fillStyle="rgba(255, 0, 0, 0.3)";for(let d=Math.floor(s);d<=Math.ceil(o);d++)this.peaks[d]&&t.fillRect(pt(s,o,d)*Pt-.5,0,2,Je*1.5);t.fillStyle="rgba(50, 255, 20, 0.3)",t.fillRect(Pt*.2-1,0,3,Je*2),t.fillStyle="rgba(255, 0, 255, 0.5)",t.fillRect(0,Je*1.5-this._threshold*Je*.5,Pt,1);const c=Math.round(this.app.chartManager.time*this.sampleRate/this.windowStep/this.tempoStep);if(t.fillStyle=Fe.getColor("accent-color").toHex(),t.textAlign="right",t.textBaseline="top",t.font="22px Assistant",t.fillText(`${this.numRenderedBlocks}/${a} blocks rendered`,Pt-10,10),t.textAlign="right",t.textBaseline="middle",this.tempogramGroups[c]){const d=[];for(const h of this.tempogramGroups[c]){let p=0,m=0,g=0;for(let b=c-ga;b<=c+ga;b++){if(this.tempogramGroups[b]===void 0)continue;const x=this.tempogramGroups[b].find(w=>w.center<h.center+nn&&w.center>h.center-nn);x!==void 0&&(p+=x.groups[0].value,m+=x.avg,g++)}p/=g,m/=g,d.push({bpm:m,weight:h.groups[0].value,smoothedWeight:p})}d.sort((h,p)=>p.smoothedWeight-h.smoothedWeight);for(const h of d)h.weight<.01||(t.font=`${18+h.weight*300}px Assistant`,t.globalAlpha=Math.min(1,h.weight*100),t.fillText(ue(h.bpm,0)+"",200,et(Je*2,Je*1.5,pt(vn,xn,h.bpm))));if(this.lastSecond!=this.app.chartManager.time){this.lastSecond=this.app.chartManager.time;const h=d.slice(0,5).reduce((p,m)=>p+m.smoothedWeight,0);for(let p=0;p<5;p++){const m=this.bpmRows[p],g=d[p]?.bpm,b=d[p]?.weight;m.classList.toggle("empty",g===void 0),m.firstChild.innerText=g===void 0?"-":Math.round(g).toString(),m.lastChild.innerText=b===void 0?"-":Math.round(b/h*100)+"%"}}}t.globalAlpha=1,t.font="22px Assistant",t.textAlign="left",t.textBaseline="top",t.fillText("Spectrogram",10,10),t.fillText("Onsets",10,Je+10),t.fillText("Tempogram",10,Je*1.5+10),e.closest("#windows")&&requestAnimationFrame(n)};return n}renderBlock(e){if(!this.monoAudioData)return;const t=new Float32Array(this.fftSize);t.set(this.monoAudioData.subarray(Math.max(0,e*this.windowStep-this.fftSize/2),e*this.windowStep+this.fftSize/2),-Math.min(0,e*this.windowStep-this.fftSize/2));for(let a=0;a<t.length;a++)t[a]*=.5*(1-Math.cos(Math.PI*2*(a/this.fftSize)));const n=uc(t).slice(0);for(let a=0;a<n.length;a++)n[a]=Math.log(1+1*n[a]);this.storeResponse(e,n)}calcDifference(e){const t=this.spectrogram[e].slice(0),n=this.spectrogram[e-1]?.slice(0)??new Float64Array(this.fftSize);for(let a=0;a<t.length;a++)t[a]=Math.max(0,t[a]-n[a])*this.spectroWeights[a];this.storeDifferenceResponse(e,t)}storeResponse(e,t){this.spectrogram[e]=t;const n=this.spectrogramCanvases[Math.floor(e/Ot)].getContext("2d");n.fillStyle="white",t.forEach((a,r)=>{const s=this.spectroHeights[r],o=Se(a*2e3,0,255);n.globalAlpha=o/255,n.fillRect(e%Ot,s.y,1,s.height)}),n.globalAlpha=1}storeDifferenceResponse(e,t){this.spectrogramDifference[e]=t;const n=t.reduce((a,r)=>a+r,0);this.noveltyCurve[e]=n}calcIsolatedNovelty(e){for(let t=e-ms;t<=e;t++){if(t<0)continue;let n=0,a=0;for(let r=t-ms;r<=t+ms;r++)this.noveltyCurve[r]!==void 0&&(n+=this.noveltyCurve[r],a++);n/=a,this.storeIsolatedNovelty(t,Math.max(0,this.noveltyCurve[t]-n))}}storeIsolatedNovelty(e,t){this.noveltyCurveIsolated[e]=Math.log(1+t),Math.log(1+t)>this._threshold&&Math.log(1+t)>(this.noveltyCurveIsolated[e-1]??0)?(this.peaks[e-1]&&(this.peaks[e-1]=!1),this.peaks[e]=!0,this.onsetResults.innerText=`Found ${this.peaks.filter(r=>r).length} onsets`):this.peaks[e]=!1;const n=this.spectrogramCanvases[Math.floor(e/Ot)].getContext("2d"),a=Math.min(1,Math.log(1+t))*Je*.5;n.fillStyle="white",n.fillRect(e%Ot,Je*1.5-a,1,a)}async getMonoAudioData(){const e=this.app.chartManager.chartAudio;if(!e)return;const t=e.getBuffer(),n=new OfflineAudioContext(t.numberOfChannels,t.length,t.sampleRate),a=n.createBufferSource();a.buffer=t;const r=n.createChannelMerger(t.numberOfChannels);a.connect(r),r.connect(n.destination),a.start(),await n.startRendering().then(s=>{this.monoAudioData=s.getChannelData(0),this.audioLength=this.monoAudioData.length}).catch(()=>{de.createFormatted("Failed to load audio: audio rendering failed","error")})}get threshold(){return this._threshold}set threshold(e){this._threshold=e,this.peaks=this.noveltyCurveIsolated.map((t,n)=>t>this._threshold&&(this.noveltyCurveIsolated[n-1]??0)<this._threshold),this.onsetResults.innerText=`Found ${this.peaks.filter(t=>t).length} onsets`}calculateOffset(){const e=new Map;let t=0,n=0,a=0;for(let u=0;u<this.tempogramGroups.length;u++){const c=this.tempogramGroups[u].filter(d=>d.groups[0].value>=hm);if(c.length!=0&&(n=u,c.forEach(d=>{let h=0,p=0;for(let g=u-ga;g<=u+ga;g++){if(this.tempogramGroups[g]===void 0)continue;const b=this.tempogramGroups[g].find(x=>x.center<d.center+nn&&x.center>d.center-nn);b!==void 0&&(p+=b.avg,h++)}const m=Math.round(p/h);e.has(m)||e.set(m,0),e.set(m,e.get(m)+1),e.get(m)>t&&(t=e.get(m),a=m)}),t>50))break}if(a==0)return;const r=60/a*(this.sampleRate/this.windowStep),s=new Array(gs).fill(0).map((u,f)=>{const c=f%r/r;let d=0,h=0;for(let p=1;p<=4;p++)h+=Math.max(1-Math.abs(Math.round(c*p)/p-c)*12,0)*1/p,d+=1/p;return h/d}),o=[];for(let u=n;u<n+r;u++){const f=this.noveltyCurveIsolated.slice(u,u+gs).map((c,d)=>s[d]*c).reduce((c,d)=>c+d,0);o.push({block:u,offset:-(u*this.windowStep/this.sampleRate)%(60/a),response:f,curve:this.noveltyCurveIsolated.slice(u,u+gs).map((c,d)=>s[d]*c)})}o.sort((u,f)=>f.response-u.response);const l=o.slice(0,5).reduce((u,f)=>u+f.response,0);this.offsetTableLabel.innerText=`Offsets (first BPM: ${a})`;for(let u=0;u<Math.min(o.length,5);u++){const f=this.offsetRows[u];f.classList.remove("empty"),f.firstChild.innerText=ue(o[u].offset,3).toString(),f.lastChild.innerText=Math.round(o[u].response/l*100)+"%"}}placeOnsets(e=!1){const t=this.peaks.map((n,a)=>{if(!n)return null;let r=this.app.chartManager.loadedChart.getBeatFromSeconds(a*this.windowStep/this.sampleRate);return r=Math.round(r*48)/48,r<0?null:{type:"Tap",beat:r,col:0}}).filter(n=>n!==null).filter(n=>e?n.beat>this.app.chartManager.startRegion&&n.beat<this.app.chartManager.endRegion:!0);this.app.chartManager.insertNotes(t)}calcTempogram(){let e=0;for(let s=0;s<this.noveltyCurveIsolated.length;s++)this.noveltyCurveIsolated[s]>e&&(e=this.noveltyCurveIsolated[s]);const t=new Float32Array(this.noveltyCurveIsolated.length);for(let s=0;s<this.noveltyCurveIsolated.length;s++)t[s]=this.noveltyCurveIsolated[s]/e;const n=Math.ceil(t.length/this.tempoStep);let a=performance.now();const r=s=>{const o=new Float32Array(this.tempoFftSize);o.set(t.subarray(Math.max(0,s*this.tempoStep-this.tempoFftSize/2),s*this.tempoStep+this.tempoFftSize/2),-Math.min(0,s*this.tempoStep-this.tempoFftSize/2));for(let u=0;u<o.length;u++)o[u]*=.5*(1-Math.cos(Math.PI*2*(u/this.tempoFftSize)));const l=uc(o).slice(0);for(let u=0;u<l.length;u++)l[u]=Math.log(1+1*l[u]);this.storeTempogram(s,l),s<n?performance.now()-a<dc?r(++s):(a=performance.now(),this.toggleButton.style.background=`linear-gradient(90deg, var(--accent-color) 0 ${s/n*100}%, var(--input-bg) ${s/n*100}% 100%)`,this.toggleButton.innerText=`Finding tempo (${ue(s/n*100,1)}%)`,setTimeout(()=>r(++s),1)):(this.calculateOffset(),this.spectrogram=[],this.noveltyCurve=[],this.tempogram=[],this.monoAudioData=void 0,this.toggleButton.innerText="Finished analyzing",this.resetButton.disabled=!1,this.doAnalysis=!1,this.toggleButton.style.background="var(--accent-color)")};r(0)}storeTempogram(e,t){const n=new Map,a=[];t.forEach((s,o)=>{let l=this.sampleRate*60/(this.windowStep*this.tempoFftSize)*o;if(!(l>xn*4||l<vn/4)){for(;l>xn&&l!=1/0;)l/=2;for(;l<vn&&l!=0;)l*=2;n.has(ue(l,3))||n.set(ue(l,3),0),n.set(ue(l,3),n.get(ue(l,3))+s)}}),this.tempogram[e]=[...n.entries()].map(([s,o])=>({bpm:s,value:o})).sort((s,o)=>o.value-s.value).filter(s=>s.value!=0);for(let s=0;s<Math.min(this.tempogram[e].length,10);s++){const o=this.tempogram[e][s],l=a.find(u=>u.center<o.bpm+nn&&u.center>o.bpm-nn);if(l===void 0){a.push({center:o.bpm,groups:[o]});continue}l.groups.push(o)}this.tempogramGroups[e]=a.map(s=>({...s,avg:s.groups.reduce((o,l)=>o+l.bpm*l.value,0)/s.groups.reduce((o,l)=>o+l.value,0)}));const r=this.spectrogramCanvases[Math.floor(e*this.tempoStep/Ot)].getContext("2d");r.fillStyle="white",this.tempogram[e].forEach(s=>{const o=Se(s.value*8e3,0,255);r.globalAlpha=o/255,r.fillRect(e*this.tempoStep%Ot,et(Je*2,Je*1.5,pt(vn,xn,s.bpm)),1*this.tempoStep,Je*.5/(xn-vn))})}}class Ps extends ot{app;grid;actions={};constructor(e){super({title:"Themes",width:600,height:400,disableClose:!1,win_id:"theme-selection",blocking:!1}),this.app=e,this.initView(),this.loadGrid()}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("div");t.classList.add("pref-search");const n=document.createElement("input");n.classList.add("pref-search-bar"),n.type="text",n.placeholder="Search for a theme...",n.oninput=()=>{this.filterGrid(n.value)},t.appendChild(n);const a=document.createElement("div");a.classList.add("theme-grid"),this.grid=a;const r=this.createOptionTray();e.replaceChildren(t,a,r),this.viewElement.appendChild(e)}createOptionTray(){const e=document.createElement("div");e.classList.add("theme-tray");const t=document.createElement("button");t.appendChild(me.getIcon("PLUS",16)),t.appendChild(document.createTextNode("New")),t.onclick=()=>{const l=this.getNonConflictingName("new-theme");Fe.createUserTheme(l),Fe.loadTheme(l),this.loadGrid()},this.actions.add=t,e.appendChild(t);const n=document.createElement("button");n.appendChild(me.getIcon("COPY",16)),n.appendChild(document.createTextNode("Duplicate")),n.onclick=()=>{const l=this.getNonConflictingName(y.general.theme);Fe.createUserTheme(l,Fe.getCurrentTheme()),Fe.loadTheme(l),this.loadGrid()},n.disabled=!0,this.actions.copy=n,e.appendChild(n);const a=document.createElement("button");a.classList.add("confirm"),a.appendChild(me.getIcon("EDIT",16)),a.appendChild(document.createTextNode("Edit")),a.onclick=()=>{this.closeWindow(),this.app.windowManager.openWindow(new Qn(this.app))},a.disabled=!0,this.actions.edit=a,e.appendChild(a);const r=document.createElement("button");r.classList.add("delete"),r.appendChild(me.getIcon("TRASH",16)),r.appendChild(document.createTextNode("Delete")),r.onclick=()=>{this.app.windowManager.openWindow(new Zn(this.app,"Delete theme","Are you sure you want to delete this theme?",[{type:"default",label:"Cancel"},{type:"delete",label:"Delete",callback:()=>{Fe.deleteUserTheme(y.general.theme),this.loadGrid()}}]))},r.disabled=!0,this.actions.del=r,e.appendChild(r);const s=document.createElement("button");s.appendChild(me.getIcon("UPLOAD",16)),s.appendChild(document.createTextNode("Import")),s.onclick=async()=>{(await Tu({_preferPolyfill:!1,excludeAcceptAllOption:!1,multiple:!0,accepts:[{extensions:["txt"]}]})).forEach(u=>{u.getFile().then(f=>f.text()).then(f=>{const c=Fe.parseThemeText(f);let d=kt(u.name,".txt");if(!c){de.createFormatted("Failed to load theme "+d,"error");return}d=this.getNonConflictingName(d),Fe.createUserTheme(d,c),this.loadGrid()})})},this.actions.imp=s,e.appendChild(s);const o=document.createElement("button");return o.appendChild(me.getIcon("DOWNLOAD",16)),o.appendChild(document.createTextNode("Export")),o.onclick=()=>{const l=Fe.exportCurrentTheme({spaces:!0}),u=new File([l],y.general.theme+".txt",{type:"text/plain"}),f=document.createElement("a"),c=URL.createObjectURL(u);f.href=c,f.download=u.name,document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(c)},this.actions.exp=o,o.disabled=!0,e.appendChild(o),e}loadGrid(){this.grid.replaceChildren();const e=Fe.getThemes();if(e)for(const[t,n]of Object.entries(e)){let a=t;const r=zi[t]!==void 0,s=document.createElement("div"),o=document.createElement("div");if(o.classList.add("inlineEdit"),r)o.style.fontWeight="bold";else{o.contentEditable="true";let u=t;o.onfocus=()=>{u=o.innerText},o.onkeydown=f=>{f.key=="Enter"&&(o.blur(),f.preventDefault()),f.key=="Escape"&&(o.innerText=u,o.blur(),f.stopImmediatePropagation())},o.onblur=()=>{if(o.innerText==u)return;const f=this.getNonConflictingName(o.innerText);Fe.renameUserTheme(u,f),Fe.loadTheme(f),o.innerText=f,a=f,s.dataset.id=f}}const l=document.createElement("div");l.classList.add("theme-preview-grid");for(const u of jh){const f=document.createElement("div");f.style.backgroundColor=n[u].toHex(),l.appendChild(f)}o.innerText=t,s.classList.add("theme-cell"),o.classList.add("theme-title"),s.replaceChildren(o,l),this.grid.appendChild(s),t==y.general.theme&&(s.classList.add("selected"),setTimeout(()=>{s.scrollIntoView({behavior:y.general.smoothAnimations?"smooth":"instant",block:"center"})}),this.actions.edit.disabled=r,this.actions.del.disabled=r,this.actions.copy.disabled=!1,this.actions.exp.disabled=!1),s.dataset.id=t,s.onclick=()=>{y.general.theme!=a&&(Fe.loadTheme(a),this.removeAllSelections(),s.classList.add("selected"),this.actions.edit.disabled=r,this.actions.del.disabled=r,this.actions.copy.disabled=!1,this.actions.exp.disabled=!1)}}}removeAllSelections(){[...this.grid.querySelectorAll(".selected")].forEach(e=>e.classList.remove("selected"))}filterGrid(e){[...this.grid.children].forEach(t=>{if(!(t instanceof HTMLDivElement))return;const n=t,a=this.containsQuery(e,n.dataset.id);n.style.display=a?"":"none"})}containsQuery(e,t){return t?t.toLowerCase().includes(e.trim().toLowerCase()):!1}getNonConflictingName(e){const t=Fe.getThemes();if(t[e]==null)return e;let n=2;const a=/([^]+)-(\d+)$/.exec(e);a&&(e=a[1],n=parseInt(a[2]));let r=`${e}-${n}`;for(;t[r]!==void 0;)r=`${e}-${n}`,n++;return r}}class Qn extends ot{app;pickers={};handlers=[];linkBlacklist=new Set;static isOpen=!1;constructor(e){super({title:"Theme Color Editor",width:500,height:400,win_id:"theme-editor",disableClose:!0}),this.app=e,this.initView(),Qn.isOpen=!0}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("div");t.classList.add("theme-color-grid"),$h.forEach(l=>{t.appendChild(this.createGroup(l))});const n=document.createElement("div");n.classList.add("menu-options");const a=document.createElement("div");a.classList.add("menu-left");const r=document.createElement("div");r.classList.add("menu-right"),n.appendChild(a),n.appendChild(r);const s=document.createElement("button");s.innerText="Cancel",s.onclick=()=>{this.closeWindow(),Fe.loadTheme(y.general.theme),this.app.windowManager.openWindow(new Ps(this.app))},a.appendChild(s);const o=document.createElement("button");o.innerText="Save",o.classList.add("confirm"),o.onclick=()=>{Fe.setUserTheme(y.general.theme,Fe.getCurrentTheme()),Fe.loadTheme(y.general.theme),this.app.windowManager.openWindow(new Ps(this.app)),this.closeWindow()},r.appendChild(o),e.replaceChildren(t,n),this.viewElement.appendChild(e)}createGroup(e){const t=document.createElement("div");t.classList.add("theme-group");const n=document.createElement("div");n.classList.add("theme-group-label"),n.innerText=e.name;const a=document.createElement("div");return a.classList.add("theme-picker-grid"),e.ids.forEach(r=>{a.appendChild(this.createPicker(r))}),t.replaceChildren(n,a),t}createPicker(e){const t=()=>{const f=new F(Fe.getCurrentTheme()[e.id]);o.innerText=f.toHex()+" | "+Math.round(f.alpha*100)+"%",!l.isActive()&&(l.value=f)},n=f=>{const c=Fe.getCurrentTheme();c[e.id]=f,Fe._applyTheme(this.updateLinks(e.id,c))},a=document.createElement("div");a.classList.add("theme-color-cell"),Ml[e.id]!=""&&Xe(a,{content:Ml[e.id]});const r=Xr[e.id];r&&(a.onmouseover=()=>{Object.keys(r).forEach(f=>{this.linkBlacklist.has(f)||this.pickers[f].classList.add("linked")})},a.onmouseout=()=>{Object.keys(r).forEach(f=>{this.pickers[f].classList.remove("linked")})});const s=document.createElement("div");s.innerText=e.label;const o=document.createElement("div");o.classList.add("theme-color-detail");const l=$a.create({value:"white",width:30,height:30});l.onColorChange=n,a.replaceChildren(s,o,l);const u=this.getLink(e.id);if(u!==null){const f=document.createElement("div");f.classList.add("ico-checkbox");const c=me.getIcon("LINK",16),d=me.getIcon("LINK_BROKEN",16);let h=!0;const p=()=>{h?this.linkBlacklist.delete(e.id):this.linkBlacklist.add(e.id),c.style.display=h?"":"none",d.style.display=h?"none":""};f.onclick=()=>{h=!h,p()},Xe(f,{onShow(g){g.setContent(h?`Linked to ${u}`:"Unlinked")}}),Xe(f,{trigger:"click",onShow(g){g.setContent(h?`Linked to ${u}`:"Unlinked")}}),p(),f.replaceChildren(c,d),a.appendChild(f);const m=g=>{h&&(h=!1,p()),n(g)};l.onColorChange=m}return t(),re.on("themeChanged",t),this.handlers.push(t),this.pickers[e.id]=a,a}getLink(e){for(const[t,n]of Object.entries(Xr))if(e in n)return t;return null}average(e){return(e.red+e.green+e.blue)/3}lighten(e,t){return new F(so(new F(e).toNumber(),1+t/100))}add(e,t){return new F(Yh(new F(e).toNumber(),t))}updateLinks(e,t){const n=new Set,a=[e];for(;a.length!=0;){const r=a.shift(),s=Xr[r];if(s)for(const[o,l]of Object.entries(s))this.linkBlacklist.has(o)||n.has(o)||(t[o]=l.bind(this)(t[r]),a.push(o),n.add(o))}return t}onClose(){Qn.isOpen=!1}}const Ca={precision:Tc,minPrecision:Ci,value:0};function an(i){return{create:function(e){const t=ct.create({...Ca,value:0,min:i=="WARPS"?0:-Number.MAX_VALUE,onchange:n=>{const a=e.chartManager.loadedChart.timingData,r=Math.round(e.chartManager.beat*48)/48;if(n==null){a.deleteColumnEvents([{type:i,beat:r}]);return}a.insertColumnEvents([{type:i,beat:r,value:n}])}});return this.data=[t],t.view},update:function(e,t){const n=this.data[0];if(document.activeElement==n.input)return;n.value=e.getOffset();const a=e.getEventAtBeat(i,t);let r=a?.value??0;Ju.getColumnType(i)=="instant"&&(!a||Math.abs(a.beat-t)>1/48)&&(r=0),n.value=r}}}const hc={offset:{title:"Offset",element:{create:function(i){const e=ct.create({...Ca,step:y.general.spinnerStep/100,onchange:t=>{const n=i.chartManager.loadedChart.timingData;t!=null&&(n.hasChartOffset()?n.setOffset(t):n.songTimingData.setOffset(t))}});return this.data.push(e),e.view},update:function(i){const e=this.data[0];document.activeElement!=e.input&&(e.value=i.getOffset())}}},bpm:{title:"BPM",element:an("BPMS")},stop:{title:"Stop",element:an("STOPS")},delay:{title:"Delay",element:an("DELAYS")},warp:{title:"Warp",element:an("WARPS")},timeSig:{title:"Time Sig.",element:{create:function(i){const e=document.createElement("div");e.classList.add("flex-column-gap");const t=ct.create({value:4,step:1,precision:0,min:1,onchange:a=>{const r=i.chartManager.loadedChart.timingData,s=Math.round(i.chartManager.beat*48)/48;if(a==null){r.deleteColumnEvents([{type:"TIMESIGNATURES",beat:s}]);return}a<1||r.insertColumnEvents([{type:"TIMESIGNATURES",beat:s,upper:a,lower:n.value}])}}),n=ct.create({value:4,step:1,precision:0,min:1,onchange:a=>{const r=i.chartManager.loadedChart.timingData,s=Math.round(i.chartManager.beat*48)/48;if(a==null){r.deleteColumnEvents([{type:"TIMESIGNATURES",beat:s}]);return}a<1||r.insertColumnEvents([{type:"TIMESIGNATURES",beat:s,upper:t.value,lower:a}])}});return e.appendChild(t.view),e.appendChild(n.view),this.data=[t,n],e},update:function(i,e){const t=this.data[0],n=this.data[1],a=i.getEventAtBeat("TIMESIGNATURES",e),r=a?.upper??4,s=a?.lower??4;document.activeElement!=t.input&&(t.value=Math.round(r)),document.activeElement!=n.input&&(n.value=Math.round(s))}}},tick:{title:"Tickcount",element:{create:function(i){const e=ct.create({value:4,step:1,precision:0,min:0,onchange:t=>{const n=i.chartManager.loadedChart.timingData,a=Math.round(i.chartManager.beat*48)/48;if(t==null){n.deleteColumnEvents([{type:"TICKCOUNTS",beat:a}]);return}t<0||n.insertColumnEvents([{type:"TICKCOUNTS",beat:a,value:t}])}});return this.data=[e],e.view},update:function(i,e){const t=this.data[0];if(document.activeElement==t.input)return;const n=i.getEventAtBeat("TICKCOUNTS",e)?.value??4;t.value=Math.round(n)}}},combo:{title:"Combo",element:{create:function(i){const e=document.createElement("div");e.classList.add("flex-column-gap");const t=ct.create({value:1,step:1,precision:0,min:0,onchange:a=>{const r=i.chartManager.loadedChart.timingData,s=Math.round(i.chartManager.beat*48)/48;if(a==null){r.deleteColumnEvents([{type:"COMBOS",beat:s}]);return}a<0||r.insertColumnEvents([{type:"COMBOS",beat:s,hitMult:a,missMult:n.value}])}}),n=ct.create({value:1,step:1,precision:0,min:0,onchange:a=>{const r=i.chartManager.loadedChart.timingData,s=Math.round(i.chartManager.beat*48)/48;if(a==null){n.value=i.chartManager.loadedChart?.timingData.getEventAtBeat("COMBOS",s)?.missMult??1;return}a<0||r.insertColumnEvents([{type:"COMBOS",beat:s,hitMult:t.value,missMult:a}])}});return e.appendChild(t.view),e.appendChild(n.view),this.data=[t,n],e},update:function(i,e){const t=this.data[0],n=this.data[1],a=i.getEventAtBeat("COMBOS",e),r=a?.hitMult??1,s=a?.missMult??1;document.activeElement!=t.input&&(t.value=Math.round(r)),document.activeElement!=n.input&&(n.value=Math.round(s))}}},speed:{title:"Speed",element:{create:function(i){const e=document.createElement("div");e.classList.add("flex-column-gap");const t=()=>{const s=i.chartManager.loadedChart.timingData,o=Math.round(i.chartManager.beat*48)/48;s.insertColumnEvents([{type:"SPEEDS",beat:o,value:n.value,delay:a.value,unit:r.value=="Beats"?"B":"T"}])},n=ct.create({...Ca,value:1,step:.1,onchange:s=>{const o=i.chartManager.loadedChart.timingData,l=Math.round(i.chartManager.beat*48)/48;if(s==null){o.deleteColumnEvents([{type:"SPEEDS",beat:l}]);return}t()}}),a=ct.create({...Ca,value:1,step:.1,min:0,onchange:s=>{s==null||s<0||t()}}),r=hi.create(["Beats","Time"],"Beats");return r.onChange(t),e.appendChild(n.view),e.appendChild(a.view),e.appendChild(r.view),this.data=[n,a,r],e},update:function(i,e){const t=this.data[0],n=this.data[1],a=this.data[2],r=i.getEventAtBeat("SPEEDS",e),s=r?.value??1,o=r?.delay??0,l=r?.unit=="B"?"Beats":"Time";document.activeElement!=t.input&&(t.value=s),document.activeElement!=n.input&&(n.value=o);const u=r&&Math.abs(r.beat-e)<1/48;n.disabled=!u,a.value!=l&&a.setSelected(l),a.disabled=!u}}},scroll:{title:"Scroll",element:an("SCROLLS")},fake:{title:"Fake",element:an("FAKES")},label:{title:"Label",element:{create:function(i){const e=document.createElement("input");return e.type="text",e.autocomplete="off",e.spellcheck=!1,e.onkeydown=t=>{t.key=="Enter"&&e.blur()},e.onblur=()=>{const t=i.chartManager.loadedChart.timingData,n=Math.round(i.chartManager.beat*48)/48;if(e.value==""){t.deleteColumnEvents([{type:"LABELS",beat:n}]);return}t.insertColumnEvents([{type:"LABELS",beat:n,value:e.value}])},this.data=[e],e},update:function(i,e){const t=this.data[0];if(document.activeElement==t)return;const a=i.getEventAtBeat("LABELS",e)?.value??"";t.value!=a&&(t.value=a)}}}};class fm extends ot{app;lastBeat;interval;changeHandler=()=>this.setData();data={};constructor(e){super({title:"Edit Timing Data",width:300,height:340,disableClose:!1,win_id:"timing_data",blocking:!1}),this.app=e,this.lastBeat=Math.round(this.app.chartManager.beat*1e3)/1e3,this.initView(),this.interval=setInterval(()=>{Math.round(this.app.chartManager.beat*1e3)/1e3!=this.lastBeat&&(this.lastBeat=Math.round(this.app.chartManager.beat*1e3)/1e3,this.setData())},17),re.on("timingModified",this.changeHandler),re.on("chartLoaded",this.changeHandler)}onClose(){re.off("timingModified",this.changeHandler),clearInterval(this.interval)}initView(){this.viewElement.replaceChildren(),this.viewElement.classList.add("timing-data");const e=document.createElement("div");e.classList.add("padding"),Object.values(hc).forEach(t=>{const n=document.createElement("div");n.classList.add("label"),n.innerText=t.title,this.data[t.title]={data:[]};const a=t.element.create.bind(this.data[t.title])(this.app);e.appendChild(n),e.appendChild(a)}),this.viewElement.appendChild(e),this.setData()}setData(){this.app.chartManager.loadedChart&&Object.values(hc).forEach(e=>{e.element.update.bind(this.data[e.title])(this.app.chartManager.loadedChart.timingData,this.lastBeat)})}}const fc=[{type:"group",id:"app",label:"App",disable:()=>window.nw===void 0,children:[{type:"subgroup",children:[{type:"item",label:"Window Width",id:"app.width",input:{type:"number",step:50,min:300,precision:0,onChange:(i,e)=>{const t=nw.Window.get();t.isFullscreen||(t.width=e)}}},{type:"item",label:"Window Height",id:"app.height",input:{type:"number",step:50,min:300,precision:0,onChange:(i,e)=>{const t=nw.Window.get();t.isFullscreen||(t.height=e)}}}]},{type:"subgroup",children:[{type:"item",label:"Fullscreen",id:"app.fullscreen",input:{type:"checkbox",onChange:(i,e)=>{const t=nw.Window.get();e?nw.Window.get().enterFullscreen():(t.hide(),nw.Window.get().leaveFullscreen(),t.show())}}}]}]},{type:"group",id:"general",label:"General",children:[{type:"subgroup",children:[{type:"item",label:"UI Scale",id:"general.uiScale",input:{type:"number",min:30,step:10,precision:0,max:200,transformers:{serialize:i=>i*100,deserialize:i=>i/100},onChange:(i,e)=>{document.body.parentElement.style.fontSize=e*100+"%"}}},{type:"item",label:"Smooth Animations",id:"general.smoothAnimations",input:{type:"checkbox",onChange:(i,e)=>{e?document.body.classList.add("animated"):document.body.classList.remove("animated")}}},{type:"item",label:"Autosave interval",id:"general.autosaveInterval",input:{type:"slider",min:30,step:5,max:600,hardMin:15,hardMax:2**31-1},tooltip:"Interval in seconds between autosaves"},{type:"item",label:"Warn before exit",id:"general.warnBeforeExit",input:{type:"checkbox"},tooltip:"Warn before exiting the editor if you have unsaved changes."},{type:"item",label:"Spinner step",id:"general.spinnerStep",input:{type:"slider",min:0,step:.1,max:5,hardMin:0,hardMax:2**31-1},tooltip:"The default increment for all number spinners."}]}]},{type:"group",id:"chart",label:"Chart",children:[{type:"subgroup",label:"Note Placement",children:[{type:"subgroup",children:[{type:"item",label:"Enable mouse placement",id:"chart.mousePlacement",input:{type:"checkbox"}},{type:"item",label:"Directional hold placement behavior",id:"chart.defaultHoldPlacement",input:{type:"checkbox"},tooltip:"Changes the hold placement behavior. By default, holds can only be extended in one direction when placed. Turn this off to mimic the behavior of AV/Stepmania."},{type:"item",label:"Force snap notes",id:"chart.forceSnapNotes",input:{type:"checkbox"},tooltip:"Placing a note when not on a snap will force the note to be placed on the next snap. Useful for placing notes when playing."}]},{type:"subgroup",children:[{type:"item",label:"Zoom",id:"chart.zoom",input:{type:"slider",min:50,step:1,max:200,hardMax:2**31-1,transformers:{serialize:i=>i*100,deserialize:i=>i/100}}},{type:"item",label:"Reverse playfield",id:"chart.reverse",input:{type:"checkbox"}}]},{type:"subgroup",children:[{type:"item",label:"Allow receptor dragging",id:"chart.allowReceptorDrag",input:{type:"checkbox"},tooltip:"Allows the receptors to be dragged to move the playfield."},{type:"item",label:"X position",id:"chart.receptorXPos",input:{type:"slider",min:-400,max:400,hardMin:-2147483647,hardMax:2**31-1}},{type:"item",label:"Y position",id:"chart.receptorYPos",input:{type:"slider",min:-400,max:0,hardMin:-2147483647,hardMax:2**31-1}}]},{type:"subgroup",children:[{type:"item",label:"Draw length",id:"chart.maxDrawBeats",input:{type:"slider",min:0,max:30,hardMax:2**31-1},tooltip:"Maximum number of beats to draw notes. Increasing this works well for songs with high bpm but can affect performance. Only applies to XMod."},{type:"item",label:"Draw length past receptors",id:"chart.maxDrawBeatsBack",input:{type:"slider",min:0,max:30,hardMax:2**31-1},tooltip:"Maximum number of beats to draw notes past the receptors. Increasing this can affect performance. Only applies to XMod."}]},{type:"subgroup",children:[{type:"item",label:"Draw noteflashes",id:"chart.drawNoteFlash",input:{type:"checkbox"}},{type:"item",label:"Draw note icons",id:"chart.drawIcons",input:{type:"checkbox"},tooltip:"Draw indicators above notes that some noteskins may not differentiate, like Fakes and Lifts."}]}]},{type:"subgroup",label:"Scrolling",children:[{type:"item",label:"Scroll sensitivity",id:"chart.scroll.scrollSensitivity",input:{type:"slider",min:0,step:1,max:200,hardMax:2**31-1,transformers:{serialize:i=>i*100,deserialize:i=>i/100}},tooltip:"Adjust the scroll sensitivity when scrolling through the chart."},{type:"item",label:"Snap every scroll",id:"chart.scroll.scrollSnapEveryScroll",input:{type:"checkbox"},tooltip:"Whether each scroll movement corresponds to moving one snap unit when scrolling. Turning this on will have the same behavior as ArrowVortex. Recommended on for those using a mouse, off for those using trackpad."},{type:"item",label:"Invert scroll direction",id:"chart.scroll.invertScroll",input:{type:"checkbox"}},{type:"item",label:"Invert zoom in/out",id:"chart.scroll.invertZoomScroll",input:{type:"checkbox"},tooltip:"Inverts the zoom in/out control when scrolling."},{type:"item",label:"Invert scroll direction when in reverse",id:"chart.scroll.invertReverseScroll",input:{type:"checkbox"}}]},{type:"subgroup",label:"Waveform",children:[{type:"item",label:"Draw waveform",id:"chart.waveform.enabled",input:{type:"checkbox"}},{type:"subgroup",children:[{type:"item",label:"Color",id:"chart.waveform.color",input:{type:"color"}}]},{type:"subgroup",children:[{type:"item",label:"Draw filtered waveform",id:"chart.waveform.allowFilter",input:{type:"checkbox"}},{type:"item",label:"Filtered color",id:"chart.waveform.filteredColor",input:{type:"color"}}]},{type:"item",label:"Line height",id:"chart.waveform.lineHeight",input:{type:"slider",min:1,max:3,step:.1,hardMax:100},tooltip:"The height of each line of the waveform. Increasing this can help performance."},{type:"item",label:"Antialiasing",id:"chart.waveform.antialiasing",input:{type:"checkbox"}},{type:"item",label:"Allow speed changes",id:"chart.waveform.speedChanges",input:{type:"checkbox"},tooltip:"Allows the waveform to be affected by SPEEDS and SCROLLS."}]},{type:"subgroup",label:"Note Layout",children:[{type:"item",label:"Show Note Layout",id:"chart.noteLayout.enabled",input:{type:"checkbox"}}]},{type:"subgroup",label:"NPS Graph",children:[{type:"item",label:"Show NPS Graph",id:"chart.npsGraph.enabled",input:{type:"checkbox"}},{type:"subgroup",children:[{type:"item",label:"Start Color",id:"chart.npsGraph.color1",input:{type:"color"}},{type:"item",label:"End Color",id:"chart.npsGraph.color2",input:{type:"color"}}]}]}]},{type:"group",id:"audio",label:"Audio",children:[{type:"subgroup",children:[{type:"item",label:"Master volume",id:"audio.masterVolume",input:{type:"slider",min:0,step:1,max:100,hardMax:2**31-1,transformers:{serialize:i=>i*100,deserialize:i=>i/100}}},{type:"item",label:"Song volume",id:"audio.songVolume",input:{type:"slider",min:0,step:1,max:100,hardMax:2**31-1,transformers:{serialize:i=>i*100,deserialize:i=>i/100}}},{type:"item",label:"Sound effect volume",id:"audio.soundEffectVolume",input:{type:"slider",min:0,step:1,max:100,hardMax:2**31-1,transformers:{serialize:i=>i*100,deserialize:i=>i/100}}}]},{type:"subgroup",children:[{type:"item",label:"Enable assist tick",id:"audio.assistTick",input:{type:"checkbox"},tooltip:"Plays a sound when a note passes the receptors"},{type:"item",label:"Enable metronome",id:"audio.metronome",input:{type:"checkbox"}}]},{type:"subgroup",children:[{type:"item",label:"Allow filters to affect audio",id:"audio.allowFilter",input:{type:"checkbox",onChange:i=>{i.chartManager.chartAudio.reload()}}},{type:"item",label:"Enable metronome",id:"audio.metronome",input:{type:"checkbox"}}]}]},{type:"group",id:"play",label:"Play mode",children:[{type:"subgroup",label:"Calibration",children:[{type:"item",label:"Global offset",id:"play.offset",input:{type:"slider",min:-1,step:.001,max:1,hardMin:-2147483647,hardMax:2**31-1},tooltip:"Offset in seconds when playing a chart. Set to positive if you are hitting early and negative if you are hitting late."},{type:"item",label:"Sound effect offset",id:"play.effectOffset",input:{type:"slider",min:-1,step:.001,max:1,hardMin:-2147483647,hardMax:2**31-1},tooltip:"Offset in seconds when playing sound effects like assist tick and metronome."},{type:"item",label:"Visual offset",id:"play.visualOffset",input:{type:"slider",min:-1,step:.001,max:1,hardMin:-2147483647,hardMax:2**31-1},tooltip:"Offset in seconds when displaying notes."}]},{type:"subgroup",children:[{type:"item",label:"Judgement tilt",id:"play.judgementTilt",input:{type:"checkbox"},tooltip:"Tilts the judgement text left if you are hitting early and right if you are hitting late."},{type:"item",label:"Hide barlines during play",id:"play.hideBarlines",input:{type:"checkbox"}}]},{type:"subgroup",label:"Timing windows",children:[{type:"item",id:"play.timingCollection",label:"Timing window collection",input:{type:"dropdown",advanced:!1,get items(){return Object.keys(_t.getCollections())},onChange(i,e){const t=i.chartManager.loadedChart?.gameType.id;if(t)for(const n of Object.keys(y.play.defaultTimingCollections))t.startsWith(n)&&(y.play.defaultTimingCollections[n]=e)}}},{type:"item",id:"play.timingWindowScale",label:"Timing window scale",input:{type:"slider",min:0,step:.001,max:2,hardMax:2**31-1},tooltip:"Scales all timing windows by the given amount."},{type:"item",id:"play.timingWindowAdd",label:"Timing window add",input:{type:"slider",min:0,step:.001,max:1,hardMax:2**31-1},tooltip:"Adds this value (in seconds) to all timing windows."}]}]},{type:"group",id:"performance",label:"Performance",children:[{type:"item",label:"Antialiasing",id:"performance.antialiasing",input:{type:"checkbox"}},{type:"item",label:"Resolution",id:"performance.resolution",input:{type:"slider",min:1,step:1,max:4,hardMin:0,hardMax:2**31-1},tooltip:"Requires a reload."}]},{type:"group",id:"debug",label:"Debug",children:[{type:"item",label:"Show FPS",id:"debug.showFPS",input:{type:"checkbox"}},{type:"item",label:"Show rendering timers",id:"debug.showTimers",input:{type:"checkbox"}},{type:"item",label:"Show noteskin errors",id:"debug.showNoteskinErrors",input:{type:"checkbox"}},{type:"item",label:"Show scrolls/speeds debug visual",id:"debug.showScroll",input:{type:"checkbox"}}]},{type:"group",id:"experimental",label:"Experimental",children:[{type:"subgroup",label:"Parity",children:[{type:"item",label:"Enabled",id:"experimental.parity.enabled",input:{type:"checkbox"}},{type:"item",label:"Show debug stats",id:"experimental.parity.showDebug",input:{type:"checkbox"}},{type:"item",label:"Show parity graph",id:"experimental.parity.showGraph",input:{type:"checkbox"}},{type:"item",label:"Limit graph nodes",tooltip:"Limits the number of nodes in each row of the parity graph to 16.",id:"experimental.parity.limitGraph",input:{type:"checkbox"}},{type:"item",label:"Show dancing bot",id:"experimental.parity.showDancingBot",input:{type:"checkbox"}}]}]}];class pm extends ot{app;observer;sectionContainer;constructor(e){super({title:"Options",width:600,height:400,disableClose:!1,win_id:"user_options",blocking:!1}),this.app=e,this.initView(),re.on("resize",()=>{this.move(window.innerWidth/2-this.options.width/2*y.general.uiScale,window.innerHeight/2-this.options.height/2*y.general.uiScale)})}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("div");t.classList.add("pref-container");const n=document.createElement("div");n.classList.add("pref-search");const a=document.createElement("input");a.classList.add("pref-search-bar"),a.type="text",a.placeholder="Search for an option...",a.oninput=()=>{s.replaceChildren(),o.replaceChildren(...this.createOptions(this.filterOptions(a.value)))},n.appendChild(a);const r=document.createElement("div");r.classList.add("pref-scrollers");const s=document.createElement("div");s.classList.add("pref-section-scroller"),this.sectionContainer=s;const o=document.createElement("div");o.classList.add("pref-option-scroller"),r.replaceChildren(s,o),this.observer=new IntersectionObserver(l=>{l.forEach(u=>{const f=u.target.dataset.id,c=s.querySelector(`.pref-section[data-id=${f}]`);c&&(u.intersectionRatio>0?c.classList.add("selected"):c.classList.remove("selected"))})},{}),t.replaceChildren(n,r),s.replaceChildren(),o.replaceChildren(...this.createOptions(fc)),e.appendChild(t),this.viewElement.appendChild(e)}createOptions(e){return e.filter(t=>!t.disable?.(this.app)).map(t=>{const n=this.makeOption(t);return t.type=="group"&&(this.observer.observe(n),this.sectionContainer?.appendChild(this.createEmptyGroup(t))),n})}makeOption(e){const t=document.createElement("div");t.classList.add("pref-"+e.type),(e.type=="group"||e.type=="item")&&(t.dataset.id=e.id);const n=document.createElement("div");n.classList.add(`pref-${e.type}-label`,"label"),e.label!==void 0&&(n.innerText=e.label,t.appendChild(n));const a=me.getIcon("REVERT",12);if(e.type=="item"&&(a.addEventListener("click",()=>{y.applyOption([e.id,y.getDefaultOption(e.id)]);const r=e.input.onChange;r?.(this.app,y.getDefaultOption(e.id)),t.replaceWith(this.makeOption(e))}),a.style.display=y.getDefaultOption(e.id)===y.getOption(e.id)?"none":"block",t.appendChild(a)),e.type=="item"){if(n.innerText=e.label,!e.input)return t;const r=y.getOption(e.id),s={...e.input},o=s.onChange;s.onChange=(u,f)=>{y.applyOption([e.id,f]),a.style.display=y.getDefaultOption(e.id)===y.getOption(e.id)?"none":"block",o?.(u,f)};const l=tu(this.app,s,r);e.input.type=="checkbox"&&l.classList.add("pref-input","right"),e.input.type=="dropdown"&&l.classList.add("pref-input","dropdown-right"),l.classList.add("pref-item-input"),t.appendChild(l)}else{const r=document.createElement("div");r.classList.add("pref-children"),t.appendChild(r),r.replaceChildren(...this.createOptions(e.children))}return e.type=="item"&&e.tooltip!==void 0&&Xe(t,{content:e.tooltip}),t}filterOptions(e,t=fc){const n=[];return t.forEach(a=>{if(a.label&&a.label.toLowerCase().includes(e.toLowerCase())){n.push(a);return}if(a.type=="group"||a.type=="subgroup"){const r=this.filterOptions(e,a.children);r.length!=0&&n.push({...a,children:r})}}),n}createEmptyGroup(e){const t=document.createElement("div");return t.classList.add("pref-section"),t.dataset.id=e.id,t.innerText=e.label,t.onclick=()=>{t.parentElement.parentElement.querySelector(`.pref-group[data-id=${e.id}]`).scrollIntoView()},t}onClose(){this.observer?.disconnect()}}var kn=(i=>(i.SHIFT="Shift",i.CTRL="Ctrl",i.ALT="Alt",i.META="Command",i))(kn||{});const nt=Yt?"Command":"Ctrl",mm={Shift:Yt?"⇧":"Shift",Ctrl:Yt?"⌃":"Ctrl",Alt:Yt?"⌥":"Alt",Command:"⌘"},pc={ArrowLeft:"Left",ArrowUp:"Up",ArrowRight:"Right",ArrowDown:"Down",BracketLeft:"[",BracketRight:"]",Semicolon:";",Quote:"'",Backslash:"\\",Slash:"/",Period:".",Comma:",",Backquote:"`",Minus:"-",Equal:"+"},Nu={Home:Yt?"fn Left":"Home",End:Yt?"fn Right":"End",PageUp:Yt?"fn Up":"PageUp",PageDown:Yt?"fn Down":"PageDown"},Na=["ctrlKey","altKey","shiftKey","metaKey"],Aa=["Ctrl","Alt","Shift","Command"],We={playback:{label:"Play/Pause",combos:[{key:"Space",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==q.Play||i.chartManager.getMode()==q.Record,callback:i=>i.chartManager.playPause()},decreaseSnap:{label:"Decrease snap",combos:[{key:"Left",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==q.Play||i.chartManager.getMode()==q.Record,callback:i=>i.chartManager.previousSnap()},increaseSnap:{label:"Increase snap",combos:[{key:"Right",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==q.Play||i.chartManager.getMode()==q.Record,callback:i=>i.chartManager.nextSnap()},cursorUp:{label:"Move cursor up",combos:[{key:"Up",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==q.Play||i.chartManager.getMode()==q.Record,callback:i=>{y.chart.scroll.invertReverseScroll&&y.chart.reverse?i.chartManager.snapToNextTick():i.chartManager.snapToPreviousTick()}},cursorDown:{label:"Move cursor down",combos:[{key:"Down",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==q.Play||i.chartManager.getMode()==q.Record,callback:i=>{y.chart.scroll.invertReverseScroll&&y.chart.reverse?i.chartManager.snapToPreviousTick():i.chartManager.snapToNextTick()}},increaseScrollSpeed:{label:"Increase scroll speed",combos:[{key:"Up",mods:["Shift"]}],disabled:i=>!i.chartManager.chartView,callback:()=>y.chart.speed=Math.max(10,y.chart.speed*Math.pow(1.01,30))},decreaseScrollSpeed:{label:"Decrease scroll speed",combos:[{key:"Down",mods:["Shift"]}],disabled:i=>!i.chartManager.chartView,callback:()=>y.chart.speed=Math.max(10,y.chart.speed*Math.pow(1.01,-30))},zoomIn:{label:"Zoom in",combos:[{key:"+",mods:[nt]}],disabled:i=>!i.chartManager.chartView,callback:()=>{y.chart.zoom+=.1,de.create("Zoom: "+Math.round(y.chart.zoom*100)+"%")}},zoomOut:{label:"Zoom out",combos:[{key:"-",mods:[nt]}],disabled:i=>!i.chartManager.chartView,callback:()=>{y.chart.zoom=Math.max(.1,y.chart.zoom-.1),de.create("Zoom: "+Math.round(y.chart.zoom*100)+"%")}},zoomDefault:{label:"Reset zoom",combos:[{key:"0",mods:[nt]}],disabled:i=>!i.chartManager.chartView,callback:()=>{y.chart.zoom=1,de.create("Zoom: "+Math.round(y.chart.zoom*100)+"%")}},newSong:{label:"New song...",bindLabel:"New song",combos:[{key:"N",mods:[nt]}],disabled:i=>!i.chartManager.loadedSM||!he.openWindows,callback:i=>{i.windowManager.openWindow(new Pu(i))}},openSong:{label:"Open song...",bindLabel:"Open song",combos:[{key:"O",mods:[nt]}],disabled:i=>!i.chartManager.loadedSM||!he.openWindows,callback:i=>{if(window.nw){const e=document.createElement("input");e.type="file",e.accept=".sm,.ssc",e.onchange=()=>i.chartManager.loadSM(e.value),e.click()}else i.windowManager.openWindow(new vo(i,!1))}},songProperties:{label:"Song properties...",bindLabel:"Open song properties",combos:[{key:"O",mods:["Shift"]}],disabled:i=>!i.chartManager.loadedSM||!he.openWindows,callback:i=>i.windowManager.openWindow(new cm(i))},save:{label:"Save...",bindLabel:"Save",combos:[{key:"S",mods:[nt]}],disabled:i=>!i.chartManager.loadedSM||i.chartManager.smPath.startsWith("https://")||i.chartManager.smPath.startsWith("http://"),callback:i=>i.chartManager.save()},export:{label:"Save and export current song",combos:[{key:"E",mods:[nt]}],disabled:i=>!!window.nw||!i.chartManager.loadedSM||i.chartManager.smPath.startsWith("https://")||i.chartManager.smPath.startsWith("http://"),callback:i=>{i.chartManager.save(),Ee.getStandardHandler().saveDirectory(i.chartManager.smPath)}},exportNotedata:{label:"Export to notedata...",bindLabel:"Export to notedata",combos:[{key:"E",mods:[nt,"Shift"]}],disabled:i=>!i.chartManager.loadedSM||!he.openWindows,callback:i=>i.windowManager.openWindow(new nm(i,i.chartManager.selection.notes))},capture:{label:"Export video...",combos:[],disabled:i=>!i.chartManager.loadedSM||!he.openWindows,callback:i=>{i.windowManager.openWindow(new Kh(i))}},previousSong:{label:"Previous song in pack",combos:[{key:"F5",mods:["Shift"]}],disabled:i=>!i.chartManager.loadedSM||i.chartManager.smPath.startsWith("https://")||i.chartManager.smPath.startsWith("http://"),callback:i=>{const e=Ee.getStandardHandler();if(!e)return;const t=e.resolvePath(st(i.chartManager.smPath),"..");async function n(){const a=await e.getDirectoryFolders(t);a.sort((s,o)=>s.name.localeCompare(o.name));let r=a.findIndex(s=>s.name==kt(st(i.chartManager.smPath)));if(r==-1){de.createFormatted("An error occured while finding the song pack!","error"),console.error(`Couldn't find the current song idx in parent folder! Path: ${kt(st(i.chartManager.smPath))}, Folders`,a);return}for(r--;r>=0;){const s=a[r];console.log("Checking ",s.name);const o=await e.getDirectoryFiles(s);console.log(o);const l=o.find(u=>u.name.endsWith(".ssc"))??o.find(u=>u.name.endsWith(".sm"));if(l){const u=e.resolvePath(t,s.name,l.name);de.create(`Loading ${s.name}/${l.name}`),i.chartManager.loadSM(u);return}r--}de.create("No previous song in pack")}try{n()}catch(a){de.createFormatted("No songs found!","error"),console.error(a)}}},nextSong:{label:"Next song in pack",combos:[{key:"F6",mods:["Shift"]}],disabled:i=>!i.chartManager.loadedSM||i.chartManager.smPath.startsWith("https://")||i.chartManager.smPath.startsWith("http://"),callback:i=>{const e=Ee.getStandardHandler();if(!e)return;const t=e.resolvePath(st(i.chartManager.smPath),"..");async function n(){const a=await e.getDirectoryFolders(t);a.sort((s,o)=>s.name.localeCompare(o.name));let r=a.findIndex(s=>s.name==kt(st(i.chartManager.smPath)));if(r==-1){de.createFormatted("An error occured while finding the song pack!","error"),console.error(`Couldn't find the current song idx in parent folder! Path: ${kt(st(i.chartManager.smPath))}, Folders`,a);return}for(r++;r<a.length;){const s=a[r],o=await e.getDirectoryFiles(s),l=o.find(u=>u.name.endsWith(".ssc"))??o.find(u=>u.name.endsWith(".sm"));if(l){const u=e.resolvePath(t,s.name,l.name);de.create(`Loading ${s.name}/${l.name}`),i.chartManager.loadSM(u);return}r++}de.create("No next song in pack")}try{n()}catch(a){de.createFormatted("No songs found!","error"),console.error(a)}}},openChart:{label:"Chart list",bindLabel:"Open chart list",combos:[{key:"O",mods:[nt,"Shift"]}],disabled:i=>!i.chartManager.loadedSM||!he.openWindows,callback:i=>i.windowManager.openWindow(new Bu(i))},timingDataRow:{label:"Edit timing data at row",combos:[{key:"T",mods:["Shift"]}],disabled:i=>!i.chartManager.chartView||!he.openWindows,callback:i=>i.windowManager.openWindow(new fm(i))},selectRegion:{label:"Select region",combos:[{key:"Tab",mods:[]}],disabled:i=>!i.chartManager.loadedChart&&i.chartManager.getMode()!=q.Edit,callback:i=>i.chartManager.selectRegion()},volumeUp:{label:"Increase master volume",combos:[{key:"Up",mods:["Alt"]}],disabled:!1,callback:()=>{y.audio.masterVolume=Math.min(y.audio.masterVolume+.05,1),de.create("Master volume: "+Math.round(y.audio.masterVolume*100)+"%")}},volumeDown:{label:"Decrease master volume",combos:[{key:"Down",mods:["Alt"]}],disabled:!1,callback:()=>{y.audio.masterVolume=Math.max(y.audio.masterVolume-.05,0),de.create("Master volume: "+Math.round(y.audio.masterVolume*100)+"%")}},songVolumeUp:{label:"Increase song volume",combos:[{key:"Up",mods:["Shift","Alt"]}],disabled:!1,callback:()=>{y.audio.songVolume=Math.min(y.audio.songVolume+.05,1),de.create("Song volume: "+Math.round(y.audio.songVolume*100)+"%")}},songVolumeDown:{label:"Decrease song volume",combos:[{key:"Down",mods:["Shift","Alt"]}],disabled:!1,callback:()=>{y.audio.songVolume=Math.max(y.audio.songVolume-.05,0),de.create("Song volume: "+Math.round(y.audio.songVolume*100)+"%")}},effectvolumeUp:{label:"Increase tick/metronome volume",combos:[{key:"Up",mods:["Shift",nt,"Alt"]}],disabled:!1,callback:()=>{y.audio.soundEffectVolume=Math.min(y.audio.soundEffectVolume+.05,1),de.create("Effect volume: "+Math.round(y.audio.soundEffectVolume*100)+"%")}},effectvolumeDown:{label:"Decrease tick/metronome volume",combos:[{key:"Down",mods:["Shift",nt,"Alt"]}],disabled:!1,callback:()=>{y.audio.soundEffectVolume=Math.max(y.audio.soundEffectVolume-.05,0),de.create("Effect Volume: "+Math.round(y.audio.soundEffectVolume*100)+"%")}},rateUp:{label:"Increase playback rate",combos:[{key:"Right",mods:["Shift"]}],disabled:i=>i.chartManager.getMode()==q.Play||i.chartManager.getMode()==q.Record,callback:()=>{y.audio.rate+=.05,de.create("Playback Rate: "+Math.round(y.audio.rate*100)+"%")}},rateDown:{label:"Decrease playback rate",combos:[{key:"Left",mods:["Shift"]}],disabled:i=>i.chartManager.getMode()==q.Play||i.chartManager.getMode()==q.Record,callback:()=>{y.audio.rate=Math.max(y.audio.rate-.05,.1),de.create("Playback Rate: "+Math.round(y.audio.rate*100)+"%")}},rateDefault:{label:"Reset playback rate",combos:[],disabled:!1,callback:()=>{y.audio.rate=1,de.create("Playback Rate: "+Math.round(y.audio.rate)+"%")}},previousStream:{label:"Previous stream",combos:[{key:"Up",mods:[nt]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==q.Play||i.chartManager.getMode()==q.Record,callback:i=>{const e=[];for(const n of i.chartManager.loadedChart.stats.streams)e.at(-1)==n.startBeat&&e.pop(),e.push(n.startBeat),e.push(n.endBeat);if(e.length==0)return;const t=Ut(e,i.chartManager.beat);Math.abs(i.chartManager.beat-e[t])<.001?t-1>=0?i.chartManager.beat=e[t-1]:i.chartManager.beat=e[0]:i.chartManager.beat=e[t]}},nextStream:{label:"Next stream",combos:[{key:"Down",mods:[nt]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==q.Play||i.chartManager.getMode()==q.Record,callback:i=>{const e=[];for(const n of i.chartManager.loadedChart.stats.streams)e.at(-1)==n.startBeat&&e.pop(),e.push(n.startBeat),e.push(n.endBeat);if(e.length==0)return;const t=Ut(e,i.chartManager.beat);if(t==0&&i.chartManager.beat<e[t]){i.chartManager.beat=e[t];return}ed(i.chartManager.beat,e[t])?t+1<e.length?i.chartManager.beat=e[t+1]:i.chartManager.beat=e[t]:i.chartManager.beat=e[t+1]}},previousMeasure:{label:"Previous measure",combos:[{key:"PageUp",mods:[]},{key:";",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==q.Play||i.chartManager.getMode()==q.Record,callback:i=>{const e=i.chartManager.beat;if(y.chart.scroll.invertReverseScroll&&y.chart.reverse){const t=i.chartManager.loadedChart.timingData.getMeasureLength(e);i.chartManager.snapToNearestTick(Math.max(0,e+t))}else{const t=i.chartManager.loadedChart.timingData.getMeasureLength(e-.001);i.chartManager.snapToNearestTick(Math.max(0,e-t))}}},nextMeasure:{label:"Next measure",combos:[{key:"PageDown",mods:[]},{key:"'",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==q.Play||i.chartManager.getMode()==q.Record,callback:i=>{const e=i.chartManager.beat;if(y.chart.scroll.invertReverseScroll&&y.chart.reverse){const t=i.chartManager.loadedChart.timingData.getMeasureLength(e-.001);i.chartManager.snapToNearestTick(Math.max(0,e-t))}else{const t=i.chartManager.loadedChart.timingData.getMeasureLength(e);i.chartManager.snapToNearestTick(Math.max(0,e+t))}}},previousNote:{label:"Previous note",combos:[{key:",",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==q.Play||i.chartManager.getMode()==q.Record,callback:i=>i.chartManager.previousNote()},nextNote:{label:"Next note",combos:[{key:".",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==q.Play||i.chartManager.getMode()==q.Record,callback:i=>i.chartManager.nextNote()},jumpChartStart:{label:"Jump to first note",combos:[],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==q.Play||i.chartManager.getMode()==q.Record,callback:i=>i.chartManager.firstNote()},jumpChartEnd:{label:"Jump to last note",combos:[],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==q.Play||i.chartManager.getMode()==q.Record,callback:i=>i.chartManager.lastNote()},jumpSongStart:{label:"Jump to song start",combos:[{key:"Home",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==q.Play||i.chartManager.getMode()==q.Record,callback:i=>i.chartManager.beat=Math.max(0,i.chartManager.loadedChart.getBeatFromSeconds(0))},jumpSongEnd:{label:"Jump to song end",combos:[{key:"End",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==q.Play||i.chartManager.getMode()==q.Record,callback:i=>i.chartManager.beat=i.chartManager.loadedChart.getBeatFromSeconds(i.chartManager.chartAudio.getSongLength())},assistTick:{label:"Assist tick",combos:[{key:"F7",mods:[]}],disabled:()=>!he.assist,callback:()=>{y.audio.assistTick=!y.audio.assistTick,de.create("Assist Tick: "+(y.audio.assistTick?"on":"off"))}},metronome:{label:"Metronome",combos:[{key:"F7",mods:["Alt"]}],disabled:()=>!he.assist,callback:()=>{y.audio.metronome=!y.audio.metronome,de.create("Metronome: "+(y.audio.metronome?"on":"off"))}},XMod:{label:"XMod (Beat-based)",combos:[{key:"X",mods:["Shift"]}],disabled:!1,callback:()=>{y.chart.CMod=!1,de.create("Switched to XMod")}},CMod:{label:"CMod (Time-based)",combos:[{key:"C",mods:["Shift"]}],disabled:!1,callback:()=>{y.chart.CMod=!0,de.create("Switched to CMod")}},reverse:{label:"Reverse playfield",combos:[],disabled:!1,callback:()=>{y.chart.reverse=!y.chart.reverse,de.create("Reverse Playfield: "+(y.chart.reverse?"on":"off"))}},hideWarpedArrows:{label:"Hide warped notes (CMod only)",combos:[{key:"W",mods:["Shift"]}],disabled:!1,callback:()=>{y.chart.hideWarpedArrows=!y.chart.hideWarpedArrows,de.create("Hide Warped Arrows: "+(y.chart.hideWarpedArrows?"on":"off"))}},hideFakedArrows:{label:"Hide faked notes (CMod only)",combos:[{key:"F",mods:["Shift"]}],disabled:!1,callback:()=>{y.chart.hideFakedArrows=!y.chart.hideFakedArrows,de.create("Hide Faked Arrows: "+(y.chart.hideFakedArrows?"on":"off"))}},doSpeedChanges:{label:"Do speed changes (XMod only)",combos:[{key:"S",mods:["Shift"]}],disabled:!1,callback:()=>{y.chart.doSpeedChanges=!y.chart.doSpeedChanges,de.create("Speed Changes: "+(y.chart.doSpeedChanges?"on":"off"))}},showEq:{label:"Equalizer",combos:[{key:"E",mods:["Shift"]}],disabled:i=>!i.chartManager.chartAudio||!he.openWindows,callback:i=>i.windowManager.openWindow(new tm(i))},detectSync:{label:"Detect audio sync",combos:[{key:"L",mods:["Shift"]}],disabled:i=>!i.chartManager.chartAudio||!he.openWindows,callback:i=>i.windowManager.openWindow(new Ou(i))},previousNoteType:{label:"Previous note type",combos:[{key:"N",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==q.Play||i.chartManager.getMode()==q.Record,callback:i=>i.chartManager.previousNoteType()},nextNoteType:{label:"Next note type",combos:[{key:"M",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==q.Play||i.chartManager.getMode()==q.Record,callback:i=>i.chartManager.nextNoteType()},undo:{label:"Undo",combos:[{key:"Z",mods:[nt]}],disabled:i=>!i.actionHistory.canUndo()||i.chartManager.getMode()!=q.Edit,callback:i=>i.actionHistory.undo()},redo:{label:"Redo",combos:[{key:"Y",mods:[nt]},{key:"Z",mods:[nt,"Shift"]}],disabled:i=>!i.actionHistory.canRedo()||i.chartManager.getMode()!=q.Edit,callback:i=>i.actionHistory.redo()},mousePlacement:{label:"Enable Mouse Note Placement",combos:[{key:"M",mods:["Shift"]}],disabled:!1,callback:()=>{y.chart.mousePlacement=!y.chart.mousePlacement,de.create("Mouse Note Placement: "+(y.chart.mousePlacement?"on":"off"))}},playMode:{label:"Enter/Exit Play Mode",combos:[{key:"P",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==q.Record||!he.playMode,callback:i=>i.chartManager.setMode(q.Play)},recordMode:{label:"Enter/Exit Record Mode",combos:[{key:"R",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==q.Play||i.chartManager.getMode()==q.View||!he.recordMode,callback:i=>i.chartManager.setMode(q.Record)},playModeStart:{label:"Play from start",combos:[{key:"P",mods:["Shift"]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==q.Record||!he.playMode,callback:i=>{i.chartManager.beat=0,i.chartManager.setMode(q.Play)}},recordModeStart:{label:"Record from start",combos:[{key:"R",mods:["Shift"]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==q.Play||i.chartManager.getMode()==q.View||!he.recordMode,callback:i=>i.chartManager.setMode(q.Record)},options:{label:"Options...",bindLabel:"Edit options",combos:[{key:",",mods:[nt]}],disabled:()=>!he.openWindows||!he.openWindows,callback:i=>{i.windowManager.openWindow(new pm(i))}},keybinds:{label:"Keybinds...",bindLabel:"Edit keybinds",combos:[],disabled:()=>!he.openWindows||!he.openWindows,callback:i=>{i.windowManager.openWindow(new ni(i))}},gameplayKeybinds:{label:"Gameplay keybinds...",bindLabel:"Edit gameplay keybinds",combos:[],disabled:()=>!he.openWindows||!he.openWindows,callback:i=>{i.windowManager.openWindow(new am(i))}},themes:{label:"Themes...",bindLabel:"Edit themes",combos:[],disabled:()=>!he.openWindows||!he.openWindows||Qn.isOpen,callback:i=>{i.windowManager.openWindow(new Ps(i))}},convertHoldsRolls:{label:"Holds to rolls",bindLabel:"Convert holds to rolls",combos:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=q.Edit,callback:i=>{i.chartManager.modifySelection(e=>(e.type=="Hold"&&(e.type="Roll"),e))}},convertRollsHolds:{label:"Rolls to holds",bindLabel:"Convert rolls to holds",combos:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=q.Edit,callback:i=>{i.chartManager.modifySelection(e=>(e.type=="Roll"&&(e.type="Hold"),e))}},swapHoldsRolls:{label:"Swap holds and rolls",combos:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=q.Edit,callback:i=>{i.chartManager.modifySelection(e=>(e.type=="Hold"?e.type="Roll":e.type=="Roll"&&(e.type="Hold"),e))}},convertHoldsTaps:{label:"Holds/rolls to taps",bindLabel:"Convert holds/rolls to taps",combos:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=q.Edit,callback:i=>{i.chartManager.modifySelection(e=>((e.type=="Hold"||e.type=="Roll")&&(e.type="Tap"),e))}},convertTapsMines:{label:"Taps to mines",bindLabel:"Convert taps to mines",combos:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=q.Edit,callback:i=>{i.chartManager.modifySelection(e=>(e.type=="Tap"&&(e.type="Mine"),e))}},convertTapsLifts:{label:"Taps to lifts",bindLabel:"Convert taps to lifts",combos:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=q.Edit,callback:i=>{i.chartManager.modifySelection(e=>(e.type=="Tap"&&(e.type="Lift"),e))}},convertTapsFakes:{label:"Taps to fakes",bindLabel:"Convert taps to fakes",combos:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=q.Edit,callback:i=>{i.chartManager.modifySelection(e=>(e.type=="Tap"&&(e.type="Fake"),e))}},mirrorHorizontally:{label:"Horizontally",bindLabel:"Mirror horizontally",combos:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=q.Edit,callback:i=>{i.chartManager.modifySelection(e=>(e.col=i.chartManager.loadedChart.gameType.flipColumns.horizontal[e.col],e))}},mirrorVertically:{label:"Vertically",bindLabel:"Mirror vertically",combos:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=q.Edit,callback:i=>{i.chartManager.modifySelection(e=>(e.col=i.chartManager.loadedChart.gameType.flipColumns.vertical[e.col],e))}},mirrorBoth:{label:"Both",bindLabel:"Mirror both",combos:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=q.Edit,callback:i=>{i.chartManager.modifySelection(e=>(e.col=i.chartManager.loadedChart.gameType.flipColumns.horizontal[e.col],e.col=i.chartManager.loadedChart.gameType.flipColumns.vertical[e.col],e))}},selectBeforeCursor:{label:"Select before cursor",combos:[{key:"Home",mods:["Shift"]}],disabled:i=>!i.chartManager.loadedChart,callback:i=>{i.chartManager.editTimingMode==ke.Off?i.chartManager.setNoteSelection(i.chartManager.loadedChart.getNotedata().filter(e=>e.beat<i.chartManager.beat)):i.chartManager.setEventSelection(i.chartManager.loadedChart.timingData.getTimingData().filter(e=>e.beat<i.chartManager.beat))}},selectAfterCursor:{label:"Select after cursor",combos:[{key:"End",mods:["Shift"]}],disabled:i=>!i.chartManager.loadedChart,callback:i=>{i.chartManager.editTimingMode==ke.Off?i.chartManager.setNoteSelection(i.chartManager.loadedChart.getNotedata().filter(e=>e.beat>i.chartManager.beat)):i.chartManager.setEventSelection(i.chartManager.loadedChart.timingData.getTimingData().filter(e=>e.beat>i.chartManager.beat))}},selectAll:{label:"Select all",combos:[{key:"A",mods:[nt]}],disabled:i=>!i.chartManager.loadedChart,callback:i=>{i.chartManager.editTimingMode==ke.Off?i.chartManager.setNoteSelection(i.chartManager.loadedChart.getNotedata()):i.chartManager.setEventSelection(i.chartManager.loadedChart.timingData.getTimingData())}},expand2to1:{label:"Expand 2:1 (8th to 4th)",combos:[],disabled:i=>i.chartManager.selection.notes.length<2||i.chartManager.getMode()!=q.Edit,callback:i=>{const e=Math.min(...i.chartManager.selection.notes.map(t=>t.beat));i.chartManager.modifySelection(t=>(t.beat=(t.beat-e)*2+e,t.beat=Math.round(t.beat*48)/48,Oe(t)&&(t.hold*=2,t.hold=Math.round(t.hold*48)/48),t))}},expand3to2:{label:"Expand 3:2 (12th to 8th)",combos:[],disabled:i=>i.chartManager.selection.notes.length<2||i.chartManager.getMode()!=q.Edit,callback:i=>{const e=Math.min(...i.chartManager.selection.notes.map(t=>t.beat));i.chartManager.modifySelection(t=>(t.beat=(t.beat-e)*1.5+e,t.beat=Math.round(t.beat*48)/48,Oe(t)&&(t.hold*=1.5,t.hold=Math.round(t.hold*48)/48),t))}},expand4to3:{label:"Expand 4:3 (16th to 2th)",combos:[],disabled:i=>i.chartManager.selection.notes.length<2||i.chartManager.getMode()!=q.Edit,callback:i=>{const e=Math.min(...i.chartManager.selection.notes.map(t=>t.beat));i.chartManager.modifySelection(t=>(t.beat=(t.beat-e)*4/3+e,t.beat=Math.round(t.beat*48)/48,Oe(t)&&(t.hold*=4/3,t.hold=Math.round(t.hold*48)/48),t))}},compress1to2:{label:"Compress 1:2 (4th to 8th)",combos:[],disabled:i=>i.chartManager.selection.notes.length<2||i.chartManager.getMode()!=q.Edit,callback:i=>{const e=Math.min(...i.chartManager.selection.notes.map(t=>t.beat));i.chartManager.modifySelection(t=>(t.beat=(t.beat-e)/2+e,t.beat=Math.round(t.beat*48)/48,Oe(t)&&(t.hold/=2,t.hold=Math.round(t.hold*48)/48),t))}},compress2to3:{label:"Compress 2:3 (8th to 12th)",combos:[],disabled:i=>i.chartManager.selection.notes.length<2||i.chartManager.getMode()!=q.Edit,callback:i=>{const e=Math.min(...i.chartManager.selection.notes.map(t=>t.beat));i.chartManager.modifySelection(t=>(t.beat=(t.beat-e)/1.5+e,t.beat=Math.round(t.beat*48)/48,Oe(t)&&(t.hold/=1.5,t.hold=Math.round(t.hold*48)/48),t))}},compress3to4:{label:"Compress 3:4 (12th to 16th)",combos:[],disabled:i=>i.chartManager.selection.notes.length<2||i.chartManager.getMode()!=q.Edit,callback:i=>{const e=Math.min(...i.chartManager.selection.notes.map(t=>t.beat));i.chartManager.modifySelection(t=>(t.beat=(t.beat-e)*.75+e,t.beat=Math.round(t.beat*48)/48,Oe(t)&&(t.hold*=.75,t.hold=Math.round(t.hold*48)/48),t))}},delete:{label:"Delete",combos:[{key:"Backspace",mods:[]},{key:"Delete",mods:[]}],disabled:i=>i.chartManager.getMode()!=q.Edit||i.chartManager.selection.notes.length==0&&i.chartManager.eventSelection.timingEvents.length==0,callback:i=>{i.chartManager.deleteSelection(),i.chartManager.deleteEventSelection()}},paste:{label:"Paste",combos:[{mods:[nt],key:"V"}],preventDefault:!1,disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()!=q.Edit,callback:async i=>{const e=await navigator.clipboard.readText();i.chartManager.paste(e)}},pasteReplace:{label:"Clear and paste",combos:[{mods:[nt,"Shift"],key:"V"}],preventDefault:!1,disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()!=q.Edit,callback:async i=>{const e=await navigator.clipboard.readText();i.chartManager.paste(e,!0)}},copy:{label:"Copy",combos:[{mods:[nt],key:"C"}],preventDefault:!1,disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()!=q.Edit||!i.chartManager.hasSelection(),callback:async i=>{const e=i.chartManager.copy();e&&await navigator.clipboard.writeText(e)}},cut:{label:"Cut",combos:[{mods:[nt],key:"X"}],preventDefault:!1,disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()!=q.Edit||!i.chartManager.hasSelection(),callback:async i=>{const e=i.chartManager.copy();e&&await navigator.clipboard.writeText(e),i.chartManager.deleteSelection()}},adjustOffset:{label:"Adjust offset",combos:[],disabled:()=>!he.openWindows,callback:i=>i.windowManager.openWindow(new lm(i))},setSongPreview:{label:"Set as song preview",combos:[],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()!=q.Edit||!i.chartManager.hasRange(),callback:i=>{const e=i.chartManager.loadedChart,t=i.chartManager.loadedSM.properties.SAMPLESTART??"0",n=i.chartManager.loadedSM.properties.SAMPLELENGTH??"10";let a="",r="";if(i.chartManager.startRegion!==void 0&&i.chartManager.endRegion!==void 0){const s=e.getSecondsFromBeat(i.chartManager.startRegion),o=e.getSecondsFromBeat(i.chartManager.endRegion);a=ue(s,3).toString(),r=ue(o-s,3).toString()}else{const o=(i.chartManager.selection.notes.length>0?i.chartManager.selection.notes:i.chartManager.eventSelection.timingEvents).map(f=>f.beat),l=e.getSecondsFromBeat($i(o)),u=e.getSecondsFromBeat(Hn(o));a=ue(l,3).toString(),r=ue(u-l,3).toString()}Et.instance.run({action:s=>{s.chartManager.loadedSM.properties.SAMPLESTART=a,s.chartManager.loadedSM.properties.SAMPLELENGTH=r},undo:()=>{i.chartManager.loadedSM.properties.SAMPLESTART=t,i.chartManager.loadedSM.properties.SAMPLELENGTH=n}})}},showDebugTimers:{label:"Toggle Debug Timers",combos:[{key:"F3",mods:["Shift"]}],disabled:!1,callback:()=>{y.debug.showTimers=!y.debug.showTimers}},showFPSCounter:{label:"Toggle FPS Counter",combos:[{key:"F3",mods:[]}],disabled:!1,callback:()=>{y.debug.showFPS=!y.debug.showFPS}},noteTypeTap:{label:"Switch to Taps",combos:[],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()!=q.Edit,callback:i=>{i.chartManager.setEditingNoteType("Tap")}},noteTypeLift:{label:"Switch to Lifts",combos:[],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()!=q.Edit,callback:i=>{i.chartManager.setEditingNoteType("Lift")}},noteTypeMine:{label:"Switch to Mines",combos:[],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()!=q.Edit,callback:i=>{i.chartManager.setEditingNoteType("Mine")}},noteTypeFake:{label:"Switch to Fakes",combos:[],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()!=q.Edit,callback:i=>{i.chartManager.setEditingNoteType("Fake")}},openGuide:{label:"Open Help Guide",combos:[],disabled:!1,callback:()=>{window.open("/smeditor/guide/")}},openChangelog:{label:"Open Changelog",combos:[],disabled:()=>!he.openWindows,callback:i=>{i.windowManager.openWindow(new Su(i))}},noteskinWindow:{label:"Noteskins...",bindLabel:"Open Noteskin Window",combos:[{mods:["Shift"],key:"N"}],disabled:i=>!i.chartManager.chartView||!he.openWindows,callback:i=>i.windowManager.openWindow(new om(i))},previousChart:{label:"Previous chart",combos:[{key:"F5",mods:[]}],disabled:i=>!i.chartManager.chartView,callback:i=>{if(!i.chartManager.loadedSM?.charts||!i.chartManager.loadedChart)return;const e=i.chartManager.loadedSM?.charts[i.chartManager.loadedChart.gameType.id],t=e.indexOf(i.chartManager.loadedChart);e[t-1]?i.chartManager.loadChart(e[t-1]):de.create("No previous chart")}},nextChart:{label:"Next chart",combos:[{key:"F6",mods:[]}],disabled:i=>!i.chartManager.chartView,callback:i=>{if(!i.chartManager.loadedSM?.charts||!i.chartManager.loadedChart)return;const e=i.chartManager.loadedSM?.charts[i.chartManager.loadedChart.gameType.id],t=e.indexOf(i.chartManager.loadedChart);e[t+1]?i.chartManager.loadChart(e[t+1]):de.create("No next chart")}},toggleEditTiming:{label:"Toggle Edit Timing",combos:[{key:"T",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()!=q.Edit,callback:i=>{i.chartManager.editTimingMode!=ke.Off?i.chartManager.editTimingMode=ke.Off:i.chartManager.editTimingMode=ke.Edit}},toggleAddTiming:{label:"Toggle Add Timing",combos:[{key:"T",mods:["Alt"]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()!=q.Edit,callback:i=>{i.chartManager.editTimingMode!=ke.Add?i.chartManager.editTimingMode=ke.Add:i.chartManager.editTimingMode=ke.Edit}},about:{label:"About",combos:[],disabled:()=>!he.openWindows,callback:i=>{i.windowManager.openWindow(new Xd(i))}}};for(const i of[4,2,1])We[`shiftUp${i}m`]={label:`${i} measure`+(i==1,""),bindLabel:`Shift up by ${i} measure`+(i==1,""),combos:[],disabled:e=>!e.chartManager.chartView,callback:e=>{const t=e.chartManager.selection.notes[0].beat,n=e.chartManager.loadedChart.timingData.getMeasureLength(t);e.chartManager.modifySelection(a=>(a.beat-=n*i,a),!0)}},We[`shiftDown${i}m`]={label:`${i} measure`+(i==1,""),bindLabel:`Shift down by ${i} measure`+(i==1,""),combos:[],disabled:e=>!e.chartManager.chartView,callback:e=>{const t=e.chartManager.selection.notes[0].beat,n=e.chartManager.loadedChart.timingData.getMeasureLength(t);e.chartManager.modifySelection(a=>(a.beat+=n*i,a),!0)}};for(let i=0;i<wn.length;i++)We["quant"+So[i]]={label:`Switch to ${ei[i]}s`,combos:[],disabled:e=>!e.chartManager.chartView,callback:()=>{y.chart.snap=wn[i]}},We[`shiftUp${ei[i]}`]={label:`${ei[i]}`,bindLabel:`Shift up by ${ei[i]}`,combos:[],disabled:e=>!e.chartManager.chartView,callback:e=>e.chartManager.modifySelection(t=>(t.beat-=wn[i],t),!0)},We[`shiftDown${ei[i]}`]={label:`${ei[i]}`,bindLabel:`Shift down by ${ei[i]}`,combos:[],disabled:e=>!e.chartManager.chartView,callback:e=>e.chartManager.modifySelection(t=>(t.beat+=wn[i],t),!0)},i!=wn.length-1&&(We["quantize"+ei[i]]={label:`${ei[i]}s`,bindLabel:`Quantize to ${ei[i]}s`,combos:[],disabled:e=>e.chartManager.selection.notes.length==0||e.chartManager.getMode()!=q.Edit,callback:e=>{e.chartManager.modifySelection(t=>(t.beat=e.chartManager.getClosestTick(t.beat,So[i]),t.beat=Math.round(t.beat*48)/48,t))}});for(const i of["STOPS","DELAYS"])We[`convert${i}`]={label:`Convert to ${i[0]}${i.slice(1).toLowerCase()}`,combos:[],disabled:e=>!e.chartManager.chartView||e.chartManager.getMode()!=q.Edit||!e.chartManager.hasRange(),callback:e=>{const t=e.chartManager.loadedChart;let n=0,a=0;if(e.chartManager.startRegion!==void 0&&e.chartManager.endRegion!==void 0){const r=t.getSecondsFromBeat(e.chartManager.startRegion),s=t.getSecondsFromBeat(e.chartManager.endRegion);n=e.chartManager.startRegion,a=s-r}else{const s=(e.chartManager.selection.notes.length>0?e.chartManager.selection.notes:e.chartManager.eventSelection.timingEvents).map(u=>u.beat),o=t.getSecondsFromBeat($i(s)),l=t.getSecondsFromBeat(Hn(s));n=$i(s),a=l-o}e.chartManager.loadedChart.timingData.insertColumnEvents([{type:i,beat:n,value:a}])}};for(const i of["WARPS","FAKES"])We[`convert${i}`]={label:`Convert to ${i[0]}${i.slice(1).toLowerCase()}`,combos:[],disabled:e=>!e.chartManager.chartView||e.chartManager.getMode()!=q.Edit||!e.chartManager.hasRange(),callback:e=>{let t=0,n=0;if(e.chartManager.startRegion!==void 0&&e.chartManager.endRegion!==void 0)t=e.chartManager.startRegion,n=e.chartManager.endRegion-e.chartManager.startRegion;else{const r=(e.chartManager.selection.notes.length>0?e.chartManager.selection.notes:e.chartManager.eventSelection.timingEvents).map(s=>s.beat);t=$i(r),n=Hn(r)-$i(r)}e.chartManager.loadedChart.timingData.insertColumnEvents([{type:i,beat:t,value:n}])}};Kd.forEach((i,e)=>{We[`parity${i.replaceAll(" ","")}`]={label:i,bindLabel:`Mark as ${i}`,combos:[],disabled:t=>!t.chartManager.chartView||t.chartManager.getMode()!=q.Edit||!t.chartManager.hasNoteSelection(),callback:t=>{const n=t.chartManager.selection.notes.filter(o=>o.type!="Mine"&&o.type!="Fake"&&!o.fake&&!o.warped);let a=Number.MAX_VALUE,r=-Number.MAX_VALUE;n.forEach(o=>{o.beat<a&&(a=o.beat),Xt(o)>r&&(r=Xt(o))});const s=[];Et.instance.run({action:o=>{n.forEach(l=>{l.parity||(l.parity={}),s.push(l.parity.override||Me.NONE),l.parity.override=e}),o.chartManager.loadedChart.recalculateStats(a,r),re.emit("chartModified")},undo:()=>{n.forEach((o,l)=>{o.parity||(o.parity={}),o.parity.override=s[l]}),t.chartManager.loadedChart.recalculateStats(a,r),re.emit("chartModified")},redo:()=>{n.forEach(o=>{o.parity||(o.parity={}),o.parity.override=e}),t.chartManager.loadedChart.recalculateStats(a,r),re.emit("chartModified")}})}}});for(const i of["Left","Right"])We[`parity${i}`]={label:i,bindLabel:`Mark as ${i}`,combos:[],disabled:e=>!e.chartManager.chartView||e.chartManager.getMode()!=q.Edit||!e.chartManager.hasNoteSelection(),callback:e=>{const t=e.chartManager.selection.notes.filter(s=>s.type!="Mine"&&s.type!="Fake"&&!s.fake&&!s.warped);let n=Number.MAX_VALUE,a=-Number.MAX_VALUE;t.forEach(s=>{s.beat<n&&(n=s.beat),Xt(s)>a&&(a=Xt(s))});const r=[];Et.instance.run({action:s=>{t.forEach(o=>{o.parity||(o.parity={}),r.push(o.parity.override||Me.NONE),o.parity.override=i}),s.chartManager.loadedChart.recalculateStats(n,a),re.emit("chartModified")},undo:()=>{t.forEach((s,o)=>{s.parity||(s.parity={}),s.parity.override=r[o]}),e.chartManager.loadedChart.recalculateStats(n,a),re.emit("chartModified")},redo:()=>{t.forEach(s=>{s.parity||(s.parity={}),s.parity.override=i}),e.chartManager.loadedChart.recalculateStats(n,a),re.emit("chartModified")}})}};class xo{static popup;static build(e){const t=document.createElement("div");t.classList.add("update-popup");const n=document.createElement("div");n.classList.add("title"),n.innerText=e.title;const a=document.createElement("div");a.classList.add("desc"),a.innerText=e.desc;const r=document.createElement("div");if(r.classList.add("update-options"),t.replaceChildren(n,a),e.options.length>0){for(const s of e.options){const o=document.createElement("button");o.innerText=s.label,o.onclick=()=>{s.callback?.(this)},o.classList.add(s.type),r.appendChild(o)}t.appendChild(r)}this.popup=t,document.getElementById("popups")?.appendChild(this.popup)}static close(){this.popup&&(this.popup.classList.add("exiting"),this.popup.style.pointerEvents="none",setTimeout(()=>this.popup.remove(),300))}}class Hu extends xo{static open(e,t){super.build({title:`A new version of the desktop app is available! (${e})`,desc:"Click here to download the new version.",options:[{label:"Close",type:"default",callback:()=>this.close()},{label:"Download",type:"confirm",callback:()=>{localStorage.setItem("downloadedVersion",e),nw.require("nw.gui").Shell.openExternal(t),this.close()}}]})}}class zu extends xo{static open(e){super.build({title:"A new version of the app is available!",desc:"Refresh the page to get the new version.",options:[{label:"Close",type:"default",callback:()=>this.close()},{label:"Refresh",type:"confirm",callback:()=>{e(),window.location.reload()}}]})}}class gm extends xo{static open(){super.build({title:"SMEditor was loaded offline!",desc:"You can now use SMEditor without an internet connection.",options:[]}),setTimeout(()=>this.close(),5e3)}}class dt extends Dc{static graphics=new ea;static textures={default:Ai.create({width:50,height:50}),noBorder:Ai.create({width:50,height:50}),onlyBorder:Ai.create({width:50,height:50})};static init(e){this.textures.default=Ai.create({width:50,height:50,resolution:e.resolution}),this.textures.noBorder=Ai.create({width:50,height:50,resolution:e.resolution}),this.textures.onlyBorder=Ai.create({width:50,height:50,resolution:e.resolution}),this.graphics.beginFill(16777215,1),this.graphics.lineStyle(1,0),this.graphics.drawRoundedRect(0,0,50,50,5),this.graphics.endFill(),e.render(this.graphics,{renderTexture:this.textures.default}),this.graphics.clear(),this.graphics.beginFill(16777215,1),this.graphics.lineStyle(0,16777215),this.graphics.drawRoundedRect(0,0,50,50,5),this.graphics.endFill(),e.render(this.graphics,{renderTexture:this.textures.noBorder}),this.graphics.clear(),this.graphics.beginFill(16777215,0),this.graphics.lineStyle(2,16777215),this.graphics.drawRoundedRect(0,0,50,50,5),this.graphics.endFill(),e.render(this.graphics,{renderTexture:this.textures.onlyBorder})}constructor(e){super(dt.textures[e??"default"],5,5,5,5)}}const Sn=[];function mc(){return Sn.length}function bm(){for(Sn.push(Date.now());Sn.length>0&&Sn[0]<Date.now()-1e3;)Sn.shift()}const Tn=[];function gc(){return Tn.length}function ym(){for(Tn.push(Date.now());Tn.length>0&&Tn[0]<Date.now()-1e3;)Tn.shift()}class Zi extends fe{manager;constructor(e){super(),this.manager=e}startPlay(){}endPlay(){}}const qt=50;class ji extends Zi{static instance;frameTimeGraph=new _n({width:300,height:qt,color:1525027,min:0,unit:"ms",label:"Draw",precision:1,sublabel:()=>mc()+" FPS"});drawUpdateTimeGraph=new _n({width:300,height:qt,color:6034982,min:0,unit:"ms",label:"DrawUpdate",precision:1});updateTimeGraph=new _n({width:300,height:qt,color:1516101,min:0,unit:"ms",label:"Update",precision:1,sublabel:()=>gc()+" TPS"});memoryTimeGraph=new _n({width:300,height:qt,color:6626406,min:0,formatter:e=>Math.round(e/1048576)+" MB",label:"Memory"});cpuGraph=new _n({width:300,height:qt,color:5190685,min:0,label:"CPU"});graphs=new fe;fpsCounter=new fe;fpsBg=new dt("noBorder");fpsText=new ye("",{fontName:"Main",fontSize:12});lastFrameTime=0;properties=new Map;constructor(e){super(e),this.drawUpdateTimeGraph.y+=qt+5,this.updateTimeGraph.y+=(qt+5)*2,this.memoryTimeGraph.y+=(qt+5)*3,this.cpuGraph.y+=(qt+5)*4,ji.instance=this,this.fpsText.x=5,this.fpsBg.y=-5,ze(this.fpsBg,"widget-bg"),ze(this.fpsText,"text-color"),this.graphs.addChild(this.frameTimeGraph,this.drawUpdateTimeGraph,this.updateTimeGraph),performance.memory&&this.graphs.addChild(this.memoryTimeGraph),this.fpsCounter.addChild(this.fpsBg,this.fpsText),this.graphs.visible=y.debug.showTimers,this.fpsCounter.visible=y.debug.showFPS,this.addChild(this.graphs,this.fpsCounter)}update(){this.x=-this.manager.app.STAGE_WIDTH/2+20,this.y=-this.manager.app.STAGE_HEIGHT/2+20,this.graphs.children.forEach(e=>e.update()),this.graphs.visible=y.debug.showTimers,this.fpsCounter.visible=y.debug.showFPS,this.fpsText.text=`${mc()} FPS
${gc()} TPS
${this.lastFrameTime.toFixed(2)} ms
`,y.debug.showDebugVariables&&this.properties.forEach((e,t)=>{this.fpsText.text+=`${t}: ${e}
`}),this.fpsBg.width=this.fpsText.width+10,this.fpsBg.height=this.fpsText.height+10,y.debug.showTimers?(this.fpsBg.y=(qt+5)*this.graphs.children.length-5,this.fpsText.y=(qt+5)*this.graphs.children.length):(this.fpsBg.y=-5,this.fpsText.y=0)}addMemoryTimeValue(e){this.memoryTimeGraph.addValue(e)}addFrameTimeValue(e){this.lastFrameTime=e,this.frameTimeGraph.addValue(e)}addUpdateTimeValue(e){this.updateTimeGraph.addValue(e)}addDrawUpdateTimeValue(e){this.drawUpdateTimeGraph.addValue(e)}setProperty(e,t){this.properties.set(e,t)}clearProperty(e){this.properties.delete(e)}clearProperties(){this.properties.clear()}}class _n extends fe{graphWidth;graphHeight;color;unit;precision;formatter;sublabel;maxEase=1;targetMax=1;minEase=1;targetMin=1;constrainedMin=null;constrainedMax=null;dataPoints=[];linePool=[];lineContainer;labelText;sublabelText;topText;bottomText;constructor(e){super();const{width:t,height:n,color:a=16777215,unit:r="",label:s="",min:o=null,max:l=null,precision:u=0,formatter:f=null,sublabel:c=()=>""}=e;this.graphWidth=t,this.graphHeight=n,this.color=a,this.unit=r,this.constrainedMax=l,this.constrainedMin=o,this.precision=u,this.formatter=f,this.sublabel=c,this.lineContainer=new Gs(t,{position:!0},16384,!0);const d=new dt("noBorder");d.tint=0,d.alpha=.3,d.width=this.graphWidth,d.height=this.graphHeight,ze(d,"widget-bg"),this.labelText=new ye(s,{fontName:"Main",fontSize:Math.min(n/5,16)}),this.labelText.alpha=.8,this.sublabelText=new ye("",{fontName:"Main",fontSize:Math.min(n/5,16)}),this.topText=new ye("",{fontName:"Main",fontSize:Math.min(n/7,12)}),this.topText.anchor.x=1,this.topText.alpha=.5,this.topText.x=this.graphWidth,this.bottomText=new ye("",{fontName:"Main",fontSize:Math.min(n/7,12)}),this.bottomText.anchor.x=1,this.bottomText.anchor.y=1,this.bottomText.alpha=.5,this.bottomText.x=this.graphWidth,this.bottomText.y=this.graphHeight,this.sublabelText.y=this.graphHeight,this.sublabelText.anchor.y=1,this.sublabelText.alpha=.5,this.addChild(d,this.lineContainer,this.labelText,this.sublabelText,this.topText,this.bottomText)}addValue(e){if(this.lineContainer.children[0]?.x+this.lineContainer.x<0){const n=this.lineContainer.children[0];this.dataPoints.shift(),this.removeChild(n),this.linePool.push(n)}this.lineContainer.x-=1,this.lineContainer.x<-1e7&&(this.lineContainer.children.forEach(n=>{n.x-=1e7}),this.lineContainer.x+=1e7);const t=this.linePool.shift()??new Ae(Ce.WHITE);t.width=1,t.anchor.x=.5,t.anchor.y=1,t.tint=this.color,t.alpha=.6,t.x=this.graphWidth-this.lineContainer.x,t.y=this.graphHeight,t.value=e,this.dataPoints.push(e),this.targetMax=this.constrainedMax!==null?this.constrainedMax:Math.max(...this.dataPoints),this.targetMin=this.constrainedMin!==null?this.constrainedMin:Math.min(...this.dataPoints),this.lineContainer.addChild(t)}update(){this.dataPoints.length!=0&&(this.maxEase=(this.maxEase-this.targetMax)*.1+this.targetMax,this.minEase=(this.minEase-this.targetMin)*.1+this.targetMin,this.lineContainer.children.forEach(e=>{e.height=Se((e.value-this.minEase)/this.maxEase,0,1)*this.graphHeight}),this.topText.text=this.formatter?.(this.maxEase)??`${ue(this.maxEase,this.precision)} ${this.unit}`,this.bottomText.text=this.formatter?.(this.minEase)??`${ue(this.minEase,this.precision)} ${this.unit}`,this.sublabelText.text=this.sublabel())}}class wm extends Zi{timeText;beatText;measureText;constructor(e){super(e);const t=new dt("noBorder");t.width=330,t.height=48,t.tint=16711680,t.pivot.set(t.width/2,t.height),this.addChild(t),ze(t,"widget-bg"),this.timeText=this.createCounter("Time",{x:-110,y:-32}),this.createLine({x:-55,y:-40}),this.beatText=this.createCounter("Beat",{x:0,y:-32}),this.createLine({x:55,y:-40}),this.measureText=this.createCounter("Measure",{x:110,y:-32})}createCounter(e,t){const n=new ye("",{fontSize:32,fontName:"Main"});n.scale.set(16*1.1/32),n.anchor.set(.5,.5),n.position.set(t.x,t.y),this.addChild(n),ze(n,"text-color");const a=new ye(e,{fontSize:32,fontName:"Main"});return a.scale.set(16*.6/32),a.anchor.set(.5,.5),a.position.set(t.x,t.y+16),this.addChild(a),ze(a,"text-color-secondary"),n}createLine(e){const t=new Ae(Ce.WHITE);t.width=1,t.height=32,t.position.set(e.x,e.y),t.tint=8816262,t.alpha=.5,this.addChild(t)}update(){if(!this.manager.app.capturing){this.visible=!1;return}this.visible=!0,this.scale.set(y.performance.resolution*y.general.uiScale*.7),this.position.y=this.manager.app.STAGE_HEIGHT/2-32*y.performance.resolution*y.general.uiScale*.7;const e=this.manager.chartManager.loadedChart?.timingData?.getMeasure(this.manager.chartManager.beat)??this.manager.chartManager.beat/4,t=this.manager.chartManager.time;this.measureText.text=ue(e,3).toFixed(3),this.beatText.text=ue(this.manager.chartManager.beat,3).toFixed(3);let n="";n+=(t<0?"-":"")+Math.floor(Math.abs(t)/60).toString().padStart(2,"0"),n+=":",n+=Math.floor(Math.abs(t)%60).toString().padStart(2,"0"),n+=".",n+=(ue(Math.abs(t)%1,3)*1e3).toString().padStart(3,"0"),this.timeText.text=n}}class bc{name;layout;columnCount;upArrows;downArrows;sideArrows;constructor(e,t,n,a,r){this.name=e,this.layout=t,this.columnCount=t.length,this.upArrows=n,this.downArrows=a,this.sideArrows=r}getFacingDirectionCosine(e,t){if(e==t)return 0;let n=this.layout[t].x-this.layout[e].x;const a=this.layout[t].y-this.layout[e].y,r=Math.sqrt(n*n+a*a);return n/=r,n}getYDifference(e,t){if(e==t)return 0;const n=this.layout[t].x-this.layout[e].x;let a=this.layout[t].y-this.layout[e].y;const r=Math.sqrt(n*n+a*a);a/=r;const s=a<=0;return a=Math.pow(a,4),s&&(a=-a),a}averagePoint(e,t){return e==-1&&t==-1?{x:0,y:0}:e==-1?this.layout[t]:t==-1?this.layout[e]:{x:(this.layout[e].x+this.layout[t].x)/2,y:(this.layout[e].y+this.layout[t].y)/2}}getDistanceSq(e,t){const n=this.layout[e],a=this.layout[t];return(n.y-a.y)*(n.y-a.y)+(n.x-a.x)*(n.x-a.x)}getDistanceSqPoints(e,t){return(e.y-t.y)*(e.y-t.y)+(e.x-t.x)*(e.x-t.x)}bracketCheck(e,t){return this.getDistanceSq(e,t)<=2}getPlayerAngle(e,t){const n=this.layout[e],a=this.layout[t],r=a.x-n.x,s=a.y-n.y,o=1,l=0,u=r*o+s*l,f=r*l-s*o;return Math.atan2(f,u)}}const vm={"dance-single":new bc("dance-single",[{x:-1,y:0,rotation:0},{x:0,y:-1,rotation:Math.PI/2*3},{x:0,y:1,rotation:Math.PI/2},{x:1,y:0,rotation:Math.PI}],[2],[1],[0,3]),"dance-double":new bc("dance-double",[{x:0,y:1,rotation:0},{x:1,y:0,rotation:Math.PI/2*3},{x:1,y:2,rotation:Math.PI/2},{x:2,y:1,rotation:Math.PI},{x:3,y:1,rotation:0},{x:4,y:0,rotation:Math.PI/2*3},{x:4,y:2,rotation:Math.PI/2},{x:5,y:1,rotation:Math.PI}],[2,6],[1,5],[0,3,4,7])},xm="/smeditor/assets/foot-Cb_UZIxu.png",_m="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIoAAACKCAYAAAB1h9JkAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFXElEQVR4nO3dTW7qSBiF4UN3CzFkwsyDjBFZA14Eq8gmgP2wCLyGSMyRmDFBbIAepIt2fA02uMr+fs4rRQpcSCzx3CqnsM3odruBsab+GnoDmI7+qbtzNBr1vR3iyrJsDQCn02k79Lb01bPZpRaK97IsW0+n00247QnLozj1VKoimU6nmzC6eI5QSlWRhIiFUO49QhLyjoVQUI9ktVphtVr9epxnLO53Zh8hWa//97Db7e7fh8d628F1PaK0QbJerzmywDGUNkhCxOIUyitIQt6xuIPyDpKQZyyuoHRBEvKKxQ2UGEhCHrG4gBITScgbFvNQUiAJecJiGkpKJCEvWMxC6Ypkv99jv9+3eqwHLCaX8GMgKYrifjvP88bnhJ9tdbnf3IgSG0lRFBxZYAxKTCSHwwGHwwEAsQCGpp5USABgPp/f/83rNGRiREmJhCPLT+qhpEQSIhblUPpAEvKORS2UPpGEPGNRCWUIJCGvWNRBGRJJyCMWVVAkIAl5w6IGiiQkXdOIRQUUiUjm8znm8zkAYLlctlqI05x4KBaRbLfbX6u2AHC5XDaSV21FQyESOYmFQiSyEgmFSOQlDgqRyEwUFCKRmxgoRCI7EVCIRH6DQyESHQ0KhUj0NBgUItHVIFCIRF+9QyESnfUKhUj0Nqq7/nmKa+F7QaK57+/vhy98LyMKkegvORQisVFSKERip2T7KBaRWOvz8/PX7d73UYjEXtGhEInNokIhErtFg0IktosChUjs1xkKkfioExQi8dPb6yjSkTA0vhbJ11GIxF8vXxVSIpLYP0t71SslxOilEUUqEpa+1lCIxHetoBAJa4RCJAxogEIkLPQQCpGwcrVQiIRVq4VCJKza4CepMx3VQrlcLpvy7d1uh+223flMeZ5juVwC4LK6pWqhnE6nLbGwcg+nHmJh5Z7uoxALCzXuzBILA1r+1UMsrPWfx8Tiu5fWUYjFby8f4RYuEFNevQ0nbbdZvQ0HOxdFcYfCQyHl99bKrMSRhW8XpO3tT1KXOLKE5/N0jfh1eq9H+sjyymf9sed1flOQWHwU5d1jYrFftMMMiMV2UY9HIRa7RT9wiVhsluQIN2Kx19vrKE1JX2cJx/Xy8qHt+nuz2fxxZ9v/+U1dr9diPB5jMpnk4b7D4YDz+dzqBfr4+AAAHI9HzGYzAMD5fO60TeH5s9kMx+Px1+9pU57nOJ/PJleBv76+Hr7wSaEAxKKpQaEAxKKlZ1CS7aNUs7jPErbbw8ew9DKihLyMLJPJJB+Px7her0Wnjeu5OguhXqEAxCI5UVAAYpGaOCgAsUhMJBSAWKQlFgpALJISDQUgFimJhwIQi4RUQAGIZejUQAGIZchUQQGIZajUQQGIZYhUQgGIpe/UQgGIpc+eQVFxVUgegzt8KqAAMrG8W91xt9KPYVEDBZCF5d3PLtSIBFAGBZCBxRsSQCEUYFgsHpEASqEAw2DxigRQDAXoF4tnJIByKEA/WLwjAQxAAdJiIZKfejuvJ3UpzhsC3rsenDUkADC63W5/3jkaDbApcYr56WUhL0jqLIRMTD3lYk5DgB8kTZmZesrFmoaq3z/LMhLA4NRTrus01DYrSFxNPeW6TkNtsoKkKdNQgLRYvCABHEAB0mDxhARwAgWIi8UbEsARFCAOFo9IAGdQgG5YvCIBHEIB3sPiGQngFArwGhbvSADHUIB2WIjkJ5NL+K/0bLm/+j3gEwlgfAn/leqW+6tZR+J2Cf+V6qahctaRNEUopR5h8Y4EwM9wU/3yXpZl68VicVssFrcsy+K+1Sy4Ogvhy/3ObF3l0cP9SPJftTuzjFXjPgpr1b/As72zHGkAugAAAABJRU5ErkJggg==";class Xi extends fe{pool=[];options;constructor(e){super(),this.options=e}createChild(){if(this.pool.length==0&&this.options.maxPoolSize!==void 0&&this.children.length>=this.options.maxPoolSize)return;const e=this.pool.pop()??this.options.create();return this.addChild(e),e._disabledTime=Date.now(),e}destroyChild(e){this.children.includes(e)&&(e.removeFromParent(),e.removeAllListeners(),e.eventMode="auto",e._disabledTime=Date.now(),this.pool.push(e))}destroyAll(){this.children.forEach(e=>e._disabledTime=Date.now()),this.pool.push(...this.children),this.children.forEach(e=>{e.removeAllListeners(),e.eventMode="auto"}),this.removeChildren()}_render(e){super._render(e);const t=Date.now();for(;t-this.pool[0]?._disabledTime>(this.options.destroyTimer??5e3);)this.pool.shift().destroy()}}const ti={fakeMines:{boxTint:5723991,boxOpacity:.5,textTint:14211288,text:"FM"},mines:{boxTint:6893616,boxOpacity:.3,textTint:14693428,text:"M"},holds:{boxTint:2050583,boxOpacity:.6,textTint:5494332,text:"H"},holdTails:{boxTint:1132131,boxOpacity:.6,textTint:11655162,text:"HT"}},un={[Me.NONE]:16777215,[Me.LEFT_HEEL]:233724,[Me.LEFT_TOE]:8500702,[Me.RIGHT_HEEL]:16559363,[Me.RIGHT_TOE]:15782288};class Em extends fe{renderer;chartDirty=!1;lastVisible=!1;debugTexts=[];debugContainer=new fe;debugBG=new Ae(Ce.WHITE);connections=new ea;rowMap=new Map;rowPool=new Xi({create:()=>{const e=new fe,t=new fe,n=new Xi({create:()=>{const o=new fe,l=new dt;o.addChild(l),o.bg=l,o.letters=[];let u=0,f=0;for(let h=0;h<this.renderer.chart.getColumnCount();h++){const p=new ye("",{fontName:"Mono",fontSize:13});p&&(p.alpha=0,p.anchor.set(0,.5),p.x=u,o.addChild(p),u+=p.width,f=Math.max(f,p.height),o.letters.push(p))}l.width=u+10,l.height=f+5,l.pivot.set(l.width/2,l.height/2),o.letters.forEach(h=>{h.x-=u/2});const c=new ye("",{fontName:"Mono",fontSize:10});c.anchor.set(.5,1),c.y-=l.height/2+5,c.visible=!1,o.detail=c,o.addChild(c),o.alpha=.8;const d=new fe;return o.connections=d,o.addChild(d),o}});n.sortableChildren=!0;const a=new ye("",{fontName:"Main",fontSize:35});a.tint=16745938,a.anchor.set(1,.5);const r=new ye("",{fontName:"Main",fontSize:15});r.tint=16745938,r.anchor.set(1,.5),r.align="right",r.eventMode="none",r.visible=!1,r.text="";const s=new Ae(Ce.WHITE);s.tint=16777215,s.anchor.set(1,.5),s.width=a.width+10,s.height=a.height+10,s.alpha=0,s.eventMode="static",t.addChild(s,a,r),e.addChild(t,n),e.hitbox=s,e.text=a,e.detail=r,e.sideContainer=t,e.nodePool=n,e.highlights=[],e.statusRows=[];for(let o=0;o<Object.keys(ti).length-1;o++){const l=[];for(let u=0;u<this.renderer.chart.getColumnCount();u++){const f=new Ae(Ce.WHITE);f.width=10,f.height=10,f.anchor.set(1,.5),f.y=(o-(Object.keys(ti).length-1)/2)*12+5,f.visible=!0,t.addChild(f),l.push(f)}e.statusRows.push(l)}return e}});activeNode;constructor(e){super(),this.visible=!0,this.renderer=e,this.addChild(this.connections),this.addChild(this.rowPool),this.debugBG.anchor.set(0,1),this.debugBG.alpha=.6,this.debugBG.tint=0,this.addChild(this.debugBG),this.addChild(this.debugContainer),this.rowPool.sortableChildren=!0;const t=()=>{this.debugTexts.forEach(r=>{const s=this.renderer.chart.stats.parityDebug;s&&(r.text.text=r.update(s))}),this.chartDirty=!0},n=r=>{r=="experimental.parity.limitGraph"&&(this.chartDirty=!0)},a=()=>{this.activeNode&&(this.activeNode.deactivate(),this.activeNode=void 0)};this.createDebugObject(16745938,r=>`Updated ${r.stats.lastUpdatedRowEnd-r.stats.lastUpdatedRowStart} rows in ${r.stats.rowUpdateTime.toFixed(3)}ms`),this.createDebugObject(11075438,r=>`Created ${r.stats.createdNodes} nodes and ${r.stats.createdEdges} edges in ${r.stats.nodeUpdateTime.toFixed(3)}ms`),this.createDebugObject(6539775,r=>`Calculated ${r.stats.calculatedEdges} costs (${r.stats.cachedEdges} cached) in ${r.stats.edgeUpdateTime.toFixed(3)}ms (cache size ${r.edgeCacheSize})`),this.createDebugObject(16751196,r=>`Found best path in ${r.stats.pathUpdateTime.toFixed(3)}ms (cached ${r.stats.cachedBestRows} rows)`),this.createDebugObject(16777215,r=>`Total calculation time: ${(r.stats.rowUpdateTime+r.stats.nodeUpdateTime+r.stats.edgeUpdateTime+r.stats.pathUpdateTime).toFixed(3)}ms`),this.createDebugObject(15417396,r=>`Serialization time: ${(this.renderer.chart.stats.parityDebugTime-(r.stats.rowUpdateTime+r.stats.nodeUpdateTime+r.stats.edgeUpdateTime+r.stats.pathUpdateTime)).toFixed(3)}ms`),re.on("parityModified",t),re.on("userOptionUpdated",n),this.renderer.on("pointerdown",a),this.on("destroyed",()=>{re.off("parityModified",t),re.off("userOptionUpdated",n),this.renderer.off("pointerdown",a)})}update(e,t){const n=this.renderer.chart.stats.parityDebug;if(this.visible=!!n&&y.experimental.parity.enabled,!this.visible){this.lastVisible!=this.visible&&(this.rowMap.clear(),this.rowPool.destroyAll(),this.lastVisible=this.visible);return}this.lastVisible=this.visible,this.chartDirty&&(this.rowMap.clear(),this.rowPool.destroyAll(),this.chartDirty=!1);const a=-this.renderer.chartManager.app.STAGE_WIDTH/2,r=-this.renderer.chart.gameType.notefieldWidth/2+y.chart.receptorXPos,s=this.renderer.chart.gameType.notefieldWidth/2+y.chart.receptorXPos,o=this.renderer.chartManager.app.STAGE_WIDTH/2-(y.chart.npsGraph.enabled?48:0)-(y.chart.noteLayout.enabled?48:0),l=r-a,u=o-s,f=l>u+100?"left":"right";for(let h=0;h<n.notedataRows.length&&!(t<n.notedataRows[h-1]?.beat);h++){if(e>n.notedataRows[h+1]?.beat)continue;const p=n.notedataRows[h],m=p.overrides.some(g=>g);if(!this.rowMap.has(p)){const g=this.rowPool.createChild();if(!g)break;let b=h>=n.stats.lastUpdatedRowStart&&h<n.stats.lastUpdatedRowEnd?16745938:11499473;m&&(b=jt(new F(b),new F(16711680),.4).toNumber()),g.text.tint=b,g.text.text=h+"",g.hitbox.width=g.text.width+10,g.hitbox.height=g.text.height+10,g.detail.text="Second: "+p.second.toFixed(3)+`
Key: `+p.id,g.detail.tint=g.text.tint,g.detail.visible=!1,g.highlights.forEach(w=>{w.box.destroy()}),g.nodePool.children.forEach(w=>{w.deactivate()}),g.nodePool.destroyAll(),g.highlights=[],g.hitbox.removeAllListeners();const x=n.nodeRows[h];if(!x||x.nodes.length===0)console.warn(`No permutations found for row ${h} at beat ${p.beat} (${p.id})`);else{let w=x.nodes;y.experimental.parity.limitGraph&&(w=w.slice(0,16));for(const B of w){const D=g.nodePool.createChild();if(!D)continue;D.name=B.key;const O=D.bg,H=()=>{let P=11499473;O.alpha=.2,h>=n.stats.lastUpdatedNodeStart&&h<n.stats.lastUpdatedNodeEnd&&(P=2251008,O.alpha=.6),n.bestPathSet?.has(B.key)&&(P=12536064,O.alpha=.6),m&&(P+=3473408,O.alpha+=.3),Y&&(P=6539775,O.alpha=.2),O.tint=P};for(let P=0;P<B.state.combinedColumns.length;P++){const v=B.state.combinedColumns[P],S=D.letters[P];S&&(S.text=Yd[v],S.alpha=.3,B.state.action[P]==B.state.combinedColumns[P]&&(S.alpha=1),S.tint=un[v])}D.detail.text=JSON.stringify(B.state,null,2)+`
Key: `+B.key;let Y=!1;H();const ae=()=>{if(!Y){Y=!0,D.alpha=3,D.detail.visible=!0;for(const[P,v]of B.children.entries()){const S=this.rowMap.get(n.notedataRows[h+1]);if(!S||!S.nodePool.getChildByName(P))return;const L=new fe;L.text=new ye(v.TOTAL.toFixed(2),{fontName:"Mono",fontSize:10}),L.text.anchor.set(.5,1),L.text.tint=16777215,L.text.y=-O.height/2-5,L.bg=new dt,L.bg.visible=!1,L.bg.eventMode="none",L.bg.tint=3683671,L.name=P,L.addChild(L.bg,L.text),D.connections.addChild(L),L.on("pointerover",()=>{L.text.text=JSON.stringify(v,null,2)+`
`,L.scale.set(1.2),L.bg.visible=!0,L.bg.width=L.text.width+10,L.bg.height=L.text.height+10,L.bg.alpha=.3,L.bg.x=-L.bg.width/2,L.bg.y=-L.bg.height-O.height/2-10}),L.on("pointerout",()=>{L.text.text=v.TOTAL.toFixed(2),L.scale.set(1),L.bg.visible=!1}),L.text.hitArea=new zn(-L.text.width/2,-L.text.height,L.text.width,L.text.height),L.zIndex=1,D.zIndex=1,g.zIndex=1}H()}},M=()=>{Y&&(Y=!1,D.alpha=.8,D.zIndex=0,D.detail.visible=!1,D.connections.children.forEach(P=>{P.destroy()}),D.connections.removeChildren(),H(),g.zIndex=0)};D.activate=ae,D.deactivate=M,D.eventMode="static",D.on("pointerover",()=>{ae()}),D.on("pointerout",()=>{this.activeNode!=D&&M()}),D.on("pointerdown",P=>{this.activeNode==D?this.activeNode=void 0:(this.activeNode?.deactivate(),this.activeNode=D,D.connections.children.forEach(v=>{v.eventMode="static"})),P.stopImmediatePropagation()}),D.cursor="pointer"}const E=g.nodePool.children[0].bg.width+5,C=E*w.length;g.nodePool.children.forEach((B,D)=>{B.x=D*E-C/2,B.y=0})}for(let w=0;w<this.renderer.chart.getColumnCount();w++)g.statusRows[0][w].tint=ti.fakeMines.textTint,g.statusRows[1][w].tint=ti.mines.textTint,g.statusRows[0][w].visible=p.fakeMines[w]!==void 0,g.statusRows[1][w].visible=p.mines[w]!==void 0,g.statusRows[2][w].visible=!0,p.holdTails.has(w)?g.statusRows[2][w].tint=ti.holdTails.textTint:p.holds[w]!==void 0?g.statusRows[2][w].tint=ti.holds.textTint:g.statusRows[2][w].visible=!1;g.hitbox.on("pointerover",()=>{g.detail.visible=!0,p.fakeMines.forEach((w,E)=>{if(w===void 0)return;const C=this.createBoxWithText(ti.fakeMines);g.highlights.push({col:E,second:w,box:C}),g.addChild(C)}),p.mines.forEach((w,E)=>{if(w===void 0)return;const C=this.createBoxWithText(ti.mines);g.highlights.push({col:E,second:w,box:C}),g.addChild(C)}),p.holds.forEach((w,E)=>{if(w===void 0||p.holdTails.has(E))return;const C=this.createBoxWithText(ti.holds);g.highlights.push({col:E,second:p.second,box:C}),g.addChild(C)}),p.holdTails.forEach(w=>{const E=this.createBoxWithText(ti.holdTails);g.highlights.push({col:w,second:p.second,box:E}),g.addChild(E)}),g.statusRows.forEach(w=>{w.forEach(E=>{E.alpha=0})})}),g.hitbox.on("pointerout",()=>{g.detail.visible=!1,g.highlights.forEach(w=>{w.box.destroy()}),g.highlights=[],g.statusRows.forEach(w=>{w.forEach(E=>{E.alpha=1})})}),this.rowMap.set(p,g)}}let c=0;const d=[...this.rowMap.entries()];for(const[h,p]of d){if(h.beat<e&&d[c+1]?.[0].beat<e||h.beat>t&&d[c-1]?.[0].beat>t){this.rowMap.delete(h),this.rowPool.destroyChild(p),this.activeNode&&this.activeNode.parent===p.nodePool&&(this.activeNode.deactivate(),this.activeNode=void 0),c++;continue}c++,p.visible=y.experimental.parity.showGraph,p.highlights.forEach(m=>{const g=this.renderer.getXPosFromColumn(m.col),b=this.renderer.getYPosFromSecond(m.second),x=m.box;x.x=g,x.y=b-this.renderer.getYPosFromBeat(h.beat)}),p.y=this.renderer.getYPosFromBeat(h.beat),f=="left"?p.nodePool.x=(r-a)/2+a-y.chart.receptorXPos:p.nodePool.x=(o-s)/2+s-y.chart.receptorXPos;for(let m=0;m<this.renderer.chart.getColumnCount();m++)for(let g=0;g<3;g++)f=="right"?p.statusRows[g][m].x=(m-this.renderer.chart.getColumnCount())*12-p.text.width-12:p.statusRows[g][m].x=m*12+p.text.width+18;p.sideContainer.x=(-this.renderer.chart.gameType.notefieldWidth/2-128)*(f=="left"?-1:1),p.text.anchor.x=f=="left"?0:1,p.hitbox.anchor.x=p.text.anchor.x,p.nodePool.x/=y.chart.zoom,p.detail.x=(p.text.width+10)*(f=="left"?1:-1),p.detail.anchor.x=f=="left"?0:1,p.detail.align=f}if(y.experimental.parity.showDebug?(this.debugTexts.forEach((h,p)=>{h.x=(-this.renderer.chartManager.app.STAGE_WIDTH/2+10-y.chart.receptorXPos)/y.chart.zoom,h.y=(this.renderer.chartManager.app.STAGE_HEIGHT/2-10)/y.chart.zoom+(p-this.debugTexts.length+1)*30}),this.debugBG.x=(-this.renderer.chartManager.app.STAGE_WIDTH/2-y.chart.receptorXPos)/y.chart.zoom,this.debugBG.y=this.renderer.chartManager.app.STAGE_HEIGHT/2/y.chart.zoom,this.debugBG.width=this.debugContainer.width+20/y.chart.zoom,this.debugBG.height=this.debugContainer.height+15/y.chart.zoom,this.debugContainer.visible=!0,this.debugBG.visible=!0):(this.debugContainer.visible=!1,this.debugBG.visible=!1),this.connections.clear(),y.experimental.parity.showGraph)for(let h=0;h<n.notedataRows.length&&!(t<n.notedataRows[h-1]?.beat);h++){if(e>n.notedataRows[h+1]?.beat)continue;const p=n.notedataRows[h],m=n.nodeRows[h].nodes,g=this.rowMap.get(p),b=this.rowMap.get(n.notedataRows[h+1]);if(!(!g||!b))for(const x of m){const w=g.nodePool.getChildByName(x.key);if(w)for(const[E,C]of x.children.entries()){const B=b.nodePool.getChildByName(E);if(!B)continue;let D=11499473,O=1.5;h>=n.stats.lastUpdatedNodeStart&&h<n.stats.lastUpdatedNodeEnd&&(D=65280);let H=.5-Math.min(.45,Math.log1p(C.TOTAL)/15);if(w.connections.getChildByName(E)){const Y=w.connections.getChildByName(E);Y.x=B.x+b.nodePool.x-(w.x+g.nodePool.x),Y.y=b.y-g.y,H+=.3,D=6539775,O=2.5}n.bestPathSet?.has(x.key)&&n.bestPathSet.has(E)&&(D=12536064,H+=.4,O=4),this.connections.lineStyle(O,D,H),this.connections.moveTo(w.x+g.nodePool.x,g.y),this.connections.lineTo(B.x+b.nodePool.x,b.y)}}}}createBoxWithText(e){const t=new fe;return t.background=new Ae(Ce.WHITE),t.background.width=e.boxWidth||64,t.background.height=e.boxHeight||64,t.background.tint=e.boxTint||16777215,t.background.alpha=e.boxOpacity||.5,t.background.anchor.set(.5,.5),t.addChild(t.background),t.text=new ye(e.text,{fontName:"Main",fontSize:25}),t.text.tint=e.textTint||16777215,t.text.alpha=e.textOpacity||1,t.text.anchor.set(.5,.5),t.addChild(t.text),t}createDebugObject(e,t){const n=new fe;return n.text=new ye("",{fontName:"Main",fontSize:20}),n.text.tint=e,n.text.anchor.set(0,1),n.addChild(n.text),n.update=t,this.debugTexts.push(n),this.debugContainer.addChild(n),n}}const ht=80;class Cm extends Zi{panels=[];currentRow=-1;lastBeat=0;leftFoot;rightFoot;layout;dirty=!1;constructor(e){super(e),this.sortableChildren=!0,re.on("chartLoaded",()=>this.build()),re.on("parityModified",()=>this.reindex())}async build(){if(this.removeChildren(),this.panels=[],!this.manager.app.chartManager.loadedChart||(this.layout=vm[this.manager.app.chartManager.loadedChart.gameType.id],!this.layout))return;const e=await _s.load(_m);let t=0,n=0;this.layout.layout.forEach(c=>{const d=new fe,h=new Ae(Ce.WHITE);ze(h,"accent-color"),h.alpha=.3,h.anchor.set(.5),h.width=ht,h.height=ht;const p=new Ae(e);p.anchor.set(.5),p.x=c.x,p.y=c.y*-1,p.alpha=.3,p.width=ht*.75,p.height=ht*.75,p.blendMode=Ac.MULTIPLY,p.rotation=c.rotation,d.bg=h,d.arrow=p,d.x=c.x*ht,d.y=c.y*-80,d.addChild(h,p),this.addChild(d),this.panels.push(d),t=Math.max(t,Math.abs(d.x)),n=Math.max(n,Math.abs(d.y))});const a=await _s.load(xm),r=new fe,s=new fe,o=new Ae(a),l=new Ae(a);o.scale.set(ht/4*3/o.height),l.scale.set(ht/4*3/l.height),o.tint=un[Me.LEFT_HEEL],l.tint=un[Me.RIGHT_HEEL],o.anchor.set(.5),l.anchor.set(.5),l.scale.x*=-1;const u=new ye("L",{fontSize:25,fontName:"Fancy",tint:un[Me.LEFT_TOE]}),f=new ye("R",{fontSize:25,fontName:"Fancy",tint:un[Me.RIGHT_TOE]});u.anchor.set(.5),f.anchor.set(.5),r.addChild(o,u),s.addChild(l,f),this.leftFoot=r,this.rightFoot=s,this.leftFoot.zIndex=50,this.rightFoot.zIndex=50,this.addChild(this.leftFoot,this.rightFoot),this.lastBeat=-1,this.pivot.set(t+ht/2,n+ht/2)}reindex(){const e=this.manager.app.chartManager.loadedChart?.stats.parityDebug;if(!e||!this.manager.app.chartManager.chartView)return;const t=this.manager.app.chartManager.chartView.getVisualBeat(),n=Ut(e.notedataRows,t,a=>a.beat);if(n==0&&t<e.notedataRows[0].beat){this.currentRow=-1;return}this.currentRow=n,this.dirty=!0}update(){const e=this.manager.app.chartManager.loadedChart?.stats.parityStates,t=this.manager.chartManager.app.STAGE_WIDTH/2-(y.chart.npsGraph.enabled?48:0)-(y.chart.noteLayout.enabled?48:0);if(this.x=t-16,this.y=this.manager.app.STAGE_HEIGHT/2-16,!e||!this.manager.app.chartManager.chartView||!this.layout||!y.experimental.parity.enabled||!y.experimental.parity.showDancingBot){this.visible=!1;return}this.visible=!0;const n=this.manager.app.chartManager.chartView.getVisualBeat(),a=this.manager.app.chartManager.chartView.getVisualTime();if(!(this.lastBeat==n&&!this.dirty)){if(this.dirty=!1,this.panels.forEach(r=>{const s=(n%1+1)%1;r.arrow.alpha=.3+Se(1-s,.5,1)*.8}),n<this.lastBeat)this.reindex();else for(;e[this.currentRow+1]?.beat<=n;){this.currentRow++;const r=e[this.currentRow];r.action.forEach((s,o)=>{r.holdFeet.has(s)||!s||this.flashPanel(o)})}if(this.lastBeat=n,this.leftFoot&&this.rightFoot){let r=e[this.currentRow];const s=e[this.currentRow+1]??e.at(-2);if(e.at(-1)==r&&(r=e.at(-2)),r){const o=this.getFeetPosition(r),l=this.getFeetPosition(s),u=Se(pt(Math.max(r.second,s.second-.3),s.second,a),0,1),f=this.lerpPositions(o,l,u,s);let c=1,d=1;const h=r.movedFeet.has(Me.LEFT_HEEL),p=r.movedFeet.has(Me.RIGHT_HEEL),m=s.movedFeet.has(Me.LEFT_HEEL),g=s.movedFeet.has(Me.RIGHT_HEEL);if(a>s.second-.1){const b=Se(pt(s.second-.1,s.second,a),0,1);m&&(c*=et(1,.9,b)),g&&(d*=et(1,.9,b))}if(a<r.second+.1){const b=Se(pt(r.second,r.second+.1,a),0,1);h&&(c*=et(.9,1,b)),p&&(d*=et(.9,1,b))}this.leftFoot.scale.set(c),this.rightFoot.scale.set(d),this.leftFoot.x=f.left.x,this.leftFoot.y=f.left.y,this.leftFoot.rotation=f.left.angle,this.rightFoot.x=f.right.x,this.rightFoot.y=f.right.y,this.rightFoot.rotation=f.right.angle}}}}getFeetPosition(e){const t={x:this.panels[e.footColumns[Me.LEFT_HEEL]]?.position.x??0,y:this.panels[e.footColumns[Me.LEFT_HEEL]]?.position.y??0},n={x:this.panels[e.footColumns[Me.RIGHT_HEEL]]?.position.x??0,y:this.panels[e.footColumns[Me.RIGHT_HEEL]]?.position.y??0};e.footColumns[Me.LEFT_TOE]!=-1&&(t.x=(t.x+this.panels[e.footColumns[Me.LEFT_TOE]].position.x)/2,t.y=(t.y+this.panels[e.footColumns[Me.LEFT_TOE]].position.y)/2),e.footColumns[Me.RIGHT_TOE]!=-1&&(n.x=(n.x+this.panels[e.footColumns[Me.RIGHT_TOE]].position.x)/2,n.y=(n.y+this.panels[e.footColumns[Me.RIGHT_TOE]].position.y)/2),this.layout.name=="dance-single"&&(Math.abs(t.x)<=ht/4&&(t.x-=ht/4,t.y*=.5),Math.abs(n.x)<=ht/4&&(n.x+=ht/4,n.y*=.5),n.x<-80/4*3&&(n.y-=ht/4*Math.sign(t.y),n.x+=ht/4),t.x>ht/4*3&&(t.y-=ht/4*Math.sign(t.y),t.x-=ht/4));let a=this.getPlayerAngle(t,n)/5,r=a;return e.footColumns[Me.LEFT_TOE]!=-1&&(a=-this.getPlayerAngle({x:this.panels[e.footColumns[Me.LEFT_HEEL]].position.x,y:this.panels[e.footColumns[Me.LEFT_HEEL]].position.y},{x:this.panels[e.footColumns[Me.LEFT_TOE]].position.x,y:this.panels[e.footColumns[Me.LEFT_TOE]].position.y})+Math.PI/2),e.footColumns[Me.RIGHT_TOE]!=-1&&(r=-this.getPlayerAngle({x:this.panels[e.footColumns[Me.RIGHT_HEEL]].position.x,y:this.panels[e.footColumns[Me.RIGHT_HEEL]].position.y},{x:this.panels[e.footColumns[Me.RIGHT_TOE]].position.x,y:this.panels[e.footColumns[Me.RIGHT_TOE]].position.y})+Math.PI/2),{left:{x:t.x,y:t.y,angle:a},right:{x:n.x,y:n.y,angle:r}}}getPlayerAngle(e,t){const n=t.x-e.x,a=t.y-e.y,r=1,s=0,o=n*r+a*s,l=n*s-a*r;return Math.atan2(l,o)}lerpPositions(e,t,n,a){const r=a.movedFeet.has(Me.LEFT_HEEL),s=a.movedFeet.has(Me.RIGHT_HEEL);return{left:{x:et(e.left.x,t.left.x,n),y:et(e.left.y,t.left.y,n),angle:r?et(e.left.angle,t.left.angle,n):e.left.angle},right:{x:et(e.right.x,t.right.x,n),y:et(e.right.y,t.right.y,n),angle:s?et(e.right.angle,t.right.angle,n):e.right.angle}}}flashPanel(e){const t=this.panels[e];t&&$t.animate(t.bg,{0:{alpha:1.5},1:{alpha:.3}},.4,ci(.19,1.15,.55,.96),void 0,"panel-"+e)}}class Vu extends Zi{backing=new dt("noBorder");overlay=new Ae(Ce.WHITE);selectionOverlay=new Ae(Ce.WHITE);container=new fe;lastHeight=0;lastCMod;mouseDown=!1;queued=!1;verticalMargin=40;backingVerticalPadding=10;backingWidth=32;xOffset=20;constructor(e,t=20,n=32){super(e),this.backingWidth=n,this.xOffset=t,this.sortableChildren=!0,this.addChild(this.backing),this.addChild(this.container),this.visible=!1,ze(this.backing,"widget-bg"),this.overlay.anchor.x=.5,this.overlay.anchor.y=0,this.overlay.alpha=.3,this.overlay.zIndex=10,this.lastCMod=y.chart.CMod,this.addChild(this.overlay),this.x=this.manager.app.STAGE_WIDTH/2-this.xOffset,re.on("chartLoaded",()=>{this.queued=!1,this.populate()}),re.on("chartModifiedAfter",()=>{this.queued||this.populate(),this.queued=!0});const a=setInterval(()=>{this.queued&&(this.queued=!1,this.populate())},3e3);this.on("destroyed",()=>clearInterval(a)),this.eventMode="static",this.on("mousedown",r=>{this.mouseDown=!0,this.handleMouse(r)}),this.on("mousemove",r=>{this.mouseDown&&this.handleMouse(r)}),this.on("mouseup",()=>{this.mouseDown=!1}),this.on("mouseleave",()=>{this.mouseDown=!1})}handleMouse(e){if(this.manager.chartManager.getMode()==q.Play||!this.getChart())return;let t=(this.container.toLocal(e.global).y+this.container.height/2)/this.container.height;t=Se(t,0,1),this.getChart().getNotedata().at(-1)&&(y.chart.CMod?this.manager.chartManager.time=et(-this.getChart().timingData.getOffset(),this.getChart().getLastSecond(),t):this.manager.chartManager.beat=this.getChart().getLastBeat()*t)}update(){this.scale.y=y.chart.reverse?-1:1;const e=this.manager.app.STAGE_HEIGHT-this.verticalMargin;this.backing.height=e+this.backingVerticalPadding,this.backing.position.y=-this.backing.height/2,this.backing.position.x=-this.backing.width/2,this.x=this.manager.app.STAGE_WIDTH/2-this.xOffset;const t=this.getChart(),n=this.manager.chartManager.chartView;if(!t||!n||!he.layout){this.visible=!1;return}if(this.visible=!0,!t.getNotedata().at(-1)){this.overlay.height=0;return}const r=y.chart.CMod?n.getSecondFromYPos(-this.manager.app.STAGE_HEIGHT/2):n.getBeatFromYPos(-this.manager.app.STAGE_HEIGHT/2,!0),s=y.chart.CMod?n.getSecondFromYPos(this.manager.app.STAGE_HEIGHT/2):n.getBeatFromYPos(this.manager.app.STAGE_HEIGHT/2,!0),o=this.getYFromRange(t,r,s);this.overlay.y=o.startY,this.overlay.height=o.endY-o.startY,this.overlay.height=Math.max(2,this.overlay.height);const l=this.manager.chartManager.selection.notes;if(l.length<1)this.selectionOverlay.visible=!1;else{this.selectionOverlay.visible=!0;let u,f;y.chart.CMod?(u=$i(l.map(d=>d.second)),f=Hn(l.map(d=>t.getSecondsFromBeat(Xt(d))))):(u=$i(l.map(d=>d.beat)),f=Hn(l.map(d=>Xt(d))));const c=this.getYFromRange(t,u,f);this.selectionOverlay.y=c.startY,this.selectionOverlay.height=c.endY-c.startY,this.selectionOverlay.height=Math.max(2,this.selectionOverlay.height)}(this.manager.app.STAGE_HEIGHT!=this.lastHeight||this.lastCMod!=y.chart.CMod)&&(this.lastCMod=y.chart.CMod,this.lastHeight=this.manager.app.STAGE_HEIGHT,this.updateDimensions(),this.populate())}getYFromRange(e,t,n){const a=e.getLastBeat(),r=e.getLastSecond();let s=pt(0,a,t),o=pt(0,a,n);y.chart.CMod&&(s=pt(-e.timingData.getOffset(),r,t),o=pt(-e.timingData.getOffset(),r,n)),s=Se(s,0,1),o=Se(o,0,1),s>o&&([s,o]=[o,s]);const l=(s-.5)*this.container.height,u=(o-.5)*this.container.height;return{startY:l,endY:u}}updateDimensions(){if(!this.getChart())return;const t=this.manager.app.STAGE_HEIGHT-this.verticalMargin;this.backing.height=t+this.backingVerticalPadding,this.backing.width=this.backingWidth,this.overlay.width=this.backingWidth,this.selectionOverlay.width=this.backingWidth,this.pivot.x=this.backing.width/2}populate(){}getChart(){return this.manager.chartManager.loadedChart}}class Am extends Vu{npsGraph;graphGradient=null;graphWidth=40;npsText=new ye("",{fontName:"Main",fontSize:12});constructor(e){super(e,60,40),this.graphWidth=40,this.graphGradient=this.makeGradient(),this.npsGraph=new ea,this.container.addChild(this.npsGraph),this.npsText.visible=!1,this.npsText.anchor.x=1,this.npsText.anchor.y=.5,ze(this.npsText,"text-color"),this.addChild(this.npsText),re.on("userOptionUpdated",n=>{(n=="chart.npsGraph.color1"||n=="chart.npsGraph.color2")&&(this.graphGradient=this.makeGradient(),this.populate())}),this.on("mouseleave",()=>{this.hideNpsDisplay()}),this.on("mouseenter",()=>{this.showNpsDisplay()}),this.on("mousemove",n=>{this.updateNpsDisplay(n)}),this.populate()}updateNpsDisplay(e){const t=this.getChart();if(!t){this.npsText.visible=!1;return}if(!t.getNotedata().at(-1)){this.npsText.visible=!1;return}const a=t.stats.npsGraph;let r=this.npsGraph.toLocal(e.global).y/this.npsGraph.height;r=Se(r,0,1);let s=et(0,t.getLastBeat(),r);if(y.chart.CMod){const u=et(-t.timingData.getOffset(),t.getLastSecond(),r);s=t.timingData.getBeatFromSeconds(u)}const o=Math.floor(t.timingData.getMeasure(s)),l=a[o]??0;this.npsText.text=l.toFixed(1)+" nps",this.npsText.position.y=this.getYFromBeat(s)-this.npsGraph.height/2,this.npsText.position.x=-this.backing.width/2-10,this.npsText.visible=!0}hideNpsDisplay(){this.npsText.visible=!1}showNpsDisplay(){const e=this.getChart();if(!e){this.npsText.visible=!1;return}if(!e.getNotedata().at(-1)){this.npsText.visible=!1;return}this.npsText.visible=!0}update(){if(!y.chart.npsGraph.enabled){this.visible=!1;return}this.visible=!0;const e=this.manager.getChildByName("note-layout");e!==void 0&&e.visible?this.xOffset=e.backingWidth+28:this.xOffset=20,this.npsText.scale.y=y.chart.reverse?-1:1,super.update()}populate(){const e=this.getChart();if(!e)return;const t=this.manager.app.STAGE_HEIGHT-40,n=e.stats.getMaxNPS(),a=e.stats.npsGraph,r=e.getLastBeat();if(this.npsGraph.clear(),e.getNotedata().length==0)return;this.graphGradient?this.npsGraph.beginTextureFill({texture:this.graphGradient}):this.npsGraph.beginFill(0,1),this.npsGraph.pivot.x=this.backing.width/2,this.npsGraph.pivot.y=t/2;const s=Math.floor(this.getChart().timingData.getMeasure(r)),o=this.getYFromBeat(0);this.npsGraph.moveTo(0,o);for(let c=0;c<=s;c++){const d=a[c]??0,h=e.timingData.getBeatFromMeasure(c),p=Math.min(r,e.timingData.getBeatFromMeasure(c+1)),m=pt(0,n,d)*this.graphWidth,g=this.getYFromBeat(h),b=this.getYFromBeat(p);this.npsGraph.lineTo(m,g),this.npsGraph.lineTo(m,b)}const l=a.at(-1)??0,u=pt(0,n,l)*this.graphWidth,f=this.getYFromBeat(r);this.npsGraph.lineTo(u,f),this.npsGraph.lineTo(0,f),this.npsGraph.endFill()}getYFromBeat(e){if(y.chart.CMod)return this.getYFromSecond(this.getChart().timingData.getSecondsFromBeat(e));let t=pt(0,this.getChart().getLastBeat(),e);return t=Se(t,0,1),t*(this.backing.height-10)}getYFromSecond(e){if(!y.chart.CMod)return this.getYFromBeat(this.getChart().timingData.getBeatFromSeconds(e));let t=pt(-this.getChart().timingData.getOffset(),this.getChart().getLastSecond(),e);return t=Se(t,0,1),t*(this.backing.height-10)}makeGradient(){const e=this.graphWidth,t=document.createElement("canvas");t.width=e,t.height=e;const n=t.getContext("2d");if(n==null)return null;const a=n.createLinearGradient(0,0,e,0);return a.addColorStop(0,qn(y.chart.npsGraph.color1).toHexa()),a.addColorStop(.8,qn(y.chart.npsGraph.color2).toHexa()),n.fillStyle=a,n.fillRect(0,0,e,e),Ce.from(t)}}const yc=150;class ra{static active=!1;static persistent=!1;static options;static popup;static view;static title;static desc;static editText;static clickOutside;static moveInterval;static updateInterval;static _open(e){if(!this.active){if(this.options=e,this._build(),!document.getElementById("popups")){console.error("Failed to open popup!","error");return}document.getElementById("popups")?.appendChild(this.popup),this.clickOutside&&window.removeEventListener("click",this.clickOutside,!0),this.clickOutside=this.options.clickHandler??(t=>{this.popup?.contains(t.target)||this.close()}),this.popup.style.transitionDuration="0s",this.movePosition(),this.moveInterval=setInterval(()=>this.movePosition(),yc),this.active=!0,this.options.cancelableOnOpen&&setTimeout(()=>window.addEventListener("click",this.clickOutside,!0),200)}}static cloneRect(e){return{top:e.top,bottom:e.bottom,left:e.left,right:e.right,width:e.width,height:e.height}}static movePosition(){const e=this.options.attach instanceof HTMLElement?this.options.attach.getBoundingClientRect():this.cloneRect(this.options.attach.getBounds());this.options.attach instanceof HTMLElement||(e.top+=document.getElementById("pixi").offsetTop+9);const t=e.left+e.width/2,n=this.popup.clientWidth,a=n/2+15,r=window.innerWidth-n/2-15;this.popup.style.left=`${Se(t,a,r)}px`;const s=e.top+e.height/2+15;this.popup.style.top=`${s}px`,s+this.popup.clientHeight>window.innerHeight-15?(this.popup.style.transform="translate(-50%, -100%)",this.view.style.transformOrigin="bottom",this.popup.style.top=`${e.top-15}px`):(this.popup.style.transform="",this.view.style.transformOrigin=""),requestAnimationFrame(()=>this.popup.style.transitionDuration="")}static _build(){const e=document.createElement("div");e.classList.add("popup"),this.popup=e;const t=document.createElement("div");t.classList.add("popup-zoomer"),this.options.width&&(t.style.width=`${this.options.width/16}rem`),t.style.backgroundColor=this.options.background??"",t.style.color=this.options.textColor??"",e.appendChild(t),this.view=t;const n=document.createElement("div");if(n.innerText=this.options.title,n.classList.add("popup-title"),t.appendChild(n),this.title=n,this.options.description!==void 0){const a=document.createElement("div");a.innerText=this.options.description,a.classList.add("popup-desc"),t.appendChild(a),this.desc=a}if(this.buildContent(),this.options.editable){const a=document.createElement("div");a.innerText="click to edit",a.style.marginTop="4px",a.style.height="10px",t.appendChild(a),a.classList.add("popup-desc"),this.editText=a}if(this.options.options){const a=document.createElement("div");a.classList.add("popup-options"),this.options.options.forEach(r=>{const s=document.createElement("button");s.innerText=r.label,s.onclick=()=>{r.callback?.()},s.classList.add(r.type),a.appendChild(s)}),this.view.append(a)}}static buildContent(){}static close(){if(!this.popup||!this.active)return;window.removeEventListener("click",this.clickOutside,!0),this.popup.classList.add("exiting");const e=this.popup;setTimeout(()=>e.remove(),200),this.active=!1,this.persistent=!1,clearInterval(this.moveInterval),clearInterval(this.updateInterval)}static select(){!this.popup||!this.options.editable||(this.persistent=!0,this.view.classList.add("selected"),this.editText.style.transform="scale(0)",this.editText.style.height="0px",this.options.cancelableOnOpen||setTimeout(()=>window.addEventListener("click",this.clickOutside,!0),200))}static detach(){clearInterval(this.moveInterval)}static attach(e){clearInterval(this.moveInterval),this.moveInterval=setInterval(()=>this.movePosition(),yc),this.options.attach=e}}class ba extends ra{static onSnapChange=this.updateValues.bind(this);static divInput;static divLabel;static beatInput;static open(e){this.active||(super._open({attach:e,title:"Snap Options",width:200,editable:!0,cancelableOnOpen:!1}),re.on("snapChanged",this.onSnapChange))}static buildContent(){const e=document.createElement("div");e.classList.add("popup-flex"),this.view.appendChild(e);const t=document.createElement("div");t.classList.add("popup-row");const n=document.createElement("div");n.innerText="Snap to nearest ";const a=ct.create({value:y.chart.snap==0?0:Math.round(4/y.chart.snap),step:1,precision:0,min:0,max:1e3});a.onchange=f=>{if(f===void 0){this.updateValues();return}f==0?y.chart.snap=0:y.chart.snap=4/f,this.updateValues()};const r=document.createElement("div");r.innerText=this.suffixSnap()+" note",t.replaceChildren(n,a.view,r);const s=document.createElement("div");s.classList.add("popup-row");const o=document.createElement("div");o.innerText="Snap every";const l=ct.create({value:y.chart.snap,step:.001,precision:3,min:0});l.onchange=f=>{if(f===void 0){this.updateValues();return}f==0?y.chart.snap=0:y.chart.snap=f,this.updateValues()};const u=document.createElement("div");u.innerText=" beats",s.replaceChildren(o,l.view,u),e.replaceChildren(t,s),this.beatInput=l,this.divInput=a,this.divLabel=r}static updateValues(){document.activeElement==this.divInput.input||document.activeElement==this.beatInput.input||(this.divInput.value=y.chart.snap==0?0:Math.round(4/y.chart.snap),this.divLabel.innerText=this.suffixSnap()+" note",this.beatInput.value=y.chart.snap)}static suffixSnap(){const e=y.chart.snap==0?0:Math.round(4/y.chart.snap);return e%10==1&&e!=11?"st":e%10==2&&e!=12?"nd":e%10==3&&e!=13?"rd":"th"}static close(){!this.popup||!this.active||(super.close(),re.off("timingModified",this.onSnapChange))}}const km={fontName:"Main",fontSize:10,fill:["#ffffff"]},Uu={4:15157287,8:4033015,12:11152884,16:8577607,24:14167723,32:15376696,48:15699179,64:7071886,96:8553090,192:8553090};class Sm extends fe{renderer;children=[];constructor(e){super(),this.renderer=e;for(let t=0;t<2;t++){const n=new fe,a=new ea,r=new ye("4",km);n.x=(t-.5)*(this.renderer.chart.gameType.notefieldWidth+48),a.rotation=Math.PI/4,a.lineStyle(1,0,1),a.beginFill(16777215),a.drawRect(-12,-12,24,24),a.endFill(),r.anchor.set(.5),n.addChild(a,r),this.addChild(n),n.eventMode="static",n.on("mouseenter",()=>ba.open(a)),n.on("mousedown",()=>ba.select()),n.on("mouseleave",()=>{ba.persistent||ba.close()})}}update(){this.y=this.renderer.getActualReceptorYPos(),this.visible=this.renderer.shouldDisplayBarlines();for(let e=0;e<2;e++){const t=this.children[e],n=t.children[0];n.tint=Uu[4/y.chart.snap]??7368816;const a=t.children[1];a.text=""+(y.chart.snap==0||4/y.chart.snap%1!=0?"":4/y.chart.snap)}}}function di(i,e){let t=i.length;if(i.length!=0)for(;t--;)e(i[t],t)&&i[t].destroy()}function Os(i){return i.button==2||i.getModifierState("Control")&&Yt}function Fg(i,e,t,n,a){const r=[];for(let s=0;s<t;s++){const o=[];for(let l=0;l<e;l++)o.push(new Ce(i.baseTexture,new zn(n*l,a*s,n,a)));r.push(o)}return r}async function Ig(i){const e=i.split(`
`),t=parseInt(e[0]),n=parseInt(e[t+1]),a=[],r=[],s=[];for(let o=0;o<t;o++){const l=/(-?[0-9.]+)\s+(-?[0-9.]+)\s+(-?[0-9.]+)\s+(-?[0-9.]+)/.exec(e[o+1]);if(l)a.push(parseFloat(l[1])),a.push(parseFloat(l[2])),r.push(parseFloat(l[3])),r.push(parseFloat(l[4]));else return console.error("Failed to load vertex "+e[o+1]),new er}for(let o=0;o<n;o++){const l=/(-?[0-9.]+)\s+(-?[0-9.]+)\s+(-?[0-9.]+)/.exec(e[o+2+t]);if(l)s.push(parseFloat(l[1])),s.push(parseFloat(l[2])),s.push(parseFloat(l[3]));else return console.error("Failed to load triangle "+e[o+2+t]),new er}return new er().addAttribute("aVertexPosition",a,2).addAttribute("aUvs",r,2).addIndex(s)}class Tm extends Vu{barContainer=new Gs(1500,{position:!0,scale:!0,tint:!0},16384,!0);bars;barTexture;constructor(e){super(e),this.addChild(this.backing),this.addChild(this.container),this.visible=!1,this.name="note-layout",this.backing.tint=0,this.backing.alpha=.3,this.barTexture=Ai.create({resolution:this.manager.app.renderer.resolution}),this.bars=new Ae(this.barTexture),this.bars.anchor.set(.5),this.container.addChild(this.bars),this.populate()}update(){if(!y.chart.noteLayout.enabled){this.visible=!1;return}this.visible=!0,super.update()}populate(){const e=this.getChart();if(!e){di(this.barContainer.children,()=>!0),this.manager.app.renderer.render(this.barContainer,{renderTexture:this.barTexture});return}let t=0;const n=e.gameType.numCols,a=e.getNotedata().at(-1),r=this.manager.app.STAGE_HEIGHT-40;if(this.barTexture.resize(n*6,r),this.backingWidth=n*6+8,this.updateDimensions(),!a){di(this.barContainer.children,()=>!0),this.manager.app.renderer.render(this.barContainer,{renderTexture:this.barTexture});return}const s=a.beat+(Oe(a)?a.hold:0),o=e.getSecondsFromBeat(s),l=e.timingData.getOffset();e.getNotedata().forEach(u=>{let f=this.barContainer.children[t];f||(f=new Ae(Ce.WHITE),f.width=4,this.barContainer.addChild(f)),f.anchor.set(.5),f.height=1,f.x=(u.col+.5)*6;let c=pt(0,s,u.beat);if(y.chart.CMod&&(c=pt(l,o,u.second)),f.y=c*r,f.tint=Uu[u.quant],u.type=="Mine"&&(f.tint=8421504),t++,Oe(u)){let d=this.barContainer.children[t];d||(d=new Ae(Ce.WHITE),d.width=4,d.height=2,this.barContainer.addChild(d)),d.anchor.x=.5,d.anchor.y=0,d.x=(u.col+.5)*6;const h=(y.chart.CMod?e.getSecondsFromBeat(u.beat+u.hold)/o:(u.beat+u.hold)/s)*r+1;d.y=f.y,d.height=h-f.y,u.type=="Hold"&&(d.tint=10526880),u.type=="Roll"&&(d.tint=11379586),t++}}),di(this.barContainer.children,(u,f)=>f>=t),this.manager.app.renderer.render(this.barContainer,{renderTexture:this.barTexture})}}const ut=300,ii=150,wc=[.045,.09,.18,.37,.18,.09,.045];class Mm extends Zi{max=0;barlines=new fe;backgroundRect=new dt("noBorder");background=new fe;backgroundLines=new fe;statText=new fe;meanText;medianText;modeText;stddevText;errorMS=[];texts=new fe;showEase=0;toggled=!1;drag=!1;dragStart=0;lastMode=this.manager.chartManager.getMode();constructor(e){super(e),this.visible=!1,this.background.addChild(this.backgroundRect),ze(this.backgroundRect,"widget-bg"),this.addChild(this.background),this.addChild(this.backgroundLines),this.eventMode="static",this.on("mousedown",()=>{this.manager.chartManager.getMode()!=q.Play&&(this.drag=!0,this.dragStart=Date.now(),$t.stop("play-widget"))}),window.addEventListener("mousemove",p=>{this.drag&&(this.showEase+=p.movementY/-400)}),window.addEventListener("mouseup",()=>{this.drag&&(Date.now()-this.dragStart>400?this.toggled=this.showEase>.5:this.toggled=!this.toggled,$t.animate(this,{0:{showEase:"inherit"},1:{showEase:this.toggled?1:0}},.6,ci(.11,.71,.33,1.39),()=>{},"play-widget")),this.drag=!1}),this.on("mouseenter",()=>{!this.toggled&&this.manager.chartManager.getMode()!=q.Play&&$t.animate(this,{0:{showEase:"inherit"},1:{showEase:.05}},.6,ci(.11,.71,.33,1.39),()=>{},"play-widget")}),this.on("mouseleave",()=>{!this.toggled&&this.manager.chartManager.getMode()!=q.Play&&$t.animate(this,{0:{showEase:"inherit"},1:{showEase:0}},.6,ci(.11,.71,.33,1.39),()=>{},"play-widget")});const t=new ye("Early",{fontName:"Main",fontSize:15});t.x=-300/2+5,t.y=-190,t.alpha=.3,this.background.addChild(t),ze(t,"text-color");const n=new ye("Late",{fontName:"Main",fontSize:15});n.anchor.x=1,n.x=ut/2-5,n.y=-190,n.alpha=.3,this.background.addChild(n),ze(n,"text-color"),this.meanText=new ye("-",{fontName:"Main",fontSize:15}),this.meanText.anchor.x=.5,this.meanText.x=ut/4*-1.5,this.meanText.y=-220,this.statText.addChild(this.meanText),this.medianText=new ye("-",{fontName:"Main",fontSize:15}),this.medianText.anchor.x=.5,this.medianText.x=ut/4*-.5,this.medianText.y=-220,this.statText.addChild(this.medianText),this.modeText=new ye("-",{fontName:"Main",fontSize:15}),this.modeText.anchor.x=.5,this.modeText.x=ut/4*.5,this.modeText.y=-220,this.statText.addChild(this.modeText),this.stddevText=new ye("-",{fontName:"Main",fontSize:15}),this.stddevText.anchor.x=.5,this.stddevText.x=ut/4*1.5,this.stddevText.y=-220,this.statText.addChild(this.stddevText);const a=new ye("Mean",{fontName:"Main",fontSize:10});a.anchor.x=.5,a.x=ut/4*-1.5,a.y=-230,this.statText.addChild(a);const r=new ye("Median",{fontName:"Main",fontSize:10});r.anchor.x=.5,r.x=ut/4*-.5,r.y=-230,this.statText.addChild(r);const s=new ye("Mode",{fontName:"Main",fontSize:10});s.anchor.x=.5,s.x=ut/4*.5,s.y=-230,this.statText.addChild(s);const o=new ye("Std Dev.",{fontName:"Main",fontSize:10});o.anchor.x=.5,o.x=ut/4*1.5,o.y=-230,this.statText.addChild(o),this.statText.children.forEach(p=>{ze(p,"text-color")});const l=new fe,u=new dt("noBorder");u.tint=3355443,u.alpha=.3,u.width=ut/2-10,u.height=30,u.y=-25,u.x=-300/4,u.pivot.x=(ut/2-10)/2,u.pivot.y=15;const f=new ye("Adjust song offset",{fontName:"Main",fontSize:12});f.anchor.set(.5),f.x=-300/4,f.y=-25,l.addChild(u,f),l.eventMode="static",l.addEventListener("mouseenter",()=>{u.alpha=.6}),l.addEventListener("mousedown",p=>{p.stopImmediatePropagation(),this.adjustOffset("song")}),l.addEventListener("mouseleave",()=>{u.alpha=.3}),this.statText.addChild(l),ze(f,"text-color");const c=new fe,d=new dt("noBorder");d.tint=3355443,d.alpha=.3,d.width=ut/2-10,d.height=30,d.y=-25,d.x=ut/4,d.pivot.x=(ut/2-10)/2,d.pivot.y=15,d.eventMode="static",c.addEventListener("mouseenter",()=>{d.alpha=.6}),c.addEventListener("mouseleave",()=>{d.alpha=.3});const h=new ye("Adjust global offset",{fontName:"Main",fontSize:12});h.anchor.set(.5),h.x=ut/4,h.y=-25,c.addChild(d,h),ze(h,"text-color"),c.eventMode="static",c.addEventListener("mouseenter",()=>{d.alpha=.6}),c.addEventListener("mousedown",p=>{p.stopImmediatePropagation(),this.adjustOffset("global")}),c.addEventListener("mouseleave",()=>{d.alpha=.3}),this.statText.addChild(c),this.addChild(this.background),this.addChild(this.backgroundLines),this.eventMode="static",this.addChild(this.statText),this.addChild(this.barlines),this.addChild(this.texts)}update(){this.visible=!!this.manager.chartManager.gameStats,this.x=-this.manager.chartManager.app.STAGE_WIDTH/2+20+ut/2,this.y=this.manager.chartManager.app.STAGE_HEIGHT/2-20,this.backgroundRect.width=ut+10,this.backgroundRect.height=ii+260,this.backgroundRect.x=-300/2-5,this.backgroundRect.y=-410,this.visible=!!this.manager.chartManager.gameStats;for(const e of this.barlines.children)y.general.smoothAnimations?e.height=(e.targetHeight-e.height)*.2+e.height:e.height=e.targetHeight;this.lastMode!=this.manager.chartManager.getMode()&&(this.lastMode=this.manager.chartManager.getMode(),$t.animate(this,{0:{showEase:"inherit"},1:{showEase:this.manager.chartManager.getMode()==q.Play?1:0}},.6,ci(.11,.71,.33,1.39),()=>{},"play-widget")),y.general.smoothAnimations?this.y+=(1-Math.abs(this.showEase))*400:this.manager.chartManager.getMode()!=q.Play&&(this.y+=400)}newLine(){const e=new Ae(Ce.WHITE);return e.smoothCount=0,e.targetHeight=0,e.anchor.y=1,e.anchor.x=.5,e.height=0,e.visible=!1,e}startPlay(){const e=this.manager.chartManager.gameStats;this.max=0,this.errorMS=[],this.meanText.text="-",this.medianText.text="-",this.modeText.text="-",this.stddevText.text="-",di(this.barlines.children,()=>!0),di(this.backgroundLines.children,()=>!0),di(this.texts.children,()=>!0);const t=_t.getCollection(y.play.timingCollection),n=t.getStandardWindows().length+1,a=Math.round(t.maxWindowMS());for(let p=0;p<a*2;p++){const m=this.newLine();m.width=ut/a/2,m.x=(p-a)*m.width,m.y=-50,this.barlines.addChild(m)}let r=0;for(const p of t.getStandardWindows().reverse()){const m=Math.round(p.getTimingWindowMS());if(m!=0){for(let g=-1;g<=1;g+=2){const b=new Ae(Ce.WHITE);b.anchor.y=1,b.anchor.x=.5,b.height=ii,b.tint=p.color,b.alpha=.2,b.width=1,b.x=m*g*ut/a/2,b.y=-50,this.backgroundLines.addChild(b)}for(let g=-m+a;g<m+a;g++)this.barlines.children[Math.round(g)].tint=p.color}}const s=new Ae(Ce.WHITE);s.anchor.y=1,s.anchor.x=.5,s.height=ii,s.alpha=.2,s.width=1,s.tint=8947848,s.y=-50,this.backgroundLines.addChild(s);for(const p of[...t.getStandardWindows(),t.getMissJudgement()]){const m=new ye(p.name,{fontName:"Main",fontSize:15}),g=new ye("0",{fontName:"Main",fontSize:15});m.tint=p.color,g.tint=p.color,g.name=p.id,this.texts.addChild(m),this.texts.addChild(g),m.x=-300/2+10,g.x=-300/2+140,m.y=130/n*r-ii-220,g.y=130/n*r++-ii-220,m.anchor.y=.5,g.anchor.y=.5,g.anchor.x=1}const o=this.manager.chartManager.loadedChart?.gameType.gameLogic.usesHoldTicks??!1,l=(o?0:t.getHoldWindows().length)+2;r=0;for(const p of o?[t.getMineJudgement()]:[...t.getHoldWindows(),t.getMineJudgement()]){const m=dn(p)?p.noteType:"Mine",g=new ye(m,{fontName:"Main",fontSize:15}),b=new ye("0",{fontName:"Main",fontSize:15});ze(g,"text-color"),ze(b,"text-color"),m!="Mine"&&(b.text="0 / "+this.manager.chartManager.loadedChart.getNotedata().filter(x=>x.type==m&&!x.fake).length),g.alpha=.8,b.alpha=.8,b.name=m,this.texts.addChild(g),this.texts.addChild(b),g.x=-300/2+160,b.x=-300/2+290,g.y=80/l*r-ii-220,b.y=80/l*r++-ii-220,g.anchor.y=.5,b.anchor.y=.5,b.anchor.x=1}const u=new ye("Max Combo",{fontName:"Main",fontSize:15});ze(u,"text-color");const f=new ye("0",{fontName:"Main",fontSize:15});ze(f,"text-color"),u.alpha=.8,f.alpha=.8,f.name="Combo",this.texts.addChild(u),this.texts.addChild(f),u.x=-300/2+160,f.x=-300/2+290,u.y=80/l*r-ii-220,f.y=80/l*r++-ii-220,u.anchor.y=.5,f.anchor.y=.5,f.anchor.x=1;const c=new ye("0.00 / 0.00",{fontName:"Main",fontSize:20});ze(c,"text-color"),c.alpha=.8,c.x=-300/2+225,c.y=-262,c.name="Score",this.texts.addChild(c),c.anchor.set(.5);const d=new ye("Score / Current Score",{fontName:"Main",fontSize:13});ze(d,"text-color"),d.alpha=.5,d.x=-300/2+225,d.y=-285,this.texts.addChild(d),d.anchor.set(.5);const h=new ye("Play Statistics",{fontName:"Main",fontSize:13});h.y=-395,h.anchor.set(.5),ze(h,"text-color"),this.texts.addChild(h),e.onJudge((p,m)=>{let g="";(ui(m)||bi(m))&&(g=m.id),dn(m)&&(g=m.noteType),Ws(m)&&(g="Mine");const b=this.texts.getChildByName(g);if(dn(m)){const w=b.text.split(" / ")[1];b.text=e.getCount(m)+" / "+w}else Vn(m)||(b.text=e.getCount(m)+"");if(this.texts.getChildByName("Combo").text=e.getMaxCombo()+"",this.texts.getChildByName("Score").text=ue(e.getScore()*100,2).toFixed(2)+" / "+ue(e.getCumulativeScore()*100,2).toFixed(2),ui(m)||!bi(m)||p==null)return;const x=Math.round(p*1e3);for(let w=-3;w<=3;w++)this.barlines.children[x+a+w]&&(this.barlines.children[x+a+w].smoothCount+=wc[w+3],this.barlines.children[x+a+w].visible=!0,this.barlines.children[x+a+w].smoothCount>this.max&&(this.modeText.text=x+"ms",this.max=this.barlines.children[x+a+w].smoothCount));this.errorMS.push(p*1e3),this.meanText.text=td(this.errorMS).toFixed(2)+"ms",this.medianText.text=Ha(this.errorMS).toFixed(2)+"ms",this.stddevText.text=Sc(this.errorMS).toFixed(2)+"ms",this.redraw()})}redraw(){for(const e of this.barlines.children)e.targetHeight=e.smoothCount*(ii-20)/this.max}adjustOffset(e){const t=this.manager.chartManager.gameStats;if(!t)return;const n=Math.round(t.getMedian()*1e3)/1e3;if(n==0)return;t.applyOffset(-n),this.barlines.children.forEach(o=>{o.smoothCount=0});const a=_t.getCollection(y.play.timingCollection),r=Math.round(a.maxWindowMS());t.getDataPoints().forEach(o=>{if(ui(o.judgement)||!bi(o.judgement)||o.error===null)return;const l=Math.round(o.error*1e3);for(let u=-3;u<=3;u++)this.barlines.children[l+r+u]&&(this.barlines.children[l+r+u].smoothCount+=wc[u+3],this.barlines.children[l+r+u].visible=!0,this.barlines.children[l+r+u].smoothCount>this.max&&(this.modeText.text=l+"ms",this.max=this.barlines.children[l+r+u].smoothCount))}),this.redraw();const s=e=="global"?y.play.offset:this.manager.app.chartManager.loadedChart.timingData.getOffset();if(e=="global")y.play.offset=ue(y.play.offset-n,3);else if(e=="song"){const o=this.manager.app.chartManager.loadedChart.timingData.hasChartOffset()?this.manager.app.chartManager.loadedChart.timingData:this.manager.app.chartManager.loadedSM.timingData;o.setOffset(ue(o.getOffset()-n,3))}de.create(`Adjusted ${e} offset from ${ue(s,3).toFixed(3)} to ${ue(s-n,3).toFixed(3)}`)}}class Lm extends Zi{registeredSpinners=[];registeredToggles=[];registeredCheckboxes=[];changeRow;warpRow;fakeRow;view;collapseButton;lastSpeedMod=y.chart.CMod;rateSpinner;enteredMain=!1;constructor(e){super(e),this.visible=!1;const t=document.createElement("div");t.id="playback-options",y.general.showPlaybackOptions||t.classList.add("collapsed"),t.style.height="0px",re.on("resize",()=>{this.registeredToggles.forEach(W=>{W.update(!1)})}),document.getElementById("menubar")?.insertAdjacentElement("afterend",t),this.view=t;const n=document.createElement("button");n.classList.add("po-collapse"),n.tabIndex=-1;const a=me.getIcon("CHEVRON",18);n.appendChild(a),y.general.showPlaybackOptions&&n.classList.add("toggled"),this.collapseButton=n,n.onclick=()=>{y.general.showPlaybackOptions=!y.general.showPlaybackOptions,t.classList.toggle("collapsed"),n.classList.toggle("toggled",!t.classList.contains("collapsed")),n.blur()},n.style.display="none",Xe(n,{onShow(W){W.setContent((t.classList.contains("collapsed")?"Show ":"Hide ")+"playback options")}});const r=this.createRow("Zoom"),s=this.createSpinner({value:y.chart.zoom*100,step:10,altStep:2,min:10,hardMin:0,onChange:W=>y.chart.zoom=W/100,getValue:()=>y.chart.zoom*100});r.appendChild(s),t.appendChild(r);const o=document.createElement("div"),l=document.createElement("h1");l.innerText="a",o.appendChild(l),xe.createKeybindTooltip(r)`Adjust playfield size ${"zoomOut"}/${"zoomIn"}`,t.appendChild(this.createSeparator());const u=this.createRow("Playback"),f=this.createSpinner({value:y.audio.rate*100,step:10,altStep:2,min:10,hardMin:0,onChange:W=>y.audio.rate=W/100,getValue:()=>y.audio.rate*100});u.appendChild(f),t.appendChild(u),this.rateSpinner=this.registeredSpinners.at(-1),xe.createKeybindTooltip(u)`Adjust audio playback rate  ${"rateDown"}/${"rateUp"}`;const c=document.createElement("div");c.style.gap="0.25rem",c.style.display="flex",c.style.alignItems="center";const d=this.createCheckbox({getValue:()=>y.audio.assistTick,value:y.audio.assistTick,onEl:me.getIcon("CLAP",18),offEl:me.getIcon("X_CLAP",18),onChange:W=>y.audio.assistTick=W});c.appendChild(d),xe.createKeybindTooltip(d)`Toggle assist tick ${"assistTick"}`;const h=this.createCheckbox({getValue:()=>y.audio.metronome,value:y.audio.metronome,onEl:me.getIcon("METRONOME",18),offEl:me.getIcon("X_METRONOME",18),onChange:W=>y.audio.metronome=W});c.appendChild(h),t.appendChild(c),xe.createKeybindTooltip(h)`Toggle metronome ${"metronome"}`,t.appendChild(this.createSeparator());const p=this.createRow("Scroll"),m=me.getIcon("DBL_CHEVRON",16);m.style.padding="0.125rem";const g=me.getIcon("DBL_CHEVRON",16);g.style.padding="0.125rem",g.style.transform="rotate(180deg)";const b=this.createToggle({values:[m,g],value:y.chart.reverse?1:0,getValue:()=>y.chart.reverse?1:0,onChange:(W,V)=>y.chart.reverse=V!=0});p.appendChild(b),t.appendChild(p),xe.createKeybindTooltip(p)`Change scroll direction ${"reverse"}`;const x=this.createRow("Speedmod"),w=this.createToggle({values:["X","C"],value:y.chart.CMod?1:0,getValue:()=>y.chart.CMod?1:0,onChange:W=>y.chart.CMod=W!="X"});xe.createKeybindTooltip(w)`Change speedmod type ${"XMod"}/${"CMod"}`;const E=this.createSpinner({value:y.chart.speed,step:25,altStep:5,min:10,hardMin:10,hardMax:35e3,onChange:W=>y.chart.speed=W,getValue:()=>y.chart.speed});x.appendChild(w),x.appendChild(E),t.appendChild(x),xe.createKeybindTooltip(E)`Adjust scroll speed ${"increaseScrollSpeed"}/${"decreaseScrollSpeed"}`,t.appendChild(this.createSeparator());const C=this.createRow("Speed Changes"),B=this.createToggle({values:["On","Off"],value:y.chart.doSpeedChanges?0:1,getValue:()=>y.chart.doSpeedChanges?0:1,onChange:W=>y.chart.doSpeedChanges=W=="On"});C.appendChild(B),t.appendChild(C),xe.createKeybindTooltip(C)`Allow scroll/speed events (XMod only) ${"doSpeedChanges"}`,this.changeRow=C;const D=this.createRow("Warped Notes"),O=this.createCheckbox({getValue:()=>y.chart.hideWarpedArrows,value:y.chart.hideWarpedArrows,onEl:me.getIcon("X_EYE",18),offEl:me.getIcon("EYE",18),onChange:W=>y.chart.hideWarpedArrows=W});D.appendChild(O),t.appendChild(D),xe.createKeybindTooltip(D)`Show/hide warped notes (CMod only) ${"hideWarpedArrows"}`,this.warpRow=D;const H=this.createRow("Faked Notes"),Y=this.createCheckbox({getValue:()=>y.chart.hideFakedArrows,value:y.chart.hideFakedArrows,onEl:me.getIcon("X_EYE",18),offEl:me.getIcon("EYE",18),onChange:W=>y.chart.hideFakedArrows=W});H.appendChild(Y),t.appendChild(H),xe.createKeybindTooltip(H)`Show/hide faked notes (CMod only) ${"hideFakedArrows"}`,this.fakeRow=H;const ae=me.getIcon("VOLUME",22);ae.style.marginLeft="auto",ae.style.marginRight="-1rem",ae.style.height="1.375rem",ae.style.width="1.375rem",ae.style.alignSelf="center",t.appendChild(ae);const M=this.createRow("Master"),P=this.createSpinner({value:y.audio.masterVolume*100,step:5,altStep:1,min:0,max:200,hardMin:0,hardMax:200,onChange:W=>y.audio.masterVolume=W/100,getValue:()=>y.audio.masterVolume*100});M.appendChild(P),t.appendChild(M);const v=this.createRow("Song"),S=this.createSpinner({value:y.audio.songVolume*100,step:5,altStep:1,min:0,max:200,hardMin:0,hardMax:200,onChange:W=>y.audio.songVolume=W/100,getValue:()=>y.audio.songVolume*100});v.appendChild(S),t.appendChild(v);const $=this.createRow("FX"),L=this.createSpinner({value:y.audio.soundEffectVolume*100,step:5,altStep:1,min:0,max:200,hardMin:0,hardMax:200,onChange:W=>y.audio.soundEffectVolume=W/100,getValue:()=>y.audio.soundEffectVolume*100});$.appendChild(L),t.appendChild($),this.changeRow.style.setProperty("--w",this.changeRow.offsetWidth/16+"rem"),this.warpRow.style.setProperty("--w",this.warpRow.offsetWidth/16+"rem"),this.fakeRow.style.setProperty("--w",this.fakeRow.offsetWidth/16+"rem"),this.changeRow.classList.toggle("hidden",y.chart.CMod),this.warpRow.classList.toggle("hidden",!y.chart.CMod),this.fakeRow.classList.toggle("hidden",!y.chart.CMod),he.playbackOptions||(t.style.display="none",n.style.display="none")}createRow(e){const t=document.createElement("div");t.classList.add("playback-options-row");const n=document.createElement("div");return n.classList.add("playback-options-label"),n.innerText=e,t.appendChild(n),t}createSeparator(){const e=document.createElement("div");return e.classList.add("po-separator"),e}createSpinner(e){const t=document.createElement("div");t.classList.add("po-spinner");const n=u=>{let f=y.general.spinnerStep;return u.getModifierState("Shift")?f=e.altStep??(e.step!==void 0?e.step/10:y.general.spinnerStep):f=e.step??y.general.spinnerStep,f},a=document.createElement("button");a.classList.add("po-spinner-btn"),a.innerText="-",a.onclick=u=>{l.currentValue-=n(u),e.min!==void 0&&l.currentValue<e.min&&(l.currentValue=e.min),o(!0)};const r=document.createElement("button");r.classList.add("po-spinner-btn"),r.innerText="+",r.onclick=u=>{l.currentValue+=n(u),e.max!==void 0&&l.currentValue>e.max&&(l.currentValue=e.max),o(!0)};const s=document.createElement("input");s.classList.add("po-spinner-input"),s.type="text";const o=(u=!0)=>{e.hardMin!==void 0&&l.currentValue<e.hardMin&&(l.currentValue=e.hardMin),e.hardMax!==void 0&&l.currentValue>e.hardMax&&(l.currentValue=e.hardMax),u&&e.onChange(l.currentValue),s.value=l.currentValue.toFixed()};s.addEventListener("wheel",u=>{u.preventDefault(),l.currentValue+=n(u)*u.deltaY/100*(y.chart.scroll.invertZoomScroll?-1:1)*y.chart.scroll.scrollSensitivity,e.max!==void 0&&l.currentValue>e.max&&(l.currentValue=e.max),e.min!==void 0&&l.currentValue<e.min&&(l.currentValue=e.min),o(!0)});const l={btnMinus:a,btnPlus:r,input:s,options:e,currentValue:e.value??0,update:o};return o(),t.replaceChildren(a,s,r),s.spellcheck=!1,s.onkeydown=u=>{u.key=="Enter"&&s.blur(),u.key=="Escape"&&(l.currentValue=e.getValue(),o(!1))},s.onfocus=()=>{s.select()},s.onblur=()=>{const u=this.parseString(s);if(u==null){l.currentValue=e.getValue(),o(!1);return}l.currentValue=u,o()},s.ondragstart=u=>u.preventDefault(),this.registeredSpinners.push(l),t}createToggle(e){const t=document.createElement("div");if(t.classList.add("po-toggle"),e.values.length==0)return t;const n=document.createElement("div");n.classList.add("po-toggle-highlight");const a=e.values.map((l,u)=>{if(typeof l=="string"){const f=document.createElement("div");return f.classList.add("po-toggle-item"),f.innerText=l,t.appendChild(f),f.onclick=()=>{o.currentValue!=u&&(o.currentValue=u,s())},f}else return l.onclick=()=>{o.currentValue!=u&&(o.currentValue=u,s())},t.appendChild(l),l});t.style.visibility="hidden",document.body.appendChild(t);const r=l=>{n.style.left=a[l].getBoundingClientRect().left-a[0].getBoundingClientRect().left+"px",n.style.width=a[l].getBoundingClientRect().width+"px",n.style.height=a[l].getBoundingClientRect().height+"px"},s=(l=!0)=>{l&&e.onChange(e.values[o.currentValue],o.currentValue),[...t.querySelectorAll(".active")].forEach(u=>u.classList.remove("active")),r(o.currentValue),a[o.currentValue].classList.add("active")},o={currentValue:e.value??0,options:e,update:s};return this.registeredToggles.push(o),s(!1),t.remove(),t.style.visibility="",t.appendChild(n),t}createCheckbox(e){const t=document.createElement("div");t.classList.add("ico-checkbox");const n=(r=!0)=>{r&&e.onChange(a.currentValue),a.options.onEl.style.display=a.currentValue?"":"none",a.options.offEl.style.display=a.currentValue?"none":""},a={currentValue:e.value??!0,options:e,update:n};return t.onclick=()=>{a.currentValue=!a.currentValue,n()},this.registeredCheckboxes.push(a),n(!1),t.replaceChildren(a.options.onEl,a.options.offEl),t}update(){!this.enteredMain&&this.manager.chartManager.loadedChart!==void 0&&he.menuBar&&(this.enteredMain=!0,this.view.style.height="",this.collapseButton.style.display="",document.getElementById("menubar")?.appendChild(this.collapseButton));for(const t of this.registeredSpinners)t.currentValue!=t.options.getValue()&&document.activeElement!=t.input&&(t.currentValue=t.options.getValue(),t.update(!1));for(const t of this.registeredToggles)t.currentValue!=t.options.getValue()&&(t.currentValue=t.options.getValue(),t.update(!1));for(const t of this.registeredCheckboxes)t.currentValue!=t.options.getValue()&&(t.currentValue=t.options.getValue(),t.update(!1));const e=this.manager.chartManager.getMode()==q.Play||this.manager.chartManager.getMode()==q.Record;this.rateSpinner.btnMinus.disabled=e,this.rateSpinner.btnPlus.disabled=e,this.rateSpinner.input.disabled=e,y.chart.CMod!=this.lastSpeedMod&&(this.lastSpeedMod=y.chart.CMod,this.changeRow.classList.toggle("hidden",y.chart.CMod),this.warpRow.classList.toggle("hidden",!y.chart.CMod),this.fakeRow.classList.toggle("hidden",!y.chart.CMod))}parseString(e){try{const t=Mc.evaluate(e.value);return isFinite(t)?t:0}catch{return null}}}const yi={BPMS:9182254,STOPS:4934913,DELAYS:217453,WARPS:9243998,FAKES:4868682,COMBOS:939078,SPEEDS:2968693,LABELS:7747359,SCROLLS:3557006,TIMESIGNATURES:5392684,TICKCOUNTS:1594906,BGCHANGES:8460415,FGCHANGES:8857115,ATTACKS:1856083};class Dm extends fe{renderer;areaPool=new Xi({create:()=>{const e=new Ae(Ce.WHITE);return Object.assign(e,{alpha:.2,width:this.renderer.chart.gameType.notefieldWidth+128}),e.anchor.set(.5,0),e}});timingAreaMap=new Map;timingEvents=[];timingDirty=!0;constructor(e){super(),this.renderer=e,this.addChild(this.areaPool);const t=()=>this.timingDirty=!0;re.on("timingModified",t),this.on("destroyed",()=>re.off("timingModified",t))}update(e,t){this.timingDirty&&(this.timingAreaMap.clear(),this.areaPool.destroyAll(),this.timingDirty=!1,this.timingEvents=this.renderer.chart.timingData.getTimingData("STOPS","WARPS","DELAYS","FAKES")),this.visible=this.renderer.shouldDisplayBarlines();for(const n of this.timingEvents){if(n.beat>t)break;if(this.shouldDrawEvent(n,e,t)&&!this.timingAreaMap.has(n)){const a=this.areaPool.createChild();if(!a)break;a.tint=yi[n.type],this.timingAreaMap.set(n,a)}}for(const[n,a]of this.timingAreaMap.entries()){if(!this.shouldDrawEvent(n,e,t)){this.timingAreaMap.delete(n),this.areaPool.destroyChild(a);continue}let r=y.chart.CMod?this.renderer.getYPosFromSecond(n.second):this.renderer.getYPosFromBeat(n.beat),s=r;switch(n.type){case"STOPS":case"DELAYS":{y.chart.CMod&&n.value>0?s=this.renderer.getYPosFromSecond(n.second+n.value):n.value<0&&(s=this.renderer.getYPosFromBeat(this.renderer.chart.getBeatFromSeconds(n.second+1e-4)));break}case"FAKES":{s=this.renderer.getYPosFromBeat(n.beat+n.value);break}case"WARPS":{y.chart.CMod||(s=this.renderer.getYPosFromBeat(n.beat+n.value));break}}s<r&&([s,r]=[r,s]);const o=s-r;a.y=r,a.height=o}}shouldDrawEvent(e,t,n){return(e.type=="STOPS"||e.type=="DELAYS")&&e.second+Math.abs(e.value)<=this.renderer.chart.timingData.getSecondsFromBeat(t)||(e.type=="WARPS"||e.type=="FAKES")&&e.beat+e.value<t||(e.type=="STOPS"||e.type=="DELAYS")&&!(!y.chart.CMod&&e.value<0||y.chart.CMod&&e.value>0)||e.type=="WARPS"&&y.chart.CMod?!1:e.beat<=n}}const $e={chart:{title:"Chart Timing Column",desc:"Events in this column are only used by this difficulty",convertText:"Convert to song timing",buttonOne:{text:"Copy chart events",tooltip:"Copies chart events from this column to song timing",tooltipAll:"Copies offset and chart events from all columns to song timing",action:(i,e)=>{i.copyColumnsToSimfile([e])},actionAll:i=>{i.copyAllToSimfile()}},buttonTwo:{text:"Delete chart events",tooltip:"Reverts this column to the events in song timing, deleting any difficulty-specific events",tooltipAll:"Reverts offset and all columns to the events in song timing, deleting any difficulty-specific events",action:(i,e)=>{i.deleteColumns([e])},actionAll:i=>{i.deleteAllChartSpecific()}}},song:{title:"Song Timing Column",desc:"Events in this column are used by all difficulties (unless overridden)",convertText:"Convert to chart timing",buttonOne:{text:"Copy song events",tooltip:"Copies song events from this column to chart timing",tooltipAll:"Copies offset and song events from all columns to chart timing",action:(i,e)=>{i.copyColumnsFromSimfile([e])},actionAll:i=>{i.copyAllFromSimfile()}},buttonTwo:{text:"Don't copy song events",tooltip:"Converts this column to chart timing without copying any song events",tooltipAll:"Converts offset and all columns to chart timing without copying any song events",action:(i,e)=>{i.createChartColumns([e])},actionAll:i=>{i.createEmptyData()}}}},Pi={chart:{title:"Chart Specific Offset",desc:"This offset is only used by this difficulty",convertText:"Convert to song timing",buttonOne:{text:"Copy chart offset",tooltip:"Sets the song offset to this chart offset",action:i=>{i.copyOffsetToSimfile()}},buttonTwo:{text:"Revert to song offset",tooltip:"Reverts to the song offset, removing the chart-specific offset",action:i=>{i.removeChartOffset()}}},song:{title:"Song Specific Offset",desc:"This offset is used by all difficulties (unless overridden)",convertText:"Convert to chart timing",buttonOne:{text:"Copy song offset",tooltip:"Copies song offset to the chart offset",action:i=>{i.setOffset(i.getOffset())}},buttonTwo:{text:"Don't copy song offset",tooltip:"Sets the new chart offset to 0",action:i=>{i.setOffset(0)}}}};class ys extends ra{static app;static timingGrid;static onTimingChange=this.updateValues.bind(this);static open(e){this.active||(this.app=e,super._open({title:"Manage Split Timing",editable:!1,attach:document.getElementById("split-timing"),cancelableOnOpen:!0,clickHandler:t=>{!this.popup?.contains(t.target)&&!document.getElementById("split-timing")?.contains(t.target)&&this.close()}}),re.on("timingModified",this.onTimingChange))}static buildContent(){this.popup.id="split-timing";const e=document.createElement("div");e.classList.add("split-timing-grid"),this.timingGrid=e;const t=this.buildModifyGrid();this.updateValues(),this.view.appendChild(e),this.view.appendChild(t)}static updateValues(){this.timingGrid.replaceChildren();const e=document.createElement("div");e.classList.add("split-timing-row"),e.style.backgroundColor="rgba(0, 0, 0, 0.3";const t=document.createElement("div");t.innerText="OFFSET";const n=this.app.chartManager.loadedChart.timingData.hasChartOffset(),a=n?"chart":"song",r=document.createElement("div");r.innerText=n?"C":"S",Xe(r,{content:Pi[a].desc});const s=document.createElement("button");s.innerText=Pi[a].buttonOne.text,Xe(s,{content:Pi[a].buttonOne.tooltip}),s.onclick=()=>{Pi[a].buttonOne.action(this.app.chartManager.loadedChart.timingData)};const o=document.createElement("button");o.innerText=Pi[a].buttonTwo.text,o.classList.toggle("delete",n),Xe(o,{content:Pi[a].buttonTwo.tooltip}),o.onclick=()=>{Pi[a].buttonTwo.action(this.app.chartManager.loadedChart.timingData)},e.replaceChildren(t,r,s,o),this.timingGrid.appendChild(e);for(const l of Sa)this.timingGrid.appendChild(this.buildRow(l));return e}static buildRow(e){const t=document.createElement("div");t.classList.add("split-timing-row"),t.style.backgroundColor=Ba(yi[e].toString(16).padStart(6,"0"),"#333333",.75);const n=document.createElement("div");n.innerText=e;const a=this.app.chartManager.loadedChart.timingData.isPropertyChartSpecific(e),r=a?"chart":"song",s=document.createElement("div");s.innerText=a?"C":"S",Xe(s,{content:$e[r].desc});const o=document.createElement("button");o.innerText=$e[r].buttonOne.text,Xe(o,{content:$e[r].buttonOne.tooltip}),o.onclick=()=>{$e[r].buttonOne.action(this.app.chartManager.loadedChart.timingData,e)};const l=document.createElement("button");return l.innerText=$e[r].buttonTwo.text,l.classList.toggle("delete",a),Xe(l,{content:$e[r].buttonTwo.tooltip}),l.onclick=()=>{$e[r].buttonTwo.action(this.app.chartManager.loadedChart.timingData,e)},t.replaceChildren(n,s,o,l),t}static buildModifyGrid(){const e=document.createElement("div");e.classList.add("split-timing-grid");const t=document.createElement("div");t.classList.add("split-timing-modify-row"),t.style.backgroundColor="rgba(0, 0, 0, 0.3";const n=document.createElement("div");n.innerText="Convert all to chart timing";const a=document.createElement("button");a.innerText=$e.song.buttonOne.text,Xe(a,{content:$e.song.buttonOne.tooltipAll}),a.onclick=()=>{$e.song.buttonOne.actionAll(this.app.chartManager.loadedChart.timingData),a.blur()};const r=document.createElement("button");r.innerText=$e.song.buttonTwo.text,r.classList.add("delete"),Xe(r,{content:$e.song.buttonTwo.tooltipAll}),r.onclick=()=>{$e.song.buttonTwo.actionAll(this.app.chartManager.loadedChart.timingData),r.blur()},t.replaceChildren(n,a,r);const s=document.createElement("div");s.classList.add("split-timing-modify-row"),s.style.backgroundColor="rgba(0, 0, 0, 0.3";const o=document.createElement("div");o.innerText="Convert all to song timing";const l=document.createElement("button");l.innerText=$e.chart.buttonOne.text,Xe(l,{content:$e.chart.buttonOne.tooltipAll}),l.onclick=()=>{$e.chart.buttonOne.actionAll(this.app.chartManager.loadedChart.timingData),l.blur()};const u=document.createElement("button");return u.innerText=$e.chart.buttonTwo.text,Xe(u,{content:$e.chart.buttonTwo.tooltipAll}),u.onclick=()=>{$e.chart.buttonTwo.actionAll(this.app.chartManager.loadedChart.timingData),u.blur()},s.replaceChildren(o,l,u),e.replaceChildren(t,s),e}static close(){!this.popup||!this.active||super.close()}}class ws extends ra{static draggedElement;static dragOffsetX=0;static dragOffsetY=0;static grid;static leftovers;static boundaryCache=[];static open(){this.active||super._open({title:"Reorder Timing Tracks",editable:!1,attach:document.getElementById("toggle-tracks"),cancelableOnOpen:!0,clickHandler:e=>{!this.popup?.contains(e.target)&&!this.draggedElement?.contains(e.target)&&!document.getElementById("toggle-tracks")?.contains(e.target)&&this.close()}})}static buildContent(){this.popup.id="timing-track-order";const e=document.createElement("div");e.classList.add("track-grid-options");const t=document.createElement("button");t.classList.add("delete"),t.innerText="Reset",t.onclick=()=>{y.chart.timingEventOrder.left=structuredClone(To.chart.timingEventOrder.left),y.chart.timingEventOrder.right=structuredClone(To.chart.timingEventOrder.right),this.clearBoundaries(),this.grid?.replaceChildren(),this.leftovers?.replaceChildren();const r=[...Sa];for(const o of y.chart.timingEventOrder.left){const l=this.makeDraggableTrack(o);l.classList.add("left"),this.grid?.appendChild(l),r.splice(r.indexOf(o),1)}const s=document.createElement("div");s.classList.add("draggable-track"),s.innerText="PLAYFIELD",s.style.backgroundColor="#2D2D2D",s.style.padding="1.25rem 0.625rem",s.style.writingMode="horizontal-tb",s.addEventListener("mousedown",o=>this.startDragging(o,s)),s.dataset.type="PLAYFIELD",this.grid?.appendChild(s);for(const o of y.chart.timingEventOrder.right){const l=this.makeDraggableTrack(o);l.classList.add("right"),this.grid?.appendChild(l),r.splice(r.indexOf(o),1)}for(const o of r)this.leftovers?.appendChild(this.makeLeftoverTrack(o))},this.grid=document.createElement("div"),this.grid.classList.add("track-grid"),this.view.appendChild(this.grid),this.view.appendChild(e);const n=[...Sa];for(const r of y.chart.timingEventOrder.left){const s=this.makeDraggableTrack(r);s.classList.add("left"),this.grid.appendChild(s),n.splice(n.indexOf(r),1)}const a=document.createElement("div");a.classList.add("draggable-track"),a.innerText="PLAYFIELD",a.style.backgroundColor="#2D2D2D",a.style.padding="1.25rem 0.625rem",a.style.writingMode="horizontal-tb",a.addEventListener("mousedown",r=>this.startDragging(r,a)),a.dataset.type="PLAYFIELD",this.grid.appendChild(a);for(const r of y.chart.timingEventOrder.right){const s=this.makeDraggableTrack(r);s.classList.add("right"),this.grid.appendChild(s),n.splice(n.indexOf(r),1)}this.leftovers=document.createElement("div"),this.leftovers.classList.add("track-selector"),e.appendChild(this.leftovers),e.appendChild(t);for(const r of n)this.leftovers.appendChild(this.makeLeftoverTrack(r))}static makeDraggableTrack(e){const t=document.createElement("div");t.classList.add("draggable-track");const n=document.createElement("div");n.classList.add("draggable-track-text"),n.innerText=e,t.style.backgroundColor=Ba(yi[e].toString(16).padStart(6,"0"),"#333333",.7),t.appendChild(n);let a=!0;const r=me.getIcon("TRASH",16);return r.addEventListener("click",()=>{if(!a)return;a=!1,this.deleteTrack(e),t.classList.add("exiting"),setTimeout(()=>t.remove(),400);const s=this.makeLeftoverTrack(e);s.classList.add("entering"),setTimeout(()=>s.classList.remove("entering"),400),this.leftovers?.appendChild(s),this.clearBoundaries()}),t.appendChild(r),t.addEventListener("mousedown",s=>{a&&(r.contains(s.target)||this.startDragging(s,t))}),t.dataset.type=e,t}static makeLeftoverTrack(e){const t=document.createElement("div");t.classList.add("leftover-track");const n=me.getIcon("PLUS",8);t.append(n);const a=document.createElement("div");a.classList.add("leftover-track-text"),a.innerText=e,t.style.backgroundColor=Ba(yi[e].toString(16).padStart(6,"0"),"#333333",.7),t.appendChild(a);let r=0,s=0,o=!1,l=!1;return t.addEventListener("mousedown",()=>{o=!0}),t.addEventListener("mousemove",u=>{if(!(!o||l)&&(r+=u.movementX,s+=u.movementY,r*r+s*s>15)){l=!0;const f=this.makeDraggableTrack(e);this.grid?.appendChild(f),this.clearBoundaries();const c=t.getBoundingClientRect(),d=this.getClosestSlot(c.left),h=y.chart.timingEventOrder.left.concat(["PLAYFIELD"],y.chart.timingEventOrder.right);h.splice(d,0,e),this.saveOptions(h),h.forEach(p=>{const m=this.grid?.querySelector(`div[data-type=${p}]`);this.grid?.appendChild(m),p!="PLAYFIELD"&&(m?.classList.remove("left","right"),y.chart.timingEventOrder.left.includes(p)&&m?.classList.add("left"),y.chart.timingEventOrder.right.includes(p)&&m?.classList.add("right"))}),this.startDragging(u,f,u.clientX,u.clientY),y.general.smoothAnimations?(t.style.width=t.clientWidth+"px",t.style.transition="0.4s cubic-bezier(0, 0.91, 0.34, 1.05)",setTimeout(()=>{t.style.width="0px",t.style.opacity="0",t.style.padding="0",t.style.fontSize="0"},10),setTimeout(()=>t.remove(),400)):t.remove()}}),t.addEventListener("mouseup",()=>{if(!o||l)return;l=!0,y.chart.timingEventOrder.right.push(e),y.general.smoothAnimations?(t.style.width=t.clientWidth+"px",t.style.transition="0.4s cubic-bezier(0, 0.91, 0.34, 1.05)",setTimeout(()=>{t.style.width="0px",t.style.opacity="0",t.style.padding="0",t.style.fontSize="0"},10),setTimeout(()=>t.remove(),400)):t.remove();const u=this.makeDraggableTrack(e);u.classList.add("entering"),u.classList.add("right"),setTimeout(()=>u.classList.remove("entering"),400),this.grid?.appendChild(u),this.clearBoundaries()}),t}static startDragging(e,t,n,a){if(!this.popup)return;this.draggedElement=t.cloneNode(!0),this.draggedElement.style.position="fixed";const r=t.getBoundingClientRect(),s=this.popup.getBoundingClientRect();!n||!a?(this.dragOffsetX=e.clientX-r.left,this.dragOffsetY=e.clientY-r.top,this.draggedElement.style.left=r.left-s.left+"px",this.draggedElement.style.top=r.top-s.top+"px"):(this.dragOffsetX=r.width/2,this.dragOffsetY=r.height/4*3,this.draggedElement.style.left=n-r.width/2-s.left+"px",this.draggedElement.style.top=a-r.height/4*3-s.top+"px",this.draggedElement.classList.add("entering")),this.draggedElement.style.boxShadow="6px 6px 6px #222",this.draggedElement.style.transition="none",t.style.opacity="0.03",this.popup.appendChild(this.draggedElement);const o=y.chart.timingEventOrder.left.concat(["PLAYFIELD"],y.chart.timingEventOrder.right),l=t.dataset.type;let u=o.indexOf(l);const f=o.indexOf(l),c=h=>{this.draggedElement.style.left=h.clientX-this.dragOffsetX-s.left+"px",this.draggedElement.style.top=h.clientY-this.dragOffsetY-s.top+"px";let p=this.getClosestSlot(h.clientX-this.dragOffsetX);Math.abs(h.clientY-this.dragOffsetY-s.top-(r.top-s.top))>140&&(p=f),u!=p&&(o.splice(u,1),o.splice(p,0,l),this.saveOptions(o),o.forEach(m=>{const g=this.grid?.querySelector(`div[data-type=${m}]`);this.grid?.appendChild(g),m!="PLAYFIELD"&&(g?.classList.remove("left","right"),y.chart.timingEventOrder.left.includes(m)&&g?.classList.add("left"),y.chart.timingEventOrder.right.includes(m)&&g?.classList.add("right"))}),l!="PLAYFIELD"&&(this.draggedElement?.classList.remove("left","right"),y.chart.timingEventOrder.left.includes(l)&&this.draggedElement?.classList.add("left"),y.chart.timingEventOrder.right.includes(l)&&this.draggedElement?.classList.add("right")),u=p)};window.addEventListener("mousemove",c);const d=()=>{this.draggedElement?.remove(),this.draggedElement=void 0,window.removeEventListener("mousemove",c),t.style.opacity="",this.clearBoundaries(),window.removeEventListener("mouseup",d)};window.addEventListener("mouseup",d)}static saveOptions(e){const t=e.indexOf("PLAYFIELD");t!=-1&&(y.chart.timingEventOrder.left=e.slice(0,t),y.chart.timingEventOrder.right=e.slice(t+1))}static deleteTrack(e){const t=y.chart.timingEventOrder.left.indexOf(e);t!=-1&&y.chart.timingEventOrder.left.splice(t,1);const n=y.chart.timingEventOrder.right.indexOf(e);n!=-1&&y.chart.timingEventOrder.right.splice(n,1),y.chart.timingEventOrder.left=[...y.chart.timingEventOrder.left],y.chart.timingEventOrder.right=[...y.chart.timingEventOrder.right]}static getClosestSlot(e){this.boundaryCache.length==0&&this.getBoundaries();let t=-1,n=999999,a=999999;for(let r=0;r<this.boundaryCache.length;r++){const s=Math.abs(e-this.boundaryCache[r][1].left);if(s<n&&(n=s,t=r),s>a)break;a=s}return t}static getBoundaries(){if(this.grid){for(const e of this.grid.children)this.boundaryCache.push([e,e.getBoundingClientRect()]);this.boundaryCache.sort((e,t)=>e[1].left-t[1].left)}}static clearBoundaries(){this.boundaryCache=[]}static close(){!this.popup||!this.active||(super.close(),this.clearBoundaries())}}class Bm extends Zi{view;playbackBar;skipStart;skipEnd;play;playIcon;stopIcon;record;playtest;timeCounter;beatCounter;min;sec;millis;beat;beatDropdown;editBar;editSteps;editTiming;stepsContainer;timingContainer;editChoiceContainer;addTimingEvent;splitTiming;toggleTimingTracks;detectSync;offsetCounter;offset;noteArrows=[];noteArrowMask;lastTime=null;lastBeat=null;lastOffset=null;lastMode=q.Edit;lastTimingMode=ke.Off;lastHover=0;lastPlaying=!1;hovering=!1;trackingMovement=!0;idleFrames=0;lastBounds;constructor(e){super(e);const t=document.createElement("div");t.id="status-widget",document.getElementById("view-wrapper")?.appendChild(t),he.viewMode&&t.classList.add("collapsed"),this.playbackBar=document.createElement("div"),this.playbackBar.classList.add("playback-bar"),this.editBar=document.createElement("div"),this.editBar.classList.add("edit-bar"),this.skipStart=document.createElement("button"),this.skipStart.tabIndex=-1;const n=me.getIcon("SKIP_START",36);this.skipStart.appendChild(n),this.skipStart.onclick=()=>{this.manager.chartManager.beat=Math.max(0,this.manager.chartManager.loadedChart.getBeatFromSeconds(0)),this.skipStart.blur()},xe.createKeybindTooltip(this.skipStart)`Skip to start ${"jumpSongStart"}`,this.skipEnd=document.createElement("button"),this.skipEnd.tabIndex=-1;const a=me.getIcon("SKIP_END",36);this.skipEnd.appendChild(a),this.skipEnd.onclick=()=>{this.manager.chartManager.beat=this.manager.chartManager.loadedChart.getBeatFromSeconds(this.manager.chartManager.chartAudio.getSongLength()),this.skipEnd.blur()},xe.createKeybindTooltip(this.skipEnd)`Skip to end ${"jumpSongEnd"}`,this.play=document.createElement("button"),this.play.tabIndex=-1;const r=me.getIcon("PLAY",40);this.play.appendChild(r),this.playIcon=r;const s=me.getIcon("STOP",32);this.play.appendChild(s),this.stopIcon=s,this.stopIcon.style.display="none",this.play.onclick=()=>{(this.manager.chartManager.getMode()==q.Record||this.manager.chartManager.getMode()==q.Play)&&this.manager.chartManager.setMode(q.Edit),this.manager.chartManager.playPause(),this.play.blur()},xe.createKeybindTooltip(this.play)`Play/Pause ${"playback"}`,this.record=document.createElement("button"),this.record.tabIndex=-1;const o=me.getIcon("RECORD",36,void 0,"red");this.record.appendChild(o),this.record.onclick=()=>{this.manager.chartManager.setMode(q.Record),this.record.blur()},xe.createKeybindTooltip(this.record)`Record ${"recordMode"}`,(he.viewMode||!he.recordMode)&&(this.record.style.display="none"),this.playtest=document.createElement("button"),this.playtest.tabIndex=-1;const l=me.getIcon("PLAYTEST",30);this.playtest.appendChild(l),this.playtest.onclick=()=>{this.manager.chartManager.setMode(q.Play),this.playtest.blur()},xe.createKeybindTooltip(this.playtest)`Playtest ${"playMode"}`,he.playMode||(this.playtest.style.display="none");const u=document.createElement("div");u.classList.add("playback-separator"),this.timeCounter=document.createElement("div"),this.timeCounter.classList.add("playback-counter");const f=document.createElement("div");f.style.display="flex",f.classList.add("playback-counter-main");const c=document.createElement("div");c.classList.add("inlineEdit"),c.innerText="00",c.spellcheck=!1,c.contentEditable="true",c.style.maxWidth=`${27/16}rem`,c.onkeydown=S=>{S.key=="Enter"&&c.blur(),S.key=="Escape"&&(c.innerText=Math.floor(Math.abs(this.manager.chartManager.time)/60).toString().padStart(2,"0"),c.blur())},c.onfocus=()=>setTimeout(()=>this.selectText(c),25),c.onblur=()=>this.updateTime(),c.ondragstart=S=>S.preventDefault();const d=document.createElement("div");d.classList.add("inlineEdit"),d.innerText="00",d.spellcheck=!1,d.contentEditable="true",d.style.maxWidth=`${18/16}rem`,d.onkeydown=S=>{S.key=="Enter"&&d.blur(),S.key=="Escape"&&(d.innerText=Math.floor(Math.abs(this.manager.chartManager.time)%60).toString().padStart(2,"0"),d.blur())},d.onfocus=()=>setTimeout(()=>this.selectText(d),25),d.onblur=()=>this.updateTime(),d.ondragstart=S=>S.preventDefault();const h=document.createElement("div");h.classList.add("inlineEdit"),h.innerText="000",h.spellcheck=!1,h.contentEditable="true",h.style.maxWidth=`${27/16}rem`,h.onkeydown=S=>{S.key=="Enter"&&h.blur(),S.key=="Escape"&&(h.innerText=(ue(Math.abs(this.manager.chartManager.time)%1,3)*1e3).toString().padStart(3,"0"),h.blur())},h.onfocus=()=>setTimeout(()=>this.selectText(h),25),h.onblur=()=>this.updateTime(),h.ondragstart=S=>S.preventDefault(),this.min=c,this.sec=d,this.millis=h;const p=document.createElement("div");p.classList.add("playback-counter-label"),p.innerText="Time",f.appendChild(c),f.appendChild(document.createTextNode(":")),f.appendChild(d),f.appendChild(document.createTextNode(".")),f.appendChild(h),this.timeCounter.appendChild(f),this.timeCounter.appendChild(p);const m=document.createElement("div");m.classList.add("playback-separator"),this.beatCounter=document.createElement("div"),this.beatCounter.classList.add("playback-counter");const g=document.createElement("div");g.style.display="flex",g.classList.add("playback-counter-main");const b=document.createElement("div");b.classList.add("inlineEdit"),b.innerText="0.000",b.spellcheck=!1,b.contentEditable="true",b.onkeydown=S=>{if(S.key=="Enter"&&b.blur(),S.key=="Escape"){if(this.beatDropdown.value=="Measure"){const $=this.manager.chartManager.loadedChart?.timingData?.getMeasure(this.manager.chartManager.beat)??this.manager.chartManager.beat/4;b.innerText=ue($,3).toFixed(3)}else b.innerText=ue(this.manager.chartManager.beat,3).toFixed(3);b.blur()}},b.onfocus=()=>{setTimeout(()=>this.selectText(b),25)},b.onblur=()=>this.updateBeat(),b.ondragstart=S=>S.preventDefault(),this.beat=b,this.beatDropdown=hi.create(["Beat","Measure"],"Beat"),this.beatDropdown.view.querySelector(".dropdown-selected").classList.add("playback-counter-label"),this.beatCounter.appendChild(g),g.appendChild(b),this.beatCounter.appendChild(this.beatDropdown.view),this.beatDropdown.onChange(()=>{if(this.beatDropdown.value=="Measure"){const S=this.manager.chartManager.loadedChart?.timingData?.getMeasure(this.manager.chartManager.beat)??this.manager.chartManager.beat/4;b.innerText=ue(S,3).toFixed(3)}else b.innerText=ue(this.manager.chartManager.beat,3).toFixed(3)}),this.playbackBar.appendChild(this.skipStart),this.playbackBar.appendChild(this.skipEnd),this.playbackBar.appendChild(this.play),this.playbackBar.appendChild(this.record),this.playbackBar.appendChild(this.playtest),this.playbackBar.appendChild(u),this.playbackBar.appendChild(this.timeCounter),this.playbackBar.appendChild(m),this.playbackBar.appendChild(this.beatCounter),this.editSteps=document.createElement("button"),this.editSteps.tabIndex=-1,this.editSteps.classList.add("edit-fancy-button");const x=me.getIcon("FEET",24);x.style.marginBottom=`${2/16}rem`,this.editSteps.appendChild(x),this.editSteps.appendChild(document.createTextNode("Edit Steps")),this.editSteps.onclick=()=>{this.manager.chartManager.editTimingMode=ke.Off,this.editSteps.blur()},this.editSteps.classList.add("active"),this.editTiming=document.createElement("button"),this.editTiming.tabIndex=-1,this.editTiming.classList.add("edit-fancy-button");const w=me.getIcon("METRONOME",24);w.style.marginBottom=`${2/16}rem`,this.editTiming.appendChild(w),this.editTiming.appendChild(document.createTextNode("Edit Timing")),this.editTiming.onclick=()=>{this.manager.chartManager.editTimingMode=ke.Edit,this.editTiming.blur()};const E=document.createElement("div");E.classList.add("playback-separator");const C=document.createElement("div");C.classList.add("edit-bar-left"),C.appendChild(this.editSteps),C.appendChild(this.editTiming),C.appendChild(E),this.editBar.appendChild(C),this.editChoiceContainer=document.createElement("div"),this.editChoiceContainer.classList.add("edit-choice-container"),this.stepsContainer=document.createElement("div"),this.stepsContainer.classList.add("edit-steps-container"),this.timingContainer=document.createElement("div"),this.timingContainer.classList.add("edit-timing-container"),this.editChoiceContainer.appendChild(this.stepsContainer),this.editChoiceContainer.appendChild(this.timingContainer),this.addTimingEvent=document.createElement("button"),this.addTimingEvent.tabIndex=-1;const B=me.getIcon("ADD_EVENT",32);this.addTimingEvent.appendChild(B),this.addTimingEvent.onclick=()=>{this.manager.chartManager.editTimingMode==ke.Add?this.manager.chartManager.editTimingMode=ke.Edit:this.manager.chartManager.editTimingMode=ke.Add,this.addTimingEvent.blur()},this.timingContainer.appendChild(this.addTimingEvent),xe.createKeybindTooltip(this.addTimingEvent)`Add timing events ${"toggleAddTiming"}`;const D=document.createElement("div");D.classList.add("playback-separator"),this.timingContainer.appendChild(D),this.splitTiming=document.createElement("button"),this.splitTiming.tabIndex=-1;const O=me.getIcon("SPLIT_TIMING",32);this.splitTiming.appendChild(O),this.splitTiming.onclick=()=>{ys.active?ys.close():ys.open(this.manager.app),this.splitTiming.blur()},this.splitTiming.id="split-timing",this.timingContainer.appendChild(this.splitTiming),Xe(this.splitTiming,{content:"Manage split timing"}),this.toggleTimingTracks=document.createElement("button"),this.toggleTimingTracks.tabIndex=-1;const H=me.getIcon("EYE",32);this.toggleTimingTracks.appendChild(H),this.toggleTimingTracks.onclick=()=>{ws.active?ws.close():ws.open(),this.toggleTimingTracks.blur()},this.toggleTimingTracks.id="toggle-tracks",this.timingContainer.appendChild(this.toggleTimingTracks),Xe(this.toggleTimingTracks,{content:"Toggle timing track visibility"}),this.detectSync=document.createElement("button"),this.detectSync.tabIndex=-1;const Y=me.getIcon("DETECT_SYNC",32);this.detectSync.appendChild(Y),this.detectSync.onclick=()=>{this.manager.app.windowManager.openWindow(new Ou(this.manager.app)),this.detectSync.blur()},this.detectSync.id="detect-sync",this.timingContainer.appendChild(this.detectSync),xe.createKeybindTooltip(this.detectSync)`Detect audio sync ${"detectSync"}`;const ae=document.createElement("div");ae.classList.add("playback-separator"),this.timingContainer.appendChild(ae),this.offsetCounter=document.createElement("div"),this.offsetCounter.classList.add("playback-counter");const M=document.createElement("div");M.classList.add("playback-counter-label"),M.innerText="Offset";const P=document.createElement("div");P.classList.add("playback-counter-main","inlineEdit"),P.innerText="0.000",P.spellcheck=!1,P.contentEditable="true",P.onkeydown=S=>{S.key=="Enter"&&P.blur(),S.key=="Escape"&&(P.innerText=ue(this.manager.chartManager.loadedChart?.timingData.getOffset()??0,3).toFixed(3),P.blur())},P.tabIndex=-1,P.onfocus=()=>{setTimeout(()=>this.selectText(P),25)},P.onblur=()=>this.updateOffset(),P.ondragstart=S=>S.preventDefault(),this.offset=P,this.offsetCounter.appendChild(P),this.offsetCounter.appendChild(M),this.timingContainer.appendChild(this.offsetCounter),this.editBar.appendChild(this.editChoiceContainer);const v=document.createElement("div");v.classList.add("note-placeholder-right"),this.stepsContainer.appendChild(v),re.on("resize",()=>{this.trackingMovement=!0,this.idleFrames=5}),re.on("noteskinLoaded",()=>{this.stepsContainer.replaceChildren(),this.noteArrows.forEach($=>{this.removeChild($.sprite),this.removeChild($.bg),this.removeChild($.highlight)}),this.noteArrows=[];const S=document.createElement("div");if(S.classList.add("note-placeholder-right"),this.stepsContainer.appendChild(S),!!this.manager.chartManager.loadedChart){for(const $ of this.manager.chartManager.loadedChart.gameType.editNoteTypes){if(id.includes($))continue;const L=this.manager.chartManager.chartView.getNotefield().createNote({type:$,beat:0,col:0,quant:4,second:0,warped:!1,fake:!1});L.scale.set(.5);const W=new Ae(Ce.WHITE);ze(W,"widget-bg"),W.width=48,W.height=48,W.anchor.set(.5);const V=new dt("noBorder");V.alpha=0,V.width=48,V.height=48,V.pivot.x=24,V.pivot.y=24;const J=document.createElement("button");J.tabIndex=-1,J.style.height="3rem",J.style.width="3rem",J.classList.add("note-placeholder"),J.onclick=()=>{this.manager.chartManager.setEditingNoteType($),J.blur()},xe.createKeybindTooltip(J)`${"\\"+$} ${"noteType"+$}`;const N={element:J,sprite:L,type:$,bg:W,highlight:V,hovered:!1};J.onmouseover=()=>{N.hovered=!0},J.onmouseleave=()=>{N.hovered=!1},this.addChild(W),this.addChild(L),this.addChild(V);const R=J.getBoundingClientRect();L.position.y=R.top-this.manager.app.view.clientHeight/2-this.manager.app.view.getBoundingClientRect().top+24,L.position.x=R.left-this.manager.app.view.clientWidth/2+24,W.position=L.position,this.noteArrows.push(N)}this.stepsContainer.replaceChildren(...this.noteArrows.map($=>$.element),S),this.trackingMovement=!0,this.idleFrames=5}}),this.noteArrowMask=new Ae(Ce.WHITE),this.noteArrowMask.height=48,this.noteArrowMask.width=2500,this.noteArrowMask.anchor.y=1,this.noteArrowMask.anchor.x=.5,this.addChild(this.noteArrowMask),this.mask=this.noteArrowMask,t.onmouseenter=()=>{this.lastHover=Date.now(),this.hovering=!0,this.view.style.opacity="",this.view.style.transition=""},t.onmouseleave=()=>this.hovering=!1,t.appendChild(this.playbackBar),t.appendChild(this.editBar),this.view=t,t.style.display="none"}update(){this.view.style.display=this.manager.chartManager.loadedSM&&he.status&&!this.manager.app.capturing?"":"none",this.scale.set(1/this.manager.chartManager.app.stage.scale.x);const e=this.manager.chartManager.time;this.lastTime!=e&&(document.activeElement!=this.min&&(this.min.innerText=(e<0?"-":"")+Math.floor(Math.abs(e)/60).toString().padStart(2,"0")),document.activeElement!=this.sec&&(this.sec.innerText=Math.floor(Math.abs(e)%60).toString().padStart(2,"0")),document.activeElement!=this.millis&&(this.millis.innerText=(ue(Math.abs(e)%1,3)*1e3).toString().padStart(3,"0")),this.lastTime=e);const t=this.manager.chartManager.beat;if(this.lastBeat!=t){if(document.activeElement!=this.beat)if(this.beatDropdown.value=="Measure"){const c=this.manager.chartManager.loadedChart?.timingData?.getMeasure(t)??t/4;this.beat.innerText=ue(c,3).toFixed(3)}else this.beat.innerText=ue(t,3).toFixed(3);this.lastBeat=t}const n=this.manager.chartManager.loadedChart?.timingData.getOffset()??0;this.lastOffset!=n&&document.activeElement!=this.offset&&(this.offset.innerText=ue(n,3).toFixed(3));const a=this.manager.chartManager.getMode(),r=this.manager.chartManager.editTimingMode;if(this.lastMode!=a){switch(a){case q.Edit:this.skipStart.disabled=!1,this.skipEnd.disabled=!1,this.record.disabled=!1,this.playtest.disabled=!1,this.min.contentEditable="true",this.sec.contentEditable="true",this.millis.contentEditable="true",this.beat.contentEditable="true",this.offset.contentEditable="true",this.record.style.background="",this.playtest.style.background="",this.view.style.opacity="",this.view.style.transition="",this.view.classList.remove("collapsed"),this.beatDropdown.disabled=!1;break;case q.Record:this.lastHover=Date.now(),this.skipStart.disabled=!0,this.skipEnd.disabled=!0,this.record.disabled=!1,this.record.style.background="rgba(170, 0, 0, 0.35)",this.playtest.disabled=!0,this.min.contentEditable="false",this.sec.contentEditable="false",this.millis.contentEditable="false",this.beat.contentEditable="false",this.offset.contentEditable="false",r!=ke.Off&&(this.visible=!1),this.view.classList.add("collapsed"),this.beatDropdown.closeDropdown(),this.beatDropdown.disabled=!0;break;case q.Play:this.lastHover=Date.now(),this.skipStart.disabled=!0,this.skipEnd.disabled=!0,this.record.disabled=!0,this.playtest.disabled=!1,this.playtest.style.background="rgba(12, 97, 31, 0.35)",this.min.contentEditable="false",this.sec.contentEditable="false",this.millis.contentEditable="false",this.beat.contentEditable="false",this.offset.contentEditable="false",r!=ke.Off&&(this.visible=!1),this.view.classList.add("collapsed"),this.beatDropdown.closeDropdown(),this.beatDropdown.disabled=!0;break;case q.View:this.lastHover=Date.now(),this.skipStart.disabled=!1,this.skipEnd.disabled=!1,this.record.disabled=!0,this.playtest.disabled=!1,this.min.contentEditable="true",this.sec.contentEditable="true",this.millis.contentEditable="true",this.beat.contentEditable="true",this.offset.contentEditable="true",r!=ke.Off&&(this.visible=!1),this.view.classList.add("collapsed"),this.beatDropdown.closeDropdown(),this.beatDropdown.disabled=!0}this.trackingMovement=!0,this.idleFrames=5,this.lastMode=a}if(this.lastTimingMode!=r){switch(r){case ke.Off:this.visible=!0,this.stepsContainer.style.transform="",this.timingContainer.style.transform="",this.editSteps.classList.add("active"),this.editTiming.classList.remove("active"),this.offset.tabIndex=-1;break;case ke.Add:this.addTimingEvent.classList.add("active");break;case ke.Edit:this.addTimingEvent.classList.remove("active"),this.offset.tabIndex=0}(this.lastTimingMode==ke.Off&&r!=ke.Off||this.lastTimingMode!=ke.Off&&r==ke.Off)&&this.manager.chartManager.clearSelections(),this.trackingMovement=!0,this.idleFrames=5,this.lastTimingMode=r,this.stepsContainer.style.transform=r==ke.Off?"":"translateY(-3rem)",this.timingContainer.style.transform=r==ke.Off?"":"translateY(-3rem)",this.editSteps.classList.toggle("active",r==ke.Off),this.editTiming.classList.toggle("active",r!=ke.Off)}const s=this.manager.chartManager.chartAudio.isPlaying();if(this.lastPlaying!=s&&(this.playIcon.style.display=s?"none":"",this.stopIcon.style.display=s?"":"none",this.lastPlaying=s),(a==q.Play||a==q.Record)&&this.view.style.opacity==""&&!this.hovering&&Date.now()-this.lastHover>3e3&&(this.view.style.opacity="0.2",this.view.style.transition="2s cubic-bezier(.11,.72,.51,1.14)"),this.trackingMovement){let c=48;const d=this.noteArrows[0];if(d){const p=d.element.getBoundingClientRect();c=p.width,this.noteArrows.forEach((m,g)=>{m.sprite.position.y=p.top-this.manager.app.view.clientHeight/2-this.manager.app.view.getBoundingClientRect().top+c/2,m.sprite.position.x=p.left-this.manager.app.view.clientWidth/2+c/2+g*c,m.sprite.scale.set(c/96),m.bg.width=c,m.bg.height=c,m.bg.position=m.sprite.position,m.highlight.width=c,m.highlight.height=c,m.highlight.position=m.sprite.position,m.highlight.pivot.set(c/2)}),this.lastBounds&&Math.abs(this.lastBounds.top-p.top)+Math.abs(this.lastBounds.left-p.left)==0&&(this.idleFrames--,this.idleFrames<0&&(this.trackingMovement=!1,this.lastBounds=void 0,r!=ke.Off&&(this.visible=!1))),this.lastBounds=p}const h=this.view.getBoundingClientRect();this.noteArrowMask.y=h.bottom-this.manager.app.view.clientHeight/2-this.manager.app.view.getBoundingClientRect().top,this.noteArrowMask.height=c}const o=this.manager.chartManager.getEditingNoteType(),l=Fe.getColor("editable-overlay-hover"),u=Fe.getColor("editable-overlay-active"),f=new F(l).setAlpha(0);this.noteArrows.forEach(c=>{let d=o==c.type?u:c.hovered?l:f;y.general.smoothAnimations&&(d=new F(jt(new F(c.highlight.tint).setAlpha(c.highlight.alpha),d,.3))),c.highlight.tint=d.toNumber(),c.highlight.alpha=d.alpha})}selectText(e){const t=window.getSelection(),n=document.createRange();!t||!n||(n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n))}updateTime(){this.millis.innerText=this.millis.innerText.padEnd(3,"0").slice(0,3);const e=this.parseString(this.min),t=this.parseString(this.sec),n=this.parseString(this.millis);if(e===null||t===null||n===null){this.lastTime=null;return}let a=e*60+t+n/1e3;a>9999999&&(a=9999999),a<0&&(a=0),this.manager.chartManager.time=a,this.lastTime=null}updateBeat(){let e=this.parseString(this.beat);if(e===null){this.lastBeat=null;return}this.beatDropdown.value=="Measure"&&(e=this.manager.chartManager.loadedChart?.timingData?.getBeatFromMeasure(e)??e*4),e>9999999&&(e=9999999),e<0&&(e=0),this.manager.chartManager.beat=e,this.lastBeat=null}updateOffset(){let e=this.parseString(this.offset);if(e===null){this.lastOffset=null;return}e>9999999&&(e=9999999),e<-9999999&&(e=-9999999),this.lastOffset=null,!(!this.manager.chartManager.loadedChart||!this.manager.chartManager.loadedSM)&&(this.manager.chartManager.loadedChart.timingData.hasChartOffset()?this.manager.chartManager.loadedChart.timingData:this.manager.chartManager.loadedSM.timingData).setOffset(e)}parseString(e){try{const t=Mc.evaluate(e.innerText);return isFinite(t)?t:0}catch{return null}}}class Fm extends fe{app;chartManager;children=[];constructor(e){super(),this.app=e.app,this.chartManager=e,this.addChild(new Tm(this)),this.addChild(new Mm(this)),this.addChild(new Bm(this)),this.addChild(new ji(this)),this.addChild(new Am(this)),this.addChild(new Lm(this)),this.addChild(new wm(this)),this.addChild(new Cm(this)),this.zIndex=2}update(){this.children.forEach(e=>e.update())}startPlay(){this.children.forEach(e=>e.startPlay())}endPlay(){this.children.forEach(e=>e.endPlay())}}const Ns=Array(85).fill(void 0).map((i,e)=>33+e),Wu=[];for(const i of Ns)for(const e of Ns)Wu.push([i,e]);const Hs="<~".split("").map(i=>i.charCodeAt(0)),zs="~>".split("").map(i=>i.charCodeAt(0));function Im(i,e,t,n=!1,a=!1,r=!1){let s;typeof i=="string"?s=i.split("").map(c=>c.charCodeAt(0)):s=[...new Uint8Array(i)];const o=4-s.length%4;for(let c=0;c<o;c++)s.push(0);const l=new Uint8Array(s),u=new DataView(l.buffer);let f=[];for(let c=0;c<s.length;c+=4){const d=u.getUint32(c);a&&!d?f.push(122):r&&d==538976288?f.push(121):(f=f.concat(t[Math.floor(d/614125)],t[Math.floor(d/85)%7225]),f.push(e[d%85]))}if(o&&!n){if(f.at(-1)==122){f.pop();for(let c=0;c<5;c++)f.push(e[0])}for(let c=0;c<o;c++)f.pop()}return f}function _o(i,e=!1,t=!1,n=!1){let a=Im(i,Ns,Wu,t,!0,e);return n&&(a=Hs.concat(a).concat(zs)),a}function Eo(i,e=!1,t=` 	
\r\v`){let n;if(typeof i=="string"?n=i.split("").map(o=>o.charCodeAt(0)):n=[...new Uint8Array(i)],e){if(n.at(-1)!=zs.at(-1)||n.at(-2)!=zs.at(-2))return!1;n.at(0)==Hs.at(0)&&n.at(1)==Hs.at(1)?n=n.slice(2,-2):n=n.slice(void 0,-2)}for(let o=0;o<4;o++)n.push(117);let a=[],r=[];for(const o of n)if(o>=33&&117>=o){if(r.push(o),r.length==5){let l=0;for(const u of r)l=85*l+(u-33);if(l>2**32-1)return!1;a.push(l>>24&255),a.push(l>>16&255),a.push(l>>8&255),a.push(l&255),r=[]}}else if(o==122){if(r.length!=0)return!1;a.push(0),a.push(0),a.push(0),a.push(0)}else if(o==121){if(r.length!=0)return!1;a.push(32),a.push(32),a.push(32),a.push(32)}else if(!t.includes(String.fromCharCode(o)))return!1;const s=4-r.length;return s&&(a=a.slice(void 0,-s)),a}function zt(i){let e=0,t=0,n=129;for(;(n&128)!=0;){const a=i.shift();if(!a)break;e=e|(a&127)<<7*t++,n=a}return e}function Vt(i){const e=[];let t=!1;for(;!t;){let n=i&127;i=i>>7,t=i==0,t||(n=n|128),e.push(n)}return e}const Rm=["Hold","Mine","Roll","Lift","Fake"];function Pm(i){if(i.startsWith("ArrowVortex:notes:")){const e=Eo(i.slice(18));if(e!==!1){const t=Array.from(e);if(t.shift()!=0)return;const n=zt(t),a=[];for(let r=0;r<n;r++){const s=t.shift();if(s==null)return;const o=s&127;if((s&128)!=0){const l=zt(t),u=zt(t),f=t.shift();if(f==null||f>4)continue;const c=Rm[f];if(l==u){if(c=="Hold"||c=="Roll")continue;a.push({type:c,beat:l/48,col:o})}else{if(c=="Mine"||c=="Fake"||c=="Lift")continue;a.push({type:c,beat:l/48,hold:(u-l)/48,col:o})}}else a.push({type:"Tap",beat:zt(t)/48,col:o})}return a}}}function Om(i){const e=[0];e.push(...Vt(i.length));for(const t of i)if(t.type=="Tap"){const n=Math.round(t.beat*48);e.push(t.col),e.push(...Vt(n))}else{e.push(t.col+128);const n=Math.round(t.beat*48);let a=0;Oe(t)&&(a=t.hold);const r=Math.round(a*48)+n;e.push(...Vt(n)),e.push(...Vt(r)),e.push(["Hold","Mine","Roll","Lift","Fake"].indexOf(t.type))}return"ArrowVortex:notes:"+_o(e).map(t=>String.fromCharCode(t)).join("")}const Ja=["BPMS","STOPS","DELAYS","WARPS","TIMESIGNATURES","TICKCOUNTS","COMBOS","SPEEDS","SCROLLS","FAKES","LABELS","ATTACKS","BGCHANGES","FGCHANGES"];function vi(i){const e=new ArrayBuffer(4);return new DataView(e).setUint32(0,i,!0),Array.from(new Uint8Array(e))}function xi(i){const e=new Uint8Array(i.splice(0,4));return new DataView(e.buffer).getUint32(0,!0)}function Bi(i){const e=new ArrayBuffer(8);return new DataView(e).setFloat64(0,i,!0),Array.from(new Uint8Array(e))}function Fi(i){const e=new Uint8Array(i.splice(0,8)),t=new DataView(e.buffer);return ue(t.getFloat64(0,!0),3)}function Nm(i){return[i.length,...i.split("").map(e=>e.charCodeAt(0))]}function Hm(i){const e=i.shift();if(!e)return"";let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(i.shift());return t}function _i(i){return Vt(i.length).concat(i.split("").map(e=>e.charCodeAt(0)))}function Ei(i){const e=zt(i);if(!e)return"";let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(i.shift());return t}function zm(i){return i.some(e=>{if(e.type=="ATTACKS"||e.type=="BGCHANGES"||e.type=="FGCHANGES")return!0;const t=Math.round(e.beat*48)/48;if(Math.abs(t-e.beat)>5e-4)return!0;if(e.type=="FAKES"||e.type=="WARPS"){const n=Math.round(e.value*48)/48;if(Math.abs(n-e.value)>5e-4)return!0}return e.type=="LABELS"&&e.value.length>255||e.type=="TIMESIGNATURES"&&(e.upper>2**32-1||e.lower>2**32-1)||e.type=="COMBOS"&&(e.hitMult>2**32-1||e.missMult>2**32-1)?!0:e.type=="TICKCOUNTS"&&e.value>2**32-1})?Um(i):Vm(i)}function Vm(i){const e=[],t=new Map;i.forEach(n=>{t.has(n.type)||t.set(n.type,[]),t.get(n.type)?.push(n)});for(const[n,a]of t.entries())if(!(n=="ATTACKS"||n=="BGCHANGES"||n=="FGCHANGES")){e.push(a.length),e.push(Ja.indexOf(n));for(const r of a)switch(e.push(...vi(Math.round(r.beat*48))),r.type){case"BPMS":case"STOPS":case"DELAYS":case"SCROLLS":e.push(...Bi(r.value));break;case"FAKES":case"WARPS":e.push(...vi(Math.round(r.value*48)));break;case"TIMESIGNATURES":e.push(...vi(Math.round(r.upper))),e.push(...vi(Math.round(r.lower)));break;case"COMBOS":e.push(...vi(Math.round(r.hitMult))),e.push(...vi(Math.round(r.missMult)));break;case"TICKCOUNTS":e.push(...vi(Math.round(r.value)));break;case"SPEEDS":e.push(...Bi(r.value)),e.push(...Bi(r.delay)),e.push(...vi(r.unit=="B"?0:1));break;case"LABELS":e.push(...Nm(r.value))}}return e.push(0),"ArrowVortex:tempo:"+_o(e).map(n=>String.fromCharCode(n)).join("")}function Um(i){const e=[],t=new Map;i.forEach(n=>{t.has(n.type)||t.set(n.type,[]),t.get(n.type)?.push(n)});for(const[n,a]of t.entries()){e.push(...Vt(a.length)),e.push(Ja.indexOf(n));for(const r of a)switch(e.push(...Vt(Math.round((r.type=="ATTACKS"?r.second:r.beat)*1e3))),r.type){case"BPMS":case"STOPS":case"DELAYS":case"SCROLLS":case"FAKES":case"WARPS":e.push(...Bi(r.value));break;case"TIMESIGNATURES":e.push(...Vt(Math.round(r.upper))),e.push(...Vt(Math.round(r.lower)));break;case"COMBOS":e.push(...Vt(Math.round(r.hitMult))),e.push(...Vt(Math.round(r.missMult)));break;case"TICKCOUNTS":e.push(...Vt(Math.round(r.value)));break;case"SPEEDS":e.push(...Bi(r.value)),e.push(...Bi(r.delay)),e.push(r.unit=="B"?0:1);break;case"LABELS":e.push(..._i(r.value));break;case"ATTACKS":e.push(...Bi(r.value)),e.push(r.endType=="LEN"?0:1),e.push(..._i(r.mods));break;case"BGCHANGES":case"FGCHANGES":e.push((r.crossFade?1:0)+((r.stretchRewind?1:0)<<1)+((r.stretchNoLoop?1:0)<<2)),e.push(..._i(r.file)),e.push(...Bi(r.updateRate)),e.push(..._i(r.effect)),e.push(..._i(r.file2)),e.push(..._i(r.transition)),e.push(..._i(r.color1)),e.push(..._i(r.color2))}}return"SMEditor:tempo:"+_o(e).map(n=>String.fromCharCode(n)).join("")}function Wm(i){if(i.startsWith("SMEditor:tempo:"))return qm(i);if(i.startsWith("ArrowVortex:tempo:"))return Gm(i)}function Gm(i){if(!i.startsWith("ArrowVortex:tempo:"))return;const e=Eo(i.slice(18)),t=[];if(e===!1)return;const n=Array.from(e);try{for(;;){const a=n.shift();if(a===void 0)return;if(a==0)break;const r=n.shift();if(r===void 0)return;const s=Ja[r];for(let o=0;o<a;o++){const l=xi(n)/48;switch(s){case"BPMS":case"STOPS":case"DELAYS":case"SCROLLS":t.push({type:s,beat:l,value:Fi(n)});break;case"FAKES":case"WARPS":t.push({type:s,beat:l,value:xi(n)/48});break;case"TIMESIGNATURES":t.push({type:s,beat:l,upper:xi(n),lower:xi(n)});break;case"COMBOS":t.push({type:s,beat:l,hitMult:xi(n),missMult:xi(n)});break;case"TICKCOUNTS":t.push({type:s,beat:l,value:xi(n)});break;case"SPEEDS":t.push({type:s,beat:l,value:Fi(n),delay:Fi(n),unit:xi(n)==1?"T":"B"});break;case"LABELS":t.push({type:s,beat:l,value:Hm(n)})}}}}catch{return}return t}function qm(i){if(!i.startsWith("SMEditor:tempo:"))return;const e=Eo(i.slice(15)),t=[];if(e===!1)return;const n=Array.from(e);try{for(;;){const a=zt(n);if(a===void 0)return;if(a==0)break;const r=n.shift();if(r===void 0)return;const s=Ja[r];for(let o=0;o<a;o++){const l=zt(n)/1e3;switch(s){case"BPMS":case"STOPS":case"DELAYS":case"SCROLLS":case"FAKES":case"WARPS":t.push({type:s,beat:l,value:Fi(n)});break;case"TIMESIGNATURES":t.push({type:s,beat:l,upper:zt(n),lower:zt(n)});break;case"COMBOS":t.push({type:s,beat:l,hitMult:zt(n),missMult:zt(n)});break;case"TICKCOUNTS":t.push({type:s,beat:l,value:zt(n)});break;case"SPEEDS":t.push({type:s,beat:l,value:Fi(n),delay:Fi(n),unit:n.shift()==0?"B":"T"});break;case"LABELS":t.push({type:s,beat:l,value:Ei(n)});break;case"ATTACKS":t.push({type:s,second:l,value:Fi(n),endType:n.shift()==0?"LEN":"END",mods:Ei(n)});break;case"BGCHANGES":case"FGCHANGES":{const u=n.shift();t.push({type:s,beat:l,file:Ei(n),updateRate:Fi(n),crossFade:(u&1)>0,stretchRewind:(u&2)>0,stretchNoLoop:(u&4)>0,effect:Ei(n),file2:Ei(n),transition:Ei(n),color1:Ei(n),color2:Ei(n)})}}}}}catch{return}return t}let jm=class Gu extends AudioBufferSourceNode{started=!1;start(e,t,n){this.started||super.start(e,t,n),this.started=!0}stop(e){this.started&&super.stop(e),this.started=!1}static create(e){const t=e;return t.started=!1,Object.setPrototypeOf(t,Gu.prototype),t}};class vs{_gainNode;_audioContext=new AudioContext;_sources=[];_rate=1;_buffer;_volume=1;_destroyed=!1;loaded;constructor(e){this._gainNode=this._audioContext.createGain(),this._gainNode.connect(this._audioContext.destination),e.volume!==void 0&&this.volume(e.volume),e.rate!==void 0&&this.rate(e.rate),this._buffer=this._audioContext.createBuffer(2,1,44100),this.loaded=new Promise(t=>{fetch(e.src).then(n=>n.arrayBuffer()).then(n=>this.decodeData(n)).then(n=>{n&&(this._buffer=n)}).catch(n=>{de.createFormatted("Failed to load sound effect: "+n.message,"error")}).finally(()=>{t()})})}destroy(){this._destroyed||(this.stop(),this._buffer=this._audioContext.createBuffer(2,1,44100),this._destroyed=!0)}async decodeData(e){return new Promise((t,n)=>{if(!e){t();return}(async()=>{try{t(await this._audioContext.decodeAudioData(e))}catch(a){n(a)}})()})}volume(e){this._destroyed||this._volume!=e&&(this._volume=e,this._gainNode.gain.setValueAtTime(e,this._audioContext.currentTime))}rate(e){if(!this._destroyed&&this._rate!=e){this._rate=e;for(const t of this._sources)t.playbackRate.value=e}}play(e){if(this._destroyed)return;const t=jm.create(this._audioContext.createBufferSource());t.buffer=this._buffer,t.connect(this._gainNode),this._gainNode.connect(this._audioContext.destination),t.start(e+this._audioContext.currentTime,0),t.playbackRate.value=this._rate,this._sources.push(t),t.onended=()=>{t.disconnect(),this._sources=this._sources.filter(n=>n!=t)}}stop(){if(!this._destroyed){for(const e of this._sources)e.stop(),e.disconnect();this._sources=[]}}getBuffer(){return this._buffer}}class Vs{static menuElement;static closeTimeout;static open(e,t){e.chartManager.getMode()!=q.View&&(this.buildMenu(e),this.menuElement.style.display="none",setTimeout(()=>this.fitContextMenu(t)),this.menuElement.classList.add("entering"),clearTimeout(this.closeTimeout),setTimeout(()=>this.menuElement?.classList.remove("entering"),300),this.menuElement.style.left=t.clientX+"px",this.menuElement.style.top=t.clientY+"px")}static fitContextMenu(e){this.menuElement.style.display="";const t=this.menuElement.getBoundingClientRect(),n=window.innerHeight-t.bottom-20,a=window.innerWidth-t.right-20;n<0&&(this.menuElement.style.top=e.clientY+n+"px"),a<0&&(this.menuElement.style.left=e.clientX+a+"px"),this.menuElement.style.transformOrigin=`${Math.max(0,-a)}px ${Math.max(0,-n)}px`}static close(){this.menuElement&&(this.menuElement.classList.add("exiting"),this.closeTimeout=setTimeout(()=>this.menuElement.replaceChildren(),300))}static buildMenu(e){const t=document.createElement("div");if(t.appendChild(this.createElement(e,{type:"selection",id:"cut"})),t.appendChild(this.createElement(e,{type:"selection",id:"copy"})),t.appendChild(this.createElement(e,{type:"selection",id:"paste"})),t.appendChild(this.createElement(e,{type:"selection",id:"pasteReplace"})),e.chartManager.getMode()==q.Edit&&e.chartManager.hasNoteSelection()){const n=document.createElement("div");n.classList.add("separator"),t.appendChild(n),cn.selection.options.slice(0,-4).forEach(a=>{t.appendChild(this.createElement(e,a))})}this.menuElement=t,t.id="context-menu",document.getElementById("context-menu")?.replaceWith(this.menuElement)}static createElement(e,t){if(t.type=="separator"){const n=document.createElement("div");return n.classList.add("separator"),n}if(t.type=="selection"||t.type=="checkbox"||t.type=="dropdown"){const n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div");let s;if(t.type=="selection"||t.type=="checkbox"){const o=We[t.id];s=document.createElement("div"),s.innerText=xe.getKeybindString(t.id),s.classList.add("keybind","unselectable"),r.innerText=o?.label??t.id;let l=o?.disabled??!0;typeof l=="function"&&(l=l(e)),l&&n.classList.add("disabled"),n.addEventListener("click",()=>{l||(o?.callback(e),this.close())})}else s=me.getIcon("CHEVRON",16),s.style.transform="rotate(-90deg)",r.innerText=typeof t.title=="function"?t.title(e):t.title;if(a.appendChild(r),a.appendChild(s),n.appendChild(a),n.classList.add("menu-item"),a.classList.add("menu-item-title","menu-hover"),r.classList.add("title","unselectable"),t.type=="dropdown"){const o=document.createElement("div");n.appendChild(o),o.classList.add("menubar-dropdown"),t.options.map(l=>this.createElement(e,l)).forEach(l=>o.appendChild(l))}if(t.type=="checkbox"){let o=t.checked;typeof o=="function"&&(o=o(e)),o&&(r.innerText="✓ "+r.innerText)}return n}if(t.type=="menu"){const n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div");return n.appendChild(a),a.innerText=t.title,n.appendChild(r),a.classList.add("title","unselectable"),n.classList.add("menu-item","menu-main"),a.classList.add("menu-hover"),r.classList.add("menubar-dropdown","unselectable"),n.onmouseenter=()=>{r.replaceChildren(...t.options.map(s=>this.createElement(e,s)))},n.onmouseleave=()=>{r.replaceChildren()},n}return document.createElement("div")}}const $m={fontName:"Main",fontSize:20,fill:["#ffffff"]};class Ym extends fe{renderer;barlineMap=new Map;barlineLabelMap=new Map;barlinePool=new Xi({create:()=>{const e=new Ae(Ce.WHITE);return ze(e,"text-color"),e}});barlineLabelPool=new Xi({create:()=>{const e=new ye("",$m);return ze(e,"text-color"),e}});constructor(e){super(),this.renderer=e;const t=()=>{this.barlineMap.clear(),this.barlineLabelMap.clear(),this.barlinePool.destroyAll(),this.barlineLabelPool.destroyAll()};re.on("timeSigChanged",t),this.on("destroyed",()=>re.off("timeSigChanged",t)),this.addChild(this.barlinePool,this.barlineLabelPool)}update(e,t){this.visible=this.renderer.shouldDisplayBarlines();for(const[n,a]of this.renderer.chart.timingData.getMeasureBeats(e,t)){if(!this.barlineMap.has(n)){const r=this.barlinePool.createChild();if(!r)continue;Object.assign(r,{width:this.renderer.chart.gameType.notefieldWidth+128,height:a?4:1,visible:!0}),r.anchor.set(.5),this.barlineMap.set(n,r)}if(a&&!this.barlineLabelMap.has(n)){const r=this.barlineLabelPool.createChild();if(!r)continue;Object.assign(r,{x:(this.renderer.chart.gameType.notefieldWidth+128)/-2-16,text:`${Math.round(this.renderer.chart.timingData.getMeasure(n))}`,visible:!0}),r.anchor.set(1,.5),this.barlineLabelMap.set(n,r)}}for(const[n,a]of this.barlineMap.entries()){if(n<e||n>t){this.barlineMap.delete(n),this.barlinePool.destroyChild(a);continue}a.y=this.renderer.getYPosFromBeat(n)}for(const[n,a]of this.barlineLabelMap.entries()){if(n<e||n>t){this.barlineLabelMap.delete(n),this.barlineLabelPool.destroyChild(a);continue}a.y=this.renderer.getYPosFromBeat(n)}}}class Km extends fe{previewArea=new Ae(Ce.WHITE);previewText=new ye("SONG PREVIEW",{fontName:"Main",fontSize:13});renderer;constructor(e){super(),this.renderer=e,Object.assign(this.previewArea,{alpha:.2,tint:11052482,width:this.renderer.chart.gameType.notefieldWidth+96,height:64}),this.previewText.x=-this.previewArea.width/2+5,this.previewArea.anchor.x=.5,ze(this.previewText,"text-color"),this.addChild(this.previewArea,this.previewText)}update(e,t){const n=Number(this.renderer.chart.sm.properties.SAMPLESTART),a=Number(this.renderer.chart.sm.properties.SAMPLELENGTH);if(Number.isNaN(n)||Number.isNaN(a)||!this.renderer.shouldDisplayBarlines()||this.renderer.chart.timingData.getBeatFromSeconds(n+a)<e||this.renderer.chart.timingData.getBeatFromSeconds(n)>t){this.visible=!1;return}this.visible=!0;let r=this.renderer.getYPosFromSecond(n),s=this.renderer.getYPosFromSecond(n+a);s<r&&([s,r]=[r,s]),this.previewArea.y=r,this.previewArea.height=s-r,this.previewText.anchor.y=y.chart.reverse?1:0,y.chart.reverse?this.previewText.y=Se(this.renderer.getUpperBound()-35,this.previewArea.y+15,this.previewArea.y+this.previewArea.height-5):this.previewText.y=Se(this.renderer.getUpperBound()+35,this.previewArea.y+5,this.previewArea.y+this.previewArea.height-15)}}class Xm extends fe{renderer;scrollMap=new Map;receptors;topBound;bottomBound;topBoundBeat;bottomBoundBeat;topScreenBeat;bottomScreenBeat;topScreenBeatText;bottomScreenBeatText;children=[];constructor(e){super(),this.visible=!1,this.renderer=e,this.receptors=this.createBar(7829503),this.receptors.width=300,this.addChild(this.receptors),this.topBound=this.createBar(16711680),this.addChild(this.topBound),this.bottomBound=this.createBar(16711680),this.addChild(this.bottomBound),this.topBoundBeat=this.createBar(16777096),this.addChild(this.topBoundBeat),this.bottomBoundBeat=this.createBar(8978431),this.addChild(this.bottomBoundBeat),this.topScreenBeat=this.createBar(16746751),this.topScreenBeat.width=300,this.addChild(this.topScreenBeat),this.topScreenBeatText=new ye("",{fontName:"Fancy",fontSize:50}),this.topScreenBeatText.anchor.x=.5,this.topScreenBeatText.anchor.y=.5,this.topScreenBeatText.tint=16746751,this.addChild(this.topScreenBeatText),this.bottomScreenBeat=this.createBar(16724991),this.bottomScreenBeat.width=300,this.addChild(this.bottomScreenBeat),this.bottomScreenBeatText=new ye("",{fontName:"Fancy",fontSize:50}),this.bottomScreenBeatText.anchor.x=.5,this.bottomScreenBeatText.anchor.y=.5,this.bottomScreenBeatText.tint=16724991,this.addChild(this.bottomScreenBeatText),this.scale.x=.4,this.scale.y=.4}createBar(e){const t=new Ae(Ce.WHITE);return Object.assign(t,{width:750,height:15,tint:e,opacity:.5}),t.anchor.set(.5),t}update(){if(this.visible=y.debug.showScroll,!this.visible)return;const e=this.renderer.chart.timingData.getTimingData("SCROLLS");this.x=this.renderer.chartManager.app.STAGE_WIDTH/4;for(const r of this.scrollMap.values())r.marked=!1;for(const r of e){if(r==e.at(-1))continue;if(this.scrollMap.has(r)){this.scrollMap.get(r).marked=!0;continue}const s=new fe,o=new Ae(Ce.WHITE),l=new ye("",{fontName:"Main",fontSize:25});o.alpha=.2,o.width=150,o.anchor.x=.5,l.anchor.x=.5,s.text=l,s.marked=!0,s.box=o,this.scrollMap.set(r,s),s.addChild(o,l),this.addChild(s)}const t=this.renderer.chartManager.beat;for(let r=0;r<e.length-1;r++){let s=this.renderer.getYPosFromBeat(e[r].beat),o=this.renderer.getYPosFromBeat(e[r+1].beat);const l=this.scrollMap.get(e[r]);if(!this.inBounds(o)&&!this.inBounds(s)&&s*o>=0){l.visible=!1;continue}if(Math.abs(e[r].beat-t)>20&&Math.abs(e[r+1].beat-t)>20&&!(t>e[r].beat&&t<e[r+1].beat)){l.visible=!1;continue}l.text.text=`yStart:${ue(s,1)}
yEnd:${ue(o,1)}
val:${e[r].value}
h:${ue(o-s,1)}`,o<s&&([s,o]=[o,s]),l.visible=!0,l.y=s,l.box.height=o-s,l.box.tint=16777215,l.text.tint=16777215,t>e[r].beat&&t<e[r+1].beat&&(l.text.y=Math.max(this.renderer.getActualReceptorYPos()-s,0),l.box.tint=8978312),t<e[r].beat&&(l.text.y=0),t>e[r+1].beat&&(l.text.y=l.box.height),l.x=(r%4-1.5)*150}for(const[r,s]of this.scrollMap.entries())if(!s.marked){this.scrollMap.delete(r),s.destroy();continue}const n=this.renderer.findFirstOnScreenScroll(),a=this.renderer.findLastOnScreenScroll();{const r=this.scrollMap.get(n);r&&(r.text.text+=`
start`,r.box.tint==16777215&&(r.box.tint=16777096),r.text.tint=16777096)}{const r=this.scrollMap.get(a);r&&(r.text.text+=`
end`,r.box.tint==16777215&&(r.box.tint=8978431),r.text.tint=8978431)}this.receptors.y=this.renderer.getActualReceptorYPos(),this.topBound.y=this.renderer.getUpperBound(),this.bottomBound.y=this.renderer.getLowerBound(),this.topBoundBeat.y=this.renderer.getYPosFromBeat(this.renderer.getVisualBeat()-y.chart.maxDrawBeatsBack),this.bottomBoundBeat.y=this.renderer.getYPosFromBeat(this.renderer.getVisualBeat()+y.chart.maxDrawBeats),this.topScreenBeat.y=this.renderer.getYPosFromBeat(this.renderer.getTopOnScreenBeat()),this.bottomScreenBeat.y=this.renderer.getYPosFromBeat(this.renderer.getBottomOnScreenBeat()),this.topScreenBeatText.y=this.topScreenBeat.y,this.topScreenBeatText.text=ue(this.renderer.getTopOnScreenBeat(),3)+"",this.bottomScreenBeatText.y=this.bottomScreenBeat.y,this.bottomScreenBeatText.text=ue(this.renderer.getBottomOnScreenBeat(),3)+""}inBounds(e){const t=this.renderer.chartManager.app.STAGE_HEIGHT/this.scale.y;return Math.abs(e)<t}}class Zm extends fe{startMarker=new Ae(Ce.WHITE);selectionArea=new Ae(Ce.WHITE);renderer;constructor(e){super(),this.renderer=e,Object.assign(this.startMarker,{alpha:0,width:this.renderer.chart.gameType.notefieldWidth,height:64}),Object.assign(this.selectionArea,{alpha:0,tint:5140387,width:this.renderer.chart.gameType.notefieldWidth,height:64}),this.startMarker.anchor.set(.5),this.selectionArea.anchor.x=.5,this.addChild(this.selectionArea,this.startMarker)}update(){if(this.renderer.chartManager.getMode()==q.Play||this.renderer.chartManager.app.capturing){this.visible=!1;return}this.visible=!0;const e=this.renderer.chartManager.startRegion,t=this.renderer.chartManager.endRegion;e!==void 0&&t===void 0?(this.startMarker.alpha=Math.sin(Date.now()/320)*.1+.3,this.startMarker.y=this.renderer.getYPosFromBeat(e)):this.startMarker.alpha=0,e!==void 0&&t!==void 0?(this.selectionArea.alpha=Math.sin(Date.now()/320)*.1+.3,this.selectionArea.y=this.renderer.getYPosFromBeat(Math.min(e,t)),this.selectionArea.height=this.renderer.getYPosFromBeat(Math.max(e,t))-this.selectionArea.y):this.selectionArea.alpha=0}}class Qm extends Ae{renderer;constructor(e){super(Ce.WHITE),this.renderer=e,this.visible=!1,this.alpha=.2,this.eventMode="none"}update(){const e=this.renderer.getSelectionBounds();if(this.visible=!!e,e){const t=this.renderer.getYPosFromBeat(e?.startBeat),n=this.renderer.getYPosFromBeat(e?.endBeat);this.position.x=Math.min(e.startX,e.endX),this.position.y=Math.min(t,n),this.width=Math.abs(e.endX-e.startX),this.height=Math.abs(n-t)}}}const Jm=3500;class eg extends Ae{lineContainer=new Gs(1500,{position:!0,scale:!0,tint:!0,alpha:!0},16384,!0);waveformTex;renderer;rawData=[];filteredRawData=[];speed;lastSpeed;lastSpeedTimeout;sampleRate=44100;poolSearch=0;trackedVariables=new Map;drawDirty=!0;blockCache=new Map;colorCache=new F("black");filteredColorCache=new F("black");constructor(e){super(),this.renderer=e,this.waveformTex=Ai.create({resolution:Math.min(1,y.performance.resolution)}),this.texture=this.waveformTex,this.speed=this.getSpeed(),this.lastSpeed=this.getSpeed(),this.trackVariable(()=>this.renderer.getVisualBeat()),this.trackVariable(()=>this.renderer.getVisualTime()),this.trackVariable(()=>y.chart.speed),this.trackVariable(()=>this.getSpeed(),r=>{this.speed=r,clearTimeout(this.lastSpeedTimeout),this.lastSpeedTimeout=setTimeout(()=>{this.blockCache.clear(),this.lastSpeed=this.speed,this.drawDirty=!0},200)}),this.trackVariable(()=>y.chart.zoom),this.trackVariable(()=>y.chart.CMod),this.trackVariable(()=>y.chart.doSpeedChanges),this.trackVariable(()=>y.chart.waveform.allowFilter),this.trackVariable(()=>y.chart.reverse),this.trackVariable(()=>y.chart.waveform.antialiasing,r=>{this.filters=r?[new Mo]:[]}),this.trackVariable(()=>this.renderer.chartManager.app.STAGE_WIDTH,()=>this.resizeWaveform()),this.trackVariable(()=>this.renderer.chartManager.app.STAGE_HEIGHT,()=>this.resizeWaveform()),this.trackVariable(()=>y.chart.waveform.filteredColor),this.trackVariable(()=>y.chart.waveform.color),this.trackVariable(()=>y.chart.waveform.speedChanges),this.trackVariable(()=>y.chart.receptorYPos),this.trackVariable(()=>y.chart.waveform.lineHeight,()=>{y.chart.waveform.lineHeight<=0&&(y.chart.waveform.lineHeight=1),this.updateLineHeight()}),this.trackVariable(()=>y.chart.zoom,()=>this.resizeWaveform()),this.trackVariable(()=>this.renderer.chartManager.chartAudio.hasFilters());const t=()=>this.getData();this.anchor.set(.5),this.renderer.chartManager.chartAudio.onUpdate(t),this.getData(),this.resizeWaveform(),this.filters=y.chart.waveform.antialiasing?[new Mo]:[];const n=()=>this.drawDirty=!0,a=()=>{this.getData(),this.resizeWaveform(),this.renderer.chartManager.chartAudio.onUpdate(t)};re.on("timingModified",n),this.on("destroyed",()=>{re.off("timingModified",n)}),re.on("audioLoaded",a),this.on("destroyed",()=>{re.off("audioLoaded",a),this.renderer.chartManager.chartAudio.offUpdate(t)})}getData(){this.rawData=this.renderer.chartManager.chartAudio.getRawData(),this.filteredRawData=this.renderer.chartManager.chartAudio.getFilteredRawData(),this.sampleRate=this.renderer.chartManager.chartAudio.getSampleRate(),this.blockCache.clear(),this.drawDirty=!0}resizeWaveform(){this.waveformTex.resize(Se((this.rawData?.length??0)*288*y.chart.zoom,1,this.renderer.chartManager.app.STAGE_WIDTH),this.renderer.chartManager.app.STAGE_HEIGHT)}update(){this.visible=y.chart.waveform.enabled&&this.renderer.shouldDisplayBarlines(),y.chart.waveform.enabled&&((this.drawDirty||this.variableChanged())&&(this.colorCache.toHexa()!=y.chart.waveform.color&&(this.colorCache=qn(y.chart.waveform.color)),this.filteredColorCache.toHexa()!=y.chart.waveform.filteredColor&&(this.filteredColorCache=qn(y.chart.waveform.filteredColor)),this.drawDirty=!1,this.renderData(),this.renderer.chartManager.app.renderer.render(this.lineContainer,{renderTexture:this.waveformTex})),this.scale.set(1/y.chart.zoom))}trackVariable(e,t){this.trackedVariables.set(e,{value:e(),cb:t})}variableChanged(){let e=!1;for(const[t,n]of this.trackedVariables.entries())t()!=n.value&&(this.trackedVariables.get(t).value=t(),this.trackedVariables.get(t).cb?.(t()),e=!0);return e}getSample(e,t,n){if(t<0)return 0;const a=this.sampleRate/(this.lastSpeed*4),r=Math.floor(t*this.lastSpeed*4);if(this.blockCache.get(n)?.[r]!==void 0)return this.blockCache.get(n)[r];const s=Math.floor(r*a),o=e.slice(s,Math.floor(s+a)).reduce((l,u)=>l+Math.abs(u),0)/a;return this.blockCache.has(n)||this.blockCache.set(n,[]),this.blockCache.get(n)[r]=o,o}renderData(){this.resetPool();const e=y.chart.waveform.allowFilter&&this.renderer.chartManager.chartAudio.hasFilters(),t={data:{bpms:[],bpmIndex:0,timing:[],timingIndex:0,offset:0,lastBeat:-999,timingData:null},init(a){if(this.data.bpms=a.getTimingData("BPMS"),this.data.timing=a.getBeatTiming(),this.data.offset=a.getOffset(),this.data.bpms[0]?.beat!==0){const r=structuredClone(this.data.bpms[0])??{value:120,type:"BPMS",beat:0};r.beat=0,this.data.bpms.unshift(r)}this.data.timing.length==0&&this.data.timing.unshift({beat:0,secondBefore:-this.data.offset,secondAfter:-this.data.offset,secondClamp:-this.data.offset,secondOf:-this.data.offset,warped:!1,bpm:120}),this.data.timingData=a},getBPM(a){for(;a>this.data.bpms[this.data.bpmIndex+1]?.beat;)this.data.bpmIndex++;return this.data.bpms[this.data.bpmIndex].value},getSecond(a){const r=Math.floor(a*48)/48;if(a<=0)return-this.data.offset+a*60/this.getBPM(a);if(r>=this.data.timing[this.data.timingIndex+1]?.beat){for(;r>=this.data.timing[this.data.timingIndex+1]?.beat;)this.data.timingIndex++;return this.data.timingData.getSecondsFromBeat(a)}else{const s=this.data.timing[this.data.timingIndex];let l=(a-s.beat)*60/s.bpm;return s.warped&&(l=0),Math.max(s.secondClamp,s.secondAfter+l)}}},n=this.renderer.chartManager.app.STAGE_HEIGHT;if(y.chart.waveform.speedChanges&&!y.chart.CMod&&y.chart.doSpeedChanges){const a=y.chart.speed,r=this.renderer.getCurrentSpeedMult(),s=this.renderer.getTopOnScreenBeat(),o=this.renderer.getBottomOnScreenBeat(),l=Math.min(s,o),u=Math.max(s,o),f=this.renderer.findFirstOnScreenScroll(),c=this.renderer.findLastOnScreenScroll(),d=[...this.renderer.chart.timingData.getTimingData("SCROLLS")];d[0]?.beat!=0&&d.unshift({type:"SCROLLS",beat:0,value:d[0]?.value??1}),t.init(this.renderer.chart.timingData);const h=d.findIndex(w=>w.beat==f.beat),p=d.findIndex(w=>w.beat==c.beat),m=100/a/Math.abs(r)/64/y.chart.zoom;let g=l,b=Math.round(this.renderer.getYPosFromBeat(g)*y.chart.zoom+n/2),x=this.renderer.chart.getSecondsFromBeat(g);for(const w of d.slice(h,p+1)){if(w.value==0)continue;const E=m/Math.abs(w.value);w.beat!=f.beat?g=w.beat:g=Math.round((g-w.beat)/E)*E+w.beat,b=Math.round(this.renderer.getYPosFromBeat(g)*y.chart.zoom+n/2),x=this.renderer.chart.getSecondsFromBeat(g);const C=this.renderer.getScrollDirection(w.value),B=d[d.indexOf(w)+1]?.beat??Number.MAX_VALUE;for(;g<Math.min(B,u);){if(b<0){if(C<0){g=B;break}g+=E*-b,b=0;continue}if(b>n){if(C>0){g=B;break}g+=E*(b-n),b=n;continue}g+=E*y.chart.waveform.lineHeight,b+=C*y.chart.waveform.lineHeight,x=t.getSecond(g),this.drawLine(x,b,e)}}}else if(y.chart.CMod){let a=this.renderer.getSecondFromYPos((-n/2+(y.chart.reverse?this.renderer.chartManager.app.STAGE_HEIGHT:0))/y.chart.zoom);const r=this.renderer.getPixelsToSecondsRatio()/y.chart.zoom;a=Math.floor(a/r)*r;const s=o=>{a+=r*y.chart.waveform.lineHeight,this.drawLine(a,o,e)};if(y.chart.reverse)for(let o=this.renderer.chartManager.app.STAGE_HEIGHT;o>=0;o-=y.chart.waveform.lineHeight)s(o);else for(let o=0;o<=this.renderer.chartManager.app.STAGE_HEIGHT;o+=y.chart.waveform.lineHeight)s(o)}else{let a=this.renderer.getBeatFromYPos((-n/2+(y.chart.reverse?this.renderer.chartManager.app.STAGE_HEIGHT:0))/y.chart.zoom);t.init(this.renderer.chart.timingData);const r=this.renderer.getPixelsToEffectiveBeatsRatio()/y.chart.zoom;a=Math.floor(a/r)*r;let s=this.renderer.chart.getSecondsFromBeat(a);const o=l=>{a+=r*y.chart.waveform.lineHeight,s=t.getSecond(a),this.drawLine(s,l,e)};if(y.chart.reverse)for(let l=this.renderer.chartManager.app.STAGE_HEIGHT;l>=0;l-=y.chart.waveform.lineHeight)o(l);else for(let l=0;l<=this.renderer.chartManager.app.STAGE_HEIGHT;l+=y.chart.waveform.lineHeight)o(l)}this.purgePool()}drawLine(e,t,n){if(!(e<0))for(let a=0;a<this.rawData.length;a++){const r=this.getLine();if(r.scale.x=this.getSample(this.rawData[a],e,"main")*16*y.chart.zoom,r.y=t,r.tint=this.colorCache,r.alpha=this.colorCache.alpha,r.x=this.waveformTex.width/2+288*(a+.5-this.rawData.length/2)*y.chart.zoom,!n)continue;const s=this.getLine();s.scale.x=this.getSample(this.filteredRawData[a],e,"filter")*16*y.chart.zoom,s.tint=this.filteredColorCache,s.alpha=this.filteredColorCache.alpha,s.y=t,s.x=this.waveformTex.width/2+288*(a+.5-this.filteredRawData.length/2)*y.chart.zoom}}resetPool(){this.poolSearch=0}purgePool(){di(this.lineContainer.children,(e,t)=>t>=this.poolSearch)}updateLineHeight(){for(const e of this.lineContainer.children){const t=e;t.height=y.chart.waveform.lineHeight}}getLine(){if(this.lineContainer.children[this.poolSearch]){const t=this.lineContainer.children[this.poolSearch];return t.visible=!0,this.poolSearch++,t}const e=new Ae(Ce.WHITE);return e.height=y.chart.waveform.lineHeight,e.anchor.set(.5),e.visible=!0,this.poolSearch++,this.lineContainer.addChild(e),e}getSpeed(){return Math.min(y.chart.speed,Jm)}}const tg="/smeditor/assets/missing-Dwhls35X.png",qu=Ce.from(tg),ig={HoldBodyTopOffset:0,HoldBodyBottomOffset:0,RollBodyTopOffset:0,RollBodyBottomOffset:0};class ng{renderer;options;objects=[];updateHooks=new Set;hooks={};metrics;constructor(e,t){this.renderer=e,this.options=t,this.options.init?.(e),this.metrics={...ig,...this.options.metrics}}update(e){this.options.update?.(e),this.updateHooks.forEach(({item:t,cb:n})=>{t.destroyed||n(e)})}getPlaceholderSprite(){const e=new Ae(qu);return e.anchor.set(.5),e}getBlankSprite(){return new Ae(Ce.EMPTY)}getElement(e,t={}){try{return this.options.load?this.options.load.bind(this)(e,{noteskin:this,columnName:e.columnName,columnNumber:e.columnNumber,...t})??this.getPlaceholderSprite():this.loadElement(e,t)??this.getPlaceholderSprite()}catch(n){return console.error(n),y.debug.showNoteskinErrors&&de.createFormatted("Noteskin Error: "+n,"error"),this.getPlaceholderSprite()}}loadElement(e,t={}){const n=this.followRedirs(e);return n===void 0?(y.debug.showNoteskinErrors&&de.createFormatted(`Noteskin element ${e.columnName} ${e.element} failed to load for noteskin: Redirect loop`,"error"),this.getPlaceholderSprite()):n({noteskin:this,columnName:e.columnName,columnNumber:e.columnNumber,...t})}followRedirs(e){const t=[e];let n=e;for(;;){const a=this.options.elements[n.columnName]?.[n.element];if(a===void 0)return;if(typeof a=="function")return a;if(n={columnName:a.columnName??n.columnName,columnNumber:a.columnNumber??n.columnNumber,element:a.element},t.some(r=>n.columnName==r.columnName&&n.element==r.element))return;t.push(n)}}on(e,t,n){this.hooks[t]===void 0&&(this.hooks[t]=new Set);const a={item:e,cb:n};this.hooks[t].add(a),e.once("destroyed",()=>this.hooks[t].delete(a))}onUpdate(e,t){const n={item:e,cb:t};this.updateHooks.add(n),e.once("destroyed",()=>this.updateHooks.delete(n))}broadcast(e){if(this.hooks[e.type]===void 0)return;this.hooks[e.type].forEach(({item:n,cb:a})=>{n.destroyed||a(e)})}}const ag="/smeditor/assets/hold_judgement-BL12d-N2.png";class Wi extends fe{children=[];static held_tex;static dropped_tex;notefield;constructor(e){super(),Wi.held_tex||this.loadTex(),this.notefield=e}async loadTex(){const e=await _s.load(ag),t=e.height,n=e.width;Wi.held_tex=new Ce(e,new zn(0,0,n,t/2)),Wi.dropped_tex=new Ce(e,new zn(0,t/2,n,t/2))}update(){this.y=this.notefield.renderer.getActualReceptorYPos()+(y.chart.reverse?-48:48);for(const e of this.children){const t=(Date.now()-e.createTime)/1e3;if(t<.1){const n=1-(1-t/.1)*(1-t/.1);e.scale.set(.3*n)}else if(t>.6&&t<.8){const n=(t-.6)/.2*(t-.6)/.2;e.scale.set(.3*(1-n))}}di(this.children,e=>Date.now()-e.createTime>800)}addJudge(e,t){if(!Vn(t)&&!dn(t))return;const n=new Ae(Vn(t)?Wi.dropped_tex:Wi.held_tex);n.anchor.set(.5),n.x=this.notefield.getColumnX(e),n.createTime=Date.now(),n.scale.set(0),this.addChild(n)}}class rg extends fe{notefield;arrowMap=new Map;notesDirty=!1;children=[];constructor(e){super(),this.notefield=e,this.sortableChildren=!0;const t=()=>{this.arrowMap.clear(),this.removeChildren()},n=()=>this.notesDirty=!0;re.on("timeSigChanged",t),re.on("chartModified",n),this.on("destroyed",()=>{re.off("timeSigChanged",t),re.off("chartModified",n)})}update(e,t){const n=this.notefield.renderer.chart.getNotedata();if(this.notesDirty){for(const[a,r]of this.arrowMap.entries())n.includes(a)||(r.destroy(),this.arrowMap.delete(a));this.notesDirty=!1}for(const a of n){if(a.beat>t)break;if(this.shouldDisplayNote(a,e,t)&&!this.arrowMap.has(a)){const r=new fe,s=this.notefield.createNote(a);Object.assign(r,{x:this.notefield.getColumnX(a.col),zIndex:a.beat});const o=new Ae(Ce.WHITE),l=s.getLocalBounds();o.x=l.x,o.y=l.y,o.width=l.width,o.height=l.height,o.alpha=0;const u=new Ae(Ce.WHITE);u.x=l.x,u.y=l.y,u.width=l.width,u.height=l.height,u.alpha=0;const f=new Ae(Ce.WHITE);f.x=l.x,f.y=l.y,f.width=l.width,f.height=5,f.tint=16711680,f.alpha=0,this.notefield.renderer.registerDragNote(r,a),r.wrapper=s,r.selection=o,r.parity=u,r.parityOverride=f,r.lastActive=!1,this.arrowMap.set(a,r),r.addChild(s,o,u,f),this.addChild(r)}}for(const[a,r]of this.arrowMap.entries()){if(!this.shouldDisplayNote(a,e,t)){r.destroy(),this.arrowMap.delete(a);continue}if(r.y=this.notefield.renderer.getActualReceptorYPos(),(!Oe(a)||!a.gameplay?.lastHoldActivation||this.notefield.renderer.getVisualBeat()<a.beat)&&(r.y=this.notefield.renderer.getYPosFromBeat(a.beat)),Oe(a)&&a.gameplay?.droppedHoldBeat&&(r.y=this.notefield.renderer.getYPosFromBeat(a.gameplay.droppedHoldBeat)),Oe(a)){const s=this.notefield.renderer.getYPosFromBeat(Xt(a))-r.y,o=r.wrapper.object;if(o.setLength(s),a.gameplay?.lastHoldActivation){let u=(Date.now()-a.gameplay.lastHoldActivation)/_t.getCollection(y.play.timingCollection).getHeldJudgement(a).getTimingWindowMS();u=Math.min(1.2,u),o.setBrightness(1-u*.7)}else o.setBrightness(1);a.gameplay?o.setActive(!(a.gameplay.lastHoldActivation===void 0||a.gameplay.droppedHoldBeat!==void 0)):o.setActive(!1);const l=r.wrapper.getLocalBounds();r.parity.x=l.x,r.parity.y=l.y,r.parity.width=l.width,r.parity.height=l.height,r.parityOverride.x=l.x,r.parityOverride.y=l.y,r.parityOverride.width=l.width}if(this.notefield.renderer.chartManager.editTimingMode==ke.Off){const s=this.notefield.renderer.shouldDisplayNoteSelection(a);if(r.selection.alpha=s?Math.sin(Date.now()/320)*.1+.3:0,s&&r.wrapper.object.type=="hold"){const l=r.wrapper.getLocalBounds();r.selection.x=l.x,r.selection.y=l.y,r.selection.width=l.width,r.selection.height=l.height}r.visible=!s||!this.notefield.renderer.chartManager.selection.shift;const o=this.notefield.renderer.selectionTest(r.wrapper);!s&&o&&this.notefield.renderer.chartManager.addNoteToDragSelection(a),s&&!o&&this.notefield.renderer.chartManager.removeNoteFromDragSelection(a)}y.experimental.parity.enabled?(r.parity.alpha=a.parity?.4:0,r.parity.tint=a.parity?.foot!==void 0?un[a.parity.foot]:16777215,a.parity?.override?r.parityOverride.alpha=.4:r.parityOverride.alpha=0):(r.parity.alpha=0,r.parityOverride.alpha=0)}}shouldDisplayNote(e,t,n){return e.gameplay?.hideNote||y.chart.CMod&&e.fake&&y.chart.hideFakedArrows||y.chart.CMod&&y.chart.hideWarpedArrows&&e.warped||Xt(e)<t?!1:e.beat<=n}}class sg extends fe{notefield;children=[];constructor(e){super(),this.notefield=e,this.eventMode="none";for(let t=0;t<this.notefield.gameType.numCols;t++){const n=this.notefield.getElement({element:"NoteFlash",columnName:this.notefield.getColumnName(t),columnNumber:t});n.x=this.notefield.getColumnX(t),this.addChild(n)}}update(){this.y=this.notefield.renderer.getActualReceptorYPos()}}class og extends fe{notefield;children=[];dragStart=null;dragOptionsStart=null;optionUpdate=e=>{e=="chart.allowReceptorDrag"&&(this.eventMode=y.chart.allowReceptorDrag?"static":"passive")};constructor(e){super(),this.notefield=e;for(let a=0;a<this.notefield.gameType.numCols;a++){const r=this.notefield.getElement({element:"Receptor",columnName:this.notefield.getColumnName(a),columnNumber:a});r.x=this.notefield.getColumnX(a),this.addChild(r)}const t=a=>{!this.dragStart||!this.dragOptionsStart||(y.chart.receptorXPos=Math.round(this.dragOptionsStart[0]+a.global.x-this.dragStart.x),y.chart.receptorYPos=Math.round(this.dragOptionsStart[1]+(a.global.y-this.dragStart.y)*(y.chart.reverse?-1:1)))},n=()=>{this.notefield.renderer.off("pointermove",t),window.removeEventListener("pointerup",n)};this.on("pointerdown",a=>{this.dragStart=new nd(a.globalX,a.globalY),this.dragOptionsStart=[y.chart.receptorXPos,y.chart.receptorYPos],a.preventDefault(),a.stopImmediatePropagation(),this.notefield.renderer.on("pointermove",t),window.addEventListener("pointerup",n)}),re.on("userOptionUpdated",this.optionUpdate),this.optionUpdate("chart.allowReceptorDrag")}destroy(){re.off("userOptionUpdated",this.optionUpdate)}update(){this.y=this.notefield.renderer.getActualReceptorYPos()}}class lg extends fe{notefield;arrowMap=new Map;children=[];lastBeatShift=0;lastColShift=0;constructor(e){super(),this.notefield=e,this.sortableChildren=!0}update(e,t){if(!this.notefield.renderer.chartManager.selection.shift){this.removeChildren(),this.arrowMap.clear();return}const n=this.notefield.renderer.chartManager.selection.shift.beatShift,a=this.notefield.renderer.chartManager.selection.shift.columnShift;if(this.lastBeatShift!=n||this.lastColShift!=a){this.lastBeatShift=n,this.lastColShift=a;for(const[r,s]of this.arrowMap.entries()){const o=this.notefield.renderer.chartManager.loadedChart.computeNote({...r,beat:r.beat+n,col:r.col+a});s.x=this.notefield.getColumnX(o.col),s.wrapper.destroy(),s.wrapper.alpha=.4,s.wrapper=this.notefield.createNote(o);const l=s.wrapper.getBounds();s.selection.x=l.x,s.selection.y=l.y,s.selection.width=l.width,s.selection.height=l.height,s.addChild(s.wrapper,s.selection)}}for(const r of this.notefield.renderer.chartManager.selection.notes)if(!(r.beat+n+(Oe(r)?r.hold:0)<e)&&!(r.beat+n>t)&&!this.arrowMap.has(r)){const s={...r,beat:r.beat+n,col:r.col+a},o=new fe,l=this.notefield.createNote(s);Object.assign(o,{x:this.notefield.getColumnX(s.col),zIndex:s.beat,alpha:.4});const u=new Ae(Ce.WHITE),f=l.getBounds();u.x=f.x,u.y=f.y,u.width=f.width,u.height=f.height,u.alpha=0,this.notefield.renderer.registerDragNote(l,s),o.wrapper=l,o.selection=u,this.arrowMap.set(r,o),o.addChild(l,u),this.addChild(o)}for(const[r,s]of this.arrowMap.entries()){if(r.beat+n+(Oe(r)?r.hold:0)<e||r.beat+n>t){s.destroy(),this.arrowMap.delete(r);continue}const o=r.beat+n;if(s.y=this.notefield.renderer.getYPosFromBeat(o),s.selection.alpha=Math.sin(Date.now()/320)*.1+.3,Oe(r)){const l=this.notefield.renderer.getYPosFromBeat(o+(Oe(r)?r.hold:0))-s.y,u=s.wrapper.object;u.setLength(l),u.setBrightness(1);const f=s.wrapper.getLocalBounds();s.selection.x=f.x,s.selection.y=f.y,s.selection.width=f.width,s.selection.height=f.height}}}}const cg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAMAAABHPGVmAAAAAXNSR0IB2cksfwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAZ5QTFRFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8fHx9vb29PT0AAAA+fn5/////f39AAAAAAAAAAAAAAAA/v7+AAAAAAAA9vb2AAAAAAAA8/PzAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv401VgAAAIp0Uk5TABZHbpW80t3u+bttRhUKT5H+/9GQTgkCPJnxok0DCGreaQd05nLf41Qgs7EeUFYTx8QSGtYdKOLhJxvg5B/VxZRS8O+ysHVw5fv28fRn7v/qvtwBQeo+nvKb8vRLwr2Mz/0URGuSudPt6/jOSp2aQD3bZnNJrkxRjgYP0NQmGREEiFVvM+yNRZO6TR9aLAAABG9JREFUeJzt2VloFEkYAOD/T2aSzJh0gmSM7kbFQYOJGWJWNB6oefBYjAdeeBCMB3iB7IPHgw/isoIu6y6yeIDZNQaVhYjghSd44IO6G6IxwSsq4n2GGE2Midr2SI4+/uqq6h5lhfkfcnRX1dfddXRVNcJXCIwiUSSKfGsItgWoquppjkd8HVlEQWzsZE6qxmjiswghaVpZTYxzCdq5++6RHoj1tgkavsM77hAlgLW8y4DO+NT+OuyRdP8LLhGOAF53imTiEyEiHN2w2hESqvELG1oTSL0ijwRrYySIcMT7WA2AheTgPUkDoCdWSCEDqhKlDe3u8T8JZBDWODAAMvC8MDIUrzkyALLwnCCS4+V1YXZkvyHqhUCCinydd0TovvUKCSSf3eBF4mOdANJXaPS2iZzTXCSz22WXSG6zufItyChGh5KIASc5SOihawPA/8AWUUJOe4ihlEZjvZqQMeURMAAGHrdBghn/RgTp3GzoakakJzXLydMmC+9pPCtFmx5dJE4MO8RE0nzEuzrPi+FJ11miqJGqqs2MWgglH/exkGmniJIGe8M/495blZGe5vCvlgtErlFlLGSGuYGHY4gHaKXVAN8JItfYfxiIMv4YkXxoLJBKmwGJR4lc/at1rViPJMcSqSErVaWUdgOryZnZuN00kkJPHQqaWouL259EHPQdJnNNKKWROMZ7nVC4BkzcSSKYwpq6tD+atidmOWCNSbiDQmJSGOkt98K/Dy0m/00hscnMDEZFyIApf1GIR2Hn0CszhQyYWkwh/gSbLLpqAG59fI5p2ylk0V67PB330hr296GV/JJChnHeV0aFZ4Byl0IWl1lTMhWuATO2UYjPx8mmU/gGzNzqGtGNMFKI3OPiKvTjkqx4nkJXvGwT5ih0E/4qnVFwWPGp1PvFGvSwIjZAam2XfItZgh4ghYb6z/1DSKGH+iRPRF9aFZUUIvD6be/n/HuZtaXjbz2S+lHUEFBYE4nAByo1d0rURM6TZ2+mESWR2qBzNrnLrdHN6w11vWwPkdzZNLXwT90/BuSnXURyZxPuOZtYSFpdJ2tyR0uHonvMpQP0ekUUlYfKG8YiaJAnsZ5cBM39Q//fl1nOBVoMex+mTr68JCLIK2NnMC+xu4ptn9pHfrlxC8g8XK3YAe5DvzahEOj32LWx4DfTAQuSnXbJpdEYMu9EWkf3VcXuvqmoC381HyIKZKzqRGPhBsshanuwe5ULoyB9vQgCq3EbcVQslh4R2+h0s2Ub8FLfBehKHqLedGRkjP6FOsxoSWu2qA6M7Lcy2+gAPyTJ135B8Gf6BLNPrMVNcv1FVZdY2xUHAUh+J/WRZvEa5jm7qx1eKz6OLThDVwcX0YaYMvvPbm3RMH233WnOc++S23CVSwQKi+0/IXArN9jPe8Y2QRHGsypcGNFi3caVvzNO9b/xY90+xjk5BKDHiPQneMB0cJL/+0cHhT61iPeF+X1u98b6jfNKoahkxfPgLbW8kp9JFnERUSSKRJH/CfIJY3BkdLZ23K0AAAAASUVORK5CYII=",ug="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAMAAABHPGVmAAAAAXNSR0IB2cksfwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAapQTFRFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/v7+/v7+AAAA////AAAAAAAAAAAAAAAAAAAAAAAAAAAA+Pj4AAAAAAAA+fn5////AAAAAAAAAAAAAAAAAAAA/Pz8AAAAAAAAAAAAAAAAAAAAAAAA+Pj4AAAA////AAAA9fX19PT0+/v7AAAA+fn5/v7+AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAE+ClvgAAAI50Uk5TABZHbpW80t3u+bttRhUKT5H+/9GQTgkCPJnxok0DCGreaQd05nLf41Qgs7EeUFYTx8QSGtYdKOLhJxvg5B/VxZRS8O+ysHVw5f/+Z//cAUE+nptL+IzP+P79FOxEa/SS7bnT6/j55/Lo+/328vfzzkqdmkA922ZzSa5MUY7CBg/Q1CYZEQSIVW8zjUWTutnbD5QAAARSSURBVHic7dlpSBRRHADw918tz1axVjNTyQ+S6WIWnVKoWUInHWAKRRcERUX0oYMo6EA6iOpDQQcihV0UJYREQUREJ5UZlgVR2U1JnpWV02y17s6b/7t2pijY/wdx33s7v5l99xsgfyEgiASRIPK/IeANomlaaEcYQIu9iBOgPYouqjl08Z1NSIJ+rc+MvHA9r8E6kgLQzC3Q1geeWEOcLmgU3QaJg7f8++AjfSPfCwlPuOBhoEgGvJEiPJEI9wNC3I8jpQ29CfS6p46kNToUCE+ERbAaAAvJhueKBiGpcFsJGVwbrWzoTw83FZCh8DgAg5B0uCqNjIQHARmEDIDLkkh2N1EXZkdWK1IvCJLmVK9zX7gbzHeIIHnsBi8TnR8lkP5Sozcnsi8KkYzEuxaRnA668k1IIaNDKcTg8wLE/dKyQUjkCy7idAfaQwxXaTfWK4WMu2WDQciQcxwkLf2GLUhch6GrGZFU8SpnmL4kui4sNeIsE0mI4M/Vegz3zDKd10TFcqGKhUzBRjezIaOMPs1Cpl6SMySUvFMMJD5L0NmH+2ZkkRL+za8V+yMxIdKGWMk/iSOx/KVDgXGtKlDGnMCR7tx5vYBeD/OVwuMoArG8ld7Ytt//RJNWGaUIKjHEEcv5TtdzRIe8cUkp4w9jSEiMlFFNcqSUCYcwJNQpNuK+V+t/pZRJFRgSGc4q31UfcY5fo8Xkz14lip6gumJKOYbMO40U9QT1HJ7wPQtTgQ8YksuYrxBDRnE+xZA5VeaSLENCmXoQQyIiFAxdSfJu9HBl2gFphGkIFRzBfi6OIVLwnwupeK4hUPCKNzdhgcFX8CZs6ozTX3sNB97w9F7Z6VUST1JZeGekV/Mz4KXI8FOS4LgxBx9WosKMpYobxIafknzMmIEPkNHdjaVmPpcwfErKUWM6PtT3CKUmrZJnEoZXST1iTC2qq8EQ0lMzliv9eYBWSUSBlpu1y/e/P9KrU3g9+WAtJFzfbURm78QR4eJOIQbeZyzuyPIKumzAMWeH3wcDsqKc2BXztrOQhI9RNhnz65lbB9KvySZkwVb/T39mO+f6ajj7oDr5yv22IE3GzkBvsXvLHZ/yI7fGeAREr7FX7bMByafmFtNCPvM1naIcC8uoBBOSlXDHotHupk8izVuSNXutvVPRFm2mk5ALCnZ1oli0yZSEHQ8m11owFsMGGYSsh90BG8vOyB10WjmydXXD3gvglTxCexSQkT5+HZbMaEkbd2p4BjeyPqkcoxMyqId67S8OW4tnMPvEZtim1l80bam5XQkQQmK+KL2kWbKamce721GN8uPYwgt4dQgRfYipFB7l/Yy2ifSaXgEh8TltdULCNXcP/xWCsHLTMhxXuAXmQzirwqURPbaUTcA3Wvoarj6/WbQgl33BnDIk41HIOSqxKD7p1SmpVy3yfaE05142tJSVHCPFR1Y/y6zRamvEX1JFLEQQCSJB5B9BfgCwNDJ0if9eSgAAAABJRU5ErkJggg==";class dg extends Dc{offsetY=0;setY=0;_last=0;_lastTop=!1;constructor(e){super(e,0,0,0,0),this.scale.cb=()=>{this.refresh()}}cropBottom(e,t=!1){this._last==e&&!this._lastTop&&!t||(this._last=e,this._lastTop=!1,this._height=this.texture.height-e/Math.abs(this.scale.y),this._bottomHeight=0,this.offsetY=0,this.topHeight=this.texture.height-e/Math.abs(this.scale.y),this._updateY())}cropTop(e,t=!1){this._last==e&&this._lastTop&&!t||(this._last=e,this._lastTop=!0,this._height=this.texture.height-e/Math.abs(this.scale.y),this._topHeight=0,this.bottomHeight=this.texture.height-e/Math.abs(this.scale.y),this.offsetY=e/Math.abs(this.scale.y),this._updateY())}get y(){return this.setY}set y(e){this.setY=e,this._updateY()}_updateY(){super.y=this.setY+this.offsetY*Math.abs(this.scale.y)}refresh(){this._lastTop?this.cropTop(this._last,!0):this.cropBottom(this._last,!0)}}class ju extends dg{constructor(e,t=64){super(e),this.scale.set(t/this.texture.width),this.pivot.x=t/2/this.scale.x,this.texture.on("update",()=>{this.width=this.texture.width,this.height=this.texture.height,this.scale.set(t/this.texture.width),this.pivot.x=t/2/this.scale.x,this.refresh()})}}class Rg extends ju{_playing=!1;_autoUpdate=!1;_isConnectedToTicker=!1;_tickerUpdate=this.update.bind(this);_currentTime=0;_textures;_previousFrame=null;onComplete=null;onLoop=null;onFrameChange=null;animationSpeed=1;loop=!1;updateAnchor=!1;constructor(e,t){super(e[0],t),this.textures=e}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(St.shared.remove(this._tickerUpdate),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(St.shared.add(this._tickerUpdate,this,Lc.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(e){this.stop(),this.currentFrame=e}gotoAndPlay(e){this.currentFrame=e,this.play()}update(e){if(!this._playing)return;const t=this.animationSpeed*e,n=this.currentFrame;this._currentTime+=t,this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete?.()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete?.()):n!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<n||this.animationSpeed<0&&this.currentFrame>n)&&this.onLoop(),this.updateTexture())}updateTexture(){const e=this.currentFrame;this._previousFrame!==e&&(this._previousFrame=e,this.texture=this._textures[e],this.onFrameChange?.(this.currentFrame))}destroy(e){this.stop(),super.destroy(e),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}get totalFrames(){return this._textures?.length??0}get textures(){return this._textures??[]}set textures(e){this._textures=e,this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()}get currentFrame(){let e=Math.floor(this._currentTime)%this._textures.length;return e<0&&(e+=this._textures.length),e}set currentFrame(e){if(e<0||e>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${e}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const t=this.currentFrame;this._currentTime=e,t!==this.currentFrame&&this.updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(St.shared.remove(this._tickerUpdate),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(St.shared.add(this._tickerUpdate),this._isConnectedToTicker=!0))}}const hg={Fake:Ce.from(cg),Lift:Ce.from(ug)};class vc extends fe{object;icon;constructor(e){super(),this.object=e,this.icon=new Ae(hg[e.note.type]),this.icon.anchor.set(.5),this.icon.scale.set(.3),this.icon.alpha=.8,this.icon.visible=!1,this.addChild(e,this.icon),e.nf.noteskin===void 0?re.on("noteskinLoaded",()=>this.loadEventHandler()):this.loadEventHandler()}loadEventHandler(){this.object.nf.noteskin.onUpdate(this,e=>{if(!y.chart.drawIcons){this.icon.visible=!1;return}if(this.object.nf.noteskinOptions?.hideIcons?.includes(this.object.note.type)){this.icon.visible=!1;return}this.icon.visible=!0,this.object.note.type=="Fake"&&(this.icon.visible=e.chartManager.getMode()!=q.Play)})}}class fg extends fe{type="note";note;nf;constructor(e,t){super(),this.note=t,this.nf=e,this.nf.noteskin===void 0?re.on("noteskinLoaded",()=>{this.loadElement(t)}):this.loadElement(t)}loadElement(e){const t=this.nf.noteskin.getElement({element:e.type,columnName:this.nf.getColumnName(e.col),columnNumber:e.col},{note:e});this.addChild(t)}}function pg(i){return i.cropTop!==void 0}class mg extends fe{type="hold";note;active;inactive;wasActive=!1;lastLength=null;elements;metrics;ns;nf;loaded=!1;constructor(e,t){super();const n=new fe,a=new fe;this.note=t,this.ns=e.noteskin,this.nf=e,this.metrics=this.ns.metrics,n.visible=!1,this.active=n,this.inactive=a,this.addChild(a,n),e.noteskin===void 0?re.on("noteskinLoaded",()=>{this.loadElements()}):this.loadElements()}loadElements(){if(!this.loaded){this.elements={};for(const e of["Active","Inactive"]){this.elements[e]={};for(const t of["BottomCap","Body","TopCap","Head"]){const n=this.getNoteskinElement(`${e} ${t}`);t=="BottomCap"?pg(n)?this.elements[e][t]=n:(y.debug.showNoteskinErrors&&de.createFormatted(`Noteskin Error: invalid tail found for ${e} ${t}!`,"error"),this.elements[e][t]=new ju(qu,64)):this.elements[e][t]=n,(e=="Active"?this.active:this.inactive).addChild(this.elements[e][t])}}this.loaded=!0}}getNoteskinElement(e){return this.ns.getElement({element:`${this.note.type} ${e}`,columnName:this.nf.getColumnName(this.note.col),columnNumber:this.note.col},{note:this.note})}setActive(e){this.wasActive!=e&&(this.wasActive=e,this.active.visible=e,this.inactive.visible=!e)}setBrightness(e){if(!this.loaded)return;const t=["Active","Inactive"],n=["Body","TopCap","BottomCap"];for(const a of t)for(const r of n)"tint"in this.elements[a][r]&&(this.elements[a][r].tint=ro(e*255,e*255,e*255))}setLength(e){if(!this.loaded||this.lastLength==e)return;this.lastLength=e;const t=this.metrics[`${this.note.type}BodyBottomOffset`],n=this.metrics[`${this.note.type}BodyTopOffset`],a=["Active","Inactive"],r=e>=0?1:-1,s=Math.abs(e);for(const o of a){this.elements[o].Body.height=Math.max(0,s+t-n),this.elements[o].Body.y=s+t,this.elements[o].BottomCap.y=s+t,this.elements[o].BottomCap.y<0?(this.elements[o].BottomCap.cropTop(-this.elements[o].BottomCap.y),e<0&&(this.elements[o].BottomCap.y-=this.elements[o].BottomCap.y/Math.abs(this.elements[o].BottomCap.scale.y))):this.elements[o].BottomCap.cropTop(0),this.elements[o].TopCap.y=n;const l=Math.abs(this.elements[o].BottomCap.scale.y);this.elements[o].BottomCap.scale.y=e<0?-l:l;const u=Math.abs(this.elements[o].TopCap.scale.y);this.elements[o].TopCap.scale.y=e<0?-u:u,this.elements[o].Body.height*=r,this.elements[o].Body.y*=r,this.elements[o].BottomCap.y*=r,this.elements[o].TopCap.y*=r}}}class xc extends fe{noteskinOptions;noteskin;gameType;renderer;receptors;notes;selectionNotes;flashes;holdJudges;ghostNote;ghostNoteEntry;columnX=[];constructor(e){super(),this.renderer=e,this.gameType=e.chart.gameType,it.getNoteskin(this.gameType,y.chart.noteskin.name).then(t=>{if(!t){de.createFormatted("Couldn't find an available noteskin!","error");return}let n=0;for(let a=0;a<this.gameType.numCols;a++){const r=this.gameType.columnWidths[a];this.columnX.push(n-this.gameType.notefieldWidth/2+r/2),n+=r}this.noteskinOptions=t,this.noteskin=new ng(this.renderer,t),this.receptors=new og(this),this.flashes=new sg(this),this.notes=new rg(this),this.selectionNotes=new lg(this),this.holdJudges=new Wi(this),this.addChild(this.receptors,this.notes,this.selectionNotes,this.flashes,this.holdJudges),re.emit("noteskinLoaded")})}setGhostNote(e){this.ghostNote?.destroy(),this.ghostNote=void 0,this.ghostNoteEntry=e,e&&(this.ghostNote=this.createNote(e),this.addChildAt(this.ghostNote,1),this.ghostNote.alpha=.4,this.ghostNote.x=this.getColumnX(e.col),this.ghostNote.y=this.renderer.getYPosFromBeat(e.beat))}getElement(e,t={}){return this.noteskin.getElement(e,t)}update(e,t){this.noteskin!==void 0&&(this.noteskin.update(this.renderer),this.receptors.update(),this.flashes.update(),this.notes.update(e,t),this.selectionNotes.update(e,t),this.holdJudges.update(),this.ghostNote&&(this.ghostNote.y=this.renderer.getYPosFromBeat(this.ghostNoteEntry.beat),this.ghostNote.visible=y.chart.mousePlacement&&this.renderer.chartManager.getMode()==q.Edit&&this.renderer.chartManager.editTimingMode==ke.Off&&this.ghostNoteEntry.beat>=e&&this.ghostNoteEntry.beat<=t&&this.ghostNoteEntry.beat>=0))}onJudgement(e,t){this.noteskin!==void 0&&(this.renderer.chartManager.getMode()==q.Play&&this.holdJudges.addJudge(e,t),bi(t)&&this.noteskin.broadcast({type:"hit",judgement:t,columnName:this.getColumnName(e),columnNumber:e}),dn(t)&&this.noteskin.broadcast({type:"held",columnName:this.getColumnName(e),columnNumber:e}),Vn(t)&&this.noteskin.broadcast({type:"letgo",columnName:this.getColumnName(e),columnNumber:e}),ui(t)&&this.noteskin.broadcast({type:"miss",judgement:t,columnName:this.getColumnName(e),columnNumber:e}),Ws(t)&&this.noteskin.broadcast({type:"hitmine",columnName:this.getColumnName(e),columnNumber:e}))}startPlay(){}endPlay(){if(this.noteskin!==void 0)for(let e=0;e<this.gameType.numCols;e++)this.noteskin.broadcast({type:"holdoff",columnName:this.getColumnName(e),columnNumber:e}),this.noteskin.broadcast({type:"rolloff",columnName:this.getColumnName(e),columnNumber:e}),this.noteskin.broadcast({type:"lift",columnName:this.getColumnName(e),columnNumber:e})}press(e){this.noteskin!==void 0&&this.noteskin.broadcast({type:"press",columnName:this.getColumnName(e),columnNumber:e})}lift(e){this.noteskin!==void 0&&this.noteskin.broadcast({type:"lift",columnName:this.getColumnName(e),columnNumber:e})}ghostTap(e){this.noteskin!==void 0&&this.noteskin.broadcast({type:"ghosttap",columnName:this.getColumnName(e),columnNumber:e})}activateHold(e){this.noteskin!==void 0&&this.noteskin.broadcast({type:"holdon",columnName:this.getColumnName(e),columnNumber:e})}releaseHold(e){this.noteskin!==void 0&&this.noteskin.broadcast({type:"holdoff",columnName:this.getColumnName(e),columnNumber:e})}activateRoll(e){this.noteskin!==void 0&&this.noteskin.broadcast({type:"rollon",columnName:this.getColumnName(e),columnNumber:e})}releaseRoll(e){this.noteskin!==void 0&&this.noteskin.broadcast({type:"rolloff",columnName:this.getColumnName(e),columnNumber:e})}getColumnX(e){return this.columnX[e]??0}getColumnWidth(e){return this.gameType.columnWidths[e]}getColumnName(e){return this.gameType.columnNames[e]}createNote(e){return Oe(e)?new vc(new mg(this,e)):new vc(new fg(this,e))}}class gg extends ye{renderer;constructor(e){super("",{fontName:"Fancy"}),this.anchor.set(.5),this.renderer=e}update(){this.y=y.chart.reverse?-50:50;const e=this.renderer.chartManager.gameStats;if(this.visible=this.renderer.chartManager.getMode()==q.Play,!e)return;const t=e.getCombo()==0?e.getMissCombo():e.getCombo();t<4?this.text="":this.text=t+"",e.getCombo()==0?this.tint=_t.getCollection(y.play.timingCollection).getMissJudgement().color:e.getBestJudge()?this.tint=so(e.getBestJudge().color,Math.sin(Date.now()/225)*.2+1.2):this.tint=16777215}}const bg=1,_c=15,yg={fontName:"Fancy",fontSize:12};class wg extends fe{barlines=new fe;barline;currentMedian;errorText=new ye("",yg);errorTextTime=-1;renderer;target=0;constructor(e){super(),this.renderer=e,this.barline=new Ae(Ce.WHITE),this.barline.anchor.set(.5),this.barline.height=1,this.barline.alpha=.5,ze(this.barline,"text-color");const t=new Ae(Ce.WHITE);t.width=2,t.height=_c,t.anchor.set(.5),ze(t,"text-color"),this.currentMedian=new ea,this.currentMedian.beginFill(16777215),this.currentMedian.moveTo(0,-10),this.currentMedian.lineTo(5,-15),this.currentMedian.lineTo(-5,-15),this.currentMedian.lineTo(0,-10),ze(this.currentMedian,"text-color"),this.errorText.y=-25,this.errorText.anchor.set(.5),this.addChild(this.barline,t,this.barlines,this.currentMedian,this.errorText)}update(){this.y=y.chart.reverse?-10:10,this.errorText.y=y.chart.reverse?25:-25,this.visible=this.renderer.chartManager.getMode()==q.Play;for(const e of this.barlines.children){const t=(Date.now()-e.createTime)/5e3;t<.05?e.alpha=1:t<.3?e.alpha=et(1,.2,(t-.05)/.25):t<.9?e.alpha=.2:e.alpha=(1-t)*3}this.errorText.alpha=Se((2e3-(Date.now()-this.errorTextTime))/1e3,0,1),this.barline.width=_t.getCollection(y.play.timingCollection).maxWindowMS()/1e3*2*400,di(this.barlines.children,e=>Date.now()-e.createTime>5e3),y.general.smoothAnimations?this.currentMedian.x=(this.currentMedian.x-this.target)*.8+this.target:this.currentMedian.x=this.target}addBar(e,t){if(e==null||!ui(t)&&!bi(t))return;const n=new Ae(Ce.WHITE);n.width=bg,n.height=_c,n.anchor.set(.5),n.x=e*400,n.tint=t.color,n.createTime=Date.now(),n.miss=ui(t),n.ms=Math.round(e*1e3),this.errorText.tint=t.color,this.errorText.text=(e*1e3).toFixed(1)+"ms",this.errorTextTime=Date.now(),this.barlines.addChild(n),this.target=Ha(this.barlines.children.filter(a=>!a.miss).map(a=>a.ms))*.4}reset(){this.currentMedian.x=0,this.target=0,di(this.barlines.children,()=>!0)}}class vg extends Ae{createTime=-1;active=!1;type=Us;constructor(){super(),this.anchor.set(.5)}update(){if(this.y=y.chart.reverse?40:-40,this.visible=this.active,this.active){const e=(Date.now()-this.createTime)/1e3;let t=1.2;if(_t.getCollection(y.play.timingCollection).shouldHideNote(this.type)||(t=.8),e<.1){const n=1-(1-e/.1)*(1-e/.1),a=(1-t)*n+t;this.scale.x=.4*a,this.scale.y=.4*a}else if(e>.6&&e<.8){const n=(e-.6)/.2*(e-.6)/.2;this.scale.x=.4*(1-n),this.scale.y=.4*(1-n)}else e>.8&&(this.active=!1)}}doJudge(e,t){if(e==null&&(e=0),!bi(t)&&!ui(t))return;const n=t.judgementTexture.getTexture(e,t);n&&(this.texture=n,this.texture.updateUvs(),this.active=!0,this.type=t,this.createTime=Date.now(),y.play.judgementTilt?this.rotation=Se(e,-.05,.05)*300/180*Math.PI:this.rotation=0)}reset(){this.active=!1}}class mi extends ra{static options;static convertText;static convertBtnOne;static convertBtnTwo;static onTimingChange=this.updateValues.bind(this);onConfirm=()=>{};persistent=!1;static open(e){super._open({...e,title:"Column",description:"",width:255,editable:!0,cancelableOnOpen:!1}),re.on("timingModified",this.onTimingChange),this.updateValues()}static buildContent(){const e=document.createElement("div");e.style.display="flex",e.style.gap="0.25rem",e.style.alignItems="center",e.style.flexDirection="column",e.style.marginTop="0.6rem",e.style.fontSize="0.75rem";const t=document.createElement("div"),n=document.createElement("button"),a=document.createElement("button");this.convertBtnOne=n,this.convertBtnTwo=a,this.convertText=t,e.replaceChildren(t,n,a),this.view.appendChild(e)}static close(){!this.popup||!this.active||(super.close(),re.off("timingModified",this.onTimingChange))}static updateValues(){const e=this.options.timingData.isPropertyChartSpecific(this.options.type),t=e?"chart":"song";this.title.innerText=$e[t].title,this.desc.innerText=$e[t].desc,this.convertText.innerText=$e[t].convertText,this.convertBtnOne.innerText=$e[t].buttonOne.text,this.convertBtnTwo.innerText=$e[t].buttonTwo.text,this.convertBtnTwo.classList.toggle("delete",e),Xe(this.convertBtnOne,{content:$e[t].buttonOne.tooltip}),Xe(this.convertBtnTwo,{content:$e[t].buttonTwo.tooltip}),this.convertBtnOne.onclick=()=>{$e[t].buttonOne.action(this.options.timingData,this.options.type),this.close()},this.convertBtnTwo.onclick=()=>{$e[t].buttonTwo.action(this.options.timingData,this.options.type),this.close()}}}const ya={BPMS:{title:"BPM Event",rows:[{label:"Tempo",key:"value",input:{type:"spinner"}}]},STOPS:{title:"Stop Event",description:"Stops for a number of seconds. Notes on this beat are hit before the stop occurs.",rows:[{label:"Seconds",key:"value",input:{type:"spinner"}}]},WARPS:{title:"Warp Event",description:"Warps ahead a number of beats. Warped notes do not count towards score.",rows:[{label:"Beats",key:"value",input:{type:"spinner",min:0}}]},DELAYS:{title:"Delay Event",description:"Stops for a number of seconds. Notes on this beat are hit after the delay occurs.",rows:[{label:"Seconds",key:"value",input:{type:"spinner"}}]},SCROLLS:{title:"Scroll Event",description:"Notes after this event will scroll at the specified speed.",rows:[{label:"Multiplier",key:"value",input:{type:"spinner"}}]},TICKCOUNTS:{title:"Tickcount Event",description:"Number of ticks per beat in a hold. Only applies to pump gamemodes.",rows:[{label:"Ticks",key:"value",input:{type:"spinner",step:1,precision:0,minPrecision:null,min:0}}]},FAKES:{title:"Fake Event",description:"Creates an area of notes that cannot be hit and do not count towards score.",rows:[{label:"Beats",key:"value",input:{type:"spinner",min:0}}]},LABELS:{title:"Label Event",rows:[{label:"Label",key:"value",input:{type:"text"}}]},SPEEDS:{title:"Speed Event",width:200,description:"The entire playfield scrolls at the specified speed. Can slowly ease over a certain amount of time.",rows:[{label:"Multiplier",key:"value",input:{type:"spinner"}},{label:"Ease time",key:"delay",input:{type:"spinner",min:0}},{label:"Ease unit",key:"unit",input:{type:"dropdown",items:["Beats","Seconds"],transformers:{serialize:i=>i=="B"?"Beats":"Seconds",deserialize:i=>i=="Beats"?"B":"T"}}}]},TIMESIGNATURES:{title:"Time Signature Event",width:200,rows:[{label:"Upper",key:"upper",input:{type:"spinner",step:1,precision:0,minPrecision:null,min:1}},{label:"Lower",key:"lower",input:{type:"spinner",step:1,precision:0,minPrecision:null,min:1}}]},COMBOS:{title:"Combo Event",width:200,description:"Multiplies the combo gained from hitting/missing notes after this event.",rows:[{label:"Hit multiplier",key:"hitMult",input:{type:"spinner",step:1,precision:0,minPrecision:null,min:0}},{label:"Miss multiplier",key:"missMult",input:{type:"spinner",step:1,precision:0,minPrecision:null,min:0}}]},ATTACKS:{title:"Attack Event",width:200,description:"Applies a modifier to the playfield. Can specify the length of the applied attack in seconds or the end time of the attack.",rows:[{label:"Timing type",key:"endType",input:{type:"dropdown",items:["Length","End"],transformers:{serialize:i=>i=="LEN"?"Length":"End",deserialize:i=>i=="Length"?"LEN":"END"}}},{label:"Seconds",key:"value",input:{type:"spinner"}},{label:"Mods",key:"mods",input:{type:"text"}}]},BGCHANGES:{title:"BG Change Event",width:250,rows:[{label:"File",key:"file",input:{type:"text"}},{label:"Update rate",key:"updateRate",input:{type:"spinner",precision:3,min:0}},{label:"Crossfade",key:"crossfade",input:{type:"checkbox"}},{label:"StretchRewind",key:"stretchRewind",input:{type:"checkbox"}},{label:"StretchNoLoop",key:"StretchNoLoop",input:{type:"checkbox"}},{label:"Effect",key:"effect",input:{type:"text"}},{label:"File2",key:"file2",input:{type:"text"}},{label:"Transition",key:"transition",input:{type:"text"}},{label:"Color1",key:"color1",input:{type:"text"}},{label:"Color2",key:"color2",input:{type:"text"}}]},FGCHANGES:{title:"FG Change Event",width:250,rows:[{label:"File",key:"file",input:{type:"text"}},{label:"Update rate",key:"updateRate",input:{type:"spinner",precision:3,min:0}},{label:"Crossfade",key:"crossfade",input:{type:"checkbox"}},{label:"StretchRewind",key:"stretchRewind",input:{type:"checkbox"}},{label:"StretchNoLoop",key:"StretchNoLoop",input:{type:"checkbox"}},{label:"Effect",key:"effect",input:{type:"text"}},{label:"File2",key:"file2",input:{type:"text"}},{label:"Transition",key:"transition",input:{type:"text"}},{label:"Color1",key:"color1",input:{type:"text"}},{label:"Color2",key:"color2",input:{type:"text"}}]}};class Ke extends ra{static options;static cachedEvent;static rows=[];static onTimingChange;static open(e){this.active||(super._open({...e,attach:e.box.backgroundObj,title:ya[e.box.event.type].title,description:ya[e.box.event.type].description,width:ya[e.box.event.type].width??150,editable:!0,cancelableOnOpen:!1,background:Ba(yi[e.box.event.type].toString(16).padStart(6,"0"),"#333333",.75),textColor:"#ffffff",options:[{label:"Ok",type:"confirm",callback:()=>{this.close(),this.options.onConfirm(this.cachedEvent)}},{label:"Delete",type:"delete",callback:()=>{this.options.modifyBox||this.options.timingData.delete([{type:this.cachedEvent.type,[this.cachedEvent.type=="ATTACKS"?"second":"beat"]:this.cachedEvent.type=="ATTACKS"?this.cachedEvent.second:this.cachedEvent.beat}]),this.close()}}]}),this.cachedEvent=structuredClone(e.box.event),this.onTimingChange=this.updateValues.bind(this),re.on("timingModified",this.onTimingChange))}static buildContent(){const e=ya[this.options.box.event.type],t=document.createElement("div");t.classList.add("popup-grid"),this.view.appendChild(t),e.rows.forEach(n=>t.append(...this.buildRow(n)))}static buildRow(e){const t=structuredClone(this.options.box.event),n=document.createElement("div");n.innerText=e.label,n.classList.add("popup-label");const a=[];switch(a.push(n),e.input.type){case"spinner":{const r=ct.create({value:t[e.key],precision:Tc,minPrecision:Ci,...e.input});r.onchange=s=>{s!==void 0&&this.modifyEvent(e.key,s)},this.rows.push({data:e,el:r}),a.push(r.view);break}case"text":{const r=document.createElement("input");r.type="text",r.autocomplete="off",r.spellcheck=!1,r.onkeydown=s=>{s.key=="Enter"&&r.blur()},r.onblur=()=>{this.modifyEvent(e.key,r.value)},r.value=t[e.key],this.rows.push({data:e,el:r}),a.push(r);break}case"dropdown":{if(e.input.transformers){const r=e.input.transformers.deserialize,s=e.input.transformers.serialize,o=hi.create(e.input.items,s(t[e.key]));o.onChange(l=>{this.modifyEvent(e.key,r(l))}),this.rows.push({data:e,el:o}),a.push(o.view)}else{const r=hi.create(e.input.items,t[e.key]);r.onChange(s=>{this.modifyEvent(e.key,s)}),this.rows.push({data:e,el:r}),a.push(r.view)}break}case"checkbox":{const r=document.createElement("input");r.type="checkbox",r.checked=t[e.key],r.onchange=()=>{this.modifyEvent(e.key,r.checked)},this.rows.push({data:e,el:r}),a.push(r);break}}return a}static modifyEvent(e,t){this.options.modifyBox?Object.assign(this.options.box.event,{[e]:t}):this.options.timingData.modify([[structuredClone(this.options.box.event),Object.assign(this.options.box.event,{[e]:t})]]),this.cachedEvent=structuredClone(this.options.box.event)}static updateValues(){const e=this.options.timingData.getEventAtBeat(this.options.box.event.type,this.options.box.event.beat,!1);if(!this.options.box||!e||e.beat!=this.options.box.event.beat){this.close();return}this.rows.forEach(t=>{switch(t.data.input.type){case"spinner":{t.el.value=e[t.data.key];break}case"text":{t.el.value=e[t.data.key];break}case"dropdown":{const n=t.el;t.data.input.transformers?n.setSelected(t.data.input.transformers.serialize(e[t.data.key])):n.setSelected(e[t.data.key]);break}case"checkbox":{t.el.checked=e[t.data.key];break}}})}static close(){this.active&&(super.close(),re.off("timingModified",this.onTimingChange))}static getEvent(){return this.cachedEvent}static attach(e){super.attach(e.backgroundObj),this.options.box=e,this.cachedEvent=e.event}}const ka={fontName:"Main",fontSize:15},ri={BPMS:55,STOPS:55,DELAYS:55,WARPS:55,FAKES:55,COMBOS:40,SPEEDS:80,LABELS:80,SCROLLS:55,TIMESIGNATURES:40,TICKCOUNTS:40,BGCHANGES:55,FGCHANGES:55,ATTACKS:55};class xg extends fe{tracks=new fe;renderer;timingBoxMap=new Map;wasEditingTiming=!1;boxPool=new Xi({create:()=>{const e=new fe;return e.textObj=new ye("",ka),e.backgroundObj=new dt,e.selection=new dt("onlyBorder"),e.selection.tint=3841008,e.addChild(e.backgroundObj,e.textObj,e.selection),e}});ghostBox;timingDirty=!1;tracksDirty=!0;constructor(e){super(),this.renderer=e,this.boxPool.sortableChildren=!0,this.sortableChildren=!0,this.addChild(this.tracks,this.boxPool);const t=()=>{this.timingDirty=!0,this.tracksDirty=!0},n=a=>{a.startsWith("chart.timingEventOrder")&&(this.tracksDirty=!0)};re.on("timingModified",t),re.on("userOptionUpdated",n),this.on("destroyed",()=>{re.off("timingModified",t),re.off("userOptionUpdated",n)})}update(e,t){this.renderer.chartManager.editTimingMode!=ke.Add&&(this.ghostBox?.removeFromParent(),this.ghostBox?.destroy(),this.ghostBox=void 0),this.updateTracks(),this.updateBoxes(e,t)}createTrack(e,t){const n=Object.assign(new fe,{alpha:0,name:e,x:t,type:e,timingMode:"song",background:new Ae(Ce.WHITE),btns:new fe});n.background=new Ae(Ce.WHITE),n.background.width=ri[e],n.background.height=5e3,n.background.tint=2503250,n.background.anchor.y=.5,n.background.alpha=0,n.btns.y=this.renderer.getActualReceptorYPos()+(y.chart.reverse?50:-50);const a=new fe,r=new dt,s=new ye(e,ka);return r.width=20,r.height=20,ze(r,"widget-bg"),r.pivot.set(10,10),s.anchor.set(.5,.55),s.text="S",ze(s,"text-color"),a.alpha=.4,a.name="timingTypeBtn",a.eventMode="static",a.on("mouseenter",()=>{mi.persistent||mi.open({attach:a,type:e,timingData:this.renderer.chart.timingData})}),a.on("mouseleave",()=>{mi.persistent||mi.close()}),a.on("pointerdown",()=>{mi.persistent&&mi.open({attach:a,type:e,timingData:this.renderer.chart.timingData}),mi.select()}),a.addChild(r,s),n.btns.addChild(a),n.addChild(n.background,n.btns),this.tracks.addChild(n),n}initializeBox(e,t){if($t.stop(e.animationId),Object.assign(e,{event:t,lastX:void 0,lastAnchor:void 0,animationId:void 0,zIndex:t.beat,eventMode:"static"}),e.textObj.text=this.getLabelFromEvent(t),e.textObj.anchor.set(.5,.55),e.backgroundObj.width=e.textObj.width+10,e.backgroundObj.height=25,e.backgroundObj.position.x=-e.backgroundObj.width/2,e.backgroundObj.position.y=-25/2,e.selection.width=e.textObj.width+10,e.selection.height=25,e.selection.position=e.backgroundObj.position,Ke.active){const n=Ke.getEvent();n.type=="ATTACKS"&&t.type=="ATTACKS"&&n.second==t.second&&Ke.attach(e),n.type!="ATTACKS"&&t.type!="ATTACKS"&&n.type==t.type&&n.beat==t.beat&&Ke.attach(e)}}addDragListeners(e,t){e.on("mouseenter",()=>{Ke.persistent||this.renderer.chartManager.eventSelection.timingEvents.length>0||this.renderer.isDragSelecting()||(Ke.active&&Ke.close(),this.renderer.chartManager.getMode()==q.Edit&&Ke.open({box:e,timingData:this.getTargetTimingData(e.event),modifyBox:!1,onConfirm:()=>{this.renderer.chartManager.removeEventFromSelection(t)}}))}),e.on("mouseleave",()=>{Ke.persistent||Ke.close()});let n=0,a;const r=s=>{const o=a,l=this.toLocal(s.global);if(Math.abs(l.y-n)<32){this.renderer.chartManager.eventSelection.shift&&(this.renderer.chartManager.eventSelection.shift={beatShift:0});return}Ke.close();const u=this.renderer.getBeatFromYPos(l.y),f=y.chart.snap==0?1/48:y.chart.snap;let c=Math.round(u/f)*f;Math.abs(c-u)>Math.abs(u-o.beat)&&(c=o.beat),this.renderer.chartManager.eventSelection.shift||={beatShift:0},this.renderer.chartManager.eventSelection.shift.beatShift=Math.max(-Math.min(...this.renderer.chartManager.eventSelection.timingEvents.map(d=>d.beat)),c-o.beat)};e.on("pointerdown",s=>{if(Os(s)){this.renderer.chartManager.clearSelections(),this.renderer.chartManager.addEventToSelection(t),Ke.close();return}if(s.stopImmediatePropagation(),this.renderer.chartManager.isEventInSelection(t)?(s.getModifierState("Control")||s.getModifierState("Meta"))&&this.renderer.chartManager.removeEventFromSelection(t):(!s.getModifierState("Control")&&!s.getModifierState("Meta")&&!s.getModifierState("Shift")&&this.renderer.chartManager.clearSelections(),this.renderer.chartManager.addEventToSelection(t)),this.renderer.chartManager.getMode()==q.Edit&&this.renderer.chartManager.eventSelection.timingEvents.length==1&&Ke.options?.box!=e&&(Ke.close(),Ke.open({box:e,timingData:this.getTargetTimingData(e.event),modifyBox:!1,onConfirm:()=>{this.renderer.chartManager.removeEventFromSelection(t)}})),Ke.active&&!s.getModifierState("Control")&&!s.getModifierState("Meta")&&!s.getModifierState("Shift")?Ke.select():Ke.close(),n=e.y,a=t,this.renderer.chartManager.editTimingMode==ke.Add)return;this.renderer.on("pointermove",r);const o=()=>{this.renderer.off("pointermove",r),this.renderer.off("pointerup",o),(this.renderer.chartManager.eventSelection.shift?.beatShift??0)!=0&&this.renderer.chartManager.modifyEventSelection(l=>(l.type=="ATTACKS"&&(l.second=this.renderer.chart.timingData.getSecondsFromBeat(l.beat+this.renderer.chartManager.eventSelection.shift.beatShift)),l.beat+=this.renderer.chartManager.eventSelection.shift.beatShift,l)),this.renderer.chartManager.eventSelection.shift=void 0};this.renderer.on("pointerup",o)})}updateTracks(){const e=this.renderer.chartManager.editTimingMode!=ke.Off&&this.renderer.chartManager.getMode()==q.Edit;if(e&&this.tracks.children.forEach(s=>{s.btns.y=this.renderer.getActualReceptorYPos()+(y.chart.reverse?50:-50)}),!this.tracksDirty&&this.wasEditingTiming==e)return;this.wasEditingTiming=e,this.tracksDirty=!1;const t=y.chart.timingEventOrder.left,n=y.chart.timingEventOrder.right;this.tracks.children.forEach(s=>{s.visible=!1});let a=-this.renderer.chart.gameType.notefieldWidth*.5-128;const r=(s,o,l,u,f)=>{$t.animate(s,{0:{[o]:"inherit"},1:{[o]:l}},u,ci(0,0,.16,1.01),()=>{},f)};for(let s=t.length-1;s>=0;s--){const o=t[s],l=this.tracks.getChildByName(o)??this.createTrack(o,a);l.visible=!0;const u=s%2==0?.1:0;r(l,"x",a,.3,`track-${o}-x`),r(l.btns,"x",-ri[o]/2,.3,`track-${o}-btn-x`),r(l.background,"anchor.x",1,.3,`track-${o}-anchor-x`),r(l.background,"alpha",e?u:0,.3,`track-${o}-bg-alpha`),a-=ri[o]}a=this.renderer.chart.gameType.notefieldWidth*.5+128;for(let s=0;s<n.length;s++){const o=n[s],l=this.tracks.getChildByName(o)??this.createTrack(o,a);l.visible=!0;const u=s%2==0?.1:0;r(l,"x",a,.3,`track-${o}-x`),r(l.btns,"x",ri[o]/2,.3,`track-${o}-btn-x`),r(l.background,"anchor.x",0,.3,`track-${o}-anchor-x`),r(l.background,"alpha",e?u:0,.3,`track-${o}-bg-alpha`),a+=ri[o]}for(const s of this.tracks.children)r(s,"alpha",e?1:0,.3,`track-${s.type}-alpha`);e||mi.close(),this.tracks.children.forEach(s=>{const o=s.btns.getChildByName("timingTypeBtn"),l=o?.children[1];o&&(o.eventMode=e?"static":"none"),l&&(l.text=this.renderer.chart.timingData.isPropertyChartSpecific(s.type)?"C":"S")})}updateBoxes(e,t){this.timingDirty&&(this.timingBoxMap.clear(),this.boxPool.destroyAll(),this.timingDirty=!1);const n=this.renderer.chartManager.editTimingMode!=ke.Off&&this.renderer.chartManager.getMode()==q.Edit;this.boxPool.visible=this.renderer.shouldDisplayBarlines(),this.ghostBox&&(this.ghostBox.visible=this.renderer.shouldDisplayBarlines()&&n);for(const r of this.renderer.chart.timingData.getTimingData()){if(t<r.beat)break;if(!(!y.chart.timingEventOrder.left.includes(r.type)&&!y.chart.timingEventOrder.right.includes(r.type))&&!(e>r.beat)&&!this.timingBoxMap.has(r)){const s=this.boxPool.createChild();if(!s)break;this.initializeBox(s,r),this.addDragListeners(s,r),this.timingBoxMap.set(r,s)}}const a={beat:-Number.MAX_SAFE_INTEGER,second:-Number.MAX_SAFE_INTEGER,leftOffset:0,rightOffset:0};for(const[r,s]of this.timingBoxMap.entries()){if(r.beat<e||r.beat>t||!y.chart.timingEventOrder.left.includes(r.type)&&!y.chart.timingEventOrder.right.includes(r.type)){this.timingBoxMap.delete(r),Ke.options?.box==s?Ke.detach():Ke.persistent||Ke.close(),this.boxPool.destroyChild(s);continue}let o=0,l=0;const u=s.backgroundObj.width,f=y.chart.timingEventOrder.right.includes(r.type)?"right":"left";n?(o=this.tracks.getChildByName(r.type)?.x??s.x,o+=ri[r.type]/2*(o>0?1:-1),l=.5):(o=(f=="right"?1:-1)*(this.renderer.chart.gameType.notefieldWidth*.5+80),f=="left"&&(o-=30),(a.beat!=r.beat||r.second&&a.second!=r.second)&&(a.leftOffset=0,a.rightOffset=0,a.beat=r.beat,a.second=r.second),f=="left"?(o-=a.leftOffset,a.leftOffset+=u+5):(o+=a.rightOffset,a.rightOffset+=u+5),l=f=="right"?0:1),s.lastX===void 0||s.lastAnchor===void 0?(s.x=o,s.pivot.x=(l-.5)*u):(s.lastX!=o||s.lastAnchor!=l)&&(s.animationId=$t.animate(s,{0:{x:"inherit","pivot.x":"inherit"},1:{x:o,"pivot.x":(l-.5)*u}},.3,ci(0,0,.16,1.01),()=>{},s.animationId)),s.lastX=o,s.lastAnchor=l,s.y=y.chart.CMod&&r.type=="ATTACKS"?this.renderer.getYPosFromSecond(r.second):this.renderer.getYPosFromBeat(r.beat);const c=this.renderer.shouldDisplayEventSelection(r);if(s.backgroundObj.tint=c?so(yi[r.type]??0,Math.sin(Date.now()/320)*.4+1.5):yi[r.type]??0,s.selection.alpha=c?1:0,s.visible=!c||!this.renderer.chartManager.eventSelection.shift,this.renderer.chartManager.editTimingMode!=ke.Off){const d=this.renderer.selectionTest(s);!c&&d&&this.renderer.chartManager.addEventToDragSelection(r),c&&!d&&this.renderer.chartManager.removeEventFromDragSelection(r)}}}updateGhostEvent(e){const t=y.chart.snap==0?.020833333333333332:y.chart.snap,n=Math.round(this.renderer.getBeatFromYPos(e.y)/t)*t,a=Ke.active&&Ke.options?.box==this.ghostBox,r=a?this.ghostBox.event.type:this.getClosestTrack(e.x)?.name;if(!r){this.ghostBox?.removeFromParent(),this.ghostBox?.destroy(),this.ghostBox=void 0;return}if(!this.ghostBox){const l=new fe;l.textObj=new ye("",ka),l.backgroundObj=new dt,l.selection=new dt("onlyBorder"),l.guideLine=new Ae(Ce.WHITE),l.selection.tint=3841008,l.selection.alpha=0,l.addChild(l.guideLine,l.backgroundObj,l.textObj,l.selection),this.addChild(l),l.visible=this.renderer.shouldDisplayBarlines(),l.textObj.anchor.set(.5,.55),l.backgroundObj.height=25,l.selection.height=25,l.guideLine.height=1,l.guideLine.anchor.y=.5,this.ghostBox=l}!a&&(this.ghostBox.event?.beat!=n||this.ghostBox.event?.type!=r)&&(this.ghostBox.event=structuredClone(this.renderer.chart.timingData.getEventAtBeat(r,n))??this.renderer.chart.timingData.getDefaultEvent(r,n),this.ghostBox.event.beat=n,r=="ATTACKS"&&(this.ghostBox.event.second=this.renderer.chart.getSecondsFromBeat(n)),this.ghostBox.textObj.text=this.getLabelFromEvent(this.ghostBox.event),this.ghostBox.backgroundObj.width=this.ghostBox.textObj.width+10,this.ghostBox.selection.width=this.ghostBox.textObj.width+10),this.ghostBox.alpha=a?1:.4,this.ghostBox.selection.alpha=a?1:0,this.ghostBox.name=r;const s=this.renderer.getYPosFromBeat(a?this.ghostBox.event.beat:n);let o=this.tracks.getChildByName(r).x;o+=ri[r]/2*(o>0?1:-1),this.ghostBox.position.x=o,this.ghostBox.backgroundObj.tint=yi[r]??0,this.ghostBox.backgroundObj.position.x=-this.ghostBox.backgroundObj.width/2,this.ghostBox.backgroundObj.position.y=-25/2,this.ghostBox.guideLine.anchor.x=o<0?0:1,this.ghostBox.guideLine.width=Math.abs(this.ghostBox.position.x)+192-this.ghostBox.backgroundObj.width/2,this.ghostBox.guideLine.position.x=(o<0?1:-1)*this.ghostBox.backgroundObj.width/2,this.ghostBox.y=s,this.ghostBox.selection.position=this.ghostBox.backgroundObj.position}placeGhostEvent(){if(!this.ghostBox)return;const e=this.renderer.chart.timingData.getEventAtBeat(this.ghostBox.event.type,this.ghostBox.event.beat,!1);this.ghostBox.event.type=="ATTACKS"&&this.ghostBox.event.second==e?.second||this.ghostBox.event.type!="ATTACKS"&&this.ghostBox.event.beat==e?.beat||(this.renderer.chartManager.clearSelections(),Ke.open({box:this.ghostBox,timingData:this.getTargetTimingData(this.ghostBox.event),modifyBox:!0,onConfirm:t=>{this.getTargetTimingData(this.ghostBox.event).insert([t])}}),Ke.select())}getClosestTrack(e){let t=Number.MAX_SAFE_INTEGER,n=this.tracks.children[0];for(const a of this.tracks.children){const r=Math.abs(a.x+(.5-a.background.anchor.x)*a.width-e);r<t&&(n=a,t=r)}if(!(t>n.width))return n}getLabelFromEvent(e){let t="";switch(e.type){case"BPMS":case"STOPS":case"WARPS":case"DELAYS":case"TICKCOUNTS":case"FAKES":case"SCROLLS":t=ue(e.value,Ci).toString();break;case"SPEEDS":t=`${ue(e.value,Ci)}/${ue(e.delay,Ci)}/${e.unit}`;break;case"LABELS":t=e.value;break;case"TIMESIGNATURES":t=`${ue(e.upper,Ci)}/${ue(e.lower,Ci)}`;break;case"COMBOS":t=`${ue(e.hitMult,Ci)}/${ue(e.missMult,3)}`;break;case"BGCHANGES":case"FGCHANGES":t=e.file;break;case"ATTACKS":t=`${e.mods}`}return t}getTargetTimingData(e){return this.renderer.chart.timingData.isPropertyChartSpecific(e.type)?this.renderer.chart.timingData:this.renderer.chart.timingData.songTimingData}}class _g extends fe{children=[];renderer;timingBoxMap=new Map;trackPosCache=new Map;timingBoxPool=new Xi({create:()=>{const e=new fe;return e.guideLine=new Ae(Ce.WHITE),e.textObj=new ye("",ka),e.backgroundObj=new dt,e.addChild(e.guideLine,e.backgroundObj,e.textObj),e}});constructor(e){super(),this.renderer=e,this.timingBoxPool.sortableChildren=!0,this.addChild(this.timingBoxPool)}update(e,t){if(!this.renderer.chartManager.eventSelection.shift){this.timingBoxPool.destroyAll(),this.timingBoxMap.clear(),this.trackPosCache.clear();return}const n=this.renderer.chartManager.eventSelection.shift.beatShift;for(const a of this.renderer.chartManager.eventSelection.timingEvents)if(!(t<a.beat+n)&&!(e>a.beat+n)&&!this.timingBoxMap.has(a)){const r=this.timingBoxPool.createChild();if(!r)continue;this.timingBoxMap.set(a,r);let s="";switch(a.type){case"BPMS":case"STOPS":case"WARPS":case"DELAYS":case"TICKCOUNTS":case"FAKES":case"SCROLLS":s=ue(a.value,3).toString();break;case"SPEEDS":s=`${ue(a.value,3)}/${ue(a.delay,3)}/${a.unit}`;break;case"LABELS":s=a.value;break;case"TIMESIGNATURES":s=`${ue(a.upper,3)}/${ue(a.lower,3)}`;break;case"COMBOS":s=`${ue(a.hitMult,3)}/${ue(a.missMult,3)}`;break;case"BGCHANGES":case"FGCHANGES":s=a.file;break;case"ATTACKS":s=`${a.mods} (${a.endType}=${a.value})`}const o=y.chart.timingEventOrder.right.includes(a.type)?"right":"left";if(Object.assign(r,{alpha:.4,zIndex:a.beat}),r.textObj.text=s,r.textObj.anchor.set(.5,.55),r.backgroundObj.width=r.textObj.width+10,r.backgroundObj.height=25,r.backgroundObj.tint=yi[a.type]??0,r.backgroundObj.position.x=-r.backgroundObj.width/2,r.backgroundObj.position.y=-r.backgroundObj.height/2,r.guideLine.height=1,r.guideLine.anchor.set(o=="left"?0:1,.5),r.guideLine.width=Math.abs(r.position.x)+192-r.backgroundObj.width/2,r.guideLine.position.x=(o=="left"?1:-1)*r.backgroundObj.width/2,this.renderer.chartManager.editTimingMode!=ke.Off){let l=this.getTrackPos(a.type);l+=ri[a.type]/2*(l>0?1:-1),r.position.x=l,r.pivot.x=0}else{let l=(o=="right"?1:-1)*(this.renderer.chart.gameType.notefieldWidth*.5+80);o=="left"&&(l-=30),r.position.x=l,r.pivot.x=o=="right"?-r.backgroundObj.width/2:r.backgroundObj.width/2}}for(const[a,r]of this.timingBoxMap.entries()){if(t<a.beat+n||e>a.beat+n){this.timingBoxPool.destroyChild(r),this.timingBoxMap.delete(a);continue}r.y=y.chart.CMod&&a.second?this.renderer.getYPosFromSecond(a.second):this.renderer.getYPosFromBeat(a.beat+n)}}getTrackPos(e){if(this.trackPosCache.has(e))return this.trackPosCache.get(e);const t=y.chart.timingEventOrder.left,n=y.chart.timingEventOrder.right;let a=-this.renderer.chart.gameType.notefieldWidth*.5-128;for(let r=t.length-1;r>=0;r--){const s=t[r];this.trackPosCache.set(s,a),a-=ri[s]}a=this.renderer.chart.gameType.notefieldWidth*.5+128;for(let r=0;r<n.length;r++){const s=n[r];this.trackPosCache.set(s,a),a+=ri[s]}return this.trackPosCache.get(e)??0}}class Eg extends fe{chartManager;chart;speedMult=1;lastMousePos;lastMouseBeat=-1;lastMouseCol=-1;lastNoteType=null;lastHoldBeat=null;editingCol=-1;cachedBeat=0;cachedTime=0;waveform;barlines;timingAreas;timingTracks;selectedEvents;timingBar;notefield;snapDisplay;judgement;combo;selectionBoundary;selectionArea;previewArea;scrollDebug;parityDebug;selectionBounds;constructor(e){super(),this.chartManager=e,this.chart=e.loadedChart,this.waveform=new eg(this),this.barlines=new Ym(this),this.timingAreas=new Dm(this),this.timingTracks=new xg(this),this.selectedEvents=new _g(this),this.timingBar=new wg(this),this.notefield=new xc(this),this.snapDisplay=new Sm(this),this.previewArea=new Km(this),this.selectionArea=new Zm(this),this.judgement=new vg,this.combo=new gg(this),this.selectionBoundary=new Qm(this),this.scrollDebug=new Xm(this),this.parityDebug=new Em(this),this.addChild(this.waveform,this.barlines,this.timingAreas,this.previewArea,this.selectionArea,this.timingTracks,this.selectedEvents,this.timingBar,this.combo,this.notefield,this.snapDisplay,this.judgement,this.selectionBoundary,this.scrollDebug,this.parityDebug),this.chartManager.app.stage.addChild(this),this.eventMode="static",this.hitArea=new zn(-1e5,-1e5,2e5,2e5);const t=r=>{if(this.editingCol!=-1){const s=y.chart.snap==0?.020833333333333332:y.chart.snap,o=Math.round(this.getBeatFromYPos(this.lastMousePos.y)/s)*s;this.chartManager.editHoldBeat(this.editingCol,o,r.shiftKey)}};let n=0;const a=()=>{this.selectionBounds&&(this.selectionBounds.lastKnownBeat!=this.cachedBeat&&(this.selectionBounds.endBeat+=this.cachedBeat-this.selectionBounds.lastKnownBeat,this.selectionBounds.lastKnownBeat=this.cachedBeat,this.selectionBoundary.update()),n!=0&&(this.chartManager.beat=Math.max(0,this.chartManager.beat+n),this.selectionBounds.endBeat+=n,this.selectionBoundary.update()))};St.shared.add(a),window.addEventListener("keydown",t),this.on("destroyed",()=>{window.removeEventListener("keydown",t),this.removeAllListeners(),St.shared.remove(a)}),this.on("pointerdown",r=>{Os(r)||this.chartManager.getMode()==q.Play||this.chartManager.getMode()==q.View||(this.chartManager.editTimingMode==ke.Add&&this.lastMousePos?this.timingTracks.placeGhostEvent():this.chartManager.editTimingMode==ke.Off&&y.chart.mousePlacement&&this.lastMouseBeat!=-1&&this.lastMouseCol!=-1&&!r.getModifierState("Shift")?(this.chartManager.clearSelections(),this.editingCol=this.lastMouseCol,this.lastHoldBeat=null,this.chartManager.setNote(this.lastMouseCol,"mouse",this.lastMouseBeat)):(!r.getModifierState("Control")&&!r.getModifierState("Meta")&&!r.getModifierState("Shift")&&this.chartManager.clearSelections(),this.chartManager[this.chartManager.editTimingMode==ke.Off?"startDragSelection":"startDragEventSelection"](),this.selectionBounds={startX:this.toLocal(r.global).x,startBeat:this.getBeatFromYPos(this.toLocal(r.global).y),endX:this.toLocal(r.global).x,endBeat:this.getBeatFromYPos(this.toLocal(r.global).y),lastKnownBeat:this.cachedBeat},this.selectionBoundary.update()))}),this.on("mousemove",r=>{if(this.lastMousePos=this.toLocal(r.global),this.editingCol!=-1){const s=y.chart.snap==0?.020833333333333332:y.chart.snap,o=Math.round(this.getBeatFromYPos(this.lastMousePos.y)/s)*s;this.lastHoldBeat!=o&&(this.lastHoldBeat=o,this.chartManager.editHoldBeat(this.editingCol,o,r.shiftKey))}this.selectionBounds&&(this.selectionBounds.endBeat=this.getBeatFromYPos(this.toLocal(r.global).y),this.selectionBounds.endX=this.toLocal(r.global).x,this.selectionBounds.lastKnownBeat=this.cachedBeat,this.selectionBoundary.update()),n=Math.max(0,this.lastMousePos.y-this.getLowerBound()+100)/600,this.lastMousePos.y<0&&(n=Math.min(0,this.lastMousePos.y-this.getUpperBound()-100)/600),y.chart.reverse&&(n=Math.max(0,this.getUpperBound()-this.lastMousePos.y+100)/600,this.lastMousePos.y>0&&(n=Math.min(0,this.getLowerBound()-this.lastMousePos.y-100)/600))}),this.on("pointerup",()=>{this.editingCol!=-1&&(this.chartManager.endEditing(this.editingCol),this.editingCol=-1),this.chartManager[this.chartManager.editTimingMode==ke.Off?"endDragSelection":"endDragEventSelection"](),this.selectionBounds=void 0,this.selectionBoundary.update(),n=0})}isDragSelecting(){return!!this.selectionBounds}doJudgement(e,t,n){this.chartManager.getMode()==q.Play&&(this.judgement.doJudge(t,n),this.timingBar.addBar(t,n)),this.notefield.onJudgement(e.col,n)}startPlay(){this.notefield.startPlay()}endPlay(){this.notefield.endPlay(),this.timingBar.reset(),this.judgement.reset()}update(){if(this.destroyed)return;this.cachedBeat=this.chartManager.beat,this.cachedTime=this.chartManager.time,this.x=y.chart.receptorXPos,this.speedMult=y.chart.doSpeedChanges?this.getCurrentSpeedMult():1;const e=this.getTopOnScreenBeat(),t=this.getBottomOnScreenBeat(),n=Math.min(e,t),a=Math.max(e,t);if(this.scale.x=y.chart.zoom,this.scale.y=y.chart.zoom,this.children.forEach(r=>r.update(n,a)),this.notefield.alpha=this.chartManager.editTimingMode==ke.Off||this.chartManager.getMode()==q.Play?1:.3,y.chart.mousePlacement&&this.lastMousePos&&this.chartManager.getMode()!=q.Play){const r=y.chart.snap==0?.020833333333333332:y.chart.snap,s=Math.round(this.getBeatFromYPos(this.lastMousePos.y)/r)*r;let o=-1;for(let l=0;l<this.chart.gameType.numCols;l++){const u=this.chart.gameType.columnWidths[l],f=this.getXPosFromColumn(l);if(this.lastMousePos.x<f+u/2&&this.lastMousePos.x>f-u/2){o=l;break}}(s!=this.lastMouseBeat||o!=this.lastMouseCol||this.chartManager.getEditingNoteType()!=this.lastNoteType)&&(this.lastMouseBeat=s,this.lastMouseCol=o,this.lastNoteType=this.chartManager.getEditingNoteType(),this.editingCol!=-1&&this.chartManager.editHoldBeat(this.editingCol,s,!1),o===-1?(this.lastMouseBeat=-1,this.lastMouseCol=-1,this.notefield.setGhostNote()):this.notefield.setGhostNote(this.chart.computeNote({beat:s,col:this.lastMouseCol,type:this.chartManager.getEditingNoteType()})))}this.lastMousePos&&this.chartManager.editTimingMode==ke.Add&&this.timingTracks.updateGhostEvent(this.lastMousePos)}getTimeWithOffset(){let e=this.cachedTime;return(this.chartManager.getMode()==q.Play||this.chartManager.getMode()==q.Record)&&(e+=y.play.offset*y.audio.rate),e}getBeatWithOffset(){let e=this.cachedBeat;return(this.chartManager.getMode()==q.Play||this.chartManager.getMode()==q.Record)&&(e=this.chart.getBeatFromSeconds(this.getTimeWithOffset())),e}getVisualTime(){let e=this.cachedTime;return(this.chartManager.getMode()==q.Play||this.chartManager.getMode()==q.Record)&&(e+=(y.play.offset+y.play.visualOffset)*y.audio.rate),e}getVisualBeat(){let e=this.cachedBeat;return(this.chartManager.getMode()==q.Play||this.chartManager.getMode()==q.Record)&&(e=this.chart.getBeatFromSeconds(this.getVisualTime())),e}getXPosFromColumn(e){return this.notefield.getColumnX(e)}getYPosFromBeat(e){const t=this.getVisualTime(),n=this.getVisualBeat(),a=y.chart.reverse?-1:1;return y.chart.CMod?(this.chart.getSecondsFromBeat(e)-t)*this.getSecondsToPixelsRatio()*a+this.getActualReceptorYPos():n==e?this.getActualReceptorYPos():(y.chart.doSpeedChanges?this.chart.timingData.getEffectiveBeat(e)-this.chart.timingData.getEffectiveBeat(n):e-n)*this.getEffectiveBeatsToPixelsRatio()*a+this.getActualReceptorYPos()}getYPosFromSecond(e){const t=this.getVisualTime(),n=y.chart.reverse?-1:1;return y.chart.CMod?(e-t)*this.getSecondsToPixelsRatio()*n+this.getActualReceptorYPos():this.getYPosFromBeat(this.chart.timingData.getBeatFromSeconds(e))}getSecondFromYPos(e){const t=y.chart.reverse?-1:1;if(y.chart.CMod){const n=this.getPixelsToSecondsRatio(),a=this.getVisualTime(),s=(e-this.getActualReceptorYPos())*n*t;return a+s}return this.chart.getSecondsFromBeat(this.getBeatFromYPos(e))}getBeatFromYPos(e,t){const n=this.getVisualBeat(),a=y.chart.reverse?-1:1;if(y.chart.CMod)return this.chart.getBeatFromSeconds(this.getSecondFromYPos(e));const s=(e-this.getActualReceptorYPos())*this.getPixelsToEffectiveBeatsRatio()*a;if(y.chart.doSpeedChanges&&!t){const o=this.chart.timingData.getEffectiveBeat(n)+s;return this.chart.getBeatFromEffectiveBeat(o)}return n+s}getColumnFromXPos(e){const t=this.chart.gameType;let n=null;for(let a=0;a<t.numCols;a++){const r=Math.abs(this.getXPosFromColumn(a)-e);if(n!==null&&r>n)return a-1;n=r}return t.numCols-1}getActualReceptorYPos(){return y.chart.receptorYPos/y.chart.zoom*(y.chart.reverse?-1:1)}getEffectiveBeatsToPixelsRatio(){return y.chart.speed/100*64*this.speedMult}getPixelsToEffectiveBeatsRatio(){return 1/this.getEffectiveBeatsToPixelsRatio()}getSecondsToPixelsRatio(){return y.chart.speed/100*64*4}getPixelsToSecondsRatio(){return 1/this.getSecondsToPixelsRatio()}isNegScroll(e){return y.chart.doSpeedChanges&&(this.speedMult<0||(this.chart.timingData.getEventAtBeat("SCROLLS",e)?.value??1)<0||(this.chart.timingData.getEventAtBeat("BPMS",e)?.value??120)<0)}getUpperBound(){return-this.chartManager.app.STAGE_HEIGHT/2/y.chart.zoom-64}getLowerBound(){return this.chartManager.app.STAGE_HEIGHT/2/y.chart.zoom+64}findFirstOnScreenScroll(){const e=[...this.chart.timingData.getTimingData("SCROLLS")];e[0]?.beat!=0&&e.splice(0,0,{beat:0,value:e[0]?.value??1,type:"SCROLLS"});let t=Ut(e,this.getVisualBeat()-y.chart.maxDrawBeatsBack,n=>n.beat);for(;t<e.length&&(e[t].beat??0)<this.getVisualBeat()+y.chart.maxDrawBeats;){const n=e[t];t++;const a=n===void 0?-1/0*this.getScrollDirection(e[0]?.value??1):this.getYPosFromBeat(n.beat??0),r=e[t]===void 0?1/0*this.getScrollDirection(n.value):this.getYPosFromBeat(e[t].beat);if(this.isAreaOnScreen(a,r))return n}return e.at(-1)??{beat:0,value:1,type:"SCROLLS"}}findLastOnScreenScroll(){const e=[...this.chart.timingData.getTimingData("SCROLLS")];e[0]?.beat!=0&&e.splice(0,0,{beat:0,value:e[0]?.value??1,type:"SCROLLS"});let t=Ut(e,this.getVisualBeat()+y.chart.maxDrawBeats,a=>a.beat);const n=Ut(e,this.getVisualBeat()-y.chart.maxDrawBeatsBack,a=>a.beat);for(;t>=n;){const a=e[t];t--;const r=a===void 0?-1/0*this.getScrollDirection(e[0]?.value??1):this.getYPosFromBeat(a.beat??0),s=e[t+2]===void 0?1/0*this.getScrollDirection(a.value):this.getYPosFromBeat(e[t+2].beat);if(this.isAreaOnScreen(r,s))return a}return{beat:0,value:1,type:"SCROLLS"}}getTopOnScreenBeat(){if(y.chart.waveform.speedChanges&&!y.chart.CMod&&y.chart.doSpeedChanges){const e=this.findFirstOnScreenScroll(),t=1/Math.abs(this.getEffectiveBeatsToPixelsRatio()),n=this.getYPosFromBeat(e.beat),a=t/Math.abs(e.value),r=this.getScrollDirection(e.value),s=r==1?this.getUpperBound():this.getLowerBound(),o=r*(s-n)*a+e.beat;return Math.max(this.getVisualBeat()-y.chart.maxDrawBeatsBack,o)}return y.chart.CMod?this.getBeatFromYPos(this.getUpperBound()):Math.max(this.getVisualBeat()-y.chart.maxDrawBeatsBack,this.getBeatFromYPos(this.getUpperBound()))}getBottomOnScreenBeat(){if(y.chart.waveform.speedChanges&&!y.chart.CMod&&y.chart.doSpeedChanges){const e=this.findLastOnScreenScroll(),t=1/Math.abs(this.getEffectiveBeatsToPixelsRatio()),n=this.getYPosFromBeat(e.beat),a=t/Math.abs(e.value),r=this.getScrollDirection(e.value),s=r==1?this.getLowerBound():this.getUpperBound(),o=r*(s-n)*a+e.beat;return Math.min(this.getVisualBeat()+y.chart.maxDrawBeats,o)}return y.chart.CMod?this.getBeatFromYPos(this.getLowerBound()):Math.min(this.getVisualBeat()+y.chart.maxDrawBeats,this.getBeatFromYPos(this.getLowerBound()))}isAreaOnScreen(e,t){t<e&&([e,t]=[t,e]);const n=this.getUpperBound(),a=this.getLowerBound();return e<a&&t>n}getCurrentSpeedMult(){return this.chart.timingData.getSpeedMult(this.getVisualBeat(),this.getVisualTime())}getScrollDirection(e){let t=1;return this.getCurrentSpeedMult()<0&&(t*=-1),y.chart.reverse&&(t*=-1),e<0&&(t*=-1),t}getUpperBoundBeat(){if(y.chart.waveform.speedChanges&&!y.chart.CMod&&y.chart.doSpeedChanges){const e=y.chart.speed,t=this.chart.timingData.getSpeedMult(this.getVisualBeat(),this.getVisualTime()),n=t>=0!=y.chart.reverse?1:-1,a=this.chart.timingData.getTimingData("SCROLLS"),r=100/e/Math.abs(t)/64/y.chart.zoom,s=this.getUpperBound(),o=this.getLowerBound();let l=Ut(a,this.getVisualBeat()-y.chart.maxDrawBeatsBack,m=>m.beat);for(this.getVisualBeat()-y.chart.maxDrawBeatsBack<a[0]?.beat&&(l=-1);l<a.length&&(a[l]?.beat??0)<this.getVisualBeat()+y.chart.maxDrawBeats;){const m=a[l],g=this.getYPosFromBeat(m?.beat??0),b=a[l+1]?.beat??this.getVisualBeat()+y.chart.maxDrawBeats,x=this.getYPosFromBeat(b);if((m?.value??1)*n>0&&x>s&&(g<s||!a[l-1]||a[l-1].beat<this.getVisualBeat()-y.chart.maxDrawBeatsBack||a[l-1].value==0)||(m?.value??1)*n<0&&x<s&&(g>s||!a[l-1]||a[l-1].beat<this.getVisualBeat()-y.chart.maxDrawBeatsBack||a[l-1].value==0))break;l++}const u=a[l]?.beat??0,f=this.getYPosFromBeat(u),c=a[l]?.value??1,d=r/Math.abs(c)*y.chart.zoom,h=y.chart.reverse?s:o,p=y.chart.reverse?o:s;return c*n>0?a[l-1]?.value==0&&this.getYPosFromBeat(a[l-1].beat)>p?this.getVisualBeat()-y.chart.maxDrawBeatsBack:Math.max(this.getVisualBeat()-y.chart.maxDrawBeatsBack,u+d*(p-f)):a[l-1]?.value==0&&this.getYPosFromBeat(a[l-1].beat)<h?this.getVisualBeat()-y.chart.maxDrawBeatsBack:Math.max(this.getVisualBeat()-y.chart.maxDrawBeatsBack,u+d*(f-h))}return y.chart.CMod?this.getBeatFromYPos(this.getUpperBound()):Math.max(this.getVisualBeat()-y.chart.maxDrawBeatsBack,this.getBeatFromYPos(this.getUpperBound()))}getLowerBoundBeat(){if(y.chart.waveform.speedChanges&&!y.chart.CMod&&y.chart.doSpeedChanges){const e=y.chart.speed,t=this.chart.timingData.getSpeedMult(this.getVisualBeat(),this.getVisualTime()),n=t>=0!=y.chart.reverse?1:-1,a=this.chart.timingData.getTimingData("SCROLLS"),r=100/e/Math.abs(t)/64/y.chart.zoom,s=this.getUpperBound(),o=this.getLowerBound();let l=Ut(a,this.getVisualBeat()+y.chart.maxDrawBeats,m=>m.beat);for(;l<a.length&&l>=0&&(a[l].beat??0)>this.getVisualBeat()-y.chart.maxDrawBeatsBack;){const m=a[l],g=this.getYPosFromBeat(m?.beat??0),b=a[l+1]?.beat??this.getVisualBeat()+y.chart.maxDrawBeats,x=this.getYPosFromBeat(b);if((m?.value??1)*n>0&&g<o&&(x>o||!a[l+1]||a[l+1].beat>this.getVisualBeat()+y.chart.maxDrawBeatsBack||a[l+1].value==0)||(m?.value??1)*n<0&&g>o&&(x<o||!a[l+1]||a[l+1].beat>this.getVisualBeat()+y.chart.maxDrawBeatsBack||a[l+1].value==0))break;l--}const u=a[l]?.beat??0,f=this.getYPosFromBeat(u),c=a[l]?.value??1,d=r/Math.abs(c)*y.chart.zoom,h=y.chart.reverse?o:s,p=y.chart.reverse?s:o;return c*n>0?a[l+1]?.value==0&&this.getYPosFromBeat(a[l+1].beat)<p?this.getVisualBeat()+y.chart.maxDrawBeats:Math.min(this.getVisualBeat()+y.chart.maxDrawBeats,u+d*(p-f)):a[l+1]?.value==0&&this.getYPosFromBeat(a[l+1].beat)>h?this.getVisualBeat()+y.chart.maxDrawBeats:Math.min(this.getVisualBeat()+y.chart.maxDrawBeats,u+d*(f-h))}return y.chart.CMod?this.getBeatFromYPos(this.getLowerBound()):Math.min(this.getVisualBeat()+y.chart.maxDrawBeats,this.getBeatFromYPos(this.getLowerBound()))}selectionTest(e){if(!this.selectionBounds)return!1;const t=this.selectionBoundary.getBounds(),n=e.getBounds(),a=16*y.chart.zoom;return t.x+t.width>n.x+a&&t.x<n.x+n.width-a&&t.y+t.height>n.y+a&&t.y<n.y+n.height-a}registerDragNote(e,t){e.eventMode="static",e.removeAllListeners();let n=0,a=0,r=0,s=0,o;const l=u=>{const f=o,c=this.toLocal(u.global);if(Math.abs(c.y-s-r)**2+Math.abs(c.x-a)**2<32*32){this.chartManager.selection.shift&&(this.chartManager.selection.shift={columnShift:0,beatShift:0});return}const d=this.getBeatFromYPos(c.y-s),h=y.chart.snap==0?1/48:y.chart.snap;let p=Math.round(d/h)*h;Math.abs(p-d)>Math.abs(d-f.beat)&&(p=f.beat);const m=this.getColumnFromXPos(c.x);this.chartManager.selection.shift||={columnShift:0,beatShift:0},n!=m-f.col&&(n=m-f.col,this.chartManager.selection.notes.every(g=>{const b=g.col+n;return b>=0&&b<this.chartManager.loadedChart.gameType.numCols})&&(this.chartManager.selection.shift.columnShift=m-f.col)),this.chartManager.selection.shift.beatShift=Math.max(-Math.min(...this.chartManager.selection.notes.map(g=>g.beat)),p-f.beat)};e.on("pointerdown",u=>{if(this.chartManager.getMode()==q.View)return;if(Os(u)){this.chartManager.isNoteInSelection(t)||(this.chartManager.clearSelections(),this.chartManager.addNoteToSelection(t)),Vs.open(this.chartManager.app,u),u.preventDefault();return}if(y.chart.mousePlacement&&!u.getModifierState("Meta")&&!u.getModifierState("Control")&&!u.getModifierState("Shift")&&!this.chartManager.isNoteInSelection(t))return;u.stopImmediatePropagation(),this.chartManager.isNoteInSelection(t)?(u.getModifierState("Control")||u.getModifierState("Meta"))&&this.chartManager.removeNoteFromSelection(t):(!u.getModifierState("Control")&&!u.getModifierState("Meta")&&!u.getModifierState("Shift")&&this.chartManager.clearSelections(),this.chartManager.addNoteToSelection(t)),a=e.x,r=e.y,s=this.toLocal(u.global).y-e.y,o=t,this.on("pointermove",l);const f=()=>{this.off("pointermove",l),this.off("pointerup",f),((this.chartManager.selection.shift?.beatShift??0)!=0||(this.chartManager.selection.shift?.columnShift??0)!=0)&&this.chartManager.modifySelection(c=>(c.beat+=this.chartManager.selection.shift.beatShift,c.col+=this.chartManager.selection.shift.columnShift,c)),this.chartManager.selection.shift=void 0};this.on("pointerup",f)}),e.on("destroyed",()=>{e?.removeAllListeners()})}getNotefield(){return this.notefield}swapNoteskin(e){y.chart.noteskin.name=e,y.chart.lastNoteskins[this.chart.gameType.id]=e,this.reloadNotefield()}reloadNotefield(){const e=new xc(this);this.addChildAt(e,this.children.indexOf(this.notefield)),this.notefield.destroy(),this.notefield=e}getSelectionBounds(){return this.selectionBounds}shouldDisplayBarlines(){return(this.chartManager.getMode()!=q.Play||!y.play.hideBarlines)&&he.barlines}shouldDisplayNoteSelection(e){return this.chartManager.getMode()!=q.Play&&!this.chartManager.app.capturing&&this.chartManager.isNoteInSelection(e)}shouldDisplayEventSelection(e){return this.chartManager.getMode()!=q.Play&&!this.chartManager.app.capturing&&this.chartManager.isEventInSelection(e)}}class Co extends AudioBufferSourceNode{started=!1;start(e,t,n){this.started||super.start(e,t,n),this.started=!0}stop(e){this.started&&super.stop(e),this.started=!1}static create(e){const t=e;return t.started=!1,Object.setPrototypeOf(t,Co.prototype),t}}class Cg extends BiquadFilterNode{enabled=!1;static create(e){const t=e;return t.enabled=!1,t}}class wa{_audioAnalyzer;_filteredAudioAnalyzer;_freqData;_filteredFreqData;_gainNode;type;_audioContext=new AudioContext;_source;_playbackTime=0;_startTimestamp=0;_rate=1;_isPlaying=!1;_buffer;_filteredBuffer;_loadedBuffer;_delay;_loadListeners=[];_updateListeners=[];_volume=1;_destroyed=!1;_renderTimeout;_filters=[this.createFilter({type:"highpass",frequency:20,Q:.71}),this.createFilter({type:"lowshelf",frequency:75,gain:0}),this.createFilter({type:"peaking",frequency:100,gain:0,Q:.6}),this.createFilter({type:"peaking",frequency:250,gain:0,Q:.3}),this.createFilter({type:"peaking",frequency:1040,gain:0,Q:.41}),this.createFilter({type:"peaking",frequency:2500,gain:0,Q:.2}),this.createFilter({type:"highshelf",frequency:7500,gain:0}),this.createFilter({type:"lowpass",frequency:2e4,Q:.71})];_filtersEnabled=!1;onStop;loaded;constructor(e,t){this.type=t??"",this._filters[0].gain.value=-25,this._audioAnalyzer=this._audioContext.createAnalyser(),this._audioAnalyzer.fftSize=4096,this._audioAnalyzer.maxDecibels=0,this._freqData=new Uint8Array(this._audioAnalyzer.frequencyBinCount),this._filteredAudioAnalyzer=this._audioContext.createAnalyser(),this._filteredAudioAnalyzer.fftSize=4096,this._filteredAudioAnalyzer.maxDecibels=0,this._filteredFreqData=new Uint8Array(this._filteredAudioAnalyzer.frequencyBinCount),this._gainNode=this._audioContext.createGain(),this._buffer=this._audioContext.createBuffer(2,1,44100),this._filteredBuffer=this._audioContext.createBuffer(2,1,44100),this._loadedBuffer=this._audioContext.createBuffer(2,1,44100),this.initSource(),this.loaded=new Promise(n=>{this.decodeData(e).then(a=>{if(a)return this._loadedBuffer=a,a}).then(async a=>(await this.renderBuffer(a),await this.renderFilteredBuffer(a),a)).catch(a=>{a.name=="EncodingError"?de.createFormatted("Failed to load audio: file format not supported","error"):de.createFormatted("Failed to load audio: "+a.message,"error")}).finally(()=>{this.initSource(),this.callLoadListeners(),this.callUpdateListeners(),n()})})}async renderBuffer(e){if(!e)return;const t=new OfflineAudioContext(e.numberOfChannels,e.length,e.sampleRate),n=t.createBufferSource();return n.buffer=e,n.connect(t.destination),n.start(),await t.startRendering().then(a=>{this._buffer=a}).catch(()=>{de.createFormatted("Failed to load audio: audio rendering failed","error")})}async renderFilteredBuffer(e){if(!e)return;const t=new OfflineAudioContext(e.numberOfChannels,e.length,e.sampleRate),n=t.createBufferSource();n.buffer=e;let a=n;for(const r of this._filters){if(!r.enabled)continue;const s=t.createBiquadFilter();s.type=r.type,s.Q.setValueAtTime(r.Q.value,0),s.frequency.setValueAtTime(r.frequency.value,0),s.gain.setValueAtTime(r.gain.value,0),a.connect(s),a=s}return a.connect(t.destination),n.start(),await t.startRendering().then(r=>{this._filteredBuffer=r}).catch(()=>{de.createFormatted("Failed to load audio: audio rendering failed","error")})}createFilter(e){const t=Cg.create(this._audioContext.createBiquadFilter());return t.type=e.type,e.Q!==void 0&&(t.Q.value=e.Q),e.gain!==void 0&&(t.gain.value=e.gain),e.frequency!==void 0&&(t.frequency.value=e.frequency),t}getFilters(){return this._filters}getFilter(e){return this._filters[e]}updateFilter(e,t){this._filters[e]&&(t.Q!==void 0&&(this._filters[e].Q.value=t.Q),t.frequency!==void 0&&(this._filters[e].frequency.value=t.frequency),t.gain!==void 0&&(this._filters[e].gain.value=t.gain),clearTimeout(this._renderTimeout),this._renderTimeout=setTimeout(()=>this.renderFilteredBuffer(this._loadedBuffer).then(()=>this.callUpdateListeners()),500))}enableFilter(e){this._filters[e].enabled=!0,this.initSource(),clearTimeout(this._renderTimeout),this._renderTimeout=setTimeout(()=>this.renderFilteredBuffer(this._loadedBuffer).then(()=>this.callUpdateListeners()),500),this._filtersEnabled=!0}disableFilter(e){this._filters[e].enabled=!1,this.initSource(),clearTimeout(this._renderTimeout),this._renderTimeout=setTimeout(()=>this.renderFilteredBuffer(this._loadedBuffer).then(()=>this.callUpdateListeners()),500),this._filtersEnabled=this._filters.some(t=>t.enabled)}hasFilters(){return this._filtersEnabled}onLoad(e){this._loadListeners.push(e)}offLoad(e){this._loadListeners=this._loadListeners.filter(t=>t!=e)}onUpdate(e){this._updateListeners.push(e)}offUpdate(e){this._updateListeners=this._updateListeners.filter(t=>t!=e)}getSongLength(){return this._buffer.length/this._buffer.sampleRate}getFrequencyData(){return this._destroyed?new Uint8Array:(this._audioAnalyzer.getByteFrequencyData(this._freqData),this._freqData)}getFilteredFrequencyData(){return this._destroyed?new Uint8Array:(this._filteredAudioAnalyzer.getByteFrequencyData(this._filteredFreqData),this._filteredFreqData)}getSampleRate(){return this._buffer.sampleRate}getFFTSize(){return this._audioAnalyzer.fftSize}getRawData(){if(this._destroyed)return[];const e=[];for(let t=0;t<this._buffer.numberOfChannels;t++){const n=new Float32Array(this._buffer.length);this._buffer.copyFromChannel(n,t),e.push(n)}return e}getFilteredRawData(){if(this._destroyed)return[];const e=[];for(let t=0;t<this._filteredBuffer.numberOfChannels;t++){const n=new Float32Array(this._filteredBuffer.length);this._filteredBuffer.copyFromChannel(n,t),e.push(n)}return e}getBuffer(){return this._loadedBuffer}isPlaying(){return this._destroyed?!1:this._isPlaying}reload(){this.initSource()}destroy(){this._destroyed||(this.stop(),this._buffer=this._audioContext.createBuffer(2,1,44100),this._updateListeners=[],clearTimeout(this._delay),this._destroyed=!0)}getFrequencyResponse(e){const t=new Float32Array(e);return this._filters.some(n=>n.enabled)?this._filters.filter(n=>n.enabled).map(n=>{const a=new Float32Array(e.length);return n.getFrequencyResponse(t,a,new Float32Array(e.length)),[...a]}).reduce((n,a)=>n.map((r,s)=>r*a[s])):new Array(e.length).fill(1)}callLoadListeners(){this._loadListeners.forEach(e=>e())}callUpdateListeners(){this._updateListeners.forEach(e=>e())}async decodeData(e){return new Promise((t,n)=>{if(!e){t();return}(async()=>{try{t(await this._audioContext.decodeAudioData(e))}catch(a){if(this.type==".ogg"){const r=(await Ge(async()=>{const{default:s}=await import("./OggDec-BmLxerny.js");return{default:s}},[])).default;try{t(await r.decodeOggData(e))}catch(s){n(s)}return}n(a)}})()})}initSource(){for(const t of this._filters)t.disconnect();this._audioAnalyzer.disconnect(),this._filteredAudioAnalyzer.disconnect(),this._gainNode.disconnect(),this._audioContext.destination.disconnect(),this._source?.stop(),this._source=Co.create(this._audioContext.createBufferSource()),this._source.buffer=this._buffer,this._source.connect(this._audioAnalyzer);let e=this._audioAnalyzer;for(const t of this._filters)t.enabled&&(e.connect(t),e=t);e.connect(this._filteredAudioAnalyzer),y.audio.allowFilter?this._filteredAudioAnalyzer.connect(this._gainNode):this._audioAnalyzer.connect(this._gainNode),this._gainNode.connect(this._audioContext.destination),this._source.playbackRate.value=this._rate,this._isPlaying&&(this.pause(),this.play())}volume(e){this._destroyed||this._volume!=e&&(this._volume=e,this._gainNode.gain.setValueAtTime(e,this._audioContext.currentTime))}rate(e){this._destroyed||this._rate!=e&&(this._rate=e,this._source&&(this._isPlaying&&(this._playbackTime+=(this._audioContext.currentTime-this._startTimestamp)*this._source.playbackRate.value),this._startTimestamp=this._audioContext.currentTime,this._source.playbackRate.value=e))}play(){this._destroyed||this._source&&(this._isPlaying||(this.initSource(),this._playbackTime<=this._buffer.duration&&this._source.start(Math.max(0,this._audioContext.currentTime-this._playbackTime/y.audio.rate),Math.max(0,this._playbackTime)),this._startTimestamp=this._audioContext.currentTime,this._isPlaying=!0))}seek(e){if(e===void 0)return this._destroyed?this._playbackTime:this._source?this._isPlaying?(this._audioContext.currentTime-this._startTimestamp)*this._source.playbackRate.value+this._playbackTime:this._playbackTime:this._playbackTime;this._isPlaying?(this.stop(),this._playbackTime=e,this.play()):this._playbackTime=e}pause(){this._destroyed||this.stop(!0)}stop(e){this._destroyed||this._source&&this._isPlaying&&(this.onStop?.(),clearTimeout(this._delay),this._isPlaying=!1,this._playbackTime<=this._buffer.duration&&this._source.stop(),this._playbackTime=e?(this._audioContext.currentTime-this._startTimestamp)*this._source.playbackRate.value+this._playbackTime:0)}}class Ag{judgementCounts=new Map;holdJudgementCounts=new Map;dancePoints=0;maxCumulativeDancePoints=0;maxDancePoints=0;chartManager;notedata;dataPoints=[];handlers=[];combo=0;missCombo=0;maxCombo=0;bestJudge;constructor(e){this.notedata=e.loadedChart.getNotedata(),this.chartManager=e,this.bestJudge=_t.getCollection(y.play.timingCollection).getStandardWindows()[0],this.calculateMaxDP()}onJudge(e){this.handlers.push(e)}applyOffset(e){this.dataPoints=this.dataPoints.map(t=>ui(t.judgement)||!bi(t.judgement)?t:{...t,error:t.error!==null?t.error+e:null})}addDataPoint(e,t,n){this.judgementCounts.has(t)||this.judgementCounts.set(t,0),this.judgementCounts.set(t,this.judgementCounts.get(t)+1),this.dancePoints+=t.dancePoints;const a=this.chartManager.loadedChart.timingData.getEventAtBeat("COMBOS",e[0].beat),r=a?.hitMult??1,s=a?.missMult??1;Ws(t)||(this.maxCumulativeDancePoints+=_t.getCollection(y.play.timingCollection).getMaxDancePoints()),ui(t)?(this.chartManager.loadedChart.gameType.gameLogic.usesHoldTicks||(this.maxCumulativeDancePoints+=e.filter(Oe).reduce((o,l)=>o+_t.getCollection(y.play.timingCollection).getMaxHoldDancePoints(l.type),0)),this.combo=0,this.chartManager.loadedChart.gameType.gameLogic.missComboIsPerRow?this.missCombo+=e.length*s:this.missCombo+=s,this.bestJudge=void 0):bi(t)&&(_t.getCollection(y.play.timingCollection).shouldHideNote(t)?(this.chartManager.loadedChart.gameType.gameLogic.comboIsPerRow?this.combo+=e.length*r:this.combo+=r,this.combo>this.maxCombo&&(this.maxCombo=this.combo),this.missCombo=0,this.bestJudge&&t.getTimingWindowMS()>this.bestJudge.getTimingWindowMS()&&(this.bestJudge=t)):(this.bestJudge=void 0,this.combo=0)),this.handlers.forEach(o=>o(n,t)),this.dataPoints.push({second:e[0].second,error:n,judgement:t,notes:e})}addHoldDataPoint(e,t){this.judgementCounts.has(t)||this.judgementCounts.set(t,0),this.judgementCounts.set(t,this.judgementCounts.get(t)+1);const n=_t.getCollection(y.play.timingCollection).getHeldJudgement(e);this.holdJudgementCounts.has(n)||this.holdJudgementCounts.set(n,[0,0]);const a=this.holdJudgementCounts.get(n);dn(t)?a[0]++:a[1]++,this.holdJudgementCounts.set(n,a),this.dancePoints+=t.dancePoints,this.maxCumulativeDancePoints+=_t.getCollection(y.play.timingCollection).getMaxHoldDancePoints(e.type),this.handlers.forEach(r=>r(0,t)),Vn(t)&&(this.bestJudge=void 0)}getScore(){return this.maxDancePoints==0?0:this.dancePoints/this.maxDancePoints}getCumulativeScore(){return this.maxCumulativeDancePoints==0?0:this.dancePoints/this.maxCumulativeDancePoints}getDataPoints(){return this.dataPoints}getMedian(){return Ha(this.dataPoints.filter(e=>!ui(e.judgement)&&bi(e.judgement)&&e.error!=null).map(e=>e.error))}getMaxCombo(){return this.maxCombo}calculateMaxDP(){this.maxDancePoints=this.chartManager.loadedChart.gameType.gameLogic.calculateMaxDP(this.notedata,this.chartManager.loadedChart.timingData)}getCount(e){return this.judgementCounts.get(e)??0}getCombo(){return this.combo}getMissCombo(){return this.missCombo}getBestJudge(){return this.bestJudge}}const Nt=[1,2,3,4,6,8,12,16,24,48,-1],Ec=.2;var q=(i=>(i.View="View Mode",i.Edit="Edit Mode",i.Play="Play Mode",i.Record="Record Mode",i))(q||{}),ke=(i=>(i[i.Off=0]="Off",i[i.Edit=1]="Edit",i[i.Add=2]="Add",i))(ke||{});class kg{app;chartAudio=new wa;chartView;widgetManager;assistTick=new vs({src:jd,volume:.5});me_high=new vs({src:Oc,volume:.5});me_low=new vs({src:Nc,volume:.5});mine=new Es.Howl({src:$d,volume:.5});loadedSM;smPath="";loadedChart;selection={notes:[],inProgressNotes:[]};eventSelection={timingEvents:[],inProgressTimingEvents:[]};editTimingMode=0;holdEditing=[];editNoteTypeIndex=0;partialScroll=0;noteFlashIndex=0;assistTickIndex=0;lastMetronomeDivision=-1;lastMetronomeMeasure=-1;holdFlashes=[];lastSong=null;mode="Edit Mode";lastMode="Edit Mode";_beat=0;noChartTextA;noChartTextB;loadingText;shiftPressed=0;virtualClipboard="";lastAutoSave=0;startRegion;endRegion;gameStats;constructor(e){this.app=e,document.addEventListener("keydown",t=>{t.key=="Shift"&&this.shiftPressed++}),document.addEventListener("keyup",t=>{t.key=="Shift"&&(this.shiftPressed=Math.max(this.shiftPressed-1,0))}),document.addEventListener("cut",t=>{if(t.target.classList.contains("inlineEdit")||t.target instanceof HTMLTextAreaElement||t.target instanceof HTMLInputElement||this.mode!="Edit Mode")return;const n=this.copy();n&&t.clipboardData?.setData("text/plain",n),this.eventSelection.timingEvents.length>0?this.deleteEventSelection():this.deleteSelection(),t.preventDefault()},!0),document.addEventListener("copy",t=>{if(t.target.classList.contains("inlineEdit")||t.target instanceof HTMLTextAreaElement||t.target instanceof HTMLInputElement||this.mode!="Edit Mode")return;const n=this.copy();n&&t.clipboardData?.setData("text/plain",n),t.preventDefault(),t.stopImmediatePropagation()},!0),document.addEventListener("paste",t=>{if(t.target.classList.contains("inlineEdit")||t.target instanceof HTMLTextAreaElement||t.target instanceof HTMLInputElement||this.mode!="Edit Mode")return;const n=t.clipboardData?.getData("text/plain");n&&this.paste(n,this.shiftPressed>0),t.preventDefault(),t.stopImmediatePropagation()},!0),e.view.addEventListener?.("wheel",t=>{if(!(this.loadedSM==null||this.loadedChart==null||this.chartView==null))if(t.preventDefault(),Yt&&t.metaKey||!Yt&&t.ctrlKey){const n=t.deltaY/5*y.chart.scroll.scrollSensitivity*(y.chart.scroll.invertZoomScroll?-1:1);y.chart.speed=Se(y.chart.speed*Math.pow(1.01,n),10,35e3)}else{if(this.mode=="Play Mode"||this.mode=="Record Mode")return;let n=this.beat;const a=y.chart.snap;let r=t.deltaY/y.chart.speed*y.chart.scroll.scrollSensitivity;if(y.chart.reverse&&y.chart.scroll.invertReverseScroll&&(r*=-1),y.chart.scroll.invertScroll&&(r*=-1),a==0?(this.partialScroll=0,n=this.beat+r):y.chart.scroll.scrollSnapEveryScroll?r<0?n=Math.round((this.beat-a)/a)*a:n=Math.round((this.beat+a)/a)*a:(this.partialScroll+=r,Math.abs(this.partialScroll)>a&&(this.partialScroll<0?n=Math.round((this.beat+Math.ceil(this.partialScroll/a)*a)/a)*a:n=Math.round((this.beat+Math.floor(this.partialScroll/a)*a)/a)*a,this.partialScroll%=a)),n=Math.max(0,n),n!=this.beat&&(this.beat=n),!this.holdEditing.every(s=>s==null))for(let s=0;s<this.holdEditing.length;s++)!this.holdEditing[s]||this.holdEditing[s].type=="mouse"||this.editHoldBeat(s,this.beat,t.shiftKey)}}),this.widgetManager=new Fm(this),this.app.stage.addChild(this.widgetManager),this.noChartTextA=new ye("No Chart",{fontName:"Main",fontSize:30}),this.noChartTextA.anchor.set(.5),this.noChartTextA.tint=5592405,this.app.stage.addChild(this.noChartTextA),this.noChartTextB=new ye("Create a new chart",{fontName:"Main",fontSize:15}),this.noChartTextB.anchor.set(.5),this.noChartTextB.tint=5596791,this.noChartTextB.eventMode="static",this.noChartTextB.on("mouseover",()=>{this.noChartTextB.tint=8952234}),this.noChartTextB.on("mouseleave",()=>{this.noChartTextB.tint=5596791}),this.noChartTextB.on("mousedown",()=>{this.app.windowManager.openWindow(new Bu(e,bt.getGameType("dance-single")))}),this.noChartTextA.visible=!1,this.noChartTextB.visible=!1,this.app.stage.addChild(this.noChartTextB),this.loadingText=new ye("Loading simfile...",{fontName:"Main",fontSize:20}),this.loadingText.anchor.set(.5),this.loadingText.tint=5592405,this.app.stage.addChild(this.loadingText),this.loadingText.visible=!1,this.noChartTextA.x=0,this.noChartTextA.y=-20,this.noChartTextB.x=0,this.noChartTextB.y=10,this.loadingText.x=0,this.loadingText.y=0,setInterval(()=>{if(!this.loadedSM||!this.loadedChart||!this.chartView)return;const t=performance.now(),n=this.chartAudio.seek();if(this.chartAudio.isPlaying()&&!this.holdEditing.every(r=>!r))for(let r=0;r<this.holdEditing.length;r++){if(!this.holdEditing[r]||this.holdEditing[r].type=="mouse")continue;let s=this.beat;this.mode=="Record Mode"&&(s=this.loadedChart.getBeatFromSeconds(this.time+y.play.offset));const o=y.chart.snap==0?1/48:y.chart.snap,l=Math.round(s/o)*o,u=this.holdEditing[r];(Math.max(0,Math.round(Math.max(this.beat,u.endBeat)*48)/48)-Math.max(0,Math.round(Math.min(this.beat,u.startBeat)*48)/48))*60/(this.loadedChart.timingData.getEventAtBeat("BPMS",this.beat)?.value??120)>.3&&this.editHoldBeat(r,l,!1)}const a=this.loadedChart.getNotedata();if(this.chartAudio.isPlaying()){this._beat=this.loadedChart?.getBeatFromSeconds(this.time)??0;let r=a[this.noteFlashIndex];for(;this.noteFlashIndex<a.length&&n>r.second;)this.mode!="Record Mode"&&this.loadedChart.gameType.gameLogic.shouldAssistTick(r)&&this.mode!="Play Mode"&&(this.chartView.doJudgement(r,0,Us),Oe(r)&&(r.type=="Hold"&&this.chartView.getNotefield().activateHold(r.col),r.type=="Roll"&&this.chartView.getNotefield().activateRoll(r.col),this.holdFlashes.push(r))),this.noteFlashIndex++,r=a[this.noteFlashIndex];this.holdFlashes=this.holdFlashes.filter(o=>this._beat<o.beat+o.hold?!0:(this.chartView&&(o.type=="Hold"&&this.chartView.getNotefield().releaseHold(o.col),o.type=="Roll"&&this.chartView.getNotefield().releaseRoll(o.col),this.chartView.doJudgement(o,null,_t.getCollection(y.play.timingCollection).getHeldJudgement(o))),!1));const s=new Set;for(;this.assistTickIndex<a.length&&n>a[this.assistTickIndex].second+y.play.effectOffset-Ec;){if(s.has(a[this.assistTickIndex].second)||a[this.assistTickIndex].second+y.play.effectOffset-n<0){this.assistTickIndex++;continue}this.mode!="Record Mode"&&this.loadedChart.gameType.gameLogic.shouldAssistTick(a[this.assistTickIndex])&&(y.audio.assistTick&&he.assist&&this.assistTick.play((a[this.assistTickIndex].second+y.play.effectOffset-n)/y.audio.rate),s.add(a[this.assistTickIndex].second)),this.assistTickIndex++}}if(this.chartAudio.isPlaying()&&y.audio.metronome&&he.assist){const r=this.loadedChart.timingData,s=this.loadedChart.getBeatFromSeconds(this.time+y.play.effectOffset+Ec),o=new Set,l=r.getBeatFromMeasure(this.lastMetronomeMeasure),u=r.getDivisionLength(l),f=l+u*this.lastMetronomeDivision,c=[...r.getMeasureBeats(f,s)].slice(1);for(const[d,h]of c){if(this.beat>d)continue;const p=r.getSecondsFromBeat(d);if(o.has(p))continue;o.add(p);const m=(p+y.play.effectOffset-this.time)/y.audio.rate;h?this.me_high.play(m):this.me_low.play(m)}if(c.length>0){const d=c.at(-1)[0];this.lastMetronomeMeasure=Math.floor(r.getMeasure(d)),this.lastMetronomeDivision=Math.round(r.getDivisionOfMeasure(d))}}this.mode=="Play Mode"&&this.loadedChart.gameType.gameLogic.update(this),this.lastAutoSave+y.general.autosaveInterval*1e3<Date.now()&&(this.lastAutoSave=Date.now(),Et.instance.isDirty()&&this.autosave()),this.updateSoundProperties(),ym(),ji.instance?.addUpdateTimeValue(performance.now()-t)},5),re.on("chartModified",()=>{this.loadedChart&&(this.setNoteIndex(),re.emit("chartModifiedAfter"))}),re.on("userOptionUpdated",t=>{t!="audio.rate"&&t!="play.effectOffset"&&t!="audio.assistTick"&&t!="audio.metronome"||(this.assistTick.stop(),this.me_low.stop(),this.me_high.stop(),this.setNoteIndex())}),window.addEventListener("keyup",t=>{if(this.mode=="Edit Mode"&&t.code.startsWith("Digit")){let n=parseInt(t.code.slice(5))-1;n==-1&&(n=9),this.endEditing(n)}},!0),window.addEventListener("keydown",t=>{const n=xe.getKeyNameFromEvent(t);if(this.mode=="Edit Mode"&&!t.target.classList.contains("inlineEdit")&&!(t.target instanceof HTMLTextAreaElement)&&!(t.target instanceof HTMLInputElement)&&!mn.active){if(t.code.startsWith("Digit")&&!t.repeat&&!t.ctrlKey&&!t.metaKey&&!t.altKey&&!t.ctrlKey){let a=parseInt(t.code.slice(5))-1;a==-1&&(a=9),a<(this.loadedChart?.gameType.numCols??4)&&(this.setNote(a,"key"),t.preventDefault(),t.stopImmediatePropagation())}if(!this.holdEditing.every(a=>a==null)){const a=["cursorUp","cursorDown","previousNote","nextNote","previousMeasure","nextMeasure","jumpChartStart","jumpChartEnd","jumpSongStart","jumpSongEnd"];for(const r of a)if(xe.getCombosForKeybind(r).map(s=>s.key).includes(n)){t.preventDefault(),t.stopImmediatePropagation(),We[r].callback(this.app);for(let s=0;s<this.holdEditing.length;s++)!this.holdEditing[s]||this.holdEditing[s].type=="mouse"||this.editHoldBeat(s,this.beat,t.shiftKey);return}for(const r of["undo","redo"])if(xe.getCombosForKeybind(r).map(s=>s.key).includes(n)){this.holdEditing=[];return}}}},!0),window.addEventListener("keydown",t=>{this.mode!="Play Mode"&&this.mode!="Record Mode"||t.key=="Escape"&&(this.setMode(this.lastMode),this.chartAudio.pause())},!0)}get beat(){return this.loadedChart?this.chartAudio.isPlaying()?this.loadedChart.getBeatFromSeconds(this.time):this._beat:0}set beat(e){this.loadedChart&&(this.chartAudio.seek(this.loadedChart.getSecondsFromBeat(e)),this._beat=e,this.setNoteIndex(),this.lastMetronomeMeasure=Math.floor(this.loadedChart.timingData.getMeasure(this.beat)),this.lastMetronomeDivision=Math.floor(this.loadedChart.timingData.getDivisionOfMeasure(this.beat)))}get time(){return this.chartAudio.seek()}set time(e){this.loadedChart&&(this.chartAudio.seek(e),this._beat=this.loadedChart.getBeatFromSeconds(e),this.setNoteIndex())}async loadSM(e){if(Hu.close(),zu.close(),gm.close(),Et.instance.isDirty()){const s=new Zn(this.app,"Save","Do you wish to save the current file?",[{label:"Cancel",type:"default"},{label:"No",type:"default"},{label:"Yes",type:"confirm"}]);this.app.windowManager.openWindow(s);const o=await s.resolved;if(o=="Cancel")return;o=="Yes"&&this.save(),o=="No"&&await this.removeAutosaves()}if(!e){this.smPath="",this.loadedSM?.destroy(),this.loadedSM=void 0,this.chartAudio.stop(),this.noChartTextA.visible=!1,this.noChartTextB.visible=!1,this.chartView?.destroy({children:!0});return}this.chartAudio.stop(),this.chartAudio.seek(0),this.lastSong=null,this.smPath=e,this.loadingText.visible=!0;let t=this.smPath;const n=this.getSMPath(".smebak");if(await Ee.hasFile(n)){const s=new Zn(this.app,"Autosave","An autosave was found. Do you wish to load the autosave?",[{label:"No",type:"default"},{label:"Yes",type:"confirm"}]);this.app.windowManager.openWindow(s),await s.resolved=="Yes"&&(t=n)}const a=await Ee.getFileHandle(t);if(!a){de.createFormatted("Couldn't load the file at "+t,"error"),this.app.windowManager.openWindow(new vo(this.app)),this.loadingText.visible=!1;return}const r=await a.getFile();this.loadedSM?.destroy(),this.loadedSM=new kc(r),await this.loadedSM.loaded,this.loadingText.visible=!1,this.noChartTextA.visible=!0,this.noChartTextB.visible=!0,this.editTimingMode=0,re.emit("smLoaded"),await this.loadChart(),re.emit("smLoadedAfter"),this.beat=0,Fu.addSM(this.smPath,this.loadedSM)}async loadChart(e){if(this.loadedSM==null)return;if(e==null){if(this.loadedChart){const a=this.loadedSM.charts[this.loadedChart.gameType.id];a&&a.length>0&&(e=a.at(-1))}if(!e)for(const a of bt.getPriority()){const r=this.loadedSM.charts[a.id];if(r&&r.length>0){e=r.at(-1);break}}if(!e){this.chartView?.destroy({children:!0}),this.chartView?.removeChildren(),this.beat=0,this.loadedChart=void 0,this.chartView=void 0,this.noChartTextA.visible=!0,this.noChartTextB.visible=!0,re.emit("chartLoaded",null),re.emit("chartModified");return}}if(e==this.loadedChart)return;this.chartView?.destroy({children:!0}),this.chartView?.removeChildren(),this.clearSelections(),this.loadedChart=e,this.beat=this.loadedChart.getBeatFromSeconds(this.time),Et.instance.reset(),y.play.timingCollection="ITG";for(const[a,r]of Object.entries(y.play.defaultTimingCollections))if(e.gameType.id.startsWith(a)){y.play.timingCollection=r;break}const t=bt.getGameType(y.chart.noteskin.type),n={type:e.gameType.id,name:y.chart.lastNoteskins[e.gameType.id]??"default"};if(t){const a=it.getNoteskinData(t,y.chart.noteskin.name);a?.gameTypes.includes(e.gameType.id)&&(n.name=a.id)}if(y.chart.noteskin=n,y.chart.lastNoteskins[e.gameType.id]=n.name,this.setNoteIndex(),this.chartView=new Eg(this),(this.mode=="Play Mode"||this.mode=="Record Mode")&&this.setMode(this.lastMode),he.viewMode&&this.setMode("View Mode"),this.noChartTextA.visible=!1,this.noChartTextB.visible=!1,this.loadedChart.getMusicPath()!=this.lastSong){this.lastSong=this.loadedChart.getMusicPath();const a=this.chartAudio.isPlaying();await this.loadAudio(),re.emit("audioLoaded"),a&&this.chartAudio.play()}de.create("Loaded chart "+e.difficulty+" "+e.meter+" "+e.gameType.id),re.emit("chartLoaded",e),re.emit("audioLoaded"),re.emit("chartModified"),he.autoPlay&&this.playPause()}async loadAudio(){if(!this.loadedSM||!this.loadedChart)return;this.chartAudio.stop(),this.chartAudio?.destroy();const e=this.loadedChart.getMusicPath();if(de.create("Loading audio..."),e==""){de.createFormatted("Failed to load audio: no audio file","error");const r=Math.max(0,this.beat);this.chartAudio=new wa(void 0),this.beat=r;return}const t=await this.getAudioHandle(e);if(t==null){de.createFormatted("Failed to load audio: couldn't find audio file "+e,"error");const r=Math.max(0,this.beat);this.chartAudio=new wa(void 0),this.beat=r;return}const n=await t.getFile(),a=Math.max(0,this.beat);this.chartAudio=new wa(await n.arrayBuffer(),Tt(n.name)),this.chartAudio.onLoad(()=>{de.create("Loaded audio")}),this.beat=a,this.chartAudio.onStop=()=>{this.assistTick.stop(),this.me_high.stop(),this.me_low.stop()},this.setNoteIndex()}async getAudioHandle(e){let t=await Ee.getFileHandleRelativeTo(this.smPath,e);if(t)return t;try{const n=await Ee.getDirectoryFiles(st(this.smPath));if(t=n.filter(a=>a.name.toLowerCase()==kt(e).toLowerCase())[0],t)return de.createFormatted("Failed to locate audio file "+e+", using file "+t.name+" instead","warn"),t;t=n.filter(a=>qa.includes(Tt(a.name)))[0],t&&de.createFormatted("Failed to locate audio file "+e+", using file "+t.name+" instead","warn")}catch{return}return t}getAudio(){return this.chartAudio}updateSoundProperties(){this.setEffectVolume(y.audio.soundEffectVolume*y.audio.masterVolume),this.setVolume(y.audio.songVolume*y.audio.masterVolume),this.setRate(y.audio.rate)}setRate(e){this.chartAudio.rate(e)}setVolume(e){this.chartAudio.volume(e)}setEffectVolume(e){this.assistTick.volume(e),this.me_high.volume(e),this.me_low.volume(e),this.mine.volume()!=e&&this.mine.volume(e)}setNoteIndex(){if(this.loadedSM==null||this.loadedChart==null||this.chartView==null||this.loadedChart.getNotedata().length==0){this.noteFlashIndex=0,this.assistTickIndex=0;return}this.assistTick.stop(),this.noteFlashIndex=Ut(this.loadedChart.getNotedata(),this.time,e=>e.second)+1,this.noteFlashIndex>=1&&this.time<=this.loadedChart.getNotedata()[this.noteFlashIndex-1].second&&this.noteFlashIndex--,this.assistTickIndex=this.noteFlashIndex;for(const e of this.holdFlashes)e.type=="Hold"?this.chartView.getNotefield().releaseHold(e.col):e.type=="Roll"&&this.chartView.getNotefield().releaseRoll(e.col);this.holdFlashes=[]}playPause(){this.setNoteIndex(),this.chartAudio.isPlaying()?(this.chartAudio.pause(),this._beat=this.loadedChart?.getBeatFromSeconds(this.time)??0):this.chartAudio.play()}getClosestTick(e,t){if(!this.loadedChart)return 0;const n=Math.max(.001,4/t),a=this.loadedChart.timingData.getBeatOfMeasure(e),r=e-a,s=Math.round(a/n)*n;return Math.max(0,r+s)}snapToNearestTick(e){this.beat=Math.max(0,this.getClosestTick(e,4/y.chart.snap))}snapToPreviousTick(){if(!this.loadedChart)return;const e=Math.max(.001,y.chart.snap),t=Math.floor(this.loadedChart.timingData.getMeasure(this.beat)),n=this.loadedChart.timingData.getBeatFromMeasure(t),a=Math.floor((this.beat-n)/e)*e,r=Math.abs(a-(this.beat-n))<5e-4?a-e:a,s=r+n;if(r<0){const o=this.loadedChart.timingData.getBeatFromMeasure(t-1),l=Math.round((s-o)/e)*e;this.beat=Math.max(0,o+l);return}this.beat=Math.max(0,s)}snapToNextTick(){if(!this.loadedChart)return;const e=Math.max(.001,y.chart.snap),t=Math.floor(this.loadedChart.timingData.getMeasure(this.beat)),n=this.loadedChart.timingData.getBeatFromMeasure(t),s=Math.floor((this.beat-n+5e-4)/e)*e+e+n,o=this.loadedChart.timingData.getBeatFromMeasure(t+1);if(s>o){this.beat=o;return}this.beat=s}previousSnap(){let e=this.getSnapIndex()-1;e=(e+Nt.length)%Nt.length,y.chart.snap=Nt[e]==-1?0:1/Nt[e],re.emit("snapChanged")}nextSnap(){let e=this.getSnapIndex();(e==Nt.length-1||Math.abs(1/y.chart.snap-Nt[e])<=5e-4)&&e++,e=(e+Nt.length)%Nt.length,y.chart.snap=Nt[e]==-1?0:1/Nt[e],re.emit("snapChanged")}getSnapIndex(){return y.chart.snap==0?Nt.length-1:Nt.findIndex(e=>1/e<=y.chart.snap)}removeDuplicateBeats(e){if(e.length===0)return e;const t=[e[0]];for(let n=1;n<e.length;n++)e[n-1]!==e[n]&&t.push(e[n]);return t}getRows(){if(this.loadedSM==null||this.loadedChart==null||this.chartView==null)return[];if(this.loadedChart.getNotedata().length==0)return[];const e=this.loadedChart.getNotedata().filter(Oe).map(n=>n.beat+n.hold),t=this.loadedChart.getNotedata().map(n=>n.beat).concat(e).sort((n,a)=>n-a);return this.removeDuplicateBeats(t)}previousNote(){const e=this.getRows();if(e.length==0)return;let t=Ut(e,this.beat);this.beat==e[t]&&t--,this.beat=e[Math.max(0,t)]}nextNote(){const e=this.getRows();if(e.length==0)return;let t=Ut(e,this.beat);this.beat>=e[t]&&t++,this.beat=e[Math.min(e.length-1,t)]}firstNote(){if(this.loadedSM==null||this.loadedChart==null||this.chartView==null)return;const e=this.loadedChart.getNotedata();e.length!=0&&(this.beat=e[0].beat)}lastNote(){if(this.loadedSM==null||this.loadedChart==null||this.chartView==null)return;const e=this.loadedChart.getNotedata();if(e.length==0)return;const t=e[e.length-1];this.beat=Xt(t)}truncateHold(e,t){const n=Se(Math.round((t-Math.max(.020833333333333332,y.chart.snap))*48)/48,e.beat,e.beat+e.hold-.020833333333333332);return n==e.beat?{beat:e.beat,col:e.col,type:"Tap"}:{beat:e.beat,col:e.col,type:e.type,hold:n-e.beat}}setNote(e,t,n=this.beat){if(this.loadedSM==null||this.loadedChart==null||this.chartView==null)return;if(n=Math.max(0,Math.round(n*48)/48),y.chart.forceSnapNotes){const o=y.chart.snap==0?.020833333333333332:y.chart.snap;n=Math.round(n/o)*o}const a=this.loadedChart.getNotedata().filter(o=>o.col!=e?!1:Math.abs(o.beat-n)<.003?!0:Oe(o)&&o.beat==n),r=this.loadedChart.getNotedata().filter(o=>Oe(o)&&o.col==e&&n>o.beat&&n<=Math.round((o.beat+o.hold)*48)/48).map(o=>({oldNote:o,newNote:this.truncateHold(o,n)})),s={startBeat:n,endBeat:n,roll:!1,originalNote:void 0,type:t,removedNotes:a,truncatedHolds:r,direction:null};this.holdEditing[e]=s,a.length==0&&(s.originalNote={beat:n,col:e,type:this.getEditingNoteType()}),this.setNoteIndex(),this.app.actionHistory.run({action:()=>{s.removedNotes.forEach(o=>{this.loadedChart.removeNote(o),this.removeNoteFromSelection(o)}),s.truncatedHolds.forEach(o=>this.loadedChart.modifyNote(o.oldNote,o.newNote)),s.originalNote&&this.loadedChart.addNote(s.originalNote)},undo:()=>{s.originalNote&&this.loadedChart.removeNote(s.originalNote),s.truncatedHolds.forEach(o=>this.loadedChart.modifyNote(o.newNote,o.oldNote)),s.removedNotes.forEach(o=>this.loadedChart.addNote(o))}})}editHoldBeat(e,t,n){if(this.loadedSM==null||this.loadedChart==null||this.chartView==null)return;const a=this.holdEditing[e];if(a==null||(t=Math.round(t*48)/48,t==a.startBeat&&t==a.endBeat))return;if(a.direction===null&&(t<a.startBeat?a.direction="up":a.direction="down"),y.chart.defaultHoldPlacement?a.direction=="up"?a.startBeat=Math.min(a.endBeat,Math.round(t*48)/48):a.endBeat=Math.max(a.startBeat,Math.round(t*48)/48):(a.startBeat=Math.min(a.startBeat,Math.round(t*48)/48),a.endBeat=Math.max(a.endBeat,Math.round(t*48)/48)),a.roll||=n,a.originalNote){const s={beat:a.startBeat,type:a.roll?"Roll":"Hold",hold:a.endBeat-a.startBeat};a.endBeat-a.startBeat==0&&(s.hold=void 0,s.type="Tap"),(s.beat!=a.originalNote.beat||s.type!=a.originalNote.type||Oe(a.originalNote)&&s.hold!=a.originalNote.hold)&&this.loadedChart.modifyNote(a.originalNote,s)}else{const s={beat:a.startBeat,col:e,type:a.roll?"Roll":"Hold",hold:a.endBeat-a.startBeat};a.endBeat-a.startBeat==0&&(s.type="Tap",Object.assign(s,{hold:void 0})),this.loadedChart.addNote(s)}a.originalNote={beat:a.startBeat,col:e,type:a.endBeat-a.startBeat==0?"Tap":a.roll?"Roll":"Hold",hold:a.endBeat-a.startBeat==0?void 0:a.endBeat-a.startBeat};const r=this.loadedChart.getNotedata().filter(s=>s.beat==a.originalNote.beat&&s.col==a.originalNote.col||s.col!=e?!1:s.beat>=a.startBeat&&s.beat<=a.endBeat?!0:Oe(s)&&s.beat+s.hold>=a.startBeat&&s.beat+s.hold<=a.endBeat);a.removedNotes=a.removedNotes.concat(r),r.forEach(s=>this.loadedChart.removeNote(s)),this.setNoteIndex()}endEditing(e){this.holdEditing[e]=void 0}previousNoteType(){const e=this.loadedChart?.gameType.editNoteTypes.length??0;this.editNoteTypeIndex=(this.editNoteTypeIndex-1+e)%e}nextNoteType(){const e=this.loadedChart?.gameType.editNoteTypes.length??0;this.editNoteTypeIndex=(this.editNoteTypeIndex+1+e)%e}getEditingNoteType(){return this.loadedChart?.gameType.editNoteTypes[this.editNoteTypeIndex]??null}setEditingNoteType(e){if(!this.loadedChart)return;const n=(this.loadedChart?.gameType.editNoteTypes).indexOf(e);n!=-1&&(this.editNoteTypeIndex=n)}getMode(){return this.mode}setMode(e){if(!this.loadedChart||!this.chartView)return;if(this.mode==e){(e=="Play Mode"||e=="Record Mode")&&(this.setMode(this.lastMode),this.setNoteIndex(),this.chartAudio.pause());return}(this.mode=="View Mode"||this.mode=="Edit Mode")&&(this.lastMode=this.mode),this.mode=e;const t=this.loadedChart.getNotedata();if(this.mode=="Play Mode"){t.forEach(n=>{n.gameplay={hideNote:!1,hasHit:!1}}),this.holdFlashes=[];for(let n=0;n<this.loadedChart.gameType.numCols;n++)this.chartView.getNotefield().releaseHold(n),this.chartView.getNotefield().releaseRoll(n);for(const n of t)if(n.second<this.time)n.gameplay.hasHit=!0;else break;this.gameStats=new Ag(this),this.widgetManager.startPlay(),this.chartAudio.seek(Math.max(0,this.time)-1),this.loadedChart.gameType.gameLogic.startPlay(this),this.chartAudio.play(),this.chartView.startPlay()}else this.mode=="Record Mode"?(this.chartAudio.seek(Math.max(0,this.time)-1),this.chartAudio.play()):(this.chartView.endPlay(),t.forEach(n=>n.gameplay=void 0))}judgeCol(e){if(!(!this.loadedChart||!this.chartView)){if(this.mode=="Play Mode")this.loadedChart.gameType.gameLogic.keyDown(this,e);else if(this.mode=="Record Mode"){const t=this.loadedChart.getBeatFromSeconds(this.time+y.play.offset),n=y.chart.snap==0?1/48:y.chart.snap,a=Math.round(t/n)*n;this.setNote(e,"key",a)}}}judgeColUp(e){!this.loadedChart||!this.chartView||(this.mode=="Play Mode"?this.loadedChart.gameType.gameLogic.keyUp(this,e):this.mode=="Record Mode"&&this.endEditing(e))}async save(){if(!this.loadedSM||this.smPath.startsWith("https://")||this.smPath.startsWith("http://"))return;const e=this.getSMPath(".sm"),t=this.getSMPath(".ssc");let n=null;!this.loadedSM.usesChartTiming()&&await Ee.getFileHandle(this.getSMPath(".sm"))&&await Ee.writeFile(e,this.loadedSM.serialize("sm")).catch(a=>{const r=a.message;r.includes(Mn.GONE[0])||(n=r)}),(this.loadedSM.requiresSSC()||await Ee.getFileHandle(t))&&await Ee.writeFile(t,this.loadedSM.serialize("ssc")).catch(a=>{const r=a.message;r.includes(Mn.GONE[0])||(n=r)}),n==null?(this.loadedSM.usesChartTiming()?de.create("Saved. No SM file since split timing was used."):de.create("Saved"),await this.removeAutosaves()):de.createFormatted("Failed to save file: "+n,"error"),Et.instance.setLimit()}getSMPath(e){if(window.nw){const t=window.nw.require("path"),n=t.parse(this.smPath);return t.resolve(n.dir,n.name+e)}else{const t=st(this.smPath),n=kt(this.smPath),a=n.includes(".")?n.split(".").slice(0,-1).join("."):n;return t+"/"+a+e}}async removeAutosaves(){await Ee.removeFile(this.getSMPath(".smebak")).catch(()=>{})}async autosave(){if(!this.loadedSM||this.smPath.startsWith("https://")||this.smPath.startsWith("http://"))return;let e=null;await Ee.writeFile(this.getSMPath(".smebak"),this.loadedSM.serialize("ssc")).catch(t=>{const n=t.message;n.includes(Mn.GONE[0])||(e=n)}),e==null?de.create("Autosaved"):de.createFormatted("Failed to autosave file: "+e,"error")}hasSelection(){return this.hasNoteSelection()||this.hasEventSelection()}hasNoteSelection(){return this.selection.notes.length>0||this.startRegion!==void 0&&this.endRegion!==void 0}hasEventSelection(){return this.eventSelection.timingEvents.length>0}hasRange(){return this.selection.notes.length>1||this.eventSelection.timingEvents.length>1||this.startRegion!==void 0&&this.endRegion!==void 0}clearSelections(){this.selection={notes:[],inProgressNotes:[]},this.eventSelection={timingEvents:[],inProgressTimingEvents:[]}}startDragSelection(){this.selection.inProgressNotes=[]}endDragSelection(){let e=0,t=0;const n=[],a=this.selection.inProgressNotes,r=this.selection.notes,s=(o,l)=>o.beat==l.beat?o.col-l.col:o.beat-l.beat;if(a.length==0||r.length==0){this.selection.notes=a.concat(r),this.selection.inProgressNotes=[];return}for(;;)if(s(a[e],r[t])<0){if(n.push(a[e]),e++,e>=a.length){this.selection.notes=n.concat(r.slice(t));break}}else if(n.push(r[t]),t++,t>=r.length){this.selection.notes=n.concat(a.slice(e));break}this.selection.inProgressNotes=[]}startDragEventSelection(){this.eventSelection.inProgressTimingEvents=[]}endDragEventSelection(){let e=0,t=0;const n=[],a=this.eventSelection.inProgressTimingEvents,r=this.eventSelection.timingEvents,s=(o,l)=>o.beat-l.beat;if(a.length==0||r.length==0){this.eventSelection.timingEvents=a.concat(r),this.eventSelection.inProgressTimingEvents=[];return}for(;;)if(s(a[e],r[t])<0){if(n.push(a[e]),e++,e>=a.length){this.eventSelection.timingEvents=n.concat(r.slice(t));break}}else if(n.push(r[t]),t++,t>=r.length){this.eventSelection.timingEvents=n.concat(a.slice(e));break}this.eventSelection.inProgressTimingEvents=[]}addNoteToDragSelection(e){this.addNoteSelection(this.selection.inProgressNotes,e)}removeNoteFromDragSelection(e){this.removeNoteSelection(this.selection.inProgressNotes,e)}addEventToDragSelection(e){this.addEventSelection(this.eventSelection.inProgressTimingEvents,e)}removeEventFromDragSelection(e){this.removeEventSelection(this.eventSelection.inProgressTimingEvents,e)}addNoteToSelection(e){this.addNoteSelection(this.selection.notes,e)}removeNoteFromSelection(e){this.removeNoteSelection(this.selection.notes,e)}setNoteSelection(e){this.selection.inProgressNotes=[],this.selection.notes=[...e].sort((t,n)=>t.beat==n.beat?t.col-n.col:t.beat-n.beat)}addEventToSelection(e){this.addEventSelection(this.eventSelection.timingEvents,e)}removeEventFromSelection(e){this.removeEventSelection(this.eventSelection.timingEvents,e)}setEventSelection(e){this.eventSelection.inProgressTimingEvents=[],this.eventSelection.timingEvents=e.sort((t,n)=>t.beat-n.beat)}isNoteInSelection(e){return this.getNoteSelectionIndex(this.selection.notes,e)!=-1||this.getNoteSelectionIndex(this.selection.inProgressNotes,e)!=-1}isEventInSelection(e){return this.getEventSelectionIndex(this.eventSelection.timingEvents,e)!=-1||this.getEventSelectionIndex(this.eventSelection.inProgressTimingEvents,e)!=-1}addNoteSelection(e,t){let n=sa(e,t.beat,a=>a.beat);for(;e[n]&&(e[n].beat<t.beat||e[n].beat==t.beat&&e[n].col<t.col);)n++;e.splice(n,0,t)}removeNoteSelection(e,t){const n=this.getNoteSelectionIndex(e,t);n!=-1&&e.splice(n,1)}getNoteSelectionIndex(e,t){let n=sa(e,t.beat,a=>a.beat);for(;e[n]&&e[n].beat==t.beat;){if(Lo(e[n],t))return n;n++}return-1}addEventSelection(e,t){let n=sa(e,t.beat,a=>a.beat);for(;e[n]&&e[n].beat<=t.beat;)n++;e.splice(n,0,t)}removeEventSelection(e,t){const n=this.getEventSelectionIndex(e,t);n!=-1&&e.splice(n,1)}getEventSelectionIndex(e,t){let n=sa(e,t.beat,a=>a.beat);for(;e[n]&&e[n].beat==t.beat;){if(Lo(e[n],t))return n;n++}return-1}selectRegion(){if(this.loadedChart){if(this.endRegion!==void 0&&(this.startRegion=void 0,this.endRegion=void 0),this.startRegion===void 0){this.clearSelections(),this.startRegion=this.beat;return}this.endRegion=this.beat,this.endRegion<this.startRegion&&(this.endRegion=this.startRegion,this.startRegion=this.beat),re.emit("regionChanged",this.startRegion,this.endRegion),this.editTimingMode==0?this.setNoteSelection(this.loadedChart.getNotedataInRange(this.startRegion,this.endRegion)):this.setEventSelection(Sa.flatMap(e=>this.loadedChart.timingData.getColumn(e).events).filter(e=>e.beat>=this.startRegion&&e.beat<=this.endRegion))}}modifySelection(e,t=!1){if(!this.loadedChart)return;const n=this.selection.notes,a=structuredClone(this.selection.notes).map(e).sort((l,u)=>l.beat==u.beat?l.col-u.col:l.beat-u.beat);if(a.length==0)return;const r=[];for(const l of a){const u=r.at(-1);u!==void 0&&u.beat==l.beat&&u.col==l.col||r.push(l)}if(r.length==0)return;const{removedNotes:s,truncatedHolds:o}=this.checkConflicts(r,n);if(t){const l=r.map(h=>Xt(h));let u=0;for(const h of l)h>u&&(u=h);const f=new Array(this.loadedChart.gameType.numCols).fill(0).map((h,p)=>({type:"Hold",hold:u-r[0].beat,col:p,beat:r[0].beat})),{removedNotes:c,truncatedHolds:d}=this.checkConflicts(f,n);c.forEach(h=>{s.includes(h)||s.push(h)}),d.forEach(h=>{const p=o.find(m=>m.oldNote==h.oldNote);if(p){const m=Oe(p.newNote)?p.newNote.hold:0,g=Oe(p.newNote)?p.newNote.hold:0,b=Math.min(m,g);b==0?p.newNote={beat:p.newNote.beat,col:p.newNote.col,type:"Tap"}:p.newNote={beat:p.newNote.beat,col:p.newNote.col,type:p.newNote.type,hold:b}}}),s.sort((h,p)=>h.beat==p.beat?h.col-p.col:h.beat-p.beat),o.sort((h,p)=>h.newNote.beat==p.newNote.beat?h.newNote.col-p.newNote.col:h.newNote.beat-p.newNote.beat)}this.app.actionHistory.run({action:()=>{this.loadedChart.removeNotes(n.concat(s),!1),o.forEach(l=>this.loadedChart.modifyNote(l.oldNote,l.newNote,!1)),this.clearSelections(),this.setNoteSelection(this.loadedChart.addNotes(r))},undo:()=>{this.loadedChart.removeNotes(r,!1),o.forEach(l=>this.loadedChart.modifyNote(l.newNote,l.oldNote,!1)),this.loadedChart.addNotes(s,!1),this.clearSelections(),this.setNoteSelection(this.loadedChart.addNotes(n))}})}checkConflicts(e,t=[]){if(e.length==0)return{removedNotes:[],truncatedHolds:[]};const n=this.loadedChart.getNotedata(),a=this.loadedChart.gameType.numCols,r=new Array(a).fill(0).map(f=>[]);for(const f of n)r[f.col].push(f);const s=new Array(a).fill(0).map(f=>[]);for(const f of e)f.col>a||s[f.col].push(f);const o=[],l=[],u=[];for(let f=0;f<a;f++){if(s[f].length==0)continue;let c=r[f].findIndex(d=>s[f][0].beat<=(Oe(d)?d.beat+d.hold:d.beat));for(const d of s[f])for(;r[f][c];){const h=r[f][c],p=Oe(d)?d.beat+d.hold:d.beat;if(!t.includes(h)&&!u.includes(h)&&(d.beat<=h.beat&&p>=h.beat?(u.push(h),o.push(h)):Oe(h)&&h.beat+h.hold>=d.beat&&h.beat<d.beat&&(u.push(h),l.push({oldNote:h,newNote:this.truncateHold(h,d.beat)}))),r[f][c+1]?.beat>p)break;c++}}return o.sort((f,c)=>f.beat==c.beat?f.col-c.col:f.beat-c.beat),l.sort((f,c)=>f.newNote.beat==c.newNote.beat?f.newNote.col-c.newNote.col:f.newNote.beat-c.newNote.beat),{removedNotes:o,truncatedHolds:l}}modifyEventSelection(e){if(!this.loadedChart||!this.loadedSM)return;const t=this.eventSelection.timingEvents.map(n=>[n,e(structuredClone(n))]);this.loadedChart.timingData.modifyColumnEvents(t)}deleteSelection(){if(this.selection.notes.length==0)return;const e=this.selection.notes;this.app.actionHistory.run({action:()=>{this.loadedChart.removeNotes(e),this.clearSelections()},undo:()=>{this.selection.notes=this.loadedChart.addNotes(e)}})}deleteEventSelection(){this.eventSelection.timingEvents.length!=0&&(!this.loadedChart||!this.loadedSM||this.loadedChart.timingData.deleteColumnEvents(this.eventSelection.timingEvents))}paste(e,t=!1){if(this.loadedChart&&(e.startsWith("ArrowVortex:notes:")&&(this.pasteNotes(e,t)||this.pasteNotes(this.virtualClipboard,t)),e.startsWith("ArrowVortex:tempo:")||e.startsWith("SMEditor:tempo:"))){this.pasteTempo(e)||this.pasteTempo(this.virtualClipboard);return}}pasteNotes(e,t=!1){if(!this.loadedChart)return!0;const n=Pm(e);return!n||n.length==0?!1:(this.insertNotes(n.map(a=>(a.beat+=this.beat,a.beat=Math.round(a.beat*48)/48,a)),t),!0)}insertNotes(e,t=!1){e.sort((r,s)=>r.beat==s.beat?r.col-s.col:r.beat-s.beat);const{removedNotes:n,truncatedHolds:a}=this.checkConflicts(e);if(t){const r=e.map(f=>Xt(f));let s=0;for(const f of r)f>s&&(s=f);const o=new Array(this.loadedChart.gameType.numCols).fill(0).map((f,c)=>({type:"Hold",hold:s-e[0].beat,col:c,beat:e[0].beat})),{removedNotes:l,truncatedHolds:u}=this.checkConflicts(o);l.forEach(f=>{n.includes(f)||n.push(f)}),u.forEach(f=>{const c=a.find(d=>d.oldNote==f.oldNote);if(c){const d=Oe(c.newNote)?c.newNote.hold:0,h=Oe(c.newNote)?c.newNote.hold:0,p=Math.min(d,h);p==0?c.newNote={beat:c.newNote.beat,col:c.newNote.col,type:"Tap"}:c.newNote={beat:c.newNote.beat,col:c.newNote.col,type:c.newNote.type,hold:p}}}),n.sort((f,c)=>f.beat==c.beat?f.col-c.col:f.beat-c.beat),a.sort((f,c)=>f.newNote.beat==c.newNote.beat?f.newNote.col-c.newNote.col:f.newNote.beat-c.newNote.beat)}this.app.actionHistory.run({action:()=>{this.loadedChart.removeNotes(n,!1),a.forEach(r=>{this.loadedChart.modifyNote(r.oldNote,r.newNote,!1)}),this.clearSelections(),this.setNoteSelection(this.loadedChart.addNotes(e))},undo:()=>{this.loadedChart.removeNotes(e,!1),a.forEach(r=>{this.loadedChart.modifyNote(r.newNote,r.oldNote,!1)}),this.setNoteSelection(this.loadedChart.addNotes(n)),this.clearSelections()}})}pasteTempo(e){if(!this.loadedChart||!this.loadedSM)return!0;const t=Wm(e);return!t||t.length==0?!1:(t.forEach(n=>{n.type=="ATTACKS"?n.second+=this.time:n.beat+=this.beat}),this.loadedChart.timingData.insertColumnEvents(t),!0)}copy(){if(this.selection.notes.length!=0){const e=Math.min(...this.selection.notes.map(a=>a.beat)),t=structuredClone(this.selection.notes).map(a=>(a.beat-=e,a)).sort((a,r)=>a.beat==r.beat?a.col-r.col:a.beat-r.beat),n=Om(t);return this.virtualClipboard=n,n}else if(this.eventSelection.timingEvents.length!=0){const e=Math.min(...this.eventSelection.timingEvents.map(r=>r.beat)),t=this.loadedChart.timingData.getSecondsFromBeat(e),n=structuredClone(this.eventSelection.timingEvents).map(r=>r.type=="ATTACKS"?(r.second-=t,r):(r.beat-=e,r)).sort((r,s)=>r.type!=s.type?r.type.localeCompare(s.type):r.type=="ATTACKS"?r.second-s.second:r.beat-s.beat),a=zm(n);return this.virtualClipboard=a,a}}}class Sg{app;view;constructor(e,t){if(this.app=e,this.view=t,!he.menuBar)return;const n=Object.values(cn).map(a=>this.createElement(a));t.replaceChildren(...n)}createElement(e){if(e.type=="separator"){const t=document.createElement("div");return t.classList.add("separator"),t}if(e.type=="selection"||e.type=="checkbox"||e.type=="dropdown"){const t=document.createElement("div"),n=document.createElement("div"),a=document.createElement("div");let r;if(e.type=="selection"||e.type=="checkbox"){const s=We[e.id]??{label:e.id,combos:[],callback:()=>{}};r=document.createElement("div"),r.innerText=xe.getKeybindString(e.id),r.classList.add("keybind","unselectable"),a.innerText=s.label;let o=s.disabled;typeof o=="function"&&(o=o(this.app)),o&&t.classList.add("disabled"),t.addEventListener("click",()=>{if(o)return;s.callback(this.app),t.closest(".menu-main").querySelector(".menubar-dropdown").replaceChildren()})}else r=me.getIcon("CHEVRON",16),r.style.transform="rotate(-90deg)",a.innerText=typeof e.title=="function"?e.title(this.app):e.title;if(n.appendChild(a),n.appendChild(r),t.appendChild(n),t.classList.add("menu-item"),n.classList.add("menu-item-title","menu-hover"),a.classList.add("title","unselectable"),e.type=="dropdown"){const s=document.createElement("div");t.appendChild(s),s.classList.add("menubar-dropdown"),e.options.map(o=>this.createElement(o)).forEach(o=>s.appendChild(o))}if(e.type=="checkbox"){let s=e.checked;typeof s=="function"&&(s=s(this.app)),s&&(a.innerText="✓ "+a.innerText)}return t}if(e.type=="menu"){const t=document.createElement("div"),n=document.createElement("div"),a=document.createElement("div");return t.appendChild(n),n.innerText=e.title,t.appendChild(a),n.classList.add("title","unselectable"),t.classList.add("menu-item","menu-main"),n.classList.add("menu-hover"),a.classList.add("menubar-dropdown","unselectable"),t.onmouseenter=()=>{a.replaceChildren(...e.options.map(r=>this.createElement(r)))},t.onmouseleave=()=>{a.replaceChildren()},t}return document.createElement("div")}}class Tg{view;windows=[];app;constructor(e,t){this.app=e,this.view=t}unfocusAll(){for(const e of this.view.querySelectorAll(".focused"))e.classList.remove("focused")}getFocusedWindow(){for(const e of this.windows)if(e.windowElement.classList.contains("focused"))return e;return null}isBlocked(){return!this.windows.every(e=>!e.options.blocking)}openWindow(e){if(e.options.win_id){const t=this.getWindowById(e.options.win_id);if(t){t.focus();return}}e.addToManager(this),this.windows.push(e)}removeWindow(e){this.windows.splice(this.windows.indexOf(e),1)}getWindowById(e){for(const t of this.windows)if(t.options.win_id==e)return t}}const xs=960;class Mg{VERSION="1.3.0";options=y;events=re;themes=Fe;renderer;stage;view;chartManager;windowManager;menubarManager;actionHistory;capturing=!1;STAGE_HEIGHT=xs;STAGE_WIDTH=xs;lastWidth=-1;lastHeight=-1;constructor(){if(Xe.setDefaultProps({duration:[200,100],theme:"sm"}),y.loadOptions(),ad(),xe.load(this),window.nw){const e=nw.Window.get();y.app.fullscreen?e.enterFullscreen():e.resizeTo(y.app.width,y.app.height)}if(setInterval(()=>{this.capturing||y.saveOptions()},1e4),y.general.smoothAnimations&&document.body.classList.add("animated"),document.body.parentElement.style.fontSize=`${y.general.uiScale*100}%`,this.registerFonts(),this.view=document.getElementById("pixi"),document.oncontextmenu=e=>{e.preventDefault(),this.chartManager.loadedChart&&e.target==this.view&&Vs.open(this,e)},this.view.onmousedown=()=>{Vs.close()},this.stage=new fe,this.stage.sortableChildren=!0,this.renderer=new rd({backgroundColor:1579292,antialias:y.performance.antialiasing,width:this.view.clientWidth,height:this.view.clientHeight,resolution:y.performance.resolution,autoDensity:!0,view:this.view,powerPreference:"low-power"}),St.shared.maxFPS=0,St.shared.add(()=>{const e=performance.now();this.chartManager.widgetManager.update(),this.chartManager.loadedSM&&this.chartManager.loadedChart&&this.chartManager.chartView&&this.chartManager.chartView.update(),ji.instance?.addDrawUpdateTimeValue(performance.now()-e);const t=performance.now();this.renderer.render(this.stage),ji.instance?.addFrameTimeValue(performance.now()-t),performance.memory?.usedJSHeapSize&&ji.instance?.addMemoryTimeValue(performance.memory.usedJSHeapSize),bm()},Lc.HIGH),St.shared.start(),dt.init(this.renderer),this.chartManager=new kg(this),this.menubarManager=new Sg(this,document.getElementById("menubar")),this.windowManager=new Tg(this,document.getElementById("windows")),this.actionHistory=new Et(this),this.registerListeners(),!he.hidePoweredByText&&sd()){const e=document.getElementById("embed");e.appendChild(document.createTextNode("Powered by "));const t=document.createElement("a");if(t.href="https://tillvit.github.io/smeditor/",t.innerText="SMEditor",t.target="_blank",e.appendChild(t),he.url!=null){e.appendChild(document.createTextNode(" | Open this chart in a "));const n=document.createElement("a"),a=new URL(location.origin+"/smeditor/app/");n.innerText="new tab",n.target="_blank",a.searchParams.append("url",he.url),he.chartType!==null&&a.searchParams.append("chartType",he.chartType),he.chartIndex!==null&&a.searchParams.append("chartIndex",he.chartIndex+""),n.href=a.toString(),e.appendChild(n)}}Ee.initFileSystem().then(()=>{if(he.url){this.chartManager.loadSM(he.url).then(()=>{const e=this.chartManager.loadedSM;if(!e)return;let t;if(he.chartType!=null&&(t=e.charts[he.chartType],t===void 0)){de.createFormatted(`Couldn't find chart with type ${he.chartType}`,"warn");return}if(t===void 0){const a=Object.keys(e.charts);if(a.length==0||(t=e.charts[a[0]],t.length==0))return}let n;if(he.chartIndex!=null&&(n=t.at(he.chartIndex),n===void 0)){de.createFormatted(`Couldn't find chart with index ${he.chartIndex}`,"warn");return}n===void 0&&(n=t.at(-1),!n)||this.chartManager.loadChart(n)});return}if(this.windowManager.openWindow(new vo(this)),window.nw){const e=nw.Window.get();nw.App.on("open",t=>{if(!t||t?.length===0){nw.Window.open(window.location.href);return}let n="";for(let a of t)if(a.startsWith("file://")&&(a=a.substring(7)),Tt(a)==".ssc"){n=a;break}else n==""&&Tt(a)==".sm"&&(n=a);n!=""&&(this.chartManager.loadSM(n),this.windowManager.getWindowById("select_sm_initial")?.closeWindow())}),window.addEventListener("keydown",t=>{t.key=="r"&&(t.metaKey||t.ctrlKey)&&(t.preventDefault(),e.reload()),t.code=="KeyW"&&(t.metaKey||t.ctrlKey)&&(t.preventDefault(),e.close()),process.versions["nw-flavor"]=="sdk"&&t.code=="KeyI"&&t.metaKey&&t.altKey&&(t.preventDefault(),e.showDevTools())}),e.on("enter-fullscreen",()=>{y.app.fullscreen=e.isFullscreen}),e.on("resize",(t,n)=>{e.isFullscreen||(y.app.width=t,y.app.height=n)}),e.on("restore",()=>{y.app.fullscreen=e.isFullscreen}),this.checkAppVersion()}this.checkCoreVersion()}),window.onbeforeunload=e=>{if(Et.instance.isDirty()&&y.general.warnBeforeExit)return e.preventDefault(),e.returnValue="Are you sure you want to exit?"},window.onpagehide=()=>{this.capturing||y.saveOptions()},Fe.loadTheme(y.general.theme)}registerFonts(){tr.from("Main",{fontFamily:"Assistant",fontSize:20,fill:"white"},{chars:[["a","z"],["A","Z"],"!@#$%^&*()~{}[]:.-?=,_|","0123456789/"," "],resolution:window.devicePixelRatio}),tr.from("Mono",{fontFamily:"monospace",fontSize:20,fill:"white"},{chars:[["a","z"],["A","Z"],"!@#$%^&*()~{}[]:.-?=,_|","0123456789/"," "],resolution:window.devicePixelRatio}),tr.from("Fancy",{fontFamily:"Assistant",fontSize:40,fontWeight:"700",fill:["#dddddd","#ffffff"],fillGradientType:od.LINEAR_VERTICAL,stroke:11184810,strokeThickness:3},{chars:[["a","z"],["A","Z"],"!@#$%^&*()~{}[]:.-?=,_|","0123456789/"," "],resolution:window.devicePixelRatio})}registerListeners(){this.view.addEventListener("mousedown",()=>{this.windowManager.unfocusAll()}),re.on("themeChanged",()=>{this.renderer.background.color=new F(Fe.getCurrentTheme()["editor-bg"]).toNumber()}),re.on("userOptionUpdated",e=>{e=="general.uiScale"&&this.updateSize()}),window.addEventListener("keydown",function(e){e.code=="Enter"&&e.target instanceof HTMLButtonElement&&e.preventDefault()}),window.addEventListener("dragstart",function(e){e.target instanceof HTMLImageElement&&e.preventDefault()}),setInterval(()=>{if(this.capturing)return;const e=window.innerWidth,t=this.getCanvasHeight();(this.lastHeight!=t||this.lastWidth!=e)&&(this.lastHeight=t,this.lastWidth=e,this.onResize(e,t),re.emit("resize"))},100),window.addEventListener("dragover",e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy"}),window.addEventListener("drop",e=>{if(window.nw){e.stopPropagation(),e.preventDefault();let t="";for(const n of e.dataTransfer.files)if(n.path)if(Tt(n.path)==".ssc"){t=n.path;break}else t==""&&Tt(n.path)==".sm"&&(t=n.path);t!=""&&(this.chartManager.loadSM(t),this.windowManager.getWindowById("select_sm_initial")?.closeWindow())}else Ee.handleDropEvent(e).then(t=>{const n=new Qa(this,{title:"Select an sm/ssc file...",accepted_file_types:[".sm",".ssc"],disableClose:!0,callback:a=>{this.chartManager.loadSM(a),this.windowManager.getWindowById("select_sm_initial")?.closeWindow()},onload:()=>{n.getAcceptableFile(t??"").then(a=>n.selectPath(a))}});this.windowManager.openWindow(n)})})}onResize(e,t){this.renderer.screen.width=e,this.renderer.screen.height=t,this.view.width=e*this.renderer.resolution,this.view.height=t*this.renderer.resolution,this.view.style.width=`${e}px`,this.view.style.height=`${t}px`,this.STAGE_HEIGHT=xs/y.general.uiScale;const n=t/this.STAGE_HEIGHT;this.stage.scale.set(n),this.stage.position.set(e/2,t/2),this.STAGE_WIDTH=e/n}updateSize(){const e=window.innerWidth,t=this.getCanvasHeight();this.lastHeight=t,this.lastWidth=e,this.onResize(e,t),re.emit("resize")}getCanvasHeight(){return window.innerHeight-(document.getElementById("menubar")?.clientHeight??0)-(document.getElementById("playback-options")?.clientHeight??0)}checkAppVersion(){if(!window.nw)return;const e=nw.require("nw.gui"),t={stable:3,beta:2,alpha:1,nightly:0};let n="win";process.platform=="darwin"?n=nw.require("os").arch()=="arm64"?"mac-arm":"mac-x64":process.platform=="linux"&&(n="linux"),fetch("/smeditor/assets/app/versions.json").then(a=>a.json()).then(a=>{a=a.sort((s,o)=>t[s.type]!=t[o.type]?t[o.type]-t[s.type]:o.date-s.date);const r=a[0];_l.lt(e.App.manifest.version,r.version)&&localStorage.getItem("downloadedVersion")!==r.version&&Hu.open(r.version,r.downloads[n])})}checkCoreVersion(){const e=Nd({});navigator.serviceWorker.addEventListener("controllerchange",()=>{zu.open(e),console.log("Found new version")});const t=localStorage.getItem("coreVersion");t!==null&&_l.lt(t,this.VERSION)&&this.windowManager.openWindow(new Su(this)),localStorage.setItem("coreVersion",this.VERSION)}}document.querySelector("body").innerHTML=`<div id="popups"></div>
          <div id="view-wrapper">
            <div id="menubar"></div>
            <div id="waterfall"><div id="waterfall-container"></div></div>
            <canvas id="pixi"></canvas>
          </div>
          <div id="context-menu"></div>
          <div id="blocker" style="display: none"></div>
          <div id="windows"></div>
          <div id="embed"></div>
        `;Vd.load({custom:{families:["Assistant"]},active:Cc,inactive:Cc,classes:!1});function Cc(){const i=document.createElement("canvas");i.getContext("webgl")||i.getContext("experimental-webgl")?(window.app=new Mg,window.GameTypeRegistry=bt,window.NoteskinRegistry=it):document.querySelector("body").innerHTML=`<div class='browser-unsupported'>
      <div class='browser-unsupported-item'>
      <h1>WebGL is not enabled</h1>
      <div>Please visit your browser settings and enable WebGL.</div>
      </div>
    </div>`}export{Rg as A,$t as B,Ki as F,ju as H,Ge as _,Xn as a,ci as b,Mn as e,Ud as i,Ig as l,ro as r,Fg as s};
