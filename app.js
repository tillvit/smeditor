const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["memory-NBqPtv5z.js","Simfile-B3_kH-9l.js","assets/Simfile-Bi8zDpmu.css","downloader-DRBETDf_.js","FileSystemWritableFileStream-D05uA35V.js","web-streams-ponyfill-BfVhaP7e.js","NodeFileHandler-D5HkseV1.js","Noteskin-B-7cmsou.js","HoldBody-CG26JuPz.js","Noteskin-CV6tIjEK.js","Noteskin-BGcgPKKW.js","AnimatedSprite-CQpssVBH.js","Noteskin-B0YL7Wkd.js","Noteskin-CdjkZfmh.js","Noteskin-DvoQcEaB.js","Noteskin-Dx_FU4db.js","Noteskin-OyPWN-Sa.js","Noteskin-DyJ2ONJL.js","Noteskin-CthdTHp6.js","Noteskin-BAAn1Xj2.js","Noteskin-BjQBn6sD.js","Noteskin-M8_jdGnS.js","Noteskin-DZRb_M6o.js","Noteskin-ySwkfFaK.js","Noteskin-BvtnRQRH.js"])))=>i.map(i=>d[i]);
import{M as Uu,a as qu,b as Gu,T as Se,C as ye,B as $u,c as L,g as Kn,d as hi,O as y,I as pe,e as Ae,F as he,f as At,h as qt,i as Ps,j as Re,k as wt,G as ft,t as Ke,p as In,r as ue,W as de,E as le,l as xt,D as li,m as ju,n as wo,A as Lt,o as Yu,q as pn,S as xc,s as vo,u as _c,v as Ia,w as vt,x as xi,y as Cc,z as Ku,H as Gi,J as Rn,K as Xu,L as ni,Q as mn,N as Kt,P as xo,R as Ra,U as _i,V as Ee,X as De,Y as Vi,Z as si,_ as sn,$ as oi,a0 as pi,a1 as Os,a2 as Pn,a3 as Zu,a4 as Ec,a5 as _a,a6 as _o,a7 as Qu,a8 as Co,a9 as Ju,aa as gs,ab as ed,ac as Ac,ad as bs,ae as ta,af as Eo,ag as td,ah as id,ai as nd,aj as Ao,ak as ad}from"./Simfile-B3_kH-9l.js";class rd extends Uu{constructor(e=100,t=100,n=10,a=10){super(),this.segWidth=n,this.segHeight=a,this.width=e,this.height=t,this.build()}build(){const e=this.segWidth*this.segHeight,t=[],n=[],a=[],r=this.segWidth-1,s=this.segHeight-1,o=this.width/r,l=this.height/s;for(let f=0;f<e;f++){const c=f%this.segWidth,d=f/this.segWidth|0;t.push(c*o,d*l),n.push(c/r,d/s)}const u=r*s;for(let f=0;f<u;f++){const c=f%r,d=f/r|0,h=d*this.segWidth+c,p=d*this.segWidth+c+1,m=(d+1)*this.segWidth+c,g=(d+1)*this.segWidth+c+1;a.push(h,p,m,p,g,m)}this.buffers[0].data=new Float32Array(t),this.buffers[1].data=new Float32Array(n),this.indexBuffer.data=new Uint16Array(a),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}}class sd extends qu{constructor(e,t,n){const a=new rd(e.width,e.height,t,n),r=new Gu(Se.WHITE);super(a,r),this.texture=e,this.autoResize=!0}textureUpdated(){this._textureID=this.shader.texture._updateID;const e=this.geometry,{width:t,height:n}=this.shader.texture;this.autoResize&&(e.width!==t||e.height!==n)&&(e.width=this.shader.texture.width,e.height=this.shader.texture.height,e.build())}set texture(e){this.shader.texture!==e&&(this.shader.texture=e,this._textureID=-1,e.baseTexture.valid?this.textureUpdated():e.once("update",this.textureUpdated,this))}get texture(){return this.shader.texture}_render(e){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),super._render(e)}destroy(e){this.shader.texture.off("update",this.textureUpdated,this),super.destroy(e)}}const ia=10;class kc extends sd{constructor(e,t,n,a,r){super(Se.WHITE,4,4),this._origWidth=e.orig.width,this._origHeight=e.orig.height,this._width=this._origWidth,this._height=this._origHeight,this._leftWidth=t??e.defaultBorders?.left??ia,this._rightWidth=a??e.defaultBorders?.right??ia,this._topHeight=n??e.defaultBorders?.top??ia,this._bottomHeight=r??e.defaultBorders?.bottom??ia,this.texture=e}textureUpdated(){this._textureID=this.shader.texture._updateID,this._refresh()}get vertices(){return this.geometry.getBuffer("aVertexPosition").data}set vertices(e){this.geometry.getBuffer("aVertexPosition").data=e}updateHorizontalVertices(){const e=this.vertices,t=this._getMinScale();e[9]=e[11]=e[13]=e[15]=this._topHeight*t,e[17]=e[19]=e[21]=e[23]=this._height-this._bottomHeight*t,e[25]=e[27]=e[29]=e[31]=this._height}updateVerticalVertices(){const e=this.vertices,t=this._getMinScale();e[2]=e[10]=e[18]=e[26]=this._leftWidth*t,e[4]=e[12]=e[20]=e[28]=this._width-this._rightWidth*t,e[6]=e[14]=e[22]=e[30]=this._width}_getMinScale(){const e=this._leftWidth+this._rightWidth,t=this._width>e?1:this._width/e,n=this._topHeight+this._bottomHeight,a=this._height>n?1:this._height/n;return Math.min(t,a)}get width(){return this._width}set width(e){this._width=e,this._refresh()}get height(){return this._height}set height(e){this._height=e,this._refresh()}get leftWidth(){return this._leftWidth}set leftWidth(e){this._leftWidth=e,this._refresh()}get rightWidth(){return this._rightWidth}set rightWidth(e){this._rightWidth=e,this._refresh()}get topHeight(){return this._topHeight}set topHeight(e){this._topHeight=e,this._refresh()}get bottomHeight(){return this._bottomHeight}set bottomHeight(e){this._bottomHeight=e,this._refresh()}_refresh(){const e=this.texture,t=this.geometry.buffers[1].data;this._origWidth=e.orig.width,this._origHeight=e.orig.height;const n=1/this._origWidth,a=1/this._origHeight;t[0]=t[8]=t[16]=t[24]=0,t[1]=t[3]=t[5]=t[7]=0,t[6]=t[14]=t[22]=t[30]=1,t[25]=t[27]=t[29]=t[31]=1,t[2]=t[10]=t[18]=t[26]=n*this._leftWidth,t[4]=t[12]=t[20]=t[28]=1-n*this._rightWidth,t[9]=t[11]=t[13]=t[15]=a*this._topHeight,t[17]=t[19]=t[21]=t[23]=1-a*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()}}class Ns extends ye{constructor(e=1500,t,n=16384,a=!1){super();const r=16384;n>r&&(n=r),this._properties=[!1,!0,!1,!1,!1],this._maxSize=e,this._batchSize=n,this._buffers=null,this._bufferUpdateIDs=[],this._updateID=0,this.interactiveChildren=!1,this.blendMode=$u.NORMAL,this.autoResize=a,this.roundPixels=!0,this.baseTexture=null,this.setProperties(t),this._tintColor=new L(0),this.tintRgb=new Float32Array(3),this.tint=16777215}setProperties(e){e&&(this._properties[0]="vertices"in e||"scale"in e?!!e.vertices||!!e.scale:this._properties[0],this._properties[1]="position"in e?!!e.position:this._properties[1],this._properties[2]="rotation"in e?!!e.rotation:this._properties[2],this._properties[3]="uvs"in e?!!e.uvs:this._properties[3],this._properties[4]="tint"in e||"alpha"in e?!!e.tint||!!e.alpha:this._properties[4])}updateTransform(){this.displayObjectUpdateTransform()}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e),this._tintColor.toRgbArray(this.tintRgb)}render(e){!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable||(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",()=>this.onChildrenChange(0))),e.batch.setObjectRenderer(e.plugins.particle),e.plugins.particle.render(this))}onChildrenChange(e){const t=Math.floor(e/this._batchSize);for(;this._bufferUpdateIDs.length<t;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[t]=++this._updateID}dispose(){if(this._buffers){for(let e=0;e<this._buffers.length;++e)this._buffers[e].destroy();this._buffers=null}}destroy(e){super.destroy(e),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null}}var na={exports:{}},Xa,ko;function Pa(){if(ko)return Xa;ko=1;const i="2.0.0",e=256,t=Number.MAX_SAFE_INTEGER||9007199254740991,n=16,a=e-6;return Xa={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:a,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:i,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},Xa}var Za,So;function Oa(){if(So)return Za;So=1;var i={};return Za=typeof process=="object"&&i&&i.NODE_DEBUG&&/\bsemver\b/i.test(i.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{},Za}var To;function Xn(){return To||(To=1,function(i,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:a}=Pa(),r=Oa();e=i.exports={};const s=e.re=[],o=e.safeRe=[],l=e.src=[],u=e.t={};let f=0;const c="[a-zA-Z0-9-]",d=[["\\s",1],["\\d",a],[c,n]],h=m=>{for(const[g,b]of d)m=m.split(`${g}*`).join(`${g}{0,${b}}`).split(`${g}+`).join(`${g}{1,${b}}`);return m},p=(m,g,b)=>{const x=h(g),v=f++;r(m,v,g),u[m]=v,l[v]=g,s[v]=new RegExp(g,b?"g":void 0),o[v]=new RegExp(x,b?"g":void 0)};p("NUMERICIDENTIFIER","0|[1-9]\\d*"),p("NUMERICIDENTIFIERLOOSE","\\d+"),p("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${c}*`),p("MAINVERSION",`(${l[u.NUMERICIDENTIFIER]})\\.(${l[u.NUMERICIDENTIFIER]})\\.(${l[u.NUMERICIDENTIFIER]})`),p("MAINVERSIONLOOSE",`(${l[u.NUMERICIDENTIFIERLOOSE]})\\.(${l[u.NUMERICIDENTIFIERLOOSE]})\\.(${l[u.NUMERICIDENTIFIERLOOSE]})`),p("PRERELEASEIDENTIFIER",`(?:${l[u.NUMERICIDENTIFIER]}|${l[u.NONNUMERICIDENTIFIER]})`),p("PRERELEASEIDENTIFIERLOOSE",`(?:${l[u.NUMERICIDENTIFIERLOOSE]}|${l[u.NONNUMERICIDENTIFIER]})`),p("PRERELEASE",`(?:-(${l[u.PRERELEASEIDENTIFIER]}(?:\\.${l[u.PRERELEASEIDENTIFIER]})*))`),p("PRERELEASELOOSE",`(?:-?(${l[u.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${l[u.PRERELEASEIDENTIFIERLOOSE]})*))`),p("BUILDIDENTIFIER",`${c}+`),p("BUILD",`(?:\\+(${l[u.BUILDIDENTIFIER]}(?:\\.${l[u.BUILDIDENTIFIER]})*))`),p("FULLPLAIN",`v?${l[u.MAINVERSION]}${l[u.PRERELEASE]}?${l[u.BUILD]}?`),p("FULL",`^${l[u.FULLPLAIN]}$`),p("LOOSEPLAIN",`[v=\\s]*${l[u.MAINVERSIONLOOSE]}${l[u.PRERELEASELOOSE]}?${l[u.BUILD]}?`),p("LOOSE",`^${l[u.LOOSEPLAIN]}$`),p("GTLT","((?:<|>)?=?)"),p("XRANGEIDENTIFIERLOOSE",`${l[u.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),p("XRANGEIDENTIFIER",`${l[u.NUMERICIDENTIFIER]}|x|X|\\*`),p("XRANGEPLAIN",`[v=\\s]*(${l[u.XRANGEIDENTIFIER]})(?:\\.(${l[u.XRANGEIDENTIFIER]})(?:\\.(${l[u.XRANGEIDENTIFIER]})(?:${l[u.PRERELEASE]})?${l[u.BUILD]}?)?)?`),p("XRANGEPLAINLOOSE",`[v=\\s]*(${l[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[u.XRANGEIDENTIFIERLOOSE]})(?:${l[u.PRERELEASELOOSE]})?${l[u.BUILD]}?)?)?`),p("XRANGE",`^${l[u.GTLT]}\\s*${l[u.XRANGEPLAIN]}$`),p("XRANGELOOSE",`^${l[u.GTLT]}\\s*${l[u.XRANGEPLAINLOOSE]}$`),p("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),p("COERCE",`${l[u.COERCEPLAIN]}(?:$|[^\\d])`),p("COERCEFULL",l[u.COERCEPLAIN]+`(?:${l[u.PRERELEASE]})?(?:${l[u.BUILD]})?(?:$|[^\\d])`),p("COERCERTL",l[u.COERCE],!0),p("COERCERTLFULL",l[u.COERCEFULL],!0),p("LONETILDE","(?:~>?)"),p("TILDETRIM",`(\\s*)${l[u.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",p("TILDE",`^${l[u.LONETILDE]}${l[u.XRANGEPLAIN]}$`),p("TILDELOOSE",`^${l[u.LONETILDE]}${l[u.XRANGEPLAINLOOSE]}$`),p("LONECARET","(?:\\^)"),p("CARETTRIM",`(\\s*)${l[u.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",p("CARET",`^${l[u.LONECARET]}${l[u.XRANGEPLAIN]}$`),p("CARETLOOSE",`^${l[u.LONECARET]}${l[u.XRANGEPLAINLOOSE]}$`),p("COMPARATORLOOSE",`^${l[u.GTLT]}\\s*(${l[u.LOOSEPLAIN]})$|^$`),p("COMPARATOR",`^${l[u.GTLT]}\\s*(${l[u.FULLPLAIN]})$|^$`),p("COMPARATORTRIM",`(\\s*)${l[u.GTLT]}\\s*(${l[u.LOOSEPLAIN]}|${l[u.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",p("HYPHENRANGE",`^\\s*(${l[u.XRANGEPLAIN]})\\s+-\\s+(${l[u.XRANGEPLAIN]})\\s*$`),p("HYPHENRANGELOOSE",`^\\s*(${l[u.XRANGEPLAINLOOSE]})\\s+-\\s+(${l[u.XRANGEPLAINLOOSE]})\\s*$`),p("STAR","(<|>)?=?\\s*\\*"),p("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),p("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(na,na.exports)),na.exports}var Qa,Mo;function Hs(){if(Mo)return Qa;Mo=1;const i=Object.freeze({loose:!0}),e=Object.freeze({});return Qa=n=>n?typeof n!="object"?i:n:e,Qa}var Ja,Do;function Sc(){if(Do)return Ja;Do=1;const i=/^[0-9]+$/,e=(n,a)=>{const r=i.test(n),s=i.test(a);return r&&s&&(n=+n,a=+a),n===a?0:r&&!s?-1:s&&!r?1:n<a?-1:1};return Ja={compareIdentifiers:e,rcompareIdentifiers:(n,a)=>e(a,n)},Ja}var er,Lo;function _t(){if(Lo)return er;Lo=1;const i=Oa(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:t}=Pa(),{safeRe:n,t:a}=Xn(),r=Hs(),{compareIdentifiers:s}=Sc();class o{constructor(u,f){if(f=r(f),u instanceof o){if(u.loose===!!f.loose&&u.includePrerelease===!!f.includePrerelease)return u;u=u.version}else if(typeof u!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof u}".`);if(u.length>e)throw new TypeError(`version is longer than ${e} characters`);i("SemVer",u,f),this.options=f,this.loose=!!f.loose,this.includePrerelease=!!f.includePrerelease;const c=u.trim().match(f.loose?n[a.LOOSE]:n[a.FULL]);if(!c)throw new TypeError(`Invalid Version: ${u}`);if(this.raw=u,this.major=+c[1],this.minor=+c[2],this.patch=+c[3],this.major>t||this.major<0)throw new TypeError("Invalid major version");if(this.minor>t||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>t||this.patch<0)throw new TypeError("Invalid patch version");c[4]?this.prerelease=c[4].split(".").map(d=>{if(/^[0-9]+$/.test(d)){const h=+d;if(h>=0&&h<t)return h}return d}):this.prerelease=[],this.build=c[5]?c[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(u){if(i("SemVer.compare",this.version,this.options,u),!(u instanceof o)){if(typeof u=="string"&&u===this.version)return 0;u=new o(u,this.options)}return u.version===this.version?0:this.compareMain(u)||this.comparePre(u)}compareMain(u){return u instanceof o||(u=new o(u,this.options)),s(this.major,u.major)||s(this.minor,u.minor)||s(this.patch,u.patch)}comparePre(u){if(u instanceof o||(u=new o(u,this.options)),this.prerelease.length&&!u.prerelease.length)return-1;if(!this.prerelease.length&&u.prerelease.length)return 1;if(!this.prerelease.length&&!u.prerelease.length)return 0;let f=0;do{const c=this.prerelease[f],d=u.prerelease[f];if(i("prerelease compare",f,c,d),c===void 0&&d===void 0)return 0;if(d===void 0)return 1;if(c===void 0)return-1;if(c===d)continue;return s(c,d)}while(++f)}compareBuild(u){u instanceof o||(u=new o(u,this.options));let f=0;do{const c=this.build[f],d=u.build[f];if(i("build compare",f,c,d),c===void 0&&d===void 0)return 0;if(d===void 0)return 1;if(c===void 0)return-1;if(c===d)continue;return s(c,d)}while(++f)}inc(u,f,c){switch(u){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",f,c);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",f,c);break;case"prepatch":this.prerelease.length=0,this.inc("patch",f,c),this.inc("pre",f,c);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",f,c),this.inc("pre",f,c);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const d=Number(c)?1:0;if(!f&&c===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[d];else{let h=this.prerelease.length;for(;--h>=0;)typeof this.prerelease[h]=="number"&&(this.prerelease[h]++,h=-2);if(h===-1){if(f===this.prerelease.join(".")&&c===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(d)}}if(f){let h=[f,d];c===!1&&(h=[f]),s(this.prerelease[0],f)===0?isNaN(this.prerelease[1])&&(this.prerelease=h):this.prerelease=h}break}default:throw new Error(`invalid increment argument: ${u}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return er=o,er}var tr,Bo;function dn(){if(Bo)return tr;Bo=1;const i=_t();return tr=(t,n,a=!1)=>{if(t instanceof i)return t;try{return new i(t,n)}catch(r){if(!a)return null;throw r}},tr}var ir,Fo;function od(){if(Fo)return ir;Fo=1;const i=dn();return ir=(t,n)=>{const a=i(t,n);return a?a.version:null},ir}var nr,Io;function ld(){if(Io)return nr;Io=1;const i=dn();return nr=(t,n)=>{const a=i(t.trim().replace(/^[=v]+/,""),n);return a?a.version:null},nr}var ar,Ro;function cd(){if(Ro)return ar;Ro=1;const i=_t();return ar=(t,n,a,r,s)=>{typeof a=="string"&&(s=r,r=a,a=void 0);try{return new i(t instanceof i?t.version:t,a).inc(n,r,s).version}catch{return null}},ar}var rr,Po;function ud(){if(Po)return rr;Po=1;const i=dn();return rr=(t,n)=>{const a=i(t,null,!0),r=i(n,null,!0),s=a.compare(r);if(s===0)return null;const o=s>0,l=o?a:r,u=o?r:a,f=!!l.prerelease.length;if(!!u.prerelease.length&&!f)return!u.patch&&!u.minor?"major":l.patch?"patch":l.minor?"minor":"major";const d=f?"pre":"";return a.major!==r.major?d+"major":a.minor!==r.minor?d+"minor":a.patch!==r.patch?d+"patch":"prerelease"},rr}var sr,Oo;function dd(){if(Oo)return sr;Oo=1;const i=_t();return sr=(t,n)=>new i(t,n).major,sr}var or,No;function hd(){if(No)return or;No=1;const i=_t();return or=(t,n)=>new i(t,n).minor,or}var lr,Ho;function fd(){if(Ho)return lr;Ho=1;const i=_t();return lr=(t,n)=>new i(t,n).patch,lr}var cr,zo;function pd(){if(zo)return cr;zo=1;const i=dn();return cr=(t,n)=>{const a=i(t,n);return a&&a.prerelease.length?a.prerelease:null},cr}var ur,Vo;function $t(){if(Vo)return ur;Vo=1;const i=_t();return ur=(t,n,a)=>new i(t,a).compare(new i(n,a)),ur}var dr,Wo;function md(){if(Wo)return dr;Wo=1;const i=$t();return dr=(t,n,a)=>i(n,t,a),dr}var hr,Uo;function gd(){if(Uo)return hr;Uo=1;const i=$t();return hr=(t,n)=>i(t,n,!0),hr}var fr,qo;function zs(){if(qo)return fr;qo=1;const i=_t();return fr=(t,n,a)=>{const r=new i(t,a),s=new i(n,a);return r.compare(s)||r.compareBuild(s)},fr}var pr,Go;function bd(){if(Go)return pr;Go=1;const i=zs();return pr=(t,n)=>t.sort((a,r)=>i(a,r,n)),pr}var mr,$o;function yd(){if($o)return mr;$o=1;const i=zs();return mr=(t,n)=>t.sort((a,r)=>i(r,a,n)),mr}var gr,jo;function Na(){if(jo)return gr;jo=1;const i=$t();return gr=(t,n,a)=>i(t,n,a)>0,gr}var br,Yo;function Vs(){if(Yo)return br;Yo=1;const i=$t();return br=(t,n,a)=>i(t,n,a)<0,br}var yr,Ko;function Tc(){if(Ko)return yr;Ko=1;const i=$t();return yr=(t,n,a)=>i(t,n,a)===0,yr}var wr,Xo;function Mc(){if(Xo)return wr;Xo=1;const i=$t();return wr=(t,n,a)=>i(t,n,a)!==0,wr}var vr,Zo;function Ws(){if(Zo)return vr;Zo=1;const i=$t();return vr=(t,n,a)=>i(t,n,a)>=0,vr}var xr,Qo;function Us(){if(Qo)return xr;Qo=1;const i=$t();return xr=(t,n,a)=>i(t,n,a)<=0,xr}var _r,Jo;function Dc(){if(Jo)return _r;Jo=1;const i=Tc(),e=Mc(),t=Na(),n=Ws(),a=Vs(),r=Us();return _r=(o,l,u,f)=>{switch(l){case"===":return typeof o=="object"&&(o=o.version),typeof u=="object"&&(u=u.version),o===u;case"!==":return typeof o=="object"&&(o=o.version),typeof u=="object"&&(u=u.version),o!==u;case"":case"=":case"==":return i(o,u,f);case"!=":return e(o,u,f);case">":return t(o,u,f);case">=":return n(o,u,f);case"<":return a(o,u,f);case"<=":return r(o,u,f);default:throw new TypeError(`Invalid operator: ${l}`)}},_r}var Cr,el;function wd(){if(el)return Cr;el=1;const i=_t(),e=dn(),{safeRe:t,t:n}=Xn();return Cr=(r,s)=>{if(r instanceof i)return r;if(typeof r=="number"&&(r=String(r)),typeof r!="string")return null;s=s||{};let o=null;if(!s.rtl)o=r.match(s.includePrerelease?t[n.COERCEFULL]:t[n.COERCE]);else{const h=s.includePrerelease?t[n.COERCERTLFULL]:t[n.COERCERTL];let p;for(;(p=h.exec(r))&&(!o||o.index+o[0].length!==r.length);)(!o||p.index+p[0].length!==o.index+o[0].length)&&(o=p),h.lastIndex=p.index+p[1].length+p[2].length;h.lastIndex=-1}if(o===null)return null;const l=o[2],u=o[3]||"0",f=o[4]||"0",c=s.includePrerelease&&o[5]?`-${o[5]}`:"",d=s.includePrerelease&&o[6]?`+${o[6]}`:"";return e(`${l}.${u}.${f}${c}${d}`,s)},Cr}var Er,tl;function vd(){if(tl)return Er;tl=1;class i{constructor(){this.max=1e3,this.map=new Map}get(t){const n=this.map.get(t);if(n!==void 0)return this.map.delete(t),this.map.set(t,n),n}delete(t){return this.map.delete(t)}set(t,n){if(!this.delete(t)&&n!==void 0){if(this.map.size>=this.max){const r=this.map.keys().next().value;this.delete(r)}this.map.set(t,n)}return this}}return Er=i,Er}var Ar,il;function jt(){if(il)return Ar;il=1;const i=/\s+/g;class e{constructor(M,G){if(G=a(G),M instanceof e)return M.loose===!!G.loose&&M.includePrerelease===!!G.includePrerelease?M:new e(M.raw,G);if(M instanceof r)return this.raw=M.value,this.set=[[M]],this.formatted=void 0,this;if(this.options=G,this.loose=!!G.loose,this.includePrerelease=!!G.includePrerelease,this.raw=M.trim().replace(i," "),this.set=this.raw.split("||").map(B=>this.parseRange(B.trim())).filter(B=>B.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const B=this.set[0];if(this.set=this.set.filter(D=>!m(D[0])),this.set.length===0)this.set=[B];else if(this.set.length>1){for(const D of this.set)if(D.length===1&&g(D[0])){this.set=[D];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let M=0;M<this.set.length;M++){M>0&&(this.formatted+="||");const G=this.set[M];for(let B=0;B<G.length;B++)B>0&&(this.formatted+=" "),this.formatted+=G[B].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(M){const B=((this.options.includePrerelease&&h)|(this.options.loose&&p))+":"+M,D=n.get(B);if(D)return D;const V=this.options.loose,X=V?l[u.HYPHENRANGELOOSE]:l[u.HYPHENRANGE];M=M.replace(X,T(this.options.includePrerelease)),s("hyphen replace",M),M=M.replace(l[u.COMPARATORTRIM],f),s("comparator trim",M),M=M.replace(l[u.TILDETRIM],c),s("tilde trim",M),M=M.replace(l[u.CARETTRIM],d),s("caret trim",M);let P=M.split(" ").map(ee=>x(ee,this.options)).join(" ").split(/\s+/).map(ee=>ae(ee,this.options));V&&(P=P.filter(ee=>(s("loose invalid filter",ee,this.options),!!ee.match(l[u.COMPARATORLOOSE])))),s("range list",P);const F=new Map,ne=P.map(ee=>new r(ee,this.options));for(const ee of ne){if(m(ee))return[ee];F.set(ee.value,ee)}F.size>1&&F.has("")&&F.delete("");const ie=[...F.values()];return n.set(B,ie),ie}intersects(M,G){if(!(M instanceof e))throw new TypeError("a Range is required");return this.set.some(B=>b(B,G)&&M.set.some(D=>b(D,G)&&B.every(V=>D.every(X=>V.intersects(X,G)))))}test(M){if(!M)return!1;if(typeof M=="string")try{M=new o(M,this.options)}catch{return!1}for(let G=0;G<this.set.length;G++)if(W(this.set[G],M,this.options))return!0;return!1}}Ar=e;const t=vd(),n=new t,a=Hs(),r=Ha(),s=Oa(),o=_t(),{safeRe:l,t:u,comparatorTrimReplace:f,tildeTrimReplace:c,caretTrimReplace:d}=Xn(),{FLAG_INCLUDE_PRERELEASE:h,FLAG_LOOSE:p}=Pa(),m=w=>w.value==="<0.0.0-0",g=w=>w.value==="",b=(w,M)=>{let G=!0;const B=w.slice();let D=B.pop();for(;G&&B.length;)G=B.every(V=>D.intersects(V,M)),D=B.pop();return G},x=(w,M)=>(s("comp",w,M),w=R(w,M),s("caret",w),w=C(w,M),s("tildes",w),w=H(w,M),s("xrange",w),w=K(w,M),s("stars",w),w),v=w=>!w||w.toLowerCase()==="x"||w==="*",C=(w,M)=>w.trim().split(/\s+/).map(G=>E(G,M)).join(" "),E=(w,M)=>{const G=M.loose?l[u.TILDELOOSE]:l[u.TILDE];return w.replace(G,(B,D,V,X,P)=>{s("tilde",w,B,D,V,X,P);let F;return v(D)?F="":v(V)?F=`>=${D}.0.0 <${+D+1}.0.0-0`:v(X)?F=`>=${D}.${V}.0 <${D}.${+V+1}.0-0`:P?(s("replaceTilde pr",P),F=`>=${D}.${V}.${X}-${P} <${D}.${+V+1}.0-0`):F=`>=${D}.${V}.${X} <${D}.${+V+1}.0-0`,s("tilde return",F),F})},R=(w,M)=>w.trim().split(/\s+/).map(G=>O(G,M)).join(" "),O=(w,M)=>{s("caret",w,M);const G=M.loose?l[u.CARETLOOSE]:l[u.CARET],B=M.includePrerelease?"-0":"";return w.replace(G,(D,V,X,P,F)=>{s("caret",w,D,V,X,P,F);let ne;return v(V)?ne="":v(X)?ne=`>=${V}.0.0${B} <${+V+1}.0.0-0`:v(P)?V==="0"?ne=`>=${V}.${X}.0${B} <${V}.${+X+1}.0-0`:ne=`>=${V}.${X}.0${B} <${+V+1}.0.0-0`:F?(s("replaceCaret pr",F),V==="0"?X==="0"?ne=`>=${V}.${X}.${P}-${F} <${V}.${X}.${+P+1}-0`:ne=`>=${V}.${X}.${P}-${F} <${V}.${+X+1}.0-0`:ne=`>=${V}.${X}.${P}-${F} <${+V+1}.0.0-0`):(s("no pr"),V==="0"?X==="0"?ne=`>=${V}.${X}.${P}${B} <${V}.${X}.${+P+1}-0`:ne=`>=${V}.${X}.${P}${B} <${V}.${+X+1}.0-0`:ne=`>=${V}.${X}.${P} <${+V+1}.0.0-0`),s("caret return",ne),ne})},H=(w,M)=>(s("replaceXRanges",w,M),w.split(/\s+/).map(G=>N(G,M)).join(" ")),N=(w,M)=>{w=w.trim();const G=M.loose?l[u.XRANGELOOSE]:l[u.XRANGE];return w.replace(G,(B,D,V,X,P,F)=>{s("xRange",w,B,D,V,X,P,F);const ne=v(V),ie=ne||v(X),ee=ie||v(P),ke=ee;return D==="="&&ke&&(D=""),F=M.includePrerelease?"-0":"",ne?D===">"||D==="<"?B="<0.0.0-0":B="*":D&&ke?(ie&&(X=0),P=0,D===">"?(D=">=",ie?(V=+V+1,X=0,P=0):(X=+X+1,P=0)):D==="<="&&(D="<",ie?V=+V+1:X=+X+1),D==="<"&&(F="-0"),B=`${D+V}.${X}.${P}${F}`):ie?B=`>=${V}.0.0${F} <${+V+1}.0.0-0`:ee&&(B=`>=${V}.${X}.0${F} <${V}.${+X+1}.0-0`),s("xRange return",B),B})},K=(w,M)=>(s("replaceStars",w,M),w.trim().replace(l[u.STAR],"")),ae=(w,M)=>(s("replaceGTE0",w,M),w.trim().replace(l[M.includePrerelease?u.GTE0PRE:u.GTE0],"")),T=w=>(M,G,B,D,V,X,P,F,ne,ie,ee,ke)=>(v(B)?G="":v(D)?G=`>=${B}.0.0${w?"-0":""}`:v(V)?G=`>=${B}.${D}.0${w?"-0":""}`:X?G=`>=${G}`:G=`>=${G}${w?"-0":""}`,v(ne)?F="":v(ie)?F=`<${+ne+1}.0.0-0`:v(ee)?F=`<${ne}.${+ie+1}.0-0`:ke?F=`<=${ne}.${ie}.${ee}-${ke}`:w?F=`<${ne}.${ie}.${+ee+1}-0`:F=`<=${F}`,`${G} ${F}`.trim()),W=(w,M,G)=>{for(let B=0;B<w.length;B++)if(!w[B].test(M))return!1;if(M.prerelease.length&&!G.includePrerelease){for(let B=0;B<w.length;B++)if(s(w[B].semver),w[B].semver!==r.ANY&&w[B].semver.prerelease.length>0){const D=w[B].semver;if(D.major===M.major&&D.minor===M.minor&&D.patch===M.patch)return!0}return!1}return!0};return Ar}var kr,nl;function Ha(){if(nl)return kr;nl=1;const i=Symbol("SemVer ANY");class e{static get ANY(){return i}constructor(f,c){if(c=t(c),f instanceof e){if(f.loose===!!c.loose)return f;f=f.value}f=f.trim().split(/\s+/).join(" "),s("comparator",f,c),this.options=c,this.loose=!!c.loose,this.parse(f),this.semver===i?this.value="":this.value=this.operator+this.semver.version,s("comp",this)}parse(f){const c=this.options.loose?n[a.COMPARATORLOOSE]:n[a.COMPARATOR],d=f.match(c);if(!d)throw new TypeError(`Invalid comparator: ${f}`);this.operator=d[1]!==void 0?d[1]:"",this.operator==="="&&(this.operator=""),d[2]?this.semver=new o(d[2],this.options.loose):this.semver=i}toString(){return this.value}test(f){if(s("Comparator.test",f,this.options.loose),this.semver===i||f===i)return!0;if(typeof f=="string")try{f=new o(f,this.options)}catch{return!1}return r(f,this.operator,this.semver,this.options)}intersects(f,c){if(!(f instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new l(f.value,c).test(this.value):f.operator===""?f.value===""?!0:new l(this.value,c).test(f.semver):(c=t(c),c.includePrerelease&&(this.value==="<0.0.0-0"||f.value==="<0.0.0-0")||!c.includePrerelease&&(this.value.startsWith("<0.0.0")||f.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&f.operator.startsWith(">")||this.operator.startsWith("<")&&f.operator.startsWith("<")||this.semver.version===f.semver.version&&this.operator.includes("=")&&f.operator.includes("=")||r(this.semver,"<",f.semver,c)&&this.operator.startsWith(">")&&f.operator.startsWith("<")||r(this.semver,">",f.semver,c)&&this.operator.startsWith("<")&&f.operator.startsWith(">")))}}kr=e;const t=Hs(),{safeRe:n,t:a}=Xn(),r=Dc(),s=Oa(),o=_t(),l=jt();return kr}var Sr,al;function za(){if(al)return Sr;al=1;const i=jt();return Sr=(t,n,a)=>{try{n=new i(n,a)}catch{return!1}return n.test(t)},Sr}var Tr,rl;function xd(){if(rl)return Tr;rl=1;const i=jt();return Tr=(t,n)=>new i(t,n).set.map(a=>a.map(r=>r.value).join(" ").trim().split(" ")),Tr}var Mr,sl;function _d(){if(sl)return Mr;sl=1;const i=_t(),e=jt();return Mr=(n,a,r)=>{let s=null,o=null,l=null;try{l=new e(a,r)}catch{return null}return n.forEach(u=>{l.test(u)&&(!s||o.compare(u)===-1)&&(s=u,o=new i(s,r))}),s},Mr}var Dr,ol;function Cd(){if(ol)return Dr;ol=1;const i=_t(),e=jt();return Dr=(n,a,r)=>{let s=null,o=null,l=null;try{l=new e(a,r)}catch{return null}return n.forEach(u=>{l.test(u)&&(!s||o.compare(u)===1)&&(s=u,o=new i(s,r))}),s},Dr}var Lr,ll;function Ed(){if(ll)return Lr;ll=1;const i=_t(),e=jt(),t=Na();return Lr=(a,r)=>{a=new e(a,r);let s=new i("0.0.0");if(a.test(s)||(s=new i("0.0.0-0"),a.test(s)))return s;s=null;for(let o=0;o<a.set.length;++o){const l=a.set[o];let u=null;l.forEach(f=>{const c=new i(f.semver.version);switch(f.operator){case">":c.prerelease.length===0?c.patch++:c.prerelease.push(0),c.raw=c.format();case"":case">=":(!u||t(c,u))&&(u=c);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${f.operator}`)}}),u&&(!s||t(s,u))&&(s=u)}return s&&a.test(s)?s:null},Lr}var Br,cl;function Ad(){if(cl)return Br;cl=1;const i=jt();return Br=(t,n)=>{try{return new i(t,n).range||"*"}catch{return null}},Br}var Fr,ul;function qs(){if(ul)return Fr;ul=1;const i=_t(),e=Ha(),{ANY:t}=e,n=jt(),a=za(),r=Na(),s=Vs(),o=Us(),l=Ws();return Fr=(f,c,d,h)=>{f=new i(f,h),c=new n(c,h);let p,m,g,b,x;switch(d){case">":p=r,m=o,g=s,b=">",x=">=";break;case"<":p=s,m=l,g=r,b="<",x="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(a(f,c,h))return!1;for(let v=0;v<c.set.length;++v){const C=c.set[v];let E=null,R=null;if(C.forEach(O=>{O.semver===t&&(O=new e(">=0.0.0")),E=E||O,R=R||O,p(O.semver,E.semver,h)?E=O:g(O.semver,R.semver,h)&&(R=O)}),E.operator===b||E.operator===x||(!R.operator||R.operator===b)&&m(f,R.semver))return!1;if(R.operator===x&&g(f,R.semver))return!1}return!0},Fr}var Ir,dl;function kd(){if(dl)return Ir;dl=1;const i=qs();return Ir=(t,n,a)=>i(t,n,">",a),Ir}var Rr,hl;function Sd(){if(hl)return Rr;hl=1;const i=qs();return Rr=(t,n,a)=>i(t,n,"<",a),Rr}var Pr,fl;function Td(){if(fl)return Pr;fl=1;const i=jt();return Pr=(t,n,a)=>(t=new i(t,a),n=new i(n,a),t.intersects(n,a)),Pr}var Or,pl;function Md(){if(pl)return Or;pl=1;const i=za(),e=$t();return Or=(t,n,a)=>{const r=[];let s=null,o=null;const l=t.sort((d,h)=>e(d,h,a));for(const d of l)i(d,n,a)?(o=d,s||(s=d)):(o&&r.push([s,o]),o=null,s=null);s&&r.push([s,null]);const u=[];for(const[d,h]of r)d===h?u.push(d):!h&&d===l[0]?u.push("*"):h?d===l[0]?u.push(`<=${h}`):u.push(`${d} - ${h}`):u.push(`>=${d}`);const f=u.join(" || "),c=typeof n.raw=="string"?n.raw:String(n);return f.length<c.length?f:n},Or}var Nr,ml;function Dd(){if(ml)return Nr;ml=1;const i=jt(),e=Ha(),{ANY:t}=e,n=za(),a=$t(),r=(c,d,h={})=>{if(c===d)return!0;c=new i(c,h),d=new i(d,h);let p=!1;e:for(const m of c.set){for(const g of d.set){const b=l(m,g,h);if(p=p||b!==null,b)continue e}if(p)return!1}return!0},s=[new e(">=0.0.0-0")],o=[new e(">=0.0.0")],l=(c,d,h)=>{if(c===d)return!0;if(c.length===1&&c[0].semver===t){if(d.length===1&&d[0].semver===t)return!0;h.includePrerelease?c=s:c=o}if(d.length===1&&d[0].semver===t){if(h.includePrerelease)return!0;d=o}const p=new Set;let m,g;for(const H of c)H.operator===">"||H.operator===">="?m=u(m,H,h):H.operator==="<"||H.operator==="<="?g=f(g,H,h):p.add(H.semver);if(p.size>1)return null;let b;if(m&&g){if(b=a(m.semver,g.semver,h),b>0)return null;if(b===0&&(m.operator!==">="||g.operator!=="<="))return null}for(const H of p){if(m&&!n(H,String(m),h)||g&&!n(H,String(g),h))return null;for(const N of d)if(!n(H,String(N),h))return!1;return!0}let x,v,C,E,R=g&&!h.includePrerelease&&g.semver.prerelease.length?g.semver:!1,O=m&&!h.includePrerelease&&m.semver.prerelease.length?m.semver:!1;R&&R.prerelease.length===1&&g.operator==="<"&&R.prerelease[0]===0&&(R=!1);for(const H of d){if(E=E||H.operator===">"||H.operator===">=",C=C||H.operator==="<"||H.operator==="<=",m){if(O&&H.semver.prerelease&&H.semver.prerelease.length&&H.semver.major===O.major&&H.semver.minor===O.minor&&H.semver.patch===O.patch&&(O=!1),H.operator===">"||H.operator===">="){if(x=u(m,H,h),x===H&&x!==m)return!1}else if(m.operator===">="&&!n(m.semver,String(H),h))return!1}if(g){if(R&&H.semver.prerelease&&H.semver.prerelease.length&&H.semver.major===R.major&&H.semver.minor===R.minor&&H.semver.patch===R.patch&&(R=!1),H.operator==="<"||H.operator==="<="){if(v=f(g,H,h),v===H&&v!==g)return!1}else if(g.operator==="<="&&!n(g.semver,String(H),h))return!1}if(!H.operator&&(g||m)&&b!==0)return!1}return!(m&&C&&!g&&b!==0||g&&E&&!m&&b!==0||O||R)},u=(c,d,h)=>{if(!c)return d;const p=a(c.semver,d.semver,h);return p>0?c:p<0||d.operator===">"&&c.operator===">="?d:c},f=(c,d,h)=>{if(!c)return d;const p=a(c.semver,d.semver,h);return p<0?c:p>0||d.operator==="<"&&c.operator==="<="?d:c};return Nr=r,Nr}var Hr,gl;function Ld(){if(gl)return Hr;gl=1;const i=Xn(),e=Pa(),t=_t(),n=Sc(),a=dn(),r=od(),s=ld(),o=cd(),l=ud(),u=dd(),f=hd(),c=fd(),d=pd(),h=$t(),p=md(),m=gd(),g=zs(),b=bd(),x=yd(),v=Na(),C=Vs(),E=Tc(),R=Mc(),O=Ws(),H=Us(),N=Dc(),K=wd(),ae=Ha(),T=jt(),W=za(),w=xd(),M=_d(),G=Cd(),B=Ed(),D=Ad(),V=qs(),X=kd(),P=Sd(),F=Td(),ne=Md(),ie=Dd();return Hr={parse:a,valid:r,clean:s,inc:o,diff:l,major:u,minor:f,patch:c,prerelease:d,compare:h,rcompare:p,compareLoose:m,compareBuild:g,sort:b,rsort:x,gt:v,lt:C,eq:E,neq:R,gte:O,lte:H,cmp:N,coerce:K,Comparator:ae,Range:T,satisfies:W,toComparators:w,maxSatisfying:M,minSatisfying:G,minVersion:B,validRange:D,outside:V,gtr:X,ltr:P,intersects:F,simplifyRange:ne,subset:ie,SemVer:t,re:i.re,src:i.src,tokens:i.t,SEMVER_SPEC_VERSION:e.SEMVER_SPEC_VERSION,RELEASE_TYPES:e.RELEASE_TYPES,compareIdentifiers:n.compareIdentifiers,rcompareIdentifiers:n.rcompareIdentifiers},Hr}var Bd=Ld();const bl=Kn(Bd),Fd="modulepreload",Id=function(i){return"/smeditor/"+i},yl={},We=function(e,t,n){let a=Promise.resolve();if(t&&t.length>0){let s=function(u){return Promise.all(u.map(f=>Promise.resolve(f).then(c=>({status:"fulfilled",value:c}),c=>({status:"rejected",reason:c}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=o?.nonce||o?.getAttribute("nonce");a=s(t.map(u=>{if(u=Id(u),u in yl)return;yl[u]=!0;const f=u.endsWith(".css"),c=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${c}`))return;const d=document.createElement("link");if(d.rel=f?"stylesheet":Fd,f||(d.as="script"),d.crossOrigin="",d.href=u,l&&d.setAttribute("nonce",l),document.head.appendChild(d),f)return new Promise((h,p)=>{d.addEventListener("load",h),d.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${u}`)))})}))}function r(s){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s}return a.then(s=>{for(const o of s||[])o.status==="rejected"&&r(o.reason);return e().catch(r)})};function Rd(i={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:n,onRegistered:a,onRegisteredSW:r,onRegisterError:s}=i;let o,l;const u=async(c=!0)=>{await l};async function f(){if("serviceWorker"in navigator){if(o=await We(async()=>{const{Workbox:c}=await import("./workbox-window.prod.es5-B9K5rw8f.js");return{Workbox:c}},[]).then(({Workbox:c})=>new c("/smeditor/sw.js",{scope:"/smeditor/",type:"classic"})).catch(c=>{s?.(c)}),!o)return;o.addEventListener("activated",c=>{(c.isUpdate||c.isExternal)&&window.location.reload()}),o.addEventListener("installed",c=>{c.isUpdate||n?.()}),o.register({immediate:e}).then(c=>{r?r("/smeditor/sw.js",c):a?.(c)}).catch(c=>{s?.(c)})}}return l=f(),u}var zr={exports:{}},wl;function Pd(){return wl||(wl=1,function(i){(function(){function e(A,I,te){return A.call.apply(A.bind,arguments)}function t(A,I,te){if(!A)throw Error();if(2<arguments.length){var Q=Array.prototype.slice.call(arguments,2);return function(){var re=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(re,Q),A.apply(I,re)}}return function(){return A.apply(I,arguments)}}function n(A,I,te){return n=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?e:t,n.apply(null,arguments)}var a=Date.now||function(){return+new Date};function r(A,I){this.a=A,this.o=I||A,this.c=this.o.document}var s=!!window.FontFace;function o(A,I,te,Q){if(I=A.c.createElement(I),te)for(var re in te)te.hasOwnProperty(re)&&(re=="style"?I.style.cssText=te[re]:I.setAttribute(re,te[re]));return Q&&I.appendChild(A.c.createTextNode(Q)),I}function l(A,I,te){A=A.c.getElementsByTagName(I)[0],A||(A=document.documentElement),A.insertBefore(te,A.lastChild)}function u(A){A.parentNode&&A.parentNode.removeChild(A)}function f(A,I,te){I=I||[],te=te||[];for(var Q=A.className.split(/\s+/),re=0;re<I.length;re+=1){for(var fe=!1,be=0;be<Q.length;be+=1)if(I[re]===Q[be]){fe=!0;break}fe||Q.push(I[re])}for(I=[],re=0;re<Q.length;re+=1){for(fe=!1,be=0;be<te.length;be+=1)if(Q[re]===te[be]){fe=!0;break}fe||I.push(Q[re])}A.className=I.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function c(A,I){for(var te=A.className.split(/\s+/),Q=0,re=te.length;Q<re;Q++)if(te[Q]==I)return!0;return!1}function d(A){return A.o.location.hostname||A.a.location.hostname}function h(A,I,te){function Q(){Pe&&re&&fe&&(Pe(be),Pe=null)}I=o(A,"link",{rel:"stylesheet",href:I,media:"all"});var re=!1,fe=!0,be=null,Pe=te||null;s?(I.onload=function(){re=!0,Q()},I.onerror=function(){re=!0,be=Error("Stylesheet failed to load"),Q()}):setTimeout(function(){re=!0,Q()},0),l(A,"head",I)}function p(A,I,te,Q){var re=A.c.getElementsByTagName("head")[0];if(re){var fe=o(A,"script",{src:I}),be=!1;return fe.onload=fe.onreadystatechange=function(){be||this.readyState&&this.readyState!="loaded"&&this.readyState!="complete"||(be=!0,te&&te(null),fe.onload=fe.onreadystatechange=null,fe.parentNode.tagName=="HEAD"&&re.removeChild(fe))},re.appendChild(fe),setTimeout(function(){be||(be=!0,te&&te(Error("Script load timeout")))},Q||5e3),fe}return null}function m(){this.a=0,this.c=null}function g(A){return A.a++,function(){A.a--,x(A)}}function b(A,I){A.c=I,x(A)}function x(A){A.a==0&&A.c&&(A.c(),A.c=null)}function v(A){this.a=A||"-"}v.prototype.c=function(A){for(var I=[],te=0;te<arguments.length;te++)I.push(arguments[te].replace(/[\W_]+/g,"").toLowerCase());return I.join(this.a)};function C(A,I){this.c=A,this.f=4,this.a="n";var te=(I||"n4").match(/^([nio])([1-9])$/i);te&&(this.a=te[1],this.f=parseInt(te[2],10))}function E(A){return H(A)+" "+(A.f+"00")+" 300px "+R(A.c)}function R(A){var I=[];A=A.split(/,\s*/);for(var te=0;te<A.length;te++){var Q=A[te].replace(/['"]/g,"");Q.indexOf(" ")!=-1||/^\d/.test(Q)?I.push("'"+Q+"'"):I.push(Q)}return I.join(",")}function O(A){return A.a+A.f}function H(A){var I="normal";return A.a==="o"?I="oblique":A.a==="i"&&(I="italic"),I}function N(A){var I=4,te="n",Q=null;return A&&((Q=A.match(/(normal|oblique|italic)/i))&&Q[1]&&(te=Q[1].substr(0,1).toLowerCase()),(Q=A.match(/([1-9]00|normal|bold)/i))&&Q[1]&&(/bold/i.test(Q[1])?I=7:/[1-9]00/.test(Q[1])&&(I=parseInt(Q[1].substr(0,1),10)))),te+I}function K(A,I){this.c=A,this.f=A.o.document.documentElement,this.h=I,this.a=new v("-"),this.j=I.events!==!1,this.g=I.classes!==!1}function ae(A){A.g&&f(A.f,[A.a.c("wf","loading")]),W(A,"loading")}function T(A){if(A.g){var I=c(A.f,A.a.c("wf","active")),te=[],Q=[A.a.c("wf","loading")];I||te.push(A.a.c("wf","inactive")),f(A.f,te,Q)}W(A,"inactive")}function W(A,I,te){A.j&&A.h[I]&&(te?A.h[I](te.c,O(te)):A.h[I]())}function w(){this.c={}}function M(A,I,te){var Q=[],re;for(re in I)if(I.hasOwnProperty(re)){var fe=A.c[re];fe&&Q.push(fe(I[re],te))}return Q}function G(A,I){this.c=A,this.f=I,this.a=o(this.c,"span",{"aria-hidden":"true"},this.f)}function B(A){l(A.c,"body",A.a)}function D(A){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+R(A.c)+";"+("font-style:"+H(A)+";font-weight:"+(A.f+"00")+";")}function V(A,I,te,Q,re,fe){this.g=A,this.j=I,this.a=Q,this.c=te,this.f=re||3e3,this.h=fe||void 0}V.prototype.start=function(){var A=this.c.o.document,I=this,te=a(),Q=new Promise(function(be,Pe){function Ne(){a()-te>=I.f?Pe():A.fonts.load(E(I.a),I.h).then(function(Ze){1<=Ze.length?be():setTimeout(Ne,25)},function(){Pe()})}Ne()}),re=null,fe=new Promise(function(be,Pe){re=setTimeout(Pe,I.f)});Promise.race([fe,Q]).then(function(){re&&(clearTimeout(re),re=null),I.g(I.a)},function(){I.j(I.a)})};function X(A,I,te,Q,re,fe,be){this.v=A,this.B=I,this.c=te,this.a=Q,this.s=be||"BESbswy",this.f={},this.w=re||3e3,this.u=fe||null,this.m=this.j=this.h=this.g=null,this.g=new G(this.c,this.s),this.h=new G(this.c,this.s),this.j=new G(this.c,this.s),this.m=new G(this.c,this.s),A=new C(this.a.c+",serif",O(this.a)),A=D(A),this.g.a.style.cssText=A,A=new C(this.a.c+",sans-serif",O(this.a)),A=D(A),this.h.a.style.cssText=A,A=new C("serif",O(this.a)),A=D(A),this.j.a.style.cssText=A,A=new C("sans-serif",O(this.a)),A=D(A),this.m.a.style.cssText=A,B(this.g),B(this.h),B(this.j),B(this.m)}var P={D:"serif",C:"sans-serif"},F=null;function ne(){if(F===null){var A=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);F=!!A&&(536>parseInt(A[1],10)||parseInt(A[1],10)===536&&11>=parseInt(A[2],10))}return F}X.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=a(),ee(this)};function ie(A,I,te){for(var Q in P)if(P.hasOwnProperty(Q)&&I===A.f[P[Q]]&&te===A.f[P[Q]])return!0;return!1}function ee(A){var I=A.g.a.offsetWidth,te=A.h.a.offsetWidth,Q;(Q=I===A.f.serif&&te===A.f["sans-serif"])||(Q=ne()&&ie(A,I,te)),Q?a()-A.A>=A.w?ne()&&ie(A,I,te)&&(A.u===null||A.u.hasOwnProperty(A.a.c))?Oe(A,A.v):Oe(A,A.B):ke(A):Oe(A,A.v)}function ke(A){setTimeout(n(function(){ee(this)},A),50)}function Oe(A,I){setTimeout(n(function(){u(this.g.a),u(this.h.a),u(this.j.a),u(this.m.a),I(this.a)},A),0)}function we(A,I,te){this.c=A,this.a=I,this.f=0,this.m=this.j=!1,this.s=te}var ge=null;we.prototype.g=function(A){var I=this.a;I.g&&f(I.f,[I.a.c("wf",A.c,O(A).toString(),"active")],[I.a.c("wf",A.c,O(A).toString(),"loading"),I.a.c("wf",A.c,O(A).toString(),"inactive")]),W(I,"fontactive",A),this.m=!0,Te(this)},we.prototype.h=function(A){var I=this.a;if(I.g){var te=c(I.f,I.a.c("wf",A.c,O(A).toString(),"active")),Q=[],re=[I.a.c("wf",A.c,O(A).toString(),"loading")];te||Q.push(I.a.c("wf",A.c,O(A).toString(),"inactive")),f(I.f,Q,re)}W(I,"fontinactive",A),Te(this)};function Te(A){--A.f==0&&A.j&&(A.m?(A=A.a,A.g&&f(A.f,[A.a.c("wf","active")],[A.a.c("wf","loading"),A.a.c("wf","inactive")]),W(A,"active")):T(A.a))}function Le(A){this.j=A,this.a=new w,this.h=0,this.f=this.g=!0}Le.prototype.load=function(A){this.c=new r(this.j,A.context||this.j),this.g=A.events!==!1,this.f=A.classes!==!1,at(this,new K(this.c,A),A)};function nt(A,I,te,Q,re){var fe=--A.h==0;(A.f||A.g)&&setTimeout(function(){var be=re||null,Pe=Q||null||{};if(te.length===0&&fe)T(I.a);else{I.f+=te.length,fe&&(I.j=fe);var Ne,Ze=[];for(Ne=0;Ne<te.length;Ne++){var qe=te[Ne],ot=Pe[qe.c],Wt=I.a,Yi=qe;if(Wt.g&&f(Wt.f,[Wt.a.c("wf",Yi.c,O(Yi).toString(),"loading")]),W(Wt,"fontloading",Yi),Wt=null,ge===null)if(window.FontFace){var Yi=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),Wu=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);ge=Yi?42<parseInt(Yi[1],10):!Wu}else ge=!1;ge?Wt=new V(n(I.g,I),n(I.h,I),I.c,qe,I.s,ot):Wt=new X(n(I.g,I),n(I.h,I),I.c,qe,I.s,be,ot),Ze.push(Wt)}for(Ne=0;Ne<Ze.length;Ne++)Ze[Ne].start()}},0)}function at(A,I,te){var re=[],Q=te.timeout;ae(I);var re=M(A.a,te,A.c),fe=new we(A.c,I,Q);for(A.h=re.length,I=0,te=re.length;I<te;I++)re[I].load(function(be,Pe,Ne){nt(A,fe,be,Pe,Ne)})}function _(A,I){this.c=A,this.a=I}_.prototype.load=function(A){function I(){if(fe["__mti_fntLst"+Q]){var be=fe["__mti_fntLst"+Q](),Pe=[],Ne;if(be)for(var Ze=0;Ze<be.length;Ze++){var qe=be[Ze].fontfamily;be[Ze].fontStyle!=null&&be[Ze].fontWeight!=null?(Ne=be[Ze].fontStyle+be[Ze].fontWeight,Pe.push(new C(qe,Ne))):Pe.push(new C(qe))}A(Pe)}else setTimeout(function(){I()},50)}var te=this,Q=te.a.projectId,re=te.a.version;if(Q){var fe=te.c.o;p(this.c,(te.a.api||"https://fast.fonts.net/jsapi")+"/"+Q+".js"+(re?"?v="+re:""),function(be){be?A([]):(fe["__MonotypeConfiguration__"+Q]=function(){return te.a},I())}).id="__MonotypeAPIScript__"+Q}else A([])};function Z(A,I){this.c=A,this.a=I}Z.prototype.load=function(A){var I,te,Q=this.a.urls||[],re=this.a.families||[],fe=this.a.testStrings||{},be=new m;for(I=0,te=Q.length;I<te;I++)h(this.c,Q[I],g(be));var Pe=[];for(I=0,te=re.length;I<te;I++)if(Q=re[I].split(":"),Q[1])for(var Ne=Q[1].split(","),Ze=0;Ze<Ne.length;Ze+=1)Pe.push(new C(Q[0],Ne[Ze]));else Pe.push(new C(Q[0]));b(be,function(){A(Pe,fe)})};function q(A,I){A?this.c=A:this.c=S,this.a=[],this.f=[],this.g=I||""}var S="https://fonts.googleapis.com/css";function k(A,I){for(var te=I.length,Q=0;Q<te;Q++){var re=I[Q].split(":");re.length==3&&A.f.push(re.pop());var fe="";re.length==2&&re[1]!=""&&(fe=":"),A.a.push(re.join(fe))}}function z(A){if(A.a.length==0)throw Error("No fonts to load!");if(A.c.indexOf("kit=")!=-1)return A.c;for(var I=A.a.length,te=[],Q=0;Q<I;Q++)te.push(A.a[Q].replace(/ /g,"+"));return I=A.c+"?family="+te.join("%7C"),0<A.f.length&&(I+="&subset="+A.f.join(",")),0<A.g.length&&(I+="&text="+encodeURIComponent(A.g)),I}function j(A){this.f=A,this.a=[],this.c={}}var J={latin:"BESbswy","latin-ext":"çöüğş",cyrillic:"йяЖ",greek:"αβΣ",khmer:"កខគ",Hanuman:"កខគ"},U={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},se={i:"i",italic:"i",n:"n",normal:"n"},ce=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function oe(A){for(var I=A.f.length,te=0;te<I;te++){var Q=A.f[te].split(":"),re=Q[0].replace(/\+/g," "),fe=["n4"];if(2<=Q.length){var be,Pe=Q[1];if(be=[],Pe)for(var Pe=Pe.split(","),Ne=Pe.length,Ze=0;Ze<Ne;Ze++){var qe;if(qe=Pe[Ze],qe.match(/^[\w-]+$/)){var ot=ce.exec(qe.toLowerCase());if(ot==null)qe="";else{if(qe=ot[2],qe=qe==null||qe==""?"n":se[qe],ot=ot[1],ot==null||ot=="")ot="4";else var Wt=U[ot],ot=Wt||(isNaN(ot)?"4":ot.substr(0,1));qe=[qe,ot].join("")}}else qe="";qe&&be.push(qe)}0<be.length&&(fe=be),Q.length==3&&(Q=Q[2],be=[],Q=Q?Q.split(","):be,0<Q.length&&(Q=J[Q[0]])&&(A.c[re]=Q))}for(A.c[re]||(Q=J[re])&&(A.c[re]=Q),Q=0;Q<fe.length;Q+=1)A.a.push(new C(re,fe[Q]))}}function me(A,I){this.c=A,this.a=I}var Ue={Arimo:!0,Cousine:!0,Tinos:!0};me.prototype.load=function(A){var I=new m,te=this.c,Q=new q(this.a.api,this.a.text),re=this.a.families;k(Q,re);var fe=new j(re);oe(fe),h(te,z(Q),g(I)),b(I,function(){A(fe.a,fe.c,Ue)})};function Me(A,I){this.c=A,this.a=I}Me.prototype.load=function(A){var I=this.a.id,te=this.c.o;I?p(this.c,(this.a.api||"https://use.typekit.net")+"/"+I+".js",function(Q){if(Q)A([]);else if(te.Typekit&&te.Typekit.config&&te.Typekit.config.fn){Q=te.Typekit.config.fn;for(var re=[],fe=0;fe<Q.length;fe+=2)for(var be=Q[fe],Pe=Q[fe+1],Ne=0;Ne<Pe.length;Ne++)re.push(new C(be,Pe[Ne]));try{te.Typekit.load({events:!1,classes:!1,async:!0})}catch{}A(re)}},2e3):A([])};function yt(A,I){this.c=A,this.f=I,this.a=[]}yt.prototype.load=function(A){var I=this.f.id,te=this.c.o,Q=this;I?(te.__webfontfontdeckmodule__||(te.__webfontfontdeckmodule__={}),te.__webfontfontdeckmodule__[I]=function(re,fe){for(var be=0,Pe=fe.fonts.length;be<Pe;++be){var Ne=fe.fonts[be];Q.a.push(new C(Ne.name,N("font-weight:"+Ne.weight+";font-style:"+Ne.style)))}A(Q.a)},p(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+d(this.c)+"/"+I+".js",function(re){re&&A([])})):A([])};var Ct=new Le(window);Ct.a.c.custom=function(A,I){return new Z(I,A)},Ct.a.c.fontdeck=function(A,I){return new yt(I,A)},Ct.a.c.monotype=function(A,I){return new _(I,A)},Ct.a.c.typekit=function(A,I){return new Me(I,A)},Ct.a.c.google=function(A,I){return new me(I,A)};var Tt={load:n(Ct.load,Ct)};i.exports?i.exports=Tt:(window.WebFont=Tt,window.WebFontConfig&&Ct.load(window.WebFontConfig))})()}(zr)),zr.exports}var Od=Pd();const Nd=Kn(Od),An={INVALID:["seeking position failed.","InvalidStateError"],GONE:["A requested file or directory could not be found at the time an operation was processed.","NotFoundError"],MISMATCH:["The path supplied exists, but was not an entry of requested type.","TypeMismatchError"],MOD_ERR:["The object can not be modified in this way.","InvalidModificationError"],SYNTAX:i=>[`Failed to execute 'write' on 'UnderlyingSinkBase': Invalid params passed. ${i}`,"SyntaxError"],DISALLOWED:["The request is not allowed by the user agent or the platform in the current context.","NotAllowedError"]},Hd=i=>typeof i=="object"&&typeof i.type<"u";async function zd(i){var e,t,n;const{FolderHandle:a,FileHandle:r}=await We(async()=>{const{FolderHandle:u,FileHandle:f}=await import("./memory-NBqPtv5z.js");return{FolderHandle:u,FileHandle:f}},__vite__mapDeps([0,1,2])),{FileSystemDirectoryHandle:s}=await We(async()=>{const{FileSystemDirectoryHandle:u}=await Promise.resolve().then(()=>F0);return{FileSystemDirectoryHandle:u}},void 0),o=(t=(e=i[0].webkitRelativePath)===null||e===void 0?void 0:e.split("/",1)[0])!==null&&t!==void 0?t:"",l=new a(o,!1);for(let u=0;u<i.length;u++){const f=i[u],c=!((n=f.webkitRelativePath)===null||n===void 0)&&n.length?f.webkitRelativePath.split("/"):["",f.name];c.shift();const d=c.pop(),h=c.reduce((p,m)=>(p._entries[m]||(p._entries[m]=new a(m,!1)),p._entries[m]),l);h._entries[d]=new r(f.name,f,!1)}return new s(l)}async function Vd(i){const{FileHandle:e}=await We(async()=>{const{FileHandle:a}=await import("./memory-NBqPtv5z.js");return{FileHandle:a}},__vite__mapDeps([0,1,2])),{FileSystemFileHandle:t}=await We(async()=>{const{FileSystemFileHandle:a}=await Promise.resolve().then(()=>Eu);return{FileSystemFileHandle:a}},void 0);return Array.from(i).map(a=>new t(new e(a.name,a,!1)))}const Lc=Object.freeze(Object.defineProperty({__proto__:null,errors:An,isChunkObject:Hd,makeDirHandleFromFileList:zd,makeFileHandlesFromFileList:Vd},Symbol.toStringTag,{value:"Module"}));var Vr={};/*! howler.js v2.2.4 | (c) 2013-2020, James Simpson of GoldFire Studios | MIT License | howlerjs.com */var vl;function Wd(){return vl||(vl=1,function(i){(function(){var e=function(){this.init()};e.prototype={init:function(){var c=this||t;return c._counter=1e3,c._html5AudioPool=[],c.html5PoolSize=10,c._codecs={},c._howls=[],c._muted=!1,c._volume=1,c._canPlayEvent="canplaythrough",c._navigator=typeof window<"u"&&window.navigator?window.navigator:null,c.masterGain=null,c.noAudio=!1,c.usingWebAudio=!0,c.autoSuspend=!0,c.ctx=null,c.autoUnlock=!0,c._setup(),c},volume:function(c){var d=this||t;if(c=parseFloat(c),d.ctx||f(),c!==void 0&&c>=0&&c<=1){if(d._volume=c,d._muted)return d;d.usingWebAudio&&d.masterGain.gain.setValueAtTime(c,t.ctx.currentTime);for(var h=0;h<d._howls.length;h++)if(!d._howls[h]._webAudio)for(var p=d._howls[h]._getSoundIds(),m=0;m<p.length;m++){var g=d._howls[h]._soundById(p[m]);g&&g._node&&(g._node.volume=g._volume*c)}return d}return d._volume},mute:function(c){var d=this||t;d.ctx||f(),d._muted=c,d.usingWebAudio&&d.masterGain.gain.setValueAtTime(c?0:d._volume,t.ctx.currentTime);for(var h=0;h<d._howls.length;h++)if(!d._howls[h]._webAudio)for(var p=d._howls[h]._getSoundIds(),m=0;m<p.length;m++){var g=d._howls[h]._soundById(p[m]);g&&g._node&&(g._node.muted=!!c||g._muted)}return d},stop:function(){for(var c=this||t,d=0;d<c._howls.length;d++)c._howls[d].stop();return c},unload:function(){for(var c=this||t,d=c._howls.length-1;d>=0;d--)c._howls[d].unload();return c.usingWebAudio&&c.ctx&&c.ctx.close!==void 0&&(c.ctx.close(),c.ctx=null,f()),c},codecs:function(c){return(this||t)._codecs[c.replace(/^x-/,"")]},_setup:function(){var c=this||t;if(c.state=c.ctx&&c.ctx.state||"suspended",c._autoSuspend(),!c.usingWebAudio)if(typeof Audio<"u")try{var d=new Audio;d.oncanplaythrough===void 0&&(c._canPlayEvent="canplay")}catch{c.noAudio=!0}else c.noAudio=!0;try{var d=new Audio;d.muted&&(c.noAudio=!0)}catch{}return c.noAudio||c._setupCodecs(),c},_setupCodecs:function(){var c=this||t,d=null;try{d=typeof Audio<"u"?new Audio:null}catch{return c}if(!d||typeof d.canPlayType!="function")return c;var h=d.canPlayType("audio/mpeg;").replace(/^no$/,""),p=c._navigator?c._navigator.userAgent:"",m=p.match(/OPR\/(\d+)/g),g=m&&parseInt(m[0].split("/")[1],10)<33,b=p.indexOf("Safari")!==-1&&p.indexOf("Chrome")===-1,x=p.match(/Version\/(.*?) /),v=b&&x&&parseInt(x[1],10)<15;return c._codecs={mp3:!(g||!h&&!d.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!h,opus:!!d.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(d.canPlayType('audio/wav; codecs="1"')||d.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!d.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!d.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(d.canPlayType("audio/x-m4a;")||d.canPlayType("audio/m4a;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(d.canPlayType("audio/x-m4b;")||d.canPlayType("audio/m4b;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(d.canPlayType("audio/x-mp4;")||d.canPlayType("audio/mp4;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(v||!d.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(v||!d.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!d.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(d.canPlayType("audio/x-flac;")||d.canPlayType("audio/flac;")).replace(/^no$/,"")},c},_unlockAudio:function(){var c=this||t;if(!c._audioUnlocked&&c.ctx){c._audioUnlocked=!1,c.autoUnlock=!1,c._mobileUnloaded||c.ctx.sampleRate===44100||(c._mobileUnloaded=!0,c.unload()),c._scratchBuffer=c.ctx.createBuffer(1,1,22050);var d=function(h){for(;c._html5AudioPool.length<c.html5PoolSize;)try{var p=new Audio;p._unlocked=!0,c._releaseHtml5Audio(p)}catch{c.noAudio=!0;break}for(var m=0;m<c._howls.length;m++)if(!c._howls[m]._webAudio)for(var g=c._howls[m]._getSoundIds(),b=0;b<g.length;b++){var x=c._howls[m]._soundById(g[b]);x&&x._node&&!x._node._unlocked&&(x._node._unlocked=!0,x._node.load())}c._autoResume();var v=c.ctx.createBufferSource();v.buffer=c._scratchBuffer,v.connect(c.ctx.destination),v.start===void 0?v.noteOn(0):v.start(0),typeof c.ctx.resume=="function"&&c.ctx.resume(),v.onended=function(){v.disconnect(0),c._audioUnlocked=!0,document.removeEventListener("touchstart",d,!0),document.removeEventListener("touchend",d,!0),document.removeEventListener("click",d,!0),document.removeEventListener("keydown",d,!0);for(var C=0;C<c._howls.length;C++)c._howls[C]._emit("unlock")}};return document.addEventListener("touchstart",d,!0),document.addEventListener("touchend",d,!0),document.addEventListener("click",d,!0),document.addEventListener("keydown",d,!0),c}},_obtainHtml5Audio:function(){var c=this||t;if(c._html5AudioPool.length)return c._html5AudioPool.pop();var d=new Audio().play();return d&&typeof Promise<"u"&&(d instanceof Promise||typeof d.then=="function")&&d.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(c){var d=this||t;return c._unlocked&&d._html5AudioPool.push(c),d},_autoSuspend:function(){var c=this;if(c.autoSuspend&&c.ctx&&c.ctx.suspend!==void 0&&t.usingWebAudio){for(var d=0;d<c._howls.length;d++)if(c._howls[d]._webAudio){for(var h=0;h<c._howls[d]._sounds.length;h++)if(!c._howls[d]._sounds[h]._paused)return c}return c._suspendTimer&&clearTimeout(c._suspendTimer),c._suspendTimer=setTimeout(function(){if(c.autoSuspend){c._suspendTimer=null,c.state="suspending";var p=function(){c.state="suspended",c._resumeAfterSuspend&&(delete c._resumeAfterSuspend,c._autoResume())};c.ctx.suspend().then(p,p)}},3e4),c}},_autoResume:function(){var c=this;if(c.ctx&&c.ctx.resume!==void 0&&t.usingWebAudio)return c.state==="running"&&c.ctx.state!=="interrupted"&&c._suspendTimer?(clearTimeout(c._suspendTimer),c._suspendTimer=null):c.state==="suspended"||c.state==="running"&&c.ctx.state==="interrupted"?(c.ctx.resume().then(function(){c.state="running";for(var d=0;d<c._howls.length;d++)c._howls[d]._emit("resume")}),c._suspendTimer&&(clearTimeout(c._suspendTimer),c._suspendTimer=null)):c.state==="suspending"&&(c._resumeAfterSuspend=!0),c}};var t=new e,n=function(c){var d=this;if(!c.src||c.src.length===0)return void console.error("An array of source files must be passed with any new Howl.");d.init(c)};n.prototype={init:function(c){var d=this;return t.ctx||f(),d._autoplay=c.autoplay||!1,d._format=typeof c.format!="string"?c.format:[c.format],d._html5=c.html5||!1,d._muted=c.mute||!1,d._loop=c.loop||!1,d._pool=c.pool||5,d._preload=typeof c.preload!="boolean"&&c.preload!=="metadata"||c.preload,d._rate=c.rate||1,d._sprite=c.sprite||{},d._src=typeof c.src!="string"?c.src:[c.src],d._volume=c.volume!==void 0?c.volume:1,d._xhr={method:c.xhr&&c.xhr.method?c.xhr.method:"GET",headers:c.xhr&&c.xhr.headers?c.xhr.headers:null,withCredentials:!(!c.xhr||!c.xhr.withCredentials)&&c.xhr.withCredentials},d._duration=0,d._state="unloaded",d._sounds=[],d._endTimers={},d._queue=[],d._playLock=!1,d._onend=c.onend?[{fn:c.onend}]:[],d._onfade=c.onfade?[{fn:c.onfade}]:[],d._onload=c.onload?[{fn:c.onload}]:[],d._onloaderror=c.onloaderror?[{fn:c.onloaderror}]:[],d._onplayerror=c.onplayerror?[{fn:c.onplayerror}]:[],d._onpause=c.onpause?[{fn:c.onpause}]:[],d._onplay=c.onplay?[{fn:c.onplay}]:[],d._onstop=c.onstop?[{fn:c.onstop}]:[],d._onmute=c.onmute?[{fn:c.onmute}]:[],d._onvolume=c.onvolume?[{fn:c.onvolume}]:[],d._onrate=c.onrate?[{fn:c.onrate}]:[],d._onseek=c.onseek?[{fn:c.onseek}]:[],d._onunlock=c.onunlock?[{fn:c.onunlock}]:[],d._onresume=[],d._webAudio=t.usingWebAudio&&!d._html5,t.ctx!==void 0&&t.ctx&&t.autoUnlock&&t._unlockAudio(),t._howls.push(d),d._autoplay&&d._queue.push({event:"play",action:function(){d.play()}}),d._preload&&d._preload!=="none"&&d.load(),d},load:function(){var c=this,d=null;if(t.noAudio)return void c._emit("loaderror",null,"No audio support.");typeof c._src=="string"&&(c._src=[c._src]);for(var h=0;h<c._src.length;h++){var p,m;if(c._format&&c._format[h])p=c._format[h];else{if(typeof(m=c._src[h])!="string"){c._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}p=/^data:audio\/([^;,]+);/i.exec(m),p||(p=/\.([^.]+)$/.exec(m.split("?",1)[0])),p&&(p=p[1].toLowerCase())}if(p||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),p&&t.codecs(p)){d=c._src[h];break}}return d?(c._src=d,c._state="loading",window.location.protocol==="https:"&&d.slice(0,5)==="http:"&&(c._html5=!0,c._webAudio=!1),new a(c),c._webAudio&&s(c),c):void c._emit("loaderror",null,"No codec support for selected audio sources.")},play:function(c,d){var h=this,p=null;if(typeof c=="number")p=c,c=null;else{if(typeof c=="string"&&h._state==="loaded"&&!h._sprite[c])return null;if(c===void 0&&(c="__default",!h._playLock)){for(var m=0,g=0;g<h._sounds.length;g++)h._sounds[g]._paused&&!h._sounds[g]._ended&&(m++,p=h._sounds[g]._id);m===1?c=null:p=null}}var b=p?h._soundById(p):h._inactiveSound();if(!b)return null;if(p&&!c&&(c=b._sprite||"__default"),h._state!=="loaded"){b._sprite=c,b._ended=!1;var x=b._id;return h._queue.push({event:"play",action:function(){h.play(x)}}),x}if(p&&!b._paused)return d||h._loadQueue("play"),b._id;h._webAudio&&t._autoResume();var v=Math.max(0,b._seek>0?b._seek:h._sprite[c][0]/1e3),C=Math.max(0,(h._sprite[c][0]+h._sprite[c][1])/1e3-v),E=1e3*C/Math.abs(b._rate),R=h._sprite[c][0]/1e3,O=(h._sprite[c][0]+h._sprite[c][1])/1e3;b._sprite=c,b._ended=!1;var H=function(){b._paused=!1,b._seek=v,b._start=R,b._stop=O,b._loop=!(!b._loop&&!h._sprite[c][2])};if(v>=O)return void h._ended(b);var N=b._node;if(h._webAudio){var K=function(){h._playLock=!1,H(),h._refreshBuffer(b);var w=b._muted||h._muted?0:b._volume;N.gain.setValueAtTime(w,t.ctx.currentTime),b._playStart=t.ctx.currentTime,N.bufferSource.start===void 0?b._loop?N.bufferSource.noteGrainOn(0,v,86400):N.bufferSource.noteGrainOn(0,v,C):b._loop?N.bufferSource.start(0,v,86400):N.bufferSource.start(0,v,C),E!==1/0&&(h._endTimers[b._id]=setTimeout(h._ended.bind(h,b),E)),d||setTimeout(function(){h._emit("play",b._id),h._loadQueue()},0)};t.state==="running"&&t.ctx.state!=="interrupted"?K():(h._playLock=!0,h.once("resume",K),h._clearTimer(b._id))}else{var ae=function(){N.currentTime=v,N.muted=b._muted||h._muted||t._muted||N.muted,N.volume=b._volume*t.volume(),N.playbackRate=b._rate;try{var w=N.play();if(w&&typeof Promise<"u"&&(w instanceof Promise||typeof w.then=="function")?(h._playLock=!0,H(),w.then(function(){h._playLock=!1,N._unlocked=!0,d?h._loadQueue():h._emit("play",b._id)}).catch(function(){h._playLock=!1,h._emit("playerror",b._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),b._ended=!0,b._paused=!0})):d||(h._playLock=!1,H(),h._emit("play",b._id)),N.playbackRate=b._rate,N.paused)return void h._emit("playerror",b._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");c!=="__default"||b._loop?h._endTimers[b._id]=setTimeout(h._ended.bind(h,b),E):(h._endTimers[b._id]=function(){h._ended(b),N.removeEventListener("ended",h._endTimers[b._id],!1)},N.addEventListener("ended",h._endTimers[b._id],!1))}catch(M){h._emit("playerror",b._id,M)}};N.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(N.src=h._src,N.load());var T=window&&window.ejecta||!N.readyState&&t._navigator.isCocoonJS;if(N.readyState>=3||T)ae();else{h._playLock=!0,h._state="loading";var W=function(){h._state="loaded",ae(),N.removeEventListener(t._canPlayEvent,W,!1)};N.addEventListener(t._canPlayEvent,W,!1),h._clearTimer(b._id)}}return b._id},pause:function(c){var d=this;if(d._state!=="loaded"||d._playLock)return d._queue.push({event:"pause",action:function(){d.pause(c)}}),d;for(var h=d._getSoundIds(c),p=0;p<h.length;p++){d._clearTimer(h[p]);var m=d._soundById(h[p]);if(m&&!m._paused&&(m._seek=d.seek(h[p]),m._rateSeek=0,m._paused=!0,d._stopFade(h[p]),m._node))if(d._webAudio){if(!m._node.bufferSource)continue;m._node.bufferSource.stop===void 0?m._node.bufferSource.noteOff(0):m._node.bufferSource.stop(0),d._cleanBuffer(m._node)}else isNaN(m._node.duration)&&m._node.duration!==1/0||m._node.pause();arguments[1]||d._emit("pause",m?m._id:null)}return d},stop:function(c,d){var h=this;if(h._state!=="loaded"||h._playLock)return h._queue.push({event:"stop",action:function(){h.stop(c)}}),h;for(var p=h._getSoundIds(c),m=0;m<p.length;m++){h._clearTimer(p[m]);var g=h._soundById(p[m]);g&&(g._seek=g._start||0,g._rateSeek=0,g._paused=!0,g._ended=!0,h._stopFade(p[m]),g._node&&(h._webAudio?g._node.bufferSource&&(g._node.bufferSource.stop===void 0?g._node.bufferSource.noteOff(0):g._node.bufferSource.stop(0),h._cleanBuffer(g._node)):isNaN(g._node.duration)&&g._node.duration!==1/0||(g._node.currentTime=g._start||0,g._node.pause(),g._node.duration===1/0&&h._clearSound(g._node))),d||h._emit("stop",g._id))}return h},mute:function(c,d){var h=this;if(h._state!=="loaded"||h._playLock)return h._queue.push({event:"mute",action:function(){h.mute(c,d)}}),h;if(d===void 0){if(typeof c!="boolean")return h._muted;h._muted=c}for(var p=h._getSoundIds(d),m=0;m<p.length;m++){var g=h._soundById(p[m]);g&&(g._muted=c,g._interval&&h._stopFade(g._id),h._webAudio&&g._node?g._node.gain.setValueAtTime(c?0:g._volume,t.ctx.currentTime):g._node&&(g._node.muted=!!t._muted||c),h._emit("mute",g._id))}return h},volume:function(){var c,d,h=this,p=arguments;if(p.length===0)return h._volume;p.length===1||p.length===2&&p[1]===void 0?h._getSoundIds().indexOf(p[0])>=0?d=parseInt(p[0],10):c=parseFloat(p[0]):p.length>=2&&(c=parseFloat(p[0]),d=parseInt(p[1],10));var m;if(!(c!==void 0&&c>=0&&c<=1))return m=d?h._soundById(d):h._sounds[0],m?m._volume:0;if(h._state!=="loaded"||h._playLock)return h._queue.push({event:"volume",action:function(){h.volume.apply(h,p)}}),h;d===void 0&&(h._volume=c),d=h._getSoundIds(d);for(var g=0;g<d.length;g++)(m=h._soundById(d[g]))&&(m._volume=c,p[2]||h._stopFade(d[g]),h._webAudio&&m._node&&!m._muted?m._node.gain.setValueAtTime(c,t.ctx.currentTime):m._node&&!m._muted&&(m._node.volume=c*t.volume()),h._emit("volume",m._id));return h},fade:function(c,d,h,p){var m=this;if(m._state!=="loaded"||m._playLock)return m._queue.push({event:"fade",action:function(){m.fade(c,d,h,p)}}),m;c=Math.min(Math.max(0,parseFloat(c)),1),d=Math.min(Math.max(0,parseFloat(d)),1),h=parseFloat(h),m.volume(c,p);for(var g=m._getSoundIds(p),b=0;b<g.length;b++){var x=m._soundById(g[b]);if(x){if(p||m._stopFade(g[b]),m._webAudio&&!x._muted){var v=t.ctx.currentTime,C=v+h/1e3;x._volume=c,x._node.gain.setValueAtTime(c,v),x._node.gain.linearRampToValueAtTime(d,C)}m._startFadeInterval(x,c,d,h,g[b],p===void 0)}}return m},_startFadeInterval:function(c,d,h,p,m,g){var b=this,x=d,v=h-d,C=Math.abs(v/.01),E=Math.max(4,C>0?p/C:p),R=Date.now();c._fadeTo=h,c._interval=setInterval(function(){var O=(Date.now()-R)/p;R=Date.now(),x+=v*O,x=Math.round(100*x)/100,x=v<0?Math.max(h,x):Math.min(h,x),b._webAudio?c._volume=x:b.volume(x,c._id,!0),g&&(b._volume=x),(h<d&&x<=h||h>d&&x>=h)&&(clearInterval(c._interval),c._interval=null,c._fadeTo=null,b.volume(h,c._id),b._emit("fade",c._id))},E)},_stopFade:function(c){var d=this,h=d._soundById(c);return h&&h._interval&&(d._webAudio&&h._node.gain.cancelScheduledValues(t.ctx.currentTime),clearInterval(h._interval),h._interval=null,d.volume(h._fadeTo,c),h._fadeTo=null,d._emit("fade",c)),d},loop:function(){var c,d,h,p=this,m=arguments;if(m.length===0)return p._loop;if(m.length===1){if(typeof m[0]!="boolean")return!!(h=p._soundById(parseInt(m[0],10)))&&h._loop;c=m[0],p._loop=c}else m.length===2&&(c=m[0],d=parseInt(m[1],10));for(var g=p._getSoundIds(d),b=0;b<g.length;b++)(h=p._soundById(g[b]))&&(h._loop=c,p._webAudio&&h._node&&h._node.bufferSource&&(h._node.bufferSource.loop=c,c&&(h._node.bufferSource.loopStart=h._start||0,h._node.bufferSource.loopEnd=h._stop,p.playing(g[b])&&(p.pause(g[b],!0),p.play(g[b],!0)))));return p},rate:function(){var c,d,h=this,p=arguments;if(p.length===0)d=h._sounds[0]._id;else if(p.length===1){var m=h._getSoundIds(),g=m.indexOf(p[0]);g>=0?d=parseInt(p[0],10):c=parseFloat(p[0])}else p.length===2&&(c=parseFloat(p[0]),d=parseInt(p[1],10));var b;if(typeof c!="number")return b=h._soundById(d),b?b._rate:h._rate;if(h._state!=="loaded"||h._playLock)return h._queue.push({event:"rate",action:function(){h.rate.apply(h,p)}}),h;d===void 0&&(h._rate=c),d=h._getSoundIds(d);for(var x=0;x<d.length;x++)if(b=h._soundById(d[x])){h.playing(d[x])&&(b._rateSeek=h.seek(d[x]),b._playStart=h._webAudio?t.ctx.currentTime:b._playStart),b._rate=c,h._webAudio&&b._node&&b._node.bufferSource?b._node.bufferSource.playbackRate.setValueAtTime(c,t.ctx.currentTime):b._node&&(b._node.playbackRate=c);var v=h.seek(d[x]),C=(h._sprite[b._sprite][0]+h._sprite[b._sprite][1])/1e3-v,E=1e3*C/Math.abs(b._rate);!h._endTimers[d[x]]&&b._paused||(h._clearTimer(d[x]),h._endTimers[d[x]]=setTimeout(h._ended.bind(h,b),E)),h._emit("rate",b._id)}return h},seek:function(){var c,d,h=this,p=arguments;if(p.length===0)h._sounds.length&&(d=h._sounds[0]._id);else if(p.length===1){var m=h._getSoundIds(),g=m.indexOf(p[0]);g>=0?d=parseInt(p[0],10):h._sounds.length&&(d=h._sounds[0]._id,c=parseFloat(p[0]))}else p.length===2&&(c=parseFloat(p[0]),d=parseInt(p[1],10));if(d===void 0)return 0;if(typeof c=="number"&&(h._state!=="loaded"||h._playLock))return h._queue.push({event:"seek",action:function(){h.seek.apply(h,p)}}),h;var b=h._soundById(d);if(b){if(!(typeof c=="number"&&c>=0)){if(h._webAudio){var x=h.playing(d)?t.ctx.currentTime-b._playStart:0,v=b._rateSeek?b._rateSeek-b._seek:0;return b._seek+(v+x*Math.abs(b._rate))}return b._node.currentTime}var C=h.playing(d);C&&h.pause(d,!0),b._seek=c,b._ended=!1,h._clearTimer(d),h._webAudio||!b._node||isNaN(b._node.duration)||(b._node.currentTime=c);var E=function(){C&&h.play(d,!0),h._emit("seek",d)};if(C&&!h._webAudio){var R=function(){h._playLock?setTimeout(R,0):E()};setTimeout(R,0)}else E()}return h},playing:function(c){var d=this;if(typeof c=="number"){var h=d._soundById(c);return!!h&&!h._paused}for(var p=0;p<d._sounds.length;p++)if(!d._sounds[p]._paused)return!0;return!1},duration:function(c){var d=this,h=d._duration,p=d._soundById(c);return p&&(h=d._sprite[p._sprite][1]/1e3),h},state:function(){return this._state},unload:function(){for(var c=this,d=c._sounds,h=0;h<d.length;h++)d[h]._paused||c.stop(d[h]._id),c._webAudio||(c._clearSound(d[h]._node),d[h]._node.removeEventListener("error",d[h]._errorFn,!1),d[h]._node.removeEventListener(t._canPlayEvent,d[h]._loadFn,!1),d[h]._node.removeEventListener("ended",d[h]._endFn,!1),t._releaseHtml5Audio(d[h]._node)),delete d[h]._node,c._clearTimer(d[h]._id);var p=t._howls.indexOf(c);p>=0&&t._howls.splice(p,1);var m=!0;for(h=0;h<t._howls.length;h++)if(t._howls[h]._src===c._src||c._src.indexOf(t._howls[h]._src)>=0){m=!1;break}return r&&m&&delete r[c._src],t.noAudio=!1,c._state="unloaded",c._sounds=[],c=null,null},on:function(c,d,h,p){var m=this,g=m["_on"+c];return typeof d=="function"&&g.push(p?{id:h,fn:d,once:p}:{id:h,fn:d}),m},off:function(c,d,h){var p=this,m=p["_on"+c],g=0;if(typeof d=="number"&&(h=d,d=null),d||h)for(g=0;g<m.length;g++){var b=h===m[g].id;if(d===m[g].fn&&b||!d&&b){m.splice(g,1);break}}else if(c)p["_on"+c]=[];else{var x=Object.keys(p);for(g=0;g<x.length;g++)x[g].indexOf("_on")===0&&Array.isArray(p[x[g]])&&(p[x[g]]=[])}return p},once:function(c,d,h){var p=this;return p.on(c,d,h,1),p},_emit:function(c,d,h){for(var p=this,m=p["_on"+c],g=m.length-1;g>=0;g--)m[g].id&&m[g].id!==d&&c!=="load"||(setTimeout(function(b){b.call(this,d,h)}.bind(p,m[g].fn),0),m[g].once&&p.off(c,m[g].fn,m[g].id));return p._loadQueue(c),p},_loadQueue:function(c){var d=this;if(d._queue.length>0){var h=d._queue[0];h.event===c&&(d._queue.shift(),d._loadQueue()),c||h.action()}return d},_ended:function(c){var d=this,h=c._sprite;if(!d._webAudio&&c._node&&!c._node.paused&&!c._node.ended&&c._node.currentTime<c._stop)return setTimeout(d._ended.bind(d,c),100),d;var p=!(!c._loop&&!d._sprite[h][2]);if(d._emit("end",c._id),!d._webAudio&&p&&d.stop(c._id,!0).play(c._id),d._webAudio&&p){d._emit("play",c._id),c._seek=c._start||0,c._rateSeek=0,c._playStart=t.ctx.currentTime;var m=1e3*(c._stop-c._start)/Math.abs(c._rate);d._endTimers[c._id]=setTimeout(d._ended.bind(d,c),m)}return d._webAudio&&!p&&(c._paused=!0,c._ended=!0,c._seek=c._start||0,c._rateSeek=0,d._clearTimer(c._id),d._cleanBuffer(c._node),t._autoSuspend()),d._webAudio||p||d.stop(c._id,!0),d},_clearTimer:function(c){var d=this;if(d._endTimers[c]){if(typeof d._endTimers[c]!="function")clearTimeout(d._endTimers[c]);else{var h=d._soundById(c);h&&h._node&&h._node.removeEventListener("ended",d._endTimers[c],!1)}delete d._endTimers[c]}return d},_soundById:function(c){for(var d=this,h=0;h<d._sounds.length;h++)if(c===d._sounds[h]._id)return d._sounds[h];return null},_inactiveSound:function(){var c=this;c._drain();for(var d=0;d<c._sounds.length;d++)if(c._sounds[d]._ended)return c._sounds[d].reset();return new a(c)},_drain:function(){var c=this,d=c._pool,h=0,p=0;if(!(c._sounds.length<d)){for(p=0;p<c._sounds.length;p++)c._sounds[p]._ended&&h++;for(p=c._sounds.length-1;p>=0;p--){if(h<=d)return;c._sounds[p]._ended&&(c._webAudio&&c._sounds[p]._node&&c._sounds[p]._node.disconnect(0),c._sounds.splice(p,1),h--)}}},_getSoundIds:function(c){var d=this;if(c===void 0){for(var h=[],p=0;p<d._sounds.length;p++)h.push(d._sounds[p]._id);return h}return[c]},_refreshBuffer:function(c){var d=this;return c._node.bufferSource=t.ctx.createBufferSource(),c._node.bufferSource.buffer=r[d._src],c._panner?c._node.bufferSource.connect(c._panner):c._node.bufferSource.connect(c._node),c._node.bufferSource.loop=c._loop,c._loop&&(c._node.bufferSource.loopStart=c._start||0,c._node.bufferSource.loopEnd=c._stop||0),c._node.bufferSource.playbackRate.setValueAtTime(c._rate,t.ctx.currentTime),d},_cleanBuffer:function(c){var d=this,h=t._navigator&&t._navigator.vendor.indexOf("Apple")>=0;if(!c.bufferSource)return d;if(t._scratchBuffer&&c.bufferSource&&(c.bufferSource.onended=null,c.bufferSource.disconnect(0),h))try{c.bufferSource.buffer=t._scratchBuffer}catch{}return c.bufferSource=null,d},_clearSound:function(c){/MSIE |Trident\//.test(t._navigator&&t._navigator.userAgent)||(c.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var a=function(c){this._parent=c,this.init()};a.prototype={init:function(){var c=this,d=c._parent;return c._muted=d._muted,c._loop=d._loop,c._volume=d._volume,c._rate=d._rate,c._seek=0,c._paused=!0,c._ended=!0,c._sprite="__default",c._id=++t._counter,d._sounds.push(c),c.create(),c},create:function(){var c=this,d=c._parent,h=t._muted||c._muted||c._parent._muted?0:c._volume;return d._webAudio?(c._node=t.ctx.createGain===void 0?t.ctx.createGainNode():t.ctx.createGain(),c._node.gain.setValueAtTime(h,t.ctx.currentTime),c._node.paused=!0,c._node.connect(t.masterGain)):t.noAudio||(c._node=t._obtainHtml5Audio(),c._errorFn=c._errorListener.bind(c),c._node.addEventListener("error",c._errorFn,!1),c._loadFn=c._loadListener.bind(c),c._node.addEventListener(t._canPlayEvent,c._loadFn,!1),c._endFn=c._endListener.bind(c),c._node.addEventListener("ended",c._endFn,!1),c._node.src=d._src,c._node.preload=d._preload===!0?"auto":d._preload,c._node.volume=h*t.volume(),c._node.load()),c},reset:function(){var c=this,d=c._parent;return c._muted=d._muted,c._loop=d._loop,c._volume=d._volume,c._rate=d._rate,c._seek=0,c._rateSeek=0,c._paused=!0,c._ended=!0,c._sprite="__default",c._id=++t._counter,c},_errorListener:function(){var c=this;c._parent._emit("loaderror",c._id,c._node.error?c._node.error.code:0),c._node.removeEventListener("error",c._errorFn,!1)},_loadListener:function(){var c=this,d=c._parent;d._duration=Math.ceil(10*c._node.duration)/10,Object.keys(d._sprite).length===0&&(d._sprite={__default:[0,1e3*d._duration]}),d._state!=="loaded"&&(d._state="loaded",d._emit("load"),d._loadQueue()),c._node.removeEventListener(t._canPlayEvent,c._loadFn,!1)},_endListener:function(){var c=this,d=c._parent;d._duration===1/0&&(d._duration=Math.ceil(10*c._node.duration)/10,d._sprite.__default[1]===1/0&&(d._sprite.__default[1]=1e3*d._duration),d._ended(c)),c._node.removeEventListener("ended",c._endFn,!1)}};var r={},s=function(c){var d=c._src;if(r[d])return c._duration=r[d].duration,void u(c);if(/^data:[^;]+;base64,/.test(d)){for(var h=atob(d.split(",")[1]),p=new Uint8Array(h.length),m=0;m<h.length;++m)p[m]=h.charCodeAt(m);l(p.buffer,c)}else{var g=new XMLHttpRequest;g.open(c._xhr.method,d,!0),g.withCredentials=c._xhr.withCredentials,g.responseType="arraybuffer",c._xhr.headers&&Object.keys(c._xhr.headers).forEach(function(b){g.setRequestHeader(b,c._xhr.headers[b])}),g.onload=function(){var b=(g.status+"")[0];if(b!=="0"&&b!=="2"&&b!=="3")return void c._emit("loaderror",null,"Failed loading audio file with status: "+g.status+".");l(g.response,c)},g.onerror=function(){c._webAudio&&(c._html5=!0,c._webAudio=!1,c._sounds=[],delete r[d],c.load())},o(g)}},o=function(c){try{c.send()}catch{c.onerror()}},l=function(c,d){var h=function(){d._emit("loaderror",null,"Decoding audio data failed.")},p=function(m){m&&d._sounds.length>0?(r[d._src]=m,u(d,m)):h()};typeof Promise<"u"&&t.ctx.decodeAudioData.length===1?t.ctx.decodeAudioData(c).then(p).catch(h):t.ctx.decodeAudioData(c,p,h)},u=function(c,d){d&&!c._duration&&(c._duration=d.duration),Object.keys(c._sprite).length===0&&(c._sprite={__default:[0,1e3*c._duration]}),c._state!=="loaded"&&(c._state="loaded",c._emit("load"),c._loadQueue())},f=function(){if(t.usingWebAudio){try{typeof AudioContext<"u"?t.ctx=new AudioContext:typeof webkitAudioContext<"u"?t.ctx=new webkitAudioContext:t.usingWebAudio=!1}catch{t.usingWebAudio=!1}t.ctx||(t.usingWebAudio=!1);var c=/iP(hone|od|ad)/.test(t._navigator&&t._navigator.platform),d=t._navigator&&t._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),h=d?parseInt(d[1],10):null;if(c&&h&&h<9){var p=/safari/.test(t._navigator&&t._navigator.userAgent.toLowerCase());t._navigator&&!p&&(t.usingWebAudio=!1)}t.usingWebAudio&&(t.masterGain=t.ctx.createGain===void 0?t.ctx.createGainNode():t.ctx.createGain(),t.masterGain.gain.setValueAtTime(t._muted?0:t._volume,t.ctx.currentTime),t.masterGain.connect(t.ctx.destination)),t._setup()}};i.Howler=t,i.Howl=n,typeof hi<"u"?(hi.HowlerGlobal=e,hi.Howler=t,hi.Howl=n,hi.Sound=a):typeof window<"u"&&(window.HowlerGlobal=e,window.Howler=t,window.Howl=n,window.Sound=a)})()}(Vr)),Vr}var ys=Wd();const Ud="data:audio/wav;base64,UklGRkYEAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAATElTVBoAAABJTkZPSVNGVA0AAABMYXZmNjAuMy4xMDAAAGRhdGEABAAAAIDfjHvG/eK+8VP5Bvyg/v3+Dv8O/1v+8P59B0sXqgoxBa4BQgEEAIMATAAyAE4AnwA8APf/oH+tf3J/6F74LWgXiQpfBbABbAGy/+b/4f+X/w+AAIAKjAzF7uIk8Ln4efsB/jf+Of66/kv+Ev84/6sBbf+eAMn/IADgACQA3gBXABMBrP9/ACIAvgraEnAIfwVbAdYCxf5zAVr/iQBb/6cAMP9KAKtP4H9VaPUyfhjgC0EFigNcAL4AqP/qABoA5wAc/T7yE/iK/CX94v+A/a3+4P7n/eX+cv0b/w7/v/4AgGK2Qdso7ub2vfsQ/ef96/6b/u//+/1UANb9sIAAgJq/3N4+8MX37PtP/fD+Hf5S/zf+c/80/f3DWsiL5Cby0fm5/OT9IQAG/y0A1P6S/1z/jP//f/9/un+oY5kwqheUC5oFXAGAAFv/WwDN/xQBRf9mgACAWoT+weri4/BI+aH7Xv+l/Zr/Nf3k/xT9/3/1ff9/OkPbIUEPXQiVBN4AiQDT//YA0/8JAA2AAICvgIWfetA55xX0Mfmz/Az+w/5H/4r+Zf8r/015Q1d6KlgVZwkkBqUBigHH/q4A6/7WACL/qgBtHDFPaCbnE/sIigQNAloBpf8qALn/aP9vAMj+mABm5FLnpvMc+iz99f51/wH/zP4c/wcAjf+X/zD/+CAbf51Znio6FNwI5AS5AdUAnf8g/93/yv6lAJH/R4AAgDetL9ZL7LH1VPum/Lr+JP+Y/5z+0v4b/pP+AdF63vruUPj4+7r9nP6Y/Qz/Bv5Q/3P+jf+i/ln8K+1/9y769f1I/RQAxP4RABT+5/8x/mH/ff6k//hB7n/0U6opvRPDCUkEOgF5ASD/PwBI/4cAsP9iAEgHfg1JBb4DCwGVAJz/iQCX/30Awf8LAND/HADc/xLy0+8l+K/7/v06/+b+Bf/W/sH+x/7U/tv+k/4A/yoVChNQCeEDSgLoAEEABQA9ABUABADR/xUAx/8WAHvQ7dWg6v/1wfpZ/eb9OP/6/h7/7f76/sz+zf7X/tkgHR0mDiMHGwP+AC4A9v8xAAoAQgDi/ywA9v9aABMAIAGa/+b/+v8TALT/5v8gAPT/8f8OAC4ANAAFAA3pyuQE8+D5Rf3y/Rr/5f7H/rP+g/7t/q7+Iv/Q/oAALQB9AAcAJQAJAPv/2v/O/yAAWgAbAFkBSAP+ATMCCgIGAY0AKwAzADEAMABIABMAHAC4/17/x/4J//T+Uv9b/6b/wP/Y//D/3v8QAPz/7v8GAEAAFQA4ACoAEwAIAAIABwD9//L/CAADAAkADgAWABMAGwAPAA0ACwAQAAgABQAJAAoAAwD///b/9f/y/+n/9//2//f//f/9/w==",Bc="/smeditor/assets/metronome_high-C7Kf-JE0.wav",Fc="/smeditor/assets/metronome_low-BSgffp0_.wav",qd="/smeditor/assets/mine-Dy-Y9L9c.wav",Va=[".aac",".mid",".midi",".mp3",".oga",".ogg",".opus",".wav",".webm",".weba",".flac",".aiff"],Ii=[".bmp",".gif",".jpeg",".jpg",".png",".tif",".tiff",".webp"];class st{windowManager;minimizeElement;closeElement;closed=!1;options;windowElement;viewElement;constructor(e){this.options=e;const t=document.createElement("div"),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div");t.appendChild(a),t.appendChild(n),t.style.width=e.width/16+"rem",t.style.left=window.innerWidth/2-e.width/2*y.general.uiScale+"px",t.style.top=window.innerHeight/2-e.height/2*y.general.uiScale+"px",t.classList.add("window"),e.win_id&&(t.dataset.win_id=e.win_id),n.classList.add("view"),n.style.height=e.height/16+"rem",n.style.width=e.width/16+"rem",a.classList.add("navbar"),e.title!==""&&a.appendChild(r);const s=pe.getIcon("MINIMIZE",15),o=pe.getIcon("CLOSE_WINDOW",15);s.classList.add("unselectable"),s.draggable=!1,s.onclick=()=>{n.style.height!="0px"?n.style.height="0px":n.style.height=e.height+"px",this.clampPosition()},o.classList.add("unselectable"),o.draggable=!1,o.onclick=()=>this.closeWindow(),a.appendChild(s),a.appendChild(o),this.minimizeElement=s,this.closeElement=o,e.disableClose&&(s.style.display="none",o.style.display="none"),r.innerText=e.title,r.classList.add("title"),t.addEventListener("mousedown",()=>this.focus()),e.blocking&&(window.addEventListener("mousedown",this.block,!0),document.getElementById("blocker").style.display="block",t.dataset.blocking="block"),r.addEventListener("mousedown",()=>{window.addEventListener("mousemove",this.handleDrag),window.addEventListener("mouseup",()=>window.removeEventListener("mousemove",this.handleDrag))}),this.focus(),t.classList.add("focused"),this.windowElement=t,this.viewElement=n}addToManager(e){this.windowManager=e,e.view.appendChild(this.windowElement),this.focus()}onClose(){}closeWindow(){this.windowManager&&(this.closed=!0,this.onClose(),this.windowManager.removeWindow(this),this.windowElement.classList.add("exiting"),window.removeEventListener("mousedown",this.block,!0),this.options.blocking&&this.windowManager.windows.filter(e=>e.options.blocking).length==0&&(document.getElementById("blocker").style.display="none"),setTimeout(()=>this.windowManager.view.removeChild(this.windowElement),40))}focus(){if(this.windowManager==null)return;this.windowManager.unfocusAll(),this.windowElement.classList.add("focused");const e=Array.from(this.windowManager.view.children).map(t=>t).filter(t=>t!=this.windowElement);e.sort((t,n)=>parseInt(t.style.zIndex)-parseInt(n.style.zIndex)),e.push(this.windowElement);for(let t=0;t<e.length;t++)e[t].style.zIndex=((e[t].dataset.blocking?10001:0)+t).toString()}unfocus(){this.windowManager!=null&&this.windowElement.classList.remove("focused")}block=e=>{!e.target||this.windowElement.contains(e.target)||(e.stopImmediatePropagation(),e.preventDefault())};handleDrag=e=>{const t=parseInt(this.windowElement.style.left.slice(0,-2))+e.movementX,n=parseInt(this.windowElement.style.top.slice(0,-2))+e.movementY;this.windowElement.style.left=t+"px",this.windowElement.style.top=n+"px",this.clampPosition()};clampPosition(){if(this.windowManager==null)return;const e=parseInt(this.windowElement.style.left.slice(0,-2)),t=parseInt(this.windowElement.style.top.slice(0,-2)),n=this.windowManager.app.view.getBoundingClientRect();this.windowElement.style.left=Ae(e,n.left,n.width-this.windowElement.clientWidth+n.left)+"px",this.windowElement.style.top=Ae(t,n.top,n.height-this.windowElement.clientHeight+n.top)+"px"}move(e,t){this.windowElement.style.left=e+"px",this.windowElement.style.top=t+"px"}setDisableClose(e){e?(this.minimizeElement.style.display="none",this.closeElement.style.display="none"):(this.minimizeElement.style.display="",this.closeElement.style.display="")}setBlocking(e){e?(this.windowElement.dataset.blocking="block",document.getElementById("blocker").style.display="block",window.addEventListener("mousedown",this.block,!0)):(this.windowElement.dataset.blocking="",document.getElementById("blocker").style.display="none",window.removeEventListener("mousedown",this.block,!0)),this.focus()}}class Gd extends st{app;constructor(e){super({title:"About",width:300,height:170,win_id:"about"}),this.app=e,this.initView()}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("div");t.classList.add("about-container");const n=document.createElement("div");n.classList.add("logo-container");const a=document.createElement("img");a.src="/smeditor/assets/icon/logo.png";const r=document.createElement("div");r.innerText="SMEditor";const s=document.createElement("div");s.style.textAlign="center",s.innerText="Open source online web tool to view and edit StepMania charts (.sm/.ssc files). Maintained by tillvit";const o=document.createElement("div");if(o.style.fontSize="0.875rem",o.style.color="var(--text-color-secondary)",o.innerText=`Core v${window.app.VERSION}`,window.nw){const l=nw.require("nw.gui");o.innerText+=` | App v${l.App.manifest.version}`}t.appendChild(n),n.appendChild(a),n.appendChild(r),t.appendChild(s),t.appendChild(o),e.appendChild(t),this.viewElement.appendChild(e)}}const xl={videoHeight:{label:"Video Height",input:{type:"dropdown",items:["360p","480p","720p","1080p"],advanced:!0,transformers:{serialize:i=>`${i}p`,deserialize:i=>parseInt(i.slice(0,-1))}}},fps:{label:"FPS",input:{type:"dropdown",items:[24,30,60],advanced:!1}},bitrate:{label:"Bitrate",input:{type:"display-slider",transformers:{serialize:i=>Math.log(i),deserialize:i=>Math.round(Math.exp(i)/1e3)*1e3,display:i=>Math.round(Math.exp(i)/1e3)+" kbps"},min:Math.log(1e6),max:Math.log(2e7),step:1e-5,displayWidth:80,width:80}},aspectRatio:{label:"Aspect Ratio",input:{type:"dropdown",items:["4 / 3","16 / 9","16 / 10"],advanced:!0,transformers:{serialize:i=>{const e={"4 / 3":1.3333333333333333,"16 / 9":1.7777777777777777,"16 / 10":1.6};return Object.keys(e).find(t=>{if(Math.abs(e[t]-i)<1e-4)return!0})},deserialize:i=>({"4 / 3":1.3333333333333333,"16 / 9":1.7777777777777777,"16 / 10":1.6})[i]}}}},$d={hideBarlines:{label:"Hide barlines and events",input:{type:"checkbox"}},playbackRate:{label:"Playback Rate",input:{type:"number",min:10,max:300,step:10,precision:3,minPrecision:0,transformers:{serialize:i=>i*100,deserialize:i=>i/100}}},assistTick:{label:"Assist Tick",input:{type:"checkbox"}},metronome:{label:"Metronome",input:{type:"checkbox"}}};var Gs=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},Y=(i,e,t)=>(Gs(i,e,"read from private field"),t?t.call(i):e.get(i)),Fe=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},pt=(i,e,t,n)=>(Gs(i,e,"write to private field"),e.set(i,t),t),Je=(i,e,t)=>(Gs(i,e,"access private method"),t),ze=new Uint8Array(8),gi=new DataView(ze.buffer),Nt=i=>[(i%256+256)%256],je=i=>(gi.setUint16(0,i,!1),[ze[0],ze[1]]),jd=i=>(gi.setInt16(0,i,!1),[ze[0],ze[1]]),Ic=i=>(gi.setUint32(0,i,!1),[ze[1],ze[2],ze[3]]),xe=i=>(gi.setUint32(0,i,!1),[ze[0],ze[1],ze[2],ze[3]]),Yd=i=>(gi.setUint32(0,Math.floor(i/2**32),!1),gi.setUint32(4,i,!1),[ze[0],ze[1],ze[2],ze[3],ze[4],ze[5],ze[6],ze[7]]),$s=i=>(gi.setInt16(0,2**8*i,!1),[ze[0],ze[1]]),ti=i=>(gi.setInt32(0,2**16*i,!1),[ze[0],ze[1],ze[2],ze[3]]),Wr=i=>(gi.setInt32(0,2**30*i,!1),[ze[0],ze[1],ze[2],ze[3]]),Qt=(i,e=!1)=>{let t=Array(i.length).fill(null).map((n,a)=>i.charCodeAt(a));return e&&t.push(0),t},$i=i=>i&&i[i.length-1],On=(i,e,t=!0)=>{let n=i*e;return t?Math.round(n):n},Rc=i=>{let e=i*(Math.PI/180),t=Math.cos(e),n=Math.sin(e);return[t,n,0,-n,t,0,0,0,1]},Kd=Rc(0),Pc=i=>[ti(i[0]),ti(i[1]),Wr(i[2]),ti(i[3]),ti(i[4]),Wr(i[5]),ti(i[6]),ti(i[7]),Wr(i[8])],kn=i=>!i||typeof i!="object"?i:Array.isArray(i)?i.map(kn):Object.fromEntries(Object.entries(i).map(([e,t])=>[e,kn(t)])),gt=(i,e,t)=>({type:i,contents:e&&new Uint8Array(e.flat(10)),children:t}),bt=(i,e,t,n,a)=>gt(i,[Nt(e),Ic(t),n??[]],a),Xd=i=>i?gt("ftyp",[Qt("isom"),xe(0),Qt("iso4"),Qt("hvc1")]):gt("ftyp",[Qt("isom"),xe(0),Qt("isom"),Qt("avc1"),Qt("mp41")]),_l=i=>({type:"mdat",largeSize:i}),Zd=i=>({type:"free",size:i}),Ur=(i,e)=>gt("moov",null,[Qd(e,i),...i.map(t=>Jd(t,e))]),Qd=(i,e)=>{let t=On(Math.max(0,...e.filter(a=>a.samples.length>0).map(a=>$i(a.samples).timestamp+$i(a.samples).duration)),xs),n=Math.max(...e.map(a=>a.id))+1;return bt("mvhd",0,0,[xe(i),xe(i),xe(xs),xe(t),ti(1),$s(1),Array(10).fill(0),Pc(Kd),Array(24).fill(0),xe(n)])},Jd=(i,e)=>gt("trak",null,[eh(i,e),th(i,e)]),eh=(i,e)=>{let t=$i(i.samples),n=On(t?t.timestamp+t.duration:0,xs);return bt("tkhd",0,3,[xe(e),xe(e),xe(i.id),xe(0),xe(n),Array(8).fill(0),je(0),je(0),$s(i.info.type==="audio"?1:0),je(0),Pc(Rc(i.info.type==="video"?i.info.rotation:0)),ti(i.info.type==="video"?i.info.width:0),ti(i.info.type==="video"?i.info.height:0)])},th=(i,e)=>gt("mdia",null,[ih(i,e),nh(i.info.type==="video"?"vide":"soun"),ah(i)]),ih=(i,e)=>{let t=$i(i.samples),n=On(t?t.timestamp+t.duration:0,i.timescale);return bt("mdhd",0,0,[xe(e),xe(e),xe(i.timescale),xe(n),je(21956),je(0)])},nh=i=>bt("hdlr",0,0,[Qt("mhlr"),Qt(i),xe(0),xe(0),xe(0),Qt("mp4-muxer-hdlr")]),ah=i=>gt("minf",null,[i.info.type==="video"?rh():sh(),oh(),uh(i)]),rh=()=>bt("vmhd",0,1,[je(0),je(0),je(0),je(0)]),sh=()=>bt("smhd",0,0,[je(0),je(0)]),oh=()=>gt("dinf",null,[lh()]),lh=()=>bt("dref",0,0,[xe(1)],[ch()]),ch=()=>bt("url ",0,1),uh=i=>gt("stbl",null,[dh(i),vh(i),xh(i),_h(i),Ch(i),Eh(i)]),dh=i=>bt("stsd",0,0,[xe(1)],[i.info.type==="video"?hh(Ah[i.info.codec],i):bh(Sh[i.info.codec],i)]),hh=(i,e)=>gt(i,[Array(6).fill(0),je(1),je(0),je(0),Array(12).fill(0),je(e.info.width),je(e.info.height),xe(4718592),xe(4718592),xe(0),je(1),Array(32).fill(0),je(24),jd(65535)],[kh[e.info.codec](e)]),fh=i=>i.codecPrivate&&gt("avcC",[...i.codecPrivate]),ph=i=>i.codecPrivate&&gt("hvcC",[...i.codecPrivate]),mh=i=>i.codecPrivate&&gt("vpcC",[...i.codecPrivate]),gh=i=>i.codecPrivate&&gt("av1C",[...i.codecPrivate]),bh=(i,e)=>gt(i,[Array(6).fill(0),je(1),je(0),je(0),xe(0),je(e.info.numberOfChannels),je(16),je(0),je(0),ti(e.info.sampleRate)],[Th[e.info.codec](e)]),yh=i=>bt("esds",0,0,[xe(58753152),Nt(32+i.codecPrivate.byteLength),je(1),Nt(0),xe(75530368),Nt(18+i.codecPrivate.byteLength),Nt(64),Nt(21),Ic(0),xe(130071),xe(130071),xe(92307584),Nt(i.codecPrivate.byteLength),...i.codecPrivate,xe(109084800),Nt(1),Nt(2)]),wh=i=>gt("dOps",[Nt(0),Nt(i.info.numberOfChannels),je(3840),xe(i.info.sampleRate),$s(0),Nt(0)]),vh=i=>bt("stts",0,0,[xe(i.timeToSampleTable.length),i.timeToSampleTable.map(e=>[xe(e.sampleCount),xe(e.sampleDelta)])]),xh=i=>{if(i.samples.every(t=>t.type==="key"))return null;let e=[...i.samples.entries()].filter(([,t])=>t.type==="key");return bt("stss",0,0,[xe(e.length),e.map(([t])=>xe(t+1))])},_h=i=>bt("stsc",0,0,[xe(i.compactlyCodedChunkTable.length),i.compactlyCodedChunkTable.map(e=>[xe(e.firstChunk),xe(e.samplesPerChunk),xe(1)])]),Ch=i=>bt("stsz",0,0,[xe(0),xe(i.samples.length),i.samples.map(e=>xe(e.size))]),Eh=i=>i.finalizedChunks.length>0&&$i(i.finalizedChunks).offset>=2**32?bt("co64",0,0,[xe(i.finalizedChunks.length),i.finalizedChunks.map(e=>Yd(e.offset))]):bt("stco",0,0,[xe(i.finalizedChunks.length),i.finalizedChunks.map(e=>xe(e.offset))]),Ah={avc:"avc1",hevc:"hvc1",vp9:"vp09",av1:"av01"},kh={avc:fh,hevc:ph,vp9:mh,av1:gh},Sh={aac:"mp4a",opus:"Opus"},Th={aac:yh,opus:wh},Oc=class{constructor(){this.buffer=null}},Nc=class{constructor(i,e,t){this.onData=i,this.onDone=e,this.options=t}},Mh=class{constructor(i,e){this.stream=i,this.options=e}},Ri,en,js=class{constructor(){this.pos=0,Fe(this,Ri,new Uint8Array(8)),Fe(this,en,new DataView(Y(this,Ri).buffer)),this.offsets=new WeakMap}seek(i){this.pos=i}writeU32(i){Y(this,en).setUint32(0,i,!1),this.write(Y(this,Ri).subarray(0,4))}writeU64(i){Y(this,en).setUint32(0,Math.floor(i/2**32),!1),Y(this,en).setUint32(4,i,!1),this.write(Y(this,Ri).subarray(0,8))}writeAscii(i){for(let e=0;e<i.length;e++)Y(this,en).setUint8(e%8,i.charCodeAt(e)),e%8===7&&this.write(Y(this,Ri));i.length%8!==0&&this.write(Y(this,Ri).subarray(0,i.length%8))}writeBox(i){if(this.offsets.set(i,this.pos),i.contents&&!i.children)this.writeBoxHeader(i,i.size??i.contents.byteLength+8),this.write(i.contents);else{let e=this.pos;if(this.writeBoxHeader(i,0),i.contents&&this.write(i.contents),i.children)for(let a of i.children)a&&this.writeBox(a);let t=this.pos,n=i.size??t-e;this.seek(e),this.writeBoxHeader(i,n),this.seek(t)}}writeBoxHeader(i,e){this.writeU32(i.largeSize?1:e),this.writeAscii(i.type),i.largeSize&&this.writeU64(e)}measureBoxHeader(i){return 8+(i.largeSize?8:0)}patchBox(i){let e=this.pos;this.seek(this.offsets.get(i)),this.writeBox(i),this.seek(e)}measureBox(i){if(i.contents&&!i.children)return this.measureBoxHeader(i)+i.contents.byteLength;{let e=this.measureBoxHeader(i);if(i.contents&&(e+=i.contents.byteLength),i.children)for(let t of i.children)t&&(e+=this.measureBox(t));return e}}};Ri=new WeakMap;en=new WeakMap;var ma,Wi,Nn,wn,ga,ws,Dh=class extends js{constructor(i){super(),Fe(this,ga),Fe(this,ma,void 0),Fe(this,Wi,new ArrayBuffer(2**16)),Fe(this,Nn,new Uint8Array(Y(this,Wi))),Fe(this,wn,0),pt(this,ma,i)}write(i){Je(this,ga,ws).call(this,this.pos+i.byteLength),Y(this,Nn).set(i,this.pos),this.pos+=i.byteLength,pt(this,wn,Math.max(Y(this,wn),this.pos))}finalize(){Je(this,ga,ws).call(this,this.pos),Y(this,ma).buffer=Y(this,Wi).slice(0,Math.max(Y(this,wn),this.pos))}};ma=new WeakMap;Wi=new WeakMap;Nn=new WeakMap;wn=new WeakMap;ga=new WeakSet;ws=function(i){let e=Y(this,Wi).byteLength;for(;e<i;)e*=2;if(e===Y(this,Wi).byteLength)return;let t=new ArrayBuffer(e),n=new Uint8Array(t);n.set(Y(this,Nn),0),pt(this,Wi,t),pt(this,Nn,n)};var vn,Pi,Hc=class extends js{constructor(i){super(),Fe(this,vn,void 0),Fe(this,Pi,[]),pt(this,vn,i)}write(i){Y(this,Pi).push({data:i.slice(),start:this.pos}),this.pos+=i.byteLength}flush(){if(Y(this,Pi).length===0)return;let i=[],e=[...Y(this,Pi)].sort((t,n)=>t.start-n.start);i.push({start:e[0].start,size:e[0].data.byteLength});for(let t=1;t<e.length;t++){let n=i[i.length-1],a=e[t];a.start<=n.start+n.size?n.size=Math.max(n.size,a.start+a.data.byteLength-n.start):i.push({start:a.start,size:a.data.byteLength})}for(let t of i){t.data=new Uint8Array(t.size);for(let n of Y(this,Pi))t.start<=n.start&&n.start<t.start+t.size&&t.data.set(n.data,n.start-t.start);Y(this,vn).onData(t.data,t.start)}Y(this,Pi).length=0}finalize(){Y(this,vn).onDone?.()}};vn=new WeakMap;Pi=new WeakMap;var Lh=2**24,Bh=2,Sn,Gt,Dt,Ca,vs,Ys,zc,Ks,Vc,Tn,Ea,Wc=class extends js{constructor(i){if(super(),Fe(this,Ca),Fe(this,Ys),Fe(this,Ks),Fe(this,Tn),Fe(this,Sn,void 0),Fe(this,Gt,void 0),Fe(this,Dt,[]),pt(this,Sn,i),pt(this,Gt,i.options?.chunkSize??Lh),!Number.isInteger(Y(this,Gt))||Y(this,Gt)<2**10)throw new Error("Invalid StreamTarget options: chunkSize must be an integer not smaller than 1024.")}write(i){Je(this,Ca,vs).call(this,i,this.pos),Je(this,Tn,Ea).call(this),this.pos+=i.byteLength}finalize(){Je(this,Tn,Ea).call(this,!0),Y(this,Sn).onDone?.()}};Sn=new WeakMap;Gt=new WeakMap;Dt=new WeakMap;Ca=new WeakSet;vs=function(i,e){let t=Y(this,Dt).findIndex(o=>o.start<=e&&e<o.start+Y(this,Gt));t===-1&&(t=Je(this,Ks,Vc).call(this,e));let n=Y(this,Dt)[t],a=e-n.start,r=i.subarray(0,Math.min(Y(this,Gt)-a,i.byteLength));n.data.set(r,a);let s={start:a,end:a+r.byteLength};if(Je(this,Ys,zc).call(this,n,s),n.written[0].start===0&&n.written[0].end===Y(this,Gt)&&(n.shouldFlush=!0),Y(this,Dt).length>Bh){for(let o=0;o<Y(this,Dt).length-1;o++)Y(this,Dt)[o].shouldFlush=!0;Je(this,Tn,Ea).call(this)}r.byteLength<i.byteLength&&Je(this,Ca,vs).call(this,i.subarray(r.byteLength),e+r.byteLength)};Ys=new WeakSet;zc=function(i,e){let t=0,n=i.written.length-1,a=-1;for(;t<=n;){let r=Math.floor(t+(n-t+1)/2);i.written[r].start<=e.start?(t=r+1,a=r):n=r-1}for(i.written.splice(a+1,0,e),(a===-1||i.written[a].end<e.start)&&a++;a<i.written.length-1&&i.written[a].end>=i.written[a+1].start;)i.written[a].end=Math.max(i.written[a].end,i.written[a+1].end),i.written.splice(a+1,1)};Ks=new WeakSet;Vc=function(i){let t={start:Math.floor(i/Y(this,Gt))*Y(this,Gt),data:new Uint8Array(Y(this,Gt)),written:[],shouldFlush:!1};return Y(this,Dt).push(t),Y(this,Dt).sort((n,a)=>n.start-a.start),Y(this,Dt).indexOf(t)};Tn=new WeakSet;Ea=function(i=!1){for(let e=0;e<Y(this,Dt).length;e++){let t=Y(this,Dt)[e];if(!(!t.shouldFlush&&!i)){for(let n of t.written)Y(this,Sn).onData(t.data.subarray(n.start,n.end),t.start+n.start);Y(this,Dt).splice(e--,1)}}};var Fh=class extends Wc{constructor(i){super(new Nc((e,t)=>i.stream.write({type:"write",data:e,position:t}),void 0,{chunkSize:i.options?.chunkSize}))}},xs=1e3,Ih=["avc","hevc","vp9","av1"],Rh=["aac","opus"],Ph=2082844800,Oh=.5,Nh=["strict","offset"],Ie,Ve,Aa,Mt,Ci,Ei,xn,Mn,Dn,_s,Uc,Cs,qc,Xs,Gc,Es,$c,Zs,jc,ba,As,Qs,Yc,Ln,ka,Hn,Wa,ya,ks,Hh=class{constructor(i){if(Fe(this,_s),Fe(this,Cs),Fe(this,Xs),Fe(this,Es),Fe(this,Zs),Fe(this,ba),Fe(this,Qs),Fe(this,Ln),Fe(this,Hn),Fe(this,ya),Fe(this,Ie,void 0),Fe(this,Ve,void 0),Fe(this,Aa,void 0),Fe(this,Mt,void 0),Fe(this,Ci,null),Fe(this,Ei,null),Fe(this,xn,Math.floor(Date.now()/1e3)+Ph),Fe(this,Mn,[]),Fe(this,Dn,!1),Je(this,_s,Uc).call(this,i),i.video=kn(i.video),i.audio=kn(i.audio),i.fastStart=kn(i.fastStart),this.target=i.target,pt(this,Ie,{firstTimestampBehavior:"strict",...i}),i.target instanceof Oc)pt(this,Ve,new Dh(i.target));else if(i.target instanceof Nc)pt(this,Ve,i.target.options?.chunked?new Wc(i.target):new Hc(i.target));else if(i.target instanceof Mh)pt(this,Ve,new Fh(i.target));else throw new Error(`Invalid target: ${i.target}`);Je(this,Cs,qc).call(this),Je(this,Es,$c).call(this)}addVideoChunk(i,e,t){let n=new Uint8Array(i.byteLength);i.copyTo(n),this.addVideoChunkRaw(n,i.type,t??i.timestamp,i.duration,e)}addVideoChunkRaw(i,e,t,n,a){if(Je(this,ya,ks).call(this),!Y(this,Ie).video)throw new Error("No video track declared.");if(typeof Y(this,Ie).fastStart=="object"&&Y(this,Ci).samples.length===Y(this,Ie).fastStart.expectedVideoChunks)throw new Error(`Cannot add more video chunks than specified in 'fastStart' (${Y(this,Ie).fastStart.expectedVideoChunks}).`);Je(this,ba,As).call(this,Y(this,Ci),i,e,t,n,a)}addAudioChunk(i,e,t){let n=new Uint8Array(i.byteLength);i.copyTo(n),this.addAudioChunkRaw(n,i.type,t??i.timestamp,i.duration,e)}addAudioChunkRaw(i,e,t,n,a){if(Je(this,ya,ks).call(this),!Y(this,Ie).audio)throw new Error("No audio track declared.");if(typeof Y(this,Ie).fastStart=="object"&&Y(this,Ei).samples.length===Y(this,Ie).fastStart.expectedAudioChunks)throw new Error(`Cannot add more audio chunks than specified in 'fastStart' (${Y(this,Ie).fastStart.expectedAudioChunks}).`);Je(this,ba,As).call(this,Y(this,Ei),i,e,t,n,a)}finalize(){if(Y(this,Dn))throw new Error("Cannot finalize a muxer more than once.");Y(this,Ci)&&Je(this,Ln,ka).call(this,Y(this,Ci)),Y(this,Ei)&&Je(this,Ln,ka).call(this,Y(this,Ei));let i=[Y(this,Ci),Y(this,Ei)].filter(Boolean);if(Y(this,Ie).fastStart==="in-memory"){let e;for(let n=0;n<2;n++){let a=Ur(i,Y(this,xn)),r=Y(this,Ve).measureBox(a);e=Y(this,Ve).measureBox(Y(this,Mt));let s=Y(this,Ve).pos+r+e;for(let o of Y(this,Mn)){o.offset=s;for(let l of o.sampleData)s+=l.byteLength,e+=l.byteLength}if(s<2**32)break;e>=2**32&&(Y(this,Mt).largeSize=!0)}let t=Ur(i,Y(this,xn));Y(this,Ve).writeBox(t),Y(this,Mt).size=e,Y(this,Ve).writeBox(Y(this,Mt));for(let n of Y(this,Mn)){for(let a of n.sampleData)Y(this,Ve).write(a);n.sampleData=null}}else{let e=Y(this,Ve).offsets.get(Y(this,Mt)),t=Y(this,Ve).pos-e;Y(this,Mt).size=t,Y(this,Mt).largeSize=t>=2**32,Y(this,Ve).patchBox(Y(this,Mt));let n=Ur(i,Y(this,xn));if(typeof Y(this,Ie).fastStart=="object"){Y(this,Ve).seek(Y(this,Aa)),Y(this,Ve).writeBox(n);let a=e-Y(this,Ve).pos;Y(this,Ve).writeBox(Zd(a))}else Y(this,Ve).writeBox(n)}Je(this,Hn,Wa).call(this),Y(this,Ve).finalize(),pt(this,Dn,!0)}};Ie=new WeakMap;Ve=new WeakMap;Aa=new WeakMap;Mt=new WeakMap;Ci=new WeakMap;Ei=new WeakMap;xn=new WeakMap;Mn=new WeakMap;Dn=new WeakMap;_s=new WeakSet;Uc=function(i){if(i.video){if(!Ih.includes(i.video.codec))throw new Error(`Unsupported video codec: ${i.video.codec}`);if(i.video.rotation!==void 0&&![0,90,180,270].includes(i.video.rotation))throw new Error(`Invalid video rotation: ${i.video.rotation}. Has to be 0, 90, 180 or 270.`)}if(i.audio&&!Rh.includes(i.audio.codec))throw new Error(`Unsupported audio codec: ${i.audio.codec}`);if(i.firstTimestampBehavior&&!Nh.includes(i.firstTimestampBehavior))throw new Error(`Invalid first timestamp behavior: ${i.firstTimestampBehavior}`);if(typeof i.fastStart=="object"){if(i.video&&i.fastStart.expectedVideoChunks===void 0)throw new Error("'fastStart' is an object but is missing property 'expectedVideoChunks'.");if(i.audio&&i.fastStart.expectedAudioChunks===void 0)throw new Error("'fastStart' is an object but is missing property 'expectedAudioChunks'.")}else if(![!1,"in-memory"].includes(i.fastStart))throw new Error("'fastStart' option must be false, 'in-memory' or an object.")};Cs=new WeakSet;qc=function(){let i=Y(this,Ie).video?.codec==="hevc";if(Y(this,Ve).writeBox(Xd(i)),pt(this,Aa,Y(this,Ve).pos),Y(this,Ie).fastStart==="in-memory")pt(this,Mt,_l(!1));else{if(typeof Y(this,Ie).fastStart=="object"){let e=Je(this,Xs,Gc).call(this);Y(this,Ve).seek(Y(this,Ve).pos+e)}pt(this,Mt,_l(!0)),Y(this,Ve).writeBox(Y(this,Mt))}Je(this,Hn,Wa).call(this)};Xs=new WeakSet;Gc=function(){if(typeof Y(this,Ie).fastStart!="object")return;let i=0,e=[Y(this,Ie).fastStart.expectedVideoChunks,Y(this,Ie).fastStart.expectedAudioChunks];for(let t of e)t&&(i+=8*Math.ceil(2/3*t),i+=4*t,i+=12*Math.ceil(2/3*t),i+=4*t,i+=8*t);return i+=4096,i};Es=new WeakSet;$c=function(){if(Y(this,Ie).video&&pt(this,Ci,{id:1,info:{type:"video",codec:Y(this,Ie).video.codec,width:Y(this,Ie).video.width,height:Y(this,Ie).video.height,rotation:Y(this,Ie).video.rotation??0},timescale:720,codecPrivate:new Uint8Array(0),samples:[],finalizedChunks:[],currentChunk:null,firstTimestamp:void 0,lastTimestamp:-1,timeToSampleTable:[],lastTimescaleUnits:null,compactlyCodedChunkTable:[]}),Y(this,Ie).audio){let i=Je(this,Zs,jc).call(this,2,Y(this,Ie).audio.sampleRate,Y(this,Ie).audio.numberOfChannels);pt(this,Ei,{id:Y(this,Ie).video?2:1,info:{type:"audio",codec:Y(this,Ie).audio.codec,numberOfChannels:Y(this,Ie).audio.numberOfChannels,sampleRate:Y(this,Ie).audio.sampleRate},timescale:Y(this,Ie).audio.sampleRate,codecPrivate:i,samples:[],finalizedChunks:[],currentChunk:null,firstTimestamp:void 0,lastTimestamp:-1,timeToSampleTable:[],lastTimescaleUnits:null,compactlyCodedChunkTable:[]})}};Zs=new WeakSet;jc=function(i,e,t){let a=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350].indexOf(e),r=t,s="";s+=i.toString(2).padStart(5,"0"),s+=a.toString(2).padStart(4,"0"),a===15&&(s+=e.toString(2).padStart(24,"0")),s+=r.toString(2).padStart(4,"0");let o=Math.ceil(s.length/8)*8;s=s.padEnd(o,"0");let l=new Uint8Array(s.length/8);for(let u=0;u<s.length;u+=8)l[u/8]=parseInt(s.slice(u,u+8),2);return l};ba=new WeakSet;As=function(i,e,t,n,a,r){let s=n/1e6,o=a/1e6;if(i.firstTimestamp===void 0&&(i.firstTimestamp=s),s=Je(this,Qs,Yc).call(this,s,i),i.lastTimestamp=s,(!i.currentChunk||s-i.currentChunk.startTimestamp>=Oh)&&(i.currentChunk&&Je(this,Ln,ka).call(this,i),i.currentChunk={startTimestamp:s,sampleData:[],sampleCount:0}),i.currentChunk.sampleData.push(e),i.currentChunk.sampleCount++,r?.decoderConfig?.description&&(i.codecPrivate=new Uint8Array(r.decoderConfig.description)),i.samples.push({timestamp:s,duration:o,size:e.byteLength,type:t}),i.lastTimescaleUnits!==null){let l=On(s,i.timescale,!1),u=Math.round(l-i.lastTimescaleUnits);i.lastTimescaleUnits+=u;let f=$i(i.timeToSampleTable);f.sampleCount===1?(f.sampleDelta=u,f.sampleCount++):f.sampleDelta===u?f.sampleCount++:(f.sampleCount--,i.timeToSampleTable.push({sampleCount:2,sampleDelta:u}))}else i.lastTimescaleUnits=0,i.timeToSampleTable.push({sampleCount:1,sampleDelta:On(o,i.timescale)})};Qs=new WeakSet;Yc=function(i,e){if(Y(this,Ie).firstTimestampBehavior==="strict"&&e.lastTimestamp===-1&&i!==0)throw new Error(`The first chunk for your media track must have a timestamp of 0 (received ${i}). Non-zero first timestamps are often caused by directly piping frames or audio data from a MediaStreamTrack into the encoder. Their timestamps are typically relative to the age of the document, which is probably what you want.

If you want to offset all timestamps of a track such that the first one is zero, set firstTimestampBehavior: 'offset' in the options.
`);if(Y(this,Ie).firstTimestampBehavior==="offset"&&(i-=e.firstTimestamp),i<e.lastTimestamp)throw new Error(`Timestamps must be monotonically increasing (went from ${e.lastTimestamp*1e6} to ${i*1e6}).`);return i};Ln=new WeakSet;ka=function(i){if(i.currentChunk){if((i.compactlyCodedChunkTable.length===0||$i(i.compactlyCodedChunkTable).samplesPerChunk!==i.currentChunk.sampleCount)&&i.compactlyCodedChunkTable.push({firstChunk:i.finalizedChunks.length+1,samplesPerChunk:i.currentChunk.sampleCount}),i.finalizedChunks.push(i.currentChunk),Y(this,Mn).push(i.currentChunk),Y(this,Ie).fastStart==="in-memory"){i.currentChunk.offset=0;return}i.currentChunk.offset=Y(this,Ve).pos;for(let e of i.currentChunk.sampleData)Y(this,Ve).write(e);i.currentChunk.sampleData=null,Je(this,Hn,Wa).call(this)}};Hn=new WeakSet;Wa=function(){Y(this,Ve)instanceof Hc&&Y(this,Ve).flush()};ya=new WeakSet;ks=function(){if(Y(this,Dn))throw new Error("Cannot add new video or audio chunks after the file has been finalized.")};class zh{app;options;encoder;ac;muxer;recording=!1;renderInterval;cachedBarlines;_currentFrame=0;blob;totalFrames;constructor(e,t){this.options={aspectRatio:4/3,videoHeight:1080,fps:60,bitrate:4e7,playbackRate:1,assistTick:!1,metronome:!1,hideBarlines:!1,startTime:0,endTime:10,...t},this.app=e,this.muxer=new Hh({target:new Oc,video:{codec:"avc",width:Math.round(this.options.videoHeight*this.options.aspectRatio/2)*2,height:this.options.videoHeight},audio:{codec:"aac",numberOfChannels:this.app.chartManager.chartAudio.getBuffer().numberOfChannels,sampleRate:this.app.chartManager.chartAudio.getSampleRate()},fastStart:"in-memory"}),this.encoder=new VideoEncoder({output:(n,a)=>void this.muxer.addVideoChunk(n,a),error:n=>{throw n}}),this.encoder.configure({codec:"avc1.420028",width:Math.round(this.options.videoHeight*this.options.aspectRatio/2)*2,height:this.options.videoHeight,bitrate:this.options.bitrate,hardwareAcceleration:"prefer-hardware",framerate:this.options.fps}),this.ac=new AudioEncoder({output:(n,a)=>void this.muxer.addAudioChunk(n,a),error:n=>{throw n}}),this.ac.configure({codec:"mp4a.40.2",bitrate:192e3,numberOfChannels:this.app.chartManager.chartAudio.getBuffer().numberOfChannels,sampleRate:this.app.chartManager.chartAudio.getSampleRate()}),this.totalFrames=Math.ceil((this.options.endTime-this.options.startTime)*this.options.fps),this.cachedBarlines=he.barlines}async renderBufferWithModifications(e,t){const n=new OfflineAudioContext(e.numberOfChannels,Math.ceil(e.duration*t.sampleRate/t.rate),t.sampleRate),a=n.createGain();a.gain.setValueAtTime(t.volume,0);const r=n.createBufferSource();r.buffer=e,r.playbackRate.setValueAtTime(t.rate,0),r.connect(a),a.connect(n.destination),r.start();const s=await n.startRendering();return r.stop(),s}async createAssistSounds(e,t,n,a){const r=new AudioBuffer({length:Math.ceil((t-e)*n/a),sampleRate:n,numberOfChannels:2}),s=this.app.chartManager.loadedChart,o=s.getBeatFromSeconds(e),l=s.getBeatFromSeconds(t),u=s.getNotedataInRange(o,l);if(this.options.assistTick){let f=this.app.chartManager.assistTick.getBuffer();f=await this.renderBufferWithModifications(f,{volume:y.audio.soundEffectVolume*y.audio.masterVolume,sampleRate:n,rate:1});let c=-1;for(const d of u)if(d.beat!=c&&(c=d.beat,s.gameType.gameLogic.shouldAssistTick(d))){const h=Math.floor((d.second-e)*n/a);for(let p=0;p<r.numberOfChannels;p++){const m=r.getChannelData(p);for(let g=0;g<f.length&&!(h+g>=m.length);g++)m[h+g]+=f.getChannelData(p%f.numberOfChannels)[g]}}}if(this.options.metronome){let f=this.app.chartManager.me_high.getBuffer();f=await this.renderBufferWithModifications(f,{volume:y.audio.soundEffectVolume*y.audio.masterVolume,sampleRate:n,rate:1});let c=this.app.chartManager.me_low.getBuffer();c=await this.renderBufferWithModifications(c,{volume:y.audio.soundEffectVolume*y.audio.masterVolume,sampleRate:n,rate:1});let d=null;for(const[h,p]of s.timingData.getMeasureBeats(o,l)){const m=s.timingData.getSecondsFromBeat(h);if(d!==null&&m==d)continue;d=m;const g=p?f:c,b=Math.floor((m-e)*n/a);for(let x=0;x<r.numberOfChannels;x++){const v=r.getChannelData(x);for(let C=0;C<g.length&&!(b+C>=v.length);C++)v[b+C]+=g.getChannelData(x%g.numberOfChannels)[C]}}}return r}async start(){console.time("capture");const e=this.app.chartManager.loadedChart;document.body.classList.remove("animated"),this.app.chartManager.setMode($.View),he.barlines=!this.options.hideBarlines,this.app.capturing=!0,this.app.chartManager.chartAudio.isPlaying()&&this.app.chartManager.playPause(),this.options.endTime===void 0&&(this.options.endTime=this.app.chartManager.loadedChart?.getLastSecond()??this.app.chartManager.chartAudio.getBuffer().length/this.app.chartManager.chartAudio.getBuffer().sampleRate),this._currentFrame=0,this.app.onResize(this.options.videoHeight*this.options.aspectRatio,this.options.videoHeight),this.app.view.style.width=window.innerWidth+"px",this.app.view.style.height=window.innerHeight+"px",At.shared.stop();let t=this.app.chartManager.chartAudio.getBuffer();const n=Math.floor(this.options.startTime*t.sampleRate),a=Math.ceil(this.options.endTime*t.sampleRate),r=a-n,s=new AudioBuffer({length:r,sampleRate:t.sampleRate,numberOfChannels:t.numberOfChannels});for(let f=0;f<t.numberOfChannels;f++){const c=t.getChannelData(f);s.copyToChannel(c.subarray(Math.max(0,n),a),f,Math.max(0,-n))}t=await this.renderBufferWithModifications(s,{volume:y.audio.songVolume*y.audio.masterVolume,sampleRate:s.sampleRate,rate:this.options.playbackRate});let o=0;o=qt(e.getNotedata(),this.options.startTime,f=>f.second)+1,o>=1&&this.options.startTime<=e.getNotedata()[o-1].second&&o--;let l=[];const u=await this.createAssistSounds(this.options.startTime,this.options.endTime,t.sampleRate,this.options.playbackRate);return new Promise(f=>{this.recording=!0,this.renderInterval=setInterval(()=>{if(this.recording&&this.encoder.encodeQueueSize<300){const c=this._currentFrame/this.options.fps*this.options.playbackRate+this.options.startTime;if(c>this.options.endTime){f(this.stop());return}this.app.chartManager.time=c;const d=e.getNotedata();for(;o<d.length&&c>d[o].second;){const C=d[o];e.gameType.gameLogic.shouldAssistTick(C)&&(this.app.chartManager.chartView.doJudgement(C,0,Ps),Re(C)&&(C.type=="Hold"?this.app.chartManager.chartView.getNotefield().activateHold(C.col):C.type=="Roll"&&this.app.chartManager.chartView.getNotefield().activateRoll(C.col),l.push(C))),o++}l=l.filter(C=>this.app.chartManager.beat<C.beat+C.hold?!0:(C.type=="Hold"&&this.app.chartManager.chartView.getNotefield().releaseHold(C.col),C.type=="Roll"&&this.app.chartManager.chartView.getNotefield().releaseRoll(C.col),this.app.chartManager.chartView.doJudgement(C,null,wt.getCollection(y.play.timingCollection).getHeldJudgement(C)),!1)),At.shared.update(At.shared.lastTime+1e3/this.options.fps),this.app.renderer.render(this.app.stage);const h=new VideoFrame(this.app.view,{timestamp:this._currentFrame/this.options.fps*1e6}),p=(c-this.options.startTime)/this.options.playbackRate,m=Math.floor(p*t.sampleRate),g=Math.ceil((p+1/this.options.fps)*t.sampleRate),b=g-m,x=new Float32Array(b*t.numberOfChannels);for(let C=0;C<t.numberOfChannels;C++){const E=t.getChannelData(C);if(x.set(E.subarray(m,g),C*b),this.options.metronome||this.options.assistTick){const R=u.getChannelData(C);for(let O=m;O<g&&!(O>=R.length);O++)x[C*b+O-m]+=R[O]}}const v=new AudioData({data:x,format:"f32-planar",numberOfChannels:t.numberOfChannels,numberOfFrames:b,sampleRate:t.sampleRate,timestamp:this._currentFrame/this.options.fps*1e6});this._currentFrame+=1,this.encoder.encode(h),this.ac.encode(v),v.close(),this.options.updateCallback?.({currentRenderFrame:this._currentFrame,currentEncodeQueue:this.encoder.encodeQueueSize,totalFrames:this.totalFrames,currentVideoFrame:h}),h.close()}},10)})}async stop(){clearInterval(this.renderInterval),At.shared.start(),this.app.chartManager.setMode($.Edit),this.app.updateSize(),this.recording=!1,this.app.capturing=!1,he.barlines=this.cachedBarlines;const e=setInterval(()=>{this.options.updateCallback?.({currentRenderFrame:this.totalFrames,currentEncodeQueue:this.encoder.encodeQueueSize,totalFrames:this.totalFrames,currentVideoFrame:null})},100);await this.encoder?.flush(),await this.ac?.flush(),this.muxer.finalize(),clearInterval(e);const{buffer:t}=this.muxer.target,n=new Blob([t],{type:"video/mp4"});this.blob=n;const a=URL.createObjectURL(n);return y.general.smoothAnimations&&document.body.classList.add("animated"),console.timeEnd("capture"),this.options.onFinish?.(a),a}get currentRenderFrame(){return this._currentFrame}get currentEncodeQueue(){return this.encoder.encodeQueueSize}get size(){return this.blob?this.blob.size:0}}const ki={"dance-single":[{label:"Left",keys:["Left","A"]},{label:"Down",keys:["Down","S"]},{label:"Up",keys:["Up","W"]},{label:"Right",keys:["Right","D"]}],"dance-double":[{label:"P1 Left",keys:["Left"]},{label:"P1 Down",keys:["Down"]},{label:"P1 Up",keys:["Up"]},{label:"P1 Right",keys:["Right"]},{label:"P2 Left",keys:["A"]},{label:"P2 Down",keys:["S"]},{label:"P2 Up",keys:["W"]},{label:"P2 Right",keys:["D"]}],"dance-couple":[{label:"P1 Left",keys:["Left"]},{label:"P1 Down",keys:["Down"]},{label:"P1 Up",keys:["Up"]},{label:"P1 Right",keys:["Right"]},{label:"P2 Left",keys:["A"]},{label:"P2 Down",keys:["S"]},{label:"P2 Up",keys:["W"]},{label:"P2 Right",keys:["D"]}],"dance-solo":[{label:"Left",keys:["Left","A"]},{label:"UpLeft",keys:["Q"]},{label:"Down",keys:["Down","S"]},{label:"Up",keys:["Up","W"]},{label:"UpRight",keys:["E"]},{label:"Right",keys:["Right","D"]}],"dance-solodouble":[{label:"P1 Left",keys:["A"]},{label:"P1 UpLeft",keys:["Q"]},{label:"P1 Down",keys:["S"]},{label:"P1 Up",keys:["W"]},{label:"P1 UpRight",keys:["E"]},{label:"P1 Right",keys:["D"]},{label:"P2 Left",keys:["J"]},{label:"P2 UpLeft",keys:["U"]},{label:"P2 Down",keys:["K"]},{label:"P2 Up",keys:["I"]},{label:"P2 UpRight",keys:["O"]},{label:"P2 Right",keys:["L"]}],"dance-threepanel":[{label:"UpLeft",keys:["Left","Q"]},{label:"Down",keys:["Down","S"]},{label:"UpRight",keys:["Right","E"]}],"dance-threedouble":[{label:"P1 UpLeft",keys:["Left"]},{label:"P1 Down",keys:["Down"]},{label:"P1 UpRight",keys:["Right"]},{label:"P2 UpLeft",keys:["Q"]},{label:"P2 Down",keys:["S"]},{label:"P2 UpRight",keys:["E"]}],"pump-single":[{label:"DownLeft",keys:["Z"]},{label:"UpLeft",keys:["Q"]},{label:"Center",keys:["S"]},{label:"UpRight",keys:["E"]},{label:"DownRight",keys:["C"]}],"pump-double":[{label:"P1 DownLeft",keys:["Z"]},{label:"P1 UpLeft",keys:["Q"]},{label:"P1 Center",keys:["S"]},{label:"P1 UpRight",keys:["E"]},{label:"P1 DownRight",keys:["C"]},{label:"P2 DownLeft",keys:["V"]},{label:"P2 UpLeft",keys:["R"]},{label:"P2 Center",keys:["G"]},{label:"P2 UpRight",keys:["Y"]},{label:"P2 DownRight",keys:["N"]}],"pump-versus":[{label:"P1 DownLeft",keys:["Z"]},{label:"P1 UpLeft",keys:["Q"]},{label:"P1 Center",keys:["S"]},{label:"P1 UpRight",keys:["E"]},{label:"P1 DownRight",keys:["C"]},{label:"P2 DownLeft",keys:["V"]},{label:"P2 UpLeft",keys:["R"]},{label:"P2 Center",keys:["G"]},{label:"P2 UpRight",keys:["Y"]},{label:"P2 DownRight",keys:["N"]}],"pump-couple":[{label:"P1 DownLeft",keys:["Z"]},{label:"P1 UpLeft",keys:["Q"]},{label:"P1 Center",keys:["S"]},{label:"P1 UpRight",keys:["E"]},{label:"P1 DownRight",keys:["C"]},{label:"P2 DownLeft",keys:["V"]},{label:"P2 UpLeft",keys:["R"]},{label:"P2 Center",keys:["G"]},{label:"P2 UpRight",keys:["Y"]},{label:"P2 DownRight",keys:["N"]}],"pump-halfdouble":[{label:"P1 Center",keys:["S"]},{label:"P1 UpRight",keys:["E"]},{label:"P1 DownRight",keys:["C"]},{label:"P2 DownLeft",keys:["V"]},{label:"P2 UpLeft",keys:["R"]},{label:"P2 Center",keys:["G"]}]};class ve{static app;static userKeybinds=new Map;static userGameplayKeybinds=new Map;static enabled=!0;static load(e){this.app=e;try{this.loadKeybinds()}catch(t){console.error("Failed to load user keybinds!"),console.error(t.stack),this.userKeybinds.clear(),this.userGameplayKeybinds.clear()}window.addEventListener("keydown",t=>this.checkKey(t,"keydown")),window.addEventListener("keyup",t=>this.checkKey(t,"keyup"))}static checkKey(e,t){if(!this.enabled||e.target.classList.contains("inlineEdit")||e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement||e.target instanceof HTMLButtonElement||["Meta","Control","Shift","Alt"].includes(e.key))return;const n=[];for(let s=0;s<Fa.length;s++)e[Fa[s]]&&n.push(va[s]);const a=ve.getKeyNameFromEvent(e);if((this.app.chartManager.getMode()==$.Play||this.app.chartManager.getMode()==$.Record)&&this.app.chartManager.loadedChart?.gameType&&!e.repeat){const s=ki[this.app.chartManager.loadedChart?.gameType.id]??[],o=this.userGameplayKeybinds.get(this.app.chartManager.loadedChart?.gameType.id)??[],l=Object.values(s).findIndex((u,f)=>(o[f]??u.keys).some(c=>a==c));if(l!=-1){if(e.preventDefault(),this.app.windowManager.getFocusedWindow()?.options?.win_id=="keybind_options"||this.app.windowManager.isBlocked())return;this.app.chartManager[t=="keydown"?"judgeCol":"judgeColUp"](l);return}}const r=Object.keys($e).filter(s=>!["cut","copy","paste","pasteReplace"].includes(s)).filter(s=>{for(const o of this.getCombosForKeybind(s))if(this.compareModifiers(o.mods,n)&&o.key==a)return!0;return!1}).map(s=>$e[s]);if(r.length>0){if(r.every(s=>s.preventDefault!=!1)&&e.preventDefault(),this.app.windowManager.getFocusedWindow()?.options?.win_id=="keybind_options"||this.app.windowManager.isBlocked())return;for(const s of r){let o=s.disabled;if(o instanceof Function&&(o=o(this.app)),!o&&!(s.disableRepeat&&e.repeat)){t=="keydown"?s.callback(this.app):s.callbackKeyUp?.(this.app);return}}}}static getKeyNameFromEvent(e){if(e.which>=65&&e.which<=90)return String.fromCharCode(e.which).toUpperCase();let t=e.code;return t.startsWith("Digit")&&(t=t.slice(5)),t.startsWith("Key")&&(t=t.slice(3)),t in cc&&(t=cc[t]),t}static getKeybindString(e){return this.getCombosForKeybind(e).map(t=>this.getComboString(t)).join(" / ")}static getComboString(e){const t=va.filter(n=>e.mods.includes(n)).map(n=>um[n]).join("");return t+(t!=""?" ":"")+(Fu[e.key]??e.key)}static getCombosForKeybind(e){return e in $e?this.userKeybinds.get(e)??$e[e].combos:(console.log("Couldn't find keybind with id "+e),[])}static getKeysForGameType(e){const t=ft.getGameType(e);return t?new Array(t.numCols).fill(null).map((n,a)=>this.userGameplayKeybinds.get(e)?.[a]??ki[e]?.[a].keys??[]):(console.log("Couldn't find game type with id "+e),[])}static compareModifiers(e,t){if(e.length!=t.length)return!1;for(const n of va)if((e.includes(n)?1:0)+(t.includes(n)?1:0)==1)return!1;return!0}static compareCombos(e,t){return e.key==t.key&&this.compareModifiers(e.mods,t.mods)}static loadKeybinds(){const e=localStorage.getItem("keybinds");if(e){const n=JSON.parse(e);if(typeof n!="object")return console.error("Couldn't load keybinds from storage");for(const[a,r]of Object.entries(n)){if(!(a in $e)){console.warn("Couldn't load keybind "+a+": key doesn't exist");continue}Array.isArray(r)||console.warn("Couldn't load keybind "+a+": value is not an array"),this.userKeybinds.set(a,r.filter(s=>typeof s.key!="string"||!Array.isArray(s.mods)?(console.warn("Couldn't load keycombo for keybind "+a+": "+JSON.stringify(s)),!1):!0))}}const t=localStorage.getItem("keybindsGP");if(t){const n=JSON.parse(t);if(typeof n!="object")return console.error("Couldn't load gameplay keybinds from storage");for(const[a,r]of Object.entries(n)){if(!ft.getGameType(a)){console.warn("Couldn't load gameplay keybinds for gameType "+a+": gameType doesn't exist");continue}Array.isArray(r)||console.warn("Couldn't load gameplay keybind "+a+": value is not an array"),this.userGameplayKeybinds.set(a,r.map((s,o)=>!Array.isArray(s)&&s!==null?(console.warn("Couldn't load gameplay keys for type "+a+" col "+o+": "+JSON.stringify(s)),null):s))}}}static clearSave(){localStorage.removeItem("keybinds"),localStorage.removeItem("keybindsGP")}static setKeybind(e,t){this.userKeybinds.has(e)||this.userKeybinds.set(e,[...$e[e].combos]),this.userKeybinds.get(e)?.push(t),this.checkIsDefault(e),this.saveKeybinds()}static removeKeybind(e,t){this.userKeybinds.has(e)||this.userKeybinds.set(e,[...$e[e].combos]),this.userKeybinds.set(e,this.userKeybinds.get(e).filter(n=>!this.compareCombos(n,t))),this.checkIsDefault(e),this.saveKeybinds()}static revertKeybind(e){this.userKeybinds.delete(e),this.saveKeybinds()}static revertGameplayKeybind(e,t){this.userGameplayKeybinds.has(e)&&(this.userGameplayKeybinds.get(e)[t]=null,this.userGameplayKeybinds.get(e).every(n=>n===null)&&this.userGameplayKeybinds.delete(e)),this.saveKeybinds()}static setGameplayKeybind(e,t,n){this.userGameplayKeybinds.has(e)||this.userGameplayKeybinds.set(e,new Array(ft.getGameType(e).numCols).fill(null)),this.userGameplayKeybinds.get(e)[t]==null&&(this.userGameplayKeybinds.get(e)[t]=[...ki[e]?.[t].keys??[]]),this.userGameplayKeybinds.get(e)[t].push(n),this.checkIsDefaultGameplay(e,t),this.saveKeybinds()}static removeGameplayKeybind(e,t,n){this.userGameplayKeybinds.has(e)||this.userGameplayKeybinds.set(e,new Array(ft.getGameType(e).numCols).fill(null)),this.userGameplayKeybinds.get(e)[t]==null&&(this.userGameplayKeybinds.get(e)[t]=[...ki[e]?.[t].keys??[]]),this.userGameplayKeybinds.get(e)[t]=this.userGameplayKeybinds.get(e)[t].filter(a=>a!=n),this.checkIsDefaultGameplay(e,t),this.saveKeybinds()}static checkIsDefault(e){if(!this.userKeybinds.has(e))return!0;const t=this.userKeybinds.get(e),n=[...$e[e].combos];return t.length!=n.length?!1:t.map(a=>this.getComboString(a)).sort().join("∆")==n.map(a=>this.getComboString(a)).sort().join("∆")?(this.userKeybinds.delete(e),!0):!1}static checkIsDefaultGameplay(e,t){if(!this.userGameplayKeybinds.has(e)||this.userGameplayKeybinds.get(e)[t]===null)return!0;const n=this.userGameplayKeybinds.get(e)[t],a=[...ki[e]?.[t].keys??[]];return n.length!=a.length?!1:n.sort().join("∆")==a.sort().join("∆")?(this.userGameplayKeybinds.get(e)[t]=null,this.userGameplayKeybinds.get(e).every(r=>r===null)&&this.userGameplayKeybinds.delete(e),!0):!1}static saveKeybinds(){const e={};for(const[n,a]of this.userKeybinds.entries())e[n]=a;localStorage.setItem("keybinds",JSON.stringify(e));const t={};for(const[n,a]of this.userGameplayKeybinds.entries())t[n]=a;localStorage.setItem("keybindsGP",JSON.stringify(t))}static getKeybindTooltip(e){return this.getCombosForKeybind(e).map(n=>{let a=this.getComboString(n);return a==""?"":(a=a.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"),"<button class='pref-keybind-combo'>"+a+"</button>")}).join("")}static evaluateTaggedTooltip(e,t){t=t.map(a=>a.startsWith("\\")?a.slice(1):this.getKeybindTooltip(a));const n=[];for(let a=0;a<t.length;a++)n.push(e[a]),n.push(t[a]);return n.push(e[t.length+1]),"<div style='display: flex; align-items: center; gap: 0.375rem'>"+n.join("")+"</div>"}static createKeybindTooltip(e){return(t,...n)=>{Ke(e,{allowHTML:!0,onShow:a=>{a.setContent(this.evaluateTaggedTooltip(t,n))}})}}static disableKeybinds(){this.enabled=!1}static enableKeybinds(){this.enabled=!0}}class lt{view;input;options;lastVal="";constructor(e,t){this.view=e,this.view.classList.add("spinner"),this.options={value:0,precision:3,step:null,minPrecision:null,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,...t},this.view.onfocus=()=>{n.focus()};const n=document.createElement("input");n.classList.add("spinner-input"),n.type="text",n.autocomplete="off",n.spellcheck=!1,n.onblur=()=>{if(n.value===this.lastVal)return;if(n.value===""){this.options.onchange?.(void 0);return}const o=In(n.value);if(o===null){n.value=this.lastVal;return}const l=ue(Ae(o,this.options.min,this.options.max),this.options.precision);n.value=this.formatValue(l),this.options.onchange?.(l)},n.onkeydown=o=>{o.key=="Enter"&&n.blur(),o.key=="Escape"&&(n.value=this.lastVal,n.blur())},n.onfocus=()=>{this.lastVal=n.value},this.input=n,this.value=this.options.value,e.appendChild(n);const a=document.createElement("div");a.classList.add("spinner-btns"),e.appendChild(a);const r=document.createElement("button");r.classList.add("spinner-up"),r.appendChild(pe.getIcon("CHEVRON",10)),r.tabIndex=-1,r.onclick=o=>{let l=this.options.step??y.general.spinnerStep;if(o.getModifierState("Shift")&&(l/=10),parseFloat(n.value)+l>this.options.max){n.value=this.formatValue(this.options.max),this.options.onchange?.(this.options.max);return}n.value=this.formatValue(parseFloat(n.value)+l),this.options.onchange?.(parseFloat(n.value))},a.appendChild(r);const s=document.createElement("button");s.classList.add("spinner-down"),s.appendChild(pe.getIcon("CHEVRON",10)),s.tabIndex=-1,s.onclick=o=>{let l=this.options.step??y.general.spinnerStep;if(o.getModifierState("Shift")&&(l/=10),parseFloat(n.value)-l<this.options.min){n.value=this.formatValue(this.options.min),this.options.onchange?.(this.options.min);return}n.value=this.formatValue(parseFloat(n.value)-l),this.options.onchange?.(parseFloat(n.value))},a.appendChild(s)}static create(e){return new lt(document.createElement("div"),e)}formatValue(e){const t=e.toString().split(".")[1]?.length??0;return this.options.minPrecision!==null&&this.options.minPrecision>=t?ue(e,this.options.minPrecision).toFixed(this.options.minPrecision):this.options.minPrecision!==null&&this.options.precision>=t?e.toString():ue(e,this.options.precision).toFixed(this.options.precision)}get value(){return parseFloat(this.input.value)}set value(e){parseFloat(this.input.value)!=ue(e,this.options.precision)&&(this.input.value=this.formatValue(e))}get step(){return this.options.step}set step(e){this.options.step=e}get min(){return this.options.min}set min(e){this.options.min=e}get max(){return this.options.max}set max(e){this.options.max=e}get precision(){return this.options.precision}set precision(e){this.options.precision=e}get minPrecision(){return this.options.minPrecision}set minPrecision(e){this.options.minPrecision=e}get onchange(){return this.options.onchange}set onchange(e){this.options.onchange=e}get disabled(){return this.input.disabled}set disabled(e){this.input.disabled=e}}const Cl=["accent-color","editor-bg","widget-bg","editable-overlay-hover","editable-overlay-active","text-color","text-color-secondary","text-color-detail","text-color-disabled","primary-bg","primary-border","primary-bg-active","primary-bg-hover","secondary-bg","secondary-border","secondary-bg-active","secondary-bg-hover","tooltip-bg","input-bg","input-bg-active","input-bg-hover","input-border","navbar-bg","navbar-bg-inactive","window-bg","window-border"],Vh=["primary-bg","secondary-bg","text-color","accent-color","widget-bg","editor-bg","editable-overlay-active","input-bg","window-bg"],Wh=[{name:"primary-bg",ids:[{id:"primary-bg",label:"base"},{id:"primary-bg-active",label:"active"},{id:"primary-bg-hover",label:"hover"},{id:"primary-border",label:"border"}]},{name:"secondary-bg",ids:[{id:"secondary-bg",label:"base"},{id:"secondary-bg-active",label:"active"},{id:"secondary-bg-hover",label:"hover"},{id:"secondary-border",label:"border"}]},{name:"text-color",ids:[{id:"text-color",label:"primary"},{id:"text-color-secondary",label:"secondary"},{id:"text-color-detail",label:"detail"},{id:"text-color-disabled",label:"disabled"}]},{name:"other",ids:[{id:"accent-color",label:"accent-color"},{id:"widget-bg",label:"widget-bg"},{id:"tooltip-bg",label:"tooltip-bg"},{id:"editor-bg",label:"editor-bg"}]},{name:"editable-overlay",ids:[{id:"editable-overlay-hover",label:"hover"},{id:"editable-overlay-active",label:"active"}]},{name:"input",ids:[{id:"input-bg",label:"background"},{id:"input-bg-active",label:"active"},{id:"input-bg-hover",label:"hover"},{id:"input-border",label:"border"}]},{name:"window",ids:[{id:"window-bg",label:"background"},{id:"window-border",label:"border"}]},{name:"window-navbar",ids:[{id:"navbar-bg",label:"active"},{id:"navbar-bg-inactive",label:"inactive"}]}],El={"accent-color":"Color used for focus input rings, confirm buttons","text-color":"Base text color","text-color-secondary":"Secondary text color, used for text in recent files, menubar keybinds","text-color-detail":"Detail text color, used for text in timing event boxes","text-color-disabled":"Used for texts relating to empty/disabled things (ex. no files in directory picker)","primary-bg":"Primary background, used for menubar, context/dropdown menus","primary-border":"","primary-bg-active":"","primary-bg-hover":"","navbar-bg":"Window navbar background","navbar-bg-inactive":"","window-bg":"Window background","window-border":"","secondary-bg":"Secondary background, used for subareas in menus","secondary-border":"","secondary-bg-active":"","secondary-bg-hover":"","editable-overlay-hover":"Overlay on top of editable items (status widget buttons, playback option toggles, textareas)","editable-overlay-active":"","input-bg":"Background color for input","input-bg-active":"","input-bg-hover":"","input-border":"","widget-bg":"Widget background","tooltip-bg":"Color of these tooltips","editor-bg":"Editor background"},qr={"primary-bg":{"primary-border":function(i){return this.lighten(i,10).setAlpha(187/255)},"primary-bg-active":function(i){return this.lighten(i,10)},"primary-bg-hover":function(i){return this.lighten(i,30)},"widget-bg":function(i){return this.add(i,-50).setAlpha(136/255)},"window-bg":function(i){return this.lighten(i,-10)},"text-color":function(i){return this.average(i)>.5?new L("#000"):new L("#fff")},"input-bg":function(i){return this.average(i)<.5?new L("#000"):new L("#fff")},"input-border":function(i){return this.average(i)>.5?this.add(i,-30).setAlpha(119/255):this.add(i,30).setAlpha(119/255)},"tooltip-bg":function(i){return this.lighten(i,-10).setAlpha(238/255)},"secondary-bg":function(i){return this.lighten(i,-20)},"editor-bg":function(i){return this.lighten(i,-60)}},"window-bg":{"navbar-bg":function(i){return new L(i)}},"secondary-bg":{"secondary-border":function(i){return this.lighten(i,10).setAlpha(187/255)},"secondary-bg-active":function(i){return this.lighten(i,50)},"secondary-bg-hover":function(i){return this.lighten(i,30)}},"navbar-bg":{"navbar-bg-inactive":function(i){return this.lighten(i,-33)}},"text-color":{"text-color-secondary":function(i){return new L(i).setAlpha(119/255)},"text-color-detail":function(i){return new L(i).setAlpha(68/255)},"text-color-disabled":function(i){return new L(i).setAlpha(136/255)}},"input-bg":{"input-border":function(i){return this.lighten(i,10).setAlpha(187/255)},"input-bg-active":function(i){return this.lighten(i,50)},"input-bg-hover":function(i){return this.lighten(i,30)}}},Oi={default:{"accent-color":new L("rgb(23, 131, 208)"),"text-color":new L("#fff"),"text-color-secondary":new L("#888"),"text-color-detail":new L("#757a89"),"text-color-disabled":new L("#888"),"primary-bg":new L("#555"),"primary-border":new L("#444"),"primary-bg-active":new L("#575757"),"primary-bg-hover":new L("#666"),"navbar-bg":new L("#3d3d3d"),"navbar-bg-inactive":new L("#626262"),"window-bg":new L("#3d3d3d"),"window-border":new L("#00000000"),"secondary-bg":new L("#373737"),"secondary-border":new L("#333"),"secondary-bg-active":new L("#555"),"secondary-bg-hover":new L("#454545"),"editable-overlay-hover":new L("rgb(255, 255, 255, 0.1)"),"editable-overlay-active":new L("rgb(255, 255, 255, 0.2)"),"input-bg":new L("rgba(35, 35, 35, 0.309)"),"input-bg-active":new L("rgba(50, 50, 50, 0.309)"),"input-bg-hover":new L("rgba(79, 79, 79, 0.309)"),"input-border":new L("rgba(0, 0, 0, 0.3)"),"widget-bg":new L("rgba(0, 0, 0, 0.5)"),"tooltip-bg":new L("rgba(20, 20, 20, 0.95)"),"editor-bg":new L("#18191c")},dusk:{"accent-color":new L("#b34e97ff"),"text-color":new L("#ffffffff"),"text-color-secondary":new L("#ffffff77"),"text-color-detail":new L("#ffffff44"),"text-color-disabled":new L("#ffffff88"),"primary-bg":new L("#1b0131ff"),"primary-border":new L("#1e0136bb"),"primary-bg-active":new L("#2f0057ff"),"primary-bg-hover":new L("#230140ff"),"navbar-bg":new L("#18012cff"),"navbar-bg-inactive":new L("#10011dff"),"window-bg":new L("#18012cff"),"window-border":new L("#00000000"),"secondary-bg":new L("#160127ff"),"secondary-border":new L("#18012bbb"),"secondary-bg-active":new L("#310a52ff"),"secondary-bg-hover":new L("#25033fff"),"editable-overlay-hover":new L("#e79dff1a"),"editable-overlay-active":new L("#e79dff33"),"input-bg":new L("#000000ff"),"input-bg-active":new L("#000000ff"),"input-bg-hover":new L("#000000ff"),"input-border":new L("#391f4f77"),"widget-bg":new L("#00000088"),"tooltip-bg":new L("#18012cee"),"editor-bg":new L("#0b0014ff")},nord:{"accent-color":new L("#1783d0ff"),"text-color":new L("#d9dee8ff"),"text-color-secondary":new L("#d9dee878"),"text-color-detail":new L("#d9dee845"),"text-color-disabled":new L("#d9dee887"),"primary-bg":new L("#2e3440ff"),"primary-border":new L("#323946ba"),"primary-bg-active":new L("#636d83ff"),"primary-bg-hover":new L("#485061ff"),"navbar-bg":new L("#292e39ff"),"navbar-bg-inactive":new L("#2f333cff"),"window-bg":new L("#292e39ff"),"window-border":new L("#00000000"),"secondary-bg":new L("#242933ff"),"secondary-border":new L("#272d38ba"),"secondary-bg-active":new L("#444d5fff"),"secondary-bg-hover":new L("#3f4755ff"),"editable-overlay-hover":new L("#ffffff1a"),"editable-overlay-active":new L("#ffffff33"),"input-bg":new L("#1212124f"),"input-bg-active":new L("#141414ff"),"input-bg-hover":new L("#171717ff"),"input-border":new L("#121212ff"),"widget-bg":new L("#00020e87"),"tooltip-bg":new L("#292e39ed"),"editor-bg":new L("#18191cff")},light:{"accent-color":new L("#ff594cff"),"text-color":new L("#000000ff"),"text-color-secondary":new L("#00000078"),"text-color-detail":new L("#00000045"),"text-color-disabled":new L("#00000087"),"primary-bg":new L("#ffffffff"),"primary-border":new L("#b5b5b5ff"),"primary-bg-active":new L("#ebebebff"),"primary-bg-hover":new L("#ffd4d1ff"),"navbar-bg":new L("#edededff"),"navbar-bg-inactive":new L("#d1d1d1ff"),"window-bg":new L("#edededff"),"window-border":new L("#00000000"),"secondary-bg":new L("#d9d9d9ff"),"secondary-border":new L("#c7c7c7ff"),"secondary-bg-active":new L("#f0f0f0ff"),"secondary-bg-hover":new L("#e3e3e3ff"),"editable-overlay-hover":new L("#ff594c3d"),"editable-overlay-active":new L("#ff594c73"),"input-bg":new L("#ebebebff"),"input-bg-active":new L("#e0e0e0ff"),"input-bg-hover":new L("#ffffffff"),"input-border":new L("#9e9e9eff"),"widget-bg":new L("#f7f7f7e5"),"tooltip-bg":new L("#ffffffff"),"editor-bg":new L("#cfcfcfff")},rust:{"accent-color":new L("#b37100ff"),"text-color":new L("#ffd7bdf2"),"text-color-secondary":new L("#ffd7bd78"),"text-color-detail":new L("#ffd7bd45"),"text-color-disabled":new L("#ffd7bd87"),"primary-bg":new L("#3c2e2aff"),"primary-border":new L("#42332eff"),"primary-bg-active":new L("#68524bff"),"primary-bg-hover":new L("#4e3c37ff"),"navbar-bg":new L("#362926ff"),"navbar-bg-inactive":new L("#241b19ff"),"window-bg":new L("#58413cff"),"window-border":new L("#00000000"),"secondary-bg":new L("#40302ba1"),"secondary-border":new L("#46352fff"),"secondary-bg-active":new L("#614a42ff"),"secondary-bg-hover":new L("#533e38ff"),"editable-overlay-hover":new L("#fff8e01a"),"editable-overlay-active":new L("#fff8e033"),"input-bg":new L("#231515ff"),"input-bg-active":new L("#271717ff"),"input-bg-hover":new L("#2e1b1bff"),"input-border":new L("#4b413fff"),"widget-bg":new L("#311e1cdd"),"tooltip-bg":new L("#362926ff"),"editor-bg":new L("#181211ff")},tron:{"accent-color":new L("#00ccffff"),"text-color":new L("#ffffffff"),"text-color-secondary":new L("#ffffffe4"),"text-color-detail":new L("#ffffff5b"),"text-color-disabled":new L("#ffffff88"),"primary-bg":new L("#000000ff"),"primary-border":new L("#ff7b00c9"),"primary-bg-active":new L("#00e1ff98"),"primary-bg-hover":new L("#ff751a5a"),"navbar-bg":new L("#000000ff"),"navbar-bg-inactive":new L("#000000ff"),"window-bg":new L("#000000ff"),"window-border":new L("#ff880085"),"secondary-bg":new L("#121212ff"),"secondary-border":new L("#ff8800aa"),"secondary-bg-active":new L("#00e1ffa3"),"secondary-bg-hover":new L("#ff7e145a"),"editable-overlay-hover":new L("#ffffff1a"),"editable-overlay-active":new L("#ffffff33"),"input-bg":new L("#000000ff"),"input-bg-active":new L("#000000ff"),"input-bg-hover":new L("#000000ff"),"input-border":new L("#1e1e1eff"),"widget-bg":new L("#000000ad"),"tooltip-bg":new L("#000000ff"),"editor-bg":new L("#000000ff")},gilded:{"accent-color":new L("#ffc014ff"),"text-color":new L("#e6e6e6ff"),"text-color-secondary":new L("#ffffff6b"),"text-color-detail":new L("#e6e6e645"),"text-color-disabled":new L("#e6e6e687"),"primary-bg":new L("#232325ff"),"primary-border":new L("#272729ff"),"primary-bg-active":new L("#ffc0145b"),"primary-bg-hover":new L("#ffc01421"),"navbar-bg":new L("#202021ff"),"navbar-bg-inactive":new L("#151516ff"),"window-bg":new L("#202021ff"),"window-border":new L("#00000000"),"secondary-bg":new L("#1c1c1eff"),"secondary-border":new L("#1f1f21ff"),"secondary-bg-active":new L("#1f1f21ff"),"secondary-bg-hover":new L("#242427ff"),"editable-overlay-hover":new L("#ffffff1a"),"editable-overlay-active":new L("#ffffff33"),"input-bg":new L("#0d0d0dff"),"input-bg-active":new L("#0e0e0eff"),"input-bg-hover":new L("#111111ff"),"input-border":new L("#0e0e0eff"),"widget-bg":new L("#171717db"),"tooltip-bg":new L("#202021ff"),"editor-bg":new L("#0e0e0fff")}};class Be{static _themes=Oi;static _userThemes={};static _initialized=!1;static style;static currentTheme;static initialize(){this._createThemeStyle(),this._loadUserThemes(),this._initialized=!0}static _createThemeStyle(){const e=document.createElement("style");document.getElementsByTagName("head")[0].appendChild(e),this.style=e}static _loadUserThemes(){let e={};try{e=JSON.parse(localStorage.getItem("themes")??"{}")}catch{console.warn("Error loading user themes")}const t={};for(const[n,a]of Object.entries(e))t[n]=this.validateTheme(a);this._userThemes=t}static _saveUserThemes(){const e=Object.fromEntries(Object.entries(this._userThemes).map(([t,n])=>[t,this.convertThemeToString(n)]));localStorage.setItem("themes",JSON.stringify(e))}static validateTheme(e){const t={...Oi.default};if(typeof e!="object")return t;for(const n of Cl)if(e[n]!==void 0)try{t[n]=new L(e[n])}catch{console.warn(`Invalid color ${e[n]} for ${n}`)}return t}static getThemes(){return{...this._themes,...this._userThemes}}static getBuiltinThemes(){return this._themes}static getUserThemes(){return this._userThemes}static loadTheme(e){this._initialized||this.initialize();let t=this.getThemes()[e];t||(de.createFormatted("Error loading theme: Invalid theme id","error"),t=Oi.default),y.general.theme=e,this._applyTheme(t)}static _applyTheme(e){const t=`body{${Cl.map(n=>`--${n}: ${(e[n]??Oi.default[n]).toHexa()};`).join("")}}`;this.style.innerHTML=t,this.currentTheme={...e},le.emit("themeChanged")}static loadThemeFromColors(e){this._applyTheme(this.validateTheme(e))}static getCurrentTheme(){return this.currentTheme}static convertThemeToString(e){return Object.fromEntries(Object.entries(e).map(([t,n])=>[t,n.toHexa()]))}static exportCurrentTheme(e){return e={code:!1,spaces:!1,...e},e.code?JSON.stringify(Object.fromEntries(Object.entries(this.currentTheme).map(([t,n])=>[t,`^new Color('${n.toHexa()}')^`])),null,e.spaces?2:0).replaceAll('"^',"").replaceAll('^"',""):JSON.stringify(this.convertThemeToString(this.currentTheme),null,e.spaces?2:0)}static createUserTheme(e,t){this.getThemes()[e]===void 0&&(t?this._userThemes[e]={...t}:this._userThemes[e]={...Oi.default},this._saveUserThemes())}static setUserTheme(e,t){this._userThemes[e]!==void 0&&(this._userThemes[e]={...t},this._saveUserThemes())}static deleteUserTheme(e){this._userThemes[e]!==void 0&&(delete this._userThemes[e],this.loadTheme("default"),this._saveUserThemes())}static renameUserTheme(e,t){this._userThemes[e]!==void 0&&this.getThemes()[t]===void 0&&(this._userThemes[t]=this._userThemes[e],delete this._userThemes[e],this._saveUserThemes())}static parseThemeText(e){let t;try{t=JSON.parse(e)}catch{return null}return this.validateTheme(t)}static getColor(e){return this.currentTheme?.[e]??Oi.default[e]}}function Js(i,e,t){return(i<<16)+(e<<8)+t}function eo(i,e){let t=i>>16,n=i>>8&255,a=i&255;return t=Ae(Math.round(t*e),0,255),n=Ae(Math.round(n*e),0,255),a=Ae(Math.round(a*e),0,255),Js(t,n,a)}function Uh(i,e){let t=i>>16,n=i>>8&255,a=i&255;return t=Ae(Math.round(t+e),0,255),n=Ae(Math.round(n+e),0,255),a=Ae(Math.round(a+e),0,255),Js(t,n,a)}function Ss(i){return(i.red+i.green+i.blue)/3}function Sa(i,e,t){const[n,a,r]=i.match(/\w\w/g).map(d=>parseInt(d,16)),[s,o,l]=e.match(/\w\w/g).map(d=>parseInt(d,16)),u=Math.round(n+(s-n)*t).toString(16).padStart(2,"0"),f=Math.round(a+(o-a)*t).toString(16).padStart(2,"0"),c=Math.round(r+(l-r)*t).toString(16).padStart(2,"0");return"#"+u+f+c}function Jt(i,e,t){const n=xt(i.red,e.red,t),a=xt(i.green,e.green,t),r=xt(i.blue,e.blue,t),s=xt(i.alpha,e.alpha,t);return new L([n,a,r,s])}const Bn=new Map;le.on("themeChanged",()=>{for(const[i,e]of Bn.entries()){const t=Be.getColor(i);e.forEach(n=>{n.destroyed||(n.tint=t.toNumber(),n.alpha=t.alpha)}),Bn.set(i,e.filter(n=>!n.destroyed))}});function He(i,e){Bn.has(e)||Bn.set(e,[]),Bn.get(e).push(i);const t=Be.getColor(e);i.tint=t.toNumber(),i.alpha=t.alpha}function Gr(i){const{r:e,g:t,b:n,a}=i.toRgba(),r=Math.max(e,t,n),s=Math.min(e,t,n);let o=0,l=0;const u=(r+s)/2;if(r==s)o=l=0;else{const f=r-s;switch(l=u>.5?f/(2-r-s):f/(r+s),r){case e:o=(t-n)/f+(t<n?6:0);break;case t:o=(n-e)/f+2;break;case n:o=(e-t)/f+4;break}o/=6}return[o,l,u,a]}function aa(i){const{r:e,g:t,b:n,a}=i.toRgba(),r=Math.max(e,t,n),s=Math.min(e,t,n);let o=0,l=0;const u=r,f=r-s;if(l=r==0?0:f/r,r==s)o=0;else{switch(r){case e:o=(t-n)/f+(t<n?6:0);break;case t:o=(n-e)/f+2;break;case n:o=(e-t)/f+4;break}o/=6}return[o,l,u,a]}function zn(i,e){try{return new L(i)}catch{return new L("black")}}class Kc extends HTMLDivElement{colorElement;set color(e){this.colorElement.style.background=e.toHexa()}}function $r(){const i=document.createElement("div");i.classList.add("color-picker-transparent"),Object.setPrototypeOf(i,Kc.prototype);const e=document.createElement("div");return e.style.width="100%",e.style.height="100%",i.colorElement=e,i.appendChild(e),i}class an extends HTMLDivElement{inputs;opts;getValue;onupdate;static create(e){const t=document.createElement("div");Object.setPrototypeOf(t,an.prototype),t.opts=e.inputs,t.inputs={},t.getValue=e.getValue.bind(t),t.onupdate=e.onupdate,t.classList.add("color-format");const n=document.createElement("div");n.classList.add("color-format-label"),n.innerText=e.label;const a=document.createElement("div");return a.classList.add("color-format-inputs"),Object.entries(e.inputs).forEach(([r,s])=>{const o=document.createElement("input");o.type="text";let l="";o.onfocus=()=>{l=o.value},o.onkeydown=u=>{u.key=="Enter"&&(o.blur(),u.preventDefault()),u.key=="Escape"&&(o.value=l,o.blur(),u.stopImmediatePropagation())},o.oninput=()=>{s.isValid(o.value)!==null&&t.onupdate?.(t.getValue())},o.onblur=()=>{const u=s.isValid(o.value);u===null?o.value=l:o.value=u,t.onupdate?.(t.getValue())},t.inputs[r]=o,a.appendChild(o)}),t.replaceChildren(n,a),t}setValue(e){Object.entries(this.inputs).forEach(([t,n])=>{document.activeElement!=n&&(n.value=this.opts[t].setValue(e))})}}const Ft=(i,e,t)=>n=>{t!==void 0&&n.endsWith(t)&&(n=n.slice(0,n.length-t.length));let a;try{a=parseInt(n)}catch{return null}return Ae(a,i,e)+""},It=(i,e,t,n)=>{let a;n!==void 0&&i.endsWith(n)&&(i=i.slice(0,i.length-n.length));try{a=parseInt(i)}catch{return e}return Ae(a,e,t)};class Ua extends Kc{_value;_hue=0;_sat=0;_val=0;_alp=1;popup;matrix;matrixDot;matrixDragging=!1;hueDragging=!1;hueThumb;alphaDragging=!1;alphaBg;alphaThumb;previewNew;formats=[];onColorChange;static create(e){const t=$r();return Object.setPrototypeOf(t,Ua.prototype),t.value=zn(e.value),t.classList.add("color-picker"),t.formats=[],e.height!==void 0&&(t.style.height=e.height/16+"rem"),e.width!==void 0&&(t.style.width=e.width/16+"rem"),t.addEventListener("click",()=>{t.createPopup()}),t}updatePreview(){this.color=this._value}get value(){return this._value}set value(e){this._value=e;const t=aa(this._value);this._hue=t[0],this._sat=t[1],this._val=t[2],this._alp=t[3],this.updatePreview(),this.updatePopup()}get hue(){return this._hue}set hue(e){this._hue=e,this.updateColor()}get sat(){return this._sat}set sat(e){this._sat=e,this.updateColor()}get val(){return this._val}set val(e){this._val=e,this.updateColor()}get alpha(){return this._alp}set alpha(e){this._alp=e,this.updateColor()}updateColor(){this._value=new L({h:this._hue*360,s:this._sat*100,v:this._val*100,a:this._alp}),this.updatePreview(),this.updatePopup()}createPopup(){if(this.popup){this.closePopup();return}const e=document.createElement("div");e.classList.add("color-picker-popup");const t=document.createElement("div");t.classList.add("color-picker-area");const[n,a]=this.createMatrix();this.matrix=n,this.matrixDot=a,a.style.background="#f00";const[r,s]=this.createSlider({ondrag:()=>this.hueDragging=!0,offdrag:()=>this.hueDragging=!1,change:E=>{this.hue=E,this.onColorChange?.(this._value)}});this.hueThumb=s,r.style.background="linear-gradient(to right, red 0%, #ff0 17%, lime 33%, cyan 50%, blue 66%, #f0f 83%, red 100%)";const[o,l]=this.createSlider({ondrag:()=>this.alphaDragging=!0,offdrag:()=>this.alphaDragging=!1,change:E=>{this.alpha=E,this.onColorChange?.(this._value)}});this.alphaThumb=l,o.classList.add("color-picker-transparent");const u=document.createElement("div");u.classList.add("color-slider"),o.appendChild(u),this.alphaBg=u,t.replaceChildren(n,r,o);const f=document.createElement("div");f.classList.add("color-picker-area");const c=an.create({label:"HEX",inputs:{hex:{setValue:E=>E.alpha!=1?E.toHexa():E.toHex(),isValid:E=>{const R=/#?([0-9a-fA-F]+)/.exec(E);return R&&[3,4,6,8].includes(R[1].length)?(E[0]!="#"&&(E="#"+E),E):null}}},getValue(){let E=this.inputs.hex.value;return E[0]!="#"&&(E="#"+E),new L(E)},onupdate:E=>{this.value=E,this.onColorChange?.(this._value)}});this.formats.push(c),f.appendChild(c);const d=an.create({label:"RGBA",inputs:{r:{setValue:E=>Math.round(E.red*255).toString(),isValid:Ft(0,255)},g:{setValue:E=>Math.round(E.green*255).toString(),isValid:Ft(0,255)},b:{setValue:E=>Math.round(E.blue*255).toString(),isValid:Ft(0,255)},a:{setValue:E=>Math.round(E.alpha*100)+"%",isValid:Ft(0,100,"%")}},getValue(){return new L({r:It(this.inputs.r.value,0,255),g:It(this.inputs.g.value,0,255),b:It(this.inputs.b.value,0,255),a:It(this.inputs.a.value,0,100,"%")/100})},onupdate:E=>{this.value=E,this.onColorChange?.(this._value)}});this.formats.push(d),f.appendChild(d);const h=an.create({label:"HSVA",inputs:{h:{setValue:E=>Math.round(aa(E)[0]*360)+"º",isValid:Ft(0,360,"º")},s:{setValue:E=>Math.round(aa(E)[1]*100)+"%",isValid:Ft(0,100,"%")},v:{setValue:E=>Math.round(aa(E)[2]*100)+"%",isValid:Ft(0,100,"%")},a:{setValue:E=>Math.round(E.alpha*100)+"%",isValid:Ft(0,100,"%")}},getValue(){return new L({h:It(this.inputs.h.value,0,360,"º"),s:It(this.inputs.s.value,0,100,"%"),v:It(this.inputs.v.value,0,100,"%"),a:It(this.inputs.a.value,0,100,"%")/100})},onupdate:E=>{this.value=E,this.onColorChange?.(this._value)}});this.formats.push(h),f.appendChild(h);const p=an.create({label:"HSLA",inputs:{h:{setValue:E=>Math.round(Gr(E)[0]*360)+"º",isValid:Ft(0,360,"º")},s:{setValue:E=>Math.round(Gr(E)[1]*100)+"%",isValid:Ft(0,100,"%")},l:{setValue:E=>Math.round(Gr(E)[2]*100)+"%",isValid:Ft(0,100,"%")},a:{setValue:E=>Math.round(E.alpha*100)+"%",isValid:Ft(0,100,"%")}},getValue(){return new L({h:It(this.inputs.h.value,0,360,"º"),s:It(this.inputs.s.value,0,100,"%"),l:It(this.inputs.l.value,0,100,"%"),a:It(this.inputs.a.value,0,100,"%")/100})},onupdate:E=>{this.value=E,this.onColorChange?.(this._value)}});this.formats.push(p),f.appendChild(p);const m=document.createElement("div");m.classList.add("color-picker-preview");const g=$r(),b=$r();b.color=this._value,g.color=this._value,m.replaceChildren(g,b),this.previewNew=g,f.appendChild(m),e.replaceChildren(t,f),this.popup=e,this.updatePopup();const x=this._value,v=E=>{E.key=="Escape"&&(E.stopImmediatePropagation(),window.removeEventListener("keydown",v),window.removeEventListener("mousedown",C),this.closePopup(),this.value=x,this.onColorChange?.(this._value))},C=E=>{e.contains(E.target)||(window.removeEventListener("keydown",v),window.removeEventListener("mousedown",C),this.closePopup())};window.addEventListener("keydown",v),window.addEventListener("mousedown",C),document.getElementById("popups").appendChild(e),setTimeout(()=>this.movePosition())}updatePopup(){if(!this.popup)return;this.matrix.style.backgroundColor=`hsl(${this._hue*360} 100% 50%)`,this.matrixDot.style.backgroundColor=this._value.toHex(),this.matrixDragging||(this.matrixDot.style.left=this._sat*200/16+"rem",this.matrixDot.style.top=(1-this._val)*200/16+"rem"),this.hueDragging||(this.hueThumb.style.left=this._hue*200/16+"rem");const e=`rgba(${this._value.red*255}, ${this._value.green*255}, ${this._value.blue*255}`;this.alphaBg.style.background=`linear-gradient(to right, ${e}, 0 ), ${e}, 1))`,this.alphaDragging||(this.alphaThumb.style.left=this._alp*200/16+"rem"),this.formats.forEach(t=>t.setValue(this._value)),this.previewNew.color=this._value}closePopup(){const e=this.popup;this.popup=void 0,e&&(e.classList.add("exiting"),setTimeout(()=>{e.remove()},500))}createMatrix(){const e=document.createElement("div");e.classList.add("color-matrix"),e.style.backgroundColor="#ff0000";const t=document.createElement("div");t.classList.add("color-matrix-x");const n=document.createElement("div");n.classList.add("color-matrix-y");const a=document.createElement("div");a.classList.add("color-matrix-dot"),e.appendChild(a),e.replaceChildren(t,n,a),e.onmousedown=o=>{window.addEventListener("mousemove",r),window.addEventListener("mouseup",s),r(o),this.matrixDragging=!0};const r=o=>{const l=e.getBoundingClientRect(),u=Ae((o.clientX-l.left)/l.width,0,1),f=Ae((o.clientY-l.top)/l.height,0,1);a.style.left=u*l.width+"px",a.style.top=f*l.height+"px",this._sat=u,this.val=1-f,this.onColorChange?.(this._value)},s=()=>{window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",s),this.matrixDragging=!1};return[e,a]}createSlider(e){const t=document.createElement("div");t.classList.add("color-slider");const n=document.createElement("div");n.classList.add("color-slider-thumb"),t.appendChild(n),t.onmousedown=s=>{window.addEventListener("mousemove",a),window.addEventListener("mouseup",r),a(s),e.ondrag?.(),this.onColorChange?.(this._value)};const a=s=>{const o=t.getBoundingClientRect(),l=Ae((s.clientX-o.left)/o.width,0,1);n.style.left=l*o.width+"px",e.change(l)},r=()=>{window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",r),e.offdrag?.()};return[t,n]}movePosition(){const e=this.getBoundingClientRect(),t=e.left+e.width/2-this.popup.clientWidth/2,n=e.top+e.height+10,a=15,r=window.innerWidth-this.popup.clientWidth-15;this.popup.style.left=`${Ae(t,a,r)}px`,this.popup.style.top=`${n}px`,n+this.popup.clientHeight>window.innerHeight-15&&(this.popup.style.transformOrigin="bottom center",this.popup.style.top=`${e.top-this.popup.clientHeight-10}px`)}isActive(){return this.popup!==void 0}}class Si{view;slider;text;options;constructor(e,t){this.view=e,this.options=t,this.view.classList.add("slider");const n=document.createElement("input");n.classList.add("slider-input"),n.type="range",n.min=t.min.toString(),n.max=t.max.toString(),n.step=t.step.toString(),n.value=(t.value??(t.min+t.max)/2).toString(),n.oninput=()=>{a.innerText=this.formatValue(parseFloat(n.value))+"",this.options.onChange?.(parseFloat(n.value))},t.width!==void 0&&(n.style.width=t.width/16+"rem"),this.slider=n,e.appendChild(n);const a=document.createElement("div");a.innerText=this.formatValue(parseFloat(n.value))+"",a.style.width=`${(this.options.displayWidth??32)/16}rem`,this.text=a,e.appendChild(a)}get value(){return parseFloat(this.slider.value)}setValue(e){this.slider.value=e+"",this.text.innerText=this.formatValue(parseFloat(this.slider.value))+""}static create(e){return new Si(document.createElement("div"),e)}formatValue(e){return this.options.transformer?this.options.transformer(e):this.options.precision===void 0?ue(e,3).toString():ue(e,this.options.precision).toFixed(this.options.precision)}}function Xc(i,e,t){switch(e.type){case"checkbox":{const n=document.createElement("input"),a=e.onChange;return n.type="checkbox",n.checked=t,n.onblur=null,n.onchange=()=>{a?.(i,n.checked)},n.classList.add("pref-input","right"),n.onkeydown=r=>{r.key=="Enter"&&n.blur()},n}case"dropdown":if(e.advanced){const n=e.transformers.deserialize,a=e.transformers.serialize,r=e.onChange,s=li.create(e.items,a(t));return s.onChange(o=>{r?.(i,n(o))}),s.view}else{const n=e.onChange,a=li.create(e.items,t);return a.onChange(r=>{n?.(i,r)}),a.view}case"number":{const n=e.transformers?.deserialize??(o=>o),a=e.transformers?.serialize??(o=>o),r=e.onChange,s=lt.create({value:a(t),...e,onchange:o=>{if(!o){s.value=a(o);return}r?.(i,n(o))}});return s.view}case"slider":{const n=e.transformers?.deserialize??(c=>c),a=e.transformers?.serialize??(c=>c),r=e.onChange,s=document.createElement("div");s.style.display="flex",s.style.alignItems="center";const o=document.createElement("input");o.type="range",o.min=e.min?.toString()??"",o.max=e.max?.toString()??"",o.step=e.step?.toString()??"1",o.value=a(t).toString();const l=document.createElement("input");l.type="text",l.value=(Math.round(a(t)*1e3)/1e3).toString();const u=e.hardMin??e.min??-Number.MAX_VALUE,f=e.hardMax??e.max??Number.MAX_VALUE;return l.onblur=()=>{let c=In(l.value);if(c===null){l.value=(Math.round(a(t)*1e3)/1e3).toString();return}c=Ae(c,u,f),l.value=ue(c,3).toString(),l.blur(),l.value==""&&(l.value=a(c).toString()),o.value=c.toString(),r?.(i,n(c))},o.oninput=()=>{const c=parseFloat(o.value);l.value=ue(c,3).toString(),r?.(i,n(c))},l.style.width="3rem",l.onkeydown=c=>{c.key=="Enter"&&l.blur()},s.appendChild(o),s.appendChild(l),s}case"display-slider":{const n=e.transformers?.deserialize??(l=>l),a=e.transformers?.serialize??(l=>l),r=e.transformers?.display??(l=>l),s=e.onChange;return Si.create({...e,value:a(t),transformer:l=>r(l),onChange:l=>{s?.(i,n(l))}}).view}case"text":{const n=e.onChange,a=document.createElement("input");return a.type="text",a.value=t.toString(),a.onblur=()=>{n?.(i,a.value)},a.onkeydown=r=>{r.key=="Enter"&&a.blur()},a}case"color":{const n=e.onChange,a=Ua.create({value:t});return a.onColorChange=r=>{n?.(i,r)},a}}}class qh extends st{app;captureOptions={aspectRatio:4/3,videoHeight:720,fps:60,bitrate:4e6,playbackRate:1,assistTick:!1,metronome:!1,hideBarlines:!1};startBeat=0;endBeat=1;presetDropdown;exportButton;optionsView;captureView;captureCanvas;videoContainer;progressLabel;progressBar;currentCapture;videoURL;stopButton;returnButton;downloadButton;estimateInterval;regionHandler;constructor(e){super({title:"Export Recording",width:600,height:400,disableClose:!1,win_id:"capture",blocking:!1}),this.app=e,this.app.chartManager.startRegion!==void 0&&this.app.chartManager.endRegion!==void 0?(this.startBeat=this.app.chartManager.startRegion,this.endBeat=this.app.chartManager.endRegion):(this.startBeat=0,this.endBeat=this.app.chartManager.loadedChart.getLastBeat()),this.initView()}onClose(){le.off("regionChanged",this.regionHandler),this.currentCapture&&this.currentCapture.stop()}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");if(e.classList.add("padding"),this.initOptionsView(),this.initCaptureView(),e.replaceChildren(this.optionsView,this.captureView),!VideoEncoder||!AudioEncoder){const t=document.createElement("div");t.classList.add("capture-error");const n=document.createElement("h3");n.innerText="Your browser doesn't seem to support web encoding.";const a=document.createElement("p");a.innerText="Please try a different browser or use the desktop app.",t.replaceChildren(n,a),this.optionsView.style.filter="blur(10px)",this.optionsView.style.pointerEvents="none",e.appendChild(t),this.exportButton.disabled=!0}this.viewElement.appendChild(e)}initOptionsView(){const e=document.createElement("div");e.classList.add("capture-options-container");const t=document.createElement("div");t.style.display="flex",t.style.flexDirection="row",t.style.gap="2rem",t.style.alignItems="flex-start";const n=document.createElement("div");n.classList.add("capture-options");const a=document.createElement("div");a.classList.add("capture-options-label"),a.innerText="Record Range";const{item:r,update:s}=this.buildBeatSecondInput("Start",m=>{this.startBeat=m,this.startBeat>this.endBeat&&(this.startBeat=this.endBeat,s(this.startBeat)),this.updateSizeEstimate()}),{item:o,update:l}=this.buildBeatSecondInput("End",m=>{this.endBeat=m,this.endBeat<this.startBeat&&(this.endBeat=this.startBeat,l(this.endBeat)),this.updateSizeEstimate()});s(this.startBeat),l(this.endBeat);const u=(m,g)=>{this.startBeat=m,this.endBeat=g,s(m),l(g)};this.regionHandler=u.bind(this),le.on("regionChanged",this.regionHandler),n.replaceChildren(a,r,o);let f=this.buildOptions("Video Options",xl);const c=this.buildOptions("View Options",$d),d=document.createElement("div");d.classList.add("pref-item");const h=document.createElement("div");h.classList.add("pref-item-label","label"),h.innerText="Quality Preset",this.presetDropdown=li.create(["Minimal","Low","Medium","High"],"Medium"),this.presetDropdown.onChange(m=>{const g=()=>{const b=this.buildOptions("Video Options",xl);b.firstElementChild?.insertAdjacentElement("afterend",d),f.replaceWith(b),f=b,this.updateSizeEstimate()};switch(m){case"Minimal":this.captureOptions={...this.captureOptions,videoHeight:360,fps:24,bitrate:1e6},g();break;case"Low":this.captureOptions={...this.captureOptions,videoHeight:480,fps:30,bitrate:25e5},g();break;case"Medium":this.captureOptions={...this.captureOptions,videoHeight:720,fps:60,bitrate:4e6},g();break;case"High":this.captureOptions={...this.captureOptions,videoHeight:1080,fps:60,bitrate:8e6},g();break}}),f.firstElementChild?.insertAdjacentElement("afterend",d),d.replaceChildren(h,this.presetDropdown.view),t.replaceChildren(f,c);const p=document.createElement("button");p.innerText="Export Recording",p.classList.add("confirm"),p.onclick=async()=>{this.startCapture()},this.exportButton=p,e.replaceChildren(n,t,p),this.optionsView=e,this.updateSizeEstimate()}initCaptureView(){const e=document.createElement("div");e.classList.add("capture-view");const t=document.createElement("div");t.classList.add("capture-video-container");const n=document.createElement("canvas");n.width=560,n.height=320,n.style.width="35rem",n.style.height="20rem",n.style.filter="brightness(0.6) saturate(0.5)",t.appendChild(n);const a=document.createElement("div");a.classList.add("capture-video-overlay");const r=document.createElement("div");r.innerText="Rendering...",r.style.textAlign="center",this.progressLabel=r,a.appendChild(r);const s=document.createElement("div");s.classList.add("capture-progress-bar"),this.progressBar=s,a.appendChild(s),t.appendChild(a);const o=document.createElement("div");o.style.display="flex",o.style.flexDirection="row",o.style.gap="1rem",o.style.justifyContent="center",o.style.marginTop="1rem";const l=document.createElement("button");l.innerText="Stop exporting",l.classList.add("delete"),l.style.flex="1",l.onclick=()=>{this.currentCapture&&(this.currentCapture.stop(),l.disabled=!0)},this.stopButton=l;const u=document.createElement("button");u.innerText="Export another video",u.style.flex="1",u.onclick=()=>{this.captureView.style.display="none",this.optionsView.style.display="",this.videoContainer.childNodes.forEach(c=>{c.style.display="",c instanceof HTMLVideoElement&&(URL.revokeObjectURL(c.src),c.pause(),c.remove())})},u.style.display="none",this.returnButton=u;const f=document.createElement("button");f.innerText="Download video",f.style.flex="1",f.classList.add("confirm"),f.onclick=()=>{if(this.videoURL){const c=document.createElement("a");c.href=this.videoURL;const d=new Date;c.download=`SME-${d.toISOString().slice(0,10)}-${d.toTimeString().slice(0,8).replaceAll(":","-")}.mp4`,c.click()}},f.style.display="none",this.downloadButton=f,o.replaceChildren(l,u,f),e.replaceChildren(t,o),this.captureCanvas=n,this.videoContainer=t,this.captureView=e,e.style.display="none"}startCapture(){ve.disableKeybinds(),this.stopButton.disabled=!1,this.stopButton.style.display="",this.returnButton.style.display="none",this.downloadButton.style.display="none",this.setDisableClose(!0),this.setBlocking(!0);const e=this.captureCanvas.getContext("2d"),t=[];let n=-1,a=0;this.estimateInterval=setInterval(()=>{if(!this.currentCapture)return;const r=this.currentCapture.currentRenderFrame-this.currentCapture.currentEncodeQueue;t.push(r-a),a=r,t.length>20&&t.shift();const o=t.reduce((u,f)=>u+f,0)/t.length,l=this.currentCapture.totalFrames-r;n=Math.round(l/o)},1e3),this.captureView.style.display="",this.optionsView.style.display="none";try{const r=new zh(this.app,{...this.captureOptions,startTime:this.app.chartManager.loadedChart.getSecondsFromBeat(this.startBeat)-1,endTime:this.app.chartManager.loadedChart.getSecondsFromBeat(this.endBeat)+1,updateCallback:s=>{const o=(s.currentRenderFrame-s.currentEncodeQueue)/s.totalFrames;this.progressBar.style.background=`linear-gradient(90deg, var(--accent-color) 0 ${o*100}%, var(--input-bg) ${o*100}% 100%)`;const l=s.currentRenderFrame==s.totalFrames?"Encoding":"Rendering";this.progressLabel.innerText=`${l}...`,n>=0&&l==="Rendering"&&(this.progressLabel.innerText+=` (est. ${ju(n)})`),!(!e||!s.currentVideoFrame)&&(e.clearRect(0,0,this.captureCanvas.width,this.captureCanvas.height),createImageBitmap(s.currentVideoFrame).then(u=>{const f=u.height/this.captureCanvas.height,c=u.width/f,d=(this.captureCanvas.width-c)/2;e.drawImage(u,0,0,u.width,u.height,d,0,c,this.captureCanvas.height)}))},onFinish:s=>{this.stopCapture(s)}});this.currentCapture=r,r.start().catch(s=>{console.error("Error starting capture:",s),this.stopCapture("")})}catch(r){console.error("Error starting capture:",r),this.stopCapture("")}}stopCapture(e){if(this.setDisableClose(!1),this.setBlocking(!1),ve.enableKeybinds(),this.videoURL=e,this.stopButton.style.display="none",this.returnButton.style.display="",e!=""?(this.downloadButton.style.display="",this.downloadButton.innerText=`Download video (${wo(this.currentCapture.size)})`):this.progressLabel.innerText="Failed to export video! Check console for details.",clearInterval(this.estimateInterval),this.currentCapture=void 0,this.closed||e=="")return;const t=document.createElement("video");t.src=e,t.controls=!0,t.style.height="20rem",this.videoContainer.childNodes.forEach(n=>{n.style.display="none"}),this.videoContainer.appendChild(t)}buildBeatSecondInput(e,t){const n=document.createElement("div");n.classList.add("pref-item");const a=document.createElement("div");a.classList.add("pref-item-label","label"),a.innerText=e,n.appendChild(a);const r=document.createElement("div"),s=document.createElement("div");s.appendChild(document.createTextNode("Beat: "));const o=document.createElement("div");o.appendChild(document.createTextNode("Second: ")),s.style.display="flex",o.style.display="flex",s.style.gap="0.85rem",o.style.gap="0.85rem",s.style.flexDirection="row",o.style.flexDirection="row",r.style.display="flex",r.style.flexDirection="row",r.style.gap="1.5rem";const l=c=>{const d=this.app.chartManager.loadedChart.getSecondsFromBeat(c);f.value=d,u.value=c},u=lt.create({value:0,onchange:c=>{c!==void 0&&(l(c),t(c))}}),f=lt.create({value:0,onchange:c=>{c!==void 0&&(l(this.app.chartManager.loadedChart.getBeatFromSeconds(c)),t(this.app.chartManager.loadedChart.getBeatFromSeconds(c)))}});return r.replaceChildren(s,o),s.appendChild(u.view),o.appendChild(f.view),n.appendChild(r),{item:n,update:l}}updateSizeEstimate(){const e=this.captureOptions.bitrate,t=this.app.chartManager.loadedChart.getSecondsFromBeat(this.endBeat)-this.app.chartManager.loadedChart.getSecondsFromBeat(this.startBeat)+2,n=Math.round(e*t/8);this.exportButton.innerText=`Export Recording (Est. ${wo(n)})`}buildOptions(e,t){const n=document.createElement("div");n.classList.add("capture-options");const a=document.createElement("div");return a.classList.add("capture-options-label"),a.innerText=e,n.appendChild(a),Object.entries(t).forEach(([r,s])=>{const o=document.createElement("div");o.classList.add("pref-item");const l=document.createElement("div");l.classList.add("pref-item-label","label"),l.innerText=s.label,o.appendChild(l);const u=Xc(this.app,{...s.input,onChange:(f,c)=>{Object.assign(this.captureOptions,{[r]:c}),["videoHeight","fps","bitrate"].includes(r)&&this.presetDropdown.setSelected("Custom"),this.updateSizeEstimate()}},this.captureOptions[r]);o.appendChild(u),n.appendChild(o)}),n}}const Al={};function Gh(i){let e=Al[i];if(e)return e;e=Al[i]=[];for(let t=0;t<128;t++){const n=String.fromCharCode(t);e.push(n)}for(let t=0;t<i.length;t++){const n=i.charCodeAt(t);e[n]="%"+("0"+n.toString(16).toUpperCase()).slice(-2)}return e}function ln(i,e){typeof e!="string"&&(e=ln.defaultChars);const t=Gh(e);return i.replace(/(%[a-f0-9]{2})+/gi,function(n){let a="";for(let r=0,s=n.length;r<s;r+=3){const o=parseInt(n.slice(r+1,r+3),16);if(o<128){a+=t[o];continue}if((o&224)===192&&r+3<s){const l=parseInt(n.slice(r+4,r+6),16);if((l&192)===128){const u=o<<6&1984|l&63;u<128?a+="��":a+=String.fromCharCode(u),r+=3;continue}}if((o&240)===224&&r+6<s){const l=parseInt(n.slice(r+4,r+6),16),u=parseInt(n.slice(r+7,r+9),16);if((l&192)===128&&(u&192)===128){const f=o<<12&61440|l<<6&4032|u&63;f<2048||f>=55296&&f<=57343?a+="���":a+=String.fromCharCode(f),r+=6;continue}}if((o&248)===240&&r+9<s){const l=parseInt(n.slice(r+4,r+6),16),u=parseInt(n.slice(r+7,r+9),16),f=parseInt(n.slice(r+10,r+12),16);if((l&192)===128&&(u&192)===128&&(f&192)===128){let c=o<<18&1835008|l<<12&258048|u<<6&4032|f&63;c<65536||c>1114111?a+="����":(c-=65536,a+=String.fromCharCode(55296+(c>>10),56320+(c&1023))),r+=9;continue}}a+="�"}return a})}ln.defaultChars=";/?:@&=+$,#";ln.componentChars="";const kl={};function $h(i){let e=kl[i];if(e)return e;e=kl[i]=[];for(let t=0;t<128;t++){const n=String.fromCharCode(t);/^[0-9a-z]$/i.test(n)?e.push(n):e.push("%"+("0"+t.toString(16).toUpperCase()).slice(-2))}for(let t=0;t<i.length;t++)e[i.charCodeAt(t)]=i[t];return e}function Zn(i,e,t){typeof e!="string"&&(t=e,e=Zn.defaultChars),typeof t>"u"&&(t=!0);const n=$h(e);let a="";for(let r=0,s=i.length;r<s;r++){const o=i.charCodeAt(r);if(t&&o===37&&r+2<s&&/^[0-9a-f]{2}$/i.test(i.slice(r+1,r+3))){a+=i.slice(r,r+3),r+=2;continue}if(o<128){a+=n[o];continue}if(o>=55296&&o<=57343){if(o>=55296&&o<=56319&&r+1<s){const l=i.charCodeAt(r+1);if(l>=56320&&l<=57343){a+=encodeURIComponent(i[r]+i[r+1]),r++;continue}}a+="%EF%BF%BD";continue}a+=encodeURIComponent(i[r])}return a}Zn.defaultChars=";/?:@&=+$,-_.!~*'()#";Zn.componentChars="-_.!~*'()";function to(i){let e="";return e+=i.protocol||"",e+=i.slashes?"//":"",e+=i.auth?i.auth+"@":"",i.hostname&&i.hostname.indexOf(":")!==-1?e+="["+i.hostname+"]":e+=i.hostname||"",e+=i.port?":"+i.port:"",e+=i.pathname||"",e+=i.search||"",e+=i.hash||"",e}function Ta(){this.protocol=null,this.slashes=null,this.auth=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.pathname=null}const jh=/^([a-z0-9.+-]+:)/i,Yh=/:[0-9]*$/,Kh=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,Xh=["<",">",'"',"`"," ","\r",`
`,"	"],Zh=["{","}","|","\\","^","`"].concat(Xh),Qh=["'"].concat(Zh),Sl=["%","/","?",";","#"].concat(Qh),Tl=["/","?","#"],Jh=255,Ml=/^[+a-z0-9A-Z_-]{0,63}$/,ef=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,Dl={javascript:!0,"javascript:":!0},Ll={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function io(i,e){if(i&&i instanceof Ta)return i;const t=new Ta;return t.parse(i,e),t}Ta.prototype.parse=function(i,e){let t,n,a,r=i;if(r=r.trim(),!e&&i.split("#").length===1){const u=Kh.exec(r);if(u)return this.pathname=u[1],u[2]&&(this.search=u[2]),this}let s=jh.exec(r);if(s&&(s=s[0],t=s.toLowerCase(),this.protocol=s,r=r.substr(s.length)),(e||s||r.match(/^\/\/[^@\/]+@[^@\/]+/))&&(a=r.substr(0,2)==="//",a&&!(s&&Dl[s])&&(r=r.substr(2),this.slashes=!0)),!Dl[s]&&(a||s&&!Ll[s])){let u=-1;for(let p=0;p<Tl.length;p++)n=r.indexOf(Tl[p]),n!==-1&&(u===-1||n<u)&&(u=n);let f,c;u===-1?c=r.lastIndexOf("@"):c=r.lastIndexOf("@",u),c!==-1&&(f=r.slice(0,c),r=r.slice(c+1),this.auth=f),u=-1;for(let p=0;p<Sl.length;p++)n=r.indexOf(Sl[p]),n!==-1&&(u===-1||n<u)&&(u=n);u===-1&&(u=r.length),r[u-1]===":"&&u--;const d=r.slice(0,u);r=r.slice(u),this.parseHost(d),this.hostname=this.hostname||"";const h=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!h){const p=this.hostname.split(/\./);for(let m=0,g=p.length;m<g;m++){const b=p[m];if(b&&!b.match(Ml)){let x="";for(let v=0,C=b.length;v<C;v++)b.charCodeAt(v)>127?x+="x":x+=b[v];if(!x.match(Ml)){const v=p.slice(0,m),C=p.slice(m+1),E=b.match(ef);E&&(v.push(E[1]),C.unshift(E[2])),C.length&&(r=C.join(".")+r),this.hostname=v.join(".");break}}}}this.hostname.length>Jh&&(this.hostname=""),h&&(this.hostname=this.hostname.substr(1,this.hostname.length-2))}const o=r.indexOf("#");o!==-1&&(this.hash=r.substr(o),r=r.slice(0,o));const l=r.indexOf("?");return l!==-1&&(this.search=r.substr(l),r=r.slice(0,l)),r&&(this.pathname=r),Ll[t]&&this.hostname&&!this.pathname&&(this.pathname=""),this};Ta.prototype.parseHost=function(i){let e=Yh.exec(i);e&&(e=e[0],e!==":"&&(this.port=e.substr(1)),i=i.substr(0,i.length-e.length)),i&&(this.hostname=i)};const tf=Object.freeze(Object.defineProperty({__proto__:null,decode:ln,encode:Zn,format:to,parse:io},Symbol.toStringTag,{value:"Module"})),Zc=/[\0-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,Qc=/[\0-\x1F\x7F-\x9F]/,nf=/[\xAD\u0600-\u0605\u061C\u06DD\u070F\u0890\u0891\u08E2\u180E\u200B-\u200F\u202A-\u202E\u2060-\u2064\u2066-\u206F\uFEFF\uFFF9-\uFFFB]|\uD804[\uDCBD\uDCCD]|\uD80D[\uDC30-\uDC3F]|\uD82F[\uDCA0-\uDCA3]|\uD834[\uDD73-\uDD7A]|\uDB40[\uDC01\uDC20-\uDC7F]/,no=/[!-#%-\*,-\/:;\?@\[-\]_\{\}\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061D-\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1B7D\u1B7E\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52-\u2E5D\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59\uDF86-\uDF89]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDEB9\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2\uDF00-\uDF09]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDF43-\uDF4F\uDFFF]|\uD809[\uDC70-\uDC74]|\uD80B[\uDFF1\uDFF2]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]/,Jc=/[\$\+<->\^`\|~\xA2-\xA6\xA8\xA9\xAC\xAE-\xB1\xB4\xB8\xD7\xF7\u02C2-\u02C5\u02D2-\u02DF\u02E5-\u02EB\u02ED\u02EF-\u02FF\u0375\u0384\u0385\u03F6\u0482\u058D-\u058F\u0606-\u0608\u060B\u060E\u060F\u06DE\u06E9\u06FD\u06FE\u07F6\u07FE\u07FF\u0888\u09F2\u09F3\u09FA\u09FB\u0AF1\u0B70\u0BF3-\u0BFA\u0C7F\u0D4F\u0D79\u0E3F\u0F01-\u0F03\u0F13\u0F15-\u0F17\u0F1A-\u0F1F\u0F34\u0F36\u0F38\u0FBE-\u0FC5\u0FC7-\u0FCC\u0FCE\u0FCF\u0FD5-\u0FD8\u109E\u109F\u1390-\u1399\u166D\u17DB\u1940\u19DE-\u19FF\u1B61-\u1B6A\u1B74-\u1B7C\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2044\u2052\u207A-\u207C\u208A-\u208C\u20A0-\u20C0\u2100\u2101\u2103-\u2106\u2108\u2109\u2114\u2116-\u2118\u211E-\u2123\u2125\u2127\u2129\u212E\u213A\u213B\u2140-\u2144\u214A-\u214D\u214F\u218A\u218B\u2190-\u2307\u230C-\u2328\u232B-\u2426\u2440-\u244A\u249C-\u24E9\u2500-\u2767\u2794-\u27C4\u27C7-\u27E5\u27F0-\u2982\u2999-\u29D7\u29DC-\u29FB\u29FE-\u2B73\u2B76-\u2B95\u2B97-\u2BFF\u2CE5-\u2CEA\u2E50\u2E51\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFF\u3004\u3012\u3013\u3020\u3036\u3037\u303E\u303F\u309B\u309C\u3190\u3191\u3196-\u319F\u31C0-\u31E3\u31EF\u3200-\u321E\u322A-\u3247\u3250\u3260-\u327F\u328A-\u32B0\u32C0-\u33FF\u4DC0-\u4DFF\uA490-\uA4C6\uA700-\uA716\uA720\uA721\uA789\uA78A\uA828-\uA82B\uA836-\uA839\uAA77-\uAA79\uAB5B\uAB6A\uAB6B\uFB29\uFBB2-\uFBC2\uFD40-\uFD4F\uFDCF\uFDFC-\uFDFF\uFE62\uFE64-\uFE66\uFE69\uFF04\uFF0B\uFF1C-\uFF1E\uFF3E\uFF40\uFF5C\uFF5E\uFFE0-\uFFE6\uFFE8-\uFFEE\uFFFC\uFFFD]|\uD800[\uDD37-\uDD3F\uDD79-\uDD89\uDD8C-\uDD8E\uDD90-\uDD9C\uDDA0\uDDD0-\uDDFC]|\uD802[\uDC77\uDC78\uDEC8]|\uD805\uDF3F|\uD807[\uDFD5-\uDFF1]|\uD81A[\uDF3C-\uDF3F\uDF45]|\uD82F\uDC9C|\uD833[\uDF50-\uDFC3]|\uD834[\uDC00-\uDCF5\uDD00-\uDD26\uDD29-\uDD64\uDD6A-\uDD6C\uDD83\uDD84\uDD8C-\uDDA9\uDDAE-\uDDEA\uDE00-\uDE41\uDE45\uDF00-\uDF56]|\uD835[\uDEC1\uDEDB\uDEFB\uDF15\uDF35\uDF4F\uDF6F\uDF89\uDFA9\uDFC3]|\uD836[\uDC00-\uDDFF\uDE37-\uDE3A\uDE6D-\uDE74\uDE76-\uDE83\uDE85\uDE86]|\uD838[\uDD4F\uDEFF]|\uD83B[\uDCAC\uDCB0\uDD2E\uDEF0\uDEF1]|\uD83C[\uDC00-\uDC2B\uDC30-\uDC93\uDCA0-\uDCAE\uDCB1-\uDCBF\uDCC1-\uDCCF\uDCD1-\uDCF5\uDD0D-\uDDAD\uDDE6-\uDE02\uDE10-\uDE3B\uDE40-\uDE48\uDE50\uDE51\uDE60-\uDE65\uDF00-\uDFFF]|\uD83D[\uDC00-\uDED7\uDEDC-\uDEEC\uDEF0-\uDEFC\uDF00-\uDF76\uDF7B-\uDFD9\uDFE0-\uDFEB\uDFF0]|\uD83E[\uDC00-\uDC0B\uDC10-\uDC47\uDC50-\uDC59\uDC60-\uDC87\uDC90-\uDCAD\uDCB0\uDCB1\uDD00-\uDE53\uDE60-\uDE6D\uDE70-\uDE7C\uDE80-\uDE88\uDE90-\uDEBD\uDEBF-\uDEC5\uDECE-\uDEDB\uDEE0-\uDEE8\uDEF0-\uDEF8\uDF00-\uDF92\uDF94-\uDFCA]/,eu=/[ \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000]/,af=Object.freeze(Object.defineProperty({__proto__:null,Any:Zc,Cc:Qc,Cf:nf,P:no,S:Jc,Z:eu},Symbol.toStringTag,{value:"Module"})),rf=new Uint16Array('ᵁ<Õıʊҝջאٵ۞ޢߖࠏ੊ઑඡ๭༉༦჊ረዡᐕᒝᓃᓟᔥ\0\0\0\0\0\0ᕫᛍᦍᰒᷝ὾⁠↰⊍⏀⏻⑂⠤⤒ⴈ⹈⿎〖㊺㘹㞬㣾㨨㩱㫠㬮ࠀEMabcfglmnoprstu\\bfms¦³¹ÈÏlig耻Æ䃆P耻&䀦cute耻Á䃁reve;䄂Āiyx}rc耻Â䃂;䐐r;쀀𝔄rave耻À䃀pha;䎑acr;䄀d;橓Āgp¡on;䄄f;쀀𝔸plyFunction;恡ing耻Å䃅Ācs¾Ãr;쀀𝒜ign;扔ilde耻Ã䃃ml耻Ä䃄ЀaceforsuåûþėĜĢħĪĀcrêòkslash;或Ŷöø;櫧ed;挆y;䐑ƀcrtąċĔause;戵noullis;愬a;䎒r;쀀𝔅pf;쀀𝔹eve;䋘còēmpeq;扎܀HOacdefhilorsuōőŖƀƞƢƵƷƺǜȕɳɸɾcy;䐧PY耻©䂩ƀcpyŝŢźute;䄆Ā;iŧŨ拒talDifferentialD;慅leys;愭ȀaeioƉƎƔƘron;䄌dil耻Ç䃇rc;䄈nint;戰ot;䄊ĀdnƧƭilla;䂸terDot;䂷òſi;䎧rcleȀDMPTǇǋǑǖot;抙inus;抖lus;投imes;抗oĀcsǢǸkwiseContourIntegral;戲eCurlyĀDQȃȏoubleQuote;思uote;怙ȀlnpuȞȨɇɕonĀ;eȥȦ户;橴ƀgitȯȶȺruent;扡nt;戯ourIntegral;戮ĀfrɌɎ;愂oduct;成nterClockwiseContourIntegral;戳oss;樯cr;쀀𝒞pĀ;Cʄʅ拓ap;才րDJSZacefiosʠʬʰʴʸˋ˗ˡ˦̳ҍĀ;oŹʥtrahd;椑cy;䐂cy;䐅cy;䐏ƀgrsʿ˄ˇger;怡r;憡hv;櫤Āayː˕ron;䄎;䐔lĀ;t˝˞戇a;䎔r;쀀𝔇Āaf˫̧Ācm˰̢riticalȀADGT̖̜̀̆cute;䂴oŴ̋̍;䋙bleAcute;䋝rave;䁠ilde;䋜ond;拄ferentialD;慆Ѱ̽\0\0\0͔͂\0Ѕf;쀀𝔻ƀ;DE͈͉͍䂨ot;惜qual;扐blèCDLRUVͣͲ΂ϏϢϸontourIntegraìȹoɴ͹\0\0ͻ»͉nArrow;懓Āeo·ΤftƀARTΐΖΡrrow;懐ightArrow;懔eåˊngĀLRΫτeftĀARγιrrow;柸ightArrow;柺ightArrow;柹ightĀATϘϞrrow;懒ee;抨pɁϩ\0\0ϯrrow;懑ownArrow;懕erticalBar;戥ǹABLRTaВЪаўѿͼrrowƀ;BUНОТ憓ar;椓pArrow;懵reve;䌑eft˒к\0ц\0ѐightVector;楐eeVector;楞ectorĀ;Bљњ憽ar;楖ightǔѧ\0ѱeeVector;楟ectorĀ;BѺѻ懁ar;楗eeĀ;A҆҇护rrow;憧ĀctҒҗr;쀀𝒟rok;䄐ࠀNTacdfglmopqstuxҽӀӄӋӞӢӧӮӵԡԯԶՒ՝ՠեG;䅊H耻Ð䃐cute耻É䃉ƀaiyӒӗӜron;䄚rc耻Ê䃊;䐭ot;䄖r;쀀𝔈rave耻È䃈ement;戈ĀapӺӾcr;䄒tyɓԆ\0\0ԒmallSquare;旻erySmallSquare;斫ĀgpԦԪon;䄘f;쀀𝔼silon;䎕uĀaiԼՉlĀ;TՂՃ橵ilde;扂librium;懌Āci՗՚r;愰m;橳a;䎗ml耻Ë䃋Āipժկsts;戃onentialE;慇ʀcfiosօֈ֍ֲ׌y;䐤r;쀀𝔉lledɓ֗\0\0֣mallSquare;旼erySmallSquare;斪Ͱֺ\0ֿ\0\0ׄf;쀀𝔽All;戀riertrf;愱cò׋؀JTabcdfgorstר׬ׯ׺؀ؒؖ؛؝أ٬ٲcy;䐃耻>䀾mmaĀ;d׷׸䎓;䏜reve;䄞ƀeiy؇،ؐdil;䄢rc;䄜;䐓ot;䄠r;쀀𝔊;拙pf;쀀𝔾eater̀EFGLSTصلَٖٛ٦qualĀ;Lؾؿ扥ess;招ullEqual;执reater;檢ess;扷lantEqual;橾ilde;扳cr;쀀𝒢;扫ЀAacfiosuڅڋږڛڞڪھۊRDcy;䐪Āctڐڔek;䋇;䁞irc;䄤r;愌lbertSpace;愋ǰگ\0ڲf;愍izontalLine;攀Āctۃۅòکrok;䄦mpńېۘownHumðįqual;扏܀EJOacdfgmnostuۺ۾܃܇܎ܚܞܡܨ݄ݸދޏޕcy;䐕lig;䄲cy;䐁cute耻Í䃍Āiyܓܘrc耻Î䃎;䐘ot;䄰r;愑rave耻Ì䃌ƀ;apܠܯܿĀcgܴܷr;䄪inaryI;慈lieóϝǴ݉\0ݢĀ;eݍݎ戬Āgrݓݘral;戫section;拂isibleĀCTݬݲomma;恣imes;恢ƀgptݿރވon;䄮f;쀀𝕀a;䎙cr;愐ilde;䄨ǫޚ\0ޞcy;䐆l耻Ï䃏ʀcfosuެ޷޼߂ߐĀiyޱ޵rc;䄴;䐙r;쀀𝔍pf;쀀𝕁ǣ߇\0ߌr;쀀𝒥rcy;䐈kcy;䐄΀HJacfosߤߨ߽߬߱ࠂࠈcy;䐥cy;䐌ppa;䎚Āey߶߻dil;䄶;䐚r;쀀𝔎pf;쀀𝕂cr;쀀𝒦րJTaceflmostࠥࠩࠬࡐࡣ঳সে্਷ੇcy;䐉耻<䀼ʀcmnpr࠷࠼ࡁࡄࡍute;䄹bda;䎛g;柪lacetrf;愒r;憞ƀaeyࡗ࡜ࡡron;䄽dil;䄻;䐛Āfsࡨ॰tԀACDFRTUVarࡾࢩࢱࣦ࣠ࣼयज़ΐ४Ānrࢃ࢏gleBracket;柨rowƀ;BR࢙࢚࢞憐ar;懤ightArrow;懆eiling;挈oǵࢷ\0ࣃbleBracket;柦nǔࣈ\0࣒eeVector;楡ectorĀ;Bࣛࣜ懃ar;楙loor;挊ightĀAV࣯ࣵrrow;憔ector;楎Āerँगeƀ;AVउऊऐ抣rrow;憤ector;楚iangleƀ;BEतथऩ抲ar;槏qual;抴pƀDTVषूौownVector;楑eeVector;楠ectorĀ;Bॖॗ憿ar;楘ectorĀ;B॥०憼ar;楒ightáΜs̀EFGLSTॾঋকঝঢভqualGreater;拚ullEqual;扦reater;扶ess;檡lantEqual;橽ilde;扲r;쀀𝔏Ā;eঽা拘ftarrow;懚idot;䄿ƀnpw৔ਖਛgȀLRlr৞৷ਂਐeftĀAR০৬rrow;柵ightArrow;柷ightArrow;柶eftĀarγਊightáοightáϊf;쀀𝕃erĀLRਢਬeftArrow;憙ightArrow;憘ƀchtਾੀੂòࡌ;憰rok;䅁;扪Ѐacefiosuਗ਼੝੠੷੼અઋ઎p;椅y;䐜Ādl੥੯iumSpace;恟lintrf;愳r;쀀𝔐nusPlus;戓pf;쀀𝕄cò੶;䎜ҀJacefostuણધભીଔଙඑ඗ඞcy;䐊cute;䅃ƀaey઴હાron;䅇dil;䅅;䐝ƀgswે૰଎ativeƀMTV૓૟૨ediumSpace;怋hiĀcn૦૘ë૙eryThiî૙tedĀGL૸ଆreaterGreateòٳessLesóੈLine;䀊r;쀀𝔑ȀBnptଢନଷ଺reak;恠BreakingSpace;䂠f;愕ڀ;CDEGHLNPRSTV୕ୖ୪୼஡௫ఄ౞಄ದ೘ൡඅ櫬Āou୛୤ngruent;扢pCap;扭oubleVerticalBar;戦ƀlqxஃஊ஛ement;戉ualĀ;Tஒஓ扠ilde;쀀≂̸ists;戄reater΀;EFGLSTஶஷ஽௉௓௘௥扯qual;扱ullEqual;쀀≧̸reater;쀀≫̸ess;批lantEqual;쀀⩾̸ilde;扵umpń௲௽ownHump;쀀≎̸qual;쀀≏̸eĀfsఊధtTriangleƀ;BEచఛడ拪ar;쀀⧏̸qual;括s̀;EGLSTవశ఼ౄోౘ扮qual;扰reater;扸ess;쀀≪̸lantEqual;쀀⩽̸ilde;扴estedĀGL౨౹reaterGreater;쀀⪢̸essLess;쀀⪡̸recedesƀ;ESಒಓಛ技qual;쀀⪯̸lantEqual;拠ĀeiಫಹverseElement;戌ghtTriangleƀ;BEೋೌ೒拫ar;쀀⧐̸qual;拭ĀquೝഌuareSuĀbp೨೹setĀ;E೰ೳ쀀⊏̸qual;拢ersetĀ;Eഃആ쀀⊐̸qual;拣ƀbcpഓതൎsetĀ;Eഛഞ쀀⊂⃒qual;抈ceedsȀ;ESTലള഻െ抁qual;쀀⪰̸lantEqual;拡ilde;쀀≿̸ersetĀ;E൘൛쀀⊃⃒qual;抉ildeȀ;EFT൮൯൵ൿ扁qual;扄ullEqual;扇ilde;扉erticalBar;戤cr;쀀𝒩ilde耻Ñ䃑;䎝܀Eacdfgmoprstuvලෂ෉෕ෛ෠෧෼ขภยา฿ไlig;䅒cute耻Ó䃓Āiy෎ීrc耻Ô䃔;䐞blac;䅐r;쀀𝔒rave耻Ò䃒ƀaei෮ෲ෶cr;䅌ga;䎩cron;䎟pf;쀀𝕆enCurlyĀDQฎบoubleQuote;怜uote;怘;橔Āclวฬr;쀀𝒪ash耻Ø䃘iŬื฼de耻Õ䃕es;樷ml耻Ö䃖erĀBP๋๠Āar๐๓r;怾acĀek๚๜;揞et;掴arenthesis;揜Ҁacfhilors๿ງຊຏຒດຝະ໼rtialD;戂y;䐟r;쀀𝔓i;䎦;䎠usMinus;䂱Āipຢອncareplanåڝf;愙Ȁ;eio຺ູ໠໤檻cedesȀ;EST່້໏໚扺qual;檯lantEqual;扼ilde;找me;怳Ādp໩໮uct;戏ortionĀ;aȥ໹l;戝Āci༁༆r;쀀𝒫;䎨ȀUfos༑༖༛༟OT耻"䀢r;쀀𝔔pf;愚cr;쀀𝒬؀BEacefhiorsu༾གྷཇའཱིྦྷྪྭ႖ႩႴႾarr;椐G耻®䂮ƀcnrཎནབute;䅔g;柫rĀ;tཛྷཝ憠l;椖ƀaeyཧཬཱron;䅘dil;䅖;䐠Ā;vླྀཹ愜erseĀEUྂྙĀlq྇ྎement;戋uilibrium;懋pEquilibrium;楯r»ཹo;䎡ghtЀACDFTUVa࿁࿫࿳ဢဨၛႇϘĀnr࿆࿒gleBracket;柩rowƀ;BL࿜࿝࿡憒ar;懥eftArrow;懄eiling;按oǵ࿹\0စbleBracket;柧nǔည\0နeeVector;楝ectorĀ;Bဝသ懂ar;楕loor;挋Āerိ၃eƀ;AVဵံြ抢rrow;憦ector;楛iangleƀ;BEၐၑၕ抳ar;槐qual;抵pƀDTVၣၮၸownVector;楏eeVector;楜ectorĀ;Bႂႃ憾ar;楔ectorĀ;B႑႒懀ar;楓Āpuႛ႞f;愝ndImplies;楰ightarrow;懛ĀchႹႼr;愛;憱leDelayed;槴ڀHOacfhimoqstuფჱჷჽᄙᄞᅑᅖᅡᅧᆵᆻᆿĀCcჩხHcy;䐩y;䐨FTcy;䐬cute;䅚ʀ;aeiyᄈᄉᄎᄓᄗ檼ron;䅠dil;䅞rc;䅜;䐡r;쀀𝔖ortȀDLRUᄪᄴᄾᅉownArrow»ОeftArrow»࢚ightArrow»࿝pArrow;憑gma;䎣allCircle;战pf;쀀𝕊ɲᅭ\0\0ᅰt;戚areȀ;ISUᅻᅼᆉᆯ斡ntersection;抓uĀbpᆏᆞsetĀ;Eᆗᆘ抏qual;抑ersetĀ;Eᆨᆩ抐qual;抒nion;抔cr;쀀𝒮ar;拆ȀbcmpᇈᇛሉላĀ;sᇍᇎ拐etĀ;Eᇍᇕqual;抆ĀchᇠህeedsȀ;ESTᇭᇮᇴᇿ扻qual;檰lantEqual;扽ilde;承Tháྌ;我ƀ;esሒሓሣ拑rsetĀ;Eሜም抃qual;抇et»ሓրHRSacfhiorsሾቄ቉ቕ቞ቱቶኟዂወዑORN耻Þ䃞ADE;愢ĀHc቎ቒcy;䐋y;䐦Ābuቚቜ;䀉;䎤ƀaeyብቪቯron;䅤dil;䅢;䐢r;쀀𝔗Āeiቻ኉ǲኀ\0ኇefore;戴a;䎘Ācn኎ኘkSpace;쀀  Space;怉ldeȀ;EFTካኬኲኼ戼qual;扃ullEqual;扅ilde;扈pf;쀀𝕋ipleDot;惛Āctዖዛr;쀀𝒯rok;䅦ૡዷጎጚጦ\0ጬጱ\0\0\0\0\0ጸጽ፷ᎅ\0᏿ᐄᐊᐐĀcrዻጁute耻Ú䃚rĀ;oጇገ憟cir;楉rǣጓ\0጖y;䐎ve;䅬Āiyጞጣrc耻Û䃛;䐣blac;䅰r;쀀𝔘rave耻Ù䃙acr;䅪Ādiፁ፩erĀBPፈ፝Āarፍፐr;䁟acĀekፗፙ;揟et;掵arenthesis;揝onĀ;P፰፱拃lus;抎Āgp፻፿on;䅲f;쀀𝕌ЀADETadps᎕ᎮᎸᏄϨᏒᏗᏳrrowƀ;BDᅐᎠᎤar;椒ownArrow;懅ownArrow;憕quilibrium;楮eeĀ;AᏋᏌ报rrow;憥ownáϳerĀLRᏞᏨeftArrow;憖ightArrow;憗iĀ;lᏹᏺ䏒on;䎥ing;䅮cr;쀀𝒰ilde;䅨ml耻Ü䃜ҀDbcdefosvᐧᐬᐰᐳᐾᒅᒊᒐᒖash;披ar;櫫y;䐒ashĀ;lᐻᐼ抩;櫦Āerᑃᑅ;拁ƀbtyᑌᑐᑺar;怖Ā;iᑏᑕcalȀBLSTᑡᑥᑪᑴar;戣ine;䁼eparator;杘ilde;所ThinSpace;怊r;쀀𝔙pf;쀀𝕍cr;쀀𝒱dash;抪ʀcefosᒧᒬᒱᒶᒼirc;䅴dge;拀r;쀀𝔚pf;쀀𝕎cr;쀀𝒲Ȁfiosᓋᓐᓒᓘr;쀀𝔛;䎞pf;쀀𝕏cr;쀀𝒳ҀAIUacfosuᓱᓵᓹᓽᔄᔏᔔᔚᔠcy;䐯cy;䐇cy;䐮cute耻Ý䃝Āiyᔉᔍrc;䅶;䐫r;쀀𝔜pf;쀀𝕐cr;쀀𝒴ml;䅸ЀHacdefosᔵᔹᔿᕋᕏᕝᕠᕤcy;䐖cute;䅹Āayᕄᕉron;䅽;䐗ot;䅻ǲᕔ\0ᕛoWidtè૙a;䎖r;愨pf;愤cr;쀀𝒵௡ᖃᖊᖐ\0ᖰᖶᖿ\0\0\0\0ᗆᗛᗫᙟ᙭\0ᚕ᚛ᚲᚹ\0ᚾcute耻á䃡reve;䄃̀;Ediuyᖜᖝᖡᖣᖨᖭ戾;쀀∾̳;房rc耻â䃢te肻´̆;䐰lig耻æ䃦Ā;r²ᖺ;쀀𝔞rave耻à䃠ĀepᗊᗖĀfpᗏᗔsym;愵èᗓha;䎱ĀapᗟcĀclᗤᗧr;䄁g;樿ɤᗰ\0\0ᘊʀ;adsvᗺᗻᗿᘁᘇ戧nd;橕;橜lope;橘;橚΀;elmrszᘘᘙᘛᘞᘿᙏᙙ戠;榤e»ᘙsdĀ;aᘥᘦ戡ѡᘰᘲᘴᘶᘸᘺᘼᘾ;榨;榩;榪;榫;榬;榭;榮;榯tĀ;vᙅᙆ戟bĀ;dᙌᙍ抾;榝Āptᙔᙗh;戢»¹arr;捼Āgpᙣᙧon;䄅f;쀀𝕒΀;Eaeiop዁ᙻᙽᚂᚄᚇᚊ;橰cir;橯;扊d;手s;䀧roxĀ;e዁ᚒñᚃing耻å䃥ƀctyᚡᚦᚨr;쀀𝒶;䀪mpĀ;e዁ᚯñʈilde耻ã䃣ml耻ä䃤Āciᛂᛈoninôɲnt;樑ࠀNabcdefiklnoprsu᛭ᛱᜰ᜼ᝃᝈ᝸᝽០៦ᠹᡐᜍ᤽᥈ᥰot;櫭Ācrᛶ᜞kȀcepsᜀᜅᜍᜓong;扌psilon;䏶rime;怵imĀ;e᜚᜛戽q;拍Ŷᜢᜦee;抽edĀ;gᜬᜭ挅e»ᜭrkĀ;t፜᜷brk;掶Āoyᜁᝁ;䐱quo;怞ʀcmprtᝓ᝛ᝡᝤᝨausĀ;eĊĉptyv;榰séᜌnoõēƀahwᝯ᝱ᝳ;䎲;愶een;扬r;쀀𝔟g΀costuvwឍឝឳេ៕៛៞ƀaiuបពរðݠrc;旯p»፱ƀdptឤឨឭot;樀lus;樁imes;樂ɱឹ\0\0ើcup;樆ar;昅riangleĀdu៍្own;施p;斳plus;樄eåᑄåᒭarow;植ƀako៭ᠦᠵĀcn៲ᠣkƀlst៺֫᠂ozenge;槫riangleȀ;dlr᠒᠓᠘᠝斴own;斾eft;旂ight;斸k;搣Ʊᠫ\0ᠳƲᠯ\0ᠱ;斒;斑4;斓ck;斈ĀeoᠾᡍĀ;qᡃᡆ쀀=⃥uiv;쀀≡⃥t;挐Ȁptwxᡙᡞᡧᡬf;쀀𝕓Ā;tᏋᡣom»Ꮜtie;拈؀DHUVbdhmptuvᢅᢖᢪᢻᣗᣛᣬ᣿ᤅᤊᤐᤡȀLRlrᢎᢐᢒᢔ;敗;敔;敖;敓ʀ;DUduᢡᢢᢤᢦᢨ敐;敦;敩;敤;敧ȀLRlrᢳᢵᢷᢹ;敝;敚;敜;教΀;HLRhlrᣊᣋᣍᣏᣑᣓᣕ救;敬;散;敠;敫;敢;敟ox;槉ȀLRlrᣤᣦᣨᣪ;敕;敒;攐;攌ʀ;DUduڽ᣷᣹᣻᣽;敥;敨;攬;攴inus;抟lus;択imes;抠ȀLRlrᤙᤛᤝ᤟;敛;敘;攘;攔΀;HLRhlrᤰᤱᤳᤵᤷ᤻᤹攂;敪;敡;敞;攼;攤;攜Āevģ᥂bar耻¦䂦Ȁceioᥑᥖᥚᥠr;쀀𝒷mi;恏mĀ;e᜚᜜lƀ;bhᥨᥩᥫ䁜;槅sub;柈Ŭᥴ᥾lĀ;e᥹᥺怢t»᥺pƀ;Eeįᦅᦇ;檮Ā;qۜۛೡᦧ\0᧨ᨑᨕᨲ\0ᨷᩐ\0\0᪴\0\0᫁\0\0ᬡᬮ᭍᭒\0᯽\0ᰌƀcpr᦭ᦲ᧝ute;䄇̀;abcdsᦿᧀᧄ᧊᧕᧙戩nd;橄rcup;橉Āau᧏᧒p;橋p;橇ot;橀;쀀∩︀Āeo᧢᧥t;恁îړȀaeiu᧰᧻ᨁᨅǰ᧵\0᧸s;橍on;䄍dil耻ç䃧rc;䄉psĀ;sᨌᨍ橌m;橐ot;䄋ƀdmnᨛᨠᨦil肻¸ƭptyv;榲t脀¢;eᨭᨮ䂢räƲr;쀀𝔠ƀceiᨽᩀᩍy;䑇ckĀ;mᩇᩈ朓ark»ᩈ;䏇r΀;Ecefms᩟᩠ᩢᩫ᪤᪪᪮旋;槃ƀ;elᩩᩪᩭ䋆q;扗eɡᩴ\0\0᪈rrowĀlr᩼᪁eft;憺ight;憻ʀRSacd᪒᪔᪖᪚᪟»ཇ;擈st;抛irc;抚ash;抝nint;樐id;櫯cir;槂ubsĀ;u᪻᪼晣it»᪼ˬ᫇᫔᫺\0ᬊonĀ;eᫍᫎ䀺Ā;qÇÆɭ᫙\0\0᫢aĀ;t᫞᫟䀬;䁀ƀ;fl᫨᫩᫫戁îᅠeĀmx᫱᫶ent»᫩eóɍǧ᫾\0ᬇĀ;dኻᬂot;橭nôɆƀfryᬐᬔᬗ;쀀𝕔oäɔ脀©;sŕᬝr;愗Āaoᬥᬩrr;憵ss;朗Ācuᬲᬷr;쀀𝒸Ābpᬼ᭄Ā;eᭁᭂ櫏;櫑Ā;eᭉᭊ櫐;櫒dot;拯΀delprvw᭠᭬᭷ᮂᮬᯔ᯹arrĀlr᭨᭪;椸;椵ɰ᭲\0\0᭵r;拞c;拟arrĀ;p᭿ᮀ憶;椽̀;bcdosᮏᮐᮖᮡᮥᮨ截rcap;橈Āauᮛᮞp;橆p;橊ot;抍r;橅;쀀∪︀Ȁalrv᮵ᮿᯞᯣrrĀ;mᮼᮽ憷;椼yƀevwᯇᯔᯘqɰᯎ\0\0ᯒreã᭳uã᭵ee;拎edge;拏en耻¤䂤earrowĀlrᯮ᯳eft»ᮀight»ᮽeäᯝĀciᰁᰇoninôǷnt;戱lcty;挭ঀAHabcdefhijlorstuwz᰸᰻᰿ᱝᱩᱵᲊᲞᲬᲷ᳻᳿ᴍᵻᶑᶫᶻ᷆᷍rò΁ar;楥Ȁglrs᱈ᱍ᱒᱔ger;怠eth;愸òᄳhĀ;vᱚᱛ怐»ऊūᱡᱧarow;椏aã̕Āayᱮᱳron;䄏;䐴ƀ;ao̲ᱼᲄĀgrʿᲁr;懊tseq;橷ƀglmᲑᲔᲘ耻°䂰ta;䎴ptyv;榱ĀirᲣᲨsht;楿;쀀𝔡arĀlrᲳᲵ»ࣜ»သʀaegsv᳂͸᳖᳜᳠mƀ;oș᳊᳔ndĀ;ș᳑uit;晦amma;䏝in;拲ƀ;io᳧᳨᳸䃷de脀÷;o᳧ᳰntimes;拇nø᳷cy;䑒cɯᴆ\0\0ᴊrn;挞op;挍ʀlptuwᴘᴝᴢᵉᵕlar;䀤f;쀀𝕕ʀ;emps̋ᴭᴷᴽᵂqĀ;d͒ᴳot;扑inus;戸lus;戔quare;抡blebarwedgåúnƀadhᄮᵝᵧownarrowóᲃarpoonĀlrᵲᵶefôᲴighôᲶŢᵿᶅkaro÷གɯᶊ\0\0ᶎrn;挟op;挌ƀcotᶘᶣᶦĀryᶝᶡ;쀀𝒹;䑕l;槶rok;䄑Ādrᶰᶴot;拱iĀ;fᶺ᠖斿Āah᷀᷃ròЩaòྦangle;榦Āci᷒ᷕy;䑟grarr;柿ऀDacdefglmnopqrstuxḁḉḙḸոḼṉṡṾấắẽỡἪἷὄ὎὚ĀDoḆᴴoôᲉĀcsḎḔute耻é䃩ter;橮ȀaioyḢḧḱḶron;䄛rĀ;cḭḮ扖耻ê䃪lon;払;䑍ot;䄗ĀDrṁṅot;扒;쀀𝔢ƀ;rsṐṑṗ檚ave耻è䃨Ā;dṜṝ檖ot;檘Ȁ;ilsṪṫṲṴ檙nters;揧;愓Ā;dṹṺ檕ot;檗ƀapsẅẉẗcr;䄓tyƀ;svẒẓẕ戅et»ẓpĀ1;ẝẤĳạả;怄;怅怃ĀgsẪẬ;䅋p;怂ĀgpẴẸon;䄙f;쀀𝕖ƀalsỄỎỒrĀ;sỊị拕l;槣us;橱iƀ;lvỚớở䎵on»ớ;䏵ȀcsuvỪỳἋἣĀioữḱrc»Ḯɩỹ\0\0ỻíՈantĀglἂἆtr»ṝess»Ṻƀaeiἒ἖Ἒls;䀽st;扟vĀ;DȵἠD;橸parsl;槥ĀDaἯἳot;打rr;楱ƀcdiἾὁỸr;愯oô͒ĀahὉὋ;䎷耻ð䃰Āmrὓὗl耻ë䃫o;悬ƀcipὡὤὧl;䀡sôծĀeoὬὴctatioîՙnentialåչৡᾒ\0ᾞ\0ᾡᾧ\0\0ῆῌ\0ΐ\0ῦῪ \0 ⁚llingdotseñṄy;䑄male;晀ƀilrᾭᾳ῁lig;耀ﬃɩᾹ\0\0᾽g;耀ﬀig;耀ﬄ;쀀𝔣lig;耀ﬁlig;쀀fjƀaltῙ῜ῡt;晭ig;耀ﬂns;斱of;䆒ǰ΅\0ῳf;쀀𝕗ĀakֿῷĀ;vῼ´拔;櫙artint;樍Āao‌⁕Ācs‑⁒α‚‰‸⁅⁈\0⁐β•‥‧‪‬\0‮耻½䂽;慓耻¼䂼;慕;慙;慛Ƴ‴\0‶;慔;慖ʴ‾⁁\0\0⁃耻¾䂾;慗;慜5;慘ƶ⁌\0⁎;慚;慝8;慞l;恄wn;挢cr;쀀𝒻ࢀEabcdefgijlnorstv₂₉₟₥₰₴⃰⃵⃺⃿℃ℒℸ̗ℾ⅒↞Ā;lٍ₇;檌ƀcmpₐₕ₝ute;䇵maĀ;dₜ᳚䎳;檆reve;䄟Āiy₪₮rc;䄝;䐳ot;䄡Ȁ;lqsؾق₽⃉ƀ;qsؾٌ⃄lanô٥Ȁ;cdl٥⃒⃥⃕c;檩otĀ;o⃜⃝檀Ā;l⃢⃣檂;檄Ā;e⃪⃭쀀⋛︀s;檔r;쀀𝔤Ā;gٳ؛mel;愷cy;䑓Ȁ;Eajٚℌℎℐ;檒;檥;檤ȀEaesℛℝ℩ℴ;扩pĀ;p℣ℤ檊rox»ℤĀ;q℮ℯ檈Ā;q℮ℛim;拧pf;쀀𝕘Āci⅃ⅆr;愊mƀ;el٫ⅎ⅐;檎;檐茀>;cdlqr׮ⅠⅪⅮⅳⅹĀciⅥⅧ;檧r;橺ot;拗Par;榕uest;橼ʀadelsↄⅪ←ٖ↛ǰ↉\0↎proø₞r;楸qĀlqؿ↖lesó₈ií٫Āen↣↭rtneqq;쀀≩︀Å↪ԀAabcefkosy⇄⇇⇱⇵⇺∘∝∯≨≽ròΠȀilmr⇐⇔⇗⇛rsðᒄf»․ilôکĀdr⇠⇤cy;䑊ƀ;cwࣴ⇫⇯ir;楈;憭ar;意irc;䄥ƀalr∁∎∓rtsĀ;u∉∊晥it»∊lip;怦con;抹r;쀀𝔥sĀew∣∩arow;椥arow;椦ʀamopr∺∾≃≞≣rr;懿tht;戻kĀlr≉≓eftarrow;憩ightarrow;憪f;쀀𝕙bar;怕ƀclt≯≴≸r;쀀𝒽asè⇴rok;䄧Ābp⊂⊇ull;恃hen»ᱛૡ⊣\0⊪\0⊸⋅⋎\0⋕⋳\0\0⋸⌢⍧⍢⍿\0⎆⎪⎴cute耻í䃭ƀ;iyݱ⊰⊵rc耻î䃮;䐸Ācx⊼⊿y;䐵cl耻¡䂡ĀfrΟ⋉;쀀𝔦rave耻ì䃬Ȁ;inoܾ⋝⋩⋮Āin⋢⋦nt;樌t;戭fin;槜ta;愩lig;䄳ƀaop⋾⌚⌝ƀcgt⌅⌈⌗r;䄫ƀelpܟ⌏⌓inåގarôܠh;䄱f;抷ed;䆵ʀ;cfotӴ⌬⌱⌽⍁are;愅inĀ;t⌸⌹戞ie;槝doô⌙ʀ;celpݗ⍌⍐⍛⍡al;抺Āgr⍕⍙eróᕣã⍍arhk;樗rod;樼Ȁcgpt⍯⍲⍶⍻y;䑑on;䄯f;쀀𝕚a;䎹uest耻¿䂿Āci⎊⎏r;쀀𝒾nʀ;EdsvӴ⎛⎝⎡ӳ;拹ot;拵Ā;v⎦⎧拴;拳Ā;iݷ⎮lde;䄩ǫ⎸\0⎼cy;䑖l耻ï䃯̀cfmosu⏌⏗⏜⏡⏧⏵Āiy⏑⏕rc;䄵;䐹r;쀀𝔧ath;䈷pf;쀀𝕛ǣ⏬\0⏱r;쀀𝒿rcy;䑘kcy;䑔Ѐacfghjos␋␖␢␧␭␱␵␻ppaĀ;v␓␔䎺;䏰Āey␛␠dil;䄷;䐺r;쀀𝔨reen;䄸cy;䑅cy;䑜pf;쀀𝕜cr;쀀𝓀஀ABEHabcdefghjlmnoprstuv⑰⒁⒆⒍⒑┎┽╚▀♎♞♥♹♽⚚⚲⛘❝❨➋⟀⠁⠒ƀart⑷⑺⑼rò৆òΕail;椛arr;椎Ā;gঔ⒋;檋ar;楢ॣ⒥\0⒪\0⒱\0\0\0\0\0⒵Ⓔ\0ⓆⓈⓍ\0⓹ute;䄺mptyv;榴raîࡌbda;䎻gƀ;dlࢎⓁⓃ;榑åࢎ;檅uo耻«䂫rЀ;bfhlpst࢙ⓞⓦⓩ⓫⓮⓱⓵Ā;f࢝ⓣs;椟s;椝ë≒p;憫l;椹im;楳l;憢ƀ;ae⓿─┄檫il;椙Ā;s┉┊檭;쀀⪭︀ƀabr┕┙┝rr;椌rk;杲Āak┢┬cĀek┨┪;䁻;䁛Āes┱┳;榋lĀdu┹┻;榏;榍Ȁaeuy╆╋╖╘ron;䄾Ādi═╔il;䄼ìࢰâ┩;䐻Ȁcqrs╣╦╭╽a;椶uoĀ;rนᝆĀdu╲╷har;楧shar;楋h;憲ʀ;fgqs▋▌উ◳◿扤tʀahlrt▘▤▷◂◨rrowĀ;t࢙□aé⓶arpoonĀdu▯▴own»њp»०eftarrows;懇ightƀahs◍◖◞rrowĀ;sࣴࢧarpoonó྘quigarro÷⇰hreetimes;拋ƀ;qs▋ও◺lanôবʀ;cdgsব☊☍☝☨c;檨otĀ;o☔☕橿Ā;r☚☛檁;檃Ā;e☢☥쀀⋚︀s;檓ʀadegs☳☹☽♉♋pproøⓆot;拖qĀgq♃♅ôউgtò⒌ôছiíলƀilr♕࣡♚sht;楼;쀀𝔩Ā;Eজ♣;檑š♩♶rĀdu▲♮Ā;l॥♳;楪lk;斄cy;䑙ʀ;achtੈ⚈⚋⚑⚖rò◁orneòᴈard;楫ri;旺Āio⚟⚤dot;䅀ustĀ;a⚬⚭掰che»⚭ȀEaes⚻⚽⛉⛔;扨pĀ;p⛃⛄檉rox»⛄Ā;q⛎⛏檇Ā;q⛎⚻im;拦Ѐabnoptwz⛩⛴⛷✚✯❁❇❐Ānr⛮⛱g;柬r;懽rëࣁgƀlmr⛿✍✔eftĀar০✇ightá৲apsto;柼ightá৽parrowĀlr✥✩efô⓭ight;憬ƀafl✶✹✽r;榅;쀀𝕝us;樭imes;樴š❋❏st;戗áፎƀ;ef❗❘᠀旊nge»❘arĀ;l❤❥䀨t;榓ʀachmt❳❶❼➅➇ròࢨorneòᶌarĀ;d྘➃;業;怎ri;抿̀achiqt➘➝ੀ➢➮➻quo;怹r;쀀𝓁mƀ;egল➪➬;檍;檏Ābu┪➳oĀ;rฟ➹;怚rok;䅂萀<;cdhilqrࠫ⟒☹⟜⟠⟥⟪⟰Āci⟗⟙;檦r;橹reå◲mes;拉arr;楶uest;橻ĀPi⟵⟹ar;榖ƀ;ef⠀भ᠛旃rĀdu⠇⠍shar;楊har;楦Āen⠗⠡rtneqq;쀀≨︀Å⠞܀Dacdefhilnopsu⡀⡅⢂⢎⢓⢠⢥⢨⣚⣢⣤ઃ⣳⤂Dot;戺Ȁclpr⡎⡒⡣⡽r耻¯䂯Āet⡗⡙;時Ā;e⡞⡟朠se»⡟Ā;sျ⡨toȀ;dluျ⡳⡷⡻owîҌefôएðᏑker;斮Āoy⢇⢌mma;権;䐼ash;怔asuredangle»ᘦr;쀀𝔪o;愧ƀcdn⢯⢴⣉ro耻µ䂵Ȁ;acdᑤ⢽⣀⣄sôᚧir;櫰ot肻·Ƶusƀ;bd⣒ᤃ⣓戒Ā;uᴼ⣘;横ţ⣞⣡p;櫛ò−ðઁĀdp⣩⣮els;抧f;쀀𝕞Āct⣸⣽r;쀀𝓂pos»ᖝƀ;lm⤉⤊⤍䎼timap;抸ఀGLRVabcdefghijlmoprstuvw⥂⥓⥾⦉⦘⧚⧩⨕⨚⩘⩝⪃⪕⪤⪨⬄⬇⭄⭿⮮ⰴⱧⱼ⳩Āgt⥇⥋;쀀⋙̸Ā;v⥐௏쀀≫⃒ƀelt⥚⥲⥶ftĀar⥡⥧rrow;懍ightarrow;懎;쀀⋘̸Ā;v⥻ే쀀≪⃒ightarrow;懏ĀDd⦎⦓ash;抯ash;抮ʀbcnpt⦣⦧⦬⦱⧌la»˞ute;䅄g;쀀∠⃒ʀ;Eiop඄⦼⧀⧅⧈;쀀⩰̸d;쀀≋̸s;䅉roø඄urĀ;a⧓⧔普lĀ;s⧓ସǳ⧟\0⧣p肻 ଷmpĀ;e௹ఀʀaeouy⧴⧾⨃⨐⨓ǰ⧹\0⧻;橃on;䅈dil;䅆ngĀ;dൾ⨊ot;쀀⩭̸p;橂;䐽ash;怓΀;Aadqsxஒ⨩⨭⨻⩁⩅⩐rr;懗rĀhr⨳⨶k;椤Ā;oᏲᏰot;쀀≐̸uiöୣĀei⩊⩎ar;椨í஘istĀ;s஠டr;쀀𝔫ȀEest௅⩦⩹⩼ƀ;qs஼⩭௡ƀ;qs஼௅⩴lanô௢ií௪Ā;rஶ⪁»ஷƀAap⪊⪍⪑rò⥱rr;憮ar;櫲ƀ;svྍ⪜ྌĀ;d⪡⪢拼;拺cy;䑚΀AEadest⪷⪺⪾⫂⫅⫶⫹rò⥦;쀀≦̸rr;憚r;急Ȁ;fqs఻⫎⫣⫯tĀar⫔⫙rro÷⫁ightarro÷⪐ƀ;qs఻⪺⫪lanôౕĀ;sౕ⫴»శiíౝĀ;rవ⫾iĀ;eచథiäඐĀpt⬌⬑f;쀀𝕟膀¬;in⬙⬚⬶䂬nȀ;Edvஉ⬤⬨⬮;쀀⋹̸ot;쀀⋵̸ǡஉ⬳⬵;拷;拶iĀ;vಸ⬼ǡಸ⭁⭃;拾;拽ƀaor⭋⭣⭩rȀ;ast୻⭕⭚⭟lleì୻l;쀀⫽⃥;쀀∂̸lint;樔ƀ;ceಒ⭰⭳uåಥĀ;cಘ⭸Ā;eಒ⭽ñಘȀAait⮈⮋⮝⮧rò⦈rrƀ;cw⮔⮕⮙憛;쀀⤳̸;쀀↝̸ghtarrow»⮕riĀ;eೋೖ΀chimpqu⮽⯍⯙⬄୸⯤⯯Ȁ;cerല⯆ഷ⯉uå൅;쀀𝓃ortɭ⬅\0\0⯖ará⭖mĀ;e൮⯟Ā;q൴൳suĀbp⯫⯭å೸åഋƀbcp⯶ⰑⰙȀ;Ees⯿ⰀഢⰄ抄;쀀⫅̸etĀ;eഛⰋqĀ;qണⰀcĀ;eലⰗñസȀ;EesⰢⰣൟⰧ抅;쀀⫆̸etĀ;e൘ⰮqĀ;qൠⰣȀgilrⰽⰿⱅⱇìௗlde耻ñ䃱çృiangleĀlrⱒⱜeftĀ;eచⱚñదightĀ;eೋⱥñ೗Ā;mⱬⱭ䎽ƀ;esⱴⱵⱹ䀣ro;愖p;怇ҀDHadgilrsⲏⲔⲙⲞⲣⲰⲶⳓⳣash;抭arr;椄p;쀀≍⃒ash;抬ĀetⲨⲬ;쀀≥⃒;쀀>⃒nfin;槞ƀAetⲽⳁⳅrr;椂;쀀≤⃒Ā;rⳊⳍ쀀<⃒ie;쀀⊴⃒ĀAtⳘⳜrr;椃rie;쀀⊵⃒im;쀀∼⃒ƀAan⳰⳴ⴂrr;懖rĀhr⳺⳽k;椣Ā;oᏧᏥear;椧ቓ᪕\0\0\0\0\0\0\0\0\0\0\0\0\0ⴭ\0ⴸⵈⵠⵥ⵲ⶄᬇ\0\0ⶍⶫ\0ⷈⷎ\0ⷜ⸙⸫⸾⹃Ācsⴱ᪗ute耻ó䃳ĀiyⴼⵅrĀ;c᪞ⵂ耻ô䃴;䐾ʀabios᪠ⵒⵗǈⵚlac;䅑v;樸old;榼lig;䅓Ācr⵩⵭ir;榿;쀀𝔬ͯ⵹\0\0⵼\0ⶂn;䋛ave耻ò䃲;槁Ābmⶈ෴ar;榵Ȁacitⶕ⶘ⶥⶨrò᪀Āir⶝ⶠr;榾oss;榻nå๒;槀ƀaeiⶱⶵⶹcr;䅍ga;䏉ƀcdnⷀⷅǍron;䎿;榶pf;쀀𝕠ƀaelⷔ⷗ǒr;榷rp;榹΀;adiosvⷪⷫⷮ⸈⸍⸐⸖戨rò᪆Ȁ;efmⷷⷸ⸂⸅橝rĀ;oⷾⷿ愴f»ⷿ耻ª䂪耻º䂺gof;抶r;橖lope;橗;橛ƀclo⸟⸡⸧ò⸁ash耻ø䃸l;折iŬⸯ⸴de耻õ䃵esĀ;aǛ⸺s;樶ml耻ö䃶bar;挽ૡ⹞\0⹽\0⺀⺝\0⺢⺹\0\0⻋ຜ\0⼓\0\0⼫⾼\0⿈rȀ;astЃ⹧⹲຅脀¶;l⹭⹮䂶leìЃɩ⹸\0\0⹻m;櫳;櫽y;䐿rʀcimpt⺋⺏⺓ᡥ⺗nt;䀥od;䀮il;怰enk;怱r;쀀𝔭ƀimo⺨⺰⺴Ā;v⺭⺮䏆;䏕maô੶ne;明ƀ;tv⺿⻀⻈䏀chfork»´;䏖Āau⻏⻟nĀck⻕⻝kĀ;h⇴⻛;愎ö⇴sҀ;abcdemst⻳⻴ᤈ⻹⻽⼄⼆⼊⼎䀫cir;樣ir;樢Āouᵀ⼂;樥;橲n肻±ຝim;樦wo;樧ƀipu⼙⼠⼥ntint;樕f;쀀𝕡nd耻£䂣Ԁ;Eaceinosu່⼿⽁⽄⽇⾁⾉⾒⽾⾶;檳p;檷uå໙Ā;c໎⽌̀;acens່⽙⽟⽦⽨⽾pproø⽃urlyeñ໙ñ໎ƀaes⽯⽶⽺pprox;檹qq;檵im;拨iíໟmeĀ;s⾈ຮ怲ƀEas⽸⾐⽺ð⽵ƀdfp໬⾙⾯ƀals⾠⾥⾪lar;挮ine;挒urf;挓Ā;t໻⾴ï໻rel;抰Āci⿀⿅r;쀀𝓅;䏈ncsp;怈̀fiopsu⿚⋢⿟⿥⿫⿱r;쀀𝔮pf;쀀𝕢rime;恗cr;쀀𝓆ƀaeo⿸〉〓tĀei⿾々rnionóڰnt;樖stĀ;e【】䀿ñἙô༔઀ABHabcdefhilmnoprstux぀けさすムㄎㄫㅇㅢㅲㆎ㈆㈕㈤㈩㉘㉮㉲㊐㊰㊷ƀartぇおがròႳòϝail;検aròᱥar;楤΀cdenqrtとふへみわゔヌĀeuねぱ;쀀∽̱te;䅕iãᅮmptyv;榳gȀ;del࿑らるろ;榒;榥å࿑uo耻»䂻rր;abcfhlpstw࿜ガクシスゼゾダッデナp;極Ā;f࿠ゴs;椠;椳s;椞ë≝ð✮l;楅im;楴l;憣;憝Āaiパフil;椚oĀ;nホボ戶aló༞ƀabrョリヮrò៥rk;杳ĀakンヽcĀekヹ・;䁽;䁝Āes㄂㄄;榌lĀduㄊㄌ;榎;榐Ȁaeuyㄗㄜㄧㄩron;䅙Ādiㄡㄥil;䅗ì࿲âヺ;䑀Ȁclqsㄴㄷㄽㅄa;椷dhar;楩uoĀ;rȎȍh;憳ƀacgㅎㅟངlȀ;ipsླྀㅘㅛႜnåႻarôྩt;断ƀilrㅩဣㅮsht;楽;쀀𝔯ĀaoㅷㆆrĀduㅽㅿ»ѻĀ;l႑ㆄ;楬Ā;vㆋㆌ䏁;䏱ƀgns㆕ㇹㇼht̀ahlrstㆤㆰ㇂㇘㇤㇮rrowĀ;t࿜ㆭaéトarpoonĀduㆻㆿowîㅾp»႒eftĀah㇊㇐rrowó࿪arpoonóՑightarrows;應quigarro÷ニhreetimes;拌g;䋚ingdotseñἲƀahm㈍㈐㈓rò࿪aòՑ;怏oustĀ;a㈞㈟掱che»㈟mid;櫮Ȁabpt㈲㈽㉀㉒Ānr㈷㈺g;柭r;懾rëဃƀafl㉇㉊㉎r;榆;쀀𝕣us;樮imes;樵Āap㉝㉧rĀ;g㉣㉤䀩t;榔olint;樒arò㇣Ȁachq㉻㊀Ⴜ㊅quo;怺r;쀀𝓇Ābu・㊊oĀ;rȔȓƀhir㊗㊛㊠reåㇸmes;拊iȀ;efl㊪ၙᠡ㊫方tri;槎luhar;楨;愞ൡ㋕㋛㋟㌬㌸㍱\0㍺㎤\0\0㏬㏰\0㐨㑈㑚㒭㒱㓊㓱\0㘖\0\0㘳cute;䅛quï➺Ԁ;Eaceinpsyᇭ㋳㋵㋿㌂㌋㌏㌟㌦㌩;檴ǰ㋺\0㋼;檸on;䅡uåᇾĀ;dᇳ㌇il;䅟rc;䅝ƀEas㌖㌘㌛;檶p;檺im;择olint;樓iíሄ;䑁otƀ;be㌴ᵇ㌵担;橦΀Aacmstx㍆㍊㍗㍛㍞㍣㍭rr;懘rĀhr㍐㍒ë∨Ā;oਸ਼਴t耻§䂧i;䀻war;椩mĀin㍩ðnuóñt;朶rĀ;o㍶⁕쀀𝔰Ȁacoy㎂㎆㎑㎠rp;景Āhy㎋㎏cy;䑉;䑈rtɭ㎙\0\0㎜iäᑤaraì⹯耻­䂭Āgm㎨㎴maƀ;fv㎱㎲㎲䏃;䏂Ѐ;deglnprካ㏅㏉㏎㏖㏞㏡㏦ot;橪Ā;q኱ኰĀ;E㏓㏔檞;檠Ā;E㏛㏜檝;檟e;扆lus;樤arr;楲aròᄽȀaeit㏸㐈㐏㐗Āls㏽㐄lsetmé㍪hp;樳parsl;槤Ādlᑣ㐔e;挣Ā;e㐜㐝檪Ā;s㐢㐣檬;쀀⪬︀ƀflp㐮㐳㑂tcy;䑌Ā;b㐸㐹䀯Ā;a㐾㐿槄r;挿f;쀀𝕤aĀdr㑍ЂesĀ;u㑔㑕晠it»㑕ƀcsu㑠㑹㒟Āau㑥㑯pĀ;sᆈ㑫;쀀⊓︀pĀ;sᆴ㑵;쀀⊔︀uĀbp㑿㒏ƀ;esᆗᆜ㒆etĀ;eᆗ㒍ñᆝƀ;esᆨᆭ㒖etĀ;eᆨ㒝ñᆮƀ;afᅻ㒦ְrť㒫ֱ»ᅼaròᅈȀcemt㒹㒾㓂㓅r;쀀𝓈tmîñiì㐕aræᆾĀar㓎㓕rĀ;f㓔ឿ昆Āan㓚㓭ightĀep㓣㓪psiloîỠhé⺯s»⡒ʀbcmnp㓻㕞ሉ㖋㖎Ҁ;Edemnprs㔎㔏㔑㔕㔞㔣㔬㔱㔶抂;櫅ot;檽Ā;dᇚ㔚ot;櫃ult;櫁ĀEe㔨㔪;櫋;把lus;檿arr;楹ƀeiu㔽㕒㕕tƀ;en㔎㕅㕋qĀ;qᇚ㔏eqĀ;q㔫㔨m;櫇Ābp㕚㕜;櫕;櫓c̀;acensᇭ㕬㕲㕹㕻㌦pproø㋺urlyeñᇾñᇳƀaes㖂㖈㌛pproø㌚qñ㌗g;晪ڀ123;Edehlmnps㖩㖬㖯ሜ㖲㖴㗀㗉㗕㗚㗟㗨㗭耻¹䂹耻²䂲耻³䂳;櫆Āos㖹㖼t;檾ub;櫘Ā;dሢ㗅ot;櫄sĀou㗏㗒l;柉b;櫗arr;楻ult;櫂ĀEe㗤㗦;櫌;抋lus;櫀ƀeiu㗴㘉㘌tƀ;enሜ㗼㘂qĀ;qሢ㖲eqĀ;q㗧㗤m;櫈Ābp㘑㘓;櫔;櫖ƀAan㘜㘠㘭rr;懙rĀhr㘦㘨ë∮Ā;oਫ਩war;椪lig耻ß䃟௡㙑㙝㙠ዎ㙳㙹\0㙾㛂\0\0\0\0\0㛛㜃\0㜉㝬\0\0\0㞇ɲ㙖\0\0㙛get;挖;䏄rë๟ƀaey㙦㙫㙰ron;䅥dil;䅣;䑂lrec;挕r;쀀𝔱Ȁeiko㚆㚝㚵㚼ǲ㚋\0㚑eĀ4fኄኁaƀ;sv㚘㚙㚛䎸ym;䏑Ācn㚢㚲kĀas㚨㚮pproø዁im»ኬsðኞĀas㚺㚮ð዁rn耻þ䃾Ǭ̟㛆⋧es膀×;bd㛏㛐㛘䃗Ā;aᤏ㛕r;樱;樰ƀeps㛡㛣㜀á⩍Ȁ;bcf҆㛬㛰㛴ot;挶ir;櫱Ā;o㛹㛼쀀𝕥rk;櫚á㍢rime;怴ƀaip㜏㜒㝤dåቈ΀adempst㜡㝍㝀㝑㝗㝜㝟ngleʀ;dlqr㜰㜱㜶㝀㝂斵own»ᶻeftĀ;e⠀㜾ñम;扜ightĀ;e㊪㝋ñၚot;旬inus;樺lus;樹b;槍ime;樻ezium;揢ƀcht㝲㝽㞁Āry㝷㝻;쀀𝓉;䑆cy;䑛rok;䅧Āio㞋㞎xô᝷headĀlr㞗㞠eftarro÷ࡏightarrow»ཝऀAHabcdfghlmoprstuw㟐㟓㟗㟤㟰㟼㠎㠜㠣㠴㡑㡝㡫㢩㣌㣒㣪㣶ròϭar;楣Ācr㟜㟢ute耻ú䃺òᅐrǣ㟪\0㟭y;䑞ve;䅭Āiy㟵㟺rc耻û䃻;䑃ƀabh㠃㠆㠋ròᎭlac;䅱aòᏃĀir㠓㠘sht;楾;쀀𝔲rave耻ù䃹š㠧㠱rĀlr㠬㠮»ॗ»ႃlk;斀Āct㠹㡍ɯ㠿\0\0㡊rnĀ;e㡅㡆挜r»㡆op;挏ri;旸Āal㡖㡚cr;䅫肻¨͉Āgp㡢㡦on;䅳f;쀀𝕦̀adhlsuᅋ㡸㡽፲㢑㢠ownáᎳarpoonĀlr㢈㢌efô㠭ighô㠯iƀ;hl㢙㢚㢜䏅»ᏺon»㢚parrows;懈ƀcit㢰㣄㣈ɯ㢶\0\0㣁rnĀ;e㢼㢽挝r»㢽op;挎ng;䅯ri;旹cr;쀀𝓊ƀdir㣙㣝㣢ot;拰lde;䅩iĀ;f㜰㣨»᠓Āam㣯㣲rò㢨l耻ü䃼angle;榧ހABDacdeflnoprsz㤜㤟㤩㤭㦵㦸㦽㧟㧤㧨㧳㧹㧽㨁㨠ròϷarĀ;v㤦㤧櫨;櫩asèϡĀnr㤲㤷grt;榜΀eknprst㓣㥆㥋㥒㥝㥤㦖appá␕othinçẖƀhir㓫⻈㥙opô⾵Ā;hᎷ㥢ïㆍĀiu㥩㥭gmá㎳Ābp㥲㦄setneqĀ;q㥽㦀쀀⊊︀;쀀⫋︀setneqĀ;q㦏㦒쀀⊋︀;쀀⫌︀Āhr㦛㦟etá㚜iangleĀlr㦪㦯eft»थight»ၑy;䐲ash»ံƀelr㧄㧒㧗ƀ;beⷪ㧋㧏ar;抻q;扚lip;拮Ābt㧜ᑨaòᑩr;쀀𝔳tré㦮suĀbp㧯㧱»ജ»൙pf;쀀𝕧roð໻tré㦴Ācu㨆㨋r;쀀𝓋Ābp㨐㨘nĀEe㦀㨖»㥾nĀEe㦒㨞»㦐igzag;榚΀cefoprs㨶㨻㩖㩛㩔㩡㩪irc;䅵Ādi㩀㩑Ābg㩅㩉ar;機eĀ;qᗺ㩏;扙erp;愘r;쀀𝔴pf;쀀𝕨Ā;eᑹ㩦atèᑹcr;쀀𝓌ૣណ㪇\0㪋\0㪐㪛\0\0㪝㪨㪫㪯\0\0㫃㫎\0㫘ៜ៟tré៑r;쀀𝔵ĀAa㪔㪗ròσrò৶;䎾ĀAa㪡㪤ròθrò৫að✓is;拻ƀdptឤ㪵㪾Āfl㪺ឩ;쀀𝕩imåឲĀAa㫇㫊ròώròਁĀcq㫒ីr;쀀𝓍Āpt៖㫜ré។Ѐacefiosu㫰㫽㬈㬌㬑㬕㬛㬡cĀuy㫶㫻te耻ý䃽;䑏Āiy㬂㬆rc;䅷;䑋n耻¥䂥r;쀀𝔶cy;䑗pf;쀀𝕪cr;쀀𝓎Ācm㬦㬩y;䑎l耻ÿ䃿Ԁacdefhiosw㭂㭈㭔㭘㭤㭩㭭㭴㭺㮀cute;䅺Āay㭍㭒ron;䅾;䐷ot;䅼Āet㭝㭡træᕟa;䎶r;쀀𝔷cy;䐶grarr;懝pf;쀀𝕫cr;쀀𝓏Ājn㮅㮇;怍j;怌'.split("").map(i=>i.charCodeAt(0))),sf=new Uint16Array("Ȁaglq	\x1Bɭ\0\0p;䀦os;䀧t;䀾t;䀼uot;䀢".split("").map(i=>i.charCodeAt(0)));var jr;const of=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]),lf=(jr=String.fromCodePoint)!==null&&jr!==void 0?jr:function(i){let e="";return i>65535&&(i-=65536,e+=String.fromCharCode(i>>>10&1023|55296),i=56320|i&1023),e+=String.fromCharCode(i),e};function cf(i){var e;return i>=55296&&i<=57343||i>1114111?65533:(e=of.get(i))!==null&&e!==void 0?e:i}var dt;(function(i){i[i.NUM=35]="NUM",i[i.SEMI=59]="SEMI",i[i.EQUALS=61]="EQUALS",i[i.ZERO=48]="ZERO",i[i.NINE=57]="NINE",i[i.LOWER_A=97]="LOWER_A",i[i.LOWER_F=102]="LOWER_F",i[i.LOWER_X=120]="LOWER_X",i[i.LOWER_Z=122]="LOWER_Z",i[i.UPPER_A=65]="UPPER_A",i[i.UPPER_F=70]="UPPER_F",i[i.UPPER_Z=90]="UPPER_Z"})(dt||(dt={}));const uf=32;var Li;(function(i){i[i.VALUE_LENGTH=49152]="VALUE_LENGTH",i[i.BRANCH_LENGTH=16256]="BRANCH_LENGTH",i[i.JUMP_TABLE=127]="JUMP_TABLE"})(Li||(Li={}));function Ts(i){return i>=dt.ZERO&&i<=dt.NINE}function df(i){return i>=dt.UPPER_A&&i<=dt.UPPER_F||i>=dt.LOWER_A&&i<=dt.LOWER_F}function hf(i){return i>=dt.UPPER_A&&i<=dt.UPPER_Z||i>=dt.LOWER_A&&i<=dt.LOWER_Z||Ts(i)}function ff(i){return i===dt.EQUALS||hf(i)}var ut;(function(i){i[i.EntityStart=0]="EntityStart",i[i.NumericStart=1]="NumericStart",i[i.NumericDecimal=2]="NumericDecimal",i[i.NumericHex=3]="NumericHex",i[i.NamedEntity=4]="NamedEntity"})(ut||(ut={}));var Ti;(function(i){i[i.Legacy=0]="Legacy",i[i.Strict=1]="Strict",i[i.Attribute=2]="Attribute"})(Ti||(Ti={}));class pf{constructor(e,t,n){this.decodeTree=e,this.emitCodePoint=t,this.errors=n,this.state=ut.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=Ti.Strict}startEntity(e){this.decodeMode=e,this.state=ut.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1}write(e,t){switch(this.state){case ut.EntityStart:return e.charCodeAt(t)===dt.NUM?(this.state=ut.NumericStart,this.consumed+=1,this.stateNumericStart(e,t+1)):(this.state=ut.NamedEntity,this.stateNamedEntity(e,t));case ut.NumericStart:return this.stateNumericStart(e,t);case ut.NumericDecimal:return this.stateNumericDecimal(e,t);case ut.NumericHex:return this.stateNumericHex(e,t);case ut.NamedEntity:return this.stateNamedEntity(e,t)}}stateNumericStart(e,t){return t>=e.length?-1:(e.charCodeAt(t)|uf)===dt.LOWER_X?(this.state=ut.NumericHex,this.consumed+=1,this.stateNumericHex(e,t+1)):(this.state=ut.NumericDecimal,this.stateNumericDecimal(e,t))}addToNumericResult(e,t,n,a){if(t!==n){const r=n-t;this.result=this.result*Math.pow(a,r)+parseInt(e.substr(t,r),a),this.consumed+=r}}stateNumericHex(e,t){const n=t;for(;t<e.length;){const a=e.charCodeAt(t);if(Ts(a)||df(a))t+=1;else return this.addToNumericResult(e,n,t,16),this.emitNumericEntity(a,3)}return this.addToNumericResult(e,n,t,16),-1}stateNumericDecimal(e,t){const n=t;for(;t<e.length;){const a=e.charCodeAt(t);if(Ts(a))t+=1;else return this.addToNumericResult(e,n,t,10),this.emitNumericEntity(a,2)}return this.addToNumericResult(e,n,t,10),-1}emitNumericEntity(e,t){var n;if(this.consumed<=t)return(n=this.errors)===null||n===void 0||n.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(e===dt.SEMI)this.consumed+=1;else if(this.decodeMode===Ti.Strict)return 0;return this.emitCodePoint(cf(this.result),this.consumed),this.errors&&(e!==dt.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed}stateNamedEntity(e,t){const{decodeTree:n}=this;let a=n[this.treeIndex],r=(a&Li.VALUE_LENGTH)>>14;for(;t<e.length;t++,this.excess++){const s=e.charCodeAt(t);if(this.treeIndex=mf(n,a,this.treeIndex+Math.max(1,r),s),this.treeIndex<0)return this.result===0||this.decodeMode===Ti.Attribute&&(r===0||ff(s))?0:this.emitNotTerminatedNamedEntity();if(a=n[this.treeIndex],r=(a&Li.VALUE_LENGTH)>>14,r!==0){if(s===dt.SEMI)return this.emitNamedEntityData(this.treeIndex,r,this.consumed+this.excess);this.decodeMode!==Ti.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1}emitNotTerminatedNamedEntity(){var e;const{result:t,decodeTree:n}=this,a=(n[t]&Li.VALUE_LENGTH)>>14;return this.emitNamedEntityData(t,a,this.consumed),(e=this.errors)===null||e===void 0||e.missingSemicolonAfterCharacterReference(),this.consumed}emitNamedEntityData(e,t,n){const{decodeTree:a}=this;return this.emitCodePoint(t===1?a[e]&~Li.VALUE_LENGTH:a[e+1],n),t===3&&this.emitCodePoint(a[e+2],n),n}end(){var e;switch(this.state){case ut.NamedEntity:return this.result!==0&&(this.decodeMode!==Ti.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case ut.NumericDecimal:return this.emitNumericEntity(0,2);case ut.NumericHex:return this.emitNumericEntity(0,3);case ut.NumericStart:return(e=this.errors)===null||e===void 0||e.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case ut.EntityStart:return 0}}}function tu(i){let e="";const t=new pf(i,n=>e+=lf(n));return function(a,r){let s=0,o=0;for(;(o=a.indexOf("&",o))>=0;){e+=a.slice(s,o),t.startEntity(r);const u=t.write(a,o+1);if(u<0){s=o+t.end();break}s=o+u,o=u===0?s+1:s}const l=e+a.slice(s);return e="",l}}function mf(i,e,t,n){const a=(e&Li.BRANCH_LENGTH)>>7,r=e&Li.JUMP_TABLE;if(a===0)return r!==0&&n===r?t:-1;if(r){const l=n-r;return l<0||l>=a?-1:i[t+l]-1}let s=t,o=s+a-1;for(;s<=o;){const l=s+o>>>1,u=i[l];if(u<n)s=l+1;else if(u>n)o=l-1;else return i[l+a]}return-1}const gf=tu(rf);tu(sf);function iu(i,e=Ti.Legacy){return gf(i,e)}function bf(i){return Object.prototype.toString.call(i)}function ao(i){return bf(i)==="[object String]"}const yf=Object.prototype.hasOwnProperty;function wf(i,e){return yf.call(i,e)}function qa(i){return Array.prototype.slice.call(arguments,1).forEach(function(t){if(t){if(typeof t!="object")throw new TypeError(t+"must be object");Object.keys(t).forEach(function(n){i[n]=t[n]})}}),i}function nu(i,e,t){return[].concat(i.slice(0,e),t,i.slice(e+1))}function ro(i){return!(i>=55296&&i<=57343||i>=64976&&i<=65007||(i&65535)===65535||(i&65535)===65534||i>=0&&i<=8||i===11||i>=14&&i<=31||i>=127&&i<=159||i>1114111)}function Ma(i){if(i>65535){i-=65536;const e=55296+(i>>10),t=56320+(i&1023);return String.fromCharCode(e,t)}return String.fromCharCode(i)}const au=/\\([!"#$%&'()*+,\-./:;<=>?@[\\\]^_`{|}~])/g,vf=/&([a-z#][a-z0-9]{1,31});/gi,xf=new RegExp(au.source+"|"+vf.source,"gi"),_f=/^#((?:x[a-f0-9]{1,8}|[0-9]{1,8}))$/i;function Cf(i,e){if(e.charCodeAt(0)===35&&_f.test(e)){const n=e[1].toLowerCase()==="x"?parseInt(e.slice(2),16):parseInt(e.slice(1),10);return ro(n)?Ma(n):i}const t=iu(i);return t!==i?t:i}function Ef(i){return i.indexOf("\\")<0?i:i.replace(au,"$1")}function cn(i){return i.indexOf("\\")<0&&i.indexOf("&")<0?i:i.replace(xf,function(e,t,n){return t||Cf(e,n)})}const Af=/[&<>"]/,kf=/[&<>"]/g,Sf={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};function Tf(i){return Sf[i]}function Bi(i){return Af.test(i)?i.replace(kf,Tf):i}const Mf=/[.?*+^$[\]\\(){}|-]/g;function Df(i){return i.replace(Mf,"\\$&")}function Xe(i){switch(i){case 9:case 32:return!0}return!1}function Vn(i){if(i>=8192&&i<=8202)return!0;switch(i){case 9:case 10:case 11:case 12:case 13:case 32:case 160:case 5760:case 8239:case 8287:case 12288:return!0}return!1}function Wn(i){return no.test(i)||Jc.test(i)}function Un(i){switch(i){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 58:case 59:case 60:case 61:case 62:case 63:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 124:case 125:case 126:return!0;default:return!1}}function Ga(i){return i=i.trim().replace(/\s+/g," "),"ẞ".toLowerCase()==="Ṿ"&&(i=i.replace(/ẞ/g,"ß")),i.toLowerCase().toUpperCase()}const Lf={mdurl:tf,ucmicro:af},Bf=Object.freeze(Object.defineProperty({__proto__:null,arrayReplaceAt:nu,assign:qa,escapeHtml:Bi,escapeRE:Df,fromCodePoint:Ma,has:wf,isMdAsciiPunct:Un,isPunctChar:Wn,isSpace:Xe,isString:ao,isValidEntityCode:ro,isWhiteSpace:Vn,lib:Lf,normalizeReference:Ga,unescapeAll:cn,unescapeMd:Ef},Symbol.toStringTag,{value:"Module"}));function Ff(i,e,t){let n,a,r,s;const o=i.posMax,l=i.pos;for(i.pos=e+1,n=1;i.pos<o;){if(r=i.src.charCodeAt(i.pos),r===93&&(n--,n===0)){a=!0;break}if(s=i.pos,i.md.inline.skipToken(i),r===91){if(s===i.pos-1)n++;else if(t)return i.pos=l,-1}}let u=-1;return a&&(u=i.pos),i.pos=l,u}function If(i,e,t){let n,a=e;const r={ok:!1,pos:0,str:""};if(i.charCodeAt(a)===60){for(a++;a<t;){if(n=i.charCodeAt(a),n===10||n===60)return r;if(n===62)return r.pos=a+1,r.str=cn(i.slice(e+1,a)),r.ok=!0,r;if(n===92&&a+1<t){a+=2;continue}a++}return r}let s=0;for(;a<t&&(n=i.charCodeAt(a),!(n===32||n<32||n===127));){if(n===92&&a+1<t){if(i.charCodeAt(a+1)===32)break;a+=2;continue}if(n===40&&(s++,s>32))return r;if(n===41){if(s===0)break;s--}a++}return e===a||s!==0||(r.str=cn(i.slice(e,a)),r.pos=a,r.ok=!0),r}function Rf(i,e,t,n){let a,r=e;const s={ok:!1,can_continue:!1,pos:0,str:"",marker:0};if(n)s.str=n.str,s.marker=n.marker;else{if(r>=t)return s;let o=i.charCodeAt(r);if(o!==34&&o!==39&&o!==40)return s;e++,r++,o===40&&(o=41),s.marker=o}for(;r<t;){if(a=i.charCodeAt(r),a===s.marker)return s.pos=r+1,s.str+=cn(i.slice(e,r)),s.ok=!0,s;if(a===40&&s.marker===41)return s;a===92&&r+1<t&&r++,r++}return s.can_continue=!0,s.str+=cn(i.slice(e,r)),s}const Pf=Object.freeze(Object.defineProperty({__proto__:null,parseLinkDestination:If,parseLinkLabel:Ff,parseLinkTitle:Rf},Symbol.toStringTag,{value:"Module"})),ci={};ci.code_inline=function(i,e,t,n,a){const r=i[e];return"<code"+a.renderAttrs(r)+">"+Bi(r.content)+"</code>"};ci.code_block=function(i,e,t,n,a){const r=i[e];return"<pre"+a.renderAttrs(r)+"><code>"+Bi(i[e].content)+`</code></pre>
`};ci.fence=function(i,e,t,n,a){const r=i[e],s=r.info?cn(r.info).trim():"";let o="",l="";if(s){const f=s.split(/(\s+)/g);o=f[0],l=f.slice(2).join("")}let u;if(t.highlight?u=t.highlight(r.content,o,l)||Bi(r.content):u=Bi(r.content),u.indexOf("<pre")===0)return u+`
`;if(s){const f=r.attrIndex("class"),c=r.attrs?r.attrs.slice():[];f<0?c.push(["class",t.langPrefix+o]):(c[f]=c[f].slice(),c[f][1]+=" "+t.langPrefix+o);const d={attrs:c};return`<pre><code${a.renderAttrs(d)}>${u}</code></pre>
`}return`<pre><code${a.renderAttrs(r)}>${u}</code></pre>
`};ci.image=function(i,e,t,n,a){const r=i[e];return r.attrs[r.attrIndex("alt")][1]=a.renderInlineAsText(r.children,t,n),a.renderToken(i,e,t)};ci.hardbreak=function(i,e,t){return t.xhtmlOut?`<br />
`:`<br>
`};ci.softbreak=function(i,e,t){return t.breaks?t.xhtmlOut?`<br />
`:`<br>
`:`
`};ci.text=function(i,e){return Bi(i[e].content)};ci.html_block=function(i,e){return i[e].content};ci.html_inline=function(i,e){return i[e].content};function hn(){this.rules=qa({},ci)}hn.prototype.renderAttrs=function(e){let t,n,a;if(!e.attrs)return"";for(a="",t=0,n=e.attrs.length;t<n;t++)a+=" "+Bi(e.attrs[t][0])+'="'+Bi(e.attrs[t][1])+'"';return a};hn.prototype.renderToken=function(e,t,n){const a=e[t];let r="";if(a.hidden)return"";a.block&&a.nesting!==-1&&t&&e[t-1].hidden&&(r+=`
`),r+=(a.nesting===-1?"</":"<")+a.tag,r+=this.renderAttrs(a),a.nesting===0&&n.xhtmlOut&&(r+=" /");let s=!1;if(a.block&&(s=!0,a.nesting===1&&t+1<e.length)){const o=e[t+1];(o.type==="inline"||o.hidden||o.nesting===-1&&o.tag===a.tag)&&(s=!1)}return r+=s?`>
`:">",r};hn.prototype.renderInline=function(i,e,t){let n="";const a=this.rules;for(let r=0,s=i.length;r<s;r++){const o=i[r].type;typeof a[o]<"u"?n+=a[o](i,r,e,t,this):n+=this.renderToken(i,r,e)}return n};hn.prototype.renderInlineAsText=function(i,e,t){let n="";for(let a=0,r=i.length;a<r;a++)switch(i[a].type){case"text":n+=i[a].content;break;case"image":n+=this.renderInlineAsText(i[a].children,e,t);break;case"html_inline":case"html_block":n+=i[a].content;break;case"softbreak":case"hardbreak":n+=`
`;break}return n};hn.prototype.render=function(i,e,t){let n="";const a=this.rules;for(let r=0,s=i.length;r<s;r++){const o=i[r].type;o==="inline"?n+=this.renderInline(i[r].children,e,t):typeof a[o]<"u"?n+=a[o](i,r,e,t,this):n+=this.renderToken(i,r,e,t)}return n};function St(){this.__rules__=[],this.__cache__=null}St.prototype.__find__=function(i){for(let e=0;e<this.__rules__.length;e++)if(this.__rules__[e].name===i)return e;return-1};St.prototype.__compile__=function(){const i=this,e=[""];i.__rules__.forEach(function(t){t.enabled&&t.alt.forEach(function(n){e.indexOf(n)<0&&e.push(n)})}),i.__cache__={},e.forEach(function(t){i.__cache__[t]=[],i.__rules__.forEach(function(n){n.enabled&&(t&&n.alt.indexOf(t)<0||i.__cache__[t].push(n.fn))})})};St.prototype.at=function(i,e,t){const n=this.__find__(i),a=t||{};if(n===-1)throw new Error("Parser rule not found: "+i);this.__rules__[n].fn=e,this.__rules__[n].alt=a.alt||[],this.__cache__=null};St.prototype.before=function(i,e,t,n){const a=this.__find__(i),r=n||{};if(a===-1)throw new Error("Parser rule not found: "+i);this.__rules__.splice(a,0,{name:e,enabled:!0,fn:t,alt:r.alt||[]}),this.__cache__=null};St.prototype.after=function(i,e,t,n){const a=this.__find__(i),r=n||{};if(a===-1)throw new Error("Parser rule not found: "+i);this.__rules__.splice(a+1,0,{name:e,enabled:!0,fn:t,alt:r.alt||[]}),this.__cache__=null};St.prototype.push=function(i,e,t){const n=t||{};this.__rules__.push({name:i,enabled:!0,fn:e,alt:n.alt||[]}),this.__cache__=null};St.prototype.enable=function(i,e){Array.isArray(i)||(i=[i]);const t=[];return i.forEach(function(n){const a=this.__find__(n);if(a<0){if(e)return;throw new Error("Rules manager: invalid rule name "+n)}this.__rules__[a].enabled=!0,t.push(n)},this),this.__cache__=null,t};St.prototype.enableOnly=function(i,e){Array.isArray(i)||(i=[i]),this.__rules__.forEach(function(t){t.enabled=!1}),this.enable(i,e)};St.prototype.disable=function(i,e){Array.isArray(i)||(i=[i]);const t=[];return i.forEach(function(n){const a=this.__find__(n);if(a<0){if(e)return;throw new Error("Rules manager: invalid rule name "+n)}this.__rules__[a].enabled=!1,t.push(n)},this),this.__cache__=null,t};St.prototype.getRules=function(i){return this.__cache__===null&&this.__compile__(),this.__cache__[i]||[]};function Yt(i,e,t){this.type=i,this.tag=e,this.attrs=null,this.map=null,this.nesting=t,this.level=0,this.children=null,this.content="",this.markup="",this.info="",this.meta=null,this.block=!1,this.hidden=!1}Yt.prototype.attrIndex=function(e){if(!this.attrs)return-1;const t=this.attrs;for(let n=0,a=t.length;n<a;n++)if(t[n][0]===e)return n;return-1};Yt.prototype.attrPush=function(e){this.attrs?this.attrs.push(e):this.attrs=[e]};Yt.prototype.attrSet=function(e,t){const n=this.attrIndex(e),a=[e,t];n<0?this.attrPush(a):this.attrs[n]=a};Yt.prototype.attrGet=function(e){const t=this.attrIndex(e);let n=null;return t>=0&&(n=this.attrs[t][1]),n};Yt.prototype.attrJoin=function(e,t){const n=this.attrIndex(e);n<0?this.attrPush([e,t]):this.attrs[n][1]=this.attrs[n][1]+" "+t};function ru(i,e,t){this.src=i,this.env=t,this.tokens=[],this.inlineMode=!1,this.md=e}ru.prototype.Token=Yt;const Of=/\r\n?|\n/g,Nf=/\0/g;function Hf(i){let e;e=i.src.replace(Of,`
`),e=e.replace(Nf,"�"),i.src=e}function zf(i){let e;i.inlineMode?(e=new i.Token("inline","",0),e.content=i.src,e.map=[0,1],e.children=[],i.tokens.push(e)):i.md.block.parse(i.src,i.md,i.env,i.tokens)}function Vf(i){const e=i.tokens;for(let t=0,n=e.length;t<n;t++){const a=e[t];a.type==="inline"&&i.md.inline.parse(a.content,i.md,i.env,a.children)}}function Wf(i){return/^<a[>\s]/i.test(i)}function Uf(i){return/^<\/a\s*>/i.test(i)}function qf(i){const e=i.tokens;if(i.md.options.linkify)for(let t=0,n=e.length;t<n;t++){if(e[t].type!=="inline"||!i.md.linkify.pretest(e[t].content))continue;let a=e[t].children,r=0;for(let s=a.length-1;s>=0;s--){const o=a[s];if(o.type==="link_close"){for(s--;a[s].level!==o.level&&a[s].type!=="link_open";)s--;continue}if(o.type==="html_inline"&&(Wf(o.content)&&r>0&&r--,Uf(o.content)&&r++),!(r>0)&&o.type==="text"&&i.md.linkify.test(o.content)){const l=o.content;let u=i.md.linkify.match(l);const f=[];let c=o.level,d=0;u.length>0&&u[0].index===0&&s>0&&a[s-1].type==="text_special"&&(u=u.slice(1));for(let h=0;h<u.length;h++){const p=u[h].url,m=i.md.normalizeLink(p);if(!i.md.validateLink(m))continue;let g=u[h].text;u[h].schema?u[h].schema==="mailto:"&&!/^mailto:/i.test(g)?g=i.md.normalizeLinkText("mailto:"+g).replace(/^mailto:/,""):g=i.md.normalizeLinkText(g):g=i.md.normalizeLinkText("http://"+g).replace(/^http:\/\//,"");const b=u[h].index;if(b>d){const E=new i.Token("text","",0);E.content=l.slice(d,b),E.level=c,f.push(E)}const x=new i.Token("link_open","a",1);x.attrs=[["href",m]],x.level=c++,x.markup="linkify",x.info="auto",f.push(x);const v=new i.Token("text","",0);v.content=g,v.level=c,f.push(v);const C=new i.Token("link_close","a",-1);C.level=--c,C.markup="linkify",C.info="auto",f.push(C),d=u[h].lastIndex}if(d<l.length){const h=new i.Token("text","",0);h.content=l.slice(d),h.level=c,f.push(h)}e[t].children=a=nu(a,s,f)}}}}const su=/\+-|\.\.|\?\?\?\?|!!!!|,,|--/,Gf=/\((c|tm|r)\)/i,$f=/\((c|tm|r)\)/ig,jf={c:"©",r:"®",tm:"™"};function Yf(i,e){return jf[e.toLowerCase()]}function Kf(i){let e=0;for(let t=i.length-1;t>=0;t--){const n=i[t];n.type==="text"&&!e&&(n.content=n.content.replace($f,Yf)),n.type==="link_open"&&n.info==="auto"&&e--,n.type==="link_close"&&n.info==="auto"&&e++}}function Xf(i){let e=0;for(let t=i.length-1;t>=0;t--){const n=i[t];n.type==="text"&&!e&&su.test(n.content)&&(n.content=n.content.replace(/\+-/g,"±").replace(/\.{2,}/g,"…").replace(/([?!])…/g,"$1..").replace(/([?!]){4,}/g,"$1$1$1").replace(/,{2,}/g,",").replace(/(^|[^-])---(?=[^-]|$)/mg,"$1—").replace(/(^|\s)--(?=\s|$)/mg,"$1–").replace(/(^|[^-\s])--(?=[^-\s]|$)/mg,"$1–")),n.type==="link_open"&&n.info==="auto"&&e--,n.type==="link_close"&&n.info==="auto"&&e++}}function Zf(i){let e;if(i.md.options.typographer)for(e=i.tokens.length-1;e>=0;e--)i.tokens[e].type==="inline"&&(Gf.test(i.tokens[e].content)&&Kf(i.tokens[e].children),su.test(i.tokens[e].content)&&Xf(i.tokens[e].children))}const Qf=/['"]/,Bl=/['"]/g,Fl="’";function ra(i,e,t){return i.slice(0,e)+t+i.slice(e+1)}function Jf(i,e){let t;const n=[];for(let a=0;a<i.length;a++){const r=i[a],s=i[a].level;for(t=n.length-1;t>=0&&!(n[t].level<=s);t--);if(n.length=t+1,r.type!=="text")continue;let o=r.content,l=0,u=o.length;e:for(;l<u;){Bl.lastIndex=l;const f=Bl.exec(o);if(!f)break;let c=!0,d=!0;l=f.index+1;const h=f[0]==="'";let p=32;if(f.index-1>=0)p=o.charCodeAt(f.index-1);else for(t=a-1;t>=0&&!(i[t].type==="softbreak"||i[t].type==="hardbreak");t--)if(i[t].content){p=i[t].content.charCodeAt(i[t].content.length-1);break}let m=32;if(l<u)m=o.charCodeAt(l);else for(t=a+1;t<i.length&&!(i[t].type==="softbreak"||i[t].type==="hardbreak");t++)if(i[t].content){m=i[t].content.charCodeAt(0);break}const g=Un(p)||Wn(String.fromCharCode(p)),b=Un(m)||Wn(String.fromCharCode(m)),x=Vn(p),v=Vn(m);if(v?c=!1:b&&(x||g||(c=!1)),x?d=!1:g&&(v||b||(d=!1)),m===34&&f[0]==='"'&&p>=48&&p<=57&&(d=c=!1),c&&d&&(c=g,d=b),!c&&!d){h&&(r.content=ra(r.content,f.index,Fl));continue}if(d)for(t=n.length-1;t>=0;t--){let C=n[t];if(n[t].level<s)break;if(C.single===h&&n[t].level===s){C=n[t];let E,R;h?(E=e.md.options.quotes[2],R=e.md.options.quotes[3]):(E=e.md.options.quotes[0],R=e.md.options.quotes[1]),r.content=ra(r.content,f.index,R),i[C.token].content=ra(i[C.token].content,C.pos,E),l+=R.length-1,C.token===a&&(l+=E.length-1),o=r.content,u=o.length,n.length=t;continue e}}c?n.push({token:a,pos:f.index,single:h,level:s}):d&&h&&(r.content=ra(r.content,f.index,Fl))}}}function ep(i){if(i.md.options.typographer)for(let e=i.tokens.length-1;e>=0;e--)i.tokens[e].type!=="inline"||!Qf.test(i.tokens[e].content)||Jf(i.tokens[e].children,i)}function tp(i){let e,t;const n=i.tokens,a=n.length;for(let r=0;r<a;r++){if(n[r].type!=="inline")continue;const s=n[r].children,o=s.length;for(e=0;e<o;e++)s[e].type==="text_special"&&(s[e].type="text");for(e=t=0;e<o;e++)s[e].type==="text"&&e+1<o&&s[e+1].type==="text"?s[e+1].content=s[e].content+s[e+1].content:(e!==t&&(s[t]=s[e]),t++);e!==t&&(s.length=t)}}const Yr=[["normalize",Hf],["block",zf],["inline",Vf],["linkify",qf],["replacements",Zf],["smartquotes",ep],["text_join",tp]];function so(){this.ruler=new St;for(let i=0;i<Yr.length;i++)this.ruler.push(Yr[i][0],Yr[i][1])}so.prototype.process=function(i){const e=this.ruler.getRules("");for(let t=0,n=e.length;t<n;t++)e[t](i)};so.prototype.State=ru;function ui(i,e,t,n){this.src=i,this.md=e,this.env=t,this.tokens=n,this.bMarks=[],this.eMarks=[],this.tShift=[],this.sCount=[],this.bsCount=[],this.blkIndent=0,this.line=0,this.lineMax=0,this.tight=!1,this.ddIndent=-1,this.listIndent=-1,this.parentType="root",this.level=0;const a=this.src;for(let r=0,s=0,o=0,l=0,u=a.length,f=!1;s<u;s++){const c=a.charCodeAt(s);if(!f)if(Xe(c)){o++,c===9?l+=4-l%4:l++;continue}else f=!0;(c===10||s===u-1)&&(c!==10&&s++,this.bMarks.push(r),this.eMarks.push(s),this.tShift.push(o),this.sCount.push(l),this.bsCount.push(0),f=!1,o=0,l=0,r=s+1)}this.bMarks.push(a.length),this.eMarks.push(a.length),this.tShift.push(0),this.sCount.push(0),this.bsCount.push(0),this.lineMax=this.bMarks.length-1}ui.prototype.push=function(i,e,t){const n=new Yt(i,e,t);return n.block=!0,t<0&&this.level--,n.level=this.level,t>0&&this.level++,this.tokens.push(n),n};ui.prototype.isEmpty=function(e){return this.bMarks[e]+this.tShift[e]>=this.eMarks[e]};ui.prototype.skipEmptyLines=function(e){for(let t=this.lineMax;e<t&&!(this.bMarks[e]+this.tShift[e]<this.eMarks[e]);e++);return e};ui.prototype.skipSpaces=function(e){for(let t=this.src.length;e<t;e++){const n=this.src.charCodeAt(e);if(!Xe(n))break}return e};ui.prototype.skipSpacesBack=function(e,t){if(e<=t)return e;for(;e>t;)if(!Xe(this.src.charCodeAt(--e)))return e+1;return e};ui.prototype.skipChars=function(e,t){for(let n=this.src.length;e<n&&this.src.charCodeAt(e)===t;e++);return e};ui.prototype.skipCharsBack=function(e,t,n){if(e<=n)return e;for(;e>n;)if(t!==this.src.charCodeAt(--e))return e+1;return e};ui.prototype.getLines=function(e,t,n,a){if(e>=t)return"";const r=new Array(t-e);for(let s=0,o=e;o<t;o++,s++){let l=0;const u=this.bMarks[o];let f=u,c;for(o+1<t||a?c=this.eMarks[o]+1:c=this.eMarks[o];f<c&&l<n;){const d=this.src.charCodeAt(f);if(Xe(d))d===9?l+=4-(l+this.bsCount[o])%4:l++;else if(f-u<this.tShift[o])l++;else break;f++}l>n?r[s]=new Array(l-n+1).join(" ")+this.src.slice(f,c):r[s]=this.src.slice(f,c)}return r.join("")};ui.prototype.Token=Yt;const ip=65536;function Kr(i,e){const t=i.bMarks[e]+i.tShift[e],n=i.eMarks[e];return i.src.slice(t,n)}function Il(i){const e=[],t=i.length;let n=0,a=i.charCodeAt(n),r=!1,s=0,o="";for(;n<t;)a===124&&(r?(o+=i.substring(s,n-1),s=n):(e.push(o+i.substring(s,n)),o="",s=n+1)),r=a===92,n++,a=i.charCodeAt(n);return e.push(o+i.substring(s)),e}function np(i,e,t,n){if(e+2>t)return!1;let a=e+1;if(i.sCount[a]<i.blkIndent||i.sCount[a]-i.blkIndent>=4)return!1;let r=i.bMarks[a]+i.tShift[a];if(r>=i.eMarks[a])return!1;const s=i.src.charCodeAt(r++);if(s!==124&&s!==45&&s!==58||r>=i.eMarks[a])return!1;const o=i.src.charCodeAt(r++);if(o!==124&&o!==45&&o!==58&&!Xe(o)||s===45&&Xe(o))return!1;for(;r<i.eMarks[a];){const C=i.src.charCodeAt(r);if(C!==124&&C!==45&&C!==58&&!Xe(C))return!1;r++}let l=Kr(i,e+1),u=l.split("|");const f=[];for(let C=0;C<u.length;C++){const E=u[C].trim();if(!E){if(C===0||C===u.length-1)continue;return!1}if(!/^:?-+:?$/.test(E))return!1;E.charCodeAt(E.length-1)===58?f.push(E.charCodeAt(0)===58?"center":"right"):E.charCodeAt(0)===58?f.push("left"):f.push("")}if(l=Kr(i,e).trim(),l.indexOf("|")===-1||i.sCount[e]-i.blkIndent>=4)return!1;u=Il(l),u.length&&u[0]===""&&u.shift(),u.length&&u[u.length-1]===""&&u.pop();const c=u.length;if(c===0||c!==f.length)return!1;if(n)return!0;const d=i.parentType;i.parentType="table";const h=i.md.block.ruler.getRules("blockquote"),p=i.push("table_open","table",1),m=[e,0];p.map=m;const g=i.push("thead_open","thead",1);g.map=[e,e+1];const b=i.push("tr_open","tr",1);b.map=[e,e+1];for(let C=0;C<u.length;C++){const E=i.push("th_open","th",1);f[C]&&(E.attrs=[["style","text-align:"+f[C]]]);const R=i.push("inline","",0);R.content=u[C].trim(),R.children=[],i.push("th_close","th",-1)}i.push("tr_close","tr",-1),i.push("thead_close","thead",-1);let x,v=0;for(a=e+2;a<t&&!(i.sCount[a]<i.blkIndent);a++){let C=!1;for(let R=0,O=h.length;R<O;R++)if(h[R](i,a,t,!0)){C=!0;break}if(C||(l=Kr(i,a).trim(),!l)||i.sCount[a]-i.blkIndent>=4||(u=Il(l),u.length&&u[0]===""&&u.shift(),u.length&&u[u.length-1]===""&&u.pop(),v+=c-u.length,v>ip))break;if(a===e+2){const R=i.push("tbody_open","tbody",1);R.map=x=[e+2,0]}const E=i.push("tr_open","tr",1);E.map=[a,a+1];for(let R=0;R<c;R++){const O=i.push("td_open","td",1);f[R]&&(O.attrs=[["style","text-align:"+f[R]]]);const H=i.push("inline","",0);H.content=u[R]?u[R].trim():"",H.children=[],i.push("td_close","td",-1)}i.push("tr_close","tr",-1)}return x&&(i.push("tbody_close","tbody",-1),x[1]=a),i.push("table_close","table",-1),m[1]=a,i.parentType=d,i.line=a,!0}function ap(i,e,t){if(i.sCount[e]-i.blkIndent<4)return!1;let n=e+1,a=n;for(;n<t;){if(i.isEmpty(n)){n++;continue}if(i.sCount[n]-i.blkIndent>=4){n++,a=n;continue}break}i.line=a;const r=i.push("code_block","code",0);return r.content=i.getLines(e,a,4+i.blkIndent,!1)+`
`,r.map=[e,i.line],!0}function rp(i,e,t,n){let a=i.bMarks[e]+i.tShift[e],r=i.eMarks[e];if(i.sCount[e]-i.blkIndent>=4||a+3>r)return!1;const s=i.src.charCodeAt(a);if(s!==126&&s!==96)return!1;let o=a;a=i.skipChars(a,s);let l=a-o;if(l<3)return!1;const u=i.src.slice(o,a),f=i.src.slice(a,r);if(s===96&&f.indexOf(String.fromCharCode(s))>=0)return!1;if(n)return!0;let c=e,d=!1;for(;c++,!(c>=t||(a=o=i.bMarks[c]+i.tShift[c],r=i.eMarks[c],a<r&&i.sCount[c]<i.blkIndent));)if(i.src.charCodeAt(a)===s&&!(i.sCount[c]-i.blkIndent>=4)&&(a=i.skipChars(a,s),!(a-o<l)&&(a=i.skipSpaces(a),!(a<r)))){d=!0;break}l=i.sCount[e],i.line=c+(d?1:0);const h=i.push("fence","code",0);return h.info=f,h.content=i.getLines(e+1,c,l,!0),h.markup=u,h.map=[e,i.line],!0}function sp(i,e,t,n){let a=i.bMarks[e]+i.tShift[e],r=i.eMarks[e];const s=i.lineMax;if(i.sCount[e]-i.blkIndent>=4||i.src.charCodeAt(a)!==62)return!1;if(n)return!0;const o=[],l=[],u=[],f=[],c=i.md.block.ruler.getRules("blockquote"),d=i.parentType;i.parentType="blockquote";let h=!1,p;for(p=e;p<t;p++){const v=i.sCount[p]<i.blkIndent;if(a=i.bMarks[p]+i.tShift[p],r=i.eMarks[p],a>=r)break;if(i.src.charCodeAt(a++)===62&&!v){let E=i.sCount[p]+1,R,O;i.src.charCodeAt(a)===32?(a++,E++,O=!1,R=!0):i.src.charCodeAt(a)===9?(R=!0,(i.bsCount[p]+E)%4===3?(a++,E++,O=!1):O=!0):R=!1;let H=E;for(o.push(i.bMarks[p]),i.bMarks[p]=a;a<r;){const N=i.src.charCodeAt(a);if(Xe(N))N===9?H+=4-(H+i.bsCount[p]+(O?1:0))%4:H++;else break;a++}h=a>=r,l.push(i.bsCount[p]),i.bsCount[p]=i.sCount[p]+1+(R?1:0),u.push(i.sCount[p]),i.sCount[p]=H-E,f.push(i.tShift[p]),i.tShift[p]=a-i.bMarks[p];continue}if(h)break;let C=!1;for(let E=0,R=c.length;E<R;E++)if(c[E](i,p,t,!0)){C=!0;break}if(C){i.lineMax=p,i.blkIndent!==0&&(o.push(i.bMarks[p]),l.push(i.bsCount[p]),f.push(i.tShift[p]),u.push(i.sCount[p]),i.sCount[p]-=i.blkIndent);break}o.push(i.bMarks[p]),l.push(i.bsCount[p]),f.push(i.tShift[p]),u.push(i.sCount[p]),i.sCount[p]=-1}const m=i.blkIndent;i.blkIndent=0;const g=i.push("blockquote_open","blockquote",1);g.markup=">";const b=[e,0];g.map=b,i.md.block.tokenize(i,e,p);const x=i.push("blockquote_close","blockquote",-1);x.markup=">",i.lineMax=s,i.parentType=d,b[1]=i.line;for(let v=0;v<f.length;v++)i.bMarks[v+e]=o[v],i.tShift[v+e]=f[v],i.sCount[v+e]=u[v],i.bsCount[v+e]=l[v];return i.blkIndent=m,!0}function op(i,e,t,n){const a=i.eMarks[e];if(i.sCount[e]-i.blkIndent>=4)return!1;let r=i.bMarks[e]+i.tShift[e];const s=i.src.charCodeAt(r++);if(s!==42&&s!==45&&s!==95)return!1;let o=1;for(;r<a;){const u=i.src.charCodeAt(r++);if(u!==s&&!Xe(u))return!1;u===s&&o++}if(o<3)return!1;if(n)return!0;i.line=e+1;const l=i.push("hr","hr",0);return l.map=[e,i.line],l.markup=Array(o+1).join(String.fromCharCode(s)),!0}function Rl(i,e){const t=i.eMarks[e];let n=i.bMarks[e]+i.tShift[e];const a=i.src.charCodeAt(n++);if(a!==42&&a!==45&&a!==43)return-1;if(n<t){const r=i.src.charCodeAt(n);if(!Xe(r))return-1}return n}function Pl(i,e){const t=i.bMarks[e]+i.tShift[e],n=i.eMarks[e];let a=t;if(a+1>=n)return-1;let r=i.src.charCodeAt(a++);if(r<48||r>57)return-1;for(;;){if(a>=n)return-1;if(r=i.src.charCodeAt(a++),r>=48&&r<=57){if(a-t>=10)return-1;continue}if(r===41||r===46)break;return-1}return a<n&&(r=i.src.charCodeAt(a),!Xe(r))?-1:a}function lp(i,e){const t=i.level+2;for(let n=e+2,a=i.tokens.length-2;n<a;n++)i.tokens[n].level===t&&i.tokens[n].type==="paragraph_open"&&(i.tokens[n+2].hidden=!0,i.tokens[n].hidden=!0,n+=2)}function cp(i,e,t,n){let a,r,s,o,l=e,u=!0;if(i.sCount[l]-i.blkIndent>=4||i.listIndent>=0&&i.sCount[l]-i.listIndent>=4&&i.sCount[l]<i.blkIndent)return!1;let f=!1;n&&i.parentType==="paragraph"&&i.sCount[l]>=i.blkIndent&&(f=!0);let c,d,h;if((h=Pl(i,l))>=0){if(c=!0,s=i.bMarks[l]+i.tShift[l],d=Number(i.src.slice(s,h-1)),f&&d!==1)return!1}else if((h=Rl(i,l))>=0)c=!1;else return!1;if(f&&i.skipSpaces(h)>=i.eMarks[l])return!1;if(n)return!0;const p=i.src.charCodeAt(h-1),m=i.tokens.length;c?(o=i.push("ordered_list_open","ol",1),d!==1&&(o.attrs=[["start",d]])):o=i.push("bullet_list_open","ul",1);const g=[l,0];o.map=g,o.markup=String.fromCharCode(p);let b=!1;const x=i.md.block.ruler.getRules("list"),v=i.parentType;for(i.parentType="list";l<t;){r=h,a=i.eMarks[l];const C=i.sCount[l]+h-(i.bMarks[l]+i.tShift[l]);let E=C;for(;r<a;){const M=i.src.charCodeAt(r);if(M===9)E+=4-(E+i.bsCount[l])%4;else if(M===32)E++;else break;r++}const R=r;let O;R>=a?O=1:O=E-C,O>4&&(O=1);const H=C+O;o=i.push("list_item_open","li",1),o.markup=String.fromCharCode(p);const N=[l,0];o.map=N,c&&(o.info=i.src.slice(s,h-1));const K=i.tight,ae=i.tShift[l],T=i.sCount[l],W=i.listIndent;if(i.listIndent=i.blkIndent,i.blkIndent=H,i.tight=!0,i.tShift[l]=R-i.bMarks[l],i.sCount[l]=E,R>=a&&i.isEmpty(l+1)?i.line=Math.min(i.line+2,t):i.md.block.tokenize(i,l,t,!0),(!i.tight||b)&&(u=!1),b=i.line-l>1&&i.isEmpty(i.line-1),i.blkIndent=i.listIndent,i.listIndent=W,i.tShift[l]=ae,i.sCount[l]=T,i.tight=K,o=i.push("list_item_close","li",-1),o.markup=String.fromCharCode(p),l=i.line,N[1]=l,l>=t||i.sCount[l]<i.blkIndent||i.sCount[l]-i.blkIndent>=4)break;let w=!1;for(let M=0,G=x.length;M<G;M++)if(x[M](i,l,t,!0)){w=!0;break}if(w)break;if(c){if(h=Pl(i,l),h<0)break;s=i.bMarks[l]+i.tShift[l]}else if(h=Rl(i,l),h<0)break;if(p!==i.src.charCodeAt(h-1))break}return c?o=i.push("ordered_list_close","ol",-1):o=i.push("bullet_list_close","ul",-1),o.markup=String.fromCharCode(p),g[1]=l,i.line=l,i.parentType=v,u&&lp(i,m),!0}function up(i,e,t,n){let a=i.bMarks[e]+i.tShift[e],r=i.eMarks[e],s=e+1;if(i.sCount[e]-i.blkIndent>=4||i.src.charCodeAt(a)!==91)return!1;function o(x){const v=i.lineMax;if(x>=v||i.isEmpty(x))return null;let C=!1;if(i.sCount[x]-i.blkIndent>3&&(C=!0),i.sCount[x]<0&&(C=!0),!C){const O=i.md.block.ruler.getRules("reference"),H=i.parentType;i.parentType="reference";let N=!1;for(let K=0,ae=O.length;K<ae;K++)if(O[K](i,x,v,!0)){N=!0;break}if(i.parentType=H,N)return null}const E=i.bMarks[x]+i.tShift[x],R=i.eMarks[x];return i.src.slice(E,R+1)}let l=i.src.slice(a,r+1);r=l.length;let u=-1;for(a=1;a<r;a++){const x=l.charCodeAt(a);if(x===91)return!1;if(x===93){u=a;break}else if(x===10){const v=o(s);v!==null&&(l+=v,r=l.length,s++)}else if(x===92&&(a++,a<r&&l.charCodeAt(a)===10)){const v=o(s);v!==null&&(l+=v,r=l.length,s++)}}if(u<0||l.charCodeAt(u+1)!==58)return!1;for(a=u+2;a<r;a++){const x=l.charCodeAt(a);if(x===10){const v=o(s);v!==null&&(l+=v,r=l.length,s++)}else if(!Xe(x))break}const f=i.md.helpers.parseLinkDestination(l,a,r);if(!f.ok)return!1;const c=i.md.normalizeLink(f.str);if(!i.md.validateLink(c))return!1;a=f.pos;const d=a,h=s,p=a;for(;a<r;a++){const x=l.charCodeAt(a);if(x===10){const v=o(s);v!==null&&(l+=v,r=l.length,s++)}else if(!Xe(x))break}let m=i.md.helpers.parseLinkTitle(l,a,r);for(;m.can_continue;){const x=o(s);if(x===null)break;l+=x,a=r,r=l.length,s++,m=i.md.helpers.parseLinkTitle(l,a,r,m)}let g;for(a<r&&p!==a&&m.ok?(g=m.str,a=m.pos):(g="",a=d,s=h);a<r;){const x=l.charCodeAt(a);if(!Xe(x))break;a++}if(a<r&&l.charCodeAt(a)!==10&&g)for(g="",a=d,s=h;a<r;){const x=l.charCodeAt(a);if(!Xe(x))break;a++}if(a<r&&l.charCodeAt(a)!==10)return!1;const b=Ga(l.slice(1,u));return b?(n||(typeof i.env.references>"u"&&(i.env.references={}),typeof i.env.references[b]>"u"&&(i.env.references[b]={title:g,href:c}),i.line=s),!0):!1}const dp=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],hp="[a-zA-Z_:][a-zA-Z0-9:._-]*",fp="[^\"'=<>`\\x00-\\x20]+",pp="'[^']*'",mp='"[^"]*"',gp="(?:"+fp+"|"+pp+"|"+mp+")",bp="(?:\\s+"+hp+"(?:\\s*=\\s*"+gp+")?)",ou="<[A-Za-z][A-Za-z0-9\\-]*"+bp+"*\\s*\\/?>",lu="<\\/[A-Za-z][A-Za-z0-9\\-]*\\s*>",yp="<!---?>|<!--(?:[^-]|-[^-]|--[^>])*-->",wp="<[?][\\s\\S]*?[?]>",vp="<![A-Za-z][^>]*>",xp="<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",_p=new RegExp("^(?:"+ou+"|"+lu+"|"+yp+"|"+wp+"|"+vp+"|"+xp+")"),Cp=new RegExp("^(?:"+ou+"|"+lu+")"),Ki=[[/^<(script|pre|style|textarea)(?=(\s|>|$))/i,/<\/(script|pre|style|textarea)>/i,!0],[/^<!--/,/-->/,!0],[/^<\?/,/\?>/,!0],[/^<![A-Z]/,/>/,!0],[/^<!\[CDATA\[/,/\]\]>/,!0],[new RegExp("^</?("+dp.join("|")+")(?=(\\s|/?>|$))","i"),/^$/,!0],[new RegExp(Cp.source+"\\s*$"),/^$/,!1]];function Ep(i,e,t,n){let a=i.bMarks[e]+i.tShift[e],r=i.eMarks[e];if(i.sCount[e]-i.blkIndent>=4||!i.md.options.html||i.src.charCodeAt(a)!==60)return!1;let s=i.src.slice(a,r),o=0;for(;o<Ki.length&&!Ki[o][0].test(s);o++);if(o===Ki.length)return!1;if(n)return Ki[o][2];let l=e+1;if(!Ki[o][1].test(s)){for(;l<t&&!(i.sCount[l]<i.blkIndent);l++)if(a=i.bMarks[l]+i.tShift[l],r=i.eMarks[l],s=i.src.slice(a,r),Ki[o][1].test(s)){s.length!==0&&l++;break}}i.line=l;const u=i.push("html_block","",0);return u.map=[e,l],u.content=i.getLines(e,l,i.blkIndent,!0),!0}function Ap(i,e,t,n){let a=i.bMarks[e]+i.tShift[e],r=i.eMarks[e];if(i.sCount[e]-i.blkIndent>=4)return!1;let s=i.src.charCodeAt(a);if(s!==35||a>=r)return!1;let o=1;for(s=i.src.charCodeAt(++a);s===35&&a<r&&o<=6;)o++,s=i.src.charCodeAt(++a);if(o>6||a<r&&!Xe(s))return!1;if(n)return!0;r=i.skipSpacesBack(r,a);const l=i.skipCharsBack(r,35,a);l>a&&Xe(i.src.charCodeAt(l-1))&&(r=l),i.line=e+1;const u=i.push("heading_open","h"+String(o),1);u.markup="########".slice(0,o),u.map=[e,i.line];const f=i.push("inline","",0);f.content=i.src.slice(a,r).trim(),f.map=[e,i.line],f.children=[];const c=i.push("heading_close","h"+String(o),-1);return c.markup="########".slice(0,o),!0}function kp(i,e,t){const n=i.md.block.ruler.getRules("paragraph");if(i.sCount[e]-i.blkIndent>=4)return!1;const a=i.parentType;i.parentType="paragraph";let r=0,s,o=e+1;for(;o<t&&!i.isEmpty(o);o++){if(i.sCount[o]-i.blkIndent>3)continue;if(i.sCount[o]>=i.blkIndent){let h=i.bMarks[o]+i.tShift[o];const p=i.eMarks[o];if(h<p&&(s=i.src.charCodeAt(h),(s===45||s===61)&&(h=i.skipChars(h,s),h=i.skipSpaces(h),h>=p))){r=s===61?1:2;break}}if(i.sCount[o]<0)continue;let d=!1;for(let h=0,p=n.length;h<p;h++)if(n[h](i,o,t,!0)){d=!0;break}if(d)break}if(!r)return!1;const l=i.getLines(e,o,i.blkIndent,!1).trim();i.line=o+1;const u=i.push("heading_open","h"+String(r),1);u.markup=String.fromCharCode(s),u.map=[e,i.line];const f=i.push("inline","",0);f.content=l,f.map=[e,i.line-1],f.children=[];const c=i.push("heading_close","h"+String(r),-1);return c.markup=String.fromCharCode(s),i.parentType=a,!0}function Sp(i,e,t){const n=i.md.block.ruler.getRules("paragraph"),a=i.parentType;let r=e+1;for(i.parentType="paragraph";r<t&&!i.isEmpty(r);r++){if(i.sCount[r]-i.blkIndent>3||i.sCount[r]<0)continue;let u=!1;for(let f=0,c=n.length;f<c;f++)if(n[f](i,r,t,!0)){u=!0;break}if(u)break}const s=i.getLines(e,r,i.blkIndent,!1).trim();i.line=r;const o=i.push("paragraph_open","p",1);o.map=[e,i.line];const l=i.push("inline","",0);return l.content=s,l.map=[e,i.line],l.children=[],i.push("paragraph_close","p",-1),i.parentType=a,!0}const sa=[["table",np,["paragraph","reference"]],["code",ap],["fence",rp,["paragraph","reference","blockquote","list"]],["blockquote",sp,["paragraph","reference","blockquote","list"]],["hr",op,["paragraph","reference","blockquote","list"]],["list",cp,["paragraph","reference","blockquote"]],["reference",up],["html_block",Ep,["paragraph","reference","blockquote"]],["heading",Ap,["paragraph","reference","blockquote"]],["lheading",kp],["paragraph",Sp]];function $a(){this.ruler=new St;for(let i=0;i<sa.length;i++)this.ruler.push(sa[i][0],sa[i][1],{alt:(sa[i][2]||[]).slice()})}$a.prototype.tokenize=function(i,e,t){const n=this.ruler.getRules(""),a=n.length,r=i.md.options.maxNesting;let s=e,o=!1;for(;s<t&&(i.line=s=i.skipEmptyLines(s),!(s>=t||i.sCount[s]<i.blkIndent));){if(i.level>=r){i.line=t;break}const l=i.line;let u=!1;for(let f=0;f<a;f++)if(u=n[f](i,s,t,!1),u){if(l>=i.line)throw new Error("block rule didn't increment state.line");break}if(!u)throw new Error("none of the block rules matched");i.tight=!o,i.isEmpty(i.line-1)&&(o=!0),s=i.line,s<t&&i.isEmpty(s)&&(o=!0,s++,i.line=s)}};$a.prototype.parse=function(i,e,t,n){if(!i)return;const a=new this.State(i,e,t,n);this.tokenize(a,a.line,a.lineMax)};$a.prototype.State=ui;function Qn(i,e,t,n){this.src=i,this.env=t,this.md=e,this.tokens=n,this.tokens_meta=Array(n.length),this.pos=0,this.posMax=this.src.length,this.level=0,this.pending="",this.pendingLevel=0,this.cache={},this.delimiters=[],this._prev_delimiters=[],this.backticks={},this.backticksScanned=!1,this.linkLevel=0}Qn.prototype.pushPending=function(){const i=new Yt("text","",0);return i.content=this.pending,i.level=this.pendingLevel,this.tokens.push(i),this.pending="",i};Qn.prototype.push=function(i,e,t){this.pending&&this.pushPending();const n=new Yt(i,e,t);let a=null;return t<0&&(this.level--,this.delimiters=this._prev_delimiters.pop()),n.level=this.level,t>0&&(this.level++,this._prev_delimiters.push(this.delimiters),this.delimiters=[],a={delimiters:this.delimiters}),this.pendingLevel=this.level,this.tokens.push(n),this.tokens_meta.push(a),n};Qn.prototype.scanDelims=function(i,e){const t=this.posMax,n=this.src.charCodeAt(i),a=i>0?this.src.charCodeAt(i-1):32;let r=i;for(;r<t&&this.src.charCodeAt(r)===n;)r++;const s=r-i,o=r<t?this.src.charCodeAt(r):32,l=Un(a)||Wn(String.fromCharCode(a)),u=Un(o)||Wn(String.fromCharCode(o)),f=Vn(a),c=Vn(o),d=!c&&(!u||f||l),h=!f&&(!l||c||u);return{can_open:d&&(e||!h||l),can_close:h&&(e||!d||u),length:s}};Qn.prototype.Token=Yt;function Tp(i){switch(i){case 10:case 33:case 35:case 36:case 37:case 38:case 42:case 43:case 45:case 58:case 60:case 61:case 62:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 125:case 126:return!0;default:return!1}}function Mp(i,e){let t=i.pos;for(;t<i.posMax&&!Tp(i.src.charCodeAt(t));)t++;return t===i.pos?!1:(e||(i.pending+=i.src.slice(i.pos,t)),i.pos=t,!0)}const Dp=/(?:^|[^a-z0-9.+-])([a-z][a-z0-9.+-]*)$/i;function Lp(i,e){if(!i.md.options.linkify||i.linkLevel>0)return!1;const t=i.pos,n=i.posMax;if(t+3>n||i.src.charCodeAt(t)!==58||i.src.charCodeAt(t+1)!==47||i.src.charCodeAt(t+2)!==47)return!1;const a=i.pending.match(Dp);if(!a)return!1;const r=a[1],s=i.md.linkify.matchAtStart(i.src.slice(t-r.length));if(!s)return!1;let o=s.url;if(o.length<=r.length)return!1;o=o.replace(/\*+$/,"");const l=i.md.normalizeLink(o);if(!i.md.validateLink(l))return!1;if(!e){i.pending=i.pending.slice(0,-r.length);const u=i.push("link_open","a",1);u.attrs=[["href",l]],u.markup="linkify",u.info="auto";const f=i.push("text","",0);f.content=i.md.normalizeLinkText(o);const c=i.push("link_close","a",-1);c.markup="linkify",c.info="auto"}return i.pos+=o.length-r.length,!0}function Bp(i,e){let t=i.pos;if(i.src.charCodeAt(t)!==10)return!1;const n=i.pending.length-1,a=i.posMax;if(!e)if(n>=0&&i.pending.charCodeAt(n)===32)if(n>=1&&i.pending.charCodeAt(n-1)===32){let r=n-1;for(;r>=1&&i.pending.charCodeAt(r-1)===32;)r--;i.pending=i.pending.slice(0,r),i.push("hardbreak","br",0)}else i.pending=i.pending.slice(0,-1),i.push("softbreak","br",0);else i.push("softbreak","br",0);for(t++;t<a&&Xe(i.src.charCodeAt(t));)t++;return i.pos=t,!0}const oo=[];for(let i=0;i<256;i++)oo.push(0);"\\!\"#$%&'()*+,./:;<=>?@[]^_`{|}~-".split("").forEach(function(i){oo[i.charCodeAt(0)]=1});function Fp(i,e){let t=i.pos;const n=i.posMax;if(i.src.charCodeAt(t)!==92||(t++,t>=n))return!1;let a=i.src.charCodeAt(t);if(a===10){for(e||i.push("hardbreak","br",0),t++;t<n&&(a=i.src.charCodeAt(t),!!Xe(a));)t++;return i.pos=t,!0}let r=i.src[t];if(a>=55296&&a<=56319&&t+1<n){const o=i.src.charCodeAt(t+1);o>=56320&&o<=57343&&(r+=i.src[t+1],t++)}const s="\\"+r;if(!e){const o=i.push("text_special","",0);a<256&&oo[a]!==0?o.content=r:o.content=s,o.markup=s,o.info="escape"}return i.pos=t+1,!0}function Ip(i,e){let t=i.pos;if(i.src.charCodeAt(t)!==96)return!1;const a=t;t++;const r=i.posMax;for(;t<r&&i.src.charCodeAt(t)===96;)t++;const s=i.src.slice(a,t),o=s.length;if(i.backticksScanned&&(i.backticks[o]||0)<=a)return e||(i.pending+=s),i.pos+=o,!0;let l=t,u;for(;(u=i.src.indexOf("`",l))!==-1;){for(l=u+1;l<r&&i.src.charCodeAt(l)===96;)l++;const f=l-u;if(f===o){if(!e){const c=i.push("code_inline","code",0);c.markup=s,c.content=i.src.slice(t,u).replace(/\n/g," ").replace(/^ (.+) $/,"$1")}return i.pos=l,!0}i.backticks[f]=u}return i.backticksScanned=!0,e||(i.pending+=s),i.pos+=o,!0}function Rp(i,e){const t=i.pos,n=i.src.charCodeAt(t);if(e||n!==126)return!1;const a=i.scanDelims(i.pos,!0);let r=a.length;const s=String.fromCharCode(n);if(r<2)return!1;let o;r%2&&(o=i.push("text","",0),o.content=s,r--);for(let l=0;l<r;l+=2)o=i.push("text","",0),o.content=s+s,i.delimiters.push({marker:n,length:0,token:i.tokens.length-1,end:-1,open:a.can_open,close:a.can_close});return i.pos+=a.length,!0}function Ol(i,e){let t;const n=[],a=e.length;for(let r=0;r<a;r++){const s=e[r];if(s.marker!==126||s.end===-1)continue;const o=e[s.end];t=i.tokens[s.token],t.type="s_open",t.tag="s",t.nesting=1,t.markup="~~",t.content="",t=i.tokens[o.token],t.type="s_close",t.tag="s",t.nesting=-1,t.markup="~~",t.content="",i.tokens[o.token-1].type==="text"&&i.tokens[o.token-1].content==="~"&&n.push(o.token-1)}for(;n.length;){const r=n.pop();let s=r+1;for(;s<i.tokens.length&&i.tokens[s].type==="s_close";)s++;s--,r!==s&&(t=i.tokens[s],i.tokens[s]=i.tokens[r],i.tokens[r]=t)}}function Pp(i){const e=i.tokens_meta,t=i.tokens_meta.length;Ol(i,i.delimiters);for(let n=0;n<t;n++)e[n]&&e[n].delimiters&&Ol(i,e[n].delimiters)}const cu={tokenize:Rp,postProcess:Pp};function Op(i,e){const t=i.pos,n=i.src.charCodeAt(t);if(e||n!==95&&n!==42)return!1;const a=i.scanDelims(i.pos,n===42);for(let r=0;r<a.length;r++){const s=i.push("text","",0);s.content=String.fromCharCode(n),i.delimiters.push({marker:n,length:a.length,token:i.tokens.length-1,end:-1,open:a.can_open,close:a.can_close})}return i.pos+=a.length,!0}function Nl(i,e){const t=e.length;for(let n=t-1;n>=0;n--){const a=e[n];if(a.marker!==95&&a.marker!==42||a.end===-1)continue;const r=e[a.end],s=n>0&&e[n-1].end===a.end+1&&e[n-1].marker===a.marker&&e[n-1].token===a.token-1&&e[a.end+1].token===r.token+1,o=String.fromCharCode(a.marker),l=i.tokens[a.token];l.type=s?"strong_open":"em_open",l.tag=s?"strong":"em",l.nesting=1,l.markup=s?o+o:o,l.content="";const u=i.tokens[r.token];u.type=s?"strong_close":"em_close",u.tag=s?"strong":"em",u.nesting=-1,u.markup=s?o+o:o,u.content="",s&&(i.tokens[e[n-1].token].content="",i.tokens[e[a.end+1].token].content="",n--)}}function Np(i){const e=i.tokens_meta,t=i.tokens_meta.length;Nl(i,i.delimiters);for(let n=0;n<t;n++)e[n]&&e[n].delimiters&&Nl(i,e[n].delimiters)}const uu={tokenize:Op,postProcess:Np};function Hp(i,e){let t,n,a,r,s="",o="",l=i.pos,u=!0;if(i.src.charCodeAt(i.pos)!==91)return!1;const f=i.pos,c=i.posMax,d=i.pos+1,h=i.md.helpers.parseLinkLabel(i,i.pos,!0);if(h<0)return!1;let p=h+1;if(p<c&&i.src.charCodeAt(p)===40){for(u=!1,p++;p<c&&(t=i.src.charCodeAt(p),!(!Xe(t)&&t!==10));p++);if(p>=c)return!1;if(l=p,a=i.md.helpers.parseLinkDestination(i.src,p,i.posMax),a.ok){for(s=i.md.normalizeLink(a.str),i.md.validateLink(s)?p=a.pos:s="",l=p;p<c&&(t=i.src.charCodeAt(p),!(!Xe(t)&&t!==10));p++);if(a=i.md.helpers.parseLinkTitle(i.src,p,i.posMax),p<c&&l!==p&&a.ok)for(o=a.str,p=a.pos;p<c&&(t=i.src.charCodeAt(p),!(!Xe(t)&&t!==10));p++);}(p>=c||i.src.charCodeAt(p)!==41)&&(u=!0),p++}if(u){if(typeof i.env.references>"u")return!1;if(p<c&&i.src.charCodeAt(p)===91?(l=p+1,p=i.md.helpers.parseLinkLabel(i,p),p>=0?n=i.src.slice(l,p++):p=h+1):p=h+1,n||(n=i.src.slice(d,h)),r=i.env.references[Ga(n)],!r)return i.pos=f,!1;s=r.href,o=r.title}if(!e){i.pos=d,i.posMax=h;const m=i.push("link_open","a",1),g=[["href",s]];m.attrs=g,o&&g.push(["title",o]),i.linkLevel++,i.md.inline.tokenize(i),i.linkLevel--,i.push("link_close","a",-1)}return i.pos=p,i.posMax=c,!0}function zp(i,e){let t,n,a,r,s,o,l,u,f="";const c=i.pos,d=i.posMax;if(i.src.charCodeAt(i.pos)!==33||i.src.charCodeAt(i.pos+1)!==91)return!1;const h=i.pos+2,p=i.md.helpers.parseLinkLabel(i,i.pos+1,!1);if(p<0)return!1;if(r=p+1,r<d&&i.src.charCodeAt(r)===40){for(r++;r<d&&(t=i.src.charCodeAt(r),!(!Xe(t)&&t!==10));r++);if(r>=d)return!1;for(u=r,o=i.md.helpers.parseLinkDestination(i.src,r,i.posMax),o.ok&&(f=i.md.normalizeLink(o.str),i.md.validateLink(f)?r=o.pos:f=""),u=r;r<d&&(t=i.src.charCodeAt(r),!(!Xe(t)&&t!==10));r++);if(o=i.md.helpers.parseLinkTitle(i.src,r,i.posMax),r<d&&u!==r&&o.ok)for(l=o.str,r=o.pos;r<d&&(t=i.src.charCodeAt(r),!(!Xe(t)&&t!==10));r++);else l="";if(r>=d||i.src.charCodeAt(r)!==41)return i.pos=c,!1;r++}else{if(typeof i.env.references>"u")return!1;if(r<d&&i.src.charCodeAt(r)===91?(u=r+1,r=i.md.helpers.parseLinkLabel(i,r),r>=0?a=i.src.slice(u,r++):r=p+1):r=p+1,a||(a=i.src.slice(h,p)),s=i.env.references[Ga(a)],!s)return i.pos=c,!1;f=s.href,l=s.title}if(!e){n=i.src.slice(h,p);const m=[];i.md.inline.parse(n,i.md,i.env,m);const g=i.push("image","img",0),b=[["src",f],["alt",""]];g.attrs=b,g.children=m,g.content=n,l&&b.push(["title",l])}return i.pos=r,i.posMax=d,!0}const Vp=/^([a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)$/,Wp=/^([a-zA-Z][a-zA-Z0-9+.-]{1,31}):([^<>\x00-\x20]*)$/;function Up(i,e){let t=i.pos;if(i.src.charCodeAt(t)!==60)return!1;const n=i.pos,a=i.posMax;for(;;){if(++t>=a)return!1;const s=i.src.charCodeAt(t);if(s===60)return!1;if(s===62)break}const r=i.src.slice(n+1,t);if(Wp.test(r)){const s=i.md.normalizeLink(r);if(!i.md.validateLink(s))return!1;if(!e){const o=i.push("link_open","a",1);o.attrs=[["href",s]],o.markup="autolink",o.info="auto";const l=i.push("text","",0);l.content=i.md.normalizeLinkText(r);const u=i.push("link_close","a",-1);u.markup="autolink",u.info="auto"}return i.pos+=r.length+2,!0}if(Vp.test(r)){const s=i.md.normalizeLink("mailto:"+r);if(!i.md.validateLink(s))return!1;if(!e){const o=i.push("link_open","a",1);o.attrs=[["href",s]],o.markup="autolink",o.info="auto";const l=i.push("text","",0);l.content=i.md.normalizeLinkText(r);const u=i.push("link_close","a",-1);u.markup="autolink",u.info="auto"}return i.pos+=r.length+2,!0}return!1}function qp(i){return/^<a[>\s]/i.test(i)}function Gp(i){return/^<\/a\s*>/i.test(i)}function $p(i){const e=i|32;return e>=97&&e<=122}function jp(i,e){if(!i.md.options.html)return!1;const t=i.posMax,n=i.pos;if(i.src.charCodeAt(n)!==60||n+2>=t)return!1;const a=i.src.charCodeAt(n+1);if(a!==33&&a!==63&&a!==47&&!$p(a))return!1;const r=i.src.slice(n).match(_p);if(!r)return!1;if(!e){const s=i.push("html_inline","",0);s.content=r[0],qp(s.content)&&i.linkLevel++,Gp(s.content)&&i.linkLevel--}return i.pos+=r[0].length,!0}const Yp=/^&#((?:x[a-f0-9]{1,6}|[0-9]{1,7}));/i,Kp=/^&([a-z][a-z0-9]{1,31});/i;function Xp(i,e){const t=i.pos,n=i.posMax;if(i.src.charCodeAt(t)!==38||t+1>=n)return!1;if(i.src.charCodeAt(t+1)===35){const r=i.src.slice(t).match(Yp);if(r){if(!e){const s=r[1][0].toLowerCase()==="x"?parseInt(r[1].slice(1),16):parseInt(r[1],10),o=i.push("text_special","",0);o.content=ro(s)?Ma(s):Ma(65533),o.markup=r[0],o.info="entity"}return i.pos+=r[0].length,!0}}else{const r=i.src.slice(t).match(Kp);if(r){const s=iu(r[0]);if(s!==r[0]){if(!e){const o=i.push("text_special","",0);o.content=s,o.markup=r[0],o.info="entity"}return i.pos+=r[0].length,!0}}}return!1}function Hl(i){const e={},t=i.length;if(!t)return;let n=0,a=-2;const r=[];for(let s=0;s<t;s++){const o=i[s];if(r.push(0),(i[n].marker!==o.marker||a!==o.token-1)&&(n=s),a=o.token,o.length=o.length||0,!o.close)continue;e.hasOwnProperty(o.marker)||(e[o.marker]=[-1,-1,-1,-1,-1,-1]);const l=e[o.marker][(o.open?3:0)+o.length%3];let u=n-r[n]-1,f=u;for(;u>l;u-=r[u]+1){const c=i[u];if(c.marker===o.marker&&c.open&&c.end<0){let d=!1;if((c.close||o.open)&&(c.length+o.length)%3===0&&(c.length%3!==0||o.length%3!==0)&&(d=!0),!d){const h=u>0&&!i[u-1].open?r[u-1]+1:0;r[s]=s-u+h,r[u]=h,o.open=!1,c.end=s,c.close=!1,f=-1,a=-2;break}}}f!==-1&&(e[o.marker][(o.open?3:0)+(o.length||0)%3]=f)}}function Zp(i){const e=i.tokens_meta,t=i.tokens_meta.length;Hl(i.delimiters);for(let n=0;n<t;n++)e[n]&&e[n].delimiters&&Hl(e[n].delimiters)}function Qp(i){let e,t,n=0;const a=i.tokens,r=i.tokens.length;for(e=t=0;e<r;e++)a[e].nesting<0&&n--,a[e].level=n,a[e].nesting>0&&n++,a[e].type==="text"&&e+1<r&&a[e+1].type==="text"?a[e+1].content=a[e].content+a[e+1].content:(e!==t&&(a[t]=a[e]),t++);e!==t&&(a.length=t)}const Xr=[["text",Mp],["linkify",Lp],["newline",Bp],["escape",Fp],["backticks",Ip],["strikethrough",cu.tokenize],["emphasis",uu.tokenize],["link",Hp],["image",zp],["autolink",Up],["html_inline",jp],["entity",Xp]],Zr=[["balance_pairs",Zp],["strikethrough",cu.postProcess],["emphasis",uu.postProcess],["fragments_join",Qp]];function Jn(){this.ruler=new St;for(let i=0;i<Xr.length;i++)this.ruler.push(Xr[i][0],Xr[i][1]);this.ruler2=new St;for(let i=0;i<Zr.length;i++)this.ruler2.push(Zr[i][0],Zr[i][1])}Jn.prototype.skipToken=function(i){const e=i.pos,t=this.ruler.getRules(""),n=t.length,a=i.md.options.maxNesting,r=i.cache;if(typeof r[e]<"u"){i.pos=r[e];return}let s=!1;if(i.level<a){for(let o=0;o<n;o++)if(i.level++,s=t[o](i,!0),i.level--,s){if(e>=i.pos)throw new Error("inline rule didn't increment state.pos");break}}else i.pos=i.posMax;s||i.pos++,r[e]=i.pos};Jn.prototype.tokenize=function(i){const e=this.ruler.getRules(""),t=e.length,n=i.posMax,a=i.md.options.maxNesting;for(;i.pos<n;){const r=i.pos;let s=!1;if(i.level<a){for(let o=0;o<t;o++)if(s=e[o](i,!1),s){if(r>=i.pos)throw new Error("inline rule didn't increment state.pos");break}}if(s){if(i.pos>=n)break;continue}i.pending+=i.src[i.pos++]}i.pending&&i.pushPending()};Jn.prototype.parse=function(i,e,t,n){const a=new this.State(i,e,t,n);this.tokenize(a);const r=this.ruler2.getRules(""),s=r.length;for(let o=0;o<s;o++)r[o](a)};Jn.prototype.State=Qn;function Jp(i){const e={};i=i||{},e.src_Any=Zc.source,e.src_Cc=Qc.source,e.src_Z=eu.source,e.src_P=no.source,e.src_ZPCc=[e.src_Z,e.src_P,e.src_Cc].join("|"),e.src_ZCc=[e.src_Z,e.src_Cc].join("|");const t="[><｜]";return e.src_pseudo_letter="(?:(?!"+t+"|"+e.src_ZPCc+")"+e.src_Any+")",e.src_ip4="(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)",e.src_auth="(?:(?:(?!"+e.src_ZCc+"|[@/\\[\\]()]).)+@)?",e.src_port="(?::(?:6(?:[0-4]\\d{3}|5(?:[0-4]\\d{2}|5(?:[0-2]\\d|3[0-5])))|[1-5]?\\d{1,4}))?",e.src_host_terminator="(?=$|"+t+"|"+e.src_ZPCc+")(?!"+(i["---"]?"-(?!--)|":"-|")+"_|:\\d|\\.-|\\.(?!$|"+e.src_ZPCc+"))",e.src_path="(?:[/?#](?:(?!"+e.src_ZCc+"|"+t+`|[()[\\]{}.,"'?!\\-;]).|\\[(?:(?!`+e.src_ZCc+"|\\]).)*\\]|\\((?:(?!"+e.src_ZCc+"|[)]).)*\\)|\\{(?:(?!"+e.src_ZCc+'|[}]).)*\\}|\\"(?:(?!'+e.src_ZCc+`|["]).)+\\"|\\'(?:(?!`+e.src_ZCc+"|[']).)+\\'|\\'(?="+e.src_pseudo_letter+"|[-])|\\.{2,}[a-zA-Z0-9%/&]|\\.(?!"+e.src_ZCc+"|[.]|$)|"+(i["---"]?"\\-(?!--(?:[^-]|$))(?:-*)|":"\\-+|")+",(?!"+e.src_ZCc+"|$)|;(?!"+e.src_ZCc+"|$)|\\!+(?!"+e.src_ZCc+"|[!]|$)|\\?(?!"+e.src_ZCc+"|[?]|$))+|\\/)?",e.src_email_name='[\\-;:&=\\+\\$,\\.a-zA-Z0-9_][\\-;:&=\\+\\$,\\"\\.a-zA-Z0-9_]*',e.src_xn="xn--[a-z0-9\\-]{1,59}",e.src_domain_root="(?:"+e.src_xn+"|"+e.src_pseudo_letter+"{1,63})",e.src_domain="(?:"+e.src_xn+"|(?:"+e.src_pseudo_letter+")|(?:"+e.src_pseudo_letter+"(?:-|"+e.src_pseudo_letter+"){0,61}"+e.src_pseudo_letter+"))",e.src_host="(?:(?:(?:(?:"+e.src_domain+")\\.)*"+e.src_domain+"))",e.tpl_host_fuzzy="(?:"+e.src_ip4+"|(?:(?:(?:"+e.src_domain+")\\.)+(?:%TLDS%)))",e.tpl_host_no_ip_fuzzy="(?:(?:(?:"+e.src_domain+")\\.)+(?:%TLDS%))",e.src_host_strict=e.src_host+e.src_host_terminator,e.tpl_host_fuzzy_strict=e.tpl_host_fuzzy+e.src_host_terminator,e.src_host_port_strict=e.src_host+e.src_port+e.src_host_terminator,e.tpl_host_port_fuzzy_strict=e.tpl_host_fuzzy+e.src_port+e.src_host_terminator,e.tpl_host_port_no_ip_fuzzy_strict=e.tpl_host_no_ip_fuzzy+e.src_port+e.src_host_terminator,e.tpl_host_fuzzy_test="localhost|www\\.|\\.\\d{1,3}\\.|(?:\\.(?:%TLDS%)(?:"+e.src_ZPCc+"|>|$))",e.tpl_email_fuzzy="(^|"+t+'|"|\\(|'+e.src_ZCc+")("+e.src_email_name+"@"+e.tpl_host_fuzzy_strict+")",e.tpl_link_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|｜]|"+e.src_ZPCc+"))((?![$+<=>^`|｜])"+e.tpl_host_port_fuzzy_strict+e.src_path+")",e.tpl_link_no_ip_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|｜]|"+e.src_ZPCc+"))((?![$+<=>^`|｜])"+e.tpl_host_port_no_ip_fuzzy_strict+e.src_path+")",e}function Ms(i){return Array.prototype.slice.call(arguments,1).forEach(function(t){t&&Object.keys(t).forEach(function(n){i[n]=t[n]})}),i}function ja(i){return Object.prototype.toString.call(i)}function e0(i){return ja(i)==="[object String]"}function t0(i){return ja(i)==="[object Object]"}function i0(i){return ja(i)==="[object RegExp]"}function zl(i){return ja(i)==="[object Function]"}function n0(i){return i.replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}const du={fuzzyLink:!0,fuzzyEmail:!0,fuzzyIP:!1};function a0(i){return Object.keys(i||{}).reduce(function(e,t){return e||du.hasOwnProperty(t)},!1)}const r0={"http:":{validate:function(i,e,t){const n=i.slice(e);return t.re.http||(t.re.http=new RegExp("^\\/\\/"+t.re.src_auth+t.re.src_host_port_strict+t.re.src_path,"i")),t.re.http.test(n)?n.match(t.re.http)[0].length:0}},"https:":"http:","ftp:":"http:","//":{validate:function(i,e,t){const n=i.slice(e);return t.re.no_http||(t.re.no_http=new RegExp("^"+t.re.src_auth+"(?:localhost|(?:(?:"+t.re.src_domain+")\\.)+"+t.re.src_domain_root+")"+t.re.src_port+t.re.src_host_terminator+t.re.src_path,"i")),t.re.no_http.test(n)?e>=3&&i[e-3]===":"||e>=3&&i[e-3]==="/"?0:n.match(t.re.no_http)[0].length:0}},"mailto:":{validate:function(i,e,t){const n=i.slice(e);return t.re.mailto||(t.re.mailto=new RegExp("^"+t.re.src_email_name+"@"+t.re.src_host_strict,"i")),t.re.mailto.test(n)?n.match(t.re.mailto)[0].length:0}}},s0="a[cdefgilmnoqrstuwxz]|b[abdefghijmnorstvwyz]|c[acdfghiklmnoruvwxyz]|d[ejkmoz]|e[cegrstu]|f[ijkmor]|g[abdefghilmnpqrstuwy]|h[kmnrtu]|i[delmnoqrst]|j[emop]|k[eghimnprwyz]|l[abcikrstuvy]|m[acdeghklmnopqrstuvwxyz]|n[acefgilopruz]|om|p[aefghklmnrstwy]|qa|r[eosuw]|s[abcdeghijklmnortuvxyz]|t[cdfghjklmnortvwz]|u[agksyz]|v[aceginu]|w[fs]|y[et]|z[amw]",o0="biz|com|edu|gov|net|org|pro|web|xxx|aero|asia|coop|info|museum|name|shop|рф".split("|");function l0(i){i.__index__=-1,i.__text_cache__=""}function c0(i){return function(e,t){const n=e.slice(t);return i.test(n)?n.match(i)[0].length:0}}function Vl(){return function(i,e){e.normalize(i)}}function Da(i){const e=i.re=Jp(i.__opts__),t=i.__tlds__.slice();i.onCompile(),i.__tlds_replaced__||t.push(s0),t.push(e.src_xn),e.src_tlds=t.join("|");function n(o){return o.replace("%TLDS%",e.src_tlds)}e.email_fuzzy=RegExp(n(e.tpl_email_fuzzy),"i"),e.link_fuzzy=RegExp(n(e.tpl_link_fuzzy),"i"),e.link_no_ip_fuzzy=RegExp(n(e.tpl_link_no_ip_fuzzy),"i"),e.host_fuzzy_test=RegExp(n(e.tpl_host_fuzzy_test),"i");const a=[];i.__compiled__={};function r(o,l){throw new Error('(LinkifyIt) Invalid schema "'+o+'": '+l)}Object.keys(i.__schemas__).forEach(function(o){const l=i.__schemas__[o];if(l===null)return;const u={validate:null,link:null};if(i.__compiled__[o]=u,t0(l)){i0(l.validate)?u.validate=c0(l.validate):zl(l.validate)?u.validate=l.validate:r(o,l),zl(l.normalize)?u.normalize=l.normalize:l.normalize?r(o,l):u.normalize=Vl();return}if(e0(l)){a.push(o);return}r(o,l)}),a.forEach(function(o){i.__compiled__[i.__schemas__[o]]&&(i.__compiled__[o].validate=i.__compiled__[i.__schemas__[o]].validate,i.__compiled__[o].normalize=i.__compiled__[i.__schemas__[o]].normalize)}),i.__compiled__[""]={validate:null,normalize:Vl()};const s=Object.keys(i.__compiled__).filter(function(o){return o.length>0&&i.__compiled__[o]}).map(n0).join("|");i.re.schema_test=RegExp("(^|(?!_)(?:[><｜]|"+e.src_ZPCc+"))("+s+")","i"),i.re.schema_search=RegExp("(^|(?!_)(?:[><｜]|"+e.src_ZPCc+"))("+s+")","ig"),i.re.schema_at_start=RegExp("^"+i.re.schema_search.source,"i"),i.re.pretest=RegExp("("+i.re.schema_test.source+")|("+i.re.host_fuzzy_test.source+")|@","i"),l0(i)}function u0(i,e){const t=i.__index__,n=i.__last_index__,a=i.__text_cache__.slice(t,n);this.schema=i.__schema__.toLowerCase(),this.index=t+e,this.lastIndex=n+e,this.raw=a,this.text=a,this.url=a}function Ds(i,e){const t=new u0(i,e);return i.__compiled__[t.schema].normalize(t,i),t}function Bt(i,e){if(!(this instanceof Bt))return new Bt(i,e);e||a0(i)&&(e=i,i={}),this.__opts__=Ms({},du,e),this.__index__=-1,this.__last_index__=-1,this.__schema__="",this.__text_cache__="",this.__schemas__=Ms({},r0,i),this.__compiled__={},this.__tlds__=o0,this.__tlds_replaced__=!1,this.re={},Da(this)}Bt.prototype.add=function(e,t){return this.__schemas__[e]=t,Da(this),this};Bt.prototype.set=function(e){return this.__opts__=Ms(this.__opts__,e),this};Bt.prototype.test=function(e){if(this.__text_cache__=e,this.__index__=-1,!e.length)return!1;let t,n,a,r,s,o,l,u,f;if(this.re.schema_test.test(e)){for(l=this.re.schema_search,l.lastIndex=0;(t=l.exec(e))!==null;)if(r=this.testSchemaAt(e,t[2],l.lastIndex),r){this.__schema__=t[2],this.__index__=t.index+t[1].length,this.__last_index__=t.index+t[0].length+r;break}}return this.__opts__.fuzzyLink&&this.__compiled__["http:"]&&(u=e.search(this.re.host_fuzzy_test),u>=0&&(this.__index__<0||u<this.__index__)&&(n=e.match(this.__opts__.fuzzyIP?this.re.link_fuzzy:this.re.link_no_ip_fuzzy))!==null&&(s=n.index+n[1].length,(this.__index__<0||s<this.__index__)&&(this.__schema__="",this.__index__=s,this.__last_index__=n.index+n[0].length))),this.__opts__.fuzzyEmail&&this.__compiled__["mailto:"]&&(f=e.indexOf("@"),f>=0&&(a=e.match(this.re.email_fuzzy))!==null&&(s=a.index+a[1].length,o=a.index+a[0].length,(this.__index__<0||s<this.__index__||s===this.__index__&&o>this.__last_index__)&&(this.__schema__="mailto:",this.__index__=s,this.__last_index__=o))),this.__index__>=0};Bt.prototype.pretest=function(e){return this.re.pretest.test(e)};Bt.prototype.testSchemaAt=function(e,t,n){return this.__compiled__[t.toLowerCase()]?this.__compiled__[t.toLowerCase()].validate(e,n,this):0};Bt.prototype.match=function(e){const t=[];let n=0;this.__index__>=0&&this.__text_cache__===e&&(t.push(Ds(this,n)),n=this.__last_index__);let a=n?e.slice(n):e;for(;this.test(a);)t.push(Ds(this,n)),a=a.slice(this.__last_index__),n+=this.__last_index__;return t.length?t:null};Bt.prototype.matchAtStart=function(e){if(this.__text_cache__=e,this.__index__=-1,!e.length)return null;const t=this.re.schema_at_start.exec(e);if(!t)return null;const n=this.testSchemaAt(e,t[2],t[0].length);return n?(this.__schema__=t[2],this.__index__=t.index+t[1].length,this.__last_index__=t.index+t[0].length+n,Ds(this,0)):null};Bt.prototype.tlds=function(e,t){return e=Array.isArray(e)?e:[e],t?(this.__tlds__=this.__tlds__.concat(e).sort().filter(function(n,a,r){return n!==r[a-1]}).reverse(),Da(this),this):(this.__tlds__=e.slice(),this.__tlds_replaced__=!0,Da(this),this)};Bt.prototype.normalize=function(e){e.schema||(e.url="http://"+e.url),e.schema==="mailto:"&&!/^mailto:/i.test(e.url)&&(e.url="mailto:"+e.url)};Bt.prototype.onCompile=function(){};const on=2147483647,ai=36,lo=1,qn=26,d0=38,h0=700,hu=72,fu=128,pu="-",f0=/^xn--/,p0=/[^\0-\x7F]/,m0=/[\x2E\u3002\uFF0E\uFF61]/g,g0={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},Qr=ai-lo,ri=Math.floor,Jr=String.fromCharCode;function Ai(i){throw new RangeError(g0[i])}function b0(i,e){const t=[];let n=i.length;for(;n--;)t[n]=e(i[n]);return t}function mu(i,e){const t=i.split("@");let n="";t.length>1&&(n=t[0]+"@",i=t[1]),i=i.replace(m0,".");const a=i.split("."),r=b0(a,e).join(".");return n+r}function gu(i){const e=[];let t=0;const n=i.length;for(;t<n;){const a=i.charCodeAt(t++);if(a>=55296&&a<=56319&&t<n){const r=i.charCodeAt(t++);(r&64512)==56320?e.push(((a&1023)<<10)+(r&1023)+65536):(e.push(a),t--)}else e.push(a)}return e}const y0=i=>String.fromCodePoint(...i),w0=function(i){return i>=48&&i<58?26+(i-48):i>=65&&i<91?i-65:i>=97&&i<123?i-97:ai},Wl=function(i,e){return i+22+75*(i<26)-((e!=0)<<5)},bu=function(i,e,t){let n=0;for(i=t?ri(i/h0):i>>1,i+=ri(i/e);i>Qr*qn>>1;n+=ai)i=ri(i/Qr);return ri(n+(Qr+1)*i/(i+d0))},yu=function(i){const e=[],t=i.length;let n=0,a=fu,r=hu,s=i.lastIndexOf(pu);s<0&&(s=0);for(let o=0;o<s;++o)i.charCodeAt(o)>=128&&Ai("not-basic"),e.push(i.charCodeAt(o));for(let o=s>0?s+1:0;o<t;){const l=n;for(let f=1,c=ai;;c+=ai){o>=t&&Ai("invalid-input");const d=w0(i.charCodeAt(o++));d>=ai&&Ai("invalid-input"),d>ri((on-n)/f)&&Ai("overflow"),n+=d*f;const h=c<=r?lo:c>=r+qn?qn:c-r;if(d<h)break;const p=ai-h;f>ri(on/p)&&Ai("overflow"),f*=p}const u=e.length+1;r=bu(n-l,u,l==0),ri(n/u)>on-a&&Ai("overflow"),a+=ri(n/u),n%=u,e.splice(n++,0,a)}return String.fromCodePoint(...e)},wu=function(i){const e=[];i=gu(i);const t=i.length;let n=fu,a=0,r=hu;for(const l of i)l<128&&e.push(Jr(l));const s=e.length;let o=s;for(s&&e.push(pu);o<t;){let l=on;for(const f of i)f>=n&&f<l&&(l=f);const u=o+1;l-n>ri((on-a)/u)&&Ai("overflow"),a+=(l-n)*u,n=l;for(const f of i)if(f<n&&++a>on&&Ai("overflow"),f===n){let c=a;for(let d=ai;;d+=ai){const h=d<=r?lo:d>=r+qn?qn:d-r;if(c<h)break;const p=c-h,m=ai-h;e.push(Jr(Wl(h+p%m,0))),c=ri(p/m)}e.push(Jr(Wl(c,0))),r=bu(a,u,o===s),a=0,++o}++a,++n}return e.join("")},v0=function(i){return mu(i,function(e){return f0.test(e)?yu(e.slice(4).toLowerCase()):e})},x0=function(i){return mu(i,function(e){return p0.test(e)?"xn--"+wu(e):e})},vu={version:"2.3.1",ucs2:{decode:gu,encode:y0},decode:yu,encode:wu,toASCII:x0,toUnicode:v0},_0={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"“”‘’",highlight:null,maxNesting:100},components:{core:{},block:{},inline:{}}},C0={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"“”‘’",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline","text_join"]},block:{rules:["paragraph"]},inline:{rules:["text"],rules2:["balance_pairs","fragments_join"]}}},E0={options:{html:!0,xhtmlOut:!0,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"“”‘’",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline","text_join"]},block:{rules:["blockquote","code","fence","heading","hr","html_block","lheading","list","reference","paragraph"]},inline:{rules:["autolink","backticks","emphasis","entity","escape","html_inline","image","link","newline","text"],rules2:["balance_pairs","emphasis","fragments_join"]}}},A0={default:_0,zero:C0,commonmark:E0},k0=/^(vbscript|javascript|file|data):/,S0=/^data:image\/(gif|png|jpeg|webp);/;function T0(i){const e=i.trim().toLowerCase();return k0.test(e)?S0.test(e):!0}const xu=["http:","https:","mailto:"];function M0(i){const e=io(i,!0);if(e.hostname&&(!e.protocol||xu.indexOf(e.protocol)>=0))try{e.hostname=vu.toASCII(e.hostname)}catch{}return Zn(to(e))}function D0(i){const e=io(i,!0);if(e.hostname&&(!e.protocol||xu.indexOf(e.protocol)>=0))try{e.hostname=vu.toUnicode(e.hostname)}catch{}return ln(to(e),ln.defaultChars+"%")}function Vt(i,e){if(!(this instanceof Vt))return new Vt(i,e);e||ao(i)||(e=i||{},i="default"),this.inline=new Jn,this.block=new $a,this.core=new so,this.renderer=new hn,this.linkify=new Bt,this.validateLink=T0,this.normalizeLink=M0,this.normalizeLinkText=D0,this.utils=Bf,this.helpers=qa({},Pf),this.options={},this.configure(i),e&&this.set(e)}Vt.prototype.set=function(i){return qa(this.options,i),this};Vt.prototype.configure=function(i){const e=this;if(ao(i)){const t=i;if(i=A0[t],!i)throw new Error('Wrong `markdown-it` preset "'+t+'", check name')}if(!i)throw new Error("Wrong `markdown-it` preset, can't be empty");return i.options&&e.set(i.options),i.components&&Object.keys(i.components).forEach(function(t){i.components[t].rules&&e[t].ruler.enableOnly(i.components[t].rules),i.components[t].rules2&&e[t].ruler2.enableOnly(i.components[t].rules2)}),this};Vt.prototype.enable=function(i,e){let t=[];Array.isArray(i)||(i=[i]),["core","block","inline"].forEach(function(a){t=t.concat(this[a].ruler.enable(i,!0))},this),t=t.concat(this.inline.ruler2.enable(i,!0));const n=i.filter(function(a){return t.indexOf(a)<0});if(n.length&&!e)throw new Error("MarkdownIt. Failed to enable unknown rule(s): "+n);return this};Vt.prototype.disable=function(i,e){let t=[];Array.isArray(i)||(i=[i]),["core","block","inline"].forEach(function(a){t=t.concat(this[a].ruler.disable(i,!0))},this),t=t.concat(this.inline.ruler2.disable(i,!0));const n=i.filter(function(a){return t.indexOf(a)<0});if(n.length&&!e)throw new Error("MarkdownIt. Failed to disable unknown rule(s): "+n);return this};Vt.prototype.use=function(i){const e=[this].concat(Array.prototype.slice.call(arguments,1));return i.apply(i,e),this};Vt.prototype.parse=function(i,e){if(typeof i!="string")throw new Error("Input data should be a String");const t=new this.core.State(i,this,e);return this.core.process(t),t.tokens};Vt.prototype.render=function(i,e){return e=e||{},this.renderer.render(this.parse(i,e),this.options,e)};Vt.prototype.parseInline=function(i,e){const t=new this.core.State(i,this,e);return t.inlineMode=!0,this.core.process(t),t.tokens};Vt.prototype.renderInline=function(i,e){return e=e||{},this.renderer.render(this.parseInline(i,e),this.options,e)};class _u extends st{app;constructor(e){super({title:"Changelog",width:600,height:500,win_id:"changelog"}),this.app=e,this.initView()}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("div");t.classList.add("markdown-container"),fetch("/smeditor/assets/app/changelog.json").then(r=>r.json()).then(r=>{t.innerHTML=r.map(s=>`# ${s.version}
---
`+s.changelog).map(s=>`<div>${Vt().render(s)}</div>`).join("")}),e.appendChild(t);const n=document.createElement("div");n.classList.add("menu-options"),n.style.justifyContent="flex-end";const a=document.createElement("button");a.innerText="Close",a.onclick=()=>{this.closeWindow()},a.classList.add("confirm"),n.append(a),e.appendChild(n),this.viewElement.appendChild(e)}}const Ul=globalThis.showDirectoryPicker;async function L0(i={}){if(Ul&&!i._preferPolyfill)return Ul(i);const e=document.createElement("input");e.type="file",e.webkitdirectory=!0,e.multiple=!0,e.style.position="fixed",e.style.top="-100000px",e.style.left="-100000px",document.body.appendChild(e);const{makeDirHandleFromFileList:t}=await We(async()=>{const{makeDirHandleFromFileList:n}=await Promise.resolve().then(()=>Lc);return{makeDirHandleFromFileList:n}},void 0);return new Promise((n,a)=>{e.addEventListener("change",()=>{t(e.files).then(n).catch(a),document.body.removeChild(e)}),e.click()})}const ql=globalThis.showOpenFilePicker;async function Cu(i={}){if(ql&&!i._preferPolyfill)return ql(i);const e=document.createElement("input");e.type="file",e.multiple=!!i.multiple,e.accept=(i.accepts||[]).map(n=>[...(n.extensions||[]).map(a=>"."+a),...n.mimeTypes||[]]).flat().join(","),e.style.position="fixed",e.style.top="-100000px",e.style.left="-100000px",document.body.appendChild(e);const{makeFileHandlesFromFileList:t}=await We(async()=>{const{makeFileHandlesFromFileList:n}=await Promise.resolve().then(()=>Lc);return{makeFileHandlesFromFileList:n}},void 0);return new Promise((n,a)=>{e.addEventListener("change",()=>{t(e.files).then(n).catch(a),document.body.removeChild(e)}),e.click()})}const Gl=globalThis.showSaveFilePicker;async function B0(i={}){if(Gl&&!i._preferPolyfill)return Gl(i);const{FileSystemFileHandle:e}=await We(async()=>{const{FileSystemFileHandle:n}=await Promise.resolve().then(()=>Eu);return{FileSystemFileHandle:n}},void 0),{FileHandle:t}=await We(async()=>{const{FileHandle:n}=await import("./downloader-DRBETDf_.js");return{FileHandle:n}},__vite__mapDeps([3,1,2]));return new e(new t(i.suggestedName))}const Xi=Symbol("adapter");let co=class{constructor(e){this.kind=e.kind,this.name=e.name,this[Xi]=e}get isFile(){return this.kind==="file"}get isDirectory(){return this.kind==="directory"}async queryPermission(e={mode:"read"}){const t=this[Xi];if(t.queryPermission)return t.queryPermission(e);if(e.mode==="read")return"granted";if(e.mode==="readwrite")return t.writable?"granted":"denied";throw new TypeError(`Mode ${e.mode} must be 'read' or 'readwrite'`)}async requestPermission(e={mode:"read"}){const t=this[Xi];if(t.requestPermission)return t.requestPermission(e);if(e.mode==="read")return"granted";if(e.mode==="readwrite")return t.writable?"granted":"denied";throw new TypeError(`Mode ${e.mode} must be 'read' or 'readwrite'`)}async isSameEntry(e){return this===e?!0:this.kind!==e.kind||!e[Xi]?!1:await this[Xi].isSameEntry(e[Xi])}};Object.defineProperty(co.prototype,Symbol.toStringTag,{value:"FileSystemHandle",writable:!1,enumerable:!1,configurable:!0});const es=Symbol("adapter");let Gn=class extends co{constructor(e){super(e),this.kind="file",this[es]=e}async createWritable(e={}){const{FileSystemWritableFileStream:t}=await We(async()=>{const{FileSystemWritableFileStream:n}=await import("./FileSystemWritableFileStream-D05uA35V.js");return{FileSystemWritableFileStream:n}},__vite__mapDeps([4,5]));return new t(await this[es].createWritable(e))}async getFile(){return this[es].getFile()}};Object.defineProperty(Gn.prototype,Symbol.toStringTag,{value:"FileSystemFileHandle",writable:!1,enumerable:!1,configurable:!0});Object.defineProperties(Gn.prototype,{createWritable:{enumerable:!0},getFile:{enumerable:!0}});const Eu=Object.freeze(Object.defineProperty({__proto__:null,FileSystemFileHandle:Gn},Symbol.toStringTag,{value:"Module"})),Zi=Symbol("adapter");class ji extends co{constructor(e){super(e),this.kind="directory",this[Zi]=e}async getDirectoryHandle(e,t={}){if(e==="")throw new TypeError("Name can't be an empty string.");if(e==="."||e===".."||e.includes("/"))throw new TypeError("Name contains invalid characters.");return new ji(await this[Zi].getDirectoryHandle(e,t))}getDirectory(e,t={}){return this.getDirectoryHandle(e,t)}async*entries(){for await(const[e,t]of this[Zi].entries())yield[t.name,t.kind==="file"?new Gn(t):new ji(t)]}async*getEntries(){return this.entries()}async*keys(){for await(const[e]of this[Zi].entries())yield e}async*values(){for await(const[e,t]of this.entries())yield t}async getFileHandle(e,t={}){if(e==="")throw new TypeError("Name can't be an empty string.");if(e==="."||e===".."||e.includes("/"))throw new TypeError("Name contains invalid characters.");return t.create=!!t.create,new Gn(await this[Zi].getFileHandle(e,t))}getFile(e,t={}){return this.getFileHandle(e,t)}async removeEntry(e,t={}){if(e==="")throw new TypeError("Name can't be an empty string.");if(e==="."||e===".."||e.includes("/"))throw new TypeError("Name contains invalid characters.");return t.recursive=!!t.recursive,this[Zi].removeEntry(e,t)}async resolve(e){if(await e.isSameEntry(this))return[];const t=[{handle:this,path:[]}];for(;t.length;){let{handle:n,path:a}=t.pop();for await(const r of n.values()){if(await r.isSameEntry(e))return[...a,r.name];r.kind==="directory"&&t.push({handle:r,path:[...a,r.name]})}}return null}[Symbol.asyncIterator](){return this.entries()}}Object.defineProperty(ji.prototype,Symbol.toStringTag,{value:"FileSystemDirectoryHandle",writable:!1,enumerable:!1,configurable:!0});Object.defineProperties(ji.prototype,{getDirectoryHandle:{enumerable:!0},entries:{enumerable:!0},getFileHandle:{enumerable:!0},removeEntry:{enumerable:!0}});const F0=Object.freeze(Object.defineProperty({__proto__:null,FileSystemDirectoryHandle:ji},Symbol.toStringTag,{value:"Module"}));async function $l(i,e={}){var t,n,a,r;if(!i){if(!(!((t=globalThis.navigator)===null||t===void 0)&&t.storage)&&((n=globalThis.location)===null||n===void 0?void 0:n.protocol)==="http:")throw new Error("Native getDirectory not supported in HTTP context. Please use HTTPS instead or provide an adapter.");if(!(!((r=(a=globalThis.navigator)===null||a===void 0?void 0:a.storage)===null||r===void 0)&&r.getDirectory))throw new Error("Native StorageManager.getDirectory() is not supported in current environment. Please provide an adapter instead.");return globalThis.navigator.storage.getDirectory()}const s=await i,o=typeof s=="function"?await s(e):await s.default(e);return new ji(o)}var ts,is;const I0={adapter:{native:typeof((is=(ts=globalThis.navigator)===null||ts===void 0?void 0:ts.storage)===null||is===void 0?void 0:is.getDirectory)=="function"}},jl=i=>typeof i=="object"&&i!=null&&i.nodeType===1,Yl=(i,e)=>(!e||i!=="hidden")&&i!=="visible"&&i!=="clip",ns=(i,e)=>{if(i.clientHeight<i.scrollHeight||i.clientWidth<i.scrollWidth){const t=getComputedStyle(i,null);return Yl(t.overflowY,e)||Yl(t.overflowX,e)||(n=>{const a=(r=>{if(!r.ownerDocument||!r.ownerDocument.defaultView)return null;try{return r.ownerDocument.defaultView.frameElement}catch{return null}})(n);return!!a&&(a.clientHeight<n.scrollHeight||a.clientWidth<n.scrollWidth)})(i)}return!1},oa=(i,e,t,n,a,r,s,o)=>r<i&&s>e||r>i&&s<e?0:r<=i&&o<=t||s>=e&&o>=t?r-i-n:s>e&&o<t||r<i&&o>t?s-e+a:0,R0=i=>{const e=i.parentElement;return e??(i.getRootNode().host||null)},Kl=(i,e)=>{var t,n,a,r;if(typeof document>"u")return[];const{scrollMode:s,block:o,inline:l,boundary:u,skipOverflowHiddenElements:f}=e,c=typeof u=="function"?u:G=>G!==u;if(!jl(i))throw new TypeError("Invalid target");const d=document.scrollingElement||document.documentElement,h=[];let p=i;for(;jl(p)&&c(p);){if(p=R0(p),p===d){h.push(p);break}p!=null&&p===document.body&&ns(p)&&!ns(document.documentElement)||p!=null&&ns(p,f)&&h.push(p)}const m=(n=(t=window.visualViewport)==null?void 0:t.width)!=null?n:innerWidth,g=(r=(a=window.visualViewport)==null?void 0:a.height)!=null?r:innerHeight,{scrollX:b,scrollY:x}=window,{height:v,width:C,top:E,right:R,bottom:O,left:H}=i.getBoundingClientRect(),{top:N,right:K,bottom:ae,left:T}=(G=>{const B=window.getComputedStyle(G);return{top:parseFloat(B.scrollMarginTop)||0,right:parseFloat(B.scrollMarginRight)||0,bottom:parseFloat(B.scrollMarginBottom)||0,left:parseFloat(B.scrollMarginLeft)||0}})(i);let W=o==="start"||o==="nearest"?E-N:o==="end"?O+ae:E+v/2-N+ae,w=l==="center"?H+C/2-T+K:l==="end"?R+K:H-T;const M=[];for(let G=0;G<h.length;G++){const B=h[G],{height:D,width:V,top:X,right:P,bottom:F,left:ne}=B.getBoundingClientRect();if(s==="if-needed"&&E>=0&&H>=0&&O<=g&&R<=m&&E>=X&&O<=F&&H>=ne&&R<=P)return M;const ie=getComputedStyle(B),ee=parseInt(ie.borderLeftWidth,10),ke=parseInt(ie.borderTopWidth,10),Oe=parseInt(ie.borderRightWidth,10),we=parseInt(ie.borderBottomWidth,10);let ge=0,Te=0;const Le="offsetWidth"in B?B.offsetWidth-B.clientWidth-ee-Oe:0,nt="offsetHeight"in B?B.offsetHeight-B.clientHeight-ke-we:0,at="offsetWidth"in B?B.offsetWidth===0?0:V/B.offsetWidth:0,_="offsetHeight"in B?B.offsetHeight===0?0:D/B.offsetHeight:0;if(d===B)ge=o==="start"?W:o==="end"?W-g:o==="nearest"?oa(x,x+g,g,ke,we,x+W,x+W+v,v):W-g/2,Te=l==="start"?w:l==="center"?w-m/2:l==="end"?w-m:oa(b,b+m,m,ee,Oe,b+w,b+w+C,C),ge=Math.max(0,ge+x),Te=Math.max(0,Te+b);else{ge=o==="start"?W-X-ke:o==="end"?W-F+we+nt:o==="nearest"?oa(X,F,D,ke,we+nt,W,W+v,v):W-(X+D/2)+nt/2,Te=l==="start"?w-ne-ee:l==="center"?w-(ne+V/2)+Le/2:l==="end"?w-P+Oe+Le:oa(ne,P,V,ee,Oe+Le,w,w+C,C);const{scrollLeft:Z,scrollTop:q}=B;ge=_===0?0:Math.max(0,Math.min(q+ge/_,B.scrollHeight-D/_+nt)),Te=at===0?0:Math.max(0,Math.min(Z+Te/at,B.scrollWidth-V/at+Le)),W+=q-ge,w+=Z-Te}M.push({el:B,top:ge,left:Te})}return M},P0=i=>i===!1?{block:"end",inline:"nearest"}:(e=>e===Object(e)&&Object.keys(e).length!==0)(i)?i:{block:"start",inline:"nearest"};function Fn(i,e){if(!i.isConnected||!(a=>{let r=a;for(;r&&r.parentNode;){if(r.parentNode===document)return!0;r=r.parentNode instanceof ShadowRoot?r.parentNode.host:r.parentNode}return!1})(i))return;const t=(a=>{const r=window.getComputedStyle(a);return{top:parseFloat(r.scrollMarginTop)||0,right:parseFloat(r.scrollMarginRight)||0,bottom:parseFloat(r.scrollMarginBottom)||0,left:parseFloat(r.scrollMarginLeft)||0}})(i);if((a=>typeof a=="object"&&typeof a.behavior=="function")(e))return e.behavior(Kl(i,e));const n=typeof e=="boolean"||e==null?void 0:e.behavior;for(const{el:a,top:r,left:s}of Kl(i,P0(e))){const o=r-t.top+t.bottom,l=s-t.left+t.right;a.scroll({top:o,left:l,behavior:n})}}function Et(i,e){if(window.nw)return nw.require("path").basename(i,e);let t=uo(i)[2];return e&&t.slice(-1*e.length)===e&&(t=t.slice(0,t.length-e.length)),t}function rt(i){if(window.nw)return nw.require("path").dirname(i);const e=uo(i),t=e[0];let n=e[1];return!t&&!n?"":(n&&(n=n.slice(0,n.length-1)),t+n)}function kt(i){return window.nw?nw.require("path").extname(i):uo(i)[3]}const O0=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^/]+?|)(\.[^./]*|))(?:[/]*)$/;function uo(i){return O0.exec(i).slice(1)}const{GONE:Au}=An;FileSystemFileHandle;class ho{_path;kind="file";name;isFile=!0;isDirectory=!1;constructor(e){this._path=e,this.name=new URL(e).pathname.split("/").pop()??""}async getFile(){return fetch(this._path).then(e=>e.blob()).then(e=>new File([e],this.name)).catch(()=>{throw new DOMException(...Au)})}async createWritable(){throw Error("Cannot call createWriteable from a URLFileHandle")}async isSameEntry(e){return FileSystemHandle instanceof ho?e._path==this._path:!1}async queryPermission(){return"granted"}async requestPermission(){return"granted"}}class N0{async handleDropEvent(e,t){throw Error("Cannot call handleDropEvent from a URLFileHandler")}async getDirectoryHandle(e,t,n){throw Error("Cannot call getDirectoryHandle from a URLFileHandler")}async hasFile(e){return fetch(e).then(t=>t.ok).catch(()=>!1)}async getFileHandle(e,t){try{if(!await this.hasFile(e))throw new DOMException(...Au);return new ho(e)}catch(n){console.error("Failed to get file "+e+": "+n);return}}async getFileHandleRelativeTo(e,t){const n=new URL(e);kt(n.pathname)!=""&&(n.pathname=n.pathname.split("/").slice(0,-1).join("/")),n.pathname+="/"+t;try{return this.getFileHandle(n.toString())}catch(a){console.error("Failed to get relative file "+n+": "+a);return}}async getDirectoryFiles(e){throw Error("Cannot call getDirectoryFiles from a URLFileHandler")}async getDirectoryFolders(e){throw Error("Cannot call getDirectoryFolders from a URLFileHandler")}async writeFile(e,t){throw Error("Cannot save to a URL file!")}async removeFile(e){throw Error("Cannot remove a URL file!")}getRelativePath(e,t){throw Error("Cannot call getRelativePath from a URLFileHandler")}resolvePath(){throw Error("Cannot call resolvePath from a URLFileHandler")}}function la(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var as={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var Xl;function H0(){return Xl||(Xl=1,function(i,e){(function(t){i.exports=t()})(function(){return function t(n,a,r){function s(u,f){if(!a[u]){if(!n[u]){var c=typeof la=="function"&&la;if(!f&&c)return c(u,!0);if(o)return o(u,!0);var d=new Error("Cannot find module '"+u+"'");throw d.code="MODULE_NOT_FOUND",d}var h=a[u]={exports:{}};n[u][0].call(h.exports,function(p){var m=n[u][1][p];return s(m||p)},h,h.exports,t,n,a,r)}return a[u].exports}for(var o=typeof la=="function"&&la,l=0;l<r.length;l++)s(r[l]);return s}({1:[function(t,n,a){var r=t("./utils"),s=t("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.encode=function(l){for(var u,f,c,d,h,p,m,g=[],b=0,x=l.length,v=x,C=r.getTypeOf(l)!=="string";b<l.length;)v=x-b,c=C?(u=l[b++],f=b<x?l[b++]:0,b<x?l[b++]:0):(u=l.charCodeAt(b++),f=b<x?l.charCodeAt(b++):0,b<x?l.charCodeAt(b++):0),d=u>>2,h=(3&u)<<4|f>>4,p=1<v?(15&f)<<2|c>>6:64,m=2<v?63&c:64,g.push(o.charAt(d)+o.charAt(h)+o.charAt(p)+o.charAt(m));return g.join("")},a.decode=function(l){var u,f,c,d,h,p,m=0,g=0,b="data:";if(l.substr(0,b.length)===b)throw new Error("Invalid base64 input, it looks like a data url.");var x,v=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===o.charAt(64)&&v--,l.charAt(l.length-2)===o.charAt(64)&&v--,v%1!=0)throw new Error("Invalid base64 input, bad content length.");for(x=s.uint8array?new Uint8Array(0|v):new Array(0|v);m<l.length;)u=o.indexOf(l.charAt(m++))<<2|(d=o.indexOf(l.charAt(m++)))>>4,f=(15&d)<<4|(h=o.indexOf(l.charAt(m++)))>>2,c=(3&h)<<6|(p=o.indexOf(l.charAt(m++))),x[g++]=u,h!==64&&(x[g++]=f),p!==64&&(x[g++]=c);return x}},{"./support":30,"./utils":32}],2:[function(t,n,a){var r=t("./external"),s=t("./stream/DataWorker"),o=t("./stream/Crc32Probe"),l=t("./stream/DataLengthProbe");function u(f,c,d,h,p){this.compressedSize=f,this.uncompressedSize=c,this.crc32=d,this.compression=h,this.compressedContent=p}u.prototype={getContentWorker:function(){var f=new s(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),c=this;return f.on("end",function(){if(this.streamInfo.data_length!==c.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),f},getCompressedWorker:function(){return new s(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},u.createWorkerFrom=function(f,c,d){return f.pipe(new o).pipe(new l("uncompressedSize")).pipe(c.compressWorker(d)).pipe(new l("compressedSize")).withStreamInfo("compression",c)},n.exports=u},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,n,a){var r=t("./stream/GenericWorker");a.STORE={magic:"\0\0",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},a.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,n,a){var r=t("./utils"),s=function(){for(var o,l=[],u=0;u<256;u++){o=u;for(var f=0;f<8;f++)o=1&o?3988292384^o>>>1:o>>>1;l[u]=o}return l}();n.exports=function(o,l){return o!==void 0&&o.length?r.getTypeOf(o)!=="string"?function(u,f,c,d){var h=s,p=d+c;u^=-1;for(var m=d;m<p;m++)u=u>>>8^h[255&(u^f[m])];return-1^u}(0|l,o,o.length,0):function(u,f,c,d){var h=s,p=d+c;u^=-1;for(var m=d;m<p;m++)u=u>>>8^h[255&(u^f.charCodeAt(m))];return-1^u}(0|l,o,o.length,0):0}},{"./utils":32}],5:[function(t,n,a){a.base64=!1,a.binary=!1,a.dir=!1,a.createFolders=!0,a.date=null,a.compression=null,a.compressionOptions=null,a.comment=null,a.unixPermissions=null,a.dosPermissions=null},{}],6:[function(t,n,a){var r=null;r=typeof Promise<"u"?Promise:t("lie"),n.exports={Promise:r}},{lie:37}],7:[function(t,n,a){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",s=t("pako"),o=t("./utils"),l=t("./stream/GenericWorker"),u=r?"uint8array":"array";function f(c,d){l.call(this,"FlateWorker/"+c),this._pako=null,this._pakoAction=c,this._pakoOptions=d,this.meta={}}a.magic="\b\0",o.inherits(f,l),f.prototype.processChunk=function(c){this.meta=c.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(u,c.data),!1)},f.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},f.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},f.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var c=this;this._pako.onData=function(d){c.push({data:d,meta:c.meta})}},a.compressWorker=function(c){return new f("Deflate",c)},a.uncompressWorker=function(){return new f("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,n,a){function r(h,p){var m,g="";for(m=0;m<p;m++)g+=String.fromCharCode(255&h),h>>>=8;return g}function s(h,p,m,g,b,x){var v,C,E=h.file,R=h.compression,O=x!==u.utf8encode,H=o.transformTo("string",x(E.name)),N=o.transformTo("string",u.utf8encode(E.name)),K=E.comment,ae=o.transformTo("string",x(K)),T=o.transformTo("string",u.utf8encode(K)),W=N.length!==E.name.length,w=T.length!==K.length,M="",G="",B="",D=E.dir,V=E.date,X={crc32:0,compressedSize:0,uncompressedSize:0};p&&!m||(X.crc32=h.crc32,X.compressedSize=h.compressedSize,X.uncompressedSize=h.uncompressedSize);var P=0;p&&(P|=8),O||!W&&!w||(P|=2048);var F=0,ne=0;D&&(F|=16),b==="UNIX"?(ne=798,F|=function(ee,ke){var Oe=ee;return ee||(Oe=ke?16893:33204),(65535&Oe)<<16}(E.unixPermissions,D)):(ne=20,F|=function(ee){return 63&(ee||0)}(E.dosPermissions)),v=V.getUTCHours(),v<<=6,v|=V.getUTCMinutes(),v<<=5,v|=V.getUTCSeconds()/2,C=V.getUTCFullYear()-1980,C<<=4,C|=V.getUTCMonth()+1,C<<=5,C|=V.getUTCDate(),W&&(G=r(1,1)+r(f(H),4)+N,M+="up"+r(G.length,2)+G),w&&(B=r(1,1)+r(f(ae),4)+T,M+="uc"+r(B.length,2)+B);var ie="";return ie+=`
\0`,ie+=r(P,2),ie+=R.magic,ie+=r(v,2),ie+=r(C,2),ie+=r(X.crc32,4),ie+=r(X.compressedSize,4),ie+=r(X.uncompressedSize,4),ie+=r(H.length,2),ie+=r(M.length,2),{fileRecord:c.LOCAL_FILE_HEADER+ie+H+M,dirRecord:c.CENTRAL_FILE_HEADER+r(ne,2)+ie+r(ae.length,2)+"\0\0\0\0"+r(F,4)+r(g,4)+H+M+ae}}var o=t("../utils"),l=t("../stream/GenericWorker"),u=t("../utf8"),f=t("../crc32"),c=t("../signature");function d(h,p,m,g){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=m,this.encodeFileName=g,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(d,l),d.prototype.push=function(h){var p=h.meta.percent||0,m=this.entriesCount,g=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,l.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:m?(p+100*(m-g-1))/m:100}}))},d.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var p=this.streamFiles&&!h.file.dir;if(p){var m=s(h,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(h){this.accumulate=!1;var p=this.streamFiles&&!h.file.dir,m=s(h,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),p)this.push({data:function(g){return c.DATA_DESCRIPTOR+r(g.crc32,4)+r(g.compressedSize,4)+r(g.uncompressedSize,4)}(h),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var h=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var m=this.bytesWritten-h,g=function(b,x,v,C,E){var R=o.transformTo("string",E(C));return c.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(b,2)+r(b,2)+r(x,4)+r(v,4)+r(R.length,2)+R}(this.dirRecords.length,m,h,this.zipComment,this.encodeFileName);this.push({data:g,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(h){this._sources.push(h);var p=this;return h.on("data",function(m){p.processChunk(m)}),h.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),h.on("error",function(m){p.error(m)}),this},d.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(h){var p=this._sources;if(!l.prototype.error.call(this,h))return!1;for(var m=0;m<p.length;m++)try{p[m].error(h)}catch{}return!0},d.prototype.lock=function(){l.prototype.lock.call(this);for(var h=this._sources,p=0;p<h.length;p++)h[p].lock()},n.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,n,a){var r=t("../compressions"),s=t("./ZipFileWorker");a.generateWorker=function(o,l,u){var f=new s(l.streamFiles,u,l.platform,l.encodeFileName),c=0;try{o.forEach(function(d,h){c++;var p=function(x,v){var C=x||v,E=r[C];if(!E)throw new Error(C+" is not a valid compression method !");return E}(h.options.compression,l.compression),m=h.options.compressionOptions||l.compressionOptions||{},g=h.dir,b=h.date;h._compressWorker(p,m).withStreamInfo("file",{name:d,dir:g,date:b,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(f)}),f.entriesCount=c}catch(d){f.error(d)}return f}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,n,a){function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new r;for(var o in this)typeof this[o]!="function"&&(s[o]=this[o]);return s}}(r.prototype=t("./object")).loadAsync=t("./load"),r.support=t("./support"),r.defaults=t("./defaults"),r.version="3.10.1",r.loadAsync=function(s,o){return new r().loadAsync(s,o)},r.external=t("./external"),n.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,n,a){var r=t("./utils"),s=t("./external"),o=t("./utf8"),l=t("./zipEntries"),u=t("./stream/Crc32Probe"),f=t("./nodejsUtils");function c(d){return new s.Promise(function(h,p){var m=d.decompressed.getContentWorker().pipe(new u);m.on("error",function(g){p(g)}).on("end",function(){m.streamInfo.crc32!==d.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}n.exports=function(d,h){var p=this;return h=r.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),f.isNode&&f.isStream(d)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",d,!0,h.optimizedBinaryString,h.base64).then(function(m){var g=new l(h);return g.load(m),g}).then(function(m){var g=[s.Promise.resolve(m)],b=m.files;if(h.checkCRC32)for(var x=0;x<b.length;x++)g.push(c(b[x]));return s.Promise.all(g)}).then(function(m){for(var g=m.shift(),b=g.files,x=0;x<b.length;x++){var v=b[x],C=v.fileNameStr,E=r.resolve(v.fileNameStr);p.file(E,v.decompressed,{binary:!0,optimizedBinaryString:!0,date:v.date,dir:v.dir,comment:v.fileCommentStr.length?v.fileCommentStr:null,unixPermissions:v.unixPermissions,dosPermissions:v.dosPermissions,createFolders:h.createFolders}),v.dir||(p.file(E).unsafeOriginalName=C)}return g.zipComment.length&&(p.comment=g.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,n,a){var r=t("../utils"),s=t("../stream/GenericWorker");function o(l,u){s.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(u)}r.inherits(o,s),o.prototype._bindStream=function(l){var u=this;(this._stream=l).pause(),l.on("data",function(f){u.push({data:f,meta:{percent:0}})}).on("error",function(f){u.isPaused?this.generatedError=f:u.error(f)}).on("end",function(){u.isPaused?u._upstreamEnded=!0:u.end()})},o.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,n,a){var r=t("readable-stream").Readable;function s(o,l,u){r.call(this,l),this._helper=o;var f=this;o.on("data",function(c,d){f.push(c)||f._helper.pause(),u&&u(d)}).on("error",function(c){f.emit("error",c)}).on("end",function(){f.push(null)})}t("../utils").inherits(s,r),s.prototype._read=function(){this._helper.resume()},n.exports=s},{"../utils":32,"readable-stream":16}],14:[function(t,n,a){n.exports={isNode:typeof Buffer<"u",newBufferFrom:function(r,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(r,s);if(typeof r=="number")throw new Error('The "data" argument must not be a number');return new Buffer(r,s)},allocBuffer:function(r){if(Buffer.alloc)return Buffer.alloc(r);var s=new Buffer(r);return s.fill(0),s},isBuffer:function(r){return Buffer.isBuffer(r)},isStream:function(r){return r&&typeof r.on=="function"&&typeof r.pause=="function"&&typeof r.resume=="function"}}},{}],15:[function(t,n,a){function r(E,R,O){var H,N=o.getTypeOf(R),K=o.extend(O||{},f);K.date=K.date||new Date,K.compression!==null&&(K.compression=K.compression.toUpperCase()),typeof K.unixPermissions=="string"&&(K.unixPermissions=parseInt(K.unixPermissions,8)),K.unixPermissions&&16384&K.unixPermissions&&(K.dir=!0),K.dosPermissions&&16&K.dosPermissions&&(K.dir=!0),K.dir&&(E=b(E)),K.createFolders&&(H=g(E))&&x.call(this,H,!0);var ae=N==="string"&&K.binary===!1&&K.base64===!1;O&&O.binary!==void 0||(K.binary=!ae),(R instanceof c&&R.uncompressedSize===0||K.dir||!R||R.length===0)&&(K.base64=!1,K.binary=!0,R="",K.compression="STORE",N="string");var T=null;T=R instanceof c||R instanceof l?R:p.isNode&&p.isStream(R)?new m(E,R):o.prepareContent(E,R,K.binary,K.optimizedBinaryString,K.base64);var W=new d(E,T,K);this.files[E]=W}var s=t("./utf8"),o=t("./utils"),l=t("./stream/GenericWorker"),u=t("./stream/StreamHelper"),f=t("./defaults"),c=t("./compressedObject"),d=t("./zipObject"),h=t("./generate"),p=t("./nodejsUtils"),m=t("./nodejs/NodejsStreamInputAdapter"),g=function(E){E.slice(-1)==="/"&&(E=E.substring(0,E.length-1));var R=E.lastIndexOf("/");return 0<R?E.substring(0,R):""},b=function(E){return E.slice(-1)!=="/"&&(E+="/"),E},x=function(E,R){return R=R!==void 0?R:f.createFolders,E=b(E),this.files[E]||r.call(this,E,null,{dir:!0,createFolders:R}),this.files[E]};function v(E){return Object.prototype.toString.call(E)==="[object RegExp]"}var C={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(E){var R,O,H;for(R in this.files)H=this.files[R],(O=R.slice(this.root.length,R.length))&&R.slice(0,this.root.length)===this.root&&E(O,H)},filter:function(E){var R=[];return this.forEach(function(O,H){E(O,H)&&R.push(H)}),R},file:function(E,R,O){if(arguments.length!==1)return E=this.root+E,r.call(this,E,R,O),this;if(v(E)){var H=E;return this.filter(function(K,ae){return!ae.dir&&H.test(K)})}var N=this.files[this.root+E];return N&&!N.dir?N:null},folder:function(E){if(!E)return this;if(v(E))return this.filter(function(N,K){return K.dir&&E.test(N)});var R=this.root+E,O=x.call(this,R),H=this.clone();return H.root=O.name,H},remove:function(E){E=this.root+E;var R=this.files[E];if(R||(E.slice(-1)!=="/"&&(E+="/"),R=this.files[E]),R&&!R.dir)delete this.files[E];else for(var O=this.filter(function(N,K){return K.name.slice(0,E.length)===E}),H=0;H<O.length;H++)delete this.files[O[H].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(E){var R,O={};try{if((O=o.extend(E||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=O.type.toLowerCase(),O.compression=O.compression.toUpperCase(),O.type==="binarystring"&&(O.type="string"),!O.type)throw new Error("No output type specified.");o.checkSupport(O.type),O.platform!=="darwin"&&O.platform!=="freebsd"&&O.platform!=="linux"&&O.platform!=="sunos"||(O.platform="UNIX"),O.platform==="win32"&&(O.platform="DOS");var H=O.comment||this.comment||"";R=h.generateWorker(this,O,H)}catch(N){(R=new l("error")).error(N)}return new u(R,O.type||"string",O.mimeType)},generateAsync:function(E,R){return this.generateInternalStream(E).accumulate(R)},generateNodeStream:function(E,R){return(E=E||{}).type||(E.type="nodebuffer"),this.generateInternalStream(E).toNodejsStream(R)}};n.exports=C},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,n,a){n.exports=t("stream")},{stream:void 0}],17:[function(t,n,a){var r=t("./DataReader");function s(o){r.call(this,o);for(var l=0;l<this.data.length;l++)o[l]=255&o[l]}t("../utils").inherits(s,r),s.prototype.byteAt=function(o){return this.data[this.zero+o]},s.prototype.lastIndexOfSignature=function(o){for(var l=o.charCodeAt(0),u=o.charCodeAt(1),f=o.charCodeAt(2),c=o.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===l&&this.data[d+1]===u&&this.data[d+2]===f&&this.data[d+3]===c)return d-this.zero;return-1},s.prototype.readAndCheckSignature=function(o){var l=o.charCodeAt(0),u=o.charCodeAt(1),f=o.charCodeAt(2),c=o.charCodeAt(3),d=this.readData(4);return l===d[0]&&u===d[1]&&f===d[2]&&c===d[3]},s.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./DataReader":18}],18:[function(t,n,a){var r=t("../utils");function s(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var l,u=0;for(this.checkOffset(o),l=this.index+o-1;l>=this.index;l--)u=(u<<8)+this.byteAt(l);return this.index+=o,u},readString:function(o){return r.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},n.exports=s},{"../utils":32}],19:[function(t,n,a){var r=t("./Uint8ArrayReader");function s(o){r.call(this,o)}t("../utils").inherits(s,r),s.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,n,a){var r=t("./DataReader");function s(o){r.call(this,o)}t("../utils").inherits(s,r),s.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},s.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},s.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},s.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./DataReader":18}],21:[function(t,n,a){var r=t("./ArrayReader");function s(o){r.call(this,o)}t("../utils").inherits(s,r),s.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(t,n,a){var r=t("../utils"),s=t("../support"),o=t("./ArrayReader"),l=t("./StringReader"),u=t("./NodeBufferReader"),f=t("./Uint8ArrayReader");n.exports=function(c){var d=r.getTypeOf(c);return r.checkSupport(d),d!=="string"||s.uint8array?d==="nodebuffer"?new u(c):s.uint8array?new f(r.transformTo("uint8array",c)):new o(r.transformTo("array",c)):new l(c)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,n,a){a.LOCAL_FILE_HEADER="PK",a.CENTRAL_FILE_HEADER="PK",a.CENTRAL_DIRECTORY_END="PK",a.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",a.ZIP64_CENTRAL_DIRECTORY_END="PK",a.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,n,a){var r=t("./GenericWorker"),s=t("../utils");function o(l){r.call(this,"ConvertWorker to "+l),this.destType=l}s.inherits(o,r),o.prototype.processChunk=function(l){this.push({data:s.transformTo(this.destType,l.data),meta:l.meta})},n.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(t,n,a){var r=t("./GenericWorker"),s=t("../crc32");function o(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(o,r),o.prototype.processChunk=function(l){this.streamInfo.crc32=s(l.data,this.streamInfo.crc32||0),this.push(l)},n.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,n,a){var r=t("../utils"),s=t("./GenericWorker");function o(l){s.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}r.inherits(o,s),o.prototype.processChunk=function(l){if(l){var u=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=u+l.data.length}s.prototype.processChunk.call(this,l)},n.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(t,n,a){var r=t("../utils"),s=t("./GenericWorker");function o(l){s.call(this,"DataWorker");var u=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(f){u.dataIsReady=!0,u.data=f,u.max=f&&f.length||0,u.type=r.getTypeOf(f),u.isPaused||u._tickAndRepeat()},function(f){u.error(f)})}r.inherits(o,s),o.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,u=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,u);break;case"uint8array":l=this.data.subarray(this.index,u);break;case"array":case"nodebuffer":l=this.data.slice(this.index,u)}return this.index=u,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(t,n,a){function r(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,o){return this._listeners[s].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,o){if(this._listeners[s])for(var l=0;l<this._listeners[s].length;l++)this._listeners[s][l].call(this,o)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var o=this;return s.on("data",function(l){o.processChunk(l)}),s.on("end",function(){o.end()}),s.on("error",function(l){o.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,o){return this.extraStreamInfo[s]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},n.exports=r},{}],29:[function(t,n,a){var r=t("../utils"),s=t("./ConvertWorker"),o=t("./GenericWorker"),l=t("../base64"),u=t("../support"),f=t("../external"),c=null;if(u.nodestream)try{c=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(p,m){return new f.Promise(function(g,b){var x=[],v=p._internalType,C=p._outputType,E=p._mimeType;p.on("data",function(R,O){x.push(R),m&&m(O)}).on("error",function(R){x=[],b(R)}).on("end",function(){try{var R=function(O,H,N){switch(O){case"blob":return r.newBlob(r.transformTo("arraybuffer",H),N);case"base64":return l.encode(H);default:return r.transformTo(O,H)}}(C,function(O,H){var N,K=0,ae=null,T=0;for(N=0;N<H.length;N++)T+=H[N].length;switch(O){case"string":return H.join("");case"array":return Array.prototype.concat.apply([],H);case"uint8array":for(ae=new Uint8Array(T),N=0;N<H.length;N++)ae.set(H[N],K),K+=H[N].length;return ae;case"nodebuffer":return Buffer.concat(H);default:throw new Error("concat : unsupported type '"+O+"'")}}(v,x),E);g(R)}catch(O){b(O)}x=[]}).resume()})}function h(p,m,g){var b=m;switch(m){case"blob":case"arraybuffer":b="uint8array";break;case"base64":b="string"}try{this._internalType=b,this._outputType=m,this._mimeType=g,r.checkSupport(b),this._worker=p.pipe(new s(b)),p.lock()}catch(x){this._worker=new o("error"),this._worker.error(x)}}h.prototype={accumulate:function(p){return d(this,p)},on:function(p,m){var g=this;return p==="data"?this._worker.on(p,function(b){m.call(g,b.data,b.meta)}):this._worker.on(p,function(){r.delay(m,arguments,g)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(r.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new c(this,{objectMode:this._outputType!=="nodebuffer"},p)}},n.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,n,a){if(a.base64=!0,a.array=!0,a.string=!0,a.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",a.nodebuffer=typeof Buffer<"u",a.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")a.blob=!1;else{var r=new ArrayBuffer(0);try{a.blob=new Blob([r],{type:"application/zip"}).size===0}catch{try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(r),a.blob=s.getBlob("application/zip").size===0}catch{a.blob=!1}}}try{a.nodestream=!!t("readable-stream").Readable}catch{a.nodestream=!1}},{"readable-stream":16}],31:[function(t,n,a){for(var r=t("./utils"),s=t("./support"),o=t("./nodejsUtils"),l=t("./stream/GenericWorker"),u=new Array(256),f=0;f<256;f++)u[f]=252<=f?6:248<=f?5:240<=f?4:224<=f?3:192<=f?2:1;u[254]=u[254]=1;function c(){l.call(this,"utf-8 decode"),this.leftOver=null}function d(){l.call(this,"utf-8 encode")}a.utf8encode=function(h){return s.nodebuffer?o.newBufferFrom(h,"utf-8"):function(p){var m,g,b,x,v,C=p.length,E=0;for(x=0;x<C;x++)(64512&(g=p.charCodeAt(x)))==55296&&x+1<C&&(64512&(b=p.charCodeAt(x+1)))==56320&&(g=65536+(g-55296<<10)+(b-56320),x++),E+=g<128?1:g<2048?2:g<65536?3:4;for(m=s.uint8array?new Uint8Array(E):new Array(E),x=v=0;v<E;x++)(64512&(g=p.charCodeAt(x)))==55296&&x+1<C&&(64512&(b=p.charCodeAt(x+1)))==56320&&(g=65536+(g-55296<<10)+(b-56320),x++),g<128?m[v++]=g:(g<2048?m[v++]=192|g>>>6:(g<65536?m[v++]=224|g>>>12:(m[v++]=240|g>>>18,m[v++]=128|g>>>12&63),m[v++]=128|g>>>6&63),m[v++]=128|63&g);return m}(h)},a.utf8decode=function(h){return s.nodebuffer?r.transformTo("nodebuffer",h).toString("utf-8"):function(p){var m,g,b,x,v=p.length,C=new Array(2*v);for(m=g=0;m<v;)if((b=p[m++])<128)C[g++]=b;else if(4<(x=u[b]))C[g++]=65533,m+=x-1;else{for(b&=x===2?31:x===3?15:7;1<x&&m<v;)b=b<<6|63&p[m++],x--;1<x?C[g++]=65533:b<65536?C[g++]=b:(b-=65536,C[g++]=55296|b>>10&1023,C[g++]=56320|1023&b)}return C.length!==g&&(C.subarray?C=C.subarray(0,g):C.length=g),r.applyFromCharCode(C)}(h=r.transformTo(s.uint8array?"uint8array":"array",h))},r.inherits(c,l),c.prototype.processChunk=function(h){var p=r.transformTo(s.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var m=p;(p=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),p.set(m,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var g=function(x,v){var C;for((v=v||x.length)>x.length&&(v=x.length),C=v-1;0<=C&&(192&x[C])==128;)C--;return C<0||C===0?v:C+u[x[C]]>v?C:v}(p),b=p;g!==p.length&&(s.uint8array?(b=p.subarray(0,g),this.leftOver=p.subarray(g,p.length)):(b=p.slice(0,g),this.leftOver=p.slice(g,p.length))),this.push({data:a.utf8decode(b),meta:h.meta})},c.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:a.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},a.Utf8DecodeWorker=c,r.inherits(d,l),d.prototype.processChunk=function(h){this.push({data:a.utf8encode(h.data),meta:h.meta})},a.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,n,a){var r=t("./support"),s=t("./base64"),o=t("./nodejsUtils"),l=t("./external");function u(m){return m}function f(m,g){for(var b=0;b<m.length;++b)g[b]=255&m.charCodeAt(b);return g}t("setimmediate"),a.newBlob=function(m,g){a.checkSupport("blob");try{return new Blob([m],{type:g})}catch{try{var b=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return b.append(m),b.getBlob(g)}catch{throw new Error("Bug : can't construct the Blob.")}}};var c={stringifyByChunk:function(m,g,b){var x=[],v=0,C=m.length;if(C<=b)return String.fromCharCode.apply(null,m);for(;v<C;)g==="array"||g==="nodebuffer"?x.push(String.fromCharCode.apply(null,m.slice(v,Math.min(v+b,C)))):x.push(String.fromCharCode.apply(null,m.subarray(v,Math.min(v+b,C)))),v+=b;return x.join("")},stringifyByChar:function(m){for(var g="",b=0;b<m.length;b++)g+=String.fromCharCode(m[b]);return g},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function d(m){var g=65536,b=a.getTypeOf(m),x=!0;if(b==="uint8array"?x=c.applyCanBeUsed.uint8array:b==="nodebuffer"&&(x=c.applyCanBeUsed.nodebuffer),x)for(;1<g;)try{return c.stringifyByChunk(m,b,g)}catch{g=Math.floor(g/2)}return c.stringifyByChar(m)}function h(m,g){for(var b=0;b<m.length;b++)g[b]=m[b];return g}a.applyFromCharCode=d;var p={};p.string={string:u,array:function(m){return f(m,new Array(m.length))},arraybuffer:function(m){return p.string.uint8array(m).buffer},uint8array:function(m){return f(m,new Uint8Array(m.length))},nodebuffer:function(m){return f(m,o.allocBuffer(m.length))}},p.array={string:d,array:u,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return o.newBufferFrom(m)}},p.arraybuffer={string:function(m){return d(new Uint8Array(m))},array:function(m){return h(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:u,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return o.newBufferFrom(new Uint8Array(m))}},p.uint8array={string:d,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:u,nodebuffer:function(m){return o.newBufferFrom(m)}},p.nodebuffer={string:d,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return p.nodebuffer.uint8array(m).buffer},uint8array:function(m){return h(m,new Uint8Array(m.length))},nodebuffer:u},a.transformTo=function(m,g){if(g=g||"",!m)return g;a.checkSupport(m);var b=a.getTypeOf(g);return p[b][m](g)},a.resolve=function(m){for(var g=m.split("/"),b=[],x=0;x<g.length;x++){var v=g[x];v==="."||v===""&&x!==0&&x!==g.length-1||(v===".."?b.pop():b.push(v))}return b.join("/")},a.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":r.nodebuffer&&o.isBuffer(m)?"nodebuffer":r.uint8array&&m instanceof Uint8Array?"uint8array":r.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},a.checkSupport=function(m){if(!r[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},a.MAX_VALUE_16BITS=65535,a.MAX_VALUE_32BITS=-1,a.pretty=function(m){var g,b,x="";for(b=0;b<(m||"").length;b++)x+="\\x"+((g=m.charCodeAt(b))<16?"0":"")+g.toString(16).toUpperCase();return x},a.delay=function(m,g,b){setImmediate(function(){m.apply(b||null,g||[])})},a.inherits=function(m,g){function b(){}b.prototype=g.prototype,m.prototype=new b},a.extend=function(){var m,g,b={};for(m=0;m<arguments.length;m++)for(g in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],g)&&b[g]===void 0&&(b[g]=arguments[m][g]);return b},a.prepareContent=function(m,g,b,x,v){return l.Promise.resolve(g).then(function(C){return r.blob&&(C instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(C))!==-1)&&typeof FileReader<"u"?new l.Promise(function(E,R){var O=new FileReader;O.onload=function(H){E(H.target.result)},O.onerror=function(H){R(H.target.error)},O.readAsArrayBuffer(C)}):C}).then(function(C){var E=a.getTypeOf(C);return E?(E==="arraybuffer"?C=a.transformTo("uint8array",C):E==="string"&&(v?C=s.decode(C):b&&x!==!0&&(C=function(R){return f(R,r.uint8array?new Uint8Array(R.length):new Array(R.length))}(C))),C):l.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,n,a){var r=t("./reader/readerFor"),s=t("./utils"),o=t("./signature"),l=t("./zipEntry"),u=t("./support");function f(c){this.files=[],this.loadOptions=c}f.prototype={checkSignature:function(c){if(!this.reader.readAndCheckSignature(c)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(d)+", expected "+s.pretty(c)+")")}},isSignature:function(c,d){var h=this.reader.index;this.reader.setIndex(c);var p=this.reader.readString(4)===d;return this.reader.setIndex(h),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var c=this.reader.readData(this.zipCommentLength),d=u.uint8array?"uint8array":"array",h=s.transformTo(d,c);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var c,d,h,p=this.zip64EndOfCentralSize-44;0<p;)c=this.reader.readInt(2),d=this.reader.readInt(4),h=this.reader.readData(d),this.zip64ExtensibleData[c]={id:c,length:d,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var c,d;for(c=0;c<this.files.length;c++)d=this.files[c],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var c;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(c=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(c);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var c=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(c<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(c);var d=c;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(c=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(c),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var p=d-h;if(0<p)this.isSignature(d,o.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(c){this.reader=r(c)},load:function(c){this.prepareReader(c),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=f},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,n,a){var r=t("./reader/readerFor"),s=t("./utils"),o=t("./compressedObject"),l=t("./crc32"),u=t("./utf8"),f=t("./compressions"),c=t("./support");function d(h,p){this.options=h,this.loadOptions=p}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var p,m;if(h.skip(22),this.fileNameLength=h.readInt(2),m=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(g){for(var b in f)if(Object.prototype.hasOwnProperty.call(f,b)&&f[b].magic===g)return f[b];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,p,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var p=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(p),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=r(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var p,m,g,b=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<b;)p=h.readInt(2),m=h.readInt(2),g=h.readData(m),this.extraFields[p]={id:p,length:m,value:g};h.setIndex(b)},handleUTF8:function(){var h=c.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=u.utf8decode(this.fileName),this.fileCommentStr=u.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var m=s.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var g=this.findExtraFieldUnicodeComment();if(g!==null)this.fileCommentStr=g;else{var b=s.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(b)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var p=r(h.value);return p.readInt(1)!==1||l(this.fileName)!==p.readInt(4)?null:u.utf8decode(p.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var p=r(h.value);return p.readInt(1)!==1||l(this.fileComment)!==p.readInt(4)?null:u.utf8decode(p.readData(h.length-5))}return null}},n.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,n,a){function r(p,m,g){this.name=p,this.dir=g.dir,this.date=g.date,this.comment=g.comment,this.unixPermissions=g.unixPermissions,this.dosPermissions=g.dosPermissions,this._data=m,this._dataBinary=g.binary,this.options={compression:g.compression,compressionOptions:g.compressionOptions}}var s=t("./stream/StreamHelper"),o=t("./stream/DataWorker"),l=t("./utf8"),u=t("./compressedObject"),f=t("./stream/GenericWorker");r.prototype={internalStream:function(p){var m=null,g="string";try{if(!p)throw new Error("No output type specified.");var b=(g=p.toLowerCase())==="string"||g==="text";g!=="binarystring"&&g!=="text"||(g="string"),m=this._decompressWorker();var x=!this._dataBinary;x&&!b&&(m=m.pipe(new l.Utf8EncodeWorker)),!x&&b&&(m=m.pipe(new l.Utf8DecodeWorker))}catch(v){(m=new f("error")).error(v)}return new s(m,g,"")},async:function(p,m){return this.internalStream(p).accumulate(m)},nodeStream:function(p,m){return this.internalStream(p||"nodebuffer").toNodejsStream(m)},_compressWorker:function(p,m){if(this._data instanceof u&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var g=this._decompressWorker();return this._dataBinary||(g=g.pipe(new l.Utf8EncodeWorker)),u.createWorkerFrom(g,p,m)},_decompressWorker:function(){return this._data instanceof u?this._data.getContentWorker():this._data instanceof f?this._data:new o(this._data)}};for(var c=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<c.length;h++)r.prototype[c[h]]=d;n.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,n,a){(function(r){var s,o,l=r.MutationObserver||r.WebKitMutationObserver;if(l){var u=0,f=new l(p),c=r.document.createTextNode("");f.observe(c,{characterData:!0}),s=function(){c.data=u=++u%2}}else if(r.setImmediate||r.MessageChannel===void 0)s="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var m=r.document.createElement("script");m.onreadystatechange=function(){p(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},r.document.documentElement.appendChild(m)}:function(){setTimeout(p,0)};else{var d=new r.MessageChannel;d.port1.onmessage=p,s=function(){d.port2.postMessage(0)}}var h=[];function p(){var m,g;o=!0;for(var b=h.length;b;){for(g=h,h=[],m=-1;++m<b;)g[m]();b=h.length}o=!1}n.exports=function(m){h.push(m)!==1||o||s()}}).call(this,typeof hi<"u"?hi:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,n,a){var r=t("immediate");function s(){}var o={},l=["REJECTED"],u=["FULFILLED"],f=["PENDING"];function c(b){if(typeof b!="function")throw new TypeError("resolver must be a function");this.state=f,this.queue=[],this.outcome=void 0,b!==s&&m(this,b)}function d(b,x,v){this.promise=b,typeof x=="function"&&(this.onFulfilled=x,this.callFulfilled=this.otherCallFulfilled),typeof v=="function"&&(this.onRejected=v,this.callRejected=this.otherCallRejected)}function h(b,x,v){r(function(){var C;try{C=x(v)}catch(E){return o.reject(b,E)}C===b?o.reject(b,new TypeError("Cannot resolve promise with itself")):o.resolve(b,C)})}function p(b){var x=b&&b.then;if(b&&(typeof b=="object"||typeof b=="function")&&typeof x=="function")return function(){x.apply(b,arguments)}}function m(b,x){var v=!1;function C(O){v||(v=!0,o.reject(b,O))}function E(O){v||(v=!0,o.resolve(b,O))}var R=g(function(){x(E,C)});R.status==="error"&&C(R.value)}function g(b,x){var v={};try{v.value=b(x),v.status="success"}catch(C){v.status="error",v.value=C}return v}(n.exports=c).prototype.finally=function(b){if(typeof b!="function")return this;var x=this.constructor;return this.then(function(v){return x.resolve(b()).then(function(){return v})},function(v){return x.resolve(b()).then(function(){throw v})})},c.prototype.catch=function(b){return this.then(null,b)},c.prototype.then=function(b,x){if(typeof b!="function"&&this.state===u||typeof x!="function"&&this.state===l)return this;var v=new this.constructor(s);return this.state!==f?h(v,this.state===u?b:x,this.outcome):this.queue.push(new d(v,b,x)),v},d.prototype.callFulfilled=function(b){o.resolve(this.promise,b)},d.prototype.otherCallFulfilled=function(b){h(this.promise,this.onFulfilled,b)},d.prototype.callRejected=function(b){o.reject(this.promise,b)},d.prototype.otherCallRejected=function(b){h(this.promise,this.onRejected,b)},o.resolve=function(b,x){var v=g(p,x);if(v.status==="error")return o.reject(b,v.value);var C=v.value;if(C)m(b,C);else{b.state=u,b.outcome=x;for(var E=-1,R=b.queue.length;++E<R;)b.queue[E].callFulfilled(x)}return b},o.reject=function(b,x){b.state=l,b.outcome=x;for(var v=-1,C=b.queue.length;++v<C;)b.queue[v].callRejected(x);return b},c.resolve=function(b){return b instanceof this?b:o.resolve(new this(s),b)},c.reject=function(b){var x=new this(s);return o.reject(x,b)},c.all=function(b){var x=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=b.length,C=!1;if(!v)return this.resolve([]);for(var E=new Array(v),R=0,O=-1,H=new this(s);++O<v;)N(b[O],O);return H;function N(K,ae){x.resolve(K).then(function(T){E[ae]=T,++R!==v||C||(C=!0,o.resolve(H,E))},function(T){C||(C=!0,o.reject(H,T))})}},c.race=function(b){var x=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=b.length,C=!1;if(!v)return this.resolve([]);for(var E=-1,R=new this(s);++E<v;)O=b[E],x.resolve(O).then(function(H){C||(C=!0,o.resolve(R,H))},function(H){C||(C=!0,o.reject(R,H))});var O;return R}},{immediate:36}],38:[function(t,n,a){var r={};(0,t("./lib/utils/common").assign)(r,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),n.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,n,a){var r=t("./zlib/deflate"),s=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/messages"),u=t("./zlib/zstream"),f=Object.prototype.toString,c=0,d=-1,h=0,p=8;function m(b){if(!(this instanceof m))return new m(b);this.options=s.assign({level:d,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},b||{});var x=this.options;x.raw&&0<x.windowBits?x.windowBits=-x.windowBits:x.gzip&&0<x.windowBits&&x.windowBits<16&&(x.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var v=r.deflateInit2(this.strm,x.level,x.method,x.windowBits,x.memLevel,x.strategy);if(v!==c)throw new Error(l[v]);if(x.header&&r.deflateSetHeader(this.strm,x.header),x.dictionary){var C;if(C=typeof x.dictionary=="string"?o.string2buf(x.dictionary):f.call(x.dictionary)==="[object ArrayBuffer]"?new Uint8Array(x.dictionary):x.dictionary,(v=r.deflateSetDictionary(this.strm,C))!==c)throw new Error(l[v]);this._dict_set=!0}}function g(b,x){var v=new m(x);if(v.push(b,!0),v.err)throw v.msg||l[v.err];return v.result}m.prototype.push=function(b,x){var v,C,E=this.strm,R=this.options.chunkSize;if(this.ended)return!1;C=x===~~x?x:x===!0?4:0,typeof b=="string"?E.input=o.string2buf(b):f.call(b)==="[object ArrayBuffer]"?E.input=new Uint8Array(b):E.input=b,E.next_in=0,E.avail_in=E.input.length;do{if(E.avail_out===0&&(E.output=new s.Buf8(R),E.next_out=0,E.avail_out=R),(v=r.deflate(E,C))!==1&&v!==c)return this.onEnd(v),!(this.ended=!0);E.avail_out!==0&&(E.avail_in!==0||C!==4&&C!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(s.shrinkBuf(E.output,E.next_out))):this.onData(s.shrinkBuf(E.output,E.next_out)))}while((0<E.avail_in||E.avail_out===0)&&v!==1);return C===4?(v=r.deflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===c):C!==2||(this.onEnd(c),!(E.avail_out=0))},m.prototype.onData=function(b){this.chunks.push(b)},m.prototype.onEnd=function(b){b===c&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.msg=this.strm.msg},a.Deflate=m,a.deflate=g,a.deflateRaw=function(b,x){return(x=x||{}).raw=!0,g(b,x)},a.gzip=function(b,x){return(x=x||{}).gzip=!0,g(b,x)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,n,a){var r=t("./zlib/inflate"),s=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/constants"),u=t("./zlib/messages"),f=t("./zlib/zstream"),c=t("./zlib/gzheader"),d=Object.prototype.toString;function h(m){if(!(this instanceof h))return new h(m);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},m||{});var g=this.options;g.raw&&0<=g.windowBits&&g.windowBits<16&&(g.windowBits=-g.windowBits,g.windowBits===0&&(g.windowBits=-15)),!(0<=g.windowBits&&g.windowBits<16)||m&&m.windowBits||(g.windowBits+=32),15<g.windowBits&&g.windowBits<48&&(15&g.windowBits)==0&&(g.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var b=r.inflateInit2(this.strm,g.windowBits);if(b!==l.Z_OK)throw new Error(u[b]);this.header=new c,r.inflateGetHeader(this.strm,this.header)}function p(m,g){var b=new h(g);if(b.push(m,!0),b.err)throw b.msg||u[b.err];return b.result}h.prototype.push=function(m,g){var b,x,v,C,E,R,O=this.strm,H=this.options.chunkSize,N=this.options.dictionary,K=!1;if(this.ended)return!1;x=g===~~g?g:g===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof m=="string"?O.input=o.binstring2buf(m):d.call(m)==="[object ArrayBuffer]"?O.input=new Uint8Array(m):O.input=m,O.next_in=0,O.avail_in=O.input.length;do{if(O.avail_out===0&&(O.output=new s.Buf8(H),O.next_out=0,O.avail_out=H),(b=r.inflate(O,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&N&&(R=typeof N=="string"?o.string2buf(N):d.call(N)==="[object ArrayBuffer]"?new Uint8Array(N):N,b=r.inflateSetDictionary(this.strm,R)),b===l.Z_BUF_ERROR&&K===!0&&(b=l.Z_OK,K=!1),b!==l.Z_STREAM_END&&b!==l.Z_OK)return this.onEnd(b),!(this.ended=!0);O.next_out&&(O.avail_out!==0&&b!==l.Z_STREAM_END&&(O.avail_in!==0||x!==l.Z_FINISH&&x!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(v=o.utf8border(O.output,O.next_out),C=O.next_out-v,E=o.buf2string(O.output,v),O.next_out=C,O.avail_out=H-C,C&&s.arraySet(O.output,O.output,v,C,0),this.onData(E)):this.onData(s.shrinkBuf(O.output,O.next_out)))),O.avail_in===0&&O.avail_out===0&&(K=!0)}while((0<O.avail_in||O.avail_out===0)&&b!==l.Z_STREAM_END);return b===l.Z_STREAM_END&&(x=l.Z_FINISH),x===l.Z_FINISH?(b=r.inflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===l.Z_OK):x!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(O.avail_out=0))},h.prototype.onData=function(m){this.chunks.push(m)},h.prototype.onEnd=function(m){m===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},a.Inflate=h,a.inflate=p,a.inflateRaw=function(m,g){return(g=g||{}).raw=!0,p(m,g)},a.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,n,a){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";a.assign=function(l){for(var u=Array.prototype.slice.call(arguments,1);u.length;){var f=u.shift();if(f){if(typeof f!="object")throw new TypeError(f+"must be non-object");for(var c in f)f.hasOwnProperty(c)&&(l[c]=f[c])}}return l},a.shrinkBuf=function(l,u){return l.length===u?l:l.subarray?l.subarray(0,u):(l.length=u,l)};var s={arraySet:function(l,u,f,c,d){if(u.subarray&&l.subarray)l.set(u.subarray(f,f+c),d);else for(var h=0;h<c;h++)l[d+h]=u[f+h]},flattenChunks:function(l){var u,f,c,d,h,p;for(u=c=0,f=l.length;u<f;u++)c+=l[u].length;for(p=new Uint8Array(c),u=d=0,f=l.length;u<f;u++)h=l[u],p.set(h,d),d+=h.length;return p}},o={arraySet:function(l,u,f,c,d){for(var h=0;h<c;h++)l[d+h]=u[f+h]},flattenChunks:function(l){return[].concat.apply([],l)}};a.setTyped=function(l){l?(a.Buf8=Uint8Array,a.Buf16=Uint16Array,a.Buf32=Int32Array,a.assign(a,s)):(a.Buf8=Array,a.Buf16=Array,a.Buf32=Array,a.assign(a,o))},a.setTyped(r)},{}],42:[function(t,n,a){var r=t("./common"),s=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var l=new r.Buf8(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;function f(c,d){if(d<65537&&(c.subarray&&o||!c.subarray&&s))return String.fromCharCode.apply(null,r.shrinkBuf(c,d));for(var h="",p=0;p<d;p++)h+=String.fromCharCode(c[p]);return h}l[254]=l[254]=1,a.string2buf=function(c){var d,h,p,m,g,b=c.length,x=0;for(m=0;m<b;m++)(64512&(h=c.charCodeAt(m)))==55296&&m+1<b&&(64512&(p=c.charCodeAt(m+1)))==56320&&(h=65536+(h-55296<<10)+(p-56320),m++),x+=h<128?1:h<2048?2:h<65536?3:4;for(d=new r.Buf8(x),m=g=0;g<x;m++)(64512&(h=c.charCodeAt(m)))==55296&&m+1<b&&(64512&(p=c.charCodeAt(m+1)))==56320&&(h=65536+(h-55296<<10)+(p-56320),m++),h<128?d[g++]=h:(h<2048?d[g++]=192|h>>>6:(h<65536?d[g++]=224|h>>>12:(d[g++]=240|h>>>18,d[g++]=128|h>>>12&63),d[g++]=128|h>>>6&63),d[g++]=128|63&h);return d},a.buf2binstring=function(c){return f(c,c.length)},a.binstring2buf=function(c){for(var d=new r.Buf8(c.length),h=0,p=d.length;h<p;h++)d[h]=c.charCodeAt(h);return d},a.buf2string=function(c,d){var h,p,m,g,b=d||c.length,x=new Array(2*b);for(h=p=0;h<b;)if((m=c[h++])<128)x[p++]=m;else if(4<(g=l[m]))x[p++]=65533,h+=g-1;else{for(m&=g===2?31:g===3?15:7;1<g&&h<b;)m=m<<6|63&c[h++],g--;1<g?x[p++]=65533:m<65536?x[p++]=m:(m-=65536,x[p++]=55296|m>>10&1023,x[p++]=56320|1023&m)}return f(x,p)},a.utf8border=function(c,d){var h;for((d=d||c.length)>c.length&&(d=c.length),h=d-1;0<=h&&(192&c[h])==128;)h--;return h<0||h===0?d:h+l[c[h]]>d?h:d}},{"./common":41}],43:[function(t,n,a){n.exports=function(r,s,o,l){for(var u=65535&r|0,f=r>>>16&65535|0,c=0;o!==0;){for(o-=c=2e3<o?2e3:o;f=f+(u=u+s[l++]|0)|0,--c;);u%=65521,f%=65521}return u|f<<16|0}},{}],44:[function(t,n,a){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,n,a){var r=function(){for(var s,o=[],l=0;l<256;l++){s=l;for(var u=0;u<8;u++)s=1&s?3988292384^s>>>1:s>>>1;o[l]=s}return o}();n.exports=function(s,o,l,u){var f=r,c=u+l;s^=-1;for(var d=u;d<c;d++)s=s>>>8^f[255&(s^o[d])];return-1^s}},{}],46:[function(t,n,a){var r,s=t("../utils/common"),o=t("./trees"),l=t("./adler32"),u=t("./crc32"),f=t("./messages"),c=0,d=4,h=0,p=-2,m=-1,g=4,b=2,x=8,v=9,C=286,E=30,R=19,O=2*C+1,H=15,N=3,K=258,ae=K+N+1,T=42,W=113,w=1,M=2,G=3,B=4;function D(_,Z){return _.msg=f[Z],Z}function V(_){return(_<<1)-(4<_?9:0)}function X(_){for(var Z=_.length;0<=--Z;)_[Z]=0}function P(_){var Z=_.state,q=Z.pending;q>_.avail_out&&(q=_.avail_out),q!==0&&(s.arraySet(_.output,Z.pending_buf,Z.pending_out,q,_.next_out),_.next_out+=q,Z.pending_out+=q,_.total_out+=q,_.avail_out-=q,Z.pending-=q,Z.pending===0&&(Z.pending_out=0))}function F(_,Z){o._tr_flush_block(_,0<=_.block_start?_.block_start:-1,_.strstart-_.block_start,Z),_.block_start=_.strstart,P(_.strm)}function ne(_,Z){_.pending_buf[_.pending++]=Z}function ie(_,Z){_.pending_buf[_.pending++]=Z>>>8&255,_.pending_buf[_.pending++]=255&Z}function ee(_,Z){var q,S,k=_.max_chain_length,z=_.strstart,j=_.prev_length,J=_.nice_match,U=_.strstart>_.w_size-ae?_.strstart-(_.w_size-ae):0,se=_.window,ce=_.w_mask,oe=_.prev,me=_.strstart+K,Ue=se[z+j-1],Me=se[z+j];_.prev_length>=_.good_match&&(k>>=2),J>_.lookahead&&(J=_.lookahead);do if(se[(q=Z)+j]===Me&&se[q+j-1]===Ue&&se[q]===se[z]&&se[++q]===se[z+1]){z+=2,q++;do;while(se[++z]===se[++q]&&se[++z]===se[++q]&&se[++z]===se[++q]&&se[++z]===se[++q]&&se[++z]===se[++q]&&se[++z]===se[++q]&&se[++z]===se[++q]&&se[++z]===se[++q]&&z<me);if(S=K-(me-z),z=me-K,j<S){if(_.match_start=Z,J<=(j=S))break;Ue=se[z+j-1],Me=se[z+j]}}while((Z=oe[Z&ce])>U&&--k!=0);return j<=_.lookahead?j:_.lookahead}function ke(_){var Z,q,S,k,z,j,J,U,se,ce,oe=_.w_size;do{if(k=_.window_size-_.lookahead-_.strstart,_.strstart>=oe+(oe-ae)){for(s.arraySet(_.window,_.window,oe,oe,0),_.match_start-=oe,_.strstart-=oe,_.block_start-=oe,Z=q=_.hash_size;S=_.head[--Z],_.head[Z]=oe<=S?S-oe:0,--q;);for(Z=q=oe;S=_.prev[--Z],_.prev[Z]=oe<=S?S-oe:0,--q;);k+=oe}if(_.strm.avail_in===0)break;if(j=_.strm,J=_.window,U=_.strstart+_.lookahead,se=k,ce=void 0,ce=j.avail_in,se<ce&&(ce=se),q=ce===0?0:(j.avail_in-=ce,s.arraySet(J,j.input,j.next_in,ce,U),j.state.wrap===1?j.adler=l(j.adler,J,ce,U):j.state.wrap===2&&(j.adler=u(j.adler,J,ce,U)),j.next_in+=ce,j.total_in+=ce,ce),_.lookahead+=q,_.lookahead+_.insert>=N)for(z=_.strstart-_.insert,_.ins_h=_.window[z],_.ins_h=(_.ins_h<<_.hash_shift^_.window[z+1])&_.hash_mask;_.insert&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[z+N-1])&_.hash_mask,_.prev[z&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=z,z++,_.insert--,!(_.lookahead+_.insert<N)););}while(_.lookahead<ae&&_.strm.avail_in!==0)}function Oe(_,Z){for(var q,S;;){if(_.lookahead<ae){if(ke(_),_.lookahead<ae&&Z===c)return w;if(_.lookahead===0)break}if(q=0,_.lookahead>=N&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+N-1])&_.hash_mask,q=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart),q!==0&&_.strstart-q<=_.w_size-ae&&(_.match_length=ee(_,q)),_.match_length>=N)if(S=o._tr_tally(_,_.strstart-_.match_start,_.match_length-N),_.lookahead-=_.match_length,_.match_length<=_.max_lazy_match&&_.lookahead>=N){for(_.match_length--;_.strstart++,_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+N-1])&_.hash_mask,q=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart,--_.match_length!=0;);_.strstart++}else _.strstart+=_.match_length,_.match_length=0,_.ins_h=_.window[_.strstart],_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+1])&_.hash_mask;else S=o._tr_tally(_,0,_.window[_.strstart]),_.lookahead--,_.strstart++;if(S&&(F(_,!1),_.strm.avail_out===0))return w}return _.insert=_.strstart<N-1?_.strstart:N-1,Z===d?(F(_,!0),_.strm.avail_out===0?G:B):_.last_lit&&(F(_,!1),_.strm.avail_out===0)?w:M}function we(_,Z){for(var q,S,k;;){if(_.lookahead<ae){if(ke(_),_.lookahead<ae&&Z===c)return w;if(_.lookahead===0)break}if(q=0,_.lookahead>=N&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+N-1])&_.hash_mask,q=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart),_.prev_length=_.match_length,_.prev_match=_.match_start,_.match_length=N-1,q!==0&&_.prev_length<_.max_lazy_match&&_.strstart-q<=_.w_size-ae&&(_.match_length=ee(_,q),_.match_length<=5&&(_.strategy===1||_.match_length===N&&4096<_.strstart-_.match_start)&&(_.match_length=N-1)),_.prev_length>=N&&_.match_length<=_.prev_length){for(k=_.strstart+_.lookahead-N,S=o._tr_tally(_,_.strstart-1-_.prev_match,_.prev_length-N),_.lookahead-=_.prev_length-1,_.prev_length-=2;++_.strstart<=k&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+N-1])&_.hash_mask,q=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart),--_.prev_length!=0;);if(_.match_available=0,_.match_length=N-1,_.strstart++,S&&(F(_,!1),_.strm.avail_out===0))return w}else if(_.match_available){if((S=o._tr_tally(_,0,_.window[_.strstart-1]))&&F(_,!1),_.strstart++,_.lookahead--,_.strm.avail_out===0)return w}else _.match_available=1,_.strstart++,_.lookahead--}return _.match_available&&(S=o._tr_tally(_,0,_.window[_.strstart-1]),_.match_available=0),_.insert=_.strstart<N-1?_.strstart:N-1,Z===d?(F(_,!0),_.strm.avail_out===0?G:B):_.last_lit&&(F(_,!1),_.strm.avail_out===0)?w:M}function ge(_,Z,q,S,k){this.good_length=_,this.max_lazy=Z,this.nice_length=q,this.max_chain=S,this.func=k}function Te(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=x,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*O),this.dyn_dtree=new s.Buf16(2*(2*E+1)),this.bl_tree=new s.Buf16(2*(2*R+1)),X(this.dyn_ltree),X(this.dyn_dtree),X(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(H+1),this.heap=new s.Buf16(2*C+1),X(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*C+1),X(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Le(_){var Z;return _&&_.state?(_.total_in=_.total_out=0,_.data_type=b,(Z=_.state).pending=0,Z.pending_out=0,Z.wrap<0&&(Z.wrap=-Z.wrap),Z.status=Z.wrap?T:W,_.adler=Z.wrap===2?0:1,Z.last_flush=c,o._tr_init(Z),h):D(_,p)}function nt(_){var Z=Le(_);return Z===h&&function(q){q.window_size=2*q.w_size,X(q.head),q.max_lazy_match=r[q.level].max_lazy,q.good_match=r[q.level].good_length,q.nice_match=r[q.level].nice_length,q.max_chain_length=r[q.level].max_chain,q.strstart=0,q.block_start=0,q.lookahead=0,q.insert=0,q.match_length=q.prev_length=N-1,q.match_available=0,q.ins_h=0}(_.state),Z}function at(_,Z,q,S,k,z){if(!_)return p;var j=1;if(Z===m&&(Z=6),S<0?(j=0,S=-S):15<S&&(j=2,S-=16),k<1||v<k||q!==x||S<8||15<S||Z<0||9<Z||z<0||g<z)return D(_,p);S===8&&(S=9);var J=new Te;return(_.state=J).strm=_,J.wrap=j,J.gzhead=null,J.w_bits=S,J.w_size=1<<J.w_bits,J.w_mask=J.w_size-1,J.hash_bits=k+7,J.hash_size=1<<J.hash_bits,J.hash_mask=J.hash_size-1,J.hash_shift=~~((J.hash_bits+N-1)/N),J.window=new s.Buf8(2*J.w_size),J.head=new s.Buf16(J.hash_size),J.prev=new s.Buf16(J.w_size),J.lit_bufsize=1<<k+6,J.pending_buf_size=4*J.lit_bufsize,J.pending_buf=new s.Buf8(J.pending_buf_size),J.d_buf=1*J.lit_bufsize,J.l_buf=3*J.lit_bufsize,J.level=Z,J.strategy=z,J.method=q,nt(_)}r=[new ge(0,0,0,0,function(_,Z){var q=65535;for(q>_.pending_buf_size-5&&(q=_.pending_buf_size-5);;){if(_.lookahead<=1){if(ke(_),_.lookahead===0&&Z===c)return w;if(_.lookahead===0)break}_.strstart+=_.lookahead,_.lookahead=0;var S=_.block_start+q;if((_.strstart===0||_.strstart>=S)&&(_.lookahead=_.strstart-S,_.strstart=S,F(_,!1),_.strm.avail_out===0)||_.strstart-_.block_start>=_.w_size-ae&&(F(_,!1),_.strm.avail_out===0))return w}return _.insert=0,Z===d?(F(_,!0),_.strm.avail_out===0?G:B):(_.strstart>_.block_start&&(F(_,!1),_.strm.avail_out),w)}),new ge(4,4,8,4,Oe),new ge(4,5,16,8,Oe),new ge(4,6,32,32,Oe),new ge(4,4,16,16,we),new ge(8,16,32,32,we),new ge(8,16,128,128,we),new ge(8,32,128,256,we),new ge(32,128,258,1024,we),new ge(32,258,258,4096,we)],a.deflateInit=function(_,Z){return at(_,Z,x,15,8,0)},a.deflateInit2=at,a.deflateReset=nt,a.deflateResetKeep=Le,a.deflateSetHeader=function(_,Z){return _&&_.state?_.state.wrap!==2?p:(_.state.gzhead=Z,h):p},a.deflate=function(_,Z){var q,S,k,z;if(!_||!_.state||5<Z||Z<0)return _?D(_,p):p;if(S=_.state,!_.output||!_.input&&_.avail_in!==0||S.status===666&&Z!==d)return D(_,_.avail_out===0?-5:p);if(S.strm=_,q=S.last_flush,S.last_flush=Z,S.status===T)if(S.wrap===2)_.adler=0,ne(S,31),ne(S,139),ne(S,8),S.gzhead?(ne(S,(S.gzhead.text?1:0)+(S.gzhead.hcrc?2:0)+(S.gzhead.extra?4:0)+(S.gzhead.name?8:0)+(S.gzhead.comment?16:0)),ne(S,255&S.gzhead.time),ne(S,S.gzhead.time>>8&255),ne(S,S.gzhead.time>>16&255),ne(S,S.gzhead.time>>24&255),ne(S,S.level===9?2:2<=S.strategy||S.level<2?4:0),ne(S,255&S.gzhead.os),S.gzhead.extra&&S.gzhead.extra.length&&(ne(S,255&S.gzhead.extra.length),ne(S,S.gzhead.extra.length>>8&255)),S.gzhead.hcrc&&(_.adler=u(_.adler,S.pending_buf,S.pending,0)),S.gzindex=0,S.status=69):(ne(S,0),ne(S,0),ne(S,0),ne(S,0),ne(S,0),ne(S,S.level===9?2:2<=S.strategy||S.level<2?4:0),ne(S,3),S.status=W);else{var j=x+(S.w_bits-8<<4)<<8;j|=(2<=S.strategy||S.level<2?0:S.level<6?1:S.level===6?2:3)<<6,S.strstart!==0&&(j|=32),j+=31-j%31,S.status=W,ie(S,j),S.strstart!==0&&(ie(S,_.adler>>>16),ie(S,65535&_.adler)),_.adler=1}if(S.status===69)if(S.gzhead.extra){for(k=S.pending;S.gzindex<(65535&S.gzhead.extra.length)&&(S.pending!==S.pending_buf_size||(S.gzhead.hcrc&&S.pending>k&&(_.adler=u(_.adler,S.pending_buf,S.pending-k,k)),P(_),k=S.pending,S.pending!==S.pending_buf_size));)ne(S,255&S.gzhead.extra[S.gzindex]),S.gzindex++;S.gzhead.hcrc&&S.pending>k&&(_.adler=u(_.adler,S.pending_buf,S.pending-k,k)),S.gzindex===S.gzhead.extra.length&&(S.gzindex=0,S.status=73)}else S.status=73;if(S.status===73)if(S.gzhead.name){k=S.pending;do{if(S.pending===S.pending_buf_size&&(S.gzhead.hcrc&&S.pending>k&&(_.adler=u(_.adler,S.pending_buf,S.pending-k,k)),P(_),k=S.pending,S.pending===S.pending_buf_size)){z=1;break}z=S.gzindex<S.gzhead.name.length?255&S.gzhead.name.charCodeAt(S.gzindex++):0,ne(S,z)}while(z!==0);S.gzhead.hcrc&&S.pending>k&&(_.adler=u(_.adler,S.pending_buf,S.pending-k,k)),z===0&&(S.gzindex=0,S.status=91)}else S.status=91;if(S.status===91)if(S.gzhead.comment){k=S.pending;do{if(S.pending===S.pending_buf_size&&(S.gzhead.hcrc&&S.pending>k&&(_.adler=u(_.adler,S.pending_buf,S.pending-k,k)),P(_),k=S.pending,S.pending===S.pending_buf_size)){z=1;break}z=S.gzindex<S.gzhead.comment.length?255&S.gzhead.comment.charCodeAt(S.gzindex++):0,ne(S,z)}while(z!==0);S.gzhead.hcrc&&S.pending>k&&(_.adler=u(_.adler,S.pending_buf,S.pending-k,k)),z===0&&(S.status=103)}else S.status=103;if(S.status===103&&(S.gzhead.hcrc?(S.pending+2>S.pending_buf_size&&P(_),S.pending+2<=S.pending_buf_size&&(ne(S,255&_.adler),ne(S,_.adler>>8&255),_.adler=0,S.status=W)):S.status=W),S.pending!==0){if(P(_),_.avail_out===0)return S.last_flush=-1,h}else if(_.avail_in===0&&V(Z)<=V(q)&&Z!==d)return D(_,-5);if(S.status===666&&_.avail_in!==0)return D(_,-5);if(_.avail_in!==0||S.lookahead!==0||Z!==c&&S.status!==666){var J=S.strategy===2?function(U,se){for(var ce;;){if(U.lookahead===0&&(ke(U),U.lookahead===0)){if(se===c)return w;break}if(U.match_length=0,ce=o._tr_tally(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++,ce&&(F(U,!1),U.strm.avail_out===0))return w}return U.insert=0,se===d?(F(U,!0),U.strm.avail_out===0?G:B):U.last_lit&&(F(U,!1),U.strm.avail_out===0)?w:M}(S,Z):S.strategy===3?function(U,se){for(var ce,oe,me,Ue,Me=U.window;;){if(U.lookahead<=K){if(ke(U),U.lookahead<=K&&se===c)return w;if(U.lookahead===0)break}if(U.match_length=0,U.lookahead>=N&&0<U.strstart&&(oe=Me[me=U.strstart-1])===Me[++me]&&oe===Me[++me]&&oe===Me[++me]){Ue=U.strstart+K;do;while(oe===Me[++me]&&oe===Me[++me]&&oe===Me[++me]&&oe===Me[++me]&&oe===Me[++me]&&oe===Me[++me]&&oe===Me[++me]&&oe===Me[++me]&&me<Ue);U.match_length=K-(Ue-me),U.match_length>U.lookahead&&(U.match_length=U.lookahead)}if(U.match_length>=N?(ce=o._tr_tally(U,1,U.match_length-N),U.lookahead-=U.match_length,U.strstart+=U.match_length,U.match_length=0):(ce=o._tr_tally(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++),ce&&(F(U,!1),U.strm.avail_out===0))return w}return U.insert=0,se===d?(F(U,!0),U.strm.avail_out===0?G:B):U.last_lit&&(F(U,!1),U.strm.avail_out===0)?w:M}(S,Z):r[S.level].func(S,Z);if(J!==G&&J!==B||(S.status=666),J===w||J===G)return _.avail_out===0&&(S.last_flush=-1),h;if(J===M&&(Z===1?o._tr_align(S):Z!==5&&(o._tr_stored_block(S,0,0,!1),Z===3&&(X(S.head),S.lookahead===0&&(S.strstart=0,S.block_start=0,S.insert=0))),P(_),_.avail_out===0))return S.last_flush=-1,h}return Z!==d?h:S.wrap<=0?1:(S.wrap===2?(ne(S,255&_.adler),ne(S,_.adler>>8&255),ne(S,_.adler>>16&255),ne(S,_.adler>>24&255),ne(S,255&_.total_in),ne(S,_.total_in>>8&255),ne(S,_.total_in>>16&255),ne(S,_.total_in>>24&255)):(ie(S,_.adler>>>16),ie(S,65535&_.adler)),P(_),0<S.wrap&&(S.wrap=-S.wrap),S.pending!==0?h:1)},a.deflateEnd=function(_){var Z;return _&&_.state?(Z=_.state.status)!==T&&Z!==69&&Z!==73&&Z!==91&&Z!==103&&Z!==W&&Z!==666?D(_,p):(_.state=null,Z===W?D(_,-3):h):p},a.deflateSetDictionary=function(_,Z){var q,S,k,z,j,J,U,se,ce=Z.length;if(!_||!_.state||(z=(q=_.state).wrap)===2||z===1&&q.status!==T||q.lookahead)return p;for(z===1&&(_.adler=l(_.adler,Z,ce,0)),q.wrap=0,ce>=q.w_size&&(z===0&&(X(q.head),q.strstart=0,q.block_start=0,q.insert=0),se=new s.Buf8(q.w_size),s.arraySet(se,Z,ce-q.w_size,q.w_size,0),Z=se,ce=q.w_size),j=_.avail_in,J=_.next_in,U=_.input,_.avail_in=ce,_.next_in=0,_.input=Z,ke(q);q.lookahead>=N;){for(S=q.strstart,k=q.lookahead-(N-1);q.ins_h=(q.ins_h<<q.hash_shift^q.window[S+N-1])&q.hash_mask,q.prev[S&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=S,S++,--k;);q.strstart=S,q.lookahead=N-1,ke(q)}return q.strstart+=q.lookahead,q.block_start=q.strstart,q.insert=q.lookahead,q.lookahead=0,q.match_length=q.prev_length=N-1,q.match_available=0,_.next_in=J,_.input=U,_.avail_in=j,q.wrap=z,h},a.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,n,a){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,n,a){n.exports=function(r,s){var o,l,u,f,c,d,h,p,m,g,b,x,v,C,E,R,O,H,N,K,ae,T,W,w,M;o=r.state,l=r.next_in,w=r.input,u=l+(r.avail_in-5),f=r.next_out,M=r.output,c=f-(s-r.avail_out),d=f+(r.avail_out-257),h=o.dmax,p=o.wsize,m=o.whave,g=o.wnext,b=o.window,x=o.hold,v=o.bits,C=o.lencode,E=o.distcode,R=(1<<o.lenbits)-1,O=(1<<o.distbits)-1;e:do{v<15&&(x+=w[l++]<<v,v+=8,x+=w[l++]<<v,v+=8),H=C[x&R];t:for(;;){if(x>>>=N=H>>>24,v-=N,(N=H>>>16&255)===0)M[f++]=65535&H;else{if(!(16&N)){if((64&N)==0){H=C[(65535&H)+(x&(1<<N)-1)];continue t}if(32&N){o.mode=12;break e}r.msg="invalid literal/length code",o.mode=30;break e}K=65535&H,(N&=15)&&(v<N&&(x+=w[l++]<<v,v+=8),K+=x&(1<<N)-1,x>>>=N,v-=N),v<15&&(x+=w[l++]<<v,v+=8,x+=w[l++]<<v,v+=8),H=E[x&O];i:for(;;){if(x>>>=N=H>>>24,v-=N,!(16&(N=H>>>16&255))){if((64&N)==0){H=E[(65535&H)+(x&(1<<N)-1)];continue i}r.msg="invalid distance code",o.mode=30;break e}if(ae=65535&H,v<(N&=15)&&(x+=w[l++]<<v,(v+=8)<N&&(x+=w[l++]<<v,v+=8)),h<(ae+=x&(1<<N)-1)){r.msg="invalid distance too far back",o.mode=30;break e}if(x>>>=N,v-=N,(N=f-c)<ae){if(m<(N=ae-N)&&o.sane){r.msg="invalid distance too far back",o.mode=30;break e}if(W=b,(T=0)===g){if(T+=p-N,N<K){for(K-=N;M[f++]=b[T++],--N;);T=f-ae,W=M}}else if(g<N){if(T+=p+g-N,(N-=g)<K){for(K-=N;M[f++]=b[T++],--N;);if(T=0,g<K){for(K-=N=g;M[f++]=b[T++],--N;);T=f-ae,W=M}}}else if(T+=g-N,N<K){for(K-=N;M[f++]=b[T++],--N;);T=f-ae,W=M}for(;2<K;)M[f++]=W[T++],M[f++]=W[T++],M[f++]=W[T++],K-=3;K&&(M[f++]=W[T++],1<K&&(M[f++]=W[T++]))}else{for(T=f-ae;M[f++]=M[T++],M[f++]=M[T++],M[f++]=M[T++],2<(K-=3););K&&(M[f++]=M[T++],1<K&&(M[f++]=M[T++]))}break}}break}}while(l<u&&f<d);l-=K=v>>3,x&=(1<<(v-=K<<3))-1,r.next_in=l,r.next_out=f,r.avail_in=l<u?u-l+5:5-(l-u),r.avail_out=f<d?d-f+257:257-(f-d),o.hold=x,o.bits=v}},{}],49:[function(t,n,a){var r=t("../utils/common"),s=t("./adler32"),o=t("./crc32"),l=t("./inffast"),u=t("./inftrees"),f=1,c=2,d=0,h=-2,p=1,m=852,g=592;function b(T){return(T>>>24&255)+(T>>>8&65280)+((65280&T)<<8)+((255&T)<<24)}function x(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function v(T){var W;return T&&T.state?(W=T.state,T.total_in=T.total_out=W.total=0,T.msg="",W.wrap&&(T.adler=1&W.wrap),W.mode=p,W.last=0,W.havedict=0,W.dmax=32768,W.head=null,W.hold=0,W.bits=0,W.lencode=W.lendyn=new r.Buf32(m),W.distcode=W.distdyn=new r.Buf32(g),W.sane=1,W.back=-1,d):h}function C(T){var W;return T&&T.state?((W=T.state).wsize=0,W.whave=0,W.wnext=0,v(T)):h}function E(T,W){var w,M;return T&&T.state?(M=T.state,W<0?(w=0,W=-W):(w=1+(W>>4),W<48&&(W&=15)),W&&(W<8||15<W)?h:(M.window!==null&&M.wbits!==W&&(M.window=null),M.wrap=w,M.wbits=W,C(T))):h}function R(T,W){var w,M;return T?(M=new x,(T.state=M).window=null,(w=E(T,W))!==d&&(T.state=null),w):h}var O,H,N=!0;function K(T){if(N){var W;for(O=new r.Buf32(512),H=new r.Buf32(32),W=0;W<144;)T.lens[W++]=8;for(;W<256;)T.lens[W++]=9;for(;W<280;)T.lens[W++]=7;for(;W<288;)T.lens[W++]=8;for(u(f,T.lens,0,288,O,0,T.work,{bits:9}),W=0;W<32;)T.lens[W++]=5;u(c,T.lens,0,32,H,0,T.work,{bits:5}),N=!1}T.lencode=O,T.lenbits=9,T.distcode=H,T.distbits=5}function ae(T,W,w,M){var G,B=T.state;return B.window===null&&(B.wsize=1<<B.wbits,B.wnext=0,B.whave=0,B.window=new r.Buf8(B.wsize)),M>=B.wsize?(r.arraySet(B.window,W,w-B.wsize,B.wsize,0),B.wnext=0,B.whave=B.wsize):(M<(G=B.wsize-B.wnext)&&(G=M),r.arraySet(B.window,W,w-M,G,B.wnext),(M-=G)?(r.arraySet(B.window,W,w-M,M,0),B.wnext=M,B.whave=B.wsize):(B.wnext+=G,B.wnext===B.wsize&&(B.wnext=0),B.whave<B.wsize&&(B.whave+=G))),0}a.inflateReset=C,a.inflateReset2=E,a.inflateResetKeep=v,a.inflateInit=function(T){return R(T,15)},a.inflateInit2=R,a.inflate=function(T,W){var w,M,G,B,D,V,X,P,F,ne,ie,ee,ke,Oe,we,ge,Te,Le,nt,at,_,Z,q,S,k=0,z=new r.Buf8(4),j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!T||!T.state||!T.output||!T.input&&T.avail_in!==0)return h;(w=T.state).mode===12&&(w.mode=13),D=T.next_out,G=T.output,X=T.avail_out,B=T.next_in,M=T.input,V=T.avail_in,P=w.hold,F=w.bits,ne=V,ie=X,Z=d;e:for(;;)switch(w.mode){case p:if(w.wrap===0){w.mode=13;break}for(;F<16;){if(V===0)break e;V--,P+=M[B++]<<F,F+=8}if(2&w.wrap&&P===35615){z[w.check=0]=255&P,z[1]=P>>>8&255,w.check=o(w.check,z,2,0),F=P=0,w.mode=2;break}if(w.flags=0,w.head&&(w.head.done=!1),!(1&w.wrap)||(((255&P)<<8)+(P>>8))%31){T.msg="incorrect header check",w.mode=30;break}if((15&P)!=8){T.msg="unknown compression method",w.mode=30;break}if(F-=4,_=8+(15&(P>>>=4)),w.wbits===0)w.wbits=_;else if(_>w.wbits){T.msg="invalid window size",w.mode=30;break}w.dmax=1<<_,T.adler=w.check=1,w.mode=512&P?10:12,F=P=0;break;case 2:for(;F<16;){if(V===0)break e;V--,P+=M[B++]<<F,F+=8}if(w.flags=P,(255&w.flags)!=8){T.msg="unknown compression method",w.mode=30;break}if(57344&w.flags){T.msg="unknown header flags set",w.mode=30;break}w.head&&(w.head.text=P>>8&1),512&w.flags&&(z[0]=255&P,z[1]=P>>>8&255,w.check=o(w.check,z,2,0)),F=P=0,w.mode=3;case 3:for(;F<32;){if(V===0)break e;V--,P+=M[B++]<<F,F+=8}w.head&&(w.head.time=P),512&w.flags&&(z[0]=255&P,z[1]=P>>>8&255,z[2]=P>>>16&255,z[3]=P>>>24&255,w.check=o(w.check,z,4,0)),F=P=0,w.mode=4;case 4:for(;F<16;){if(V===0)break e;V--,P+=M[B++]<<F,F+=8}w.head&&(w.head.xflags=255&P,w.head.os=P>>8),512&w.flags&&(z[0]=255&P,z[1]=P>>>8&255,w.check=o(w.check,z,2,0)),F=P=0,w.mode=5;case 5:if(1024&w.flags){for(;F<16;){if(V===0)break e;V--,P+=M[B++]<<F,F+=8}w.length=P,w.head&&(w.head.extra_len=P),512&w.flags&&(z[0]=255&P,z[1]=P>>>8&255,w.check=o(w.check,z,2,0)),F=P=0}else w.head&&(w.head.extra=null);w.mode=6;case 6:if(1024&w.flags&&(V<(ee=w.length)&&(ee=V),ee&&(w.head&&(_=w.head.extra_len-w.length,w.head.extra||(w.head.extra=new Array(w.head.extra_len)),r.arraySet(w.head.extra,M,B,ee,_)),512&w.flags&&(w.check=o(w.check,M,ee,B)),V-=ee,B+=ee,w.length-=ee),w.length))break e;w.length=0,w.mode=7;case 7:if(2048&w.flags){if(V===0)break e;for(ee=0;_=M[B+ee++],w.head&&_&&w.length<65536&&(w.head.name+=String.fromCharCode(_)),_&&ee<V;);if(512&w.flags&&(w.check=o(w.check,M,ee,B)),V-=ee,B+=ee,_)break e}else w.head&&(w.head.name=null);w.length=0,w.mode=8;case 8:if(4096&w.flags){if(V===0)break e;for(ee=0;_=M[B+ee++],w.head&&_&&w.length<65536&&(w.head.comment+=String.fromCharCode(_)),_&&ee<V;);if(512&w.flags&&(w.check=o(w.check,M,ee,B)),V-=ee,B+=ee,_)break e}else w.head&&(w.head.comment=null);w.mode=9;case 9:if(512&w.flags){for(;F<16;){if(V===0)break e;V--,P+=M[B++]<<F,F+=8}if(P!==(65535&w.check)){T.msg="header crc mismatch",w.mode=30;break}F=P=0}w.head&&(w.head.hcrc=w.flags>>9&1,w.head.done=!0),T.adler=w.check=0,w.mode=12;break;case 10:for(;F<32;){if(V===0)break e;V--,P+=M[B++]<<F,F+=8}T.adler=w.check=b(P),F=P=0,w.mode=11;case 11:if(w.havedict===0)return T.next_out=D,T.avail_out=X,T.next_in=B,T.avail_in=V,w.hold=P,w.bits=F,2;T.adler=w.check=1,w.mode=12;case 12:if(W===5||W===6)break e;case 13:if(w.last){P>>>=7&F,F-=7&F,w.mode=27;break}for(;F<3;){if(V===0)break e;V--,P+=M[B++]<<F,F+=8}switch(w.last=1&P,F-=1,3&(P>>>=1)){case 0:w.mode=14;break;case 1:if(K(w),w.mode=20,W!==6)break;P>>>=2,F-=2;break e;case 2:w.mode=17;break;case 3:T.msg="invalid block type",w.mode=30}P>>>=2,F-=2;break;case 14:for(P>>>=7&F,F-=7&F;F<32;){if(V===0)break e;V--,P+=M[B++]<<F,F+=8}if((65535&P)!=(P>>>16^65535)){T.msg="invalid stored block lengths",w.mode=30;break}if(w.length=65535&P,F=P=0,w.mode=15,W===6)break e;case 15:w.mode=16;case 16:if(ee=w.length){if(V<ee&&(ee=V),X<ee&&(ee=X),ee===0)break e;r.arraySet(G,M,B,ee,D),V-=ee,B+=ee,X-=ee,D+=ee,w.length-=ee;break}w.mode=12;break;case 17:for(;F<14;){if(V===0)break e;V--,P+=M[B++]<<F,F+=8}if(w.nlen=257+(31&P),P>>>=5,F-=5,w.ndist=1+(31&P),P>>>=5,F-=5,w.ncode=4+(15&P),P>>>=4,F-=4,286<w.nlen||30<w.ndist){T.msg="too many length or distance symbols",w.mode=30;break}w.have=0,w.mode=18;case 18:for(;w.have<w.ncode;){for(;F<3;){if(V===0)break e;V--,P+=M[B++]<<F,F+=8}w.lens[j[w.have++]]=7&P,P>>>=3,F-=3}for(;w.have<19;)w.lens[j[w.have++]]=0;if(w.lencode=w.lendyn,w.lenbits=7,q={bits:w.lenbits},Z=u(0,w.lens,0,19,w.lencode,0,w.work,q),w.lenbits=q.bits,Z){T.msg="invalid code lengths set",w.mode=30;break}w.have=0,w.mode=19;case 19:for(;w.have<w.nlen+w.ndist;){for(;ge=(k=w.lencode[P&(1<<w.lenbits)-1])>>>16&255,Te=65535&k,!((we=k>>>24)<=F);){if(V===0)break e;V--,P+=M[B++]<<F,F+=8}if(Te<16)P>>>=we,F-=we,w.lens[w.have++]=Te;else{if(Te===16){for(S=we+2;F<S;){if(V===0)break e;V--,P+=M[B++]<<F,F+=8}if(P>>>=we,F-=we,w.have===0){T.msg="invalid bit length repeat",w.mode=30;break}_=w.lens[w.have-1],ee=3+(3&P),P>>>=2,F-=2}else if(Te===17){for(S=we+3;F<S;){if(V===0)break e;V--,P+=M[B++]<<F,F+=8}F-=we,_=0,ee=3+(7&(P>>>=we)),P>>>=3,F-=3}else{for(S=we+7;F<S;){if(V===0)break e;V--,P+=M[B++]<<F,F+=8}F-=we,_=0,ee=11+(127&(P>>>=we)),P>>>=7,F-=7}if(w.have+ee>w.nlen+w.ndist){T.msg="invalid bit length repeat",w.mode=30;break}for(;ee--;)w.lens[w.have++]=_}}if(w.mode===30)break;if(w.lens[256]===0){T.msg="invalid code -- missing end-of-block",w.mode=30;break}if(w.lenbits=9,q={bits:w.lenbits},Z=u(f,w.lens,0,w.nlen,w.lencode,0,w.work,q),w.lenbits=q.bits,Z){T.msg="invalid literal/lengths set",w.mode=30;break}if(w.distbits=6,w.distcode=w.distdyn,q={bits:w.distbits},Z=u(c,w.lens,w.nlen,w.ndist,w.distcode,0,w.work,q),w.distbits=q.bits,Z){T.msg="invalid distances set",w.mode=30;break}if(w.mode=20,W===6)break e;case 20:w.mode=21;case 21:if(6<=V&&258<=X){T.next_out=D,T.avail_out=X,T.next_in=B,T.avail_in=V,w.hold=P,w.bits=F,l(T,ie),D=T.next_out,G=T.output,X=T.avail_out,B=T.next_in,M=T.input,V=T.avail_in,P=w.hold,F=w.bits,w.mode===12&&(w.back=-1);break}for(w.back=0;ge=(k=w.lencode[P&(1<<w.lenbits)-1])>>>16&255,Te=65535&k,!((we=k>>>24)<=F);){if(V===0)break e;V--,P+=M[B++]<<F,F+=8}if(ge&&(240&ge)==0){for(Le=we,nt=ge,at=Te;ge=(k=w.lencode[at+((P&(1<<Le+nt)-1)>>Le)])>>>16&255,Te=65535&k,!(Le+(we=k>>>24)<=F);){if(V===0)break e;V--,P+=M[B++]<<F,F+=8}P>>>=Le,F-=Le,w.back+=Le}if(P>>>=we,F-=we,w.back+=we,w.length=Te,ge===0){w.mode=26;break}if(32&ge){w.back=-1,w.mode=12;break}if(64&ge){T.msg="invalid literal/length code",w.mode=30;break}w.extra=15&ge,w.mode=22;case 22:if(w.extra){for(S=w.extra;F<S;){if(V===0)break e;V--,P+=M[B++]<<F,F+=8}w.length+=P&(1<<w.extra)-1,P>>>=w.extra,F-=w.extra,w.back+=w.extra}w.was=w.length,w.mode=23;case 23:for(;ge=(k=w.distcode[P&(1<<w.distbits)-1])>>>16&255,Te=65535&k,!((we=k>>>24)<=F);){if(V===0)break e;V--,P+=M[B++]<<F,F+=8}if((240&ge)==0){for(Le=we,nt=ge,at=Te;ge=(k=w.distcode[at+((P&(1<<Le+nt)-1)>>Le)])>>>16&255,Te=65535&k,!(Le+(we=k>>>24)<=F);){if(V===0)break e;V--,P+=M[B++]<<F,F+=8}P>>>=Le,F-=Le,w.back+=Le}if(P>>>=we,F-=we,w.back+=we,64&ge){T.msg="invalid distance code",w.mode=30;break}w.offset=Te,w.extra=15&ge,w.mode=24;case 24:if(w.extra){for(S=w.extra;F<S;){if(V===0)break e;V--,P+=M[B++]<<F,F+=8}w.offset+=P&(1<<w.extra)-1,P>>>=w.extra,F-=w.extra,w.back+=w.extra}if(w.offset>w.dmax){T.msg="invalid distance too far back",w.mode=30;break}w.mode=25;case 25:if(X===0)break e;if(ee=ie-X,w.offset>ee){if((ee=w.offset-ee)>w.whave&&w.sane){T.msg="invalid distance too far back",w.mode=30;break}ke=ee>w.wnext?(ee-=w.wnext,w.wsize-ee):w.wnext-ee,ee>w.length&&(ee=w.length),Oe=w.window}else Oe=G,ke=D-w.offset,ee=w.length;for(X<ee&&(ee=X),X-=ee,w.length-=ee;G[D++]=Oe[ke++],--ee;);w.length===0&&(w.mode=21);break;case 26:if(X===0)break e;G[D++]=w.length,X--,w.mode=21;break;case 27:if(w.wrap){for(;F<32;){if(V===0)break e;V--,P|=M[B++]<<F,F+=8}if(ie-=X,T.total_out+=ie,w.total+=ie,ie&&(T.adler=w.check=w.flags?o(w.check,G,ie,D-ie):s(w.check,G,ie,D-ie)),ie=X,(w.flags?P:b(P))!==w.check){T.msg="incorrect data check",w.mode=30;break}F=P=0}w.mode=28;case 28:if(w.wrap&&w.flags){for(;F<32;){if(V===0)break e;V--,P+=M[B++]<<F,F+=8}if(P!==(4294967295&w.total)){T.msg="incorrect length check",w.mode=30;break}F=P=0}w.mode=29;case 29:Z=1;break e;case 30:Z=-3;break e;case 31:return-4;case 32:default:return h}return T.next_out=D,T.avail_out=X,T.next_in=B,T.avail_in=V,w.hold=P,w.bits=F,(w.wsize||ie!==T.avail_out&&w.mode<30&&(w.mode<27||W!==4))&&ae(T,T.output,T.next_out,ie-T.avail_out)?(w.mode=31,-4):(ne-=T.avail_in,ie-=T.avail_out,T.total_in+=ne,T.total_out+=ie,w.total+=ie,w.wrap&&ie&&(T.adler=w.check=w.flags?o(w.check,G,ie,T.next_out-ie):s(w.check,G,ie,T.next_out-ie)),T.data_type=w.bits+(w.last?64:0)+(w.mode===12?128:0)+(w.mode===20||w.mode===15?256:0),(ne==0&&ie===0||W===4)&&Z===d&&(Z=-5),Z)},a.inflateEnd=function(T){if(!T||!T.state)return h;var W=T.state;return W.window&&(W.window=null),T.state=null,d},a.inflateGetHeader=function(T,W){var w;return T&&T.state?(2&(w=T.state).wrap)==0?h:((w.head=W).done=!1,d):h},a.inflateSetDictionary=function(T,W){var w,M=W.length;return T&&T.state?(w=T.state).wrap!==0&&w.mode!==11?h:w.mode===11&&s(1,W,M,0)!==w.check?-3:ae(T,W,M,M)?(w.mode=31,-4):(w.havedict=1,d):h},a.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,n,a){var r=t("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(f,c,d,h,p,m,g,b){var x,v,C,E,R,O,H,N,K,ae=b.bits,T=0,W=0,w=0,M=0,G=0,B=0,D=0,V=0,X=0,P=0,F=null,ne=0,ie=new r.Buf16(16),ee=new r.Buf16(16),ke=null,Oe=0;for(T=0;T<=15;T++)ie[T]=0;for(W=0;W<h;W++)ie[c[d+W]]++;for(G=ae,M=15;1<=M&&ie[M]===0;M--);if(M<G&&(G=M),M===0)return p[m++]=20971520,p[m++]=20971520,b.bits=1,0;for(w=1;w<M&&ie[w]===0;w++);for(G<w&&(G=w),T=V=1;T<=15;T++)if(V<<=1,(V-=ie[T])<0)return-1;if(0<V&&(f===0||M!==1))return-1;for(ee[1]=0,T=1;T<15;T++)ee[T+1]=ee[T]+ie[T];for(W=0;W<h;W++)c[d+W]!==0&&(g[ee[c[d+W]]++]=W);if(O=f===0?(F=ke=g,19):f===1?(F=s,ne-=257,ke=o,Oe-=257,256):(F=l,ke=u,-1),T=w,R=m,D=W=P=0,C=-1,E=(X=1<<(B=G))-1,f===1&&852<X||f===2&&592<X)return 1;for(;;){for(H=T-D,K=g[W]<O?(N=0,g[W]):g[W]>O?(N=ke[Oe+g[W]],F[ne+g[W]]):(N=96,0),x=1<<T-D,w=v=1<<B;p[R+(P>>D)+(v-=x)]=H<<24|N<<16|K|0,v!==0;);for(x=1<<T-1;P&x;)x>>=1;if(x!==0?(P&=x-1,P+=x):P=0,W++,--ie[T]==0){if(T===M)break;T=c[d+g[W]]}if(G<T&&(P&E)!==C){for(D===0&&(D=G),R+=w,V=1<<(B=T-D);B+D<M&&!((V-=ie[B+D])<=0);)B++,V<<=1;if(X+=1<<B,f===1&&852<X||f===2&&592<X)return 1;p[C=P&E]=G<<24|B<<16|R-m|0}}return P!==0&&(p[R+P]=T-D<<24|64<<16|0),b.bits=G,0}},{"../utils/common":41}],51:[function(t,n,a){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,n,a){var r=t("../utils/common"),s=0,o=1;function l(k){for(var z=k.length;0<=--z;)k[z]=0}var u=0,f=29,c=256,d=c+1+f,h=30,p=19,m=2*d+1,g=15,b=16,x=7,v=256,C=16,E=17,R=18,O=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],H=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],K=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ae=new Array(2*(d+2));l(ae);var T=new Array(2*h);l(T);var W=new Array(512);l(W);var w=new Array(256);l(w);var M=new Array(f);l(M);var G,B,D,V=new Array(h);function X(k,z,j,J,U){this.static_tree=k,this.extra_bits=z,this.extra_base=j,this.elems=J,this.max_length=U,this.has_stree=k&&k.length}function P(k,z){this.dyn_tree=k,this.max_code=0,this.stat_desc=z}function F(k){return k<256?W[k]:W[256+(k>>>7)]}function ne(k,z){k.pending_buf[k.pending++]=255&z,k.pending_buf[k.pending++]=z>>>8&255}function ie(k,z,j){k.bi_valid>b-j?(k.bi_buf|=z<<k.bi_valid&65535,ne(k,k.bi_buf),k.bi_buf=z>>b-k.bi_valid,k.bi_valid+=j-b):(k.bi_buf|=z<<k.bi_valid&65535,k.bi_valid+=j)}function ee(k,z,j){ie(k,j[2*z],j[2*z+1])}function ke(k,z){for(var j=0;j|=1&k,k>>>=1,j<<=1,0<--z;);return j>>>1}function Oe(k,z,j){var J,U,se=new Array(g+1),ce=0;for(J=1;J<=g;J++)se[J]=ce=ce+j[J-1]<<1;for(U=0;U<=z;U++){var oe=k[2*U+1];oe!==0&&(k[2*U]=ke(se[oe]++,oe))}}function we(k){var z;for(z=0;z<d;z++)k.dyn_ltree[2*z]=0;for(z=0;z<h;z++)k.dyn_dtree[2*z]=0;for(z=0;z<p;z++)k.bl_tree[2*z]=0;k.dyn_ltree[2*v]=1,k.opt_len=k.static_len=0,k.last_lit=k.matches=0}function ge(k){8<k.bi_valid?ne(k,k.bi_buf):0<k.bi_valid&&(k.pending_buf[k.pending++]=k.bi_buf),k.bi_buf=0,k.bi_valid=0}function Te(k,z,j,J){var U=2*z,se=2*j;return k[U]<k[se]||k[U]===k[se]&&J[z]<=J[j]}function Le(k,z,j){for(var J=k.heap[j],U=j<<1;U<=k.heap_len&&(U<k.heap_len&&Te(z,k.heap[U+1],k.heap[U],k.depth)&&U++,!Te(z,J,k.heap[U],k.depth));)k.heap[j]=k.heap[U],j=U,U<<=1;k.heap[j]=J}function nt(k,z,j){var J,U,se,ce,oe=0;if(k.last_lit!==0)for(;J=k.pending_buf[k.d_buf+2*oe]<<8|k.pending_buf[k.d_buf+2*oe+1],U=k.pending_buf[k.l_buf+oe],oe++,J===0?ee(k,U,z):(ee(k,(se=w[U])+c+1,z),(ce=O[se])!==0&&ie(k,U-=M[se],ce),ee(k,se=F(--J),j),(ce=H[se])!==0&&ie(k,J-=V[se],ce)),oe<k.last_lit;);ee(k,v,z)}function at(k,z){var j,J,U,se=z.dyn_tree,ce=z.stat_desc.static_tree,oe=z.stat_desc.has_stree,me=z.stat_desc.elems,Ue=-1;for(k.heap_len=0,k.heap_max=m,j=0;j<me;j++)se[2*j]!==0?(k.heap[++k.heap_len]=Ue=j,k.depth[j]=0):se[2*j+1]=0;for(;k.heap_len<2;)se[2*(U=k.heap[++k.heap_len]=Ue<2?++Ue:0)]=1,k.depth[U]=0,k.opt_len--,oe&&(k.static_len-=ce[2*U+1]);for(z.max_code=Ue,j=k.heap_len>>1;1<=j;j--)Le(k,se,j);for(U=me;j=k.heap[1],k.heap[1]=k.heap[k.heap_len--],Le(k,se,1),J=k.heap[1],k.heap[--k.heap_max]=j,k.heap[--k.heap_max]=J,se[2*U]=se[2*j]+se[2*J],k.depth[U]=(k.depth[j]>=k.depth[J]?k.depth[j]:k.depth[J])+1,se[2*j+1]=se[2*J+1]=U,k.heap[1]=U++,Le(k,se,1),2<=k.heap_len;);k.heap[--k.heap_max]=k.heap[1],function(Me,yt){var Ct,Tt,A,I,te,Q,re=yt.dyn_tree,fe=yt.max_code,be=yt.stat_desc.static_tree,Pe=yt.stat_desc.has_stree,Ne=yt.stat_desc.extra_bits,Ze=yt.stat_desc.extra_base,qe=yt.stat_desc.max_length,ot=0;for(I=0;I<=g;I++)Me.bl_count[I]=0;for(re[2*Me.heap[Me.heap_max]+1]=0,Ct=Me.heap_max+1;Ct<m;Ct++)qe<(I=re[2*re[2*(Tt=Me.heap[Ct])+1]+1]+1)&&(I=qe,ot++),re[2*Tt+1]=I,fe<Tt||(Me.bl_count[I]++,te=0,Ze<=Tt&&(te=Ne[Tt-Ze]),Q=re[2*Tt],Me.opt_len+=Q*(I+te),Pe&&(Me.static_len+=Q*(be[2*Tt+1]+te)));if(ot!==0){do{for(I=qe-1;Me.bl_count[I]===0;)I--;Me.bl_count[I]--,Me.bl_count[I+1]+=2,Me.bl_count[qe]--,ot-=2}while(0<ot);for(I=qe;I!==0;I--)for(Tt=Me.bl_count[I];Tt!==0;)fe<(A=Me.heap[--Ct])||(re[2*A+1]!==I&&(Me.opt_len+=(I-re[2*A+1])*re[2*A],re[2*A+1]=I),Tt--)}}(k,z),Oe(se,Ue,k.bl_count)}function _(k,z,j){var J,U,se=-1,ce=z[1],oe=0,me=7,Ue=4;for(ce===0&&(me=138,Ue=3),z[2*(j+1)+1]=65535,J=0;J<=j;J++)U=ce,ce=z[2*(J+1)+1],++oe<me&&U===ce||(oe<Ue?k.bl_tree[2*U]+=oe:U!==0?(U!==se&&k.bl_tree[2*U]++,k.bl_tree[2*C]++):oe<=10?k.bl_tree[2*E]++:k.bl_tree[2*R]++,se=U,Ue=(oe=0)===ce?(me=138,3):U===ce?(me=6,3):(me=7,4))}function Z(k,z,j){var J,U,se=-1,ce=z[1],oe=0,me=7,Ue=4;for(ce===0&&(me=138,Ue=3),J=0;J<=j;J++)if(U=ce,ce=z[2*(J+1)+1],!(++oe<me&&U===ce)){if(oe<Ue)for(;ee(k,U,k.bl_tree),--oe!=0;);else U!==0?(U!==se&&(ee(k,U,k.bl_tree),oe--),ee(k,C,k.bl_tree),ie(k,oe-3,2)):oe<=10?(ee(k,E,k.bl_tree),ie(k,oe-3,3)):(ee(k,R,k.bl_tree),ie(k,oe-11,7));se=U,Ue=(oe=0)===ce?(me=138,3):U===ce?(me=6,3):(me=7,4)}}l(V);var q=!1;function S(k,z,j,J){ie(k,(u<<1)+(J?1:0),3),function(U,se,ce,oe){ge(U),ne(U,ce),ne(U,~ce),r.arraySet(U.pending_buf,U.window,se,ce,U.pending),U.pending+=ce}(k,z,j)}a._tr_init=function(k){q||(function(){var z,j,J,U,se,ce=new Array(g+1);for(U=J=0;U<f-1;U++)for(M[U]=J,z=0;z<1<<O[U];z++)w[J++]=U;for(w[J-1]=U,U=se=0;U<16;U++)for(V[U]=se,z=0;z<1<<H[U];z++)W[se++]=U;for(se>>=7;U<h;U++)for(V[U]=se<<7,z=0;z<1<<H[U]-7;z++)W[256+se++]=U;for(j=0;j<=g;j++)ce[j]=0;for(z=0;z<=143;)ae[2*z+1]=8,z++,ce[8]++;for(;z<=255;)ae[2*z+1]=9,z++,ce[9]++;for(;z<=279;)ae[2*z+1]=7,z++,ce[7]++;for(;z<=287;)ae[2*z+1]=8,z++,ce[8]++;for(Oe(ae,d+1,ce),z=0;z<h;z++)T[2*z+1]=5,T[2*z]=ke(z,5);G=new X(ae,O,c+1,d,g),B=new X(T,H,0,h,g),D=new X(new Array(0),N,0,p,x)}(),q=!0),k.l_desc=new P(k.dyn_ltree,G),k.d_desc=new P(k.dyn_dtree,B),k.bl_desc=new P(k.bl_tree,D),k.bi_buf=0,k.bi_valid=0,we(k)},a._tr_stored_block=S,a._tr_flush_block=function(k,z,j,J){var U,se,ce=0;0<k.level?(k.strm.data_type===2&&(k.strm.data_type=function(oe){var me,Ue=4093624447;for(me=0;me<=31;me++,Ue>>>=1)if(1&Ue&&oe.dyn_ltree[2*me]!==0)return s;if(oe.dyn_ltree[18]!==0||oe.dyn_ltree[20]!==0||oe.dyn_ltree[26]!==0)return o;for(me=32;me<c;me++)if(oe.dyn_ltree[2*me]!==0)return o;return s}(k)),at(k,k.l_desc),at(k,k.d_desc),ce=function(oe){var me;for(_(oe,oe.dyn_ltree,oe.l_desc.max_code),_(oe,oe.dyn_dtree,oe.d_desc.max_code),at(oe,oe.bl_desc),me=p-1;3<=me&&oe.bl_tree[2*K[me]+1]===0;me--);return oe.opt_len+=3*(me+1)+5+5+4,me}(k),U=k.opt_len+3+7>>>3,(se=k.static_len+3+7>>>3)<=U&&(U=se)):U=se=j+5,j+4<=U&&z!==-1?S(k,z,j,J):k.strategy===4||se===U?(ie(k,2+(J?1:0),3),nt(k,ae,T)):(ie(k,4+(J?1:0),3),function(oe,me,Ue,Me){var yt;for(ie(oe,me-257,5),ie(oe,Ue-1,5),ie(oe,Me-4,4),yt=0;yt<Me;yt++)ie(oe,oe.bl_tree[2*K[yt]+1],3);Z(oe,oe.dyn_ltree,me-1),Z(oe,oe.dyn_dtree,Ue-1)}(k,k.l_desc.max_code+1,k.d_desc.max_code+1,ce+1),nt(k,k.dyn_ltree,k.dyn_dtree)),we(k),J&&ge(k)},a._tr_tally=function(k,z,j){return k.pending_buf[k.d_buf+2*k.last_lit]=z>>>8&255,k.pending_buf[k.d_buf+2*k.last_lit+1]=255&z,k.pending_buf[k.l_buf+k.last_lit]=255&j,k.last_lit++,z===0?k.dyn_ltree[2*j]++:(k.matches++,z--,k.dyn_ltree[2*(w[j]+c+1)]++,k.dyn_dtree[2*F(z)]++),k.last_lit===k.lit_bufsize-1},a._tr_align=function(k){ie(k,2,3),ee(k,v,ae),function(z){z.bi_valid===16?(ne(z,z.bi_buf),z.bi_buf=0,z.bi_valid=0):8<=z.bi_valid&&(z.pending_buf[z.pending++]=255&z.bi_buf,z.bi_buf>>=8,z.bi_valid-=8)}(k)}},{"../utils/common":41}],53:[function(t,n,a){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,n,a){(function(r){(function(s,o){if(!s.setImmediate){var l,u,f,c,d=1,h={},p=!1,m=s.document,g=Object.getPrototypeOf&&Object.getPrototypeOf(s);g=g&&g.setTimeout?g:s,l={}.toString.call(s.process)==="[object process]"?function(C){process.nextTick(function(){x(C)})}:function(){if(s.postMessage&&!s.importScripts){var C=!0,E=s.onmessage;return s.onmessage=function(){C=!1},s.postMessage("","*"),s.onmessage=E,C}}()?(c="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",v,!1):s.attachEvent("onmessage",v),function(C){s.postMessage(c+C,"*")}):s.MessageChannel?((f=new MessageChannel).port1.onmessage=function(C){x(C.data)},function(C){f.port2.postMessage(C)}):m&&"onreadystatechange"in m.createElement("script")?(u=m.documentElement,function(C){var E=m.createElement("script");E.onreadystatechange=function(){x(C),E.onreadystatechange=null,u.removeChild(E),E=null},u.appendChild(E)}):function(C){setTimeout(x,0,C)},g.setImmediate=function(C){typeof C!="function"&&(C=new Function(""+C));for(var E=new Array(arguments.length-1),R=0;R<E.length;R++)E[R]=arguments[R+1];var O={callback:C,args:E};return h[d]=O,l(d),d++},g.clearImmediate=b}function b(C){delete h[C]}function x(C){if(p)setTimeout(x,0,C);else{var E=h[C];if(E){p=!0;try{(function(R){var O=R.callback,H=R.args;switch(H.length){case 0:O();break;case 1:O(H[0]);break;case 2:O(H[0],H[1]);break;case 3:O(H[0],H[1],H[2]);break;default:O.apply(o,H)}})(E)}finally{b(C),p=!1}}}}function v(C){C.source===s&&typeof C.data=="string"&&C.data.indexOf(c)===0&&x(+C.data.slice(c.length))}})(typeof self>"u"?r===void 0?this:r:self)}).call(this,typeof hi<"u"?hi:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})}(as)),as.exports}var z0=H0();const V0=Kn(z0);class W0{static worker=new Worker(new URL("/smeditor/assets/SafariFileWorker-C6T6cial.js",import.meta.url),{type:"module"});static workID=0;static map=new Map;static{this.worker.onmessage=e=>{const t=e.data;t.success?this.map.get(t.id)[0]():this.map.get(t.id)[1](t.reason),this.map.delete(t.id)}}static async writeHandle(e,t){const n=this.workID++,a=new Promise((o,l)=>this.map.set(n,[o,l])),r=new TextEncoder,s=typeof t=="string"?r.encode(t).buffer:await t.arrayBuffer();return this.worker.postMessage([n,e,s],[s]),a}}class U0{_root;async getRoot(){return this._root||(I0.adapter.native?await $l().then(e=>this._root=e):await $l(We(()=>import("./memory-NBqPtv5z.js"),__vite__mapDeps([0,1,2]))).then(e=>this._root=e)),this._root}async uploadHandle(e,t){let n;if(typeof t=="string"){const a=await this.getDirectoryHandle(t,{create:!0});if(!a)return;n=a}else n=t??await this.getRoot();if(e.kind=="file"){const a=await n.getFileHandle(e.name,{create:!0});await this.writeFile(a,await e.getFile())}else{const a=await n.getDirectoryHandle(e.name,{create:!0}),r=[];for await(const s of e.values())r.push(this.uploadHandle(s,a));await Promise.all(r)}}async uploadFiles(e,t){let n;if(typeof t=="string"){const a=await this.getDirectoryHandle(t,{create:!0});if(!a)return;n=a}else n=t??await this.getRoot();if(e.isFile){const a=e;if(a.name==".DS_Store")return;a.file(async r=>{const s=await n.getFileHandle(r.name,{create:!0});await this.writeHandle(s,r)})}else if(e.isDirectory){const a=e.createReader(),r=await n.getDirectoryHandle(e.name,{create:!0});for await(const s of r.values())await r.removeEntry(s.name,{recursive:!0});a.readEntries(async s=>{const o=[];for(let l=0;l<s.length;l++)o.push(this.uploadFiles(s[l],r));await Promise.all(o)})}}async handleDropEvent(e,t){e.stopPropagation(),e.preventDefault();const n=e.dataTransfer.items;if(!t){t="";for(let s=0;s<n.length;s++){const o=n[s].webkitGetAsEntry();if(o?.isFile&&(o.name.endsWith(".sm")||o.name.endsWith(".ssc"))){t="New Song";break}}}const a=[];for(let s=0;s<n.length;s++){const o=n[s].webkitGetAsEntry();o&&a.push(this.uploadFiles(o,t))}let r;return n.length==1&&n[0].webkitGetAsEntry().isDirectory&&(r=n[0].webkitGetAsEntry().name),await Promise.all(a),r}async uploadDir(e,t){let n;if(typeof t=="string"){const r=await this.getDirectoryHandle(t);if(!r)return;n=r}else n=t??await this.getRoot();const a=await n.getDirectoryHandle(e.name,{create:!0});for await(const r of e.values())if(r.kind=="file"){const s=await a.getFileHandle(r.name,{create:!0}),o=await r.getFile();await this.writeHandle(s,o)}else await this.uploadDir(r,a)}async getDirectoryHandle(e,t,n){if(n||=await this.getRoot(),e=this.resolvePath(...e.split("/")),e==""||e==".")return n;const a=e.split("/"),r=a.shift();try{const s=await n.getDirectoryHandle(r,t);return s?a.length==0?s:this.getDirectoryHandle(a.join("/"),t,s):void 0}catch(s){console.error(`Failed to get directory ${e} (${r}): `+s);return}}async hasFile(e){try{return await this.getFileHandle(e)!==void 0}catch{return!1}}async getFileHandle(e,t){try{const n=this.resolvePath(...e.split("/")).split("/"),a=n.pop(),r=await this.getDirectoryHandle(n.join("/"),t);return r?await r.getFileHandle(a,t):void 0}catch(n){console.error("Failed to get file "+e+": "+n);return}}async getFileHandleRelativeTo(e,t){try{return kt(e)!=""&&(e=rt(e)),this.getFileHandle(this.resolvePath(e,"/",t))}catch(n){console.error("Failed to get relative file "+t+": "+n);return}}async getDirectoryFiles(e){try{let t;if(typeof e=="string"){if(t=await this.getDirectoryHandle(e),!t)return[]}else t=e;const n=[];for await(const a of t.values())a.kind=="file"&&n.push(a);return n}catch(t){return console.error(t),[]}}async getDirectoryFolders(e){try{let t;if(typeof e=="string"){if(t=await this.getDirectoryHandle(e),!t)return[]}else t=e;const n=[];for await(const a of t.values())a.kind=="directory"&&n.push(a);return n}catch(t){return console.error(t),[]}}async writeFile(e,t){let n;if(typeof e=="string"){if(n=await this.getFileHandle(e,{create:!0}),!n){de.createFormatted("Failed to write to "+e+"!","error");return}}else n=e;await this.writeHandle(n,t)}async removeFile(e,t){try{const n=rt(e),a=await this.getDirectoryHandle(n);if(!a)return;await a.removeEntry(Et(e),t)}catch(n){console.error(n);return}}async removeDirectory(e){return this.removeFile(e,{recursive:!0})}async remove(e){return kt(e)==""?this.removeDirectory(e):this.removeFile(e)}resolvePath(...e){let t=e;for(t=t.filter(n=>n!="."&&n!="");t.indexOf("..")>-1;){const n=t.indexOf("..");if(n==0)throw Error("Path "+t.join("/")+" is invalid!");t.splice(n-1,2)}return t.join("/")}async zipDirectory(e,t){const n=t??new V0,a=kt(e)==""?e:rt(e),r=await this.getDirectoryHandle(a);if(r){for(const s of await this.getDirectoryFiles(r))n.file(s.name,await s.getFile());for(const s of await this.getDirectoryFolders(r)){const o=n.folder(s.name);if(!o){console.error("Failed to zip folder "+a+"/"+s.name);continue}await this.zipDirectory(a+"/"+s.name,o)}return n}}async saveDirectory(e){const t=kt(e)==""?e:rt(e);de.create("Exporting "+t+".zip");const n=await B0({_preferPolyfill:!1,suggestedName:`${t}.zip`,types:[{accept:{"application/zip":[".zip"]}}],excludeAcceptAllOption:!1}),a=await this.zipDirectory(e);a&&await a.generateAsync({type:"blob"}).then(async r=>{if(!window.showSaveFilePicker){console.log(r);const s=document.createElement("a"),o=URL.createObjectURL(r);document.body.appendChild(s),s.href=o,s.download=t+".zip",s.click(),s.remove(),window.URL.revokeObjectURL(o);return}await this.writeHandle(n,r)})}async renameFile(e,t){if(e!=t)try{const n=await this.getDirectoryHandle(rt(e)),a=await this.getDirectoryHandle(rt(t),{create:!0}),r=await this.getFileHandle(e);if(!n||!a||!r)return;await this.copyToHandle(a,r,Et(t)),await n.removeEntry(Et(e))}catch(n){console.error(n)}}async renameDirectory(e,t){if(!t.startsWith(e))try{const n=await this.getDirectoryHandle(rt(e)),a=await this.getDirectoryHandle(rt(t),{create:!0}),r=await this.getDirectoryHandle(e);if(!n||!a||!r)return;await this.copyToHandle(a,r,Et(t)),await n.removeEntry(Et(e),{recursive:!0})}catch(n){console.error(n)}}async copyToHandle(e,t,n){try{if(t.kind=="directory"){const a=await e.getDirectoryHandle(n??t.name,{create:!0}),r=[];for await(const s of t.values())r.push(this.copyToHandle(a,s));await Promise.all(r)}else{const a=await t.getFile(),r=await e.getFileHandle(n??t.name,{create:!0});await this.writeHandle(r,a)}}catch(a){console.error(a)}}getRelativePath(e,t){const n=e.split("/"),a=t.split("/"),r=Math.min(n.length,a.length);let s=r;for(let l=0;l<r;l++)if(n[l]!==a[l]){s=l;break}if(s==0)return t;let o=[];for(let l=s;l<n.length;l++)o.push("..");return o=o.concat(a.slice(s)),o.join("/")}async writeHandle(e,t){if(e.createWritable){const n=await e.createWritable();await n.write(t),await n.close()}else{const n=await(await this.getRoot()).resolve(e);if(!n)return;await W0.writeHandle(n.join("/"),t)}}}class _e{static standardHandler;static urlHandler;static async initFileSystem(){this.urlHandler=new N0,this.standardHandler=window.nw?new(await We(async()=>{const{NodeFileHandler:e}=await import("./NodeFileHandler-D5HkseV1.js");return{NodeFileHandler:e}},__vite__mapDeps([6,1,2]))).NodeFileHandler:new U0}static getStandardHandler(){return this.standardHandler}static getHandler(e){return e!==void 0&&e.startsWith("https://")||e?.startsWith("http://")?this.urlHandler:this.standardHandler}static handleDropEvent(e,t){return this.getHandler().handleDropEvent(e,t)}static getDirectoryHandle(e,t){return _e.getHandler(e).getDirectoryHandle(e,t)}static hasFile(e){return _e.getHandler(e).hasFile(e)}static getFileHandle(e,t){return _e.getHandler(e).getFileHandle(e,t)}static getFileHandleRelativeTo(e,t){return _e.getHandler(e).getFileHandleRelativeTo(e,t)}static getDirectoryFiles(e){return _e.getHandler(typeof e=="string"?e:void 0).getDirectoryFiles(e)}static getDirectoryFolders(e){return _e.getHandler(typeof e=="string"?e:void 0).getDirectoryFolders(e)}static writeFile(e,t){return _e.getHandler(typeof e=="string"?e:void 0).writeFile(e,t)}static removeFile(e){return _e.getHandler(e).removeFile(e)}static getRelativePath(e,t){return _e.getHandler().getRelativePath(e,t)}}class Ya extends st{app;dirOptions;fileDropPath="";draggedElement;draggedCopy;keyHandler;dropHandler;mouseHandler;dragHandler;constructor(e,t,n){super({title:t.title,width:500,height:400,disableClose:t.disableClose,win_id:"file_selector"+Math.random(),blocking:!0}),this.app=e,this.dirOptions=t,t.accepted_file_types||=[],this.keyHandler=this.handleKeyEvent.bind(this),this.dropHandler=this.handleDropEvent.bind(this),this.mouseHandler=this.handleMouseEvent.bind(this),this.dragHandler=this.handleDragEvent.bind(this),this.initView().then(()=>{n&&this.selectPath(n),t.onload?.()})}async initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("div");t.classList.add("menu-options");const n=document.createElement("div");n.classList.add("menu-left");const a=document.createElement("div");a.classList.add("menu-right"),t.appendChild(n),t.appendChild(a);const r=document.createElement("button");r.innerText="Cancel",r.onclick=()=>{window.removeEventListener("keydown",this.keyHandler,!0),window.removeEventListener("drop",this.dropHandler,!0),this.closeWindow()};const s=document.createElement("button");s.innerText="Select",s.classList.add("confirm"),s.onclick=()=>this.confirmFile(),s.disabled=!0,n.appendChild(r),a.appendChild(s);const o=document.createElement("div");o.classList.add("dir-selector"),o.onclick=b=>{b.target==o&&this.selectElement(void 0)};const l=document.createElement("div");l.classList.add("file-options");const u=document.createElement("button"),f=pe.getIcon("ADD_FILE",16);u.appendChild(f),u.appendChild(document.createTextNode("Upload files")),l.appendChild(u),u.onclick=async()=>{const b=this.fileDropPath,x=await Cu({_preferPolyfill:!0,excludeAcceptAllOption:!1,multiple:!0}),C=this.viewElement.querySelector(".info.selected")?.dataset.path??"",E=[];for(const R of x)E.push(_e.getStandardHandler().uploadHandle(R,C));await Promise.all(E),await this.refreshDirectory(b),this.getAcceptableFile(b).then(R=>this.selectPath(R))};const c=document.createElement("button"),d=pe.getIcon("FOLDER",16);c.appendChild(d),c.appendChild(document.createTextNode("Upload folder")),l.appendChild(c),c.onclick=async()=>{const b=this.fileDropPath,x=await L0({_preferPolyfill:!0}),C=this.viewElement.querySelector(".info.selected")?.dataset.path??"";await _e.getStandardHandler().uploadHandle(x,C),await this.refreshDirectory(b),this.getAcceptableFile(b==""?x.name:b+"/"+x.name).then(E=>this.selectPath(E))};const h=document.createElement("button");h.classList.add("rename");const p=pe.getIcon("EDIT",16);h.appendChild(p),h.appendChild(document.createTextNode("Rename")),h.disabled=!0,h.onclick=()=>{const b=this.viewElement.querySelector(".info.selected");b?.dataset.path&&this.startEditing(b.querySelector("textarea"))},l.appendChild(h);const m=document.createElement("button");m.classList.add("delete");const g=pe.getIcon("TRASH",16);m.appendChild(g),m.appendChild(document.createTextNode("Delete")),m.disabled=!0,m.onclick=()=>{const b=this.viewElement.querySelector(".info.selected"),x=b?.dataset.path;if(!x)return;const v=b.parentElement.classList.contains("folder");_e.getStandardHandler()[v?"removeDirectory":"removeFile"](x).then(()=>{const C=this.getElement(x);C&&(C.parentElement?.remove(),m.disabled=!0,h.disabled=!0)})},l.appendChild(m),e.appendChild(o),e.appendChild(l),e.appendChild(t),this.viewElement.appendChild(e),window.addEventListener("keydown",this.keyHandler,!0),window.addEventListener("drop",this.dropHandler,!0),window.addEventListener("mousemove",this.dragHandler,!0),this.viewElement.addEventListener("dragover",this.mouseHandler),await this.createDiv("").then(b=>o.replaceChildren(...b))}async expand(e){if(!e.parentElement.classList.contains("folder"))return;e.parentElement.classList.remove("collapsed");const t=e.nextSibling;await this.createDiv(e.dataset.path).then(n=>{t.replaceChildren(...n)})}collapse(e){if(!e.parentElement.classList.contains("folder"))return;e.parentElement.classList.add("collapsed"),e.nextSibling.replaceChildren()}selectElement(e){if(this.viewElement.querySelector(".info.selected")?.classList.remove("selected"),!e){this.viewElement.querySelector(".delete").disabled=!0,this.viewElement.querySelector(".rename").disabled=!0;return}e.classList.add("selected"),Fn(e,{scrollMode:"if-needed",block:"nearest",inline:"nearest"});const t=this.viewElement.querySelector("button.confirm"),n=e.dataset.path;t.disabled=!0,n&&(t.disabled=!this.acceptableFileType(n),this.viewElement.querySelector(".delete").disabled=!1,this.viewElement.querySelector(".rename").disabled=!1)}async createDiv(e){const t=await _e.getStandardHandler().getDirectoryFolders(e);let n=await _e.getStandardHandler().getDirectoryFiles(e);return t.sort((a,r)=>a.name.toLowerCase().localeCompare(r.name.toLowerCase())),n.sort((a,r)=>a.name.toLowerCase().localeCompare(r.name.toLowerCase())),n=n.filter(a=>kt(a.name)!=".crswap"),t.map(a=>this.createBaseElement(e,a)).concat(n.map(a=>this.createBaseElement(e,a)))}createBaseElement(e,t){e!=""&&(e+="/");const n=document.createElement("div");n.classList.add("item");const a=document.createElement("div");if(a.classList.add("info"),n.appendChild(a),t.kind=="directory"){const s=pe.getIcon("CHEVRON",16);s.classList.add("folder-icon"),a.appendChild(s);const o=document.createElement("div");o.classList.add("children"),n.appendChild(o),n.classList.add("folder"),n.classList.add("collapsed"),a.addEventListener("click",l=>{const u=l.target;u?.classList.contains("options-icon")||u.tagName=="TEXTAREA"&&!u.disabled||(n.classList.contains("collapsed")?this.expand(a):this.collapse(a))})}else{this.acceptableFileType(t.name)||a.classList.add("disabled");const s=pe.getIcon(this.getIconId(t.name),16);a.appendChild(s)}a.dataset.path=e+t.name;const r=document.createElement("textarea");return r.rows=1,r.disabled=!0,r.autocomplete="off",r.autocapitalize="off",r.spellcheck=!1,r.innerText=t.name,r.style.pointerEvents="none",r.classList.add("title"),a.appendChild(r),a.addEventListener("click",()=>this.selectElement(a)),a.addEventListener("mousedown",()=>this.startDragging(a)),a.ondblclick=()=>this.confirmFile(),n}confirmFile(){const t=this.viewElement.querySelector(".info.selected")?.dataset.path;t&&this.acceptableFileType(t)&&(this.dirOptions.callback?.(t),window.removeEventListener("keydown",this.keyHandler,!0),window.removeEventListener("drop",this.dropHandler,!0),window.removeEventListener("mousemove",this.dragHandler,!0),this.closeWindow())}acceptableFileType(e){return this.dirOptions.accepted_file_types.length==0||this.dirOptions.accepted_file_types.includes(kt(e))}getIconId(e){const t=kt(e);return t==""&&!e.startsWith(".")?"FOLDER":Ii.includes(t)?"IMAGE_FILE":Va.includes(t)?"VOLUME":[".sm",".ssc"].includes(t)?"SM_FILE":"UNKNOWN_FILE"}startEditing(e){const t=e.value,n=!!e.parentElement?.parentElement?.classList.contains("folder"),a=e.parentElement?.dataset.path??"",r=rt(a);e.value=a.split("/").at(-1)??"",window.removeEventListener("keydown",this.keyHandler,!0),e.disabled=!1,e.style.pointerEvents="",e.focus(),e.addEventListener("keypress",s=>{s.code=="Enter"&&(s.preventDefault(),s.stopImmediatePropagation(),e.blur())},!0),e.addEventListener("blur",async()=>{if(window.addEventListener("keydown",this.keyHandler,!0),e.disabled=!0,e.style.pointerEvents="none",e.value.startsWith(".")){e.value=t;return}e.value=e.value.replaceAll("/","");const s=r==""?e.value:r+"/"+e.value;s!=a&&(e.parentElement.dataset.path=s,await _e.getStandardHandler()[n?"renameDirectory":"renameFile"](a,s),this.refreshDirectory(r),e.value.length>32&&(e.value=e.value.slice(0,32)+"..."))})}async refreshDirectory(e){const t=this.viewElement.querySelector(".dir-selector");if(!t)return;let n=t.querySelector("div[data-path='"+this.escapeSelector(e)+"']")?.nextSibling;if(e==""&&(n=t),!n)return;const a=Array.from(n.parentElement.querySelectorAll(".folder:not(.collapsed)")).map(r=>r.children[0].dataset.path);await this.createDiv(e).then(r=>n.replaceChildren(...r)),await Promise.all(a.map(r=>this.expand(t.querySelector("div[data-path='"+this.escapeSelector(r)+"']"))))}getElement(e){const t=this.viewElement.querySelector(".dir-selector");return t?t.querySelector("div[data-path='"+this.escapeSelector(e)+"']"):null}async getAcceptableFile(e){const t=await _e.getStandardHandler().getDirectoryHandle(e);if(!t)return;const n=[{path:e,handle:t}];for(;n.length>0;){const a=n.shift(),r=a.handle;for await(const s of r.values()){const o=a.path==""?"":a.path+"/";if(s.kind=="directory")n.push({path:o+s.name,handle:s});else if(this.acceptableFileType(s.name))return o+s.name}}}async selectPath(e){if(!e)return;const t=this.viewElement.querySelector(".dir-selector");if(!t)return;const n=e.split("/");n.pop();const a=[];for(;n.length>0;){a.push(n.shift());const s=t.querySelector("div[data-path='"+this.escapeSelector(a.join("/"))+"']");if(!s)return;await this.expand(s)}const r=t.querySelector("div[data-path='"+this.escapeSelector(e)+"']");r&&this.selectElement(r)}handleKeyEvent(e){if(!this.windowElement.classList.contains("focused"))return;const t=this.viewElement.querySelector(".info.selected");if(t==null){if(e.code.startsWith("Arrow")){const n=this.viewElement.querySelector(".info");n&&this.selectElement(n)}return}if(e.code=="ArrowUp"){e.preventDefault(),e.stopImmediatePropagation();const n=t.parentElement;let a=n.previousSibling?.querySelector(".info");a&&!a.parentElement.classList.contains("collapsed")&&a.parentElement.classList.contains("folder")&&(a=a.parentElement.querySelector(".children").lastChild.querySelector(".info")),!a&&n.parentElement.classList.contains("children")&&(a=n.parentElement.parentElement.querySelector(".info")),a&&(this.selectElement(a),Fn(a,{scrollMode:"if-needed",block:"nearest",inline:"nearest"}))}if(e.code=="ArrowDown"){e.preventDefault(),e.stopImmediatePropagation();const n=t.parentElement;let a;n.classList.contains("folder")&&!n.classList.contains("collapsed")&&(a=n.querySelector(".children").children[0].querySelector(".info")),a||(a=t.parentElement.nextSibling?.querySelector(".info")),!a&&n.parentElement.classList.contains("children")&&(a=n.parentElement.parentElement.nextSibling.querySelector(".info")),a&&(this.selectElement(a),Fn(a,{scrollMode:"if-needed",block:"nearest",inline:"nearest"}))}if(e.code=="ArrowLeft"&&(e.preventDefault(),e.stopImmediatePropagation(),this.collapse(t)),e.code=="ArrowRight"&&(e.preventDefault(),e.stopImmediatePropagation(),this.expand(t)),e.code=="Enter"&&(e.preventDefault(),e.stopImmediatePropagation(),t.parentElement?.querySelector(".title")&&this.startEditing(t.parentElement?.querySelector(".title"))),e.code=="Delete"||e.code=="Backspace"){const n=this.viewElement.querySelector(".info.selected"),a=n?.dataset.path;if(!a)return;const r=n.parentElement.classList.contains("folder");_e.getStandardHandler()[r?"removeDirectory":"removeFile"](a).then(()=>{const s=this.getElement(a);s&&(s.parentElement?.remove(),this.viewElement.querySelector(".delete").disabled=!0,this.viewElement.querySelector(".rename").disabled=!0)})}}startDragging(e){const t=e;t.totalMovementX=0,t.totalMovementY=0,this.draggedElement=t;const n=()=>{this.stopDragging(),window.removeEventListener("mouseup",n)};window.addEventListener("mouseup",n)}handleDragEvent(e){if(this.draggedElement){if(this.draggedElement.totalMovementX+=e.movementX,this.draggedElement.totalMovementY+=e.movementY,!this.draggedCopy)if(Math.abs(this.draggedElement.totalMovementX)+Math.abs(this.draggedElement.totalMovementY)>8){this.viewElement.addEventListener("mousemove",this.mouseHandler),this.draggedCopy=this.draggedElement.parentElement.cloneNode(!0),this.draggedCopy.style.position="fixed";const t=this.draggedElement.getBoundingClientRect();this.draggedCopy.style.top=t.top+this.draggedElement.totalMovementY+"px",this.draggedCopy.style.left=t.left+this.draggedElement.totalMovementX+"px",this.draggedCopy.style.width=t.width+"px",this.draggedCopy.style.boxShadow="3px 3px 3px #222",this.draggedCopy.querySelector(".children")&&this.draggedCopy.removeChild(this.draggedCopy.querySelector(".children")),this.viewElement.appendChild(this.draggedCopy)}else return;this.draggedCopy.style.top=parseFloat(this.draggedCopy.style.top.slice(0,-2))+e.movementY+"px",this.draggedCopy.style.left=parseFloat(this.draggedCopy.style.left.slice(0,-2))+e.movementX+"px"}}async stopDragging(){if(this.draggedCopy){this.draggedCopy.remove(),this.viewElement.removeEventListener("mousemove",this.mouseHandler);const e=this.draggedCopy.classList.contains("folder"),t=this.draggedElement.dataset.path,n=this.fileDropPath==""?Et(this.draggedElement.dataset.path):this.fileDropPath+"/"+Et(this.draggedElement.dataset.path);t!=n&&await _e.getStandardHandler()[e?"renameDirectory":"renameFile"](t,n),await this.refreshDirectory(rt(t)),await this.refreshDirectory(rt(n)),this.viewElement.querySelector(".outlined")?.classList.remove("outlined"),this.fileDropPath=""}this.draggedCopy=void 0,this.draggedElement=void 0}handleDropEvent(e){e.preventDefault(),e.stopImmediatePropagation(),this.viewElement.querySelector(".outlined")?.classList.remove("outlined"),e.target.closest(".dir-selector")&&_e.getStandardHandler().handleDropEvent(e,this.fileDropPath).then(async t=>{await this.refreshDirectory(this.fileDropPath),this.getAcceptableFile(t??this.fileDropPath).then(n=>this.selectPath(n)),this.fileDropPath=""})}handleMouseEvent(e){const t=this.viewElement.querySelector(".dir-selector");let n=Array.from(t.querySelectorAll("div.item.folder"));const a=this.viewElement.querySelector(".outlined");n=n.filter(r=>!r.parentElement.closest(".collapsed")),n.reverse(),n.push(t);for(const r of n){const s=r.getBoundingClientRect();if(e.clientX>=s.x&&e.clientX<=s.x+s.width&&e.clientY>=s.y&&e.clientY<=s.y+s.height){a!=r&&a?.classList.remove("outlined");const o=r.querySelector(".info");this.fileDropPath=o?.dataset.path??"",r.classList.contains("dir-selector")&&(this.fileDropPath=""),r.classList.add("outlined");return}}this.viewElement.querySelector(".outlined")?.classList.remove("outlined"),this.fileDropPath=""}escapeSelector(e){return e.replaceAll(/'/g,"\\'")}}function ku(){const i=document.createElement("div");return i.spellcheck=!1,i.contentEditable="true",i.classList.add("inlineEdit"),i.onkeydown=e=>{e.key=="Enter"&&i.blur()},i}function ca(i,e){return{title:i,element:t=>{const n=ku();return n.onblur=()=>{const a=n.innerText,r=t[e];Lt.instance.run({action:()=>{t[e]=a,n.innerText=a},undo:()=>{t[e]=r,n.innerText=r}}),n.scrollLeft=0},n.innerText=t[e],n}}}const q0={name:ca("Name","chartName"),credit:ca("Artist","credit"),style:ca("Style","chartStyle"),description:ca("Description","description"),music:{title:"Music File",element:(i,e)=>{const t=document.createElement("div");t.classList.add("flex-row","flex-column-gap","flex-static","hide-buttons");const n=()=>{if(a.innerText==(i.music??e.chartManager.loadedSM.properties.MUSIC??""))return;const u=e.chartManager.chartAudio.isPlaying();if(a.innerText==""||a.innerText==e.chartManager.loadedSM.properties.MUSIC){i.music=void 0,a.innerText=e.chartManager.loadedSM.properties.MUSIC+"",e.chartManager.loadAudio(),u&&e.chartManager.chartAudio.play();return}const f=a.innerText==e.chartManager.loadedSM.properties.MUSIC?void 0:a.innerText,c=i.music;Lt.instance.run({action:()=>{i.music=f,a.innerText=f??e.chartManager.loadedSM.properties.MUSIC??"",e.chartManager.loadAudio(),u&&e.chartManager.chartAudio.play()},undo:()=>{i.music=c,a.innerText=c??e.chartManager.loadedSM.properties.MUSIC??"",e.chartManager.loadAudio(),u&&e.chartManager.chartAudio.play()}})},a=ku();a.style.flex="1",a.onblur=n,a.innerText=i.music??e.chartManager.loadedSM.properties.MUSIC??"";const r=document.createElement("button");r.onclick=()=>{const u=rt(e.chartManager.smPath);if(window.nw){const f=document.createElement("input");f.type="file",f.accept="audio/*",f.onchange=()=>{a.innerText=_e.getRelativePath(u,f.value),n()},f.click()}else e.windowManager.openWindow(new Ya(e,{title:"Select an audio file...",accepted_file_types:Va,disableClose:!0,callback:f=>{a.innerText=_e.getRelativePath(u,f),n()}},u+"/"+(i.music??e.chartManager.loadedSM.properties.MUSIC??"")))};const s=pe.getIcon("FOLDER",12);r.appendChild(s);const o=document.createElement("button");o.onclick=()=>{a.innerText!=(e.chartManager.loadedSM.properties.MUSIC??"")&&(a.innerText=e.chartManager.loadedSM.properties.MUSIC??"",n())};const l=pe.getIcon("REVERT",12);return o.appendChild(l),t.appendChild(a),t.appendChild(r),t.appendChild(o),t}}};class $n extends st{app;buttonOptions;message;resolve;resolved=new Promise(e=>this.resolve=e);constructor(e,t,n,a){super({title:t,width:300,height:100,disableClose:!0,win_id:"confirm",blocking:!0}),this.app=e,this.message=n,this.buttonOptions=a,this.initView()}initView(){this.viewElement.replaceChildren(),this.viewElement.classList.add("confirmation");const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("div");t.classList.add("label"),t.innerText=this.message,e.appendChild(t);const n=document.createElement("div");n.classList.add("menu-options"),this.buttonOptions.forEach(a=>{const r=document.createElement("button");r.innerText=a.label,r.onclick=()=>{a.callback?.(),this.resolve?.(a.label),this.closeWindow()},a.type!="default"&&r.classList.add(a.type),n.append(r)}),e.appendChild(n),this.viewElement.appendChild(e)}}class Su extends st{app;gameType;chartList;chartInfo;gameTypeDropdown;smLoadHandler=()=>{this.gameTypeDropdown.setItems(ft.getPriority().map(e=>{const t=this.app.chartManager.loadedSM?.charts[e.id]??[];return e.id+" ("+t.length+")"})),this.gameTypeDropdown.setSelected(this.gameType.id+" ("+(this.app.chartManager.loadedSM?.charts[this.gameType.id]??[]).length+") "),this.gameType=this.app.chartManager.loadedChart?.gameType??this.gameType,this.loadCharts()};constructor(e,t){super({title:"Chart List",width:500,height:400,win_id:"chart_list"}),this.app=e,this.gameType=t??e.chartManager.loadedChart?.gameType??ft.getPriority()[0],this.initView(),le.on("smLoadedAfter",this.smLoadHandler)}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("div");t.classList.add("chart-view-type-wrapper");const n=document.createElement("div");n.classList.add("chart-view-type-label"),n.innerText="Game Type:",this.gameTypeDropdown=li.create(ft.getPriority().map(r=>{const s=this.app.chartManager.loadedSM?.charts[r.id]??[];return r.id+" ("+s.length+")"}),this.gameType.id+" ("+(this.app.chartManager.loadedSM?.charts[this.gameType.id]??[]).length+") "),this.gameTypeDropdown.onChange(r=>{this.gameType=ft.getGameType(r.split(" ")[0])??this.gameType,this.loadCharts()}),t.appendChild(n),t.appendChild(this.gameTypeDropdown.view);const a=document.createElement("div");a.classList.add("chart-view-scroller"),e.appendChild(t),e.appendChild(a),this.chartList=document.createElement("div"),this.chartList.classList.add("chart-list"),this.chartInfo=document.createElement("div"),this.chartInfo.classList.add("chart-info"),a.appendChild(this.chartList),a.appendChild(this.chartInfo),this.viewElement.appendChild(e),this.loadCharts()}onClose(){le.off("smLoadedAfter",this.smLoadHandler)}loadCharts(){const e=this.app.chartManager.loadedSM?.charts[this.gameType.id]??[],t=[];this.gameTypeDropdown.setItems(ft.getPriority().map(s=>{const o=this.app.chartManager.loadedSM?.charts[s.id]??[];return s.id+" ("+o.length+")"})),this.gameTypeDropdown.setSelected(this.gameType.id+" ("+(this.app.chartManager.loadedSM?.charts[this.gameType.id]??[]).length+") "),e.forEach(s=>{const o=document.createElement("div");o.classList.add("chart-list-item"),o.chart=s,this.app.chartManager.loadedChart==s&&o.classList.add("selected"),o.onclick=()=>{o.chart!=this.app.chartManager.loadedChart&&(this.app.chartManager.loadChart(o.chart),this.chartList.querySelectorAll(".selected").forEach(d=>d.classList.remove("selected")),o.classList.add("selected"))},o.onmouseenter=()=>{this.loadChartDetails(o.chart)},o.onmouseleave=()=>{this.loadChartDetails()};const l=document.createElement("div");l.innerText=s.meter+"",l.classList.add("title",s.difficulty);const u=document.createElement("div");u.classList.add("chart-list-info");const f=document.createElement("div");f.innerText=s.credit,f.classList.add("title","chart-credit");const c=document.createElement("div");c.innerText=s.getNotedata().length+"",c.classList.add("title","chart-step-count"),u.appendChild(f),u.appendChild(c),o.appendChild(l),o.appendChild(u),t.push(o)});const n=document.createElement("div");n.classList.add("chart-list-item");const a=document.createElement("div");a.innerText="+",a.classList.add("title");const r=document.createElement("div");r.classList.add("chart-list-info"),r.innerText="New Blank Chart",n.appendChild(a),n.appendChild(r),n.onclick=()=>{const s=new Yu(this.app.chartManager.loadedSM);s.gameType=this.gameType,this.app.chartManager.loadedSM.addChart(s),this.app.chartManager.loadChart(s),this.loadCharts()},this.chartList.replaceChildren(...t,n),this.loadChartDetails()}loadChartDetails(e){if(e=e??this.app.chartManager.loadedChart,e?.gameType.id!=this.gameType.id){this.chartInfo.replaceChildren();return}if(!e)return;const t=()=>this.app.chartManager.loadedSM.charts[e.gameType.id].sort((m,g)=>pn.indexOf(m.difficulty)==pn.indexOf(g.difficulty)?m.meter-g.meter:pn.indexOf(m.difficulty)-pn.indexOf(g.difficulty)),n=document.createElement("div");n.classList.add("chart-info-main");const a=li.create(pn,e.difficulty);a.view.classList.add("no-border","white"),a.onChange(m=>{const g=e.difficulty;Lt.instance.run({action:()=>{e.difficulty=m,t(),this.loadCharts()},undo:()=>{e.difficulty=g,t(),this.loadCharts()}})});const r=document.createElement("div");r.spellcheck=!1,r.contentEditable="true",r.classList.add("inlineEdit","chart-meter"),r.onkeydown=m=>{m.key=="Enter"&&r.blur()},r.onblur=()=>{let m=In(r.innerText);if(m===null){r.innerText=e?.meter+"";return}m=Math.round(Ae(1,m,2**31-1));const g=e.meter;Lt.instance.run({action:()=>{e.meter=m,e.meterF=m,t(),this.loadCharts()},undo:()=>{e.meter=g,e.meterF=g,t(),this.loadCharts()}}),r.scrollLeft=0},r.innerText=e.meter+"";const s=document.createElement("div");s.classList.add("chart-properties"),n.appendChild(a.view),n.appendChild(r),Object.values(q0).forEach(m=>{const g=document.createElement("div");g.classList.add("label"),g.innerText=m.title;const b=m.element(e,this.app);m.title=="Artist"&&b.addEventListener("blur",()=>this.loadCharts()),s.appendChild(g),s.appendChild(b)});const o=e.stats.noteCounts,l=document.createElement("div");l.classList.add("chart-info-grid-item");const u=document.createElement("div");u.innerText="Peak NPS",u.classList.add("title","chart-info-grid-label");const f=document.createElement("div");f.innerText=e.stats.getMaxNPS().toFixed(2)+"",f.classList.add("title","chart-info-grid-count"),l.appendChild(u),l.appendChild(f);const c=document.createElement("div");c.classList.add("chart-info-grid"),Object.entries(o).forEach(m=>{const g=document.createElement("div");g.classList.add("chart-info-grid-item");const b=document.createElement("div");b.innerText=m[0],b.classList.add("title","chart-info-grid-label");const x=document.createElement("div");x.innerText=m[1]+"",x.classList.add("title","chart-info-grid-count"),g.appendChild(b),g.appendChild(x),c.appendChild(g)});const d=document.createElement("div");d.classList.add("menu-options");const h=document.createElement("button");h.innerText="Duplicate Chart",h.onclick=()=>{const m=Object.assign(Object.create(Object.getPrototypeOf(e)),e);m.setNotedata(e.getNotedata().map(g=>e.computeNote(g))??[]),this.app.chartManager.loadedSM.addChart(m),this.app.chartManager.loadChart(m),this.loadCharts()},d.append(h);const p=document.createElement("button");p.innerText="Delete Chart",p.onclick=()=>{this.app.windowManager.openWindow(new $n(this.app,"Delete chart","Are you sure you want to delete this chart?",[{type:"default",label:"Cancel"},{type:"delete",label:"Delete",callback:()=>{this.app.chartManager.loadedSM.removeChart(e)&&(this.app.chartManager.loadChart(),this.gameType=this.app.chartManager.loadedChart?.gameType??this.gameType,this.loadCharts())}}]))},p.classList.add("delete"),d.append(p),this.chartInfo.replaceChildren(n,s,l,c,d)}}var rs,Zl;function G0(){if(Zl)return rs;Zl=1;var i=4,e=.001,t=1e-7,n=10,a=11,r=1/(a-1),s=typeof Float32Array=="function";function o(m,g){return 1-3*g+3*m}function l(m,g){return 3*g-6*m}function u(m){return 3*m}function f(m,g,b){return((o(g,b)*m+l(g,b))*m+u(g))*m}function c(m,g,b){return 3*o(g,b)*m*m+2*l(g,b)*m+u(g)}function d(m,g,b,x,v){var C,E,R=0;do E=g+(b-g)/2,C=f(E,x,v)-m,C>0?b=E:g=E;while(Math.abs(C)>t&&++R<n);return E}function h(m,g,b,x){for(var v=0;v<i;++v){var C=c(g,b,x);if(C===0)return g;var E=f(g,b,x)-m;g-=E/C}return g}function p(m){return m}return rs=function(g,b,x,v){if(!(0<=g&&g<=1&&0<=x&&x<=1))throw new Error("bezier x values must be in [0, 1] range");if(g===b&&x===v)return p;for(var C=s?new Float32Array(a):new Array(a),E=0;E<a;++E)C[E]=f(E*r,g,x);function R(O){for(var H=0,N=1,K=a-1;N!==K&&C[N]<=O;++N)H+=r;--N;var ae=(O-C[N])/(C[N+1]-C[N]),T=H+ae*r,W=c(T,g,x);return W>=e?h(O,T,g,x):W===0?T:d(O,H,H+r,g,x)}return function(H){return H===0?0:H===1?1:f(R(H),b,v)}},rs}var $0=G0();const fi=Kn($0),j0=fi(0,0,1,1);function Ql(i,e){const t=e?e.split("."):[];for(;t.length&&i;){const n=t.shift(),a=new RegExp("(.+)\\[([0-9]*)\\]").exec(n);if(a!==null&&a.length==3){const r={arrName:a[1],arrIndex:a[2]};i[r.arrName]!==void 0?i=i[r.arrName][r.arrIndex]:i=void 0;continue}i=i[n]}return i}function Y0(i,e,t){const n=e?e.split("."):[];for(;n.length&&i;){const a=n.shift(),r=new RegExp("(.+)\\[([0-9]*)\\]").exec(a);if(r!==null&&r.length==3){const s={arrName:r[1],arrIndex:r[2]};i[s.arrName]!==void 0&&n.length===0&&(i[s.arrName][s.arrIndex]=t);continue}i[a]===void 0&&(i[a]={}),n.length===0&&(i[a]=t),i=i[a]}return i}class ii{static animations=new Map;static _id=0;static{At.shared.add(e=>{for(const[t,n]of this.animations.entries())n.obj._destroyed?this.stop(t):(n.progress=Math.min(1,n.progress+n.seconds*e),this.updateObject(n.obj,n.animation,n.curve(n.progress)),n.progress>=1&&(n.onend(n.obj),this.stop(t,1)))})}static updateObject(e,t,n){const a=Object.keys(t).sort((o,l)=>parseFloat(o)-parseFloat(l));let r="0";for(let o=a.length-2;o>=0;o--)if(parseFloat(a[o])<=n){r=a[o];break}let s="1";for(let o=1;o<a.length;o++)if(parseFloat(a[o])>n){s=a[o];break}Object.keys(t[0]).forEach(o=>{let l=t[r][o],u=t[s][o];l==="inherit"&&(t[r][o]=Ql(e,o),l=t[r][o]),u==="inherit"&&(t[s][o]=Ql(e,o),u=t[s][o]);const f=l+(n-parseFloat(r))/(parseFloat(s)-parseFloat(r))*(u-l);Y0(e,o,f)})}static stop(e,t=null){e!==void 0&&(t!==null&&this.animations.get(e)?.obj&&!this.animations.get(e).obj.destroyed&&this.updateObject(this.animations.get(e).obj,this.animations.get(e).animation,t),this.animations.delete(e))}static finish(e){e!==void 0&&this.stop(e,1)}static animate(e,t,n,a,r=()=>{},s){return s||=`${++this._id}`,this.animations.set(s,{obj:e,animation:t,seconds:1/(60*n),progress:0,curve:a!==void 0?a:j0,onend:r}),this.updateObject(e,t,0),s}}const ss=[{frequency:20,Q:.71},{frequency:75,gain:0},{frequency:100,gain:0,Q:.6},{frequency:250,gain:0,Q:.3},{frequency:1040,gain:0,Q:.41},{frequency:2500,gain:0,Q:.2},{frequency:7500,gain:0},{frequency:2e4,Q:.71}],Jl=[{freq:20,label:"20"},{freq:30,label:"30"},{freq:40,label:"40"},{freq:50,label:"50"},{freq:60,label:"60"},{freq:70,label:""},{freq:80,label:"80"},{freq:90,label:""},{freq:100,label:"100"},{freq:200,label:"200"},{freq:300,label:"300"},{freq:400,label:"400"},{freq:500,label:"500"},{freq:600,label:"600"},{freq:700,label:""},{freq:800,label:"800"},{freq:900,label:""},{freq:1e3,label:"1k"},{freq:2e3,label:"2k"},{freq:3e3,label:"3k"},{freq:4e3,label:"4k"},{freq:5e3,label:"5k"},{freq:6e3,label:"6k"},{freq:7e3,label:""},{freq:8e3,label:"8k"},{freq:9e3,label:""},{freq:1e4,label:"10k"},{freq:15e3,label:""},{freq:2e4,label:"20k"}],tn=0,nn=0,Ui=1200,ht=400,La=new Array(Ui).fill(0).map((i,e)=>fo(e)),K0=new Float32Array(La);function Ba(i){return Math.log(i/20)/Math.log(1102.5)*Ui}function fo(i){return Math.pow(1102.5,i/Ui)*20}function Hi(i){return-i*6+ht/2}function ec(i){return-(i-ht/2)/6}class X0 extends st{app;cachedReponse=new Array(Ui).fill(0);onAudioLoad=this.onAudio.bind(this);onThemeChange=this.changeHTMLColors.bind(this);points=[];icons;info;trackedFilter=null;constructor(e){super({title:"Audio Equalizer",width:600,height:245,win_id:"audio-eq"}),this.app=e,this.initView(),this.onAudioLoad(),le.on("audioLoaded",this.onAudioLoad),le.on("themeChanged",this.onThemeChange)}destroy(){le.off("audioLoaded",this.onAudioLoad),le.off("themeChanged",this.onThemeChange)}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("eq-container");const t=document.createElement("div");t.classList.add("icon-container"),this.app.chartManager.chartAudio.getFilters().forEach((v,C)=>{const E=pe.getIcon(v.type.toUpperCase(),36,24,Ni[C]);E.classList.add("eq-icon"),E.style.backgroundColor=`${Ni[C]}40`,E.onclick=()=>{this.app.chartManager.chartAudio.getFilter(C).enabled?this.app.chartManager.chartAudio.disableFilter(C):this.app.chartManager.chartAudio.enableFilter(C),this.endTrack(),this.updateIcons()},E.onmouseenter=()=>this.points[C].highlight(),E.onmouseleave=()=>this.points[C].unhighlight(),t.appendChild(E)}),this.icons=t,this.updateIcons();const n=document.createElement("canvas");n.style.width="37.5rem",n.style.height="12.5rem",n.onmousedown=v=>{const C=this.points.filter(E=>E.hitTest(v.offsetX*2/y.general.uiScale,v.offsetY*2/y.general.uiScale)).at(-1);this.endTrack(),C?.mouseDown(v)};const a=document.createElement("div");a.classList.add("eq-info-container");const r=document.createElement("div");r.classList.add("eq-info");const s=document.createElement("div");s.innerText="Type",s.classList.add("eq-info-label");const o=document.createElement("div");o.classList.add("eq-info-value"),r.replaceChildren(s,o);const l=document.createElement("div");l.classList.add("eq-info");const u=document.createElement("div");u.innerText="Frequency",u.classList.add("eq-info-label");const f=document.createElement("div");f.contentEditable="false",f.classList.add("eq-info-value","inlineEdit"),l.replaceChildren(u,f),this.setupInput(f,"frequency",20,22050," Hz");const c=document.createElement("div");c.classList.add("eq-info");const d=document.createElement("div");d.innerText="Gain",d.classList.add("eq-info-label");const h=document.createElement("div");h.contentEditable="false",h.classList.add("eq-info-value","inlineEdit"),c.replaceChildren(d,h),this.setupInput(h,"gain",-24,24," dB",1);const p=document.createElement("div");p.classList.add("eq-info");const m=document.createElement("div");m.innerText="Q",m.classList.add("eq-info-label");const g=document.createElement("div");g.contentEditable="false",g.classList.add("eq-info-value","inlineEdit"),p.replaceChildren(m,g),this.setupInput(g,"Q",1e-4,1e3,"",4);const b=document.createElement("div");b.classList.add("eq-reset","disabled"),b.innerText="Reset",b.onclick=()=>{if(this.trackedFilter==null)for(let v=0;v<ss.length;v++)this.app.chartManager.chartAudio.updateFilter(v,ss[v]),this.app.chartManager.chartAudio.disableFilter(v),this.updateIcons(),this.points[v].refreshPoint();else this.app.chartManager.chartAudio.updateFilter(this.trackedFilter,ss[this.trackedFilter]),this.app.chartManager.chartAudio.disableFilter(this.trackedFilter),this.updateIcons(),this.points[this.trackedFilter].refreshPoint(),this.trackFilter(this.trackedFilter)},a.replaceChildren(r,l,c,p,b),this.info=a,e.replaceChildren(t,n,a),this.viewElement.appendChild(e);const x=this.drawEQ(n);requestAnimationFrame(x),this.changeHTMLColors()}selectText(e){const t=window.getSelection(),n=document.createRange();!t||!n||n.selectNodeContents(e)}setupInput(e,t,n,a,r="",s=0){let o=0;e.onfocus=()=>{o=this.app.chartManager.chartAudio.getFilter(this.trackedFilter)[t].value,e.innerText=ue(o,s)+"",this.selectText(e)},e.onkeydown=l=>{if(l.key=="Enter"){e.blur();return}if(l.key=="Tab"){const f=[...e.parentElement.parentElement.children],c=f.indexOf(e.parentElement);for(let d=1;d<f.length;d++){const p=f[(d+c)%f.length].children[1];if(p.contentEditable==="true"){p.focus();break}}return}if(l.key=="Escape"){e.innerText=o+r,this.app.chartManager.chartAudio.updateFilter(this.trackedFilter,{gain:Ae(o,n,a)}),this.points[this.trackedFilter].refreshPoint(),this.getResponse(),e.blur();return}setTimeout(()=>{const u=In(e.innerText);u!==null&&(this.app.chartManager.chartAudio.updateFilter(this.trackedFilter,{[t]:Ae(u,n,a)}),this.points[this.trackedFilter].refreshPoint(),this.getResponse())})},e.onblur=()=>{In(e.innerText)===null&&(this.app.chartManager.chartAudio.updateFilter(this.trackedFilter,{[t]:Ae(o,n,a)}),this.points[this.trackedFilter].refreshPoint(),this.getResponse()),e.innerText=ue(this.app.chartManager.chartAudio.getFilter(this.trackedFilter)[t].value,s)+r}}onAudio(){this.points=this.app.chartManager.chartAudio.getFilters().map((e,t)=>new Z0(this,t)),this.getResponse(),this.updateIcons(),this.endTrack()}getResponse(){this.cachedReponse=this.app.chartManager.chartAudio.getFrequencyResponse(La)}drawEQ(e){const t=e.getContext("2d");t.canvas.width=1200,t.canvas.height=400;const n=()=>{if(!this.app.chartManager.chartAudio)return;const a=t.createRadialGradient(e.width/2,e.height/2,0,e.width/2,e.height/2,e.width/2);let r,s;const o=Be.getColor("accent-color");Ss(Be.getColor("primary-bg"))>.5?(r=new L("white"),s=new L("black")):(r=new L("black"),s=new L("white"));const l=Jt(o,r,.95);a.addColorStop(0,Jt(o,r,.9).toHexa()),a.addColorStop(1,l.toHexa()),t.fillStyle=a,t.fillRect(0,0,e.width,e.height),t.fillStyle=Jt(o,r,.2).toHex(),this.drawFrequencies(t,this.app.chartManager.chartAudio.getFrequencyData()),this.app.chartManager.chartAudio.hasFilters()&&(t.fillStyle=Jt(o,s,.2).toHex()+"50",this.drawFrequencies(t,this.app.chartManager.chartAudio.getFilteredFrequencyData())),t.fillStyle="rgba(200, 200, 200, 0.5)",this.drawResponse(t),t.fillStyle=Jt(o,s,.2).toHex()+"80",t.font="22px Assistant",this.drawGrid(t),this.points.forEach(u=>u.draw(t)),e.closest("#windows")&&requestAnimationFrame(n)};return n}drawFrequencies(e,t){for(let n=0;n<Ui;n++){const a=fo(n)/this.app.chartManager.chartAudio.getSampleRate()*this.app.chartManager.chartAudio.getFFTSize(),r=t[Math.floor(a)]/255;e.fillRect(tn+n,nn+ht-r*ht,1,r*ht)}}drawResponse(e){for(let t=0;t<Ui;t++){const n=Math.log(this.cachedReponse[t])/.115241,a=Hi(n);e.fillRect(t+tn,Math.min(a,ht/2)+nn,1,Math.max(a,ht/2)-Math.min(a,ht/2))}}drawGrid(e){for(const t of Jl)e.fillRect(tn+Ba(t.freq),nn,1,ht),e.fillText(t.label,tn+Ba(t.freq)-(t==Jl.at(-1)?20:0),nn+ht/2);for(let t=-25;t<=25;t+=5){const n=nn+Hi(t);e.fillRect(0,n,1200,1),t!=0&&e.fillText(t+"",tn,n)}}changeHTMLColors(){let e;const t=Be.getColor("accent-color");Ss(Be.getColor("primary-bg"))>.5?e=new L("white"):e=new L("black");const n=Jt(t,e,.95),a=Jt(t,e,.5);this.icons.style.backgroundColor=n.toHexa(),this.icons.style.borderImageSource=`linear-gradient(to right, ${n.toHexa()}, ${a.toHexa()}, ${n.toHexa()})`,this.info.style.backgroundColor=n.toHexa(),this.info.style.borderImageSource=`linear-gradient(to right, ${n.toHexa()}, ${a.toHexa()}, ${n.toHexa()})`,this.info.style.color=t.toHexa()}updateIcons(){[...this.icons.children].forEach((e,t)=>{this.app.chartManager.chartAudio.getFilter(t).enabled?e.classList.remove("disabled"):e.classList.add("disabled")}),this.getResponse()}trackFilter(e){this.trackedFilter=e;const t=this.app.chartManager.chartAudio.getFilter(e),[n,a,r,s]=[...this.info.children].map(o=>o.children[1]);n.innerText=t.type,a.innerText=Math.round(t.frequency.value)+" Hz",r.innerText=t.type.endsWith("pass")?"-":ue(t.gain.value,1)+" dB",s.innerText=t.type.endsWith("shelf")?"-":ue(t.Q.value,2)+"",n.style.color=Ni[e],a.style.color=Ni[e],r.style.color=Ni[e],s.style.color=Ni[e],a.contentEditable="true",r.contentEditable=`${!t.type.endsWith("pass")}`,s.contentEditable=`${!t.type.endsWith("shelf")}`}endTrack(){setTimeout(()=>{this.trackedFilter=null,this.points.forEach(r=>r.unhighlight());const[e,t,n,a]=[...this.info.children].map(r=>r.children[1]);e.innerText="",t.innerText="",n.innerText="",a.innerText="",t.contentEditable="false",n.contentEditable="false",a.contentEditable="false"})}}const ua=16,Ni=["#a3001b","#a34f00","#d6d606","#19c402","#02c4ba","#022fc4","#5602c4","#c402b4"];class Z0{filterIndex;window;dragging=!1;x=0;y=0;type;response=new Float32Array(La.length);_empty=new Float32Array(La.length);highlighted=!1;pointSize=.4;constructor(e,t){this.filterIndex=t,this.window=e,this.type=this.window.app.chartManager.chartAudio.getFilter(t).type,this.x=Ba(this.window.app.chartManager.chartAudio.getFilter(t).frequency.value??10),this.getY()}hitTest(e,t){return(e-this.x)*(e-this.x)+(t-this.y)*(t-this.y)<=ua*ua}canChangeGain(){return this.type=="lowshelf"||this.type=="highshelf"||this.type=="peaking"}canChangeQ(){return!this.type.endsWith("shelf")}getY(){this.type.endsWith("shelf")?this.y=Hi((this.window.app.chartManager.chartAudio.getFilter(this.filterIndex).gain.value??0)/2):this.canChangeGain()?this.y=Hi(this.window.app.chartManager.chartAudio.getFilter(this.filterIndex).gain.value??0):this.y=ht/2}getGain(){if(this.canChangeGain())return this.type.endsWith("shelf")?ec(this.y)*2:ec(this.y)}mouseDown(e){this.calcResponse(),this.dragging=!0,this.highlighted=!0,this.window.app.chartManager.chartAudio.getFilter(this.filterIndex).enabled||(this.window.app.chartManager.chartAudio.enableFilter(this.filterIndex),this.window.updateIcons());const t=this.x,n=this.y,a=e.clientX,r=e.clientY,s=l=>{this.x=(l.clientX-a)*2+t,this.canChangeGain()?this.y=(l.clientY-r)*2+n:this.y=ht/2,this.x=Ae(this.x,0,Ui),this.y=Ae(this.y,this.type.endsWith("shelf")?ht/4:Hi(24),this.type.endsWith("shelf")?3*ht/4:Hi(-24)),this.window.app.chartManager.chartAudio.updateFilter(this.filterIndex,{frequency:fo(this.x),gain:this.getGain()}),this.window.getResponse(),this.window.trackFilter(this.filterIndex),this.calcResponse()};this.window.trackFilter(this.filterIndex);const o=()=>{ii.animate(this,{0:{pointSize:"inherit"},1:{pointSize:.3}},.3,fi(.11,.71,.41,.86),()=>{},`eq-point${this.filterIndex}`),this.dragging=!1,window.removeEventListener("mousemove",s),window.removeEventListener("mouseup",o)};ii.animate(this,{0:{pointSize:"inherit"},1:{pointSize:.9}},.3,fi(.11,.71,.41,.86),()=>{},`eq-point${this.filterIndex}`),window.addEventListener("mousemove",s),window.addEventListener("mouseup",o)}calcResponse(){this.window.app.chartManager.chartAudio.getFilter(this.filterIndex).getFrequencyResponse(K0,this.response,this._empty)}draw(e){const t=this.highlighted||this.window.app.chartManager.chartAudio.getFilter(this.filterIndex).enabled?Ni[this.filterIndex]:"#888888";if(e.fillStyle=t+"60",this.dragging)for(let n=0;n<this.response.length;n++){const a=Math.log(this.response[n])/.115241,r=Hi(a);e.fillRect(n+tn,Math.min(r,ht/2)+nn,1,Math.max(r,ht/2)-Math.min(r,ht/2))}e.fillStyle=t+"80",e.beginPath(),e.arc(this.x,this.y,ua,0,2*Math.PI),e.closePath(),e.fill(),e.beginPath(),e.arc(this.x,this.y,ua*this.pointSize,0,2*Math.PI),e.closePath(),e.fill()}refreshPoint(){this.x=Ba(this.window.app.chartManager.chartAudio.getFilter(this.filterIndex).frequency.value??10),this.getY()}highlight(){this.highlighted=!0}unhighlight(){this.highlighted=!1}}const os={columnOneBased:{label:"1-indexed column numbers",tooltip:"Start counting column numbers from 0 instead of 1."},lengthAsNumberIndex:{label:"Store length in integer keys",tooltip:'Store the length of holds as the last item in each table, instead of using the "length" key.'},padNumbers:{label:"Pad numbers",tooltip:"Pad decimals with trailing zeros."},minify:{label:"Minify",tooltip:"Remove all newlines and spaces."},notitgNoteTypes:{label:"Use NotITG Note Types",tooltip:'Use NotITG note types. (Tap = 1, Hold = 2, Mine = "M")'}},tc={Tap:"1",Hold:"2",Roll:"4",Mine:'"M"',Lift:'"L"',Fake:'"F"'};class Q0 extends st{app;selection;outputDiv;exportOptions={include:{Beat:!0,Second:!1,Column:!0,Type:!0,Quantization:!1,Length:!0},options:{columnOneBased:!1,lengthAsNumberIndex:!1,padNumbers:!1,minify:!1,notitgNoteTypes:!1}};constructor(e,t=[]){super({title:"Export Notedata",width:600,height:400,disableClose:!1,win_id:"export_notedata",blocking:!1}),this.app=e,t.length==0&&(t=this.app.chartManager.loadedChart.getNotedata()),this.selection=t,this.initView(),this.export()}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("div");t.classList.add("export-container");const n=document.createElement("div");n.classList.add("export-options");const a=document.createElement("pre");a.classList.add("export-output"),Ke(a,{content:"Click to copy to clipboard"}),Ke(a,{content:"Copied!",trigger:"click",onShow(o){o.setProps({trigger:"mouseenter"})},onHide(o){o.setProps({trigger:"click"})}}),a.addEventListener("click",()=>{navigator.clipboard.writeText(a.innerText)}),this.outputDiv=a;const r=document.createElement("div");r.classList.add("export-section-label"),r.innerText="Include",n.appendChild(r),Object.keys(this.exportOptions.include).forEach(o=>{const l=document.createElement("input");l.type="checkbox",l.id="en-i-"+o,l.checked=this.exportOptions.include[o],l.onchange=()=>{this.exportOptions.include[o]=l.checked,this.export()};const u=document.createElement("label");u.classList.add("export-label"),u.htmlFor=l.id,u.innerText=o;const f=document.createElement("div");f.replaceChildren(l,u),f.classList.add("export-option"),n.appendChild(f)});const s=document.createElement("div");s.classList.add("export-section-label"),s.innerText="Options",n.appendChild(s),Object.keys(this.exportOptions.options).forEach(o=>{const l=document.createElement("input");l.id="en-o-"+o,l.type="checkbox",l.checked=this.exportOptions.options[o],l.onchange=()=>{this.exportOptions.options[o]=l.checked,this.export()};const u=document.createElement("label");u.classList.add("export-label"),u.htmlFor=l.id,u.innerText=os[o].label;const f=document.createElement("div");f.replaceChildren(l,u),f.classList.add("export-option"),n.appendChild(f),os[o].tooltip!==void 0&&Ke(f,{content:os[o].tooltip})}),t.replaceChildren(n,a),e.appendChild(t),this.viewElement.appendChild(e)}export(){let e=`{
`+this.selection.map(t=>{let n="	{";return this.exportOptions.include.Beat&&(n+=this.padNum(t.beat)+","),this.exportOptions.include.Second&&(n+=this.padNum(t.second)+","),this.exportOptions.include.Column&&(this.exportOptions.options.columnOneBased?n+=t.col+1+",":n+=t.col+","),this.exportOptions.include.Type&&(this.exportOptions.options.notitgNoteTypes&&tc[t.type]!==void 0?n+=tc[t.type]+",":n+='"'+t.type+'",'),this.exportOptions.include.Quantization&&(n+=t.quant+","),this.exportOptions.include.Length&&Re(t)&&(this.exportOptions.options.lengthAsNumberIndex?n+=this.padNum(t.hold)+",":n+="length="+this.padNum(t.hold)+","),n.endsWith(",")&&(n=n.slice(0,-1)),n+="}",this.getNumIncludes()==1&&(n=n.replaceAll("{",""),n=n.replaceAll("}","")),n}).join(`,
`)+`
}`;this.exportOptions.options.minify&&(e=e.replaceAll(/\s/g,"")),this.outputDiv.innerText=e}getNumIncludes(){return Object.values(this.exportOptions.include).map(e=>+e).reduce((e,t)=>e+t,0)}padNum(e){return this.exportOptions.options.padNumbers?(Math.round(e*1e3)/1e3).toFixed(3):Math.round(e*1e3)/1e3}}class un extends st{app;allowMods;callback;combo={mods:[],key:""};conflictCheck;listener;static active=!1;constructor(e,t,n,a){super({title:"",width:300,height:168,disableClose:!0,win_id:"keyComboSelector",blocking:!0}),this.app=e,this.allowMods=t,this.callback=n,this.conflictCheck=a??(()=>[]),this.initView(),un.active=!0}initView(){this.viewElement.replaceChildren(),this.viewElement.classList.add("confirmation");const e=document.createElement("div");e.classList.add("padding"),e.style.gap="0.5rem";const t=document.createElement("div");t.classList.add("label"),t.innerText="Input a key combo and select Ok when finished.",e.appendChild(t);const n=document.createElement("input");n.type="text",n.disabled=!0,n.style.fontSize="1.25rem",n.style.height="1.5rem",n.style.flex="0",n.style.textAlign="center",e.appendChild(n);const a=document.createElement("div");a.classList.add("detail"),a.innerText="No conflicts",a.style.flex="1",e.appendChild(a);const r=document.createElement("div");r.classList.add("menu-options");const s=document.createElement("button");s.innerText="Ok",s.onclick=()=>{this.callback(this.combo),this.closeWindow()},s.classList.add("confirm"),s.disabled=!0;const o=document.createElement("button");o.innerText="Cancel",o.onclick=()=>{this.closeWindow()},r.append(o),r.append(s),e.appendChild(r),this.viewElement.appendChild(e),this.listener=l=>{if(["Meta","Control","Shift","Alt","Escape"].includes(l.key))return;if(this.combo.key=ve.getKeyNameFromEvent(l),this.allowMods){const f=[];for(let c=0;c<Fa.length;c++)l[Fa[c]]&&f.push(va[c]);this.combo.mods=f}n.value=ve.getComboString(this.combo);const u=this.conflictCheck(this.combo);u=="self"?(a.innerText="Combo already binded for this keybind",s.disabled=!0):(s.disabled=!1,u.length>=3?a.innerText=`Conflicts with ${u.length} keybinds`:u.length>=1?a.innerText=`Conflicts with ${u.join(",")}`:a.innerText="No conflicts"),l.preventDefault()},window.addEventListener("keydown",this.listener,!0)}onClose(){window.removeEventListener("keydown",this.listener,!0),un.active=!1}}class J0 extends st{app;observer;conflictMap=this.calculateConflicts();constructor(e){super({title:"Gameplay Keybind Options",width:600,height:400,disableClose:!1,win_id:"gameplay_keybind_options",blocking:!1}),this.app=e,this.initView()}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("div");t.classList.add("pref-container");const n=document.createElement("div");n.classList.add("pref-scrollers");const a=document.createElement("div");a.classList.add("pref-section-scroller");const r=document.createElement("div");r.classList.add("pref-option-scroller"),n.replaceChildren(a,r),this.observer=new IntersectionObserver(s=>{s.forEach(o=>{const l=o.target.dataset.id,u=a.querySelector(`.pref-section[data-id=${l}]`);u&&(o.intersectionRatio>0?u.classList.add("selected"):u.classList.remove("selected"))})},{}),t.replaceChildren(n),a.replaceChildren(...this.createSections()),r.replaceChildren(...this.createOptions()),e.appendChild(t),this.viewElement.appendChild(e)}createSections(){return Object.keys(ft.getTypes()).map(e=>this.createEmptySection(e))}createOptions(){return Object.keys(ft.getTypes()).map(e=>{const t=new Array(ft.getTypes()[e].numCols).fill(null).map((r,s)=>this.createKeybindItem(e,s)),n=document.createElement("div");n.classList.add("pref-group"),n.dataset.id=e;const a=document.createElement("div");return a.classList.add("pref-group-label"),a.innerText=e,n.replaceChildren(a,...t),this.observer.observe(n),n})}createEmptySection(e){const t=document.createElement("div");return t.classList.add("pref-section"),t.dataset.id=e,t.innerText=e,t.onclick=()=>{t.parentElement.parentElement.querySelector(`.pref-group[data-id=${e}]`).scrollIntoView()},t}createKeybindItem(e,t){const n=document.createElement("div");n.classList.add("pref-keybind"),n.dataset.id=e+"-"+t,n.onclick=o=>{o.target.classList.contains("pref-keybind-combo")||n.querySelector(".icon")?.contains(o.target)||this.app.windowManager.openWindow(new un(this.app,!1,l=>{ve.setGameplayKeybind(e,t,l.key),this.conflictMap=this.calculateConflicts(),n.replaceWith(this.createKeybindItem(e,t))},l=>{const u=this.conflictMap.get(e)?.get(l.key)?.map(f=>ki[f[0]]?.[f[1]].label??"Column "+f[1])??[];return u.includes(ki[e]?.[t].label??"Column "+t)?"self":u}))};const a=document.createElement("div");a.classList.add("pref-keybind-label"),a.innerText=ki[e]?.[t].label??"Column "+t;const r=pe.getIcon("REVERT");r.style.width="0.75rem",r.addEventListener("click",()=>{ve.revertGameplayKeybind(e,t),this.conflictMap=this.calculateConflicts(),n.replaceWith(this.createKeybindItem(e,t))}),r.style.display=ve.checkIsDefaultGameplay(e,t)?"none":"block";const s=document.createElement("div");return s.classList.add("pref-keybind-combos"),s.replaceChildren(...ve.getKeysForGameType(e)[t].map(o=>{const l=document.createElement("button");return l.classList.add("pref-keybind-combo"),l.innerText=o,this.conflictMap.get(e).get(o).length>1&&l.classList.add("conflict"),l.onclick=()=>{ve.removeGameplayKeybind(e,t,o),this.conflictMap=this.calculateConflicts(),n.replaceWith(this.createKeybindItem(e,t))},l})),n.replaceChildren(a,r,s),n}calculateConflicts(){const e=new Map;Object.keys(ft.getTypes()).forEach(t=>{const n=new Map;ve.getKeysForGameType(t).forEach((a,r)=>{a.forEach((s,o)=>{n.has(s)||n.set(s,[]),n.get(s).push([t,r,o])})}),e.set(t,n)}),[...this.viewElement.querySelectorAll(".pref-keybind-combo.conflict")].forEach(t=>t.classList.remove("conflict"));for(const t of e.values())for(const n of t.values())n.length!=1&&n.forEach(a=>{const r=this.viewElement.querySelector(`.pref-keybind[data-id=${a[0]}-${a[1]}] .pref-keybind-combos`);r?.children[a[2]]&&r.children[a[2]].classList.add("conflict")});return e}onClose(){this.observer?.disconnect()}}class Tu{static _model;static async getModel(){return this._model||await this._load(),this._model}static async _load(){this._model=[];const e=localStorage.getItem("recentFiles");if(e){try{const t=JSON.parse(e);if(!Array.isArray(t))return;for(const n of t)typeof n!="object"||Array.isArray(n)||typeof n?.name!="string"||typeof n?.path!="string"||this._model.find(a=>a.path==n.path)||this._model.push({name:n.name,path:n.path})}catch{console.log("Failed to load recent file entries");return}await this.saveEntries()}}static async getRecents(){return await this.getModel()}static async addSM(e,t){const n=await this.getModel(),a=n.findIndex(r=>r.path==e);a!=-1&&n.splice(a,1),n.unshift({name:t.properties.TITLE??"Untitled Song",path:e}),this.saveEntries()}static async limitEntries(){(await this.getModel()).splice(15)}static async saveEntries(){this.limitEntries();const e=await Promise.all(this._model.map(t=>_e.hasFile(t.path)));this._model=this._model.filter((t,n)=>e[n]),localStorage.setItem("recentFiles",JSON.stringify(this._model))}}const em=`#TITLE:New Song;
#SUBTITLE:;
#ARTIST:;
#TITLETRANSLIT:;
#SUBTITLETRANSLIT:;
#ARTISTTRANSLIT:;
#GENRE:;
#CREDIT:;
#BANNER:;
#BACKGROUND:;
#LYRICSPATH:;
#CDTITLE:;
#MUSIC:;
#OFFSET:0;
#SAMPLESTART:0.000000;
#SAMPLELENGTH:10.000000;
#SELECTABLE:YES;
#BPMS:0.000000=120.000000;
#STOPS:;
#BGCHANGES:;
#FGCHANGES:;
#KEYSOUNDS:;
#ATTACKS:;
`,Mu=[{title:"Metadata",items:[{title:"Title",propName:"TITLE",input:{type:"string"}},{title:"Subtitle",propName:"SUBTITLE",input:{type:"string"}},{title:"Artist",propName:"ARTIST",input:{type:"string"}},{title:"Credit",propName:"CREDIT",input:{type:"string"}},{title:"Genre",propName:"GENRE",input:{type:"string"}},{title:"Origin",propName:"ORIGIN",input:{type:"string"}}]},{title:"Resources",items:[{title:"Audio Track",propName:"MUSIC",input:{type:"file",typeName:"audio",accept:Va,onChange:i=>i.chartManager.loadAudio()}},{title:"Background Image",propName:"BACKGROUND",input:{type:"file",typeName:"image",accept:Ii}},{title:"Banner Image",propName:"BANNER",input:{type:"file",typeName:"image",accept:Ii}},{title:"CD Title",propName:"CDTITLE",input:{type:"file",typeName:"image",accept:Ii}},{title:"CD Image",propName:"CDIMAGE",input:{type:"file",typeName:"image",accept:Ii}},{title:"Jacket",propName:"JACKET",input:{type:"file",typeName:"image",accept:Ii}},{title:"Disc Image",propName:"DISCIMAGE",input:{type:"file",typeName:"image",accept:Ii}}]},{title:"Song",items:[{title:"Song Preview",propName:"SAMPLESTART",input:{type:"custom",create:(i,e,t)=>{const n=()=>{r.value<a.value&&(r.value=a.value);const l=e.properties.SAMPLESTART??"0",u=e.properties.SAMPLELENGTH??"10",f=a.value.toString(),c=(r.value-a.value).toString();t.run({action:()=>{e.properties.SAMPLESTART=f,e.properties.SAMPLELENGTH=c,a.value=parseFloat(f),r.value=parseFloat(f)+parseFloat(c)},undo:()=>{e.properties.SAMPLESTART=l,e.properties.SAMPLELENGTH=u,a.value=parseFloat(l),r.value=parseFloat(l)+parseFloat(u)}})},a=lt.create({value:parseFloat(e.properties.SAMPLESTART??"0"),precision:3,min:0});a.onchange=l=>{if(l===void 0){a.value=parseFloat(e.properties.SAMPLESTART??"0");return}n()};const r=lt.create({value:parseFloat(e.properties.SAMPLESTART??"0")+parseFloat(e.properties.SAMPLELENGTH??"10"),precision:3,min:0});r.onchange=l=>{if(l===void 0){r.value=parseFloat(e.properties.SAMPLESTART??"0")+parseFloat(e.properties.SAMPLELENGTH??"10");return}n()};const s=document.createElement("div"),o=document.createElement("div");return o.innerText="to",s.classList.add("flex-row","flex-column-gap"),s.replaceChildren(a.view,o,r.view),s}}}]}];function Du(i,e,t,n){switch(n.input.type){case"custom":return n.input.create(i,e,t);case"string":{const a=document.createElement("input");return a.type="text",a.autocomplete="off",a.spellcheck=!1,a.onkeydown=r=>{r.key=="Enter"&&a.blur()},a.onblur=()=>{const r=e.properties[n.propName],s=a.value;t.run({action:()=>{e.properties[n.propName]=s,a.value=s},undo:()=>{e.properties[n.propName]=r,a.value=r??""}})},a.value=e.properties[n.propName]??"",a}case"number":{const a=n.input,r=lt.create({value:parseFloat(e.properties[n.propName]??"15"),...a});return r.onchange=s=>{if(s===void 0){r.value=parseFloat(e.properties[n.propName]??"0");return}const o=e.properties[n.propName],l=s.toString();t.run({action:()=>{e.properties[n.propName]=l,r.value=parseFloat(l)},undo:()=>{e.properties[n.propName]=o,r.value=parseFloat(o??"0")}})},r.view}case"file":{const a=n.input,r=n.input.onChange,s=document.createElement("div");s.classList.add("flex-row","flex-column-gap");const o=document.createElement("input");o.type="text",o.autocomplete="off",o.spellcheck=!1,o.placeholder="click to select a file",o.onclick=c=>{c.preventDefault(),o.blur();const d=rt(i.chartManager.smPath);if(window.nw){const h=document.createElement("input");h.type="file",h.accept=a.accept.join(","),h.nwworkingdir=d,h.onchange=()=>{const p=_e.getRelativePath(d,h.value);f(p)},h.click()}else i.windowManager.openWindow(new Ya(i,{title:`Select a${a.typeName.match(/^[aieouAIEOU].*/)?"n":""} ${a.typeName} file...`,accepted_file_types:a.accept,disableClose:!0,callback:h=>{const p=_e.getRelativePath(d,h);f(p)}},e.properties[n.propName]?d+"/"+e.properties[n.propName]:i.chartManager.smPath))},o.value=e.properties[n.propName]??"",s.appendChild(o);const l=document.createElement("button");l.style.height="100%",l.classList.add("delete"),l.disabled=!e.properties[n.propName],l.onclick=()=>{f(void 0),l.disabled=!0};const u=pe.getIcon("TRASH",12);l.appendChild(u),s.appendChild(l);const f=c=>{const d=e.properties[n.propName]??"";t.run({action:()=>{e.properties[n.propName]=c,o.value=c??"",l.disabled=o.value==""},undo:()=>{e.properties[n.propName]=d,o.value=d,l.disabled=o.value==""}}),r?.(i)};return s}}}class Lu extends st{app;sm;history;fileTable={};constructor(e){super({title:"New Song",width:450,height:492,disableClose:!0,win_id:"sm_properties",blocking:!0});const t=new Blob([em],{type:"text/plain"}),n=new File([t],"song.sm",{type:"text/plain"});this.sm=new xc(n),this.history=new Lt(e),this.app=e,this.initView()}initView(){this.viewElement.replaceChildren(),this.viewElement.classList.add("sm-properties");const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("div");t.classList.add("label"),t.innerText="Apply to",Mu.forEach(l=>{const u=document.createElement("div");u.classList.add("sm-container");const f=document.createElement("div");f.classList.add("sm-title"),f.innerText=l.title;const c=document.createElement("div");c.classList.add("property-grid"),l.items.forEach(d=>{const h=document.createElement("div");h.classList.add("label"),h.innerText=d.title,c.appendChild(h),d.input.type=="file"?c.appendChild(this.createFileElement(d.propName,d.input.typeName)):c.appendChild(Du(this.app,this.sm,this.history,d))}),u.appendChild(f),u.appendChild(c),e.appendChild(u)});const n=document.createElement("div");n.classList.add("menu-options");const a=document.createElement("div");a.classList.add("menu-left");const r=document.createElement("div");r.classList.add("menu-right"),n.appendChild(a),n.appendChild(r);const s=document.createElement("button");s.innerText="Cancel",s.onclick=()=>{this.closeWindow()};const o=document.createElement("button");o.innerText="Create",o.classList.add("confirm"),o.onclick=()=>{this.sm.properties.MUSIC===void 0||this.sm.properties.MUSIC===""?this.app.windowManager.openWindow(new $n(this.app,"No audio file uploaded","Are you sure you want to create a file with no audio?",[{type:"confirm",label:"Yes",callback:()=>{this.createSong(),this.closeWindow()}},{type:"default",label:"No"}])):(this.createSong(),this.closeWindow())},a.appendChild(s),r.appendChild(o),e.appendChild(n),this.viewElement.appendChild(e)}async createSong(){let e=this.sm.properties.TITLE;if(window.nw){const t=nw.require("path"),n=nw.require("process"),a=document.createElement("input");a.type="file",a.nwsaveas=e+".sm",a.onchange=async()=>{const r=t.basename(a.value,t.extname(a.value));e=t.dirname(a.value);const s=t.join(e,r+".sm");await _e.writeFile(s,this.sm.serialize("sm")),await Promise.all(Object.entries(this.fileTable).map(o=>{const l=t.resolve(t.join(e,o[0])),u=t.resolve(o[1].path);if(!(n.platform=="win32"&&l.toLowerCase()===u.toLowerCase())&&l!==u)return _e.writeFile(l,o[1])})),await this.app.chartManager.loadSM(s),this.app.windowManager?.getWindowById("select_sm_initial")?.closeWindow()},a.click()}else{if(await _e.getDirectoryHandle(e)){let t=2;for(;await _e.getDirectoryHandle(e);)e=`${this.sm.properties.TITLE} ${t++}`}await _e.writeFile(e+"/song.sm",this.sm.serialize("sm")),await Promise.all(Object.entries(this.fileTable).map(t=>_e.writeFile(e+`/${t[0]}`,t[1]))),await this.app.chartManager.loadSM(e+"/song.sm"),this.app.windowManager?.getWindowById("select_sm_initial")?.closeWindow()}}createFileElement(e,t){const n=document.createElement("div");n.classList.add("flex-row","flex-column-gap");const a=document.createElement("input");a.type="text",a.autocomplete="off",a.spellcheck=!1,a.placeholder="click to upload a file",a.readOnly=!0,a.onclick=o=>{o.preventDefault(),a.blur();const l=document.createElement("input");l.type="file",l.accept=t=="audio"?"audio/*":"image/*",l.onchange=()=>{const u=l.files?.[0];if(!u)return;this.sm.properties[e]&&this.fileTable[this.sm.properties[e]]&&delete this.fileTable[this.sm.properties[e]];let f=u.name;for(;this.fileTable[u.name]&&(this.fileTable[u.name].size!=u.size||this.fileTable[u.name].type!=u.type);)f="_"+f;this.fileTable[f]=u,a.value=f,this.sm.properties[e]=a.value,r.disabled=!1},l.click()},a.value=this.sm.properties[e]??"",n.appendChild(a);const r=document.createElement("button");r.style.height="100%",r.classList.add("delete"),r.disabled=!0,r.onclick=()=>{this.sm.properties[e]&&this.fileTable[this.sm.properties[e]]&&delete this.fileTable[this.sm.properties[e]],this.sm.properties[e]=void 0,a.value="",r.disabled=!0};const s=pe.getIcon("TRASH",12);return r.appendChild(s),n.appendChild(r),n}}class po extends st{app;keyHandler;constructor(e,t=!0){super({title:"Open a Song",width:400,height:320,disableClose:t,win_id:"select_sm_initial"}),this.app=e,this.keyHandler=this.handleKeyEvent.bind(this),window.addEventListener("keydown",this.keyHandler),this.initView(),le.on("resize",()=>{this.move(window.innerWidth/2-this.options.width/2*y.general.uiScale,window.innerHeight/2-this.options.height/2*y.general.uiScale)})}onClose(){window.removeEventListener("keydown",this.keyHandler)}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("div");t.classList.add("open-container"),e.appendChild(t);const n=document.createElement("div");n.classList.add("top-container");const a=document.createElement("div");a.classList.add("separator"),a.style.margin="0.5rem";const r=document.createElement("div");r.classList.add("bottom-container"),t.appendChild(n),t.appendChild(a),t.appendChild(r);const s=document.createElement("button");s.style.display="flex",s.style.flexDirection="column",s.style.padding="0.5rem",s.style.backgroundColor="#414352",s.style.color="white",n.appendChild(s);const o=pe.getIcon("UPLOAD",30);s.appendChild(o);const l=document.createElement("div");l.innerText=window.nw?"Open an existing song":"Import a song folder",s.appendChild(l),s.onclick=()=>{if(window.nw){const p=document.createElement("input");p.type="file",p.accept=".sm,.ssc",p.onchange=()=>{this.app.chartManager.loadSM(p.value),this.closeWindow()},p.click()}else this.app.windowManager.openWindow(new Ya(this.app,{title:"Select an sm/ssc file...",accepted_file_types:[".sm",".ssc"],disableClose:!0,callback:p=>{this.app.chartManager.loadSM(p),this.closeWindow()}}))};const u=document.createElement("button");u.style.display="flex",u.style.flexDirection="column",u.style.padding="0.5rem",u.style.backgroundColor="#506352",u.style.color="white",n.appendChild(u);const f=pe.getIcon("PLUS",30);u.appendChild(f);const c=document.createElement("div");c.innerText="New Song",u.appendChild(c),u.onclick=()=>{this.app.windowManager.openWindow(new Lu(this.app))};const d=document.createElement("div");d.innerText="Recently Opened",d.classList.add("title"),r.appendChild(d);const h=document.createElement("div");h.classList.add("recent-selector"),r.appendChild(h),Tu.getRecents().then(p=>p.forEach(m=>{const g=document.createElement("div");g.classList.add("recent-item");const b=document.createElement("div");b.classList.add("recent-name"),b.innerText=m.name;const x=document.createElement("div");x.classList.add("recent-path"),x.innerText=m.path,g.appendChild(b),g.appendChild(x),g.onclick=()=>{h.querySelectorAll(".selected").forEach(v=>v.classList.remove("selected")),g.classList.add("selected")},g.ondblclick=()=>{this.app.chartManager.loadSM(m.path),this.closeWindow()},h.appendChild(g)})),this.viewElement.appendChild(e)}handleKeyEvent(e){if(!this.windowElement.classList.contains("focused"))return;const t=this.viewElement.querySelector(".selected");if(t){if(e.code=="ArrowUp"){e.preventDefault(),e.stopImmediatePropagation();const n=t.previousElementSibling;n&&(t.parentElement.querySelectorAll(".selected").forEach(a=>a.classList.remove("selected")),n.classList.add("selected"),Fn(n,{scrollMode:"if-needed",block:"nearest",inline:"nearest"}))}if(e.code=="ArrowDown"){e.preventDefault(),e.stopImmediatePropagation();const n=t.nextElementSibling;n&&(t.parentElement.querySelectorAll(".selected").forEach(a=>a.classList.remove("selected")),n.classList.add("selected"),Fn(n,{scrollMode:"if-needed",block:"nearest",inline:"nearest"}))}}}}const rn={file:{type:"menu",title:"File",options:[{type:"selection",id:"newSong"},{type:"selection",id:"openSong"},{type:"separator"},{type:"selection",id:"previousSong"},{type:"selection",id:"nextSong"},{type:"separator"},{type:"selection",id:"save"},{type:"selection",id:"export"},{type:"separator"},{type:"selection",id:"capture"}]},edit:{type:"menu",title:"Edit",options:[{type:"selection",id:"cut"},{type:"selection",id:"copy"},{type:"selection",id:"paste"},{type:"selection",id:"pasteReplace"},{type:"separator"},{type:"selection",id:"undo"},{type:"selection",id:"redo"},{type:"separator"},{type:"checkbox",id:"mousePlacement",checked:()=>y.chart.mousePlacement}]},view:{type:"menu",title:"View",options:[{type:"dropdown",title:"Cursor",options:[{type:"selection",id:"cursorUp"},{type:"selection",id:"cursorDown"},{type:"separator"},{type:"selection",id:"previousNote"},{type:"selection",id:"nextNote"},{type:"separator"},{type:"selection",id:"previousMeasure"},{type:"selection",id:"nextMeasure"},{type:"separator"},{type:"selection",id:"previousStream"},{type:"selection",id:"nextStream"},{type:"separator"},{type:"selection",id:"jumpChartStart"},{type:"selection",id:"jumpChartEnd"},{type:"separator"},{type:"selection",id:"jumpSongStart"},{type:"selection",id:"jumpSongEnd"}]},{type:"dropdown",title:"Snap",options:[{type:"selection",id:"decreaseSnap"},{type:"selection",id:"increaseSnap"}]},{type:"dropdown",title:"Scroll",options:[{type:"checkbox",id:"XMod",checked:()=>!y.chart.CMod},{type:"checkbox",id:"CMod",checked:()=>y.chart.CMod},{type:"separator"},{type:"selection",id:"increaseScrollSpeed"},{type:"selection",id:"decreaseScrollSpeed"}]},{type:"dropdown",title:"Zoom",options:[{type:"selection",id:"zoomIn"},{type:"selection",id:"zoomOut"},{type:"separator"},{type:"selection",id:"zoomDefault"}]},{type:"separator"},{type:"selection",id:"playMode"},{type:"selection",id:"playModeStart"},{type:"separator"},{type:"selection",id:"recordMode"},{type:"selection",id:"recordModeStart"},{type:"separator"},{type:"checkbox",id:"reverse",checked:()=>y.chart.reverse},{type:"checkbox",id:"hideWarpedArrows",checked:()=>y.chart.hideWarpedArrows},{type:"checkbox",id:"hideFakedArrows",checked:()=>y.chart.hideFakedArrows},{type:"checkbox",id:"doSpeedChanges",checked:()=>y.chart.doSpeedChanges}]},chart:{type:"menu",title:"Chart",options:[{type:"selection",id:"openChart"},{type:"separator"},{type:"selection",id:"previousChart"},{type:"selection",id:"nextChart"},{type:"separator"},{type:"selection",id:"songProperties"},{type:"separator"},{type:"selection",id:"timingDataRow"}]},selection:{type:"menu",title:"Selection",options:[{type:"dropdown",title:"Convert",options:[{type:"selection",id:"convertHoldsRolls"},{type:"selection",id:"convertRollsHolds"},{type:"selection",id:"swapHoldsRolls"},{type:"separator"},{type:"selection",id:"convertHoldsTaps"},{type:"selection",id:"convertTapsMines"},{type:"selection",id:"convertTapsLifts"},{type:"selection",id:"convertTapsFakes"}]},{type:"dropdown",title:"Mirror",options:[{type:"selection",id:"mirrorHorizontally"},{type:"selection",id:"mirrorVertically"},{type:"selection",id:"mirrorBoth"}]},{type:"dropdown",title:"Stretch",options:[{type:"selection",id:"expand2to1"},{type:"selection",id:"expand3to2"},{type:"selection",id:"expand4to3"},{type:"separator"},{type:"selection",id:"compress1to2"},{type:"selection",id:"compress2to3"},{type:"selection",id:"compress3to4"}]},{type:"dropdown",title:"Shift",options:[{type:"dropdown",title:"Up",options:[{type:"selection",id:"shiftUp4m"},{type:"selection",id:"shiftUp2m"},{type:"selection",id:"shiftUp1m"},{type:"selection",id:"shiftUp4th"},{type:"selection",id:"shiftUp8th"},{type:"selection",id:"shiftUp12th"},{type:"selection",id:"shiftUp16th"},{type:"selection",id:"shiftUp24th"},{type:"selection",id:"shiftUp32nd"},{type:"selection",id:"shiftUp48th"},{type:"selection",id:"shiftUp64th"},{type:"selection",id:"shiftUp96th"},{type:"selection",id:"shiftUp192nd"}]},{type:"dropdown",title:"Down",options:[{type:"selection",id:"shiftDown4m"},{type:"selection",id:"shiftDown2m"},{type:"selection",id:"shiftDown1m"},{type:"selection",id:"shiftDown4th"},{type:"selection",id:"shiftDown8th"},{type:"selection",id:"shiftDown12th"},{type:"selection",id:"shiftDown16th"},{type:"selection",id:"shiftDown24th"},{type:"selection",id:"shiftDown32nd"},{type:"selection",id:"shiftDown48th"},{type:"selection",id:"shiftDown64th"},{type:"selection",id:"shiftDown96th"},{type:"selection",id:"shiftDown192nd"}]}]},{type:"dropdown",title:"Quantize",options:[{type:"selection",id:"quantize4th"},{type:"selection",id:"quantize8th"},{type:"selection",id:"quantize12th"},{type:"selection",id:"quantize16th"},{type:"selection",id:"quantize24th"},{type:"selection",id:"quantize32nd"},{type:"selection",id:"quantize48th"},{type:"selection",id:"quantize64th"},{type:"selection",id:"quantize96th"}]},{type:"dropdown",title:"Timing",options:[{type:"selection",id:"convertSTOPS"},{type:"selection",id:"convertWARPS"},{type:"selection",id:"convertFAKES"},{type:"selection",id:"convertDELAYS"}]},{type:"separator"},{type:"selection",id:"setSongPreview"},{type:"separator"},{type:"selection",id:"exportNotedata"},{type:"separator"},{type:"selection",id:"selectBeforeCursor"},{type:"selection",id:"selectAfterCursor"},{type:"selection",id:"selectAll"}]},audio:{type:"menu",title:"Audio",options:[{type:"selection",id:"detectSync"},{type:"separator"},{type:"checkbox",id:"assistTick",checked:()=>y.audio.assistTick&&he.assist},{type:"checkbox",id:"metronome",checked:()=>y.audio.metronome&&he.assist},{type:"separator"},{type:"dropdown",title:()=>"Master Volume ("+Math.round(y.audio.masterVolume*100)+"%)",options:[{type:"selection",id:"volumeUp"},{type:"selection",id:"volumeDown"}]},{type:"dropdown",title:()=>"Song Volume ("+Math.round(y.audio.songVolume*100)+"%)",options:[{type:"selection",id:"songVolumeUp"},{type:"selection",id:"songVolumeDown"}]},{type:"dropdown",title:()=>"Effect Volume ("+Math.round(y.audio.soundEffectVolume*100)+"%)",options:[{type:"selection",id:"effectvolumeUp"},{type:"selection",id:"effectvolumeDown"}]},{type:"dropdown",title:()=>"Playback rate ("+Math.round(y.audio.rate*100)+"%)",options:[{type:"selection",id:"rateUp"},{type:"selection",id:"rateDown"},{type:"separator"},{type:"selection",id:"rateDefault"}]},{type:"separator"},{type:"selection",id:"showEq"}]},preferences:{type:"menu",title:"Preferences",options:[{type:"selection",id:"options"},{type:"selection",id:"themes"},{type:"selection",id:"keybinds"},{type:"selection",id:"gameplayKeybinds"},{type:"selection",id:"noteskinWindow"}]},help:{type:"menu",title:"Help",options:[{type:"selection",id:"about"},{type:"selection",id:"openGuide"},{type:"selection",id:"openChangelog"}]}},ic=["cut","copy","paste","pasteReplace"],nc={edit:[{ids:["delete"],after:"redo"},{ids:["toggleEditTiming","toggleAddTiming","previousNoteType","nextNoteType","noteTypeTap","noteTypeMine","noteTypeFake","noteTypeLift","quant4","quant8","quant12","quant16","quant24","quant32","quant48","quant64","quant96","quant192"],after:"mousePlacement"}],view:[{ids:["playback","selectRegion"]}],debug:[{ids:["showFPSCounter","showDebugTimers"]}]};class Zt extends st{static GROUPS;app;observer;searchDropdown;conflictMap=this.calculateConflicts();constructor(e){super({title:"Keybind Options",width:600,height:400,disableClose:!1,win_id:"keybind_options",blocking:!1}),this.app=e,Zt.GROUPS||(Zt.GROUPS=Zt.createGroups()),this.initView()}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("div");t.classList.add("pref-container");const n=document.createElement("div");n.classList.add("pref-search");const a=document.createElement("input");a.classList.add("pref-search-bar"),a.type="text",a.placeholder="Search for a keybind...",a.oninput=()=>{o.replaceChildren(...this.createSections(a.value)),l.replaceChildren(...this.createOptions(a.value))};const r=li.create(["Name","Key"],"Name");r.onChange(()=>{o.replaceChildren(...this.createSections(a.value)),l.replaceChildren(...this.createOptions(a.value))}),this.searchDropdown=r,n.replaceChildren(a,r.view);const s=document.createElement("div");s.classList.add("pref-scrollers");const o=document.createElement("div");o.classList.add("pref-section-scroller");const l=document.createElement("div");l.classList.add("pref-option-scroller"),s.replaceChildren(o,l),this.observer=new IntersectionObserver(u=>{u.forEach(f=>{const c=f.target.dataset.id,d=o.querySelector(`.pref-section[data-id=${c}]`);d&&(f.intersectionRatio>0?d.classList.add("selected"):d.classList.remove("selected"))})},{}),t.replaceChildren(n,s),o.replaceChildren(...this.createSections()),l.replaceChildren(...this.createOptions()),e.appendChild(t),this.viewElement.appendChild(e)}createSections(e=""){return Object.keys(Zt.GROUPS).filter(t=>Zt.GROUPS[t].some(n=>this.filterID(e,n))).map(t=>this.createEmptySection(rn[t]?.title??vo(t),t))}createOptions(e=""){return Object.keys(Zt.GROUPS).filter(t=>Zt.GROUPS[t].some(n=>this.filterID(e,n))).map(t=>{const n=Zt.GROUPS[t].filter(s=>this.filterID(e,s)).map(s=>this.createKeybindItem(s)),a=document.createElement("div");a.classList.add("pref-group"),a.dataset.id=t;const r=document.createElement("div");return r.classList.add("pref-group-label"),r.innerText=rn[t]?.title??vo(t),a.replaceChildren(r,...n),this.observer.observe(a),a})}static createGroups(){const e=Object.keys($e),t={};return Object.keys(rn).forEach(n=>{t[n]=this.expandMenubarOptions(rn[n]).map(a=>{const r=e.indexOf(a);return r!=-1&&e.splice(r,1),a}).filter(a=>!ic.includes(a))}),Object.keys(nc).forEach(n=>{t[n]===void 0&&(t[n]=[]),nc[n].forEach(a=>{let r=0;if(a.after){const s=t[n].findIndex(o=>a.after==o)+1;s!=0&&(r=s)}t[n].splice(r,0,...a.ids),a.ids.forEach(s=>{const o=e.indexOf(s);o!=-1&&e.splice(o,1)})})}),ic.forEach(n=>{const a=e.indexOf(n);a!=-1&&e.splice(a,1)}),e.length>0&&(console.warn("Missing keybinds not shown:"),console.warn(e)),t}filterID(e,t){if((this.searchDropdown?.value??"Name")=="Name")return($e[t].bindLabel??$e[t].label).toLowerCase().includes(e.toLowerCase());{const n=ve.getCombosForKeybind(t);if(n.some(r=>r.key.toLowerCase().includes(e.toLowerCase()))||n.some(r=>(Fu[r.key]??r.key).toLowerCase().includes(e.toLowerCase())))return!0;let a=e.split(" ").map(r=>r.toLowerCase());return n.some(r=>(a.includes("shift")||a.includes("⇧"))&&!r.mods.includes(_n.SHIFT)||(a.includes("ctrl")||a.includes("control")||a.includes("⌃"))&&!r.mods.includes(_n.CTRL)||(a.includes("meta")||a.includes("cmd")||a.includes("command")||a.includes("⌘"))&&!r.mods.includes(_n.META)||(a.includes("alt")||a.includes("⌥"))&&!r.mods.includes(_n.ALT)?!1:(a=a.filter(s=>!["shift","ctrl","control","meta","cmd","command","alt","⇧","⌃","⌘","⌥",""].includes(s)),a.length==0||a.length==1&&r.key.toLowerCase().includes(a[0])))}}static expandMenubarOptions(e){switch(e.type){case"menu":case"dropdown":return e.options.map(t=>this.expandMenubarOptions(t)).flat();case"selection":case"checkbox":return[e.id];case"separator":return[]}}createEmptySection(e,t){const n=document.createElement("div");return n.classList.add("pref-section"),n.dataset.id=t,n.innerText=e,n.onclick=()=>{n.parentElement.parentElement.querySelector(`.pref-group[data-id=${t}]`).scrollIntoView()},n}createKeybindItem(e){const t=document.createElement("div");t.classList.add("pref-keybind"),t.dataset.id=e,t.onclick=s=>{s.target.classList.contains("pref-keybind-combo")||t.querySelector(".icon")?.contains(s.target)||this.app.windowManager.openWindow(new un(this.app,!0,o=>{ve.setKeybind(e,o),this.conflictMap=this.calculateConflicts(),t.replaceWith(this.createKeybindItem(e))},o=>{const l=this.conflictMap.get(ve.getComboString(o))?.map(u=>u[0]).map(u=>$e[u].bindLabel??$e[u].label)??[];return l.includes(e)?"self":l}))};const n=document.createElement("div");n.classList.add("pref-keybind-label"),n.innerText=$e[e].bindLabel??$e[e].label;const a=pe.getIcon("REVERT");a.style.width="0.75rem",a.addEventListener("click",()=>{ve.revertKeybind(e),this.conflictMap=this.calculateConflicts(),t.replaceWith(this.createKeybindItem(e))}),a.style.display=ve.checkIsDefault(e)?"none":"block";const r=document.createElement("div");return r.classList.add("pref-keybind-combos"),r.replaceChildren(...ve.getCombosForKeybind(e).map(s=>{const o=document.createElement("button");return o.classList.add("pref-keybind-combo"),o.innerText=ve.getComboString(s),this.conflictMap.get(ve.getComboString(s)).length>1&&o.classList.add("conflict"),o.onclick=()=>{ve.removeKeybind(e,s),this.conflictMap=this.calculateConflicts(),t.replaceWith(this.createKeybindItem(e))},o})),t.replaceChildren(n,a,r),t}calculateConflicts(){const e=new Map;Object.keys($e).forEach(t=>{ve.getCombosForKeybind(t).forEach((n,a)=>{const r=ve.getComboString(n);e.has(r)||e.set(r,[]),e.get(r).push([t,a])})}),[...this.viewElement.querySelectorAll(".pref-keybind-combo.conflict")].forEach(t=>t.classList.remove("conflict"));for(const t of e.values())t.length!=1&&t.forEach(n=>{const a=this.viewElement.querySelector(`.pref-keybind[data-id=${n[0]}] .pref-keybind-combos`);a?.children[n[1]]&&a.children[n[1]].classList.add("conflict")});return e}onClose(){this.observer?.disconnect()}}class et{static noteskins=new Map;static register(e){for(const t of new Set(e.gameTypes))et.noteskins.has(t)||et.noteskins.set(t,new Map),et.noteskins.get(t).set(e.id,e)}static async getNoteskin(e,t){const n=this.noteskins.get(e.id);if(!n||n.size==0)return;const a=n.get(t)??[...n.values()][0];return n.get(t)||de.createFormatted(`Couldn't find the noteskin ${t}!`,"warn"),await a.load()}static getNoteskinData(e,t){const n=this.noteskins.get(e.id);return!n||n.size==0?void 0:n.get(t)??[...n.values()][0]}static getNoteskins(){return this.noteskins}static getPreviewUrl(e,t){return this.getNoteskinData(e,t).preview}}et.register({id:"default",gameTypes:["dance-single","dance-double","dance-couple","dance-solo","dance-solodouble","dance-threepanel","dance-threedouble"],load:async()=>(await We(async()=>{const{default:i}=await import("./Noteskin-B-7cmsou.js");return{default:i}},__vite__mapDeps([7,1,2,8]))).default,preview:new URL("/smeditor/assets/preview-OxO8T-xD.png",import.meta.url).href,title:"Scalable",subtitle:"Pete-Lawrence"});et.register({id:"cf-chrome",gameTypes:["dance-single","dance-double","dance-couple","dance-solo","dance-solodouble","dance-threepanel","dance-threedouble"],load:async()=>(await We(async()=>{const{default:i}=await import("./Noteskin-CV6tIjEK.js");return{default:i}},__vite__mapDeps([9,1,2,8]))).default,preview:new URL("/smeditor/assets/preview-Bd1omMHV.png",import.meta.url).href,title:"CF_CHROME",subtitle:"Pete-Lawrence"});et.register({id:"ddr-note",gameTypes:["dance-single","dance-double","dance-couple","dance-solo","dance-solodouble","dance-threepanel","dance-threedouble"],load:async()=>(await We(async()=>{const{default:i}=await import("./Noteskin-BGcgPKKW.js");return{default:i}},__vite__mapDeps([10,1,2,11,8]))).default,preview:new URL("/smeditor/assets/preview-DdYrG22o.png",import.meta.url).href,title:"DDR-Note",subtitle:"Pete-Lawrence"});et.register({id:"ddr-note-itg",gameTypes:["dance-single","dance-double","dance-couple","dance-solo","dance-solodouble","dance-threepanel","dance-threedouble"],load:async()=>(await We(async()=>{const{default:i}=await import("./Noteskin-B0YL7Wkd.js");return{default:i}},__vite__mapDeps([12,1,2,11,8]))).default,preview:new URL("/smeditor/assets/preview-mEgpRzfG.png",import.meta.url).href,title:"DDR-Note (ITG quants)",subtitle:"Pete-Lawrence"});et.register({id:"ddr-rainbow",gameTypes:["dance-single","dance-double","dance-couple"],load:async()=>(await We(async()=>{const{default:i}=await import("./Noteskin-CdjkZfmh.js");return{default:i}},__vite__mapDeps([13,1,2,11,8]))).default,preview:new URL("/smeditor/assets/preview-CSm_jZ6l.png",import.meta.url).href,title:"DDR-Rainbow",subtitle:"LemmaEOF"});et.register({id:"ddr-rainbow-itg",gameTypes:["dance-single","dance-double","dance-couple"],load:async()=>(await We(async()=>{const{default:i}=await import("./Noteskin-DvoQcEaB.js");return{default:i}},__vite__mapDeps([14,1,2,11,8]))).default,preview:new URL("/smeditor/assets/preview-BIggbhNp.png",import.meta.url).href,title:"DDR-Rainbow (ITG quants)",subtitle:"LemmaEOF"});et.register({id:"metal",gameTypes:["dance-single","dance-double","dance-couple","dance-solo","dance-solodouble","dance-threepanel","dance-threedouble"],load:async()=>(await We(async()=>{const{default:i}=await import("./Noteskin-Dx_FU4db.js");return{default:i}},__vite__mapDeps([15,1,2,8]))).default,preview:new URL("/smeditor/assets/preview-CGpd3Xps.png",import.meta.url).href,title:"Metal",subtitle:"Pete-Lawrence"});et.register({id:"pastel",gameTypes:["dance-single","dance-double","dance-couple","dance-solo","dance-solodouble","dance-threepanel","dance-threedouble"],load:async()=>(await We(async()=>{const{default:i}=await import("./Noteskin-OyPWN-Sa.js");return{default:i}},__vite__mapDeps([16,1,2,11,8]))).default,preview:new URL("/smeditor/assets/preview-D-gUhvzF.png",import.meta.url).href,title:"Pastel",subtitle:"halcyoniix"});et.register({id:"dividebyzero",gameTypes:["dance-single","dance-double","dance-couple","dance-solo","dance-solodouble","dance-threepanel","dance-threedouble"],load:async()=>(await We(async()=>{const{default:i}=await import("./Noteskin-DyJ2ONJL.js");return{default:i}},__vite__mapDeps([17,1,2,11,8]))).default,preview:new URL("/smeditor/assets/preview-BveM7vOk.png",import.meta.url).href,title:"DivideByZero",subtitle:"MinaciousGrace"});et.register({id:"subtractbyzero",gameTypes:["dance-single","dance-double","dance-couple","dance-solo","dance-solodouble","dance-threepanel","dance-threedouble"],load:async()=>(await We(async()=>{const{default:i}=await import("./Noteskin-CthdTHp6.js");return{default:i}},__vite__mapDeps([18,1,2,11,8]))).default,preview:new URL("/smeditor/assets/preview-0QJpt-dz.png",import.meta.url).href,title:"SubtractByZero",subtitle:"qwertyzoro/Vague"});et.register({id:"sm4",gameTypes:["dance-single","dance-double","dance-couple","dance-solo","dance-solodouble","dance-threepanel","dance-threedouble"],load:async()=>(await We(async()=>{const{default:i}=await import("./Noteskin-BAAn1Xj2.js");return{default:i}},__vite__mapDeps([19,1,2,11,8]))).default,preview:new URL("/smeditor/assets/preview-B57yH2sm.png",import.meta.url).href,title:"SM4",subtitle:"from SM4"});et.register({id:"sm4-bold",gameTypes:["dance-single","dance-double","dance-couple","dance-solo","dance-solodouble","dance-threepanel","dance-threedouble"],load:async()=>(await We(async()=>{const{default:i}=await import("./Noteskin-BjQBn6sD.js");return{default:i}},__vite__mapDeps([20,1,2,11,8]))).default,preview:new URL("/smeditor/assets/preview-WAGM24LC.png",import.meta.url).href,title:"SM4 Bold",subtitle:"from SM4"});et.register({id:"starlight-vivid",gameTypes:["dance-single","dance-double","dance-couple"],load:async()=>(await We(async()=>{const{default:i}=await import("./Noteskin-M8_jdGnS.js");return{default:i}},__vite__mapDeps([21,1,2,11,8]))).default,preview:new URL("/smeditor/assets/preview-Co7w1-gB.png",import.meta.url).href,title:"SLNEXXT-vivid",subtitle:"from STARLiGHT-NEXXT"});et.register({id:"default",gameTypes:["pump-single","pump-double","pump-couple","pump-versus","pump-halfdouble"],load:async()=>(await We(async()=>{const{default:i}=await import("./Noteskin-DZRb_M6o.js");return{default:i}},__vite__mapDeps([22,1,2,11,8]))).default,preview:new URL("/smeditor/assets/preview-ChWRgpap.png",import.meta.url).href,title:"Fiesta"});et.register({id:"fourv2",gameTypes:["pump-single","pump-double","pump-couple","pump-versus","pump-halfdouble"],load:async()=>(await We(async()=>{const{default:i}=await import("./Noteskin-ySwkfFaK.js");return{default:i}},__vite__mapDeps([23,1,2,11,8]))).default,preview:new URL("/smeditor/assets/preview-BC8deddd.png",import.meta.url).href,title:"FourV2",subtitle:"Jousway"});et.register({id:"prime",gameTypes:["pump-single","pump-double","pump-couple","pump-versus","pump-halfdouble"],load:async()=>(await We(async()=>{const{default:i}=await import("./Noteskin-BvtnRQRH.js");return{default:i}},__vite__mapDeps([24,1,2,11,8]))).default,preview:new URL("/smeditor/assets/preview-CIFre-Xk.png",import.meta.url).href,title:"Prime"});const tm="/smeditor/assets/preview-CAPSxB0Y.png";class im extends st{app;grid;lastGameType=null;constructor(e){super({title:"Noteskin Selection",width:600,height:400,disableClose:!1,win_id:"noteskin-selection",blocking:!1}),this.app=e,this.initView(),this.loadGrid(),le.on("chartLoaded",()=>{const t=e.chartManager.loadedChart.gameType.id;this.lastGameType!=t&&this.loadGrid()})}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("input");t.classList.add("pref-search-bar"),t.type="text",t.placeholder="Search for a noteskin...",t.oninput=()=>{this.filterGrid(t.value)};const n=document.createElement("div");n.classList.add("noteskin-grid"),this.grid=n,e.replaceChildren(t,n),this.viewElement.appendChild(e)}loadGrid(){if(this.grid.replaceChildren(),!this.app.chartManager.loadedChart)return;const e=this.app.chartManager.loadedChart.gameType;this.lastGameType=e.id;const t=et.getNoteskins().get(e.id);if(t)for(const[n,a]of t.entries()){const r=document.createElement("div"),s=document.createElement("img"),o=document.createElement("div"),l=document.createElement("div"),u=document.createElement("div");r.classList.add("noteskin-cell"),o.classList.add("noteskin-label"),l.classList.add("noteskin-title"),u.classList.add("noteskin-subtitle"),l.innerText=a.title??n,u.innerText=a.subtitle??"",s.src=et.getPreviewUrl(e,n),s.onerror=()=>{s.src=tm},r.replaceChildren(s,o),o.replaceChildren(l,u),this.grid.appendChild(r),n==y.chart.noteskin.name&&(r.classList.add("selected"),setTimeout(()=>{r.scrollIntoView({behavior:y.general.smoothAnimations?"smooth":"instant",block:"center"})})),r.dataset.id=n,r.dataset.title=a.title??"",r.dataset.subtitle=a.subtitle??"",r.onclick=()=>{y.chart.noteskin.name!=n&&(this.app.chartManager.chartView?.swapNoteskin(n),this.removeAllSelections(),r.classList.add("selected"))}}}removeAllSelections(){[...this.grid.querySelectorAll(".selected")].forEach(e=>e.classList.remove("selected"))}filterGrid(e){[...this.grid.children].forEach(t=>{if(!(t instanceof HTMLDivElement))return;const n=t,a=this.containsQuery(e,n.dataset.id)||this.containsQuery(e,n.dataset.title)||this.containsQuery(e,n.dataset.subtitle);n.style.display=a?"":"none"})}containsQuery(e,t){return t?t.toLowerCase().includes(e.trim().toLowerCase()):!1}}class nm extends st{app;metronomeInterval;startTime;me_high=new ys.Howl({src:Bc,volume:y.audio.soundEffectVolume});me_low=new ys.Howl({src:Fc,volume:y.audio.soundEffectVolume});tickLines=[];resultLines=[];previousOffsets=[];keyHandler;constructor(e){super({title:"Offset Adjuster",width:300,height:200,win_id:"offset",blocking:!0}),this.app=e,this.initView(),this.startTime=performance.now();let t=this.startTime+500;this.tickLines.push({time:t+500,beat:0}),this.tickLines.push({time:t+500*2,beat:1}),this.tickLines.push({time:t+500*3,beat:2}),this.tickLines.push({time:t+500*4,beat:3});let n=0;this.metronomeInterval=setInterval(()=>{const a=performance.now();if(a-t>500){for(t=a,(n%4==0?this.me_high:this.me_low).play();this.tickLines[0]?.time+1e3<a;)this.tickLines.shift();this.tickLines.push({time:t+500*4,beat:n+4}),n++}this.resultLines=this.resultLines.filter(r=>a-r.startTime<8e3)},5),this.keyHandler=a=>{if(a.code.startsWith("Digit")||a.code.startsWith("Key")||a.code=="Space"){let r=this.tickLines[0];const s=performance.now();for(const l of this.tickLines)if(s-l.time+y.play.offset*1e3<300){r=l;break}a.preventDefault();const o=s-r.time+y.play.offset*1e3;o>-300&&(this.tickLines.splice(this.tickLines.indexOf(r),1),this.resultLines.push({startTime:performance.now(),offset:o}),this.previousOffsets.push(o),this.previousOffsets.length==16&&(_c(this.previousOffsets)<70&&(y.play.offset-=Ia(this.previousOffsets)/1e3),this.previousOffsets=[]))}},window.addEventListener("keydown",this.keyHandler)}initView(){this.viewElement.replaceChildren();const e=document.createElement("canvas");this.viewElement.appendChild(e);const t=this.drawEQ(e);requestAnimationFrame(t)}drawEQ(e){const t=e.getContext("2d");t.canvas.width=250,t.canvas.height=100;const n=()=>{t.fillStyle="rgba(0, 0, 0, 1)",t.fillRect(0,0,e.width,e.height),t.fillStyle="rgb(255, 255, 255)",t.fillRect(e.width/2-1,8,2,e.height-16);const a=performance.now();for(const r of this.resultLines){t.fillStyle="rgba(255, 255, 255, 1)";const s=Math.min(1,4-(a-r.startTime)/2e3);if(r.offset<0&&(t.fillStyle=`rgba(160, ${xt(160,0,-r.offset/250)}, ${xt(160,0,-r.offset/250)}, ${s})`),r.offset>0&&(t.fillStyle=`rgba(${xt(160,0,r.offset/250)}, ${xt(160,0,r.offset/250)}, 160, ${s})`),t.fillRect(e.width/2-.5+r.offset/4,12,1,e.height-24),a-r.startTime<250){const o=(a-r.startTime)/250;t.globalAlpha=1-o,t.fillRect(e.width/2-.5-o*3+r.offset/4,12-o*10,1+o*6,e.height-24+o*20)}t.globalAlpha=1}for(const r of this.tickLines){const s=r.time-a-y.play.offset*1e3;t.fillStyle="rgba(255, 255, 255, 0.8)",r.beat%4!=0?t.fillRect(e.width/2-1-s/4,12,2,e.height-24):t.fillRect(e.width/2-2-s/4,12,4,e.height-24)}e.closest("#windows")&&requestAnimationFrame(n)};return n}onClose(){clearInterval(this.metronomeInterval),window.removeEventListener("keydown",this.keyHandler)}}class am extends st{app;changeHandler=()=>this.initView();constructor(e){super({title:"Song Properties",width:450,height:486,disableClose:!1,win_id:"sm_properties",blocking:!1}),this.app=e,this.initView(),le.on("smLoaded",this.changeHandler),le.on("undo",this.changeHandler),le.on("redo",this.changeHandler)}onClose(){le.off("smLoaded",this.changeHandler),le.off("undo",this.changeHandler),le.off("redo",this.changeHandler)}initView(){this.viewElement.replaceChildren(),this.viewElement.classList.add("sm-properties");const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("div");t.classList.add("label"),t.innerText="Apply to",Mu.forEach(n=>{const a=document.createElement("div");a.classList.add("sm-container");const r=document.createElement("div");r.classList.add("sm-title"),r.innerText=n.title;const s=document.createElement("div");s.classList.add("property-grid"),n.items.forEach(o=>{const l=document.createElement("div");l.classList.add("label"),l.innerText=o.title,s.appendChild(l),s.appendChild(Du(this.app,this.app.chartManager.loadedSM,Lt.instance,o))}),a.appendChild(r),a.appendChild(s),e.appendChild(a)}),this.viewElement.appendChild(e)}}var ls,ac;function rm(){if(ac)return ls;ac=1,ls=s;var i=8192,e=65536,t=new ArrayBuffer(e*4),n=new Float64Array(t,e,i),a=new Float64Array(t,e*2,i/2),r=o({Math,Float64Array},null,t);function s(l){if(!l)throw Error("Input data is not provided, pass an array.");var u=l.length;if(u>i)throw Error("Input length is too big, must be under "+i);var f=Math.floor(Math.log(u)/Math.LN2);if(Math.pow(2,f)!==u)throw Error("Invalid array size, must be a power of 2.");return n.set(l),r(u,f),a.subarray(0,u/2)}function o(l,u,f){var c=6.283185307179586,d=l.Math.sqrt,h=l.Math.sin,p=l.Math.cos,m=l.Math.abs,g=l.Math.SQRT1_2,b=l.Math.imul,x=new l.Float64Array(f),v=new l.Float64Array(f),C=8192,E=16384;function R(H,N){H=H|0,N=N|0;var K=0,ae=0,T=0,W=0,w=0,M=0,G=0,B=0,D=0,V=0,X=0,P=0,F=0,ne=0,ie=0,ee=0,ke=0,Oe=0,we=0,ge=0,Te=0,Le=0,nt=0,at=0,_=0,Z=0,q=0,S=0,k=0,z=0,j=0,J=0;for(K=H>>>1,T=2/+(H|0),O(H),z=0,J=4;(z|0)<(H|0);J=b(J,4)){for(j=z;(j|0)<(H|0);j=j+J|0)ge=v[j<<3>>3]-v[j+1<<3>>3],v[j<<3>>3]=v[j<<3>>3]+v[j+1<<3>>3],v[j+1<<3>>3]=ge;z=b(2,J-1)}for(W=2,G=H>>>1;G=G>>>1;){z=0,W=W<<1,J=W<<1,w=W>>>2,M=W>>>3;do{if((w|0)!=1)for(j=z;(j|0)<(H|0);j=j+J|0)P=j,F=P+w|0,ne=F+w|0,ie=ne+w|0,B=v[ne<<3>>3]+v[ie<<3>>3],v[ie<<3>>3]=v[ie<<3>>3]-v[ne<<3>>3],v[ne<<3>>3]=v[P<<3>>3]-B,v[P<<3>>3]=v[P<<3>>3]+B,P=P+M|0,F=F+M|0,ne=ne+M|0,ie=ie+M|0,B=v[ne<<3>>3]+v[ie<<3>>3],D=v[ne<<3>>3]-v[ie<<3>>3],B=-B*g,D=D*g,ge=+v[F<<3>>3],v[ie<<3>>3]=B+ge,v[ne<<3>>3]=B-ge,v[F<<3>>3]=v[P<<3>>3]-D,v[P<<3>>3]=v[P<<3>>3]+D;else for(j=z;(j|0)<(H|0);j=j+J|0)P=j,F=P+w|0,ne=F+w|0,ie=ne+w|0,B=v[ne<<3>>3]+v[ie<<3>>3],v[ie<<3>>3]=v[ie<<3>>3]-v[ne<<3>>3],v[ne<<3>>3]=v[P<<3>>3]-B,v[P<<3>>3]=v[P<<3>>3]+B;z=(J<<1)-W|0,J=J<<2}while((z|0)<(H|0));for(_=c/+(W|0),ae=1;(ae|0)<(M|0);ae=ae+1|0){Z=+(ae|0)*_,Le=h(Z),Te=p(Z),nt=4*Te*(Te*Te-.75),at=4*Le*(.75-Le*Le),z=0,J=W<<1;do{for(j=z;(j|0)<(H|0);j=j+J|0)P=j+ae|0,F=P+w|0,ne=F+w|0,ie=ne+w|0,ee=j+w-ae|0,ke=ee+w|0,Oe=ke+w|0,we=Oe+w|0,D=v[Oe<<3>>3]*Te-v[ne<<3>>3]*Le,B=v[Oe<<3>>3]*Le+v[ne<<3>>3]*Te,X=v[we<<3>>3]*nt-v[ie<<3>>3]*at,V=v[we<<3>>3]*at+v[ie<<3>>3]*nt,ge=D-X,D=D+X,X=ge,v[we<<3>>3]=D+v[ke<<3>>3],v[ne<<3>>3]=D-v[ke<<3>>3],ge=V-B,B=B+V,V=ge,v[ie<<3>>3]=V+v[F<<3>>3],v[Oe<<3>>3]=V-v[F<<3>>3],v[ke<<3>>3]=v[P<<3>>3]-B,v[P<<3>>3]=v[P<<3>>3]+B,v[F<<3>>3]=X+v[ee<<3>>3],v[ee<<3>>3]=v[ee<<3>>3]-X;z=(J<<1)-W|0,J=J<<2}while((z|0)<(H|0))}}for(;K=K-1|0;)q=+v[K<<3>>3],S=+v[H-K-1<<3>>3],k=T*d(q*q+S*S),x[E+K<<3>>3]=k;x[E+0<<3>>3]=m(T*v[0])}function O(H){H=H|0;var N=0,K=0,ae=1,T=0,W=0;N=H>>>1,K=H-1|0,v[0]=x[C+0<<3>>3];do{for(T=T+N|0,v[ae<<3>>3]=x[C+T<<3>>3],v[T<<3>>3]=x[C+ae<<3>>3],ae=ae+1|0,W=N<<1;W=W>>1,((T=T^W)&W)==0;);(T|0)>=(ae|0)&&(v[ae<<3>>3]=x[C+T<<3>>3],v[T<<3>>3]=x[C+ae<<3>>3],v[K-ae<<3>>3]=x[C+K-T<<3>>3],v[K-T<<3>>3]=x[C+K-ae<<3>>3]),ae=ae+1|0}while((ae|0)<(N|0));v[K<<3>>3]=x[C+K<<3>>3]}return R}return ls}var sm=rm();const rc=Kn(sm),Rt=800,Qe=200,cs=3,gn=125,bn=250,da=3,om=.02,Qi=6,us=800,sc=15,Pt=32768,ds=[{frequency:20,weight:.4006009013520281},{frequency:25,weight:.4258037044922291},{frequency:31.5,weight:.4536690484291709},{frequency:40,weight:.4840856831659204},{frequency:50,weight:.5142710208279764},{frequency:63,weight:.5473453749315819},{frequency:80,weight:.5841121495327103},{frequency:100,weight:.6214074879602299},{frequency:125,weight:.6601749463607856},{frequency:160,weight:.7054673721340388},{frequency:200,weight:.7489234225800412},{frequency:250,weight:.7936507936507937},{frequency:315,weight:.8406893652795292},{frequency:400,weight:.889284126278346},{frequency:500,weight:.9291521486643438},{frequency:630,weight:.9675858732462506},{frequency:800,weight:.9985022466300548},{frequency:1e3,weight:.9997500624843789},{frequency:1250,weight:.9564801530368244},{frequency:1600,weight:.9409550693954364},{frequency:2e3,weight:1.0196278358399185},{frequency:2500,weight:1.0955902492467817},{frequency:3150,weight:1.1232799775344005},{frequency:4e3,weight:1.0914051841746248},{frequency:5e3,weight:.9997500624843789},{frequency:6300,weight:.8727907484180668},{frequency:8e3,weight:.7722007722007722},{frequency:1e4,weight:.7369196757553427},{frequency:12500,weight:.7768498737618955},{frequency:16e3,weight:.7698229407236336},{frequency:2e4,weight:.4311738708634257},{frequency:22550,weight:.2},{frequency:25e3,weight:0}];class Bu extends st{app;onAudioLoad=this.reset.bind(this);onResize=this.resize.bind(this);windowStep=512;fftSize=1024;tempoFftSize=4096;tempoStep=2;monoAudioData;audioLength=0;sampleRate=44100;tempogram=[];tempogramGroups=[];spectrogram=[];spectrogramDifference=[];noveltyCurve=[];noveltyCurveIsolated=[];spectrogramCanvases=[];lowestFinishedBlock=0;numRenderedBlocks=0;peaks=[];_threshold=.3;spectroHeights=[];spectroWeights=[];placeNotesSelectionButton;toggleButton;resetButton;onsetResults;offsetTableLabel;offsetRows=[];bpmRows=[];covers=[];doAnalysis=!1;lastSecond=0;constructor(e){super({title:"Detect Audio Sync",width:400,height:450,win_id:"detect-sync"}),this.app=e,this.initView(),this.reset(),le.on("audioLoaded",this.onAudioLoad),le.on("resize",this.onResize)}onClose(){le.off("audioLoaded",this.onAudioLoad),le.off("resize",this.onResize),this.app.chartManager.chartAudio.offLoad(this.onAudioLoad)}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("sync-container"),e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="center";const t=document.createElement("canvas");t.style.width=`${Rt/2/16}rem`,t.style.height=`${Qe/16}rem`;const n=document.createElement("div");n.classList.add("sync-tab-container");const a=document.createElement("div");a.classList.add("sync-tab-option","active"),a.innerText="Analysis Options";const r=document.createElement("div");r.classList.add("sync-tab-option"),r.innerText="Tempo Results";const s=document.createElement("div");s.classList.add("sync-tab-option"),s.innerText="Onset Results",n.replaceChildren(a,r,s),[...n.children].forEach((m,g)=>{m.onclick=()=>{const b=parseFloat(getComputedStyle(document.body.parentElement).fontSize);l.scrollLeft=370*b/16*g,n.querySelectorAll(".active").forEach(x=>x.classList.remove("active")),m.classList.add("active")}});const o=document.createElement("div");o.classList.add("sync-tab-view");const l=document.createElement("div");l.classList.add("sync-tab-scroller");const u=this.createOptionsView(),f=this.createTempoView(),c=this.createOnsetsView(),d=(m,g)=>{const b=document.createElement("div");return b.classList.add("sync-cover"),b.innerText=m,b.style.left=`${g*370/16}rem`,b};this.covers=[d("Clear analysis results to edit",0),d("Start analysis to view",1),d("Start analysis to view",2)],o.appendChild(l),l.replaceChildren(u,this.covers[0],f,this.covers[1],c,this.covers[2]);const h=document.createElement("div");h.classList.add("sync-bottom-container"),this.resetButton=document.createElement("button"),this.resetButton.classList.add("delete"),this.resetButton.innerText="Clear results",this.resetButton.style.width="7.5rem",this.resetButton.disabled=!0,this.resetButton.onclick=()=>{this.resetButton.disabled=!0,a.click(),this.reset()},this.toggleButton=document.createElement("button"),this.toggleButton.innerText="Start analyzing",this.toggleButton.style.width="12.5rem",this.toggleButton.onclick=()=>{this.doAnalysis||r.click(),this.doAnalysis=!this.doAnalysis,this.toggleButton.innerText=this.doAnalysis?"Stop analyzing":this.hasData()?"Resume analyzing":"Start analyzing",this.resetButton.disabled=this.doAnalysis},h.replaceChildren(this.toggleButton,this.resetButton),e.replaceChildren(t,n,o,h),this.viewElement.appendChild(e);const p=this.windowLoop(t);requestAnimationFrame(p)}resize(){const e=this.viewElement.querySelector(".sync-tab-option.active");if(!e)return;const t=[...e.parentElement.children].indexOf(e);if(t<0)return;const n=parseFloat(getComputedStyle(document.body.parentElement).fontSize);this.viewElement.querySelector(".sync-tab-scroller").scrollLeft=370*n/16*t}createOptionsView(){const e=document.createElement("div");e.style.display="flex",e.style.position="relative",e.style.flexDirection="column",e.style.gap="0.2rem",e.style.height="100%";const t=(u,f,c)=>{const d=document.createElement("div");d.style.display="flex",d.style.flexDirection="row",d.style.justifyContent="space-between",d.style.alignItems="center";const h=document.createElement("div");return h.classList.add("label"),h.innerText=u,d.replaceChildren(h,f),Ke(d,{content:c}),d},n=document.createElement("div");n.innerText="Onsets",n.style.fontWeight="600";const a=Si.create({min:Math.log2(128),max:Math.log2(8192),step:1,value:Math.log2(this.fftSize),transformer:u=>2**u,onChange:u=>{this.fftSize=2**u,this.windowStep>this.fftSize&&(this.windowStep=this.fftSize,r.setValue(u)),this.reset()}}),r=Si.create({min:Math.log2(128),max:Math.log2(8192),step:1,value:Math.log2(this.windowStep),transformer:u=>2**u,onChange:u=>{this.windowStep=2**u,this.windowStep>this.fftSize&&(this.windowStep=this.fftSize,r.setValue(Math.log2(this.fftSize))),this.reset()}}),s=document.createElement("div");s.innerText="Tempo",s.style.fontWeight="600",s.style.marginTop="1rem";const o=Si.create({min:Math.log2(128),max:Math.log2(8192),step:1,value:Math.log2(this.tempoFftSize),transformer:u=>2**u,onChange:u=>{this.tempoStep=2**u,this.tempoStep>this.tempoFftSize&&(this.tempoStep=this.tempoFftSize,l.setValue(u)),this.reset()}}),l=Si.create({min:Math.log2(1),max:Math.log2(1024),step:1,value:Math.log2(this.tempoStep),transformer:u=>2**u,onChange:u=>{this.tempoStep=2**u,this.tempoStep>this.tempoFftSize&&(this.tempoStep=this.tempoFftSize,l.setValue(Math.log2(this.tempoFftSize))),this.reset()}});return e.replaceChildren(n,t("FFT Size",a.view,"Determines the amount of audio to analyze at every block. Higher values result in more accurate frequencies, while lower values result in more accurate timings. Defaults to 1024."),t("Window Step",r.view,"Determines the number of blocks per second. Lower values result in more time-accurate spectrograms, but may take more time and mess up tempo analysis. Defaults to 512 and must be lower than FFT Size."),s,t("FFT Size",o.view,"Determines the amount of the onset graph to analyze at every block. Higher values result in more accurate tempos, while lower values result in more accurate timings. Defaults to 4096."),t("Window Step",l.view,"Determines the number of blocks per second. Lower values result in more time-accurate tempograms, but may take more time. Defaults to 2 and must be lower than FFT Size.")),e}createTempoView(){const e=document.createElement("div");e.style.display="flex",e.style.position="relative",e.style.gap="0.625m";const t=document.createElement("div");t.style.flex="1";const n=document.createElement("div");n.classList.add("sync-table-label"),n.innerText="Offsets",this.offsetTableLabel=n;const a=document.createElement("table");a.classList.add("sync-table");const r=document.createElement("tr"),s=document.createElement("th");s.innerText="Offset";const o=document.createElement("th");o.innerText="Confidence",r.replaceChildren(s,o),a.appendChild(r),t.replaceChildren(n,a);const l=document.createElement("div");l.style.flex="1";const u=document.createElement("div");u.classList.add("sync-table-label"),u.innerText="Current Tempos";const f=document.createElement("table");f.classList.add("sync-table");const c=document.createElement("tr"),d=document.createElement("th");d.innerText="BPM";const h=document.createElement("th");h.innerText="Confidence",c.replaceChildren(d,h),f.appendChild(c);for(let p=0;p<5;p++){const m=document.createElement("tr");m.classList.add("empty");const g=document.createElement("td");g.innerText="-";const b=document.createElement("td");b.innerText="-",m.replaceChildren(g,b),a.appendChild(m),this.offsetRows.push(m);const x=m.cloneNode(!0);f.appendChild(x),this.bpmRows.push(x),m.onclick=()=>{let v;try{v=parseFloat(g.innerText)}catch{return}const C=this.app.chartManager.loadedChart.timingData;C.hasChartOffset()?C.setOffset(v):C.songTimingData.setOffset(v)},x.onclick=()=>{let v;try{v=parseFloat(x.firstElementChild.innerText)}catch{return}const C=this.app.chartManager.loadedChart.timingData,E=Math.round(this.app.chartManager.beat*48)/48;C.insertColumnEvents([{type:"BPMS",beat:E,value:v}])}}return l.replaceChildren(u,f),e.replaceChildren(t,l),e}createOnsetsView(){const e=document.createElement("div");e.style.display="flex",e.style.flexDirection="column",e.style.gap="0.625rem",e.style.justifyContent="center",e.style.alignItems="center",e.style.position="relative";const t=document.createElement("div");t.style.display="flex",t.style.justifyContent="space-between",t.style.alignItems="center",t.style.width="100%",Ke(t,{content:"Adjust the threshold for a block to be considered an onset (red line)."});const n=document.createElement("div");n.innerText="Onset Threshold";const a=Si.create({min:0,max:1,step:.01,value:.3,onChange:u=>{this.threshold=u}}),r=document.createElement("div");r.style.color="#888888",r.style.fontStyle="italic",r.style.fontSize="0.75rem",r.style.marginBottom="1rem",r.style.marginTop="-0.375rem",r.innerText="Found 0 onsets",this.onsetResults=r,t.replaceChildren(n,a.view);const s=document.createElement("div");s.style.display="flex",s.style.justifyContent="space-between",s.style.alignItems="center",s.style.width="100%";const o=document.createElement("button");o.innerText="Place onsets as notes",o.onclick=()=>this.placeOnsets();const l=document.createElement("button");return l.innerText="Place onsets as notes in selection",l.disabled=!0,l.onclick=()=>this.placeOnsets(!0),this.placeNotesSelectionButton=l,s.replaceChildren(o,l),e.replaceChildren(t,r,s),e}async reset(){this._threshold=.3,this.doAnalysis=!1,this.toggleButton.disabled=!1,this.toggleButton.style.background="",this.toggleButton.innerText="Start analyzing",this.app.chartManager.chartAudio.onLoad(this.onAudioLoad),await this.getMonoAudioData(),this.sampleRate=this.app.chartManager.chartAudio.getSampleRate(),this.spectroHeights=new Array(this.fftSize).fill(0).map((t,n)=>{const a=n/(this.fftSize/2)*this.sampleRate/2,r=(n+1)/(this.fftSize/2)*this.sampleRate/2,s=Qe-Ae(Math.log(a/20)/Math.log(this.sampleRate/40)*Qe,0,Qe),o=Qe-Ae(Math.log(r/20)/Math.log(this.sampleRate/40)*Qe,0,Qe);return{y:o,height:s-o}}),this.spectroWeights=new Array(this.fftSize).fill(0).map((t,n)=>{const a=n/(this.fftSize/2)*this.sampleRate/2,r=ds.findIndex(l=>l.frequency>a);if(r<1)return 0;const s=ds[r-1],o=ds[r];return xt(s.weight,o.weight,vt(Math.log(1+s.frequency),Math.log(1+o.frequency),Math.log(1+a)))});const e=Math.max(1,Math.ceil(this.audioLength/this.windowStep));this.spectrogramCanvases=[];for(let t=0;t<Math.ceil(e/Pt);t++){const n=new OffscreenCanvas(Math.min(Pt,e-t*Pt),Qe*2);this.spectrogramCanvases.push(n)}this.spectrogram=[],this.lowestFinishedBlock=0,this.numRenderedBlocks=0,this.spectrogramDifference=[],this.noveltyCurve=[],this.noveltyCurveIsolated=[],this.peaks=[],this.tempogram=[],this.tempogramGroups=[],this.offsetTableLabel.innerText="Offsets",this.offsetRows.forEach(t=>{t.firstChild.innerText="-",t.lastChild.innerText="-",t.classList.add("empty")}),this.bpmRows.forEach(t=>{t.firstChild.innerText="-",t.lastChild.innerText="-",t.classList.add("empty")})}hasData(){return this.numRenderedBlocks>0}windowLoop(e){const t=e.getContext("2d");t.canvas.width=Rt,t.canvas.height=Qe*2,t.imageSmoothingEnabled=!1;const n=()=>{if(this.placeNotesSelectionButton.disabled=this.app.chartManager.startRegion===void 0||this.app.chartManager.endRegion===void 0||this.app.chartManager.startRegion==this.app.chartManager.endRegion,this.covers[0].classList.toggle("active",this.hasData()),this.covers[1].classList.toggle("active",!this.hasData()),this.covers[2].classList.toggle("active",!this.hasData()),!this.app.chartManager.chartAudio)return;const a=Math.ceil(this.audioLength/this.windowStep);if(this.monoAudioData!==void 0&&this.doAnalysis){const d=performance.now();for(;performance.now()-d<sc;){if(this.lowestFinishedBlock>=a){this.tempogram.length==0&&(this.toggleButton.disabled=!0,this.calcTempogram());break}this.spectrogram[this.lowestFinishedBlock]===void 0&&(this.renderBlock(this.lowestFinishedBlock),this.calcDifference(this.lowestFinishedBlock),this.calcIsolatedNovelty(this.lowestFinishedBlock),this.numRenderedBlocks++),this.lowestFinishedBlock++}this.lowestFinishedBlock<a&&(this.toggleButton.style.background=`linear-gradient(90deg, var(--accent-color) 0 ${this.lowestFinishedBlock/a*100}%, var(--input-bg) ${this.lowestFinishedBlock/a*100}% 100%)`,this.toggleButton.innerText=`Stop analyzing (${ue(this.lowestFinishedBlock/a*100,1)}%)`)}t.clearRect(0,0,e.width,e.height);const r=y.chart.speed/40,s=this.app.chartManager.time*this.sampleRate/this.windowStep-Rt*.2/r,o=this.app.chartManager.time*this.sampleRate/this.windowStep+Rt*.8/r;for(let d=Math.floor(s/Pt);d<=Math.floor(o/Pt);d++){const h=this.spectrogramCanvases[d];h&&t.drawImage(h,this.app.chartManager.time*this.sampleRate/this.windowStep-Rt*.2/r-Pt*d,0,Rt/r,Qe*2,0,0,Rt,Qe*2)}t.globalCompositeOperation="source-atop";let l;Ss(Be.getColor("primary-bg"))>.5?l=new L("white"):l=new L("black"),t.fillStyle=Jt(Be.getColor("accent-color"),l,.1).toHexa(),t.fillRect(0,0,e.width,e.height),t.globalCompositeOperation="destination-over",t.fillStyle=Jt(Be.getColor("accent-color"),l,.9).toHexa(),t.fillRect(0,0,e.width,e.height),t.globalCompositeOperation="source-over";const u=s*this.windowStep/this.sampleRate,f=o*this.windowStep/this.sampleRate;if(this.app.chartManager.loadedChart){const d=this.app.chartManager.loadedChart.getBeatFromSeconds(u),h=this.app.chartManager.loadedChart.getBeatFromSeconds(Math.min(f,this.app.chartManager.chartAudio.getSongLength()));t.fillStyle="rgba(255, 255, 255, 0.2)";for(const[p,m]of this.app.chartManager.loadedChart.timingData.getMeasureBeats(d,h)){const g=this.app.chartManager.loadedChart.getSecondsFromBeat(p);t.fillRect(vt(u,f,g)*Rt-(m?2:1),0,m?5:3,Qe*1.5)}}t.fillStyle="rgba(255, 0, 0, 0.3)";for(let d=Math.floor(s);d<=Math.ceil(o);d++)this.peaks[d]&&t.fillRect(vt(s,o,d)*Rt-.5,0,2,Qe*1.5);t.fillStyle="rgba(50, 255, 20, 0.3)",t.fillRect(Rt*.2-1,0,3,Qe*2),t.fillStyle="rgba(255, 0, 255, 0.5)",t.fillRect(0,Qe*1.5-this._threshold*Qe*.5,Rt,1);const c=Math.round(this.app.chartManager.time*this.sampleRate/this.windowStep/this.tempoStep);if(t.fillStyle=Be.getColor("accent-color").toHex(),t.textAlign="right",t.textBaseline="top",t.font="22px Assistant",t.fillText(`${this.numRenderedBlocks}/${a} blocks rendered`,Rt-10,10),t.textAlign="right",t.textBaseline="middle",this.tempogramGroups[c]){const d=[];for(const h of this.tempogramGroups[c]){let p=0,m=0,g=0;for(let b=c-da;b<=c+da;b++){if(this.tempogramGroups[b]===void 0)continue;const x=this.tempogramGroups[b].find(v=>v.center<h.center+Qi&&v.center>h.center-Qi);x!==void 0&&(p+=x.groups[0].value,m+=x.avg,g++)}p/=g,m/=g,d.push({bpm:m,weight:h.groups[0].value,smoothedWeight:p})}d.sort((h,p)=>p.smoothedWeight-h.smoothedWeight);for(const h of d)h.weight<.01||(t.font=`${18+h.weight*300}px Assistant`,t.globalAlpha=Math.min(1,h.weight*100),t.fillText(ue(h.bpm,0)+"",200,xt(Qe*2,Qe*1.5,vt(gn,bn,h.bpm))));if(this.lastSecond!=this.app.chartManager.time){this.lastSecond=this.app.chartManager.time;const h=d.slice(0,5).reduce((p,m)=>p+m.smoothedWeight,0);for(let p=0;p<5;p++){const m=this.bpmRows[p],g=d[p]?.bpm,b=d[p]?.weight;m.classList.toggle("empty",g===void 0),m.firstChild.innerText=g===void 0?"-":Math.round(g).toString(),m.lastChild.innerText=b===void 0?"-":Math.round(b/h*100)+"%"}}}t.globalAlpha=1,t.font="22px Assistant",t.textAlign="left",t.textBaseline="top",t.fillText("Spectrogram",10,10),t.fillText("Onsets",10,Qe+10),t.fillText("Tempogram",10,Qe*1.5+10),e.closest("#windows")&&requestAnimationFrame(n)};return n}renderBlock(e){if(!this.monoAudioData)return;const t=new Float32Array(this.fftSize);t.set(this.monoAudioData.subarray(Math.max(0,e*this.windowStep-this.fftSize/2),e*this.windowStep+this.fftSize/2),-Math.min(0,e*this.windowStep-this.fftSize/2));for(let a=0;a<t.length;a++)t[a]*=.5*(1-Math.cos(Math.PI*2*(a/this.fftSize)));const n=rc(t).slice(0);for(let a=0;a<n.length;a++)n[a]=Math.log(1+1*n[a]);this.storeResponse(e,n)}calcDifference(e){const t=this.spectrogram[e].slice(0),n=this.spectrogram[e-1]?.slice(0)??new Float64Array(this.fftSize);for(let a=0;a<t.length;a++)t[a]=Math.max(0,t[a]-n[a])*this.spectroWeights[a];this.storeDifferenceResponse(e,t)}storeResponse(e,t){this.spectrogram[e]=t;const n=this.spectrogramCanvases[Math.floor(e/Pt)].getContext("2d");n.fillStyle="white",t.forEach((a,r)=>{const s=this.spectroHeights[r],o=Ae(a*2e3,0,255);n.globalAlpha=o/255,n.fillRect(e%Pt,s.y,1,s.height)}),n.globalAlpha=1}storeDifferenceResponse(e,t){this.spectrogramDifference[e]=t;const n=t.reduce((a,r)=>a+r,0);this.noveltyCurve[e]=n}calcIsolatedNovelty(e){for(let t=e-cs;t<=e;t++){if(t<0)continue;let n=0,a=0;for(let r=t-cs;r<=t+cs;r++)this.noveltyCurve[r]!==void 0&&(n+=this.noveltyCurve[r],a++);n/=a,this.storeIsolatedNovelty(t,Math.max(0,this.noveltyCurve[t]-n))}}storeIsolatedNovelty(e,t){this.noveltyCurveIsolated[e]=Math.log(1+t),Math.log(1+t)>this._threshold&&Math.log(1+t)>(this.noveltyCurveIsolated[e-1]??0)?(this.peaks[e-1]&&(this.peaks[e-1]=!1),this.peaks[e]=!0,this.onsetResults.innerText=`Found ${this.peaks.filter(r=>r).length} onsets`):this.peaks[e]=!1;const n=this.spectrogramCanvases[Math.floor(e/Pt)].getContext("2d"),a=Math.min(1,Math.log(1+t))*Qe*.5;n.fillStyle="white",n.fillRect(e%Pt,Qe*1.5-a,1,a)}async getMonoAudioData(){const e=this.app.chartManager.chartAudio;if(!e)return;const t=e.getBuffer(),n=new OfflineAudioContext(t.numberOfChannels,t.length,t.sampleRate),a=n.createBufferSource();a.buffer=t;const r=n.createChannelMerger(t.numberOfChannels);a.connect(r),r.connect(n.destination),a.start(),await n.startRendering().then(s=>{this.monoAudioData=s.getChannelData(0),this.audioLength=this.monoAudioData.length}).catch(()=>{de.createFormatted("Failed to load audio: audio rendering failed","error")})}get threshold(){return this._threshold}set threshold(e){this._threshold=e,this.peaks=this.noveltyCurveIsolated.map((t,n)=>t>this._threshold&&(this.noveltyCurveIsolated[n-1]??0)<this._threshold),this.onsetResults.innerText=`Found ${this.peaks.filter(t=>t).length} onsets`}calculateOffset(){const e=new Map;let t=0,n=0,a=0;for(let u=0;u<this.tempogramGroups.length;u++){const c=this.tempogramGroups[u].filter(d=>d.groups[0].value>=om);if(c.length!=0&&(n=u,c.forEach(d=>{let h=0,p=0;for(let g=u-da;g<=u+da;g++){if(this.tempogramGroups[g]===void 0)continue;const b=this.tempogramGroups[g].find(x=>x.center<d.center+Qi&&x.center>d.center-Qi);b!==void 0&&(p+=b.avg,h++)}const m=Math.round(p/h);e.has(m)||e.set(m,0),e.set(m,e.get(m)+1),e.get(m)>t&&(t=e.get(m),a=m)}),t>50))break}if(a==0)return;const r=60/a*(this.sampleRate/this.windowStep),s=new Array(us).fill(0).map((u,f)=>{const c=f%r/r;let d=0,h=0;for(let p=1;p<=4;p++)h+=Math.max(1-Math.abs(Math.round(c*p)/p-c)*12,0)*1/p,d+=1/p;return h/d}),o=[];for(let u=n;u<n+r;u++){const f=this.noveltyCurveIsolated.slice(u,u+us).map((c,d)=>s[d]*c).reduce((c,d)=>c+d,0);o.push({block:u,offset:-(u*this.windowStep/this.sampleRate)%(60/a),response:f,curve:this.noveltyCurveIsolated.slice(u,u+us).map((c,d)=>s[d]*c)})}o.sort((u,f)=>f.response-u.response);const l=o.slice(0,5).reduce((u,f)=>u+f.response,0);this.offsetTableLabel.innerText=`Offsets (first BPM: ${a})`;for(let u=0;u<Math.min(o.length,5);u++){const f=this.offsetRows[u];f.classList.remove("empty"),f.firstChild.innerText=ue(o[u].offset,3).toString(),f.lastChild.innerText=Math.round(o[u].response/l*100)+"%"}}placeOnsets(e=!1){const t=this.peaks.map((n,a)=>{if(!n)return null;let r=this.app.chartManager.loadedChart.getBeatFromSeconds(a*this.windowStep/this.sampleRate);return r=Math.round(r*48)/48,r<0?null:{type:"Tap",beat:r,col:0}}).filter(n=>n!==null).filter(n=>e?n.beat>this.app.chartManager.startRegion&&n.beat<this.app.chartManager.endRegion:!0);this.app.chartManager.insertNotes(t)}calcTempogram(){let e=0;for(let s=0;s<this.noveltyCurveIsolated.length;s++)this.noveltyCurveIsolated[s]>e&&(e=this.noveltyCurveIsolated[s]);const t=new Float32Array(this.noveltyCurveIsolated.length);for(let s=0;s<this.noveltyCurveIsolated.length;s++)t[s]=this.noveltyCurveIsolated[s]/e;const n=Math.ceil(t.length/this.tempoStep);let a=performance.now();const r=s=>{const o=new Float32Array(this.tempoFftSize);o.set(t.subarray(Math.max(0,s*this.tempoStep-this.tempoFftSize/2),s*this.tempoStep+this.tempoFftSize/2),-Math.min(0,s*this.tempoStep-this.tempoFftSize/2));for(let u=0;u<o.length;u++)o[u]*=.5*(1-Math.cos(Math.PI*2*(u/this.tempoFftSize)));const l=rc(o).slice(0);for(let u=0;u<l.length;u++)l[u]=Math.log(1+1*l[u]);this.storeTempogram(s,l),s<n?performance.now()-a<sc?r(++s):(a=performance.now(),this.toggleButton.style.background=`linear-gradient(90deg, var(--accent-color) 0 ${s/n*100}%, var(--input-bg) ${s/n*100}% 100%)`,this.toggleButton.innerText=`Finding tempo (${ue(s/n*100,1)}%)`,setTimeout(()=>r(++s),1)):(this.calculateOffset(),this.spectrogram=[],this.noveltyCurve=[],this.tempogram=[],this.monoAudioData=void 0,this.toggleButton.innerText="Finished analyzing",this.resetButton.disabled=!1,this.doAnalysis=!1,this.toggleButton.style.background="var(--accent-color)")};r(0)}storeTempogram(e,t){const n=new Map,a=[];t.forEach((s,o)=>{let l=this.sampleRate*60/(this.windowStep*this.tempoFftSize)*o;if(!(l>bn*4||l<gn/4)){for(;l>bn&&l!=1/0;)l/=2;for(;l<gn&&l!=0;)l*=2;n.has(ue(l,3))||n.set(ue(l,3),0),n.set(ue(l,3),n.get(ue(l,3))+s)}}),this.tempogram[e]=[...n.entries()].map(([s,o])=>({bpm:s,value:o})).sort((s,o)=>o.value-s.value).filter(s=>s.value!=0);for(let s=0;s<Math.min(this.tempogram[e].length,10);s++){const o=this.tempogram[e][s],l=a.find(u=>u.center<o.bpm+Qi&&u.center>o.bpm-Qi);if(l===void 0){a.push({center:o.bpm,groups:[o]});continue}l.groups.push(o)}this.tempogramGroups[e]=a.map(s=>({...s,avg:s.groups.reduce((o,l)=>o+l.bpm*l.value,0)/s.groups.reduce((o,l)=>o+l.value,0)}));const r=this.spectrogramCanvases[Math.floor(e*this.tempoStep/Pt)].getContext("2d");r.fillStyle="white",this.tempogram[e].forEach(s=>{const o=Ae(s.value*8e3,0,255);r.globalAlpha=o/255,r.fillRect(e*this.tempoStep%Pt,xt(Qe*2,Qe*1.5,vt(gn,bn,s.bpm)),1*this.tempoStep,Qe*.5/(bn-gn))})}}class Ls extends st{app;grid;actions={};constructor(e){super({title:"Themes",width:600,height:400,disableClose:!1,win_id:"theme-selection",blocking:!1}),this.app=e,this.initView(),this.loadGrid()}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("div");t.classList.add("pref-search");const n=document.createElement("input");n.classList.add("pref-search-bar"),n.type="text",n.placeholder="Search for a theme...",n.oninput=()=>{this.filterGrid(n.value)},t.appendChild(n);const a=document.createElement("div");a.classList.add("theme-grid"),this.grid=a;const r=this.createOptionTray();e.replaceChildren(t,a,r),this.viewElement.appendChild(e)}createOptionTray(){const e=document.createElement("div");e.classList.add("theme-tray");const t=document.createElement("button");t.appendChild(pe.getIcon("PLUS",16)),t.appendChild(document.createTextNode("New")),t.onclick=()=>{const l=this.getNonConflictingName("new-theme");Be.createUserTheme(l),Be.loadTheme(l),this.loadGrid()},this.actions.add=t,e.appendChild(t);const n=document.createElement("button");n.appendChild(pe.getIcon("COPY",16)),n.appendChild(document.createTextNode("Duplicate")),n.onclick=()=>{const l=this.getNonConflictingName(y.general.theme);Be.createUserTheme(l,Be.getCurrentTheme()),Be.loadTheme(l),this.loadGrid()},n.disabled=!0,this.actions.copy=n,e.appendChild(n);const a=document.createElement("button");a.classList.add("confirm"),a.appendChild(pe.getIcon("EDIT",16)),a.appendChild(document.createTextNode("Edit")),a.onclick=()=>{this.closeWindow(),this.app.windowManager.openWindow(new jn(this.app))},a.disabled=!0,this.actions.edit=a,e.appendChild(a);const r=document.createElement("button");r.classList.add("delete"),r.appendChild(pe.getIcon("TRASH",16)),r.appendChild(document.createTextNode("Delete")),r.onclick=()=>{this.app.windowManager.openWindow(new $n(this.app,"Delete theme","Are you sure you want to delete this theme?",[{type:"default",label:"Cancel"},{type:"delete",label:"Delete",callback:()=>{Be.deleteUserTheme(y.general.theme),this.loadGrid()}}]))},r.disabled=!0,this.actions.del=r,e.appendChild(r);const s=document.createElement("button");s.appendChild(pe.getIcon("UPLOAD",16)),s.appendChild(document.createTextNode("Import")),s.onclick=async()=>{(await Cu({_preferPolyfill:!1,excludeAcceptAllOption:!1,multiple:!0,accepts:[{extensions:["txt"]}]})).forEach(u=>{u.getFile().then(f=>f.text()).then(f=>{const c=Be.parseThemeText(f);let d=Et(u.name,".txt");if(!c){de.createFormatted("Failed to load theme "+d,"error");return}d=this.getNonConflictingName(d),Be.createUserTheme(d,c),this.loadGrid()})})},this.actions.imp=s,e.appendChild(s);const o=document.createElement("button");return o.appendChild(pe.getIcon("DOWNLOAD",16)),o.appendChild(document.createTextNode("Export")),o.onclick=()=>{const l=Be.exportCurrentTheme({spaces:!0}),u=new File([l],y.general.theme+".txt",{type:"text/plain"}),f=document.createElement("a"),c=URL.createObjectURL(u);f.href=c,f.download=u.name,document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(c)},this.actions.exp=o,o.disabled=!0,e.appendChild(o),e}loadGrid(){this.grid.replaceChildren();const e=Be.getThemes();if(e)for(const[t,n]of Object.entries(e)){let a=t;const r=Oi[t]!==void 0,s=document.createElement("div"),o=document.createElement("div");if(o.classList.add("inlineEdit"),r)o.style.fontWeight="bold";else{o.contentEditable="true";let u=t;o.onfocus=()=>{u=o.innerText},o.onkeydown=f=>{f.key=="Enter"&&(o.blur(),f.preventDefault()),f.key=="Escape"&&(o.innerText=u,o.blur(),f.stopImmediatePropagation())},o.onblur=()=>{if(o.innerText==u)return;const f=this.getNonConflictingName(o.innerText);Be.renameUserTheme(u,f),Be.loadTheme(f),o.innerText=f,a=f,s.dataset.id=f}}const l=document.createElement("div");l.classList.add("theme-preview-grid");for(const u of Vh){const f=document.createElement("div");f.style.backgroundColor=n[u].toHex(),l.appendChild(f)}o.innerText=t,s.classList.add("theme-cell"),o.classList.add("theme-title"),s.replaceChildren(o,l),this.grid.appendChild(s),t==y.general.theme&&(s.classList.add("selected"),setTimeout(()=>{s.scrollIntoView({behavior:y.general.smoothAnimations?"smooth":"instant",block:"center"})}),this.actions.edit.disabled=r,this.actions.del.disabled=r,this.actions.copy.disabled=!1,this.actions.exp.disabled=!1),s.dataset.id=t,s.onclick=()=>{y.general.theme!=a&&(Be.loadTheme(a),this.removeAllSelections(),s.classList.add("selected"),this.actions.edit.disabled=r,this.actions.del.disabled=r,this.actions.copy.disabled=!1,this.actions.exp.disabled=!1)}}}removeAllSelections(){[...this.grid.querySelectorAll(".selected")].forEach(e=>e.classList.remove("selected"))}filterGrid(e){[...this.grid.children].forEach(t=>{if(!(t instanceof HTMLDivElement))return;const n=t,a=this.containsQuery(e,n.dataset.id);n.style.display=a?"":"none"})}containsQuery(e,t){return t?t.toLowerCase().includes(e.trim().toLowerCase()):!1}getNonConflictingName(e){const t=Be.getThemes();if(t[e]==null)return e;let n=2;const a=/([^]+)-(\d+)$/.exec(e);a&&(e=a[1],n=parseInt(a[2]));let r=`${e}-${n}`;for(;t[r]!==void 0;)r=`${e}-${n}`,n++;return r}}class jn extends st{app;pickers={};handlers=[];linkBlacklist=new Set;static isOpen=!1;constructor(e){super({title:"Theme Color Editor",width:500,height:400,win_id:"theme-editor",disableClose:!0}),this.app=e,this.initView(),jn.isOpen=!0}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("div");t.classList.add("theme-color-grid"),Wh.forEach(l=>{t.appendChild(this.createGroup(l))});const n=document.createElement("div");n.classList.add("menu-options");const a=document.createElement("div");a.classList.add("menu-left");const r=document.createElement("div");r.classList.add("menu-right"),n.appendChild(a),n.appendChild(r);const s=document.createElement("button");s.innerText="Cancel",s.onclick=()=>{this.closeWindow(),Be.loadTheme(y.general.theme),this.app.windowManager.openWindow(new Ls(this.app))},a.appendChild(s);const o=document.createElement("button");o.innerText="Save",o.classList.add("confirm"),o.onclick=()=>{Be.setUserTheme(y.general.theme,Be.getCurrentTheme()),Be.loadTheme(y.general.theme),this.app.windowManager.openWindow(new Ls(this.app)),this.closeWindow()},r.appendChild(o),e.replaceChildren(t,n),this.viewElement.appendChild(e)}createGroup(e){const t=document.createElement("div");t.classList.add("theme-group");const n=document.createElement("div");n.classList.add("theme-group-label"),n.innerText=e.name;const a=document.createElement("div");return a.classList.add("theme-picker-grid"),e.ids.forEach(r=>{a.appendChild(this.createPicker(r))}),t.replaceChildren(n,a),t}createPicker(e){const t=()=>{const f=new L(Be.getCurrentTheme()[e.id]);o.innerText=f.toHex()+" | "+Math.round(f.alpha*100)+"%",!l.isActive()&&(l.value=f)},n=f=>{const c=Be.getCurrentTheme();c[e.id]=f,Be._applyTheme(this.updateLinks(e.id,c))},a=document.createElement("div");a.classList.add("theme-color-cell"),El[e.id]!=""&&Ke(a,{content:El[e.id]});const r=qr[e.id];r&&(a.onmouseover=()=>{Object.keys(r).forEach(f=>{this.linkBlacklist.has(f)||this.pickers[f].classList.add("linked")})},a.onmouseout=()=>{Object.keys(r).forEach(f=>{this.pickers[f].classList.remove("linked")})});const s=document.createElement("div");s.innerText=e.label;const o=document.createElement("div");o.classList.add("theme-color-detail");const l=Ua.create({value:"white",width:30,height:30});l.onColorChange=n,a.replaceChildren(s,o,l);const u=this.getLink(e.id);if(u!==null){const f=document.createElement("div");f.classList.add("ico-checkbox");const c=pe.getIcon("LINK",16),d=pe.getIcon("LINK_BROKEN",16);let h=!0;const p=()=>{h?this.linkBlacklist.delete(e.id):this.linkBlacklist.add(e.id),c.style.display=h?"":"none",d.style.display=h?"none":""};f.onclick=()=>{h=!h,p()},Ke(f,{onShow(g){g.setContent(h?`Linked to ${u}`:"Unlinked")}}),Ke(f,{trigger:"click",onShow(g){g.setContent(h?`Linked to ${u}`:"Unlinked")}}),p(),f.replaceChildren(c,d),a.appendChild(f);const m=g=>{h&&(h=!1,p()),n(g)};l.onColorChange=m}return t(),le.on("themeChanged",t),this.handlers.push(t),this.pickers[e.id]=a,a}getLink(e){for(const[t,n]of Object.entries(qr))if(e in n)return t;return null}average(e){return(e.red+e.green+e.blue)/3}lighten(e,t){return new L(eo(new L(e).toNumber(),1+t/100))}add(e,t){return new L(Uh(new L(e).toNumber(),t))}updateLinks(e,t){const n=new Set,a=[e];for(;a.length!=0;){const r=a.shift(),s=qr[r];if(s)for(const[o,l]of Object.entries(s))this.linkBlacklist.has(o)||n.has(o)||(t[o]=l.bind(this)(t[r]),a.push(o),n.add(o))}return t}onClose(){jn.isOpen=!1}}const wa={precision:Cc,minPrecision:xi,value:0};function Ji(i){return{create:function(e){const t=lt.create({...wa,value:0,min:i=="WARPS"?0:-Number.MAX_VALUE,onchange:n=>{const a=e.chartManager.loadedChart.timingData,r=Math.round(e.chartManager.beat*48)/48;if(n==null){a.deleteColumnEvents([{type:i,beat:r}]);return}a.insertColumnEvents([{type:i,beat:r,value:n}])}});return this.data=[t],t.view},update:function(e,t){const n=this.data[0];if(document.activeElement==n.input)return;n.value=e.getOffset();const a=e.getEventAtBeat(i,t);let r=a?.value??0;Ku.getColumnType(i)=="instant"&&(!a||Math.abs(a.beat-t)>1/48)&&(r=0),n.value=r}}}const oc={offset:{title:"Offset",element:{create:function(i){const e=lt.create({...wa,step:y.general.spinnerStep/100,onchange:t=>{const n=i.chartManager.loadedChart.timingData;t!=null&&(n.hasChartOffset()?n.setOffset(t):n.songTimingData.setOffset(t))}});return this.data.push(e),e.view},update:function(i){const e=this.data[0];document.activeElement!=e.input&&(e.value=i.getOffset())}}},bpm:{title:"BPM",element:Ji("BPMS")},stop:{title:"Stop",element:Ji("STOPS")},delay:{title:"Delay",element:Ji("DELAYS")},warp:{title:"Warp",element:Ji("WARPS")},timeSig:{title:"Time Sig.",element:{create:function(i){const e=document.createElement("div");e.classList.add("flex-column-gap");const t=lt.create({value:4,step:1,precision:0,min:1,onchange:a=>{const r=i.chartManager.loadedChart.timingData,s=Math.round(i.chartManager.beat*48)/48;if(a==null){r.deleteColumnEvents([{type:"TIMESIGNATURES",beat:s}]);return}a<1||r.insertColumnEvents([{type:"TIMESIGNATURES",beat:s,upper:a,lower:n.value}])}}),n=lt.create({value:4,step:1,precision:0,min:1,onchange:a=>{const r=i.chartManager.loadedChart.timingData,s=Math.round(i.chartManager.beat*48)/48;if(a==null){r.deleteColumnEvents([{type:"TIMESIGNATURES",beat:s}]);return}a<1||r.insertColumnEvents([{type:"TIMESIGNATURES",beat:s,upper:t.value,lower:a}])}});return e.appendChild(t.view),e.appendChild(n.view),this.data=[t,n],e},update:function(i,e){const t=this.data[0],n=this.data[1],a=i.getEventAtBeat("TIMESIGNATURES",e),r=a?.upper??4,s=a?.lower??4;document.activeElement!=t.input&&(t.value=Math.round(r)),document.activeElement!=n.input&&(n.value=Math.round(s))}}},tick:{title:"Tickcount",element:{create:function(i){const e=lt.create({value:4,step:1,precision:0,min:0,onchange:t=>{const n=i.chartManager.loadedChart.timingData,a=Math.round(i.chartManager.beat*48)/48;if(t==null){n.deleteColumnEvents([{type:"TICKCOUNTS",beat:a}]);return}t<0||n.insertColumnEvents([{type:"TICKCOUNTS",beat:a,value:t}])}});return this.data=[e],e.view},update:function(i,e){const t=this.data[0];if(document.activeElement==t.input)return;const n=i.getEventAtBeat("TICKCOUNTS",e)?.value??4;t.value=Math.round(n)}}},combo:{title:"Combo",element:{create:function(i){const e=document.createElement("div");e.classList.add("flex-column-gap");const t=lt.create({value:1,step:1,precision:0,min:0,onchange:a=>{const r=i.chartManager.loadedChart.timingData,s=Math.round(i.chartManager.beat*48)/48;if(a==null){r.deleteColumnEvents([{type:"COMBOS",beat:s}]);return}a<0||r.insertColumnEvents([{type:"COMBOS",beat:s,hitMult:a,missMult:n.value}])}}),n=lt.create({value:1,step:1,precision:0,min:0,onchange:a=>{const r=i.chartManager.loadedChart.timingData,s=Math.round(i.chartManager.beat*48)/48;if(a==null){n.value=i.chartManager.loadedChart?.timingData.getEventAtBeat("COMBOS",s)?.missMult??1;return}a<0||r.insertColumnEvents([{type:"COMBOS",beat:s,hitMult:t.value,missMult:a}])}});return e.appendChild(t.view),e.appendChild(n.view),this.data=[t,n],e},update:function(i,e){const t=this.data[0],n=this.data[1],a=i.getEventAtBeat("COMBOS",e),r=a?.hitMult??1,s=a?.missMult??1;document.activeElement!=t.input&&(t.value=Math.round(r)),document.activeElement!=n.input&&(n.value=Math.round(s))}}},speed:{title:"Speed",element:{create:function(i){const e=document.createElement("div");e.classList.add("flex-column-gap");const t=()=>{const s=i.chartManager.loadedChart.timingData,o=Math.round(i.chartManager.beat*48)/48;s.insertColumnEvents([{type:"SPEEDS",beat:o,value:n.value,delay:a.value,unit:r.value=="Beats"?"B":"T"}])},n=lt.create({...wa,value:1,step:.1,onchange:s=>{const o=i.chartManager.loadedChart.timingData,l=Math.round(i.chartManager.beat*48)/48;if(s==null){o.deleteColumnEvents([{type:"SPEEDS",beat:l}]);return}t()}}),a=lt.create({...wa,value:1,step:.1,min:0,onchange:s=>{s==null||s<0||t()}}),r=li.create(["Beats","Time"],"Beats");return r.onChange(t),e.appendChild(n.view),e.appendChild(a.view),e.appendChild(r.view),this.data=[n,a,r],e},update:function(i,e){const t=this.data[0],n=this.data[1],a=this.data[2],r=i.getEventAtBeat("SPEEDS",e),s=r?.value??1,o=r?.delay??0,l=r?.unit=="B"?"Beats":"Time";document.activeElement!=t.input&&(t.value=s),document.activeElement!=n.input&&(n.value=o);const u=r&&Math.abs(r.beat-e)<1/48;n.disabled=!u,a.value!=l&&a.setSelected(l),a.disabled=!u}}},scroll:{title:"Scroll",element:Ji("SCROLLS")},fake:{title:"Fake",element:Ji("FAKES")},label:{title:"Label",element:{create:function(i){const e=document.createElement("input");return e.type="text",e.autocomplete="off",e.spellcheck=!1,e.onkeydown=t=>{t.key=="Enter"&&e.blur()},e.onblur=()=>{const t=i.chartManager.loadedChart.timingData,n=Math.round(i.chartManager.beat*48)/48;if(e.value==""){t.deleteColumnEvents([{type:"LABELS",beat:n}]);return}t.insertColumnEvents([{type:"LABELS",beat:n,value:e.value}])},this.data=[e],e},update:function(i,e){const t=this.data[0];if(document.activeElement==t)return;const a=i.getEventAtBeat("LABELS",e)?.value??"";t.value!=a&&(t.value=a)}}}};class lm extends st{app;lastBeat;interval;changeHandler=()=>this.setData();data={};constructor(e){super({title:"Edit Timing Data",width:300,height:340,disableClose:!1,win_id:"timing_data",blocking:!1}),this.app=e,this.lastBeat=Math.round(this.app.chartManager.beat*1e3)/1e3,this.initView(),this.interval=setInterval(()=>{Math.round(this.app.chartManager.beat*1e3)/1e3!=this.lastBeat&&(this.lastBeat=Math.round(this.app.chartManager.beat*1e3)/1e3,this.setData())},17),le.on("timingModified",this.changeHandler),le.on("chartLoaded",this.changeHandler)}onClose(){le.off("timingModified",this.changeHandler),clearInterval(this.interval)}initView(){this.viewElement.replaceChildren(),this.viewElement.classList.add("timing-data");const e=document.createElement("div");e.classList.add("padding"),Object.values(oc).forEach(t=>{const n=document.createElement("div");n.classList.add("label"),n.innerText=t.title,this.data[t.title]={data:[]};const a=t.element.create.bind(this.data[t.title])(this.app);e.appendChild(n),e.appendChild(a)}),this.viewElement.appendChild(e),this.setData()}setData(){this.app.chartManager.loadedChart&&Object.values(oc).forEach(e=>{e.element.update.bind(this.data[e.title])(this.app.chartManager.loadedChart.timingData,this.lastBeat)})}}const lc=[{type:"group",id:"app",label:"App",disable:()=>window.nw===void 0,children:[{type:"subgroup",children:[{type:"item",label:"Window Width",id:"app.width",input:{type:"number",step:50,min:300,precision:0,onChange:(i,e)=>{const t=nw.Window.get();t.isFullscreen||(t.width=e)}}},{type:"item",label:"Window Height",id:"app.height",input:{type:"number",step:50,min:300,precision:0,onChange:(i,e)=>{const t=nw.Window.get();t.isFullscreen||(t.height=e)}}}]},{type:"subgroup",children:[{type:"item",label:"Fullscreen",id:"app.fullscreen",input:{type:"checkbox",onChange:(i,e)=>{const t=nw.Window.get();e?nw.Window.get().enterFullscreen():(t.hide(),nw.Window.get().leaveFullscreen(),t.show())}}}]}]},{type:"group",id:"general",label:"General",children:[{type:"subgroup",children:[{type:"item",label:"UI Scale",id:"general.uiScale",input:{type:"number",min:30,step:10,precision:0,max:200,transformers:{serialize:i=>i*100,deserialize:i=>i/100},onChange:(i,e)=>{document.body.parentElement.style.fontSize=e*100+"%"}}},{type:"item",label:"Smooth Animations",id:"general.smoothAnimations",input:{type:"checkbox",onChange:(i,e)=>{e?document.body.classList.add("animated"):document.body.classList.remove("animated")}}},{type:"item",label:"Autosave interval",id:"general.autosaveInterval",input:{type:"slider",min:30,step:5,max:600,hardMin:15,hardMax:2**31-1},tooltip:"Interval in seconds between autosaves"},{type:"item",label:"Warn before exit",id:"general.warnBeforeExit",input:{type:"checkbox"},tooltip:"Warn before exiting the editor if you have unsaved changes."},{type:"item",label:"Spinner step",id:"general.spinnerStep",input:{type:"slider",min:0,step:.1,max:5,hardMin:0,hardMax:2**31-1},tooltip:"The default increment for all number spinners."}]}]},{type:"group",id:"chart",label:"Chart",children:[{type:"subgroup",label:"Note Placement",children:[{type:"subgroup",children:[{type:"item",label:"Enable mouse placement",id:"chart.mousePlacement",input:{type:"checkbox"}},{type:"item",label:"Directional hold placement behavior",id:"chart.defaultHoldPlacement",input:{type:"checkbox"},tooltip:"Changes the hold placement behavior. By default, holds can only be extended in one direction when placed. Turn this off to mimic the behavior of AV/Stepmania."},{type:"item",label:"Force snap notes",id:"chart.forceSnapNotes",input:{type:"checkbox"},tooltip:"Placing a note when not on a snap will force the note to be placed on the next snap. Useful for placing notes when playing."}]},{type:"subgroup",children:[{type:"item",label:"Zoom",id:"chart.zoom",input:{type:"slider",min:50,step:1,max:200,hardMax:2**31-1,transformers:{serialize:i=>i*100,deserialize:i=>i/100}}},{type:"item",label:"Reverse playfield",id:"chart.reverse",input:{type:"checkbox"}}]},{type:"subgroup",children:[{type:"item",label:"Allow receptor dragging",id:"chart.allowReceptorDrag",input:{type:"checkbox"},tooltip:"Allows the receptors to be dragged to move the playfield."},{type:"item",label:"X position",id:"chart.receptorXPos",input:{type:"slider",min:-400,max:400,hardMin:-2147483647,hardMax:2**31-1}},{type:"item",label:"Y position",id:"chart.receptorYPos",input:{type:"slider",min:-400,max:0,hardMin:-2147483647,hardMax:2**31-1}}]},{type:"subgroup",children:[{type:"item",label:"Draw length",id:"chart.maxDrawBeats",input:{type:"slider",min:0,max:30,hardMax:2**31-1},tooltip:"Maximum number of beats to draw notes. Increasing this works well for songs with high bpm but can affect performance. Only applies to XMod."},{type:"item",label:"Draw length past receptors",id:"chart.maxDrawBeatsBack",input:{type:"slider",min:0,max:30,hardMax:2**31-1},tooltip:"Maximum number of beats to draw notes past the receptors. Increasing this can affect performance. Only applies to XMod."}]},{type:"subgroup",children:[{type:"item",label:"Draw noteflashes",id:"chart.drawNoteFlash",input:{type:"checkbox"}},{type:"item",label:"Draw note icons",id:"chart.drawIcons",input:{type:"checkbox"},tooltip:"Draw indicators above notes that some noteskins may not differentiate, like Fakes and Lifts."}]}]},{type:"subgroup",label:"Scrolling",children:[{type:"item",label:"Scroll sensitivity",id:"chart.scroll.scrollSensitivity",input:{type:"slider",min:0,step:1,max:200,hardMax:2**31-1,transformers:{serialize:i=>i*100,deserialize:i=>i/100}},tooltip:"Adjust the scroll sensitivity when scrolling through the chart."},{type:"item",label:"Snap every scroll",id:"chart.scroll.scrollSnapEveryScroll",input:{type:"checkbox"},tooltip:"Whether each scroll movement corresponds to moving one snap unit when scrolling. Turning this on will have the same behavior as ArrowVortex. Recommended on for those using a mouse, off for those using trackpad."},{type:"item",label:"Invert scroll direction",id:"chart.scroll.invertScroll",input:{type:"checkbox"}},{type:"item",label:"Invert zoom in/out",id:"chart.scroll.invertZoomScroll",input:{type:"checkbox"},tooltip:"Inverts the zoom in/out control when scrolling."},{type:"item",label:"Invert scroll direction when in reverse",id:"chart.scroll.invertReverseScroll",input:{type:"checkbox"}}]},{type:"subgroup",label:"Waveform",children:[{type:"item",label:"Draw waveform",id:"chart.waveform.enabled",input:{type:"checkbox"}},{type:"subgroup",children:[{type:"item",label:"Color",id:"chart.waveform.color",input:{type:"color"}}]},{type:"subgroup",children:[{type:"item",label:"Draw filtered waveform",id:"chart.waveform.allowFilter",input:{type:"checkbox"}},{type:"item",label:"Filtered color",id:"chart.waveform.filteredColor",input:{type:"color"}}]},{type:"item",label:"Line height",id:"chart.waveform.lineHeight",input:{type:"slider",min:1,max:3,step:.1,hardMax:100},tooltip:"The height of each line of the waveform. Increasing this can help performance."},{type:"item",label:"Antialiasing",id:"chart.waveform.antialiasing",input:{type:"checkbox"}},{type:"item",label:"Allow speed changes",id:"chart.waveform.speedChanges",input:{type:"checkbox"},tooltip:"Allows the waveform to be affected by SPEEDS and SCROLLS."}]},{type:"subgroup",label:"Note Layout",children:[{type:"item",label:"Show Note Layout",id:"chart.noteLayout.enabled",input:{type:"checkbox"}}]},{type:"subgroup",label:"NPS Graph",children:[{type:"item",label:"Show NPS Graph",id:"chart.npsGraph.enabled",input:{type:"checkbox"}},{type:"subgroup",children:[{type:"item",label:"Start Color",id:"chart.npsGraph.color1",input:{type:"color"}},{type:"item",label:"End Color",id:"chart.npsGraph.color2",input:{type:"color"}}]}]}]},{type:"group",id:"audio",label:"Audio",children:[{type:"subgroup",children:[{type:"item",label:"Master volume",id:"audio.masterVolume",input:{type:"slider",min:0,step:1,max:100,hardMax:2**31-1,transformers:{serialize:i=>i*100,deserialize:i=>i/100}}},{type:"item",label:"Song volume",id:"audio.songVolume",input:{type:"slider",min:0,step:1,max:100,hardMax:2**31-1,transformers:{serialize:i=>i*100,deserialize:i=>i/100}}},{type:"item",label:"Sound effect volume",id:"audio.soundEffectVolume",input:{type:"slider",min:0,step:1,max:100,hardMax:2**31-1,transformers:{serialize:i=>i*100,deserialize:i=>i/100}}}]},{type:"subgroup",children:[{type:"item",label:"Enable assist tick",id:"audio.assistTick",input:{type:"checkbox"},tooltip:"Plays a sound when a note passes the receptors"},{type:"item",label:"Enable metronome",id:"audio.metronome",input:{type:"checkbox"}}]},{type:"subgroup",children:[{type:"item",label:"Allow filters to affect audio",id:"audio.allowFilter",input:{type:"checkbox",onChange:i=>{i.chartManager.chartAudio.reload()}}},{type:"item",label:"Enable metronome",id:"audio.metronome",input:{type:"checkbox"}}]}]},{type:"group",id:"play",label:"Play mode",children:[{type:"subgroup",label:"Calibration",children:[{type:"item",label:"Global offset",id:"play.offset",input:{type:"slider",min:-1,step:.001,max:1,hardMin:-2147483647,hardMax:2**31-1},tooltip:"Offset in seconds when playing a chart. Set to positive if you are hitting early and negative if you are hitting late."},{type:"item",label:"Sound effect offset",id:"play.effectOffset",input:{type:"slider",min:-1,step:.001,max:1,hardMin:-2147483647,hardMax:2**31-1},tooltip:"Offset in seconds when playing sound effects like assist tick and metronome."},{type:"item",label:"Visual offset",id:"play.visualOffset",input:{type:"slider",min:-1,step:.001,max:1,hardMin:-2147483647,hardMax:2**31-1},tooltip:"Offset in seconds when displaying notes."}]},{type:"subgroup",children:[{type:"item",label:"Judgement tilt",id:"play.judgementTilt",input:{type:"checkbox"},tooltip:"Tilts the judgement text left if you are hitting early and right if you are hitting late."},{type:"item",label:"Hide barlines during play",id:"play.hideBarlines",input:{type:"checkbox"}}]},{type:"subgroup",label:"Timing windows",children:[{type:"item",id:"play.timingCollection",label:"Timing window collection",input:{type:"dropdown",advanced:!1,get items(){return Object.keys(wt.getCollections())},onChange(i,e){const t=i.chartManager.loadedChart?.gameType.id;if(t)for(const n of Object.keys(y.play.defaultTimingCollections))t.startsWith(n)&&(y.play.defaultTimingCollections[n]=e)}}},{type:"item",id:"play.timingWindowScale",label:"Timing window scale",input:{type:"slider",min:0,step:.001,max:2,hardMax:2**31-1},tooltip:"Scales all timing windows by the given amount."},{type:"item",id:"play.timingWindowAdd",label:"Timing window add",input:{type:"slider",min:0,step:.001,max:1,hardMax:2**31-1},tooltip:"Adds this value (in seconds) to all timing windows."}]}]},{type:"group",id:"performance",label:"Performance",children:[{type:"item",label:"Antialiasing",id:"performance.antialiasing",input:{type:"checkbox"}},{type:"item",label:"Resolution",id:"performance.resolution",input:{type:"slider",min:1,step:1,max:4,hardMin:0,hardMax:2**31-1},tooltip:"Requires a reload."}]},{type:"group",id:"debug",label:"Debug",children:[{type:"item",label:"Show FPS",id:"debug.showFPS",input:{type:"checkbox"}},{type:"item",label:"Show rendering timers",id:"debug.showTimers",input:{type:"checkbox"}},{type:"item",label:"Show scrolls/speeds debug visual",id:"debug.showScroll",input:{type:"checkbox"}},{type:"item",label:"Show noteskin errors",id:"debug.showNoteskinErrors",input:{type:"checkbox"}}]}];class cm extends st{app;observer;sectionContainer;constructor(e){super({title:"Options",width:600,height:400,disableClose:!1,win_id:"user_options",blocking:!1}),this.app=e,this.initView(),le.on("resize",()=>{this.move(window.innerWidth/2-this.options.width/2*y.general.uiScale,window.innerHeight/2-this.options.height/2*y.general.uiScale)})}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("padding");const t=document.createElement("div");t.classList.add("pref-container");const n=document.createElement("div");n.classList.add("pref-search");const a=document.createElement("input");a.classList.add("pref-search-bar"),a.type="text",a.placeholder="Search for an option...",a.oninput=()=>{s.replaceChildren(),o.replaceChildren(...this.createOptions(this.filterOptions(a.value)))},n.appendChild(a);const r=document.createElement("div");r.classList.add("pref-scrollers");const s=document.createElement("div");s.classList.add("pref-section-scroller"),this.sectionContainer=s;const o=document.createElement("div");o.classList.add("pref-option-scroller"),r.replaceChildren(s,o),this.observer=new IntersectionObserver(l=>{l.forEach(u=>{const f=u.target.dataset.id,c=s.querySelector(`.pref-section[data-id=${f}]`);c&&(u.intersectionRatio>0?c.classList.add("selected"):c.classList.remove("selected"))})},{}),t.replaceChildren(n,r),s.replaceChildren(),o.replaceChildren(...this.createOptions(lc)),e.appendChild(t),this.viewElement.appendChild(e)}createOptions(e){return e.filter(t=>!t.disable?.(this.app)).map(t=>{const n=this.makeOption(t);return t.type=="group"&&(this.observer.observe(n),this.sectionContainer?.appendChild(this.createEmptyGroup(t))),n})}makeOption(e){const t=document.createElement("div");t.classList.add("pref-"+e.type),(e.type=="group"||e.type=="item")&&(t.dataset.id=e.id);const n=document.createElement("div");n.classList.add(`pref-${e.type}-label`,"label"),e.label!==void 0&&(n.innerText=e.label,t.appendChild(n));const a=pe.getIcon("REVERT",12);if(e.type=="item"&&(a.addEventListener("click",()=>{y.applyOption([e.id,y.getDefaultOption(e.id)]);const r=e.input.onChange;r?.(this.app,y.getDefaultOption(e.id)),t.replaceWith(this.makeOption(e))}),a.style.display=y.getDefaultOption(e.id)===y.getOption(e.id)?"none":"block",t.appendChild(a)),e.type=="item"){if(n.innerText=e.label,!e.input)return t;const r=y.getOption(e.id),s=e.input,o=s.onChange;s.onChange=(u,f)=>{y.applyOption([e.id,f]),a.style.display=y.getDefaultOption(e.id)===y.getOption(e.id)?"none":"block",o?.(u,f)};const l=Xc(this.app,s,r);e.input.type=="checkbox"&&l.classList.add("pref-input","right"),e.input.type=="dropdown"&&l.classList.add("pref-input","dropdown-right"),l.classList.add("pref-item-input"),t.appendChild(l)}else{const r=document.createElement("div");r.classList.add("pref-children"),t.appendChild(r),r.replaceChildren(...this.createOptions(e.children))}return e.type=="item"&&e.tooltip!==void 0&&Ke(t,{content:e.tooltip}),t}filterOptions(e,t=lc){const n=[];return t.forEach(a=>{if(a.label&&a.label.toLowerCase().includes(e.toLowerCase())){n.push(a);return}if(a.type=="group"||a.type=="subgroup"){const r=this.filterOptions(e,a.children);r.length!=0&&n.push({...a,children:r})}}),n}createEmptyGroup(e){const t=document.createElement("div");return t.classList.add("pref-section"),t.dataset.id=e.id,t.innerText=e.label,t.onclick=()=>{t.parentElement.parentElement.querySelector(`.pref-group[data-id=${e.id}]`).scrollIntoView()},t}onClose(){this.observer?.disconnect()}}var _n=(i=>(i.SHIFT="Shift",i.CTRL="Ctrl",i.ALT="Alt",i.META="Command",i))(_n||{});const tt=ni?"Command":"Ctrl",um={Shift:ni?"⇧":"Shift",Ctrl:ni?"⌃":"Ctrl",Alt:ni?"⌥":"Alt",Command:"⌘"},cc={ArrowLeft:"Left",ArrowUp:"Up",ArrowRight:"Right",ArrowDown:"Down",BracketLeft:"[",BracketRight:"]",Semicolon:";",Quote:"'",Backslash:"\\",Slash:"/",Period:".",Comma:",",Backquote:"`",Minus:"-",Equal:"+"},Fu={Home:ni?"fn Left":"Home",End:ni?"fn Right":"End",PageUp:ni?"fn Up":"PageUp",PageDown:ni?"fn Down":"PageDown"},Fa=["ctrlKey","altKey","shiftKey","metaKey"],va=["Ctrl","Alt","Shift","Command"],$e={playback:{label:"Play/Pause",combos:[{key:"Space",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==$.Play||i.chartManager.getMode()==$.Record,callback:i=>i.chartManager.playPause()},decreaseSnap:{label:"Decrease snap",combos:[{key:"Left",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==$.Play||i.chartManager.getMode()==$.Record,callback:i=>i.chartManager.previousSnap()},increaseSnap:{label:"Increase snap",combos:[{key:"Right",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==$.Play||i.chartManager.getMode()==$.Record,callback:i=>i.chartManager.nextSnap()},cursorUp:{label:"Move cursor up",combos:[{key:"Up",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==$.Play||i.chartManager.getMode()==$.Record,callback:i=>{y.chart.scroll.invertReverseScroll&&y.chart.reverse?i.chartManager.snapToNextTick():i.chartManager.snapToPreviousTick()}},cursorDown:{label:"Move cursor down",combos:[{key:"Down",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==$.Play||i.chartManager.getMode()==$.Record,callback:i=>{y.chart.scroll.invertReverseScroll&&y.chart.reverse?i.chartManager.snapToPreviousTick():i.chartManager.snapToNextTick()}},increaseScrollSpeed:{label:"Increase scroll speed",combos:[{key:"Up",mods:["Shift"]}],disabled:i=>!i.chartManager.chartView,callback:()=>y.chart.speed=Math.max(10,y.chart.speed*Math.pow(1.01,30))},decreaseScrollSpeed:{label:"Decrease scroll speed",combos:[{key:"Down",mods:["Shift"]}],disabled:i=>!i.chartManager.chartView,callback:()=>y.chart.speed=Math.max(10,y.chart.speed*Math.pow(1.01,-30))},zoomIn:{label:"Zoom in",combos:[{key:"+",mods:[tt]}],disabled:i=>!i.chartManager.chartView,callback:()=>{y.chart.zoom+=.1,de.create("Zoom: "+Math.round(y.chart.zoom*100)+"%")}},zoomOut:{label:"Zoom out",combos:[{key:"-",mods:[tt]}],disabled:i=>!i.chartManager.chartView,callback:()=>{y.chart.zoom=Math.max(.1,y.chart.zoom-.1),de.create("Zoom: "+Math.round(y.chart.zoom*100)+"%")}},zoomDefault:{label:"Reset zoom",combos:[{key:"0",mods:[tt]}],disabled:i=>!i.chartManager.chartView,callback:()=>{y.chart.zoom=1,de.create("Zoom: "+Math.round(y.chart.zoom*100)+"%")}},newSong:{label:"New song...",bindLabel:"New song",combos:[{key:"N",mods:[tt]}],disabled:i=>!i.chartManager.loadedSM||!he.openWindows,callback:i=>{i.windowManager.openWindow(new Lu(i))}},openSong:{label:"Open song...",bindLabel:"Open song",combos:[{key:"O",mods:[tt]}],disabled:i=>!i.chartManager.loadedSM||!he.openWindows,callback:i=>{if(window.nw){const e=document.createElement("input");e.type="file",e.accept=".sm,.ssc",e.onchange=()=>i.chartManager.loadSM(e.value),e.click()}else i.windowManager.openWindow(new po(i,!1))}},songProperties:{label:"Song properties...",bindLabel:"Open song properties",combos:[{key:"O",mods:["Shift"]}],disabled:i=>!i.chartManager.loadedSM||!he.openWindows,callback:i=>i.windowManager.openWindow(new am(i))},save:{label:"Save...",bindLabel:"Save",combos:[{key:"S",mods:[tt]}],disabled:i=>!i.chartManager.loadedSM||i.chartManager.smPath.startsWith("https://")||i.chartManager.smPath.startsWith("http://"),callback:i=>i.chartManager.save()},export:{label:"Save and export current song",combos:[{key:"E",mods:[tt]}],disabled:i=>!!window.nw||!i.chartManager.loadedSM||i.chartManager.smPath.startsWith("https://")||i.chartManager.smPath.startsWith("http://"),callback:i=>{i.chartManager.save(),_e.getStandardHandler().saveDirectory(i.chartManager.smPath)}},exportNotedata:{label:"Export to notedata...",bindLabel:"Export to notedata",combos:[{key:"E",mods:[tt,"Shift"]}],disabled:i=>!i.chartManager.loadedSM||!he.openWindows,callback:i=>i.windowManager.openWindow(new Q0(i,i.chartManager.selection.notes))},capture:{label:"Export video...",combos:[],disabled:i=>!i.chartManager.loadedSM||!he.openWindows,callback:i=>{i.windowManager.openWindow(new qh(i))}},previousSong:{label:"Previous song in pack",combos:[{key:"F5",mods:["Shift"]}],disabled:i=>!i.chartManager.loadedSM||i.chartManager.smPath.startsWith("https://")||i.chartManager.smPath.startsWith("http://"),callback:i=>{const e=_e.getStandardHandler();if(!e)return;const t=e.resolvePath(rt(i.chartManager.smPath),"..");async function n(){const a=await e.getDirectoryFolders(t);a.sort((s,o)=>s.name.localeCompare(o.name));let r=a.findIndex(s=>s.name==Et(rt(i.chartManager.smPath)));if(r==-1){de.createFormatted("An error occured while finding the song pack!","error"),console.error(`Couldn't find the current song idx in parent folder! Path: ${Et(rt(i.chartManager.smPath))}, Folders`,a);return}for(r--;r>=0;){const s=a[r];console.log("Checking ",s.name);const o=await e.getDirectoryFiles(s);console.log(o);const l=o.find(u=>u.name.endsWith(".ssc"))??o.find(u=>u.name.endsWith(".sm"));if(l){const u=e.resolvePath(t,s.name,l.name);de.create(`Loading ${s.name}/${l.name}`),i.chartManager.loadSM(u);return}r--}de.create("No previous song in pack")}try{n()}catch(a){de.createFormatted("No songs found!","error"),console.error(a)}}},nextSong:{label:"Next song in pack",combos:[{key:"F6",mods:["Shift"]}],disabled:i=>!i.chartManager.loadedSM||i.chartManager.smPath.startsWith("https://")||i.chartManager.smPath.startsWith("http://"),callback:i=>{const e=_e.getStandardHandler();if(!e)return;const t=e.resolvePath(rt(i.chartManager.smPath),"..");async function n(){const a=await e.getDirectoryFolders(t);a.sort((s,o)=>s.name.localeCompare(o.name));let r=a.findIndex(s=>s.name==Et(rt(i.chartManager.smPath)));if(r==-1){de.createFormatted("An error occured while finding the song pack!","error"),console.error(`Couldn't find the current song idx in parent folder! Path: ${Et(rt(i.chartManager.smPath))}, Folders`,a);return}for(r++;r<a.length;){const s=a[r],o=await e.getDirectoryFiles(s),l=o.find(u=>u.name.endsWith(".ssc"))??o.find(u=>u.name.endsWith(".sm"));if(l){const u=e.resolvePath(t,s.name,l.name);de.create(`Loading ${s.name}/${l.name}`),i.chartManager.loadSM(u);return}r++}de.create("No next song in pack")}try{n()}catch(a){de.createFormatted("No songs found!","error"),console.error(a)}}},openChart:{label:"Chart list",bindLabel:"Open chart list",combos:[{key:"O",mods:[tt,"Shift"]}],disabled:i=>!i.chartManager.loadedSM||!he.openWindows,callback:i=>i.windowManager.openWindow(new Su(i))},timingDataRow:{label:"Edit timing data at row",combos:[{key:"T",mods:["Shift"]}],disabled:i=>!i.chartManager.chartView||!he.openWindows,callback:i=>i.windowManager.openWindow(new lm(i))},selectRegion:{label:"Select region",combos:[{key:"Tab",mods:[]}],disabled:i=>!i.chartManager.loadedChart&&i.chartManager.getMode()!=$.Edit,callback:i=>i.chartManager.selectRegion()},volumeUp:{label:"Increase master volume",combos:[{key:"Up",mods:["Alt"]}],disabled:!1,callback:()=>{y.audio.masterVolume=Math.min(y.audio.masterVolume+.05,1),de.create("Master volume: "+Math.round(y.audio.masterVolume*100)+"%")}},volumeDown:{label:"Decrease master volume",combos:[{key:"Down",mods:["Alt"]}],disabled:!1,callback:()=>{y.audio.masterVolume=Math.max(y.audio.masterVolume-.05,0),de.create("Master volume: "+Math.round(y.audio.masterVolume*100)+"%")}},songVolumeUp:{label:"Increase song volume",combos:[{key:"Up",mods:["Shift","Alt"]}],disabled:!1,callback:()=>{y.audio.songVolume=Math.min(y.audio.songVolume+.05,1),de.create("Song volume: "+Math.round(y.audio.songVolume*100)+"%")}},songVolumeDown:{label:"Decrease song volume",combos:[{key:"Down",mods:["Shift","Alt"]}],disabled:!1,callback:()=>{y.audio.songVolume=Math.max(y.audio.songVolume-.05,0),de.create("Song volume: "+Math.round(y.audio.songVolume*100)+"%")}},effectvolumeUp:{label:"Increase tick/metronome volume",combos:[{key:"Up",mods:["Shift",tt,"Alt"]}],disabled:!1,callback:()=>{y.audio.soundEffectVolume=Math.min(y.audio.soundEffectVolume+.05,1),de.create("Effect volume: "+Math.round(y.audio.soundEffectVolume*100)+"%")}},effectvolumeDown:{label:"Decrease tick/metronome volume",combos:[{key:"Down",mods:["Shift",tt,"Alt"]}],disabled:!1,callback:()=>{y.audio.soundEffectVolume=Math.max(y.audio.soundEffectVolume-.05,0),de.create("Effect Volume: "+Math.round(y.audio.soundEffectVolume*100)+"%")}},rateUp:{label:"Increase playback rate",combos:[{key:"Right",mods:["Shift"]}],disabled:i=>i.chartManager.getMode()==$.Play||i.chartManager.getMode()==$.Record,callback:()=>{y.audio.rate+=.05,de.create("Playback Rate: "+Math.round(y.audio.rate*100)+"%")}},rateDown:{label:"Decrease playback rate",combos:[{key:"Left",mods:["Shift"]}],disabled:i=>i.chartManager.getMode()==$.Play||i.chartManager.getMode()==$.Record,callback:()=>{y.audio.rate=Math.max(y.audio.rate-.05,.1),de.create("Playback Rate: "+Math.round(y.audio.rate*100)+"%")}},rateDefault:{label:"Reset playback rate",combos:[],disabled:!1,callback:()=>{y.audio.rate=1,de.create("Playback Rate: "+Math.round(y.audio.rate)+"%")}},previousStream:{label:"Previous stream",combos:[{key:"Up",mods:[tt]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==$.Play||i.chartManager.getMode()==$.Record,callback:i=>{const e=[];for(const n of i.chartManager.loadedChart.stats.streams)e.at(-1)==n.startBeat&&e.pop(),e.push(n.startBeat),e.push(n.endBeat);if(e.length==0)return;const t=qt(e,i.chartManager.beat);Math.abs(i.chartManager.beat-e[t])<.001?t-1>=0?i.chartManager.beat=e[t-1]:i.chartManager.beat=e[0]:i.chartManager.beat=e[t]}},nextStream:{label:"Next stream",combos:[{key:"Down",mods:[tt]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==$.Play||i.chartManager.getMode()==$.Record,callback:i=>{const e=[];for(const n of i.chartManager.loadedChart.stats.streams)e.at(-1)==n.startBeat&&e.pop(),e.push(n.startBeat),e.push(n.endBeat);if(e.length==0)return;const t=qt(e,i.chartManager.beat);if(t==0&&i.chartManager.beat<e[t]){i.chartManager.beat=e[t];return}Xu(i.chartManager.beat,e[t])?t+1<e.length?i.chartManager.beat=e[t+1]:i.chartManager.beat=e[t]:i.chartManager.beat=e[t+1]}},previousMeasure:{label:"Previous measure",combos:[{key:"PageUp",mods:[]},{key:";",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==$.Play||i.chartManager.getMode()==$.Record,callback:i=>{const e=i.chartManager.beat;if(y.chart.scroll.invertReverseScroll&&y.chart.reverse){const t=i.chartManager.loadedChart.timingData.getMeasureLength(e);i.chartManager.snapToNearestTick(Math.max(0,e+t))}else{const t=i.chartManager.loadedChart.timingData.getMeasureLength(e-.001);i.chartManager.snapToNearestTick(Math.max(0,e-t))}}},nextMeasure:{label:"Next measure",combos:[{key:"PageDown",mods:[]},{key:"'",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==$.Play||i.chartManager.getMode()==$.Record,callback:i=>{const e=i.chartManager.beat;if(y.chart.scroll.invertReverseScroll&&y.chart.reverse){const t=i.chartManager.loadedChart.timingData.getMeasureLength(e-.001);i.chartManager.snapToNearestTick(Math.max(0,e-t))}else{const t=i.chartManager.loadedChart.timingData.getMeasureLength(e);i.chartManager.snapToNearestTick(Math.max(0,e+t))}}},previousNote:{label:"Previous note",combos:[{key:",",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==$.Play||i.chartManager.getMode()==$.Record,callback:i=>i.chartManager.previousNote()},nextNote:{label:"Next note",combos:[{key:".",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==$.Play||i.chartManager.getMode()==$.Record,callback:i=>i.chartManager.nextNote()},jumpChartStart:{label:"Jump to first note",combos:[],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==$.Play||i.chartManager.getMode()==$.Record,callback:i=>i.chartManager.firstNote()},jumpChartEnd:{label:"Jump to last note",combos:[],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==$.Play||i.chartManager.getMode()==$.Record,callback:i=>i.chartManager.lastNote()},jumpSongStart:{label:"Jump to song start",combos:[{key:"Home",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==$.Play||i.chartManager.getMode()==$.Record,callback:i=>i.chartManager.beat=Math.max(0,i.chartManager.loadedChart.getBeatFromSeconds(0))},jumpSongEnd:{label:"Jump to song end",combos:[{key:"End",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==$.Play||i.chartManager.getMode()==$.Record,callback:i=>i.chartManager.beat=i.chartManager.loadedChart.getBeatFromSeconds(i.chartManager.chartAudio.getSongLength())},assistTick:{label:"Assist tick",combos:[{key:"F7",mods:[]}],disabled:()=>!he.assist,callback:()=>{y.audio.assistTick=!y.audio.assistTick,de.create("Assist Tick: "+(y.audio.assistTick?"on":"off"))}},metronome:{label:"Metronome",combos:[{key:"F7",mods:["Alt"]}],disabled:()=>!he.assist,callback:()=>{y.audio.metronome=!y.audio.metronome,de.create("Metronome: "+(y.audio.metronome?"on":"off"))}},XMod:{label:"XMod (Beat-based)",combos:[{key:"X",mods:["Shift"]}],disabled:!1,callback:()=>{y.chart.CMod=!1,de.create("Switched to XMod")}},CMod:{label:"CMod (Time-based)",combos:[{key:"C",mods:["Shift"]}],disabled:!1,callback:()=>{y.chart.CMod=!0,de.create("Switched to CMod")}},reverse:{label:"Reverse playfield",combos:[],disabled:!1,callback:()=>{y.chart.reverse=!y.chart.reverse,de.create("Reverse Playfield: "+(y.chart.reverse?"on":"off"))}},hideWarpedArrows:{label:"Hide warped notes (CMod only)",combos:[{key:"W",mods:["Shift"]}],disabled:!1,callback:()=>{y.chart.hideWarpedArrows=!y.chart.hideWarpedArrows,de.create("Hide Warped Arrows: "+(y.chart.hideWarpedArrows?"on":"off"))}},hideFakedArrows:{label:"Hide faked notes (CMod only)",combos:[{key:"F",mods:["Shift"]}],disabled:!1,callback:()=>{y.chart.hideFakedArrows=!y.chart.hideFakedArrows,de.create("Hide Faked Arrows: "+(y.chart.hideFakedArrows?"on":"off"))}},doSpeedChanges:{label:"Do speed changes (XMod only)",combos:[{key:"S",mods:["Shift"]}],disabled:!1,callback:()=>{y.chart.doSpeedChanges=!y.chart.doSpeedChanges,de.create("Speed Changes: "+(y.chart.doSpeedChanges?"on":"off"))}},showEq:{label:"Equalizer",combos:[{key:"E",mods:["Shift"]}],disabled:i=>!i.chartManager.chartAudio||!he.openWindows,callback:i=>i.windowManager.openWindow(new X0(i))},detectSync:{label:"Detect audio sync",combos:[{key:"L",mods:["Shift"]}],disabled:i=>!i.chartManager.chartAudio||!he.openWindows,callback:i=>i.windowManager.openWindow(new Bu(i))},previousNoteType:{label:"Previous note type",combos:[{key:"N",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==$.Play||i.chartManager.getMode()==$.Record,callback:i=>i.chartManager.previousNoteType()},nextNoteType:{label:"Next note type",combos:[{key:"M",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==$.Play||i.chartManager.getMode()==$.Record,callback:i=>i.chartManager.nextNoteType()},undo:{label:"Undo",combos:[{key:"Z",mods:[tt]}],disabled:i=>!i.actionHistory.canUndo()||i.chartManager.getMode()!=$.Edit,callback:i=>i.actionHistory.undo()},redo:{label:"Redo",combos:[{key:"Y",mods:[tt]},{key:"Z",mods:[tt,"Shift"]}],disabled:i=>!i.actionHistory.canRedo()||i.chartManager.getMode()!=$.Edit,callback:i=>i.actionHistory.redo()},mousePlacement:{label:"Enable Mouse Note Placement",combos:[{key:"M",mods:["Shift"]}],disabled:!1,callback:()=>{y.chart.mousePlacement=!y.chart.mousePlacement,de.create("Mouse Note Placement: "+(y.chart.mousePlacement?"on":"off"))}},playMode:{label:"Enter/Exit Play Mode",combos:[{key:"P",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==$.Record||!he.playMode,callback:i=>i.chartManager.setMode($.Play)},recordMode:{label:"Enter/Exit Record Mode",combos:[{key:"R",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==$.Play||i.chartManager.getMode()==$.View||!he.recordMode,callback:i=>i.chartManager.setMode($.Record)},playModeStart:{label:"Play from start",combos:[{key:"P",mods:["Shift"]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==$.Record||!he.playMode,callback:i=>{i.chartManager.beat=0,i.chartManager.setMode($.Play)}},recordModeStart:{label:"Record from start",combos:[{key:"R",mods:["Shift"]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==$.Play||i.chartManager.getMode()==$.View||!he.recordMode,callback:i=>i.chartManager.setMode($.Record)},options:{label:"Options...",bindLabel:"Edit options",combos:[{key:",",mods:[tt]}],disabled:()=>!he.openWindows||!he.openWindows,callback:i=>{i.windowManager.openWindow(new cm(i))}},keybinds:{label:"Keybinds...",bindLabel:"Edit keybinds",combos:[],disabled:()=>!he.openWindows||!he.openWindows,callback:i=>{i.windowManager.openWindow(new Zt(i))}},gameplayKeybinds:{label:"Gameplay keybinds...",bindLabel:"Edit gameplay keybinds",combos:[],disabled:()=>!he.openWindows||!he.openWindows,callback:i=>{i.windowManager.openWindow(new J0(i))}},themes:{label:"Themes...",bindLabel:"Edit themes",combos:[],disabled:()=>!he.openWindows||!he.openWindows||jn.isOpen,callback:i=>{i.windowManager.openWindow(new Ls(i))}},convertHoldsRolls:{label:"Holds to rolls",bindLabel:"Convert holds to rolls",combos:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=$.Edit,callback:i=>{i.chartManager.modifySelection(e=>(e.type=="Hold"&&(e.type="Roll"),e))}},convertRollsHolds:{label:"Rolls to holds",bindLabel:"Convert rolls to holds",combos:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=$.Edit,callback:i=>{i.chartManager.modifySelection(e=>(e.type=="Roll"&&(e.type="Hold"),e))}},swapHoldsRolls:{label:"Swap holds and rolls",combos:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=$.Edit,callback:i=>{i.chartManager.modifySelection(e=>(e.type=="Hold"?e.type="Roll":e.type=="Roll"&&(e.type="Hold"),e))}},convertHoldsTaps:{label:"Holds/rolls to taps",bindLabel:"Convert holds/rolls to taps",combos:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=$.Edit,callback:i=>{i.chartManager.modifySelection(e=>((e.type=="Hold"||e.type=="Roll")&&(e.type="Tap"),e))}},convertTapsMines:{label:"Taps to mines",bindLabel:"Convert taps to mines",combos:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=$.Edit,callback:i=>{i.chartManager.modifySelection(e=>(e.type=="Tap"&&(e.type="Mine"),e))}},convertTapsLifts:{label:"Taps to lifts",bindLabel:"Convert taps to lifts",combos:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=$.Edit,callback:i=>{i.chartManager.modifySelection(e=>(e.type=="Tap"&&(e.type="Lift"),e))}},convertTapsFakes:{label:"Taps to fakes",bindLabel:"Convert taps to fakes",combos:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=$.Edit,callback:i=>{i.chartManager.modifySelection(e=>(e.type=="Tap"&&(e.type="Fake"),e))}},mirrorHorizontally:{label:"Horizontally",bindLabel:"Mirror horizontally",combos:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=$.Edit,callback:i=>{i.chartManager.modifySelection(e=>(e.col=i.chartManager.loadedChart.gameType.flipColumns.horizontal[e.col],e))}},mirrorVertically:{label:"Vertically",bindLabel:"Mirror vertically",combos:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=$.Edit,callback:i=>{i.chartManager.modifySelection(e=>(e.col=i.chartManager.loadedChart.gameType.flipColumns.vertical[e.col],e))}},mirrorBoth:{label:"Both",bindLabel:"Mirror both",combos:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=$.Edit,callback:i=>{i.chartManager.modifySelection(e=>(e.col=i.chartManager.loadedChart.gameType.flipColumns.horizontal[e.col],e.col=i.chartManager.loadedChart.gameType.flipColumns.vertical[e.col],e))}},selectBeforeCursor:{label:"Select before cursor",combos:[{key:"Home",mods:["Shift"]}],disabled:i=>!i.chartManager.loadedChart,callback:i=>{i.chartManager.editTimingMode==Ce.Off?i.chartManager.setNoteSelection(i.chartManager.loadedChart.getNotedata().filter(e=>e.beat<i.chartManager.beat)):i.chartManager.setEventSelection(i.chartManager.loadedChart.timingData.getTimingData().filter(e=>e.beat<i.chartManager.beat))}},selectAfterCursor:{label:"Select after cursor",combos:[{key:"End",mods:["Shift"]}],disabled:i=>!i.chartManager.loadedChart,callback:i=>{i.chartManager.editTimingMode==Ce.Off?i.chartManager.setNoteSelection(i.chartManager.loadedChart.getNotedata().filter(e=>e.beat>i.chartManager.beat)):i.chartManager.setEventSelection(i.chartManager.loadedChart.timingData.getTimingData().filter(e=>e.beat>i.chartManager.beat))}},selectAll:{label:"Select all",combos:[{key:"A",mods:[tt]}],disabled:i=>!i.chartManager.loadedChart,callback:i=>{i.chartManager.editTimingMode==Ce.Off?i.chartManager.setNoteSelection(i.chartManager.loadedChart.getNotedata()):i.chartManager.setEventSelection(i.chartManager.loadedChart.timingData.getTimingData())}},expand2to1:{label:"Expand 2:1 (8th to 4th)",combos:[],disabled:i=>i.chartManager.selection.notes.length<2||i.chartManager.getMode()!=$.Edit,callback:i=>{const e=Math.min(...i.chartManager.selection.notes.map(t=>t.beat));i.chartManager.modifySelection(t=>(t.beat=(t.beat-e)*2+e,t.beat=Math.round(t.beat*48)/48,Re(t)&&(t.hold*=2,t.hold=Math.round(t.hold*48)/48),t))}},expand3to2:{label:"Expand 3:2 (12th to 8th)",combos:[],disabled:i=>i.chartManager.selection.notes.length<2||i.chartManager.getMode()!=$.Edit,callback:i=>{const e=Math.min(...i.chartManager.selection.notes.map(t=>t.beat));i.chartManager.modifySelection(t=>(t.beat=(t.beat-e)*1.5+e,t.beat=Math.round(t.beat*48)/48,Re(t)&&(t.hold*=1.5,t.hold=Math.round(t.hold*48)/48),t))}},expand4to3:{label:"Expand 4:3 (16th to 2th)",combos:[],disabled:i=>i.chartManager.selection.notes.length<2||i.chartManager.getMode()!=$.Edit,callback:i=>{const e=Math.min(...i.chartManager.selection.notes.map(t=>t.beat));i.chartManager.modifySelection(t=>(t.beat=(t.beat-e)*4/3+e,t.beat=Math.round(t.beat*48)/48,Re(t)&&(t.hold*=4/3,t.hold=Math.round(t.hold*48)/48),t))}},compress1to2:{label:"Compress 1:2 (4th to 8th)",combos:[],disabled:i=>i.chartManager.selection.notes.length<2||i.chartManager.getMode()!=$.Edit,callback:i=>{const e=Math.min(...i.chartManager.selection.notes.map(t=>t.beat));i.chartManager.modifySelection(t=>(t.beat=(t.beat-e)/2+e,t.beat=Math.round(t.beat*48)/48,Re(t)&&(t.hold/=2,t.hold=Math.round(t.hold*48)/48),t))}},compress2to3:{label:"Compress 2:3 (8th to 12th)",combos:[],disabled:i=>i.chartManager.selection.notes.length<2||i.chartManager.getMode()!=$.Edit,callback:i=>{const e=Math.min(...i.chartManager.selection.notes.map(t=>t.beat));i.chartManager.modifySelection(t=>(t.beat=(t.beat-e)/1.5+e,t.beat=Math.round(t.beat*48)/48,Re(t)&&(t.hold/=1.5,t.hold=Math.round(t.hold*48)/48),t))}},compress3to4:{label:"Compress 3:4 (12th to 16th)",combos:[],disabled:i=>i.chartManager.selection.notes.length<2||i.chartManager.getMode()!=$.Edit,callback:i=>{const e=Math.min(...i.chartManager.selection.notes.map(t=>t.beat));i.chartManager.modifySelection(t=>(t.beat=(t.beat-e)*.75+e,t.beat=Math.round(t.beat*48)/48,Re(t)&&(t.hold*=.75,t.hold=Math.round(t.hold*48)/48),t))}},delete:{label:"Delete",combos:[{key:"Backspace",mods:[]},{key:"Delete",mods:[]}],disabled:i=>i.chartManager.getMode()!=$.Edit||i.chartManager.selection.notes.length==0&&i.chartManager.eventSelection.timingEvents.length==0,callback:i=>{i.chartManager.deleteSelection(),i.chartManager.deleteEventSelection()}},paste:{label:"Paste",combos:[{mods:[tt],key:"V"}],preventDefault:!1,disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()!=$.Edit,callback:async i=>{const e=await navigator.clipboard.readText();i.chartManager.paste(e)}},pasteReplace:{label:"Clear and paste",combos:[{mods:[tt,"Shift"],key:"V"}],preventDefault:!1,disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()!=$.Edit,callback:async i=>{const e=await navigator.clipboard.readText();i.chartManager.paste(e,!0)}},copy:{label:"Copy",combos:[{mods:[tt],key:"C"}],preventDefault:!1,disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()!=$.Edit||!i.chartManager.hasSelection(),callback:async i=>{const e=i.chartManager.copy();e&&await navigator.clipboard.writeText(e)}},cut:{label:"Cut",combos:[{mods:[tt],key:"X"}],preventDefault:!1,disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()!=$.Edit||!i.chartManager.hasSelection(),callback:async i=>{const e=i.chartManager.copy();e&&await navigator.clipboard.writeText(e),i.chartManager.deleteSelection()}},adjustOffset:{label:"Adjust offset",combos:[],disabled:()=>!he.openWindows,callback:i=>i.windowManager.openWindow(new nm(i))},setSongPreview:{label:"Set as song preview",combos:[],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()!=$.Edit||!i.chartManager.hasRange(),callback:i=>{const e=i.chartManager.loadedChart,t=i.chartManager.loadedSM.properties.SAMPLESTART??"0",n=i.chartManager.loadedSM.properties.SAMPLELENGTH??"10";let a="",r="";if(i.chartManager.startRegion!==void 0&&i.chartManager.endRegion!==void 0){const s=e.getSecondsFromBeat(i.chartManager.startRegion),o=e.getSecondsFromBeat(i.chartManager.endRegion);a=ue(s,3).toString(),r=ue(o-s,3).toString()}else{const o=(i.chartManager.selection.notes.length>0?i.chartManager.selection.notes:i.chartManager.eventSelection.timingEvents).map(f=>f.beat),l=e.getSecondsFromBeat(Gi(o)),u=e.getSecondsFromBeat(Rn(o));a=ue(l,3).toString(),r=ue(u-l,3).toString()}Lt.instance.run({action:s=>{s.chartManager.loadedSM.properties.SAMPLESTART=a,s.chartManager.loadedSM.properties.SAMPLELENGTH=r},undo:()=>{i.chartManager.loadedSM.properties.SAMPLESTART=t,i.chartManager.loadedSM.properties.SAMPLELENGTH=n}})}},showDebugTimers:{label:"Toggle Debug Timers",combos:[{key:"F3",mods:["Shift"]}],disabled:!1,callback:()=>{y.debug.showTimers=!y.debug.showTimers}},showFPSCounter:{label:"Toggle FPS Counter",combos:[{key:"F3",mods:[]}],disabled:!1,callback:()=>{y.debug.showFPS=!y.debug.showFPS}},noteTypeTap:{label:"Switch to Taps",combos:[],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()!=$.Edit,callback:i=>{i.chartManager.setEditingNoteType("Tap")}},noteTypeLift:{label:"Switch to Lifts",combos:[],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()!=$.Edit,callback:i=>{i.chartManager.setEditingNoteType("Lift")}},noteTypeMine:{label:"Switch to Mines",combos:[],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()!=$.Edit,callback:i=>{i.chartManager.setEditingNoteType("Mine")}},noteTypeFake:{label:"Switch to Fakes",combos:[],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()!=$.Edit,callback:i=>{i.chartManager.setEditingNoteType("Fake")}},openGuide:{label:"Open Help Guide",combos:[],disabled:!1,callback:()=>{window.open("/smeditor/guide/")}},openChangelog:{label:"Open Changelog",combos:[],disabled:()=>!he.openWindows,callback:i=>{i.windowManager.openWindow(new _u(i))}},noteskinWindow:{label:"Noteskins...",bindLabel:"Open Noteskin Window",combos:[{mods:["Shift"],key:"N"}],disabled:i=>!i.chartManager.chartView||!he.openWindows,callback:i=>i.windowManager.openWindow(new im(i))},previousChart:{label:"Previous chart",combos:[{key:"F5",mods:[]}],disabled:i=>!i.chartManager.chartView,callback:i=>{if(!i.chartManager.loadedSM?.charts||!i.chartManager.loadedChart)return;const e=i.chartManager.loadedSM?.charts[i.chartManager.loadedChart.gameType.id],t=e.indexOf(i.chartManager.loadedChart);e[t-1]?i.chartManager.loadChart(e[t-1]):de.create("No previous chart")}},nextChart:{label:"Next chart",combos:[{key:"F6",mods:[]}],disabled:i=>!i.chartManager.chartView,callback:i=>{if(!i.chartManager.loadedSM?.charts||!i.chartManager.loadedChart)return;const e=i.chartManager.loadedSM?.charts[i.chartManager.loadedChart.gameType.id],t=e.indexOf(i.chartManager.loadedChart);e[t+1]?i.chartManager.loadChart(e[t+1]):de.create("No next chart")}},toggleEditTiming:{label:"Toggle Edit Timing",combos:[{key:"T",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()!=$.Edit,callback:i=>{i.chartManager.editTimingMode!=Ce.Off?i.chartManager.editTimingMode=Ce.Off:i.chartManager.editTimingMode=Ce.Edit}},toggleAddTiming:{label:"Toggle Add Timing",combos:[{key:"T",mods:["Alt"]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()!=$.Edit,callback:i=>{i.chartManager.editTimingMode!=Ce.Add?i.chartManager.editTimingMode=Ce.Add:i.chartManager.editTimingMode=Ce.Edit}},about:{label:"About",combos:[],disabled:()=>!he.openWindows,callback:i=>{i.windowManager.openWindow(new Gd(i))}}};for(const i of[4,2,1])$e[`shiftUp${i}m`]={label:`${i} measure`+(i==1,""),bindLabel:`Shift up by ${i} measure`+(i==1,""),combos:[],disabled:e=>!e.chartManager.chartView,callback:e=>{const t=e.chartManager.selection.notes[0].beat,n=e.chartManager.loadedChart.timingData.getMeasureLength(t);e.chartManager.modifySelection(a=>(a.beat-=n*i,a),!0)}},$e[`shiftDown${i}m`]={label:`${i} measure`+(i==1,""),bindLabel:`Shift down by ${i} measure`+(i==1,""),combos:[],disabled:e=>!e.chartManager.chartView,callback:e=>{const t=e.chartManager.selection.notes[0].beat,n=e.chartManager.loadedChart.timingData.getMeasureLength(t);e.chartManager.modifySelection(a=>(a.beat+=n*i,a),!0)}};for(let i=0;i<mn.length;i++)$e["quant"+xo[i]]={label:`Switch to ${Kt[i]}s`,combos:[],disabled:e=>!e.chartManager.chartView,callback:()=>{y.chart.snap=mn[i]}},$e[`shiftUp${Kt[i]}`]={label:`${Kt[i]}`,bindLabel:`Shift up by ${Kt[i]}`,combos:[],disabled:e=>!e.chartManager.chartView,callback:e=>e.chartManager.modifySelection(t=>(t.beat-=mn[i],t),!0)},$e[`shiftDown${Kt[i]}`]={label:`${Kt[i]}`,bindLabel:`Shift down by ${Kt[i]}`,combos:[],disabled:e=>!e.chartManager.chartView,callback:e=>e.chartManager.modifySelection(t=>(t.beat+=mn[i],t),!0)},i!=mn.length-1&&($e["quantize"+Kt[i]]={label:`${Kt[i]}s`,bindLabel:`Quantize to ${Kt[i]}s`,combos:[],disabled:e=>e.chartManager.selection.notes.length==0||e.chartManager.getMode()!=$.Edit,callback:e=>{e.chartManager.modifySelection(t=>(t.beat=e.chartManager.getClosestTick(t.beat,xo[i]),t.beat=Math.round(t.beat*48)/48,t))}});for(const i of["STOPS","DELAYS"])$e[`convert${i}`]={label:`Convert to ${i[0]}${i.slice(1).toLowerCase()}`,combos:[],disabled:e=>!e.chartManager.chartView||e.chartManager.getMode()!=$.Edit||!e.chartManager.hasRange(),callback:e=>{const t=e.chartManager.loadedChart;let n=0,a=0;if(e.chartManager.startRegion!==void 0&&e.chartManager.endRegion!==void 0){const r=t.getSecondsFromBeat(e.chartManager.startRegion),s=t.getSecondsFromBeat(e.chartManager.endRegion);n=e.chartManager.startRegion,a=s-r}else{const s=(e.chartManager.selection.notes.length>0?e.chartManager.selection.notes:e.chartManager.eventSelection.timingEvents).map(u=>u.beat),o=t.getSecondsFromBeat(Gi(s)),l=t.getSecondsFromBeat(Rn(s));n=Gi(s),a=l-o}e.chartManager.loadedChart.timingData.insertColumnEvents([{type:i,beat:n,value:a}])}};for(const i of["WARPS","FAKES"])$e[`convert${i}`]={label:`Convert to ${i[0]}${i.slice(1).toLowerCase()}`,combos:[],disabled:e=>!e.chartManager.chartView||e.chartManager.getMode()!=$.Edit||!e.chartManager.hasRange(),callback:e=>{let t=0,n=0;if(e.chartManager.startRegion!==void 0&&e.chartManager.endRegion!==void 0)t=e.chartManager.startRegion,n=e.chartManager.endRegion-e.chartManager.startRegion;else{const r=(e.chartManager.selection.notes.length>0?e.chartManager.selection.notes:e.chartManager.eventSelection.timingEvents).map(s=>s.beat);t=Gi(r),n=Rn(r)-Gi(r)}e.chartManager.loadedChart.timingData.insertColumnEvents([{type:i,beat:t,value:n}])}};class mo{static popup;static build(e){const t=document.createElement("div");t.classList.add("update-popup");const n=document.createElement("div");n.classList.add("title"),n.innerText=e.title;const a=document.createElement("div");a.classList.add("desc"),a.innerText=e.desc;const r=document.createElement("div");if(r.classList.add("update-options"),t.replaceChildren(n,a),e.options.length>0){for(const s of e.options){const o=document.createElement("button");o.innerText=s.label,o.onclick=()=>{s.callback?.(this)},o.classList.add(s.type),r.appendChild(o)}t.appendChild(r)}this.popup=t,document.getElementById("popups")?.appendChild(this.popup)}static close(){this.popup&&(this.popup.classList.add("exiting"),this.popup.style.pointerEvents="none",setTimeout(()=>this.popup.remove(),300))}}class Iu extends mo{static open(e,t){super.build({title:`A new version of the desktop app is available! (${e})`,desc:"Click here to download the new version.",options:[{label:"Close",type:"default",callback:()=>this.close()},{label:"Download",type:"confirm",callback:()=>{localStorage.setItem("downloadedVersion",e),nw.require("nw.gui").Shell.openExternal(t),this.close()}}]})}}class Ru extends mo{static open(e){super.build({title:"A new version of the app is available!",desc:"Refresh the page to get the new version.",options:[{label:"Close",type:"default",callback:()=>this.close()},{label:"Refresh",type:"confirm",callback:()=>{e(),window.location.reload()}}]})}}class dm extends mo{static open(){super.build({title:"SMEditor was loaded offline!",desc:"You can now use SMEditor without an internet connection.",options:[]}),setTimeout(()=>this.close(),5e3)}}class mt extends kc{static graphics=new Ra;static textures={default:_i.create({width:50,height:50}),noBorder:_i.create({width:50,height:50}),onlyBorder:_i.create({width:50,height:50})};static init(e){this.textures.default=_i.create({width:50,height:50,resolution:e.resolution}),this.textures.noBorder=_i.create({width:50,height:50,resolution:e.resolution}),this.textures.onlyBorder=_i.create({width:50,height:50,resolution:e.resolution}),this.graphics.beginFill(16777215,1),this.graphics.lineStyle(1,0),this.graphics.drawRoundedRect(0,0,50,50,5),this.graphics.endFill(),e.render(this.graphics,{renderTexture:this.textures.default}),this.graphics.clear(),this.graphics.beginFill(16777215,1),this.graphics.lineStyle(0,16777215),this.graphics.drawRoundedRect(0,0,50,50,5),this.graphics.endFill(),e.render(this.graphics,{renderTexture:this.textures.noBorder}),this.graphics.clear(),this.graphics.beginFill(16777215,0),this.graphics.lineStyle(2,16777215),this.graphics.drawRoundedRect(0,0,50,50,5),this.graphics.endFill(),e.render(this.graphics,{renderTexture:this.textures.onlyBorder})}constructor(e){super(mt.textures[e??"default"],5,5,5,5)}}const Cn=[];function uc(){return Cn.length}function hm(){for(Cn.push(Date.now());Cn.length>0&&Cn[0]<Date.now()-1e3;)Cn.shift()}const En=[];function dc(){return En.length}function fm(){for(En.push(Date.now());En.length>0&&En[0]<Date.now()-1e3;)En.shift()}class fn extends ye{manager;constructor(e){super(),this.manager=e}startPlay(){}endPlay(){}}const Ut=50;class qi extends fn{static instance;frameTimeGraph=new yn({width:300,height:Ut,color:1525027,min:0,unit:"ms",label:"Draw",precision:1,sublabel:()=>uc()+" FPS"});drawUpdateTimeGraph=new yn({width:300,height:Ut,color:6034982,min:0,unit:"ms",label:"DrawUpdate",precision:1});updateTimeGraph=new yn({width:300,height:Ut,color:1516101,min:0,unit:"ms",label:"Update",precision:1,sublabel:()=>dc()+" TPS"});memoryTimeGraph=new yn({width:300,height:Ut,color:6626406,min:0,formatter:e=>Math.round(e/1048576)+" MB",label:"Memory"});cpuGraph=new yn({width:300,height:Ut,color:5190685,min:0,label:"CPU"});graphs=new ye;fpsCounter=new ye;fpsBg=new mt("noBorder");fpsText=new Ee("",{fontName:"Main",fontSize:12});lastFrameTime=0;properties=new Map;constructor(e){super(e),this.drawUpdateTimeGraph.y+=Ut+5,this.updateTimeGraph.y+=(Ut+5)*2,this.memoryTimeGraph.y+=(Ut+5)*3,this.cpuGraph.y+=(Ut+5)*4,qi.instance=this,this.fpsText.x=5,this.fpsBg.y=-5,He(this.fpsBg,"widget-bg"),He(this.fpsText,"text-color"),this.graphs.addChild(this.frameTimeGraph,this.drawUpdateTimeGraph,this.updateTimeGraph),performance.memory&&this.graphs.addChild(this.memoryTimeGraph),this.fpsCounter.addChild(this.fpsBg,this.fpsText),this.graphs.visible=y.debug.showTimers,this.fpsCounter.visible=y.debug.showFPS,this.addChild(this.graphs,this.fpsCounter)}update(){this.x=-this.manager.app.STAGE_WIDTH/2+20,this.y=-this.manager.app.STAGE_HEIGHT/2+20,this.graphs.children.forEach(e=>e.update()),this.graphs.visible=y.debug.showTimers,this.fpsCounter.visible=y.debug.showFPS,this.fpsText.text=`${uc()} FPS
${dc()} TPS
${this.lastFrameTime.toFixed(2)} ms
`,y.debug.showDebugVariables&&this.properties.forEach((e,t)=>{this.fpsText.text+=`${t}: ${e}
`}),this.fpsBg.width=this.fpsText.width+10,this.fpsBg.height=this.fpsText.height+10,y.debug.showTimers?(this.fpsBg.y=(Ut+5)*this.graphs.children.length-5,this.fpsText.y=(Ut+5)*this.graphs.children.length):(this.fpsBg.y=-5,this.fpsText.y=0)}addMemoryTimeValue(e){this.memoryTimeGraph.addValue(e)}addFrameTimeValue(e){this.lastFrameTime=e,this.frameTimeGraph.addValue(e)}addUpdateTimeValue(e){this.updateTimeGraph.addValue(e)}addDrawUpdateTimeValue(e){this.drawUpdateTimeGraph.addValue(e)}setProperty(e,t){this.properties.set(e,t)}clearProperty(e){this.properties.delete(e)}clearProperties(){this.properties.clear()}}class yn extends ye{graphWidth;graphHeight;color;unit;precision;formatter;sublabel;maxEase=1;targetMax=1;minEase=1;targetMin=1;constrainedMin=null;constrainedMax=null;dataPoints=[];linePool=[];lineContainer;labelText;sublabelText;topText;bottomText;constructor(e){super();const{width:t,height:n,color:a=16777215,unit:r="",label:s="",min:o=null,max:l=null,precision:u=0,formatter:f=null,sublabel:c=()=>""}=e;this.graphWidth=t,this.graphHeight=n,this.color=a,this.unit=r,this.constrainedMax=l,this.constrainedMin=o,this.precision=u,this.formatter=f,this.sublabel=c,this.lineContainer=new Ns(t,{position:!0},16384,!0);const d=new mt("noBorder");d.tint=0,d.alpha=.3,d.width=this.graphWidth,d.height=this.graphHeight,He(d,"widget-bg"),this.labelText=new Ee(s,{fontName:"Main",fontSize:Math.min(n/5,16)}),this.labelText.alpha=.8,this.sublabelText=new Ee("",{fontName:"Main",fontSize:Math.min(n/5,16)}),this.topText=new Ee("",{fontName:"Main",fontSize:Math.min(n/7,12)}),this.topText.anchor.x=1,this.topText.alpha=.5,this.topText.x=this.graphWidth,this.bottomText=new Ee("",{fontName:"Main",fontSize:Math.min(n/7,12)}),this.bottomText.anchor.x=1,this.bottomText.anchor.y=1,this.bottomText.alpha=.5,this.bottomText.x=this.graphWidth,this.bottomText.y=this.graphHeight,this.sublabelText.y=this.graphHeight,this.sublabelText.anchor.y=1,this.sublabelText.alpha=.5,this.addChild(d,this.lineContainer,this.labelText,this.sublabelText,this.topText,this.bottomText)}addValue(e){if(this.lineContainer.children[0]?.x+this.lineContainer.x<0){const n=this.lineContainer.children[0];this.dataPoints.shift(),this.removeChild(n),this.linePool.push(n)}this.lineContainer.x-=1,this.lineContainer.x<-1e7&&(this.lineContainer.children.forEach(n=>{n.x-=1e7}),this.lineContainer.x+=1e7);const t=this.linePool.shift()??new De(Se.WHITE);t.width=1,t.anchor.x=.5,t.anchor.y=1,t.tint=this.color,t.alpha=.6,t.x=this.graphWidth-this.lineContainer.x,t.y=this.graphHeight,t.value=e,this.dataPoints.push(e),this.targetMax=this.constrainedMax!==null?this.constrainedMax:Math.max(...this.dataPoints),this.targetMin=this.constrainedMin!==null?this.constrainedMin:Math.min(...this.dataPoints),this.lineContainer.addChild(t)}update(){this.dataPoints.length!=0&&(this.maxEase=(this.maxEase-this.targetMax)*.1+this.targetMax,this.minEase=(this.minEase-this.targetMin)*.1+this.targetMin,this.lineContainer.children.forEach(e=>{e.height=Ae((e.value-this.minEase)/this.maxEase,0,1)*this.graphHeight}),this.topText.text=this.formatter?.(this.maxEase)??`${ue(this.maxEase,this.precision)} ${this.unit}`,this.bottomText.text=this.formatter?.(this.minEase)??`${ue(this.minEase,this.precision)} ${this.unit}`,this.sublabelText.text=this.sublabel())}}class pm extends fn{timeText;beatText;measureText;constructor(e){super(e);const t=new mt("noBorder");t.width=330,t.height=48,t.tint=16711680,t.pivot.set(t.width/2,t.height),this.addChild(t),He(t,"widget-bg"),this.timeText=this.createCounter("Time",{x:-110,y:-32}),this.createLine({x:-55,y:-40}),this.beatText=this.createCounter("Beat",{x:0,y:-32}),this.createLine({x:55,y:-40}),this.measureText=this.createCounter("Measure",{x:110,y:-32})}createCounter(e,t){const n=new Ee("",{fontSize:32,fontName:"Main"});n.scale.set(16*1.1/32),n.anchor.set(.5,.5),n.position.set(t.x,t.y),this.addChild(n),He(n,"text-color");const a=new Ee(e,{fontSize:32,fontName:"Main"});return a.scale.set(16*.6/32),a.anchor.set(.5,.5),a.position.set(t.x,t.y+16),this.addChild(a),He(a,"text-color-secondary"),n}createLine(e){const t=new De(Se.WHITE);t.width=1,t.height=32,t.position.set(e.x,e.y),t.tint=8816262,t.alpha=.5,this.addChild(t)}update(){if(!this.manager.app.capturing){this.visible=!1;return}this.visible=!0,this.scale.set(y.performance.resolution*y.general.uiScale*.7),this.position.y=this.manager.app.STAGE_HEIGHT/2-32*y.performance.resolution*y.general.uiScale*.7;const e=this.manager.chartManager.loadedChart?.timingData?.getMeasure(this.manager.chartManager.beat)??this.manager.chartManager.beat/4,t=this.manager.chartManager.time;this.measureText.text=ue(e,3).toFixed(3),this.beatText.text=ue(this.manager.chartManager.beat,3).toFixed(3);let n="";n+=(t<0?"-":"")+Math.floor(Math.abs(t)/60).toString().padStart(2,"0"),n+=":",n+=Math.floor(Math.abs(t)%60).toString().padStart(2,"0"),n+=".",n+=(ue(Math.abs(t)%1,3)*1e3).toString().padStart(3,"0"),this.timeText.text=n}}class Pu extends fn{backing=new mt("noBorder");overlay=new De(Se.WHITE);selectionOverlay=new De(Se.WHITE);container=new ye;lastHeight=0;lastCMod;mouseDown=!1;queued=!1;verticalMargin=40;backingVerticalPadding=10;backingWidth=32;xOffset=20;constructor(e,t=20,n=32){super(e),this.backingWidth=n,this.xOffset=t,this.sortableChildren=!0,this.addChild(this.backing),this.addChild(this.container),this.visible=!1,He(this.backing,"widget-bg"),this.overlay.anchor.x=.5,this.overlay.anchor.y=0,this.overlay.alpha=.3,this.overlay.zIndex=10,this.lastCMod=y.chart.CMod,this.addChild(this.overlay),this.x=this.manager.app.STAGE_WIDTH/2-this.xOffset,le.on("chartLoaded",()=>{this.queued=!1,this.populate()}),le.on("chartModifiedAfter",()=>{this.queued||this.populate(),this.queued=!0});const a=setInterval(()=>{this.queued&&(this.queued=!1,this.populate())},3e3);this.on("destroyed",()=>clearInterval(a)),this.eventMode="static",this.on("mousedown",r=>{this.mouseDown=!0,this.handleMouse(r)}),this.on("mousemove",r=>{this.mouseDown&&this.handleMouse(r)}),this.on("mouseup",()=>{this.mouseDown=!1}),this.on("mouseleave",()=>{this.mouseDown=!1})}handleMouse(e){if(this.manager.chartManager.getMode()==$.Play||!this.getChart())return;let t=(this.container.toLocal(e.global).y+this.container.height/2)/this.container.height;t=Ae(t,0,1),this.getChart().getNotedata().at(-1)&&(y.chart.CMod?this.manager.chartManager.time=xt(-this.getChart().timingData.getOffset(),this.getChart().getLastSecond(),t):this.manager.chartManager.beat=this.getChart().getLastBeat()*t)}update(){this.scale.y=y.chart.reverse?-1:1;const e=this.manager.app.STAGE_HEIGHT-this.verticalMargin;this.backing.height=e+this.backingVerticalPadding,this.backing.position.y=-this.backing.height/2,this.backing.position.x=-this.backing.width/2,this.x=this.manager.app.STAGE_WIDTH/2-this.xOffset;const t=this.getChart(),n=this.manager.chartManager.chartView;if(!t||!n||!he.layout){this.visible=!1;return}if(this.visible=!0,!t.getNotedata().at(-1)){this.overlay.height=0;return}const r=y.chart.CMod?n.getSecondFromYPos(-this.manager.app.STAGE_HEIGHT/2):n.getBeatFromYPos(-this.manager.app.STAGE_HEIGHT/2,!0),s=y.chart.CMod?n.getSecondFromYPos(this.manager.app.STAGE_HEIGHT/2):n.getBeatFromYPos(this.manager.app.STAGE_HEIGHT/2,!0),o=this.getYFromRange(t,r,s);this.overlay.y=o.startY,this.overlay.height=o.endY-o.startY,this.overlay.height=Math.max(2,this.overlay.height);const l=this.manager.chartManager.selection.notes;if(l.length<1)this.selectionOverlay.visible=!1;else{this.selectionOverlay.visible=!0;let u,f;y.chart.CMod?(u=Gi(l.map(d=>d.second)),f=Rn(l.map(d=>t.getSecondsFromBeat(Vi(d))))):(u=Gi(l.map(d=>d.beat)),f=Rn(l.map(d=>Vi(d))));const c=this.getYFromRange(t,u,f);this.selectionOverlay.y=c.startY,this.selectionOverlay.height=c.endY-c.startY,this.selectionOverlay.height=Math.max(2,this.selectionOverlay.height)}(this.manager.app.STAGE_HEIGHT!=this.lastHeight||this.lastCMod!=y.chart.CMod)&&(this.lastCMod=y.chart.CMod,this.lastHeight=this.manager.app.STAGE_HEIGHT,this.updateDimensions(),this.populate())}getYFromRange(e,t,n){const a=e.getLastBeat(),r=e.getLastSecond();let s=vt(0,a,t),o=vt(0,a,n);y.chart.CMod&&(s=vt(-e.timingData.getOffset(),r,t),o=vt(-e.timingData.getOffset(),r,n)),s=Ae(s,0,1),o=Ae(o,0,1),s>o&&([s,o]=[o,s]);const l=(s-.5)*this.container.height,u=(o-.5)*this.container.height;return{startY:l,endY:u}}updateDimensions(){if(!this.getChart())return;const t=this.manager.app.STAGE_HEIGHT-this.verticalMargin;this.backing.height=t+this.backingVerticalPadding,this.backing.width=this.backingWidth,this.overlay.width=this.backingWidth,this.selectionOverlay.width=this.backingWidth,this.pivot.x=this.backing.width/2}populate(){}getChart(){return this.manager.chartManager.loadedChart}}class mm extends Pu{npsGraph;graphGradient=null;graphWidth=40;npsText=new Ee("",{fontName:"Main",fontSize:12});constructor(e){super(e,60,40),this.graphWidth=40,this.graphGradient=this.makeGradient(),this.npsGraph=new Ra,this.container.addChild(this.npsGraph),this.npsText.visible=!1,this.npsText.anchor.x=1,this.npsText.anchor.y=.5,He(this.npsText,"text-color"),this.addChild(this.npsText),le.on("userOptionUpdated",n=>{(n=="chart.npsGraph.color1"||n=="chart.npsGraph.color2")&&(this.graphGradient=this.makeGradient(),this.populate())}),this.on("mouseleave",()=>{this.hideNpsDisplay()}),this.on("mouseenter",()=>{this.showNpsDisplay()}),this.on("mousemove",n=>{this.updateNpsDisplay(n)}),this.populate()}updateNpsDisplay(e){const t=this.getChart();if(!t){this.npsText.visible=!1;return}if(!t.getNotedata().at(-1)){this.npsText.visible=!1;return}const a=t.stats.npsGraph;let r=this.npsGraph.toLocal(e.global).y/this.npsGraph.height;r=Ae(r,0,1);let s=xt(0,t.getLastBeat(),r);if(y.chart.CMod){const u=xt(-t.timingData.getOffset(),t.getLastSecond(),r);s=t.timingData.getBeatFromSeconds(u)}const o=Math.floor(t.timingData.getMeasure(s)),l=a[o]??0;this.npsText.text=l.toFixed(1)+" nps",this.npsText.position.y=this.getYFromBeat(s)-this.npsGraph.height/2,this.npsText.position.x=-this.backing.width/2-10,this.npsText.visible=!0}hideNpsDisplay(){this.npsText.visible=!1}showNpsDisplay(){const e=this.getChart();if(!e){this.npsText.visible=!1;return}if(!e.getNotedata().at(-1)){this.npsText.visible=!1;return}this.npsText.visible=!0}update(){if(!y.chart.npsGraph.enabled){this.visible=!1;return}this.visible=!0;const e=this.manager.getChildByName("note-layout");e!==void 0&&e.visible?this.xOffset=e.backingWidth+28:this.xOffset=20,this.npsText.scale.y=y.chart.reverse?-1:1,super.update()}populate(){const e=this.getChart();if(!e)return;const t=this.manager.app.STAGE_HEIGHT-40,n=e.stats.getMaxNPS(),a=e.stats.npsGraph,r=e.getLastBeat();if(this.npsGraph.clear(),e.getNotedata().length==0)return;this.graphGradient?this.npsGraph.beginTextureFill({texture:this.graphGradient}):this.npsGraph.beginFill(0,1),this.npsGraph.pivot.x=this.backing.width/2,this.npsGraph.pivot.y=t/2;const s=Math.floor(this.getChart().timingData.getMeasure(r)),o=this.getYFromBeat(0);this.npsGraph.moveTo(0,o);for(let c=0;c<=s;c++){const d=a[c]??0,h=e.timingData.getBeatFromMeasure(c),p=Math.min(r,e.timingData.getBeatFromMeasure(c+1)),m=vt(0,n,d)*this.graphWidth,g=this.getYFromBeat(h),b=this.getYFromBeat(p);this.npsGraph.lineTo(m,g),this.npsGraph.lineTo(m,b)}const l=a.at(-1)??0,u=vt(0,n,l)*this.graphWidth,f=this.getYFromBeat(r);this.npsGraph.lineTo(u,f),this.npsGraph.lineTo(0,f),this.npsGraph.endFill()}getYFromBeat(e){if(y.chart.CMod)return this.getYFromSecond(this.getChart().timingData.getSecondsFromBeat(e));let t=vt(0,this.getChart().getLastBeat(),e);return t=Ae(t,0,1),t*(this.backing.height-10)}getYFromSecond(e){if(!y.chart.CMod)return this.getYFromBeat(this.getChart().timingData.getBeatFromSeconds(e));let t=vt(-this.getChart().timingData.getOffset(),this.getChart().getLastSecond(),e);return t=Ae(t,0,1),t*(this.backing.height-10)}makeGradient(){const e=this.graphWidth,t=document.createElement("canvas");t.width=e,t.height=e;const n=t.getContext("2d");if(n==null)return null;const a=n.createLinearGradient(0,0,e,0);return a.addColorStop(0,zn(y.chart.npsGraph.color1).toHexa()),a.addColorStop(.8,zn(y.chart.npsGraph.color2).toHexa()),n.fillStyle=a,n.fillRect(0,0,e,e),Se.from(t)}}const hc=150;class ea{static active=!1;static persistent=!1;static options;static popup;static view;static title;static desc;static editText;static clickOutside;static moveInterval;static updateInterval;static _open(e){if(!this.active){if(this.options=e,this._build(),!document.getElementById("popups")){console.error("Failed to open popup!","error");return}document.getElementById("popups")?.appendChild(this.popup),this.clickOutside&&window.removeEventListener("click",this.clickOutside,!0),this.clickOutside=this.options.clickHandler??(t=>{this.popup?.contains(t.target)||this.close()}),this.popup.style.transitionDuration="0s",this.movePosition(),this.moveInterval=setInterval(()=>this.movePosition(),hc),this.active=!0,this.options.cancelableOnOpen&&setTimeout(()=>window.addEventListener("click",this.clickOutside,!0),200)}}static cloneRect(e){return{top:e.top,bottom:e.bottom,left:e.left,right:e.right,width:e.width,height:e.height}}static movePosition(){const e=this.options.attach instanceof HTMLElement?this.options.attach.getBoundingClientRect():this.cloneRect(this.options.attach.getBounds());this.options.attach instanceof HTMLElement||(e.top+=document.getElementById("pixi").offsetTop+9);const t=e.left+e.width/2,n=this.popup.clientWidth,a=n/2+15,r=window.innerWidth-n/2-15;this.popup.style.left=`${Ae(t,a,r)}px`;const s=e.top+e.height/2+15;this.popup.style.top=`${s}px`,s+this.popup.clientHeight>window.innerHeight-15?(this.popup.style.transform="translate(-50%, -100%)",this.view.style.transformOrigin="bottom",this.popup.style.top=`${e.top-15}px`):(this.popup.style.transform="",this.view.style.transformOrigin=""),requestAnimationFrame(()=>this.popup.style.transitionDuration="")}static _build(){const e=document.createElement("div");e.classList.add("popup"),this.popup=e;const t=document.createElement("div");t.classList.add("popup-zoomer"),this.options.width&&(t.style.width=`${this.options.width/16}rem`),t.style.backgroundColor=this.options.background??"",t.style.color=this.options.textColor??"",e.appendChild(t),this.view=t;const n=document.createElement("div");if(n.innerText=this.options.title,n.classList.add("popup-title"),t.appendChild(n),this.title=n,this.options.description!==void 0){const a=document.createElement("div");a.innerText=this.options.description,a.classList.add("popup-desc"),t.appendChild(a),this.desc=a}if(this.buildContent(),this.options.editable){const a=document.createElement("div");a.innerText="click to edit",a.style.marginTop="4px",a.style.height="10px",t.appendChild(a),a.classList.add("popup-desc"),this.editText=a}if(this.options.options){const a=document.createElement("div");a.classList.add("popup-options"),this.options.options.forEach(r=>{const s=document.createElement("button");s.innerText=r.label,s.onclick=()=>{r.callback?.()},s.classList.add(r.type),a.appendChild(s)}),this.view.append(a)}}static buildContent(){}static close(){if(!this.popup||!this.active)return;window.removeEventListener("click",this.clickOutside,!0),this.popup.classList.add("exiting");const e=this.popup;setTimeout(()=>e.remove(),200),this.active=!1,this.persistent=!1,clearInterval(this.moveInterval),clearInterval(this.updateInterval)}static select(){!this.popup||!this.options.editable||(this.persistent=!0,this.view.classList.add("selected"),this.editText.style.transform="scale(0)",this.editText.style.height="0px",this.options.cancelableOnOpen||setTimeout(()=>window.addEventListener("click",this.clickOutside,!0),200))}static detach(){clearInterval(this.moveInterval)}static attach(e){clearInterval(this.moveInterval),this.moveInterval=setInterval(()=>this.movePosition(),hc),this.options.attach=e}}class ha extends ea{static onSnapChange=this.updateValues.bind(this);static divInput;static divLabel;static beatInput;static open(e){this.active||(super._open({attach:e,title:"Snap Options",width:200,editable:!0,cancelableOnOpen:!1}),le.on("snapChanged",this.onSnapChange))}static buildContent(){const e=document.createElement("div");e.classList.add("popup-flex"),this.view.appendChild(e);const t=document.createElement("div");t.classList.add("popup-row");const n=document.createElement("div");n.innerText="Snap to nearest ";const a=lt.create({value:y.chart.snap==0?0:Math.round(4/y.chart.snap),step:1,precision:0,min:0,max:1e3});a.onchange=f=>{if(f===void 0){this.updateValues();return}f==0?y.chart.snap=0:y.chart.snap=4/f,this.updateValues()};const r=document.createElement("div");r.innerText=this.suffixSnap()+" note",t.replaceChildren(n,a.view,r);const s=document.createElement("div");s.classList.add("popup-row");const o=document.createElement("div");o.innerText="Snap every";const l=lt.create({value:y.chart.snap,step:.001,precision:3,min:0});l.onchange=f=>{if(f===void 0){this.updateValues();return}f==0?y.chart.snap=0:y.chart.snap=f,this.updateValues()};const u=document.createElement("div");u.innerText=" beats",s.replaceChildren(o,l.view,u),e.replaceChildren(t,s),this.beatInput=l,this.divInput=a,this.divLabel=r}static updateValues(){document.activeElement==this.divInput.input||document.activeElement==this.beatInput.input||(this.divInput.value=y.chart.snap==0?0:Math.round(4/y.chart.snap),this.divLabel.innerText=this.suffixSnap()+" note",this.beatInput.value=y.chart.snap)}static suffixSnap(){const e=y.chart.snap==0?0:Math.round(4/y.chart.snap);return e%10==1&&e!=11?"st":e%10==2&&e!=12?"nd":e%10==3&&e!=13?"rd":"th"}static close(){!this.popup||!this.active||(super.close(),le.off("timingModified",this.onSnapChange))}}const gm={fontName:"Main",fontSize:10,fill:["#ffffff"]},Ou={4:15157287,8:4033015,12:11152884,16:8577607,24:14167723,32:15376696,48:15699179,64:7071886,96:8553090,192:8553090};class bm extends ye{renderer;children=[];constructor(e){super(),this.renderer=e;for(let t=0;t<2;t++){const n=new ye,a=new Ra,r=new Ee("4",gm);n.x=(t-.5)*(this.renderer.chart.gameType.notefieldWidth+48),a.rotation=Math.PI/4,a.lineStyle(1,0,1),a.beginFill(16777215),a.drawRect(-12,-12,24,24),a.endFill(),r.anchor.set(.5),n.addChild(a,r),this.addChild(n),n.eventMode="static",n.on("mouseenter",()=>ha.open(a)),n.on("mousedown",()=>ha.select()),n.on("mouseleave",()=>{ha.persistent||ha.close()})}}update(){this.y=this.renderer.getActualReceptorYPos(),this.visible=this.renderer.shouldDisplayBarlines();for(let e=0;e<2;e++){const t=this.children[e],n=t.children[0];n.tint=Ou[4/y.chart.snap]??7368816;const a=t.children[1];a.text=""+(y.chart.snap==0||4/y.chart.snap%1!=0?"":4/y.chart.snap)}}}class ym extends Pu{barContainer=new Ns(1500,{position:!0,scale:!0,tint:!0},16384,!0);bars;barTexture;constructor(e){super(e),this.addChild(this.backing),this.addChild(this.container),this.visible=!1,this.name="note-layout",this.backing.tint=0,this.backing.alpha=.3,this.barTexture=_i.create({resolution:this.manager.app.renderer.resolution}),this.bars=new De(this.barTexture),this.bars.anchor.set(.5),this.container.addChild(this.bars),this.populate()}update(){if(!y.chart.noteLayout.enabled){this.visible=!1;return}this.visible=!0,super.update()}populate(){const e=this.getChart();if(!e){si(this.barContainer.children,()=>!0),this.manager.app.renderer.render(this.barContainer,{renderTexture:this.barTexture});return}let t=0;const n=e.gameType.numCols,a=e.getNotedata().at(-1),r=this.manager.app.STAGE_HEIGHT-40;if(this.barTexture.resize(n*6,r),this.backingWidth=n*6+8,this.updateDimensions(),!a){si(this.barContainer.children,()=>!0),this.manager.app.renderer.render(this.barContainer,{renderTexture:this.barTexture});return}const s=a.beat+(Re(a)?a.hold:0),o=e.getSecondsFromBeat(s),l=e.timingData.getOffset();e.getNotedata().forEach(u=>{let f=this.barContainer.children[t];f||(f=new De(Se.WHITE),f.width=4,this.barContainer.addChild(f)),f.anchor.set(.5),f.height=1,f.x=(u.col+.5)*6;let c=vt(0,s,u.beat);if(y.chart.CMod&&(c=vt(l,o,u.second)),f.y=c*r,f.tint=Ou[u.quant],u.type=="Mine"&&(f.tint=8421504),t++,Re(u)){let d=this.barContainer.children[t];d||(d=new De(Se.WHITE),d.width=4,d.height=2,this.barContainer.addChild(d)),d.anchor.x=.5,d.anchor.y=0,d.x=(u.col+.5)*6;const h=(y.chart.CMod?e.getSecondsFromBeat(u.beat+u.hold)/o:(u.beat+u.hold)/s)*r+1;d.y=f.y,d.height=h-f.y,u.type=="Hold"&&(d.tint=10526880),u.type=="Roll"&&(d.tint=11379586),t++}}),si(this.barContainer.children,(u,f)=>f>=t),this.manager.app.renderer.render(this.barContainer,{renderTexture:this.barTexture})}}const ct=300,Xt=150,fc=[.045,.09,.18,.37,.18,.09,.045];class wm extends fn{max=0;barlines=new ye;backgroundRect=new mt("noBorder");background=new ye;backgroundLines=new ye;statText=new ye;meanText;medianText;modeText;stddevText;errorMS=[];texts=new ye;showEase=0;toggled=!1;drag=!1;dragStart=0;lastMode=this.manager.chartManager.getMode();constructor(e){super(e),this.visible=!1,this.background.addChild(this.backgroundRect),He(this.backgroundRect,"widget-bg"),this.addChild(this.background),this.addChild(this.backgroundLines),this.eventMode="static",this.on("mousedown",()=>{this.manager.chartManager.getMode()!=$.Play&&(this.drag=!0,this.dragStart=Date.now(),ii.stop("play-widget"))}),window.addEventListener("mousemove",p=>{this.drag&&(this.showEase+=p.movementY/-400)}),window.addEventListener("mouseup",()=>{this.drag&&(Date.now()-this.dragStart>400?this.toggled=this.showEase>.5:this.toggled=!this.toggled,ii.animate(this,{0:{showEase:"inherit"},1:{showEase:this.toggled?1:0}},.6,fi(.11,.71,.33,1.39),()=>{},"play-widget")),this.drag=!1}),this.on("mouseenter",()=>{!this.toggled&&this.manager.chartManager.getMode()!=$.Play&&ii.animate(this,{0:{showEase:"inherit"},1:{showEase:.05}},.6,fi(.11,.71,.33,1.39),()=>{},"play-widget")}),this.on("mouseleave",()=>{!this.toggled&&this.manager.chartManager.getMode()!=$.Play&&ii.animate(this,{0:{showEase:"inherit"},1:{showEase:0}},.6,fi(.11,.71,.33,1.39),()=>{},"play-widget")});const t=new Ee("Early",{fontName:"Main",fontSize:15});t.x=-300/2+5,t.y=-190,t.alpha=.3,this.background.addChild(t),He(t,"text-color");const n=new Ee("Late",{fontName:"Main",fontSize:15});n.anchor.x=1,n.x=ct/2-5,n.y=-190,n.alpha=.3,this.background.addChild(n),He(n,"text-color"),this.meanText=new Ee("-",{fontName:"Main",fontSize:15}),this.meanText.anchor.x=.5,this.meanText.x=ct/4*-1.5,this.meanText.y=-220,this.statText.addChild(this.meanText),this.medianText=new Ee("-",{fontName:"Main",fontSize:15}),this.medianText.anchor.x=.5,this.medianText.x=ct/4*-.5,this.medianText.y=-220,this.statText.addChild(this.medianText),this.modeText=new Ee("-",{fontName:"Main",fontSize:15}),this.modeText.anchor.x=.5,this.modeText.x=ct/4*.5,this.modeText.y=-220,this.statText.addChild(this.modeText),this.stddevText=new Ee("-",{fontName:"Main",fontSize:15}),this.stddevText.anchor.x=.5,this.stddevText.x=ct/4*1.5,this.stddevText.y=-220,this.statText.addChild(this.stddevText);const a=new Ee("Mean",{fontName:"Main",fontSize:10});a.anchor.x=.5,a.x=ct/4*-1.5,a.y=-230,this.statText.addChild(a);const r=new Ee("Median",{fontName:"Main",fontSize:10});r.anchor.x=.5,r.x=ct/4*-.5,r.y=-230,this.statText.addChild(r);const s=new Ee("Mode",{fontName:"Main",fontSize:10});s.anchor.x=.5,s.x=ct/4*.5,s.y=-230,this.statText.addChild(s);const o=new Ee("Std Dev.",{fontName:"Main",fontSize:10});o.anchor.x=.5,o.x=ct/4*1.5,o.y=-230,this.statText.addChild(o),this.statText.children.forEach(p=>{He(p,"text-color")});const l=new ye,u=new mt("noBorder");u.tint=3355443,u.alpha=.3,u.width=ct/2-10,u.height=30,u.y=-25,u.x=-300/4,u.pivot.x=(ct/2-10)/2,u.pivot.y=15;const f=new Ee("Adjust song offset",{fontName:"Main",fontSize:12});f.anchor.set(.5),f.x=-300/4,f.y=-25,l.addChild(u,f),l.eventMode="static",l.addEventListener("mouseenter",()=>{u.alpha=.6}),l.addEventListener("mousedown",p=>{p.stopImmediatePropagation(),this.adjustOffset("song")}),l.addEventListener("mouseleave",()=>{u.alpha=.3}),this.statText.addChild(l),He(f,"text-color");const c=new ye,d=new mt("noBorder");d.tint=3355443,d.alpha=.3,d.width=ct/2-10,d.height=30,d.y=-25,d.x=ct/4,d.pivot.x=(ct/2-10)/2,d.pivot.y=15,d.eventMode="static",c.addEventListener("mouseenter",()=>{d.alpha=.6}),c.addEventListener("mouseleave",()=>{d.alpha=.3});const h=new Ee("Adjust global offset",{fontName:"Main",fontSize:12});h.anchor.set(.5),h.x=ct/4,h.y=-25,c.addChild(d,h),He(h,"text-color"),c.eventMode="static",c.addEventListener("mouseenter",()=>{d.alpha=.6}),c.addEventListener("mousedown",p=>{p.stopImmediatePropagation(),this.adjustOffset("global")}),c.addEventListener("mouseleave",()=>{d.alpha=.3}),this.statText.addChild(c),this.addChild(this.background),this.addChild(this.backgroundLines),this.eventMode="static",this.addChild(this.statText),this.addChild(this.barlines),this.addChild(this.texts)}update(){this.visible=!!this.manager.chartManager.gameStats,this.x=-this.manager.chartManager.app.STAGE_WIDTH/2+20+ct/2,this.y=this.manager.chartManager.app.STAGE_HEIGHT/2-20,this.backgroundRect.width=ct+10,this.backgroundRect.height=Xt+260,this.backgroundRect.x=-300/2-5,this.backgroundRect.y=-410,this.visible=!!this.manager.chartManager.gameStats;for(const e of this.barlines.children)y.general.smoothAnimations?e.height=(e.targetHeight-e.height)*.2+e.height:e.height=e.targetHeight;this.lastMode!=this.manager.chartManager.getMode()&&(this.lastMode=this.manager.chartManager.getMode(),ii.animate(this,{0:{showEase:"inherit"},1:{showEase:this.manager.chartManager.getMode()==$.Play?1:0}},.6,fi(.11,.71,.33,1.39),()=>{},"play-widget")),y.general.smoothAnimations?this.y+=(1-Math.abs(this.showEase))*400:this.manager.chartManager.getMode()!=$.Play&&(this.y+=400)}newLine(){const e=new De(Se.WHITE);return e.smoothCount=0,e.targetHeight=0,e.anchor.y=1,e.anchor.x=.5,e.height=0,e.visible=!1,e}startPlay(){const e=this.manager.chartManager.gameStats;this.max=0,this.errorMS=[],this.meanText.text="-",this.medianText.text="-",this.modeText.text="-",this.stddevText.text="-",si(this.barlines.children,()=>!0),si(this.backgroundLines.children,()=>!0),si(this.texts.children,()=>!0);const t=wt.getCollection(y.play.timingCollection),n=t.getStandardWindows().length+1,a=Math.round(t.maxWindowMS());for(let p=0;p<a*2;p++){const m=this.newLine();m.width=ct/a/2,m.x=(p-a)*m.width,m.y=-50,this.barlines.addChild(m)}let r=0;for(const p of t.getStandardWindows().reverse()){const m=Math.round(p.getTimingWindowMS());if(m!=0){for(let g=-1;g<=1;g+=2){const b=new De(Se.WHITE);b.anchor.y=1,b.anchor.x=.5,b.height=Xt,b.tint=p.color,b.alpha=.2,b.width=1,b.x=m*g*ct/a/2,b.y=-50,this.backgroundLines.addChild(b)}for(let g=-m+a;g<m+a;g++)this.barlines.children[Math.round(g)].tint=p.color}}const s=new De(Se.WHITE);s.anchor.y=1,s.anchor.x=.5,s.height=Xt,s.alpha=.2,s.width=1,s.tint=8947848,s.y=-50,this.backgroundLines.addChild(s);for(const p of[...t.getStandardWindows(),t.getMissJudgement()]){const m=new Ee(p.name,{fontName:"Main",fontSize:15}),g=new Ee("0",{fontName:"Main",fontSize:15});m.tint=p.color,g.tint=p.color,g.name=p.id,this.texts.addChild(m),this.texts.addChild(g),m.x=-300/2+10,g.x=-300/2+140,m.y=130/n*r-Xt-220,g.y=130/n*r++-Xt-220,m.anchor.y=.5,g.anchor.y=.5,g.anchor.x=1}const o=this.manager.chartManager.loadedChart?.gameType.gameLogic.usesHoldTicks??!1,l=(o?0:t.getHoldWindows().length)+2;r=0;for(const p of o?[t.getMineJudgement()]:[...t.getHoldWindows(),t.getMineJudgement()]){const m=sn(p)?p.noteType:"Mine",g=new Ee(m,{fontName:"Main",fontSize:15}),b=new Ee("0",{fontName:"Main",fontSize:15});He(g,"text-color"),He(b,"text-color"),m!="Mine"&&(b.text="0 / "+this.manager.chartManager.loadedChart.getNotedata().filter(x=>x.type==m&&!x.fake).length),g.alpha=.8,b.alpha=.8,b.name=m,this.texts.addChild(g),this.texts.addChild(b),g.x=-300/2+160,b.x=-300/2+290,g.y=80/l*r-Xt-220,b.y=80/l*r++-Xt-220,g.anchor.y=.5,b.anchor.y=.5,b.anchor.x=1}const u=new Ee("Max Combo",{fontName:"Main",fontSize:15});He(u,"text-color");const f=new Ee("0",{fontName:"Main",fontSize:15});He(f,"text-color"),u.alpha=.8,f.alpha=.8,f.name="Combo",this.texts.addChild(u),this.texts.addChild(f),u.x=-300/2+160,f.x=-300/2+290,u.y=80/l*r-Xt-220,f.y=80/l*r++-Xt-220,u.anchor.y=.5,f.anchor.y=.5,f.anchor.x=1;const c=new Ee("0.00 / 0.00",{fontName:"Main",fontSize:20});He(c,"text-color"),c.alpha=.8,c.x=-300/2+225,c.y=-262,c.name="Score",this.texts.addChild(c),c.anchor.set(.5);const d=new Ee("Score / Current Score",{fontName:"Main",fontSize:13});He(d,"text-color"),d.alpha=.5,d.x=-300/2+225,d.y=-285,this.texts.addChild(d),d.anchor.set(.5);const h=new Ee("Play Statistics",{fontName:"Main",fontSize:13});h.y=-395,h.anchor.set(.5),He(h,"text-color"),this.texts.addChild(h),e.onJudge((p,m)=>{let g="";(oi(m)||pi(m))&&(g=m.id),sn(m)&&(g=m.noteType),Os(m)&&(g="Mine");const b=this.texts.getChildByName(g);if(sn(m)){const v=b.text.split(" / ")[1];b.text=e.getCount(m)+" / "+v}else Pn(m)||(b.text=e.getCount(m)+"");if(this.texts.getChildByName("Combo").text=e.getMaxCombo()+"",this.texts.getChildByName("Score").text=ue(e.getScore()*100,2).toFixed(2)+" / "+ue(e.getCumulativeScore()*100,2).toFixed(2),oi(m)||!pi(m)||p==null)return;const x=Math.round(p*1e3);for(let v=-3;v<=3;v++)this.barlines.children[x+a+v]&&(this.barlines.children[x+a+v].smoothCount+=fc[v+3],this.barlines.children[x+a+v].visible=!0,this.barlines.children[x+a+v].smoothCount>this.max&&(this.modeText.text=x+"ms",this.max=this.barlines.children[x+a+v].smoothCount));this.errorMS.push(p*1e3),this.meanText.text=Zu(this.errorMS).toFixed(2)+"ms",this.medianText.text=Ia(this.errorMS).toFixed(2)+"ms",this.stddevText.text=_c(this.errorMS).toFixed(2)+"ms",this.redraw()})}redraw(){for(const e of this.barlines.children)e.targetHeight=e.smoothCount*(Xt-20)/this.max}adjustOffset(e){const t=this.manager.chartManager.gameStats;if(!t)return;const n=Math.round(t.getMedian()*1e3)/1e3;if(n==0)return;t.applyOffset(-n),this.barlines.children.forEach(o=>{o.smoothCount=0});const a=wt.getCollection(y.play.timingCollection),r=Math.round(a.maxWindowMS());t.getDataPoints().forEach(o=>{if(oi(o.judgement)||!pi(o.judgement)||o.error===null)return;const l=Math.round(o.error*1e3);for(let u=-3;u<=3;u++)this.barlines.children[l+r+u]&&(this.barlines.children[l+r+u].smoothCount+=fc[u+3],this.barlines.children[l+r+u].visible=!0,this.barlines.children[l+r+u].smoothCount>this.max&&(this.modeText.text=l+"ms",this.max=this.barlines.children[l+r+u].smoothCount))}),this.redraw();const s=e=="global"?y.play.offset:this.manager.app.chartManager.loadedChart.timingData.getOffset();if(e=="global")y.play.offset=ue(y.play.offset-n,3);else if(e=="song"){const o=this.manager.app.chartManager.loadedChart.timingData.hasChartOffset()?this.manager.app.chartManager.loadedChart.timingData:this.manager.app.chartManager.loadedSM.timingData;o.setOffset(ue(o.getOffset()-n,3))}de.create(`Adjusted ${e} offset from ${ue(s,3).toFixed(3)} to ${ue(s-n,3).toFixed(3)}`)}}class vm extends fn{registeredSpinners=[];registeredToggles=[];registeredCheckboxes=[];changeRow;warpRow;fakeRow;view;collapseButton;lastSpeedMod=y.chart.CMod;rateSpinner;enteredMain=!1;constructor(e){super(e),this.visible=!1;const t=document.createElement("div");t.id="playback-options",y.general.showPlaybackOptions||t.classList.add("collapsed"),t.style.height="0px",le.on("resize",()=>{this.registeredToggles.forEach(D=>{D.update(!1)})}),document.getElementById("menubar")?.insertAdjacentElement("afterend",t),this.view=t;const n=document.createElement("button");n.classList.add("po-collapse"),n.tabIndex=-1;const a=pe.getIcon("CHEVRON",18);n.appendChild(a),y.general.showPlaybackOptions&&n.classList.add("toggled"),this.collapseButton=n,n.onclick=()=>{y.general.showPlaybackOptions=!y.general.showPlaybackOptions,t.classList.toggle("collapsed"),n.classList.toggle("toggled",!t.classList.contains("collapsed")),n.blur()},n.style.display="none",Ke(n,{onShow(D){D.setContent((t.classList.contains("collapsed")?"Show ":"Hide ")+"playback options")}});const r=this.createRow("Zoom"),s=this.createSpinner({value:y.chart.zoom*100,step:10,altStep:2,min:10,hardMin:0,onChange:D=>y.chart.zoom=D/100,getValue:()=>y.chart.zoom*100});r.appendChild(s),t.appendChild(r);const o=document.createElement("div"),l=document.createElement("h1");l.innerText="a",o.appendChild(l),ve.createKeybindTooltip(r)`Adjust playfield size ${"zoomOut"}/${"zoomIn"}`,t.appendChild(this.createSeparator());const u=this.createRow("Playback"),f=this.createSpinner({value:y.audio.rate*100,step:10,altStep:2,min:10,hardMin:0,onChange:D=>y.audio.rate=D/100,getValue:()=>y.audio.rate*100});u.appendChild(f),t.appendChild(u),this.rateSpinner=this.registeredSpinners.at(-1),ve.createKeybindTooltip(u)`Adjust audio playback rate  ${"rateDown"}/${"rateUp"}`;const c=document.createElement("div");c.style.gap="0.25rem",c.style.display="flex",c.style.alignItems="center";const d=this.createCheckbox({getValue:()=>y.audio.assistTick,value:y.audio.assistTick,onEl:pe.getIcon("CLAP",18),offEl:pe.getIcon("X_CLAP",18),onChange:D=>y.audio.assistTick=D});c.appendChild(d),ve.createKeybindTooltip(d)`Toggle assist tick ${"assistTick"}`;const h=this.createCheckbox({getValue:()=>y.audio.metronome,value:y.audio.metronome,onEl:pe.getIcon("METRONOME",18),offEl:pe.getIcon("X_METRONOME",18),onChange:D=>y.audio.metronome=D});c.appendChild(h),t.appendChild(c),ve.createKeybindTooltip(h)`Toggle metronome ${"metronome"}`,t.appendChild(this.createSeparator());const p=this.createRow("Scroll"),m=pe.getIcon("DBL_CHEVRON",16);m.style.padding="0.125rem";const g=pe.getIcon("DBL_CHEVRON",16);g.style.padding="0.125rem",g.style.transform="rotate(180deg)";const b=this.createToggle({values:[m,g],value:y.chart.reverse?1:0,getValue:()=>y.chart.reverse?1:0,onChange:(D,V)=>y.chart.reverse=V!=0});p.appendChild(b),t.appendChild(p),ve.createKeybindTooltip(p)`Change scroll direction ${"reverse"}`;const x=this.createRow("Speedmod"),v=this.createToggle({values:["X","C"],value:y.chart.CMod?1:0,getValue:()=>y.chart.CMod?1:0,onChange:D=>y.chart.CMod=D!="X"});ve.createKeybindTooltip(v)`Change speedmod type ${"XMod"}/${"CMod"}`;const C=this.createSpinner({value:y.chart.speed,step:25,altStep:5,min:10,hardMin:10,hardMax:35e3,onChange:D=>y.chart.speed=D,getValue:()=>y.chart.speed});x.appendChild(v),x.appendChild(C),t.appendChild(x),ve.createKeybindTooltip(C)`Adjust scroll speed ${"increaseScrollSpeed"}/${"decreaseScrollSpeed"}`,t.appendChild(this.createSeparator());const E=this.createRow("Speed Changes"),R=this.createToggle({values:["On","Off"],value:y.chart.doSpeedChanges?0:1,getValue:()=>y.chart.doSpeedChanges?0:1,onChange:D=>y.chart.doSpeedChanges=D=="On"});E.appendChild(R),t.appendChild(E),ve.createKeybindTooltip(E)`Allow scroll/speed events (XMod only) ${"doSpeedChanges"}`,this.changeRow=E;const O=this.createRow("Warped Notes"),H=this.createCheckbox({getValue:()=>y.chart.hideWarpedArrows,value:y.chart.hideWarpedArrows,onEl:pe.getIcon("X_EYE",18),offEl:pe.getIcon("EYE",18),onChange:D=>y.chart.hideWarpedArrows=D});O.appendChild(H),t.appendChild(O),ve.createKeybindTooltip(O)`Show/hide warped notes (CMod only) ${"hideWarpedArrows"}`,this.warpRow=O;const N=this.createRow("Faked Notes"),K=this.createCheckbox({getValue:()=>y.chart.hideFakedArrows,value:y.chart.hideFakedArrows,onEl:pe.getIcon("X_EYE",18),offEl:pe.getIcon("EYE",18),onChange:D=>y.chart.hideFakedArrows=D});N.appendChild(K),t.appendChild(N),ve.createKeybindTooltip(N)`Show/hide faked notes (CMod only) ${"hideFakedArrows"}`,this.fakeRow=N;const ae=pe.getIcon("VOLUME",22);ae.style.marginLeft="auto",ae.style.marginRight="-1rem",ae.style.height="1.375rem",ae.style.width="1.375rem",ae.style.alignSelf="center",t.appendChild(ae);const T=this.createRow("Master"),W=this.createSpinner({value:y.audio.masterVolume*100,step:5,altStep:1,min:0,max:200,hardMin:0,hardMax:200,onChange:D=>y.audio.masterVolume=D/100,getValue:()=>y.audio.masterVolume*100});T.appendChild(W),t.appendChild(T);const w=this.createRow("Song"),M=this.createSpinner({value:y.audio.songVolume*100,step:5,altStep:1,min:0,max:200,hardMin:0,hardMax:200,onChange:D=>y.audio.songVolume=D/100,getValue:()=>y.audio.songVolume*100});w.appendChild(M),t.appendChild(w);const G=this.createRow("FX"),B=this.createSpinner({value:y.audio.soundEffectVolume*100,step:5,altStep:1,min:0,max:200,hardMin:0,hardMax:200,onChange:D=>y.audio.soundEffectVolume=D/100,getValue:()=>y.audio.soundEffectVolume*100});G.appendChild(B),t.appendChild(G),this.changeRow.style.setProperty("--w",this.changeRow.offsetWidth/16+"rem"),this.warpRow.style.setProperty("--w",this.warpRow.offsetWidth/16+"rem"),this.fakeRow.style.setProperty("--w",this.fakeRow.offsetWidth/16+"rem"),this.changeRow.classList.toggle("hidden",y.chart.CMod),this.warpRow.classList.toggle("hidden",!y.chart.CMod),this.fakeRow.classList.toggle("hidden",!y.chart.CMod),he.playbackOptions||(t.style.display="none",n.style.display="none")}createRow(e){const t=document.createElement("div");t.classList.add("playback-options-row");const n=document.createElement("div");return n.classList.add("playback-options-label"),n.innerText=e,t.appendChild(n),t}createSeparator(){const e=document.createElement("div");return e.classList.add("po-separator"),e}createSpinner(e){const t=document.createElement("div");t.classList.add("po-spinner");const n=u=>{let f=y.general.spinnerStep;return u.getModifierState("Shift")?f=e.altStep??(e.step!==void 0?e.step/10:y.general.spinnerStep):f=e.step??y.general.spinnerStep,f},a=document.createElement("button");a.classList.add("po-spinner-btn"),a.innerText="-",a.onclick=u=>{l.currentValue-=n(u),e.min!==void 0&&l.currentValue<e.min&&(l.currentValue=e.min),o(!0)};const r=document.createElement("button");r.classList.add("po-spinner-btn"),r.innerText="+",r.onclick=u=>{l.currentValue+=n(u),e.max!==void 0&&l.currentValue>e.max&&(l.currentValue=e.max),o(!0)};const s=document.createElement("input");s.classList.add("po-spinner-input"),s.type="text";const o=(u=!0)=>{e.hardMin!==void 0&&l.currentValue<e.hardMin&&(l.currentValue=e.hardMin),e.hardMax!==void 0&&l.currentValue>e.hardMax&&(l.currentValue=e.hardMax),u&&e.onChange(l.currentValue),s.value=l.currentValue.toFixed()};s.addEventListener("wheel",u=>{u.preventDefault(),l.currentValue+=n(u)*u.deltaY/100*(y.chart.scroll.invertZoomScroll?-1:1)*y.chart.scroll.scrollSensitivity,e.max!==void 0&&l.currentValue>e.max&&(l.currentValue=e.max),e.min!==void 0&&l.currentValue<e.min&&(l.currentValue=e.min),o(!0)});const l={btnMinus:a,btnPlus:r,input:s,options:e,currentValue:e.value??0,update:o};return o(),t.replaceChildren(a,s,r),s.spellcheck=!1,s.onkeydown=u=>{u.key=="Enter"&&s.blur(),u.key=="Escape"&&(l.currentValue=e.getValue(),o(!1))},s.onfocus=()=>{s.select()},s.onblur=()=>{const u=this.parseString(s);if(u==null){l.currentValue=e.getValue(),o(!1);return}l.currentValue=u,o()},s.ondragstart=u=>u.preventDefault(),this.registeredSpinners.push(l),t}createToggle(e){const t=document.createElement("div");if(t.classList.add("po-toggle"),e.values.length==0)return t;const n=document.createElement("div");n.classList.add("po-toggle-highlight");const a=e.values.map((l,u)=>{if(typeof l=="string"){const f=document.createElement("div");return f.classList.add("po-toggle-item"),f.innerText=l,t.appendChild(f),f.onclick=()=>{o.currentValue!=u&&(o.currentValue=u,s())},f}else return l.onclick=()=>{o.currentValue!=u&&(o.currentValue=u,s())},t.appendChild(l),l});t.style.visibility="hidden",document.body.appendChild(t);const r=l=>{n.style.left=a[l].getBoundingClientRect().left-a[0].getBoundingClientRect().left+"px",n.style.width=a[l].getBoundingClientRect().width+"px",n.style.height=a[l].getBoundingClientRect().height+"px"},s=(l=!0)=>{l&&e.onChange(e.values[o.currentValue],o.currentValue),[...t.querySelectorAll(".active")].forEach(u=>u.classList.remove("active")),r(o.currentValue),a[o.currentValue].classList.add("active")},o={currentValue:e.value??0,options:e,update:s};return this.registeredToggles.push(o),s(!1),t.remove(),t.style.visibility="",t.appendChild(n),t}createCheckbox(e){const t=document.createElement("div");t.classList.add("ico-checkbox");const n=(r=!0)=>{r&&e.onChange(a.currentValue),a.options.onEl.style.display=a.currentValue?"":"none",a.options.offEl.style.display=a.currentValue?"none":""},a={currentValue:e.value??!0,options:e,update:n};return t.onclick=()=>{a.currentValue=!a.currentValue,n()},this.registeredCheckboxes.push(a),n(!1),t.replaceChildren(a.options.onEl,a.options.offEl),t}update(){!this.enteredMain&&this.manager.chartManager.loadedChart!==void 0&&he.menuBar&&(this.enteredMain=!0,this.view.style.height="",this.collapseButton.style.display="",document.getElementById("menubar")?.appendChild(this.collapseButton));for(const t of this.registeredSpinners)t.currentValue!=t.options.getValue()&&document.activeElement!=t.input&&(t.currentValue=t.options.getValue(),t.update(!1));for(const t of this.registeredToggles)t.currentValue!=t.options.getValue()&&(t.currentValue=t.options.getValue(),t.update(!1));for(const t of this.registeredCheckboxes)t.currentValue!=t.options.getValue()&&(t.currentValue=t.options.getValue(),t.update(!1));const e=this.manager.chartManager.getMode()==$.Play||this.manager.chartManager.getMode()==$.Record;this.rateSpinner.btnMinus.disabled=e,this.rateSpinner.btnPlus.disabled=e,this.rateSpinner.input.disabled=e,y.chart.CMod!=this.lastSpeedMod&&(this.lastSpeedMod=y.chart.CMod,this.changeRow.classList.toggle("hidden",y.chart.CMod),this.warpRow.classList.toggle("hidden",!y.chart.CMod),this.fakeRow.classList.toggle("hidden",!y.chart.CMod))}parseString(e){try{const t=Ec.evaluate(e.value);return isFinite(t)?t:0}catch{return null}}}class Yn extends ye{pool=[];options;constructor(e){super(),this.options=e}createChild(){if(this.pool.length==0&&this.options.maxPoolSize!==void 0&&this.children.length>=this.options.maxPoolSize)return;const e=this.pool.pop()??this.options.create();return this.addChild(e),e._disabledTime=Date.now(),e}destroyChild(e){this.children.includes(e)&&(e.removeFromParent(),e.removeAllListeners(),e.eventMode="auto",e._disabledTime=Date.now(),this.pool.push(e))}destroyAll(){this.children.forEach(e=>e._disabledTime=Date.now()),this.pool.push(...this.children),this.children.forEach(e=>{e.removeAllListeners(),e.eventMode="auto"}),this.removeChildren()}_render(e){super._render(e);const t=Date.now();for(;t-this.pool[0]?._disabledTime>(this.options.destroyTimer??5e3);)this.pool.shift().destroy()}}const mi={BPMS:9182254,STOPS:4934913,DELAYS:217453,WARPS:9243998,FAKES:4868682,COMBOS:939078,SPEEDS:2968693,LABELS:7747359,SCROLLS:3557006,TIMESIGNATURES:5392684,TICKCOUNTS:1594906,BGCHANGES:8460415,FGCHANGES:8857115,ATTACKS:1856083};class xm extends ye{renderer;areaPool=new Yn({create:()=>{const e=new De(Se.WHITE);return Object.assign(e,{alpha:.2,width:this.renderer.chart.gameType.notefieldWidth+128}),e.anchor.set(.5,0),e}});timingAreaMap=new Map;timingEvents=[];timingDirty=!0;constructor(e){super(),this.renderer=e,this.addChild(this.areaPool);const t=()=>this.timingDirty=!0;le.on("timingModified",t),this.on("destroyed",()=>le.off("timingModified",t))}update(e,t){this.timingDirty&&(this.timingAreaMap.clear(),this.areaPool.destroyAll(),this.timingDirty=!1,this.timingEvents=this.renderer.chart.timingData.getTimingData("STOPS","WARPS","DELAYS","FAKES")),this.visible=this.renderer.shouldDisplayBarlines();for(const n of this.timingEvents){if(n.beat>t)break;if(this.shouldDrawEvent(n,e,t)&&!this.timingAreaMap.has(n)){const a=this.areaPool.createChild();if(!a)break;a.tint=mi[n.type],this.timingAreaMap.set(n,a)}}for(const[n,a]of this.timingAreaMap.entries()){if(!this.shouldDrawEvent(n,e,t)){this.timingAreaMap.delete(n),this.areaPool.destroyChild(a);continue}let r=y.chart.CMod?this.renderer.getYPosFromSecond(n.second):this.renderer.getYPosFromBeat(n.beat),s=r;switch(n.type){case"STOPS":case"DELAYS":{y.chart.CMod&&n.value>0?s=this.renderer.getYPosFromSecond(n.second+n.value):n.value<0&&(s=this.renderer.getYPosFromBeat(this.renderer.chart.getBeatFromSeconds(n.second+1e-4)));break}case"FAKES":{s=this.renderer.getYPosFromBeat(n.beat+n.value);break}case"WARPS":{y.chart.CMod||(s=this.renderer.getYPosFromBeat(n.beat+n.value));break}}s<r&&([s,r]=[r,s]);const o=s-r;a.y=r,a.height=o}}shouldDrawEvent(e,t,n){return(e.type=="STOPS"||e.type=="DELAYS")&&e.second+Math.abs(e.value)<=this.renderer.chart.timingData.getSecondsFromBeat(t)||(e.type=="WARPS"||e.type=="FAKES")&&e.beat+e.value<t||(e.type=="STOPS"||e.type=="DELAYS")&&!(!y.chart.CMod&&e.value<0||y.chart.CMod&&e.value>0)||e.type=="WARPS"&&y.chart.CMod?!1:e.beat<=n}}const Ge={chart:{title:"Chart Timing Column",desc:"Events in this column are only used by this difficulty",convertText:"Convert to song timing",buttonOne:{text:"Copy chart events",tooltip:"Copies chart events from this column to song timing",tooltipAll:"Copies offset and chart events from all columns to song timing",action:(i,e)=>{i.copyColumnsToSimfile([e])},actionAll:i=>{i.copyAllToSimfile()}},buttonTwo:{text:"Delete chart events",tooltip:"Reverts this column to the events in song timing, deleting any difficulty-specific events",tooltipAll:"Reverts offset and all columns to the events in song timing, deleting any difficulty-specific events",action:(i,e)=>{i.deleteColumns([e])},actionAll:i=>{i.deleteAllChartSpecific()}}},song:{title:"Song Timing Column",desc:"Events in this column are used by all difficulties (unless overridden)",convertText:"Convert to chart timing",buttonOne:{text:"Copy song events",tooltip:"Copies song events from this column to chart timing",tooltipAll:"Copies offset and song events from all columns to chart timing",action:(i,e)=>{i.copyColumnsFromSimfile([e])},actionAll:i=>{i.copyAllFromSimfile()}},buttonTwo:{text:"Don't copy song events",tooltip:"Converts this column to chart timing without copying any song events",tooltipAll:"Converts offset and all columns to chart timing without copying any song events",action:(i,e)=>{i.createChartColumns([e])},actionAll:i=>{i.createEmptyData()}}}},Fi={chart:{title:"Chart Specific Offset",desc:"This offset is only used by this difficulty",convertText:"Convert to song timing",buttonOne:{text:"Copy chart offset",tooltip:"Sets the song offset to this chart offset",action:i=>{i.copyOffsetToSimfile()}},buttonTwo:{text:"Revert to song offset",tooltip:"Reverts to the song offset, removing the chart-specific offset",action:i=>{i.removeChartOffset()}}},song:{title:"Song Specific Offset",desc:"This offset is used by all difficulties (unless overridden)",convertText:"Convert to chart timing",buttonOne:{text:"Copy song offset",tooltip:"Copies song offset to the chart offset",action:i=>{i.setOffset(i.getOffset())}},buttonTwo:{text:"Don't copy song offset",tooltip:"Sets the new chart offset to 0",action:i=>{i.setOffset(0)}}}};class hs extends ea{static app;static timingGrid;static onTimingChange=this.updateValues.bind(this);static open(e){this.active||(this.app=e,super._open({title:"Manage Split Timing",editable:!1,attach:document.getElementById("split-timing"),cancelableOnOpen:!0,clickHandler:t=>{!this.popup?.contains(t.target)&&!document.getElementById("split-timing")?.contains(t.target)&&this.close()}}),le.on("timingModified",this.onTimingChange))}static buildContent(){this.popup.id="split-timing";const e=document.createElement("div");e.classList.add("split-timing-grid"),this.timingGrid=e;const t=this.buildModifyGrid();this.updateValues(),this.view.appendChild(e),this.view.appendChild(t)}static updateValues(){this.timingGrid.replaceChildren();const e=document.createElement("div");e.classList.add("split-timing-row"),e.style.backgroundColor="rgba(0, 0, 0, 0.3";const t=document.createElement("div");t.innerText="OFFSET";const n=this.app.chartManager.loadedChart.timingData.hasChartOffset(),a=n?"chart":"song",r=document.createElement("div");r.innerText=n?"C":"S",Ke(r,{content:Fi[a].desc});const s=document.createElement("button");s.innerText=Fi[a].buttonOne.text,Ke(s,{content:Fi[a].buttonOne.tooltip}),s.onclick=()=>{Fi[a].buttonOne.action(this.app.chartManager.loadedChart.timingData)};const o=document.createElement("button");o.innerText=Fi[a].buttonTwo.text,o.classList.toggle("delete",n),Ke(o,{content:Fi[a].buttonTwo.tooltip}),o.onclick=()=>{Fi[a].buttonTwo.action(this.app.chartManager.loadedChart.timingData)},e.replaceChildren(t,r,s,o),this.timingGrid.appendChild(e);for(const l of _a)this.timingGrid.appendChild(this.buildRow(l));return e}static buildRow(e){const t=document.createElement("div");t.classList.add("split-timing-row"),t.style.backgroundColor=Sa(mi[e].toString(16).padStart(6,"0"),"#333333",.75);const n=document.createElement("div");n.innerText=e;const a=this.app.chartManager.loadedChart.timingData.isPropertyChartSpecific(e),r=a?"chart":"song",s=document.createElement("div");s.innerText=a?"C":"S",Ke(s,{content:Ge[r].desc});const o=document.createElement("button");o.innerText=Ge[r].buttonOne.text,Ke(o,{content:Ge[r].buttonOne.tooltip}),o.onclick=()=>{Ge[r].buttonOne.action(this.app.chartManager.loadedChart.timingData,e)};const l=document.createElement("button");return l.innerText=Ge[r].buttonTwo.text,l.classList.toggle("delete",a),Ke(l,{content:Ge[r].buttonTwo.tooltip}),l.onclick=()=>{Ge[r].buttonTwo.action(this.app.chartManager.loadedChart.timingData,e)},t.replaceChildren(n,s,o,l),t}static buildModifyGrid(){const e=document.createElement("div");e.classList.add("split-timing-grid");const t=document.createElement("div");t.classList.add("split-timing-modify-row"),t.style.backgroundColor="rgba(0, 0, 0, 0.3";const n=document.createElement("div");n.innerText="Convert all to chart timing";const a=document.createElement("button");a.innerText=Ge.song.buttonOne.text,Ke(a,{content:Ge.song.buttonOne.tooltipAll}),a.onclick=()=>{Ge.song.buttonOne.actionAll(this.app.chartManager.loadedChart.timingData),a.blur()};const r=document.createElement("button");r.innerText=Ge.song.buttonTwo.text,r.classList.add("delete"),Ke(r,{content:Ge.song.buttonTwo.tooltipAll}),r.onclick=()=>{Ge.song.buttonTwo.actionAll(this.app.chartManager.loadedChart.timingData),r.blur()},t.replaceChildren(n,a,r);const s=document.createElement("div");s.classList.add("split-timing-modify-row"),s.style.backgroundColor="rgba(0, 0, 0, 0.3";const o=document.createElement("div");o.innerText="Convert all to song timing";const l=document.createElement("button");l.innerText=Ge.chart.buttonOne.text,Ke(l,{content:Ge.chart.buttonOne.tooltipAll}),l.onclick=()=>{Ge.chart.buttonOne.actionAll(this.app.chartManager.loadedChart.timingData),l.blur()};const u=document.createElement("button");return u.innerText=Ge.chart.buttonTwo.text,Ke(u,{content:Ge.chart.buttonTwo.tooltipAll}),u.onclick=()=>{Ge.chart.buttonTwo.actionAll(this.app.chartManager.loadedChart.timingData),u.blur()},s.replaceChildren(o,l,u),e.replaceChildren(t,s),e}static close(){!this.popup||!this.active||super.close()}}class fs extends ea{static draggedElement;static dragOffsetX=0;static dragOffsetY=0;static grid;static leftovers;static boundaryCache=[];static open(){this.active||super._open({title:"Reorder Timing Tracks",editable:!1,attach:document.getElementById("toggle-tracks"),cancelableOnOpen:!0,clickHandler:e=>{!this.popup?.contains(e.target)&&!this.draggedElement?.contains(e.target)&&!document.getElementById("toggle-tracks")?.contains(e.target)&&this.close()}})}static buildContent(){this.popup.id="timing-track-order";const e=document.createElement("div");e.classList.add("track-grid-options");const t=document.createElement("button");t.classList.add("delete"),t.innerText="Reset",t.onclick=()=>{y.chart.timingEventOrder.left=structuredClone(_o.chart.timingEventOrder.left),y.chart.timingEventOrder.right=structuredClone(_o.chart.timingEventOrder.right),this.clearBoundaries(),this.grid?.replaceChildren(),this.leftovers?.replaceChildren();const r=[..._a];for(const o of y.chart.timingEventOrder.left){const l=this.makeDraggableTrack(o);l.classList.add("left"),this.grid?.appendChild(l),r.splice(r.indexOf(o),1)}const s=document.createElement("div");s.classList.add("draggable-track"),s.innerText="PLAYFIELD",s.style.backgroundColor="#2D2D2D",s.style.padding="1.25rem 0.625rem",s.style.writingMode="horizontal-tb",s.addEventListener("mousedown",o=>this.startDragging(o,s)),s.dataset.type="PLAYFIELD",this.grid?.appendChild(s);for(const o of y.chart.timingEventOrder.right){const l=this.makeDraggableTrack(o);l.classList.add("right"),this.grid?.appendChild(l),r.splice(r.indexOf(o),1)}for(const o of r)this.leftovers?.appendChild(this.makeLeftoverTrack(o))},this.grid=document.createElement("div"),this.grid.classList.add("track-grid"),this.view.appendChild(this.grid),this.view.appendChild(e);const n=[..._a];for(const r of y.chart.timingEventOrder.left){const s=this.makeDraggableTrack(r);s.classList.add("left"),this.grid.appendChild(s),n.splice(n.indexOf(r),1)}const a=document.createElement("div");a.classList.add("draggable-track"),a.innerText="PLAYFIELD",a.style.backgroundColor="#2D2D2D",a.style.padding="1.25rem 0.625rem",a.style.writingMode="horizontal-tb",a.addEventListener("mousedown",r=>this.startDragging(r,a)),a.dataset.type="PLAYFIELD",this.grid.appendChild(a);for(const r of y.chart.timingEventOrder.right){const s=this.makeDraggableTrack(r);s.classList.add("right"),this.grid.appendChild(s),n.splice(n.indexOf(r),1)}this.leftovers=document.createElement("div"),this.leftovers.classList.add("track-selector"),e.appendChild(this.leftovers),e.appendChild(t);for(const r of n)this.leftovers.appendChild(this.makeLeftoverTrack(r))}static makeDraggableTrack(e){const t=document.createElement("div");t.classList.add("draggable-track");const n=document.createElement("div");n.classList.add("draggable-track-text"),n.innerText=e,t.style.backgroundColor=Sa(mi[e].toString(16).padStart(6,"0"),"#333333",.7),t.appendChild(n);let a=!0;const r=pe.getIcon("TRASH",16);return r.addEventListener("click",()=>{if(!a)return;a=!1,this.deleteTrack(e),t.classList.add("exiting"),setTimeout(()=>t.remove(),400);const s=this.makeLeftoverTrack(e);s.classList.add("entering"),setTimeout(()=>s.classList.remove("entering"),400),this.leftovers?.appendChild(s),this.clearBoundaries()}),t.appendChild(r),t.addEventListener("mousedown",s=>{a&&(r.contains(s.target)||this.startDragging(s,t))}),t.dataset.type=e,t}static makeLeftoverTrack(e){const t=document.createElement("div");t.classList.add("leftover-track");const n=pe.getIcon("PLUS",8);t.append(n);const a=document.createElement("div");a.classList.add("leftover-track-text"),a.innerText=e,t.style.backgroundColor=Sa(mi[e].toString(16).padStart(6,"0"),"#333333",.7),t.appendChild(a);let r=0,s=0,o=!1,l=!1;return t.addEventListener("mousedown",()=>{o=!0}),t.addEventListener("mousemove",u=>{if(!(!o||l)&&(r+=u.movementX,s+=u.movementY,r*r+s*s>15)){l=!0;const f=this.makeDraggableTrack(e);this.grid?.appendChild(f),this.clearBoundaries();const c=t.getBoundingClientRect(),d=this.getClosestSlot(c.left),h=y.chart.timingEventOrder.left.concat(["PLAYFIELD"],y.chart.timingEventOrder.right);h.splice(d,0,e),this.saveOptions(h),h.forEach(p=>{const m=this.grid?.querySelector(`div[data-type=${p}]`);this.grid?.appendChild(m),p!="PLAYFIELD"&&(m?.classList.remove("left","right"),y.chart.timingEventOrder.left.includes(p)&&m?.classList.add("left"),y.chart.timingEventOrder.right.includes(p)&&m?.classList.add("right"))}),this.startDragging(u,f,u.clientX,u.clientY),y.general.smoothAnimations?(t.style.width=t.clientWidth+"px",t.style.transition="0.4s cubic-bezier(0, 0.91, 0.34, 1.05)",setTimeout(()=>{t.style.width="0px",t.style.opacity="0",t.style.padding="0",t.style.fontSize="0"},10),setTimeout(()=>t.remove(),400)):t.remove()}}),t.addEventListener("mouseup",()=>{if(!o||l)return;l=!0,y.chart.timingEventOrder.right.push(e),y.general.smoothAnimations?(t.style.width=t.clientWidth+"px",t.style.transition="0.4s cubic-bezier(0, 0.91, 0.34, 1.05)",setTimeout(()=>{t.style.width="0px",t.style.opacity="0",t.style.padding="0",t.style.fontSize="0"},10),setTimeout(()=>t.remove(),400)):t.remove();const u=this.makeDraggableTrack(e);u.classList.add("entering"),u.classList.add("right"),setTimeout(()=>u.classList.remove("entering"),400),this.grid?.appendChild(u),this.clearBoundaries()}),t}static startDragging(e,t,n,a){if(!this.popup)return;this.draggedElement=t.cloneNode(!0),this.draggedElement.style.position="fixed";const r=t.getBoundingClientRect(),s=this.popup.getBoundingClientRect();!n||!a?(this.dragOffsetX=e.clientX-r.left,this.dragOffsetY=e.clientY-r.top,this.draggedElement.style.left=r.left-s.left+"px",this.draggedElement.style.top=r.top-s.top+"px"):(this.dragOffsetX=r.width/2,this.dragOffsetY=r.height/4*3,this.draggedElement.style.left=n-r.width/2-s.left+"px",this.draggedElement.style.top=a-r.height/4*3-s.top+"px",this.draggedElement.classList.add("entering")),this.draggedElement.style.boxShadow="6px 6px 6px #222",this.draggedElement.style.transition="none",t.style.opacity="0.03",this.popup.appendChild(this.draggedElement);const o=y.chart.timingEventOrder.left.concat(["PLAYFIELD"],y.chart.timingEventOrder.right),l=t.dataset.type;let u=o.indexOf(l);const f=o.indexOf(l),c=h=>{this.draggedElement.style.left=h.clientX-this.dragOffsetX-s.left+"px",this.draggedElement.style.top=h.clientY-this.dragOffsetY-s.top+"px";let p=this.getClosestSlot(h.clientX-this.dragOffsetX);Math.abs(h.clientY-this.dragOffsetY-s.top-(r.top-s.top))>140&&(p=f),u!=p&&(o.splice(u,1),o.splice(p,0,l),this.saveOptions(o),o.forEach(m=>{const g=this.grid?.querySelector(`div[data-type=${m}]`);this.grid?.appendChild(g),m!="PLAYFIELD"&&(g?.classList.remove("left","right"),y.chart.timingEventOrder.left.includes(m)&&g?.classList.add("left"),y.chart.timingEventOrder.right.includes(m)&&g?.classList.add("right"))}),l!="PLAYFIELD"&&(this.draggedElement?.classList.remove("left","right"),y.chart.timingEventOrder.left.includes(l)&&this.draggedElement?.classList.add("left"),y.chart.timingEventOrder.right.includes(l)&&this.draggedElement?.classList.add("right")),u=p)};window.addEventListener("mousemove",c);const d=()=>{this.draggedElement?.remove(),this.draggedElement=void 0,window.removeEventListener("mousemove",c),t.style.opacity="",this.clearBoundaries(),window.removeEventListener("mouseup",d)};window.addEventListener("mouseup",d)}static saveOptions(e){const t=e.indexOf("PLAYFIELD");t!=-1&&(y.chart.timingEventOrder.left=e.slice(0,t),y.chart.timingEventOrder.right=e.slice(t+1))}static deleteTrack(e){const t=y.chart.timingEventOrder.left.indexOf(e);t!=-1&&y.chart.timingEventOrder.left.splice(t,1);const n=y.chart.timingEventOrder.right.indexOf(e);n!=-1&&y.chart.timingEventOrder.right.splice(n,1),y.chart.timingEventOrder.left=[...y.chart.timingEventOrder.left],y.chart.timingEventOrder.right=[...y.chart.timingEventOrder.right]}static getClosestSlot(e){this.boundaryCache.length==0&&this.getBoundaries();let t=-1,n=999999,a=999999;for(let r=0;r<this.boundaryCache.length;r++){const s=Math.abs(e-this.boundaryCache[r][1].left);if(s<n&&(n=s,t=r),s>a)break;a=s}return t}static getBoundaries(){if(this.grid){for(const e of this.grid.children)this.boundaryCache.push([e,e.getBoundingClientRect()]);this.boundaryCache.sort((e,t)=>e[1].left-t[1].left)}}static clearBoundaries(){this.boundaryCache=[]}static close(){!this.popup||!this.active||(super.close(),this.clearBoundaries())}}class _m extends fn{view;playbackBar;skipStart;skipEnd;play;playIcon;stopIcon;record;playtest;timeCounter;beatCounter;min;sec;millis;beat;beatDropdown;editBar;editSteps;editTiming;stepsContainer;timingContainer;editChoiceContainer;addTimingEvent;splitTiming;toggleTimingTracks;detectSync;offsetCounter;offset;noteArrows=[];noteArrowMask;lastTime=null;lastBeat=null;lastOffset=null;lastMode=$.Edit;lastTimingMode=Ce.Off;lastHover=0;lastPlaying=!1;hovering=!1;trackingMovement=!0;idleFrames=0;lastBounds;constructor(e){super(e);const t=document.createElement("div");t.id="status-widget",document.getElementById("view-wrapper")?.appendChild(t),he.viewMode&&t.classList.add("collapsed"),this.playbackBar=document.createElement("div"),this.playbackBar.classList.add("playback-bar"),this.editBar=document.createElement("div"),this.editBar.classList.add("edit-bar"),this.skipStart=document.createElement("button"),this.skipStart.tabIndex=-1;const n=pe.getIcon("SKIP_START",36);this.skipStart.appendChild(n),this.skipStart.onclick=()=>{this.manager.chartManager.beat=Math.max(0,this.manager.chartManager.loadedChart.getBeatFromSeconds(0)),this.skipStart.blur()},ve.createKeybindTooltip(this.skipStart)`Skip to start ${"jumpSongStart"}`,this.skipEnd=document.createElement("button"),this.skipEnd.tabIndex=-1;const a=pe.getIcon("SKIP_END",36);this.skipEnd.appendChild(a),this.skipEnd.onclick=()=>{this.manager.chartManager.beat=this.manager.chartManager.loadedChart.getBeatFromSeconds(this.manager.chartManager.chartAudio.getSongLength()),this.skipEnd.blur()},ve.createKeybindTooltip(this.skipEnd)`Skip to end ${"jumpSongEnd"}`,this.play=document.createElement("button"),this.play.tabIndex=-1;const r=pe.getIcon("PLAY",40);this.play.appendChild(r),this.playIcon=r;const s=pe.getIcon("STOP",32);this.play.appendChild(s),this.stopIcon=s,this.stopIcon.style.display="none",this.play.onclick=()=>{(this.manager.chartManager.getMode()==$.Record||this.manager.chartManager.getMode()==$.Play)&&this.manager.chartManager.setMode($.Edit),this.manager.chartManager.playPause(),this.play.blur()},ve.createKeybindTooltip(this.play)`Play/Pause ${"playback"}`,this.record=document.createElement("button"),this.record.tabIndex=-1;const o=pe.getIcon("RECORD",36,void 0,"red");this.record.appendChild(o),this.record.onclick=()=>{this.manager.chartManager.setMode($.Record),this.record.blur()},ve.createKeybindTooltip(this.record)`Record ${"recordMode"}`,(he.viewMode||!he.recordMode)&&(this.record.style.display="none"),this.playtest=document.createElement("button"),this.playtest.tabIndex=-1;const l=pe.getIcon("PLAYTEST",30);this.playtest.appendChild(l),this.playtest.onclick=()=>{this.manager.chartManager.setMode($.Play),this.playtest.blur()},ve.createKeybindTooltip(this.playtest)`Playtest ${"playMode"}`,he.playMode||(this.playtest.style.display="none");const u=document.createElement("div");u.classList.add("playback-separator"),this.timeCounter=document.createElement("div"),this.timeCounter.classList.add("playback-counter");const f=document.createElement("div");f.style.display="flex",f.classList.add("playback-counter-main");const c=document.createElement("div");c.classList.add("inlineEdit"),c.innerText="00",c.spellcheck=!1,c.contentEditable="true",c.style.maxWidth=`${27/16}rem`,c.onkeydown=M=>{M.key=="Enter"&&c.blur(),M.key=="Escape"&&(c.innerText=Math.floor(Math.abs(this.manager.chartManager.time)/60).toString().padStart(2,"0"),c.blur())},c.onfocus=()=>setTimeout(()=>this.selectText(c),25),c.onblur=()=>this.updateTime(),c.ondragstart=M=>M.preventDefault();const d=document.createElement("div");d.classList.add("inlineEdit"),d.innerText="00",d.spellcheck=!1,d.contentEditable="true",d.style.maxWidth=`${18/16}rem`,d.onkeydown=M=>{M.key=="Enter"&&d.blur(),M.key=="Escape"&&(d.innerText=Math.floor(Math.abs(this.manager.chartManager.time)%60).toString().padStart(2,"0"),d.blur())},d.onfocus=()=>setTimeout(()=>this.selectText(d),25),d.onblur=()=>this.updateTime(),d.ondragstart=M=>M.preventDefault();const h=document.createElement("div");h.classList.add("inlineEdit"),h.innerText="000",h.spellcheck=!1,h.contentEditable="true",h.style.maxWidth=`${27/16}rem`,h.onkeydown=M=>{M.key=="Enter"&&h.blur(),M.key=="Escape"&&(h.innerText=(ue(Math.abs(this.manager.chartManager.time)%1,3)*1e3).toString().padStart(3,"0"),h.blur())},h.onfocus=()=>setTimeout(()=>this.selectText(h),25),h.onblur=()=>this.updateTime(),h.ondragstart=M=>M.preventDefault(),this.min=c,this.sec=d,this.millis=h;const p=document.createElement("div");p.classList.add("playback-counter-label"),p.innerText="Time",f.appendChild(c),f.appendChild(document.createTextNode(":")),f.appendChild(d),f.appendChild(document.createTextNode(".")),f.appendChild(h),this.timeCounter.appendChild(f),this.timeCounter.appendChild(p);const m=document.createElement("div");m.classList.add("playback-separator"),this.beatCounter=document.createElement("div"),this.beatCounter.classList.add("playback-counter");const g=document.createElement("div");g.style.display="flex",g.classList.add("playback-counter-main");const b=document.createElement("div");b.classList.add("inlineEdit"),b.innerText="0.000",b.spellcheck=!1,b.contentEditable="true",b.onkeydown=M=>{if(M.key=="Enter"&&b.blur(),M.key=="Escape"){if(this.beatDropdown.value=="Measure"){const G=this.manager.chartManager.loadedChart?.timingData?.getMeasure(this.manager.chartManager.beat)??this.manager.chartManager.beat/4;b.innerText=ue(G,3).toFixed(3)}else b.innerText=ue(this.manager.chartManager.beat,3).toFixed(3);b.blur()}},b.onfocus=()=>{setTimeout(()=>this.selectText(b),25)},b.onblur=()=>this.updateBeat(),b.ondragstart=M=>M.preventDefault(),this.beat=b,this.beatDropdown=li.create(["Beat","Measure"],"Beat"),this.beatDropdown.view.querySelector(".dropdown-selected").classList.add("playback-counter-label"),this.beatCounter.appendChild(g),g.appendChild(b),this.beatCounter.appendChild(this.beatDropdown.view),this.beatDropdown.onChange(()=>{if(this.beatDropdown.value=="Measure"){const M=this.manager.chartManager.loadedChart?.timingData?.getMeasure(this.manager.chartManager.beat)??this.manager.chartManager.beat/4;b.innerText=ue(M,3).toFixed(3)}else b.innerText=ue(this.manager.chartManager.beat,3).toFixed(3)}),this.playbackBar.appendChild(this.skipStart),this.playbackBar.appendChild(this.skipEnd),this.playbackBar.appendChild(this.play),this.playbackBar.appendChild(this.record),this.playbackBar.appendChild(this.playtest),this.playbackBar.appendChild(u),this.playbackBar.appendChild(this.timeCounter),this.playbackBar.appendChild(m),this.playbackBar.appendChild(this.beatCounter),this.editSteps=document.createElement("button"),this.editSteps.tabIndex=-1,this.editSteps.classList.add("edit-fancy-button");const x=pe.getIcon("FEET",24);x.style.marginBottom=`${2/16}rem`,this.editSteps.appendChild(x),this.editSteps.appendChild(document.createTextNode("Edit Steps")),this.editSteps.onclick=()=>{this.manager.chartManager.editTimingMode=Ce.Off,this.editSteps.blur()},this.editSteps.classList.add("active"),this.editTiming=document.createElement("button"),this.editTiming.tabIndex=-1,this.editTiming.classList.add("edit-fancy-button");const v=pe.getIcon("METRONOME",24);v.style.marginBottom=`${2/16}rem`,this.editTiming.appendChild(v),this.editTiming.appendChild(document.createTextNode("Edit Timing")),this.editTiming.onclick=()=>{this.manager.chartManager.editTimingMode=Ce.Edit,this.editTiming.blur()};const C=document.createElement("div");C.classList.add("playback-separator");const E=document.createElement("div");E.classList.add("edit-bar-left"),E.appendChild(this.editSteps),E.appendChild(this.editTiming),E.appendChild(C),this.editBar.appendChild(E),this.editChoiceContainer=document.createElement("div"),this.editChoiceContainer.classList.add("edit-choice-container"),this.stepsContainer=document.createElement("div"),this.stepsContainer.classList.add("edit-steps-container"),this.timingContainer=document.createElement("div"),this.timingContainer.classList.add("edit-timing-container"),this.editChoiceContainer.appendChild(this.stepsContainer),this.editChoiceContainer.appendChild(this.timingContainer),this.addTimingEvent=document.createElement("button"),this.addTimingEvent.tabIndex=-1;const R=pe.getIcon("ADD_EVENT",32);this.addTimingEvent.appendChild(R),this.addTimingEvent.onclick=()=>{this.manager.chartManager.editTimingMode==Ce.Add?this.manager.chartManager.editTimingMode=Ce.Edit:this.manager.chartManager.editTimingMode=Ce.Add,this.addTimingEvent.blur()},this.timingContainer.appendChild(this.addTimingEvent),ve.createKeybindTooltip(this.addTimingEvent)`Add timing events ${"toggleAddTiming"}`;const O=document.createElement("div");O.classList.add("playback-separator"),this.timingContainer.appendChild(O),this.splitTiming=document.createElement("button"),this.splitTiming.tabIndex=-1;const H=pe.getIcon("SPLIT_TIMING",32);this.splitTiming.appendChild(H),this.splitTiming.onclick=()=>{hs.active?hs.close():hs.open(this.manager.app),this.splitTiming.blur()},this.splitTiming.id="split-timing",this.timingContainer.appendChild(this.splitTiming),Ke(this.splitTiming,{content:"Manage split timing"}),this.toggleTimingTracks=document.createElement("button"),this.toggleTimingTracks.tabIndex=-1;const N=pe.getIcon("EYE",32);this.toggleTimingTracks.appendChild(N),this.toggleTimingTracks.onclick=()=>{fs.active?fs.close():fs.open(),this.toggleTimingTracks.blur()},this.toggleTimingTracks.id="toggle-tracks",this.timingContainer.appendChild(this.toggleTimingTracks),Ke(this.toggleTimingTracks,{content:"Toggle timing track visibility"}),this.detectSync=document.createElement("button"),this.detectSync.tabIndex=-1;const K=pe.getIcon("DETECT_SYNC",32);this.detectSync.appendChild(K),this.detectSync.onclick=()=>{this.manager.app.windowManager.openWindow(new Bu(this.manager.app)),this.detectSync.blur()},this.detectSync.id="detect-sync",this.timingContainer.appendChild(this.detectSync),ve.createKeybindTooltip(this.detectSync)`Detect audio sync ${"detectSync"}`;const ae=document.createElement("div");ae.classList.add("playback-separator"),this.timingContainer.appendChild(ae),this.offsetCounter=document.createElement("div"),this.offsetCounter.classList.add("playback-counter");const T=document.createElement("div");T.classList.add("playback-counter-label"),T.innerText="Offset";const W=document.createElement("div");W.classList.add("playback-counter-main","inlineEdit"),W.innerText="0.000",W.spellcheck=!1,W.contentEditable="true",W.onkeydown=M=>{M.key=="Enter"&&W.blur(),M.key=="Escape"&&(W.innerText=ue(this.manager.chartManager.loadedChart?.timingData.getOffset()??0,3).toFixed(3),W.blur())},W.tabIndex=-1,W.onfocus=()=>{setTimeout(()=>this.selectText(W),25)},W.onblur=()=>this.updateOffset(),W.ondragstart=M=>M.preventDefault(),this.offset=W,this.offsetCounter.appendChild(W),this.offsetCounter.appendChild(T),this.timingContainer.appendChild(this.offsetCounter),this.editBar.appendChild(this.editChoiceContainer);const w=document.createElement("div");w.classList.add("note-placeholder-right"),this.stepsContainer.appendChild(w),le.on("resize",()=>{this.trackingMovement=!0,this.idleFrames=5}),le.on("noteskinLoaded",()=>{this.stepsContainer.replaceChildren(),this.noteArrows.forEach(G=>{this.removeChild(G.sprite),this.removeChild(G.bg),this.removeChild(G.highlight)}),this.noteArrows=[];const M=document.createElement("div");if(M.classList.add("note-placeholder-right"),this.stepsContainer.appendChild(M),!!this.manager.chartManager.loadedChart){for(const G of this.manager.chartManager.loadedChart.gameType.editNoteTypes){if(Qu.includes(G))continue;const B=this.manager.chartManager.chartView.getNotefield().createNote({type:G,beat:0,col:0,quant:4,second:0,warped:!1,fake:!1});B.scale.set(.5);const D=new De(Se.WHITE);He(D,"widget-bg"),D.width=48,D.height=48,D.anchor.set(.5);const V=new mt("noBorder");V.alpha=0,V.width=48,V.height=48,V.pivot.x=24,V.pivot.y=24;const X=document.createElement("button");X.tabIndex=-1,X.style.height="3rem",X.style.width="3rem",X.classList.add("note-placeholder"),X.onclick=()=>{this.manager.chartManager.setEditingNoteType(G),X.blur()},ve.createKeybindTooltip(X)`${"\\"+G} ${"noteType"+G}`;const P={element:X,sprite:B,type:G,bg:D,highlight:V,hovered:!1};X.onmouseover=()=>{P.hovered=!0},X.onmouseleave=()=>{P.hovered=!1},this.addChild(D),this.addChild(B),this.addChild(V);const F=X.getBoundingClientRect();B.position.y=F.top-this.manager.app.view.clientHeight/2-this.manager.app.view.getBoundingClientRect().top+24,B.position.x=F.left-this.manager.app.view.clientWidth/2+24,D.position=B.position,this.noteArrows.push(P)}this.stepsContainer.replaceChildren(...this.noteArrows.map(G=>G.element),M),this.trackingMovement=!0,this.idleFrames=5}}),this.noteArrowMask=new De(Se.WHITE),this.noteArrowMask.height=48,this.noteArrowMask.width=2500,this.noteArrowMask.anchor.y=1,this.noteArrowMask.anchor.x=.5,this.addChild(this.noteArrowMask),this.mask=this.noteArrowMask,t.onmouseenter=()=>{this.lastHover=Date.now(),this.hovering=!0,this.view.style.opacity="",this.view.style.transition=""},t.onmouseleave=()=>this.hovering=!1,t.appendChild(this.playbackBar),t.appendChild(this.editBar),this.view=t,t.style.display="none"}update(){this.view.style.display=this.manager.chartManager.loadedSM&&he.status&&!this.manager.app.capturing?"":"none",this.scale.set(1/this.manager.chartManager.app.stage.scale.x);const e=this.manager.chartManager.time;this.lastTime!=e&&(document.activeElement!=this.min&&(this.min.innerText=(e<0?"-":"")+Math.floor(Math.abs(e)/60).toString().padStart(2,"0")),document.activeElement!=this.sec&&(this.sec.innerText=Math.floor(Math.abs(e)%60).toString().padStart(2,"0")),document.activeElement!=this.millis&&(this.millis.innerText=(ue(Math.abs(e)%1,3)*1e3).toString().padStart(3,"0")),this.lastTime=e);const t=this.manager.chartManager.beat;if(this.lastBeat!=t){if(document.activeElement!=this.beat)if(this.beatDropdown.value=="Measure"){const c=this.manager.chartManager.loadedChart?.timingData?.getMeasure(t)??t/4;this.beat.innerText=ue(c,3).toFixed(3)}else this.beat.innerText=ue(t,3).toFixed(3);this.lastBeat=t}const n=this.manager.chartManager.loadedChart?.timingData.getOffset()??0;this.lastOffset!=n&&document.activeElement!=this.offset&&(this.offset.innerText=ue(n,3).toFixed(3));const a=this.manager.chartManager.getMode(),r=this.manager.chartManager.editTimingMode;if(this.lastMode!=a){switch(a){case $.Edit:this.skipStart.disabled=!1,this.skipEnd.disabled=!1,this.record.disabled=!1,this.playtest.disabled=!1,this.min.contentEditable="true",this.sec.contentEditable="true",this.millis.contentEditable="true",this.beat.contentEditable="true",this.offset.contentEditable="true",this.record.style.background="",this.playtest.style.background="",this.view.style.opacity="",this.view.style.transition="",this.view.classList.remove("collapsed"),this.beatDropdown.disabled=!1;break;case $.Record:this.lastHover=Date.now(),this.skipStart.disabled=!0,this.skipEnd.disabled=!0,this.record.disabled=!1,this.record.style.background="rgba(170, 0, 0, 0.35)",this.playtest.disabled=!0,this.min.contentEditable="false",this.sec.contentEditable="false",this.millis.contentEditable="false",this.beat.contentEditable="false",this.offset.contentEditable="false",r!=Ce.Off&&(this.visible=!1),this.view.classList.add("collapsed"),this.beatDropdown.closeDropdown(),this.beatDropdown.disabled=!0;break;case $.Play:this.lastHover=Date.now(),this.skipStart.disabled=!0,this.skipEnd.disabled=!0,this.record.disabled=!0,this.playtest.disabled=!1,this.playtest.style.background="rgba(12, 97, 31, 0.35)",this.min.contentEditable="false",this.sec.contentEditable="false",this.millis.contentEditable="false",this.beat.contentEditable="false",this.offset.contentEditable="false",r!=Ce.Off&&(this.visible=!1),this.view.classList.add("collapsed"),this.beatDropdown.closeDropdown(),this.beatDropdown.disabled=!0;break;case $.View:this.lastHover=Date.now(),this.skipStart.disabled=!1,this.skipEnd.disabled=!1,this.record.disabled=!0,this.playtest.disabled=!1,this.min.contentEditable="true",this.sec.contentEditable="true",this.millis.contentEditable="true",this.beat.contentEditable="true",this.offset.contentEditable="true",r!=Ce.Off&&(this.visible=!1),this.view.classList.add("collapsed"),this.beatDropdown.closeDropdown(),this.beatDropdown.disabled=!0}this.trackingMovement=!0,this.idleFrames=5,this.lastMode=a}if(this.lastTimingMode!=r){switch(r){case Ce.Off:this.visible=!0,this.stepsContainer.style.transform="",this.timingContainer.style.transform="",this.editSteps.classList.add("active"),this.editTiming.classList.remove("active"),this.offset.tabIndex=-1;break;case Ce.Add:this.addTimingEvent.classList.add("active");break;case Ce.Edit:this.addTimingEvent.classList.remove("active"),this.offset.tabIndex=0}(this.lastTimingMode==Ce.Off&&r!=Ce.Off||this.lastTimingMode!=Ce.Off&&r==Ce.Off)&&this.manager.chartManager.clearSelections(),this.trackingMovement=!0,this.idleFrames=5,this.lastTimingMode=r,this.stepsContainer.style.transform=r==Ce.Off?"":"translateY(-3rem)",this.timingContainer.style.transform=r==Ce.Off?"":"translateY(-3rem)",this.editSteps.classList.toggle("active",r==Ce.Off),this.editTiming.classList.toggle("active",r!=Ce.Off)}const s=this.manager.chartManager.chartAudio.isPlaying();if(this.lastPlaying!=s&&(this.playIcon.style.display=s?"none":"",this.stopIcon.style.display=s?"":"none",this.lastPlaying=s),(a==$.Play||a==$.Record)&&this.view.style.opacity==""&&!this.hovering&&Date.now()-this.lastHover>3e3&&(this.view.style.opacity="0.2",this.view.style.transition="2s cubic-bezier(.11,.72,.51,1.14)"),this.trackingMovement){let c=48;const d=this.noteArrows[0];if(d){const p=d.element.getBoundingClientRect();c=p.width,this.noteArrows.forEach((m,g)=>{m.sprite.position.y=p.top-this.manager.app.view.clientHeight/2-this.manager.app.view.getBoundingClientRect().top+c/2,m.sprite.position.x=p.left-this.manager.app.view.clientWidth/2+c/2+g*c,m.sprite.scale.set(c/96),m.bg.width=c,m.bg.height=c,m.bg.position=m.sprite.position,m.highlight.width=c,m.highlight.height=c,m.highlight.position=m.sprite.position,m.highlight.pivot.set(c/2)}),this.lastBounds&&Math.abs(this.lastBounds.top-p.top)+Math.abs(this.lastBounds.left-p.left)==0&&(this.idleFrames--,this.idleFrames<0&&(this.trackingMovement=!1,this.lastBounds=void 0,r!=Ce.Off&&(this.visible=!1))),this.lastBounds=p}const h=this.view.getBoundingClientRect();this.noteArrowMask.y=h.bottom-this.manager.app.view.clientHeight/2-this.manager.app.view.getBoundingClientRect().top,this.noteArrowMask.height=c}const o=this.manager.chartManager.getEditingNoteType(),l=Be.getColor("editable-overlay-hover"),u=Be.getColor("editable-overlay-active"),f=new L(l).setAlpha(0);this.noteArrows.forEach(c=>{let d=o==c.type?u:c.hovered?l:f;y.general.smoothAnimations&&(d=new L(Jt(new L(c.highlight.tint).setAlpha(c.highlight.alpha),d,.3))),c.highlight.tint=d.toNumber(),c.highlight.alpha=d.alpha})}selectText(e){const t=window.getSelection(),n=document.createRange();!t||!n||(n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n))}updateTime(){this.millis.innerText=this.millis.innerText.padEnd(3,"0").slice(0,3);const e=this.parseString(this.min),t=this.parseString(this.sec),n=this.parseString(this.millis);if(e===null||t===null||n===null){this.lastTime=null;return}let a=e*60+t+n/1e3;a>9999999&&(a=9999999),a<0&&(a=0),this.manager.chartManager.time=a,this.lastTime=null}updateBeat(){let e=this.parseString(this.beat);if(e===null){this.lastBeat=null;return}this.beatDropdown.value=="Measure"&&(e=this.manager.chartManager.loadedChart?.timingData?.getBeatFromMeasure(e)??e*4),e>9999999&&(e=9999999),e<0&&(e=0),this.manager.chartManager.beat=e,this.lastBeat=null}updateOffset(){let e=this.parseString(this.offset);if(e===null){this.lastOffset=null;return}e>9999999&&(e=9999999),e<-9999999&&(e=-9999999),this.lastOffset=null,!(!this.manager.chartManager.loadedChart||!this.manager.chartManager.loadedSM)&&(this.manager.chartManager.loadedChart.timingData.hasChartOffset()?this.manager.chartManager.loadedChart.timingData:this.manager.chartManager.loadedSM.timingData).setOffset(e)}parseString(e){try{const t=Ec.evaluate(e.innerText);return isFinite(t)?t:0}catch{return null}}}class Cm extends ye{app;chartManager;children=[];constructor(e){super(),this.app=e.app,this.chartManager=e,this.addChild(new ym(this)),this.addChild(new wm(this)),this.addChild(new _m(this)),this.addChild(new qi(this)),this.addChild(new mm(this)),this.addChild(new vm(this)),this.addChild(new pm(this)),this.zIndex=2}update(){this.children.forEach(e=>e.update())}startPlay(){this.children.forEach(e=>e.startPlay())}endPlay(){this.children.forEach(e=>e.endPlay())}}const Bs=Array(85).fill(void 0).map((i,e)=>33+e),Nu=[];for(const i of Bs)for(const e of Bs)Nu.push([i,e]);const Fs="<~".split("").map(i=>i.charCodeAt(0)),Is="~>".split("").map(i=>i.charCodeAt(0));function Em(i,e,t,n=!1,a=!1,r=!1){let s;typeof i=="string"?s=i.split("").map(c=>c.charCodeAt(0)):s=[...new Uint8Array(i)];const o=4-s.length%4;for(let c=0;c<o;c++)s.push(0);const l=new Uint8Array(s),u=new DataView(l.buffer);let f=[];for(let c=0;c<s.length;c+=4){const d=u.getUint32(c);a&&!d?f.push(122):r&&d==538976288?f.push(121):(f=f.concat(t[Math.floor(d/614125)],t[Math.floor(d/85)%7225]),f.push(e[d%85]))}if(o&&!n){if(f.at(-1)==122){f.pop();for(let c=0;c<5;c++)f.push(e[0])}for(let c=0;c<o;c++)f.pop()}return f}function go(i,e=!1,t=!1,n=!1){let a=Em(i,Bs,Nu,t,!0,e);return n&&(a=Fs.concat(a).concat(Is)),a}function bo(i,e=!1,t=` 	
\r\v`){let n;if(typeof i=="string"?n=i.split("").map(o=>o.charCodeAt(0)):n=[...new Uint8Array(i)],e){if(n.at(-1)!=Is.at(-1)||n.at(-2)!=Is.at(-2))return!1;n.at(0)==Fs.at(0)&&n.at(1)==Fs.at(1)?n=n.slice(2,-2):n=n.slice(void 0,-2)}for(let o=0;o<4;o++)n.push(117);let a=[],r=[];for(const o of n)if(o>=33&&117>=o){if(r.push(o),r.length==5){let l=0;for(const u of r)l=85*l+(u-33);if(l>2**32-1)return!1;a.push(l>>24&255),a.push(l>>16&255),a.push(l>>8&255),a.push(l&255),r=[]}}else if(o==122){if(r.length!=0)return!1;a.push(0),a.push(0),a.push(0),a.push(0)}else if(o==121){if(r.length!=0)return!1;a.push(32),a.push(32),a.push(32),a.push(32)}else if(!t.includes(String.fromCharCode(o)))return!1;const s=4-r.length;return s&&(a=a.slice(void 0,-s)),a}function Ht(i){let e=0,t=0,n=129;for(;(n&128)!=0;){const a=i.shift();if(!a)break;e=e|(a&127)<<7*t++,n=a}return e}function zt(i){const e=[];let t=!1;for(;!t;){let n=i&127;i=i>>7,t=i==0,t||(n=n|128),e.push(n)}return e}const Am=["Hold","Mine","Roll","Lift","Fake"];function km(i){if(i.startsWith("ArrowVortex:notes:")){const e=bo(i.slice(18));if(e!==!1){const t=Array.from(e);if(t.shift()!=0)return;const n=Ht(t),a=[];for(let r=0;r<n;r++){const s=t.shift();if(s==null)return;const o=s&127;if((s&128)!=0){const l=Ht(t),u=Ht(t),f=t.shift();if(f==null||f>4)continue;const c=Am[f];if(l==u){if(c=="Hold"||c=="Roll")continue;a.push({type:c,beat:l/48,col:o})}else{if(c=="Mine"||c=="Fake"||c=="Lift")continue;a.push({type:c,beat:l/48,hold:(u-l)/48,col:o})}}else a.push({type:"Tap",beat:Ht(t)/48,col:o})}return a}}}function Sm(i){const e=[0];e.push(...zt(i.length));for(const t of i)if(t.type=="Tap"){const n=Math.round(t.beat*48);e.push(t.col),e.push(...zt(n))}else{e.push(t.col+128);const n=Math.round(t.beat*48);let a=0;Re(t)&&(a=t.hold);const r=Math.round(a*48)+n;e.push(...zt(n)),e.push(...zt(r)),e.push(["Hold","Mine","Roll","Lift","Fake"].indexOf(t.type))}return"ArrowVortex:notes:"+go(e).map(t=>String.fromCharCode(t)).join("")}const Ka=["BPMS","STOPS","DELAYS","WARPS","TIMESIGNATURES","TICKCOUNTS","COMBOS","SPEEDS","SCROLLS","FAKES","LABELS","ATTACKS","BGCHANGES","FGCHANGES"];function bi(i){const e=new ArrayBuffer(4);return new DataView(e).setUint32(0,i,!0),Array.from(new Uint8Array(e))}function yi(i){const e=new Uint8Array(i.splice(0,4));return new DataView(e.buffer).getUint32(0,!0)}function Mi(i){const e=new ArrayBuffer(8);return new DataView(e).setFloat64(0,i,!0),Array.from(new Uint8Array(e))}function Di(i){const e=new Uint8Array(i.splice(0,8)),t=new DataView(e.buffer);return ue(t.getFloat64(0,!0),3)}function Tm(i){return[i.length,...i.split("").map(e=>e.charCodeAt(0))]}function Mm(i){const e=i.shift();if(!e)return"";let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(i.shift());return t}function wi(i){return zt(i.length).concat(i.split("").map(e=>e.charCodeAt(0)))}function vi(i){const e=Ht(i);if(!e)return"";let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(i.shift());return t}function Dm(i){return i.some(e=>{if(e.type=="ATTACKS"||e.type=="BGCHANGES"||e.type=="FGCHANGES")return!0;const t=Math.round(e.beat*48)/48;if(Math.abs(t-e.beat)>5e-4)return!0;if(e.type=="FAKES"||e.type=="WARPS"){const n=Math.round(e.value*48)/48;if(Math.abs(n-e.value)>5e-4)return!0}return e.type=="LABELS"&&e.value.length>255||e.type=="TIMESIGNATURES"&&(e.upper>2**32-1||e.lower>2**32-1)||e.type=="COMBOS"&&(e.hitMult>2**32-1||e.missMult>2**32-1)?!0:e.type=="TICKCOUNTS"&&e.value>2**32-1})?Bm(i):Lm(i)}function Lm(i){const e=[],t=new Map;i.forEach(n=>{t.has(n.type)||t.set(n.type,[]),t.get(n.type)?.push(n)});for(const[n,a]of t.entries())if(!(n=="ATTACKS"||n=="BGCHANGES"||n=="FGCHANGES")){e.push(a.length),e.push(Ka.indexOf(n));for(const r of a)switch(e.push(...bi(Math.round(r.beat*48))),r.type){case"BPMS":case"STOPS":case"DELAYS":case"SCROLLS":e.push(...Mi(r.value));break;case"FAKES":case"WARPS":e.push(...bi(Math.round(r.value*48)));break;case"TIMESIGNATURES":e.push(...bi(Math.round(r.upper))),e.push(...bi(Math.round(r.lower)));break;case"COMBOS":e.push(...bi(Math.round(r.hitMult))),e.push(...bi(Math.round(r.missMult)));break;case"TICKCOUNTS":e.push(...bi(Math.round(r.value)));break;case"SPEEDS":e.push(...Mi(r.value)),e.push(...Mi(r.delay)),e.push(...bi(r.unit=="B"?0:1));break;case"LABELS":e.push(...Tm(r.value))}}return e.push(0),"ArrowVortex:tempo:"+go(e).map(n=>String.fromCharCode(n)).join("")}function Bm(i){const e=[],t=new Map;i.forEach(n=>{t.has(n.type)||t.set(n.type,[]),t.get(n.type)?.push(n)});for(const[n,a]of t.entries()){e.push(...zt(a.length)),e.push(Ka.indexOf(n));for(const r of a)switch(e.push(...zt(Math.round((r.type=="ATTACKS"?r.second:r.beat)*1e3))),r.type){case"BPMS":case"STOPS":case"DELAYS":case"SCROLLS":case"FAKES":case"WARPS":e.push(...Mi(r.value));break;case"TIMESIGNATURES":e.push(...zt(Math.round(r.upper))),e.push(...zt(Math.round(r.lower)));break;case"COMBOS":e.push(...zt(Math.round(r.hitMult))),e.push(...zt(Math.round(r.missMult)));break;case"TICKCOUNTS":e.push(...zt(Math.round(r.value)));break;case"SPEEDS":e.push(...Mi(r.value)),e.push(...Mi(r.delay)),e.push(r.unit=="B"?0:1);break;case"LABELS":e.push(...wi(r.value));break;case"ATTACKS":e.push(...Mi(r.value)),e.push(r.endType=="LEN"?0:1),e.push(...wi(r.mods));break;case"BGCHANGES":case"FGCHANGES":e.push((r.crossFade?1:0)+((r.stretchRewind?1:0)<<1)+((r.stretchNoLoop?1:0)<<2)),e.push(...wi(r.file)),e.push(...Mi(r.updateRate)),e.push(...wi(r.effect)),e.push(...wi(r.file2)),e.push(...wi(r.transition)),e.push(...wi(r.color1)),e.push(...wi(r.color2))}}return"SMEditor:tempo:"+go(e).map(n=>String.fromCharCode(n)).join("")}function Fm(i){if(i.startsWith("SMEditor:tempo:"))return Rm(i);if(i.startsWith("ArrowVortex:tempo:"))return Im(i)}function Im(i){if(!i.startsWith("ArrowVortex:tempo:"))return;const e=bo(i.slice(18)),t=[];if(e===!1)return;const n=Array.from(e);try{for(;;){const a=n.shift();if(a===void 0)return;if(a==0)break;const r=n.shift();if(r===void 0)return;const s=Ka[r];for(let o=0;o<a;o++){const l=yi(n)/48;switch(s){case"BPMS":case"STOPS":case"DELAYS":case"SCROLLS":t.push({type:s,beat:l,value:Di(n)});break;case"FAKES":case"WARPS":t.push({type:s,beat:l,value:yi(n)/48});break;case"TIMESIGNATURES":t.push({type:s,beat:l,upper:yi(n),lower:yi(n)});break;case"COMBOS":t.push({type:s,beat:l,hitMult:yi(n),missMult:yi(n)});break;case"TICKCOUNTS":t.push({type:s,beat:l,value:yi(n)});break;case"SPEEDS":t.push({type:s,beat:l,value:Di(n),delay:Di(n),unit:yi(n)==1?"T":"B"});break;case"LABELS":t.push({type:s,beat:l,value:Mm(n)})}}}}catch{return}return t}function Rm(i){if(!i.startsWith("SMEditor:tempo:"))return;const e=bo(i.slice(15)),t=[];if(e===!1)return;const n=Array.from(e);try{for(;;){const a=Ht(n);if(a===void 0)return;if(a==0)break;const r=n.shift();if(r===void 0)return;const s=Ka[r];for(let o=0;o<a;o++){const l=Ht(n)/1e3;switch(s){case"BPMS":case"STOPS":case"DELAYS":case"SCROLLS":case"FAKES":case"WARPS":t.push({type:s,beat:l,value:Di(n)});break;case"TIMESIGNATURES":t.push({type:s,beat:l,upper:Ht(n),lower:Ht(n)});break;case"COMBOS":t.push({type:s,beat:l,hitMult:Ht(n),missMult:Ht(n)});break;case"TICKCOUNTS":t.push({type:s,beat:l,value:Ht(n)});break;case"SPEEDS":t.push({type:s,beat:l,value:Di(n),delay:Di(n),unit:n.shift()==0?"B":"T"});break;case"LABELS":t.push({type:s,beat:l,value:vi(n)});break;case"ATTACKS":t.push({type:s,second:l,value:Di(n),endType:n.shift()==0?"LEN":"END",mods:vi(n)});break;case"BGCHANGES":case"FGCHANGES":{const u=n.shift();t.push({type:s,beat:l,file:vi(n),updateRate:Di(n),crossFade:(u&1)>0,stretchRewind:(u&2)>0,stretchNoLoop:(u&4)>0,effect:vi(n),file2:vi(n),transition:vi(n),color1:vi(n),color2:vi(n)})}}}}}catch{return}return t}const Pm={"dance-single":[{x:-1,y:0},{x:0,y:-1},{x:0,y:1},{x:1,y:0}]},it={DOUBLESTEP:850,BRACKETJACK:20,JACK:30,JUMP:30,BRACKETTAP:400,HOLDSWITCH:20,MINE:1e4,FOOTSWITCH:5e3,MISSED_FOOTSWITCH:500,FACING:2,DISTANCE:6,SPIN:1e3,SIDESWITCH:130},pc=[1,2,3,4],Om="LlRr";class Nm{id=0;neighbors=new Map;state;constructor(e,t){this.state=e,this.id=t}}class Hm{nodes=[];states=[];startNode=0;endNode=0;stateNodeMap=new Map;addOrGetExistingNode(e){this.stateNodeMap.get(e.rowIndex)==null&&this.stateNodeMap.set(e.rowIndex,new Map);for(const[r,s]of this.stateNodeMap.get(e.rowIndex))if(Vm(e,this.states[r]))return this.nodes[s];const t=this.states.length,n=this.nodes.length;this.states.push(e);const a=new Nm(e,n);return this.nodes.push(a),this.stateNodeMap.get(e.rowIndex)?.set(t,n),a}addEdge(e,t,n){e.neighbors.set(t.id,n)}}class zm{app;permuteCache=new Map;layout;constructor(e,t){this.app=e,this.layout=Pm[t]}help(){console.log(`Currently only compatible with dance-single.
Available commands:
analyze(): analyze the current chart
clear(): clear parity highlights`)}getActionCost(e,t,n,a){const r=n[a],s=t.second-e.second;let o=0;const l=new Array(t.columns.length).fill(0);for(let D=0;D<t.columns.length;D++){if(t.columns[D]!=0){l[D]=t.columns[D];continue}e.columns[D]==1||e.columns[D]==3?t.movedFeet.has(e.columns[D])||(l[D]=e.columns[D]):e.columns[D]==2?!t.movedFeet.has(2)&&!t.movedFeet.has(1)&&(l[D]=e.columns[D]):e.columns[D]==4&&!t.movedFeet.has(4)&&!t.movedFeet.has(3)&&(l[D]=e.columns[D])}let[u,f,c,d]=new Array(4).fill(-1);for(let D=0;D<t.columns.length;D++){switch(t.columns[D]){case 0:break;case 1:u=D;break;case 2:f=D;break;case 3:c=D;break;case 4:d=D;break}if(l[D]!=0&&r.mines[D]!==void 0){o+=it.MINE;break}}for(let D=0;D<r.holds.length;D++)if(r.holds[D]!==void 0&&((l[D]==1||l[D]==2)&&e.columns[D]!=2&&e.columns[D]!=1||(l[D]==3||l[D]==4)&&e.columns[D]!=4&&e.columns[D]!=3)){const V=e.columns.indexOf(l[D]);o+=it.HOLDSWITCH*(V==-1?1:Math.sqrt(this.getDistanceSq(this.layout[D],this.layout[V])))}if(u!=-1&&f!=-1){let D=1;(e.movedFeet.has(1)||e.movedFeet.has(2))&&(D=1/s),r.holds[u]!==void 0&&r.holds[f]===void 0&&(o+=it.BRACKETTAP*D),r.holds[f]!==void 0&&r.holds[u]===void 0&&(o+=it.BRACKETTAP*D)}if(c!=-1&&d!=-1){let D=1;(e.movedFeet.has(4)||e.movedFeet.has(3))&&(D=1/s),r.holds[c]!==void 0&&r.holds[d]===void 0&&(o+=it.BRACKETTAP*D),r.holds[d]!==void 0&&r.holds[c]===void 0&&(o+=it.BRACKETTAP*D)}if(e.columns.some(D=>D!=0))for(const D of t.movedFeet)switch(D){case 1:case 2:e.columns.includes(3)||e.columns.includes(4)||(o+=500);break;case 3:case 4:e.columns.includes(1)||e.columns.includes(4)||(o+=500);break}const h=t.movedFeet.has(1)||t.movedFeet.has(2),p=t.movedFeet.has(3)||t.movedFeet.has(4),m=(e.movedFeet.has(1)&&!e.holdFeet.has(1)||e.movedFeet.has(2)&&!e.holdFeet.has(2))&&(e.movedFeet.has(3)&&!e.holdFeet.has(3)||e.movedFeet.has(4)&&!e.holdFeet.has(4));let g=!1,b=!1;if(m||(u!=-1&&h&&(e.columns[u]==1&&!t.holdFeet.has(1)&&(e.movedFeet.has(1)&&!e.holdFeet.has(1)||e.movedFeet.has(2)&&!e.holdFeet.has(2))&&(g=!0),e.columns[f]==2&&!t.holdFeet.has(2)&&(e.movedFeet.has(1)&&!e.holdFeet.has(1)||e.movedFeet.has(2)&&!e.holdFeet.has(2))&&(g=!0)),c!=-1&&p&&(e.columns[c]==3&&!t.holdFeet.has(3)&&(e.movedFeet.has(3)&&!e.holdFeet.has(3)||e.movedFeet.has(4)&&!e.holdFeet.has(4))&&(b=!0),e.columns[d]==4&&!t.holdFeet.has(4)&&(e.movedFeet.has(3)&&!e.holdFeet.has(3)||e.movedFeet.has(4)&&!e.holdFeet.has(4))&&(b=!0))),h!=p&&(h||p)&&t.holdFeet.size==0&&!m){let D=!1;h&&!g&&(e.movedFeet.has(1)&&!e.holdFeet.has(1)||e.movedFeet.has(2)&&!e.holdFeet.has(2))&&(D=!0),p&&!b&&(e.movedFeet.has(3)&&!e.holdFeet.has(3)||e.movedFeet.has(4)&&!e.holdFeet.has(4))&&(D=!0);const V=n[a-1];if(V!==void 0)for(const X of V.holds){if(X===void 0)continue;const P=this.app.chartManager.loadedChart.timingData.getBeatFromSeconds(r.second),F=this.app.chartManager.loadedChart.timingData.getBeatFromSeconds(V.second);X.beat+X.hold>F&&X.beat+X.hold<P&&(D=!1),X.beat+X.hold>=P&&(D=!1)}D&&(o+=it.DOUBLESTEP),g&&t.movedFeet.has(1)&&t.movedFeet.has(2)&&(o+=it.BRACKETJACK),b&&t.movedFeet.has(3)&&t.movedFeet.has(4)&&(o+=it.BRACKETJACK)}h&&p&&r.notes.filter(D=>D!==void 0).length>=2&&(o+=it.JUMP/s);let x=-1,v=-1,C=-1,E=-1;for(let D=0;D<l.length;D++)switch(l[D]){case 0:break;case 1:x=D;break;case 2:v=D;break;case 3:C=D;break;case 4:E=D;break}v==-1&&(v=x),E==-1&&(E=C);const R=x!=-1&&C!=-1?this.getXDifference(x,C):0,O=v!=-1&&E!=-1?this.getXDifference(v,E):0,H=x!=-1&&v!=-1?this.getYDifference(x,v):0,N=C!=-1&&E!=-1?this.getYDifference(C,E):0,K=Math.pow(-Math.min(R,0),1.8)*100,ae=Math.pow(-Math.min(O,0),1.8)*100,T=Math.pow(-Math.min(H,0),1.8)*100,W=Math.pow(-Math.min(N,0),1.8)*100;K>0&&(o+=K*it.FACING),ae>0&&(o+=ae*it.FACING),T>0&&(o+=T*it.FACING),W>0&&(o+=W*it.FACING);const w=this.averagePoint(e.columns.indexOf(1),e.columns.indexOf(2)),M=this.averagePoint(e.columns.indexOf(3),e.columns.indexOf(4)),G=this.averagePoint(x,v),B=this.averagePoint(C,E);if(B.x<G.x&&M.x<w.x&&B.y<G.y&&M.y>w.y&&(o+=it.SPIN),B.x<G.x&&M.x<w.x&&B.y>G.y&&M.y<w.y&&(o+=it.SPIN),s>=.25&&!r.mines.some(D=>D!==void 0)&&!r.fakeMines.some(D=>D!==void 0)){const D=s-.25;for(let V=0;V<l.length;V++)if(!(e.columns[V]==0||t.columns[V]==0)&&e.columns[V]!=t.columns[V]&&!t.movedFeet.has(e.columns[V])){o+=Math.pow(D/2,2)*it.FOOTSWITCH;break}}if(e.columns[0]!=t.columns[0]&&t.columns[0]!=0&&e.columns[0]!=0&&!t.movedFeet.has(e.columns[0])&&(o+=it.SIDESWITCH),e.columns[3]!=t.columns[3]&&t.columns[3]!=0&&e.columns[3]!=0&&!t.movedFeet.has(e.columns[3])&&(o+=it.SIDESWITCH),(g||b)&&(r.mines.some(D=>D!==void 0)||r.fakeMines.some(D=>D!==void 0))&&(o+=it.MISSED_FOOTSWITCH),s<=.15&&h!=p){const D=.15-s;(g||b)&&(o+=(1/D-1/.15)*it.JACK)}for(const D of t.movedFeet){const V=e.columns.indexOf(D);V!=-1&&(o+=Math.sqrt(this.getDistanceSq(this.layout[V],this.layout[t.columns.indexOf(D)]))*it.DISTANCE/s)}return t.columns=l,o}calculatePermuteColumnKey(e){let t=0;for(let n=0;n<4;n++)(e.notes[n]!==void 0||e.holds[n]!==void 0)&&(t+=Math.pow(2,n));return t}getPermuteColumns(e){const t=this.calculatePermuteColumnKey(e);let n=this.permuteCache.get(t);return n==null&&(n=this.permuteColumn(e,new Array(4).fill(0),0),this.permuteCache.set(t,n)),this.permuteCache.get(t)}permuteColumn(e,t,n){if(n>=t.length){let r=-1,s=-1,o=-1,l=-1;for(let u=0;u<t.length;u++)t[u]!=0&&(t[u]==1&&(r=u),t[u]==2&&(s=u),t[u]==3&&(o=u),t[u]==4&&(l=u));return r==-1&&s!=-1||o==-1&&l!=-1?[]:r!=-1&&s!=-1&&!this.bracketCheck(r,s)?[]:o!=-1&&l!=-1&&!this.bracketCheck(o,l)?[]:[t]}const a=[];if(e.notes[n]||e.holds[n]){for(const r of pc){if(t.includes(r))continue;const s=[...t];s[n]=r,a.push(...this.permuteColumn(e,s,n+1))}return a}return this.permuteColumn(e,t,n+1)}createRows(e){let t=[],n=null,a=[],r=[],s=[],o=[],l=[];const u=[];for(const f of e){if(f.type=="Mine"){f.second==n&&u.length>0?f.fake||f.warped?l[f.col]=f.second:o[f.col]=f.second:f.fake||f.warped?s[f.col]=f.second:r[f.col]=f.second;continue}f.fake||f.warped||(n!=f.second&&(n!=null&&u.push({notes:a,holds:t.map(c=>{if(!(c===void 0||c.second>=n))return c}),holdTails:new Set(t.filter(c=>!(c===void 0||Math.abs(c.beat+c.hold-this.app.chartManager.loadedChart.timingData.getBeatFromSeconds(n))>5e-4)).map(c=>c.col)),mines:o,fakeMines:l,second:n}),n=f.second,a=[],o=r,l=s,r=[],s=[],t=t.map(c=>{if(!(c===void 0||f.beat>c.beat+c.hold))return c})),a[f.col]=f,Re(f)&&(t[f.col]=f))}return u.push({notes:a,holds:t.map(f=>{if(!(f===void 0||f.second>=n))return f}),holdTails:new Set(t.filter(f=>!(f===void 0||Math.abs(f.beat+f.hold-this.app.chartManager.loadedChart.timingData.getBeatFromSeconds(n))>5e-4)).map(f=>f.col)),mines:o,fakeMines:l,second:n}),u}analyze(){const e=this.app.chartManager.loadedChart?.getNotedata();if(!e)return[];const t=this.createRows(e),n=this.buildStateGraph(t);this.analyzeGraph(t,n)}analyzeGraph(e,t){const n=this.computeCheapestPath(t);for(let a=0;a<e.length;a++){const r=t.nodes[n[a]];for(let s=0;s<4;s++)e[a].notes[s]&&(e[a].notes[s].parity=Om[pc.indexOf(r.state.columns[s])])}}buildStateGraph(e){const t=new Hm,n={rowIndex:-1,second:e[0].second-1,columns:[],movedFeet:new Set,holdFeet:new Set},a=t.addOrGetExistingNode(n);t.startNode=a.id;const r=[];r.push(n);for(let l=0;l<e.length;l++){const u=new Set;for(;r.length>0;){const f=r.shift(),c=t.addOrGetExistingNode(f),d=this.getPermuteColumns(e[l]);for(const h of d){const p=this.initResultState(f,e[l],l,h),m=this.getActionCost(f,p,e,l),g=t.addOrGetExistingNode(p);t.addEdge(c,g,m),u.add(g.id)}}for(const f of u)r.push(t.nodes[f].state)}const s={rowIndex:e.length,second:e[e.length-1].second+1,columns:[],movedFeet:new Set,holdFeet:new Set},o=t.addOrGetExistingNode(s);for(t.endNode=o.id;r.length>0;){const l=r.shift(),u=t.addOrGetExistingNode(l);t.addEdge(u,o,0)}return t}initResultState(e,t,n,a){const r={rowIndex:n,second:t.second,columns:a,movedFeet:new Set,holdFeet:new Set};for(let s=0;s<4;s++)a[s]!=null&&((t.holds[s]==null||e.columns[s]!=a[s])&&r.movedFeet.add(a[s]),t.holds[s]!=null&&r.holdFeet.add(a[s]));return r}computeCheapestPath(e){const t=e.startNode,n=e.endNode,a=[],r=Array(e.nodes.length).fill(Number.MAX_VALUE),s=Array(e.nodes.length).fill(-1);r[t]=0;for(let l=0;l<=n;l++){const u=e.nodes[l];for(const[f,c]of u.neighbors)r[l]+c<r[f]&&(r[f]=r[l]+c,s[f]=l)}let o=n;for(;o!=t;)o!=n&&a.push(o),o=s[o];return a.reverse(),a}bracketCheck(e,t){const n=this.layout[e],a=this.layout[t];return this.getDistanceSq(n,a)<=2}getDistanceSq(e,t){return(e.y-t.y)*(e.y-t.y)+(e.x-t.x)*(e.x-t.x)}getPosition(e){if(e.length==0)return;if(e.length==1)return this.layout[e[0]];const t=this.layout[e[0]],n=this.layout[e[1]];return{x:(t.x+n.x)/2,y:(t.y+n.y)/2}}getPlayerAngle(e,t){const n=t.x-e.x,a=t.y-e.y,r=1,s=0,o=n*r+a*s,l=n*s-a*r;return Math.atan2(l,o)}compareCols(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}getXDifference(e,t){if(e==t)return 0;let n=this.layout[t].x-this.layout[e].x;const a=this.layout[t].y-this.layout[e].y,r=Math.sqrt(n*n+a*a);n/=r;const s=n<=0;return n=Math.pow(n,4),s&&(n=-n),n}getYDifference(e,t){if(e==t)return 0;const n=this.layout[t].x-this.layout[e].x;let a=this.layout[t].y-this.layout[e].y;const r=Math.sqrt(n*n+a*a);a/=r;const s=a<=0;return a=Math.pow(a,4),s&&(a=-a),a}averagePoint(e,t){return e==-1&&t==-1?{x:0,y:0}:e==-1?this.layout[t]:t==-1?this.layout[e]:{x:(this.layout[e].x+this.layout[t].x)/2,y:(this.layout[e].y+this.layout[t].y)/2}}clear(){const e=this.app.chartManager.loadedChart?.getNotedata();e&&e.forEach(t=>t.parity=void 0)}}function Vm(i,e){return!(i.second!==e.second||i.rowIndex!==e.rowIndex||!Wm(i.columns,e.columns)||!mc(i.movedFeet,e.movedFeet)||!mc(i.holdFeet,e.holdFeet))}function Wm(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(i[t]!==e[t])return!1;return!0}function mc(i,e){if(i.size!==e.size)return!1;for(const t of i)if(!e.has(t))return!1;return!0}let Um=class Hu extends AudioBufferSourceNode{started=!1;start(e,t,n){this.started||super.start(e,t,n),this.started=!0}stop(e){this.started&&super.stop(e),this.started=!1}static create(e){const t=e;return t.started=!1,Object.setPrototypeOf(t,Hu.prototype),t}};class ps{_gainNode;_audioContext=new AudioContext;_sources=[];_rate=1;_buffer;_volume=1;_destroyed=!1;loaded;constructor(e){this._gainNode=this._audioContext.createGain(),this._gainNode.connect(this._audioContext.destination),e.volume!==void 0&&this.volume(e.volume),e.rate!==void 0&&this.rate(e.rate),this._buffer=this._audioContext.createBuffer(2,1,44100),this.loaded=new Promise(t=>{fetch(e.src).then(n=>n.arrayBuffer()).then(n=>this.decodeData(n)).then(n=>{n&&(this._buffer=n)}).catch(n=>{de.createFormatted("Failed to load sound effect: "+n.message,"error")}).finally(()=>{t()})})}destroy(){this._destroyed||(this.stop(),this._buffer=this._audioContext.createBuffer(2,1,44100),this._destroyed=!0)}async decodeData(e){return new Promise((t,n)=>{if(!e){t();return}(async()=>{try{t(await this._audioContext.decodeAudioData(e))}catch(a){n(a)}})()})}volume(e){this._destroyed||this._volume!=e&&(this._volume=e,this._gainNode.gain.setValueAtTime(e,this._audioContext.currentTime))}rate(e){if(!this._destroyed&&this._rate!=e){this._rate=e;for(const t of this._sources)t.playbackRate.value=e}}play(e){if(this._destroyed)return;const t=Um.create(this._audioContext.createBufferSource());t.buffer=this._buffer,t.connect(this._gainNode),this._gainNode.connect(this._audioContext.destination),t.start(e+this._audioContext.currentTime,0),t.playbackRate.value=this._rate,this._sources.push(t),t.onended=()=>{t.disconnect(),this._sources=this._sources.filter(n=>n!=t)}}stop(){if(!this._destroyed){for(const e of this._sources)e.stop(),e.disconnect();this._sources=[]}}getBuffer(){return this._buffer}}class Rs{static menuElement;static closeTimeout;static open(e,t){e.chartManager.getMode()!=$.View&&(this.buildMenu(e),this.menuElement.style.display="none",setTimeout(()=>this.fitContextMenu(t)),this.menuElement.classList.add("entering"),clearTimeout(this.closeTimeout),setTimeout(()=>this.menuElement?.classList.remove("entering"),300),this.menuElement.style.left=t.clientX+"px",this.menuElement.style.top=t.clientY+"px")}static fitContextMenu(e){this.menuElement.style.display="";const t=this.menuElement.getBoundingClientRect(),n=window.innerHeight-t.bottom-20,a=window.innerWidth-t.right-20;n<0&&(this.menuElement.style.top=e.clientY+n+"px"),a<0&&(this.menuElement.style.left=e.clientX+a+"px"),this.menuElement.style.transformOrigin=`${Math.max(0,-a)}px ${Math.max(0,-n)}px`}static close(){this.menuElement&&(this.menuElement.classList.add("exiting"),this.closeTimeout=setTimeout(()=>this.menuElement.replaceChildren(),300))}static buildMenu(e){const t=document.createElement("div");if(t.appendChild(this.createElement(e,{type:"selection",id:"cut"})),t.appendChild(this.createElement(e,{type:"selection",id:"copy"})),t.appendChild(this.createElement(e,{type:"selection",id:"paste"})),t.appendChild(this.createElement(e,{type:"selection",id:"pasteReplace"})),e.chartManager.getMode()==$.Edit&&e.chartManager.hasNoteSelection()){const n=document.createElement("div");n.classList.add("separator"),t.appendChild(n),rn.selection.options.slice(0,-4).forEach(a=>{t.appendChild(this.createElement(e,a))})}this.menuElement=t,t.id="context-menu",document.getElementById("context-menu")?.replaceWith(this.menuElement)}static createElement(e,t){if(t.type=="separator"){const n=document.createElement("div");return n.classList.add("separator"),n}if(t.type=="selection"||t.type=="checkbox"||t.type=="dropdown"){const n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div");let s;if(t.type=="selection"||t.type=="checkbox"){const o=$e[t.id];s=document.createElement("div"),s.innerText=ve.getKeybindString(t.id),s.classList.add("keybind","unselectable"),r.innerText=o?.label??t.id;let l=o?.disabled??!0;typeof l=="function"&&(l=l(e)),l&&n.classList.add("disabled"),n.addEventListener("click",()=>{l||(o?.callback(e),this.close())})}else s=pe.getIcon("CHEVRON",16),s.style.transform="rotate(-90deg)",r.innerText=typeof t.title=="function"?t.title(e):t.title;if(a.appendChild(r),a.appendChild(s),n.appendChild(a),n.classList.add("menu-item"),a.classList.add("menu-item-title","menu-hover"),r.classList.add("title","unselectable"),t.type=="dropdown"){const o=document.createElement("div");n.appendChild(o),o.classList.add("menubar-dropdown"),t.options.map(l=>this.createElement(e,l)).forEach(l=>o.appendChild(l))}if(t.type=="checkbox"){let o=t.checked;typeof o=="function"&&(o=o(e)),o&&(r.innerText="✓ "+r.innerText)}return n}if(t.type=="menu"){const n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div");return n.appendChild(a),a.innerText=t.title,n.appendChild(r),a.classList.add("title","unselectable"),n.classList.add("menu-item","menu-main"),a.classList.add("menu-hover"),r.classList.add("menubar-dropdown","unselectable"),n.onmouseenter=()=>{r.replaceChildren(...t.options.map(s=>this.createElement(e,s)))},n.onmouseleave=()=>{r.replaceChildren()},n}return document.createElement("div")}}const qm={fontName:"Main",fontSize:20,fill:["#ffffff"]};class Gm extends ye{renderer;barlineMap=new Map;barlineLabelMap=new Map;barlinePool=new Yn({create:()=>{const e=new De(Se.WHITE);return He(e,"text-color"),e}});barlineLabelPool=new Yn({create:()=>{const e=new Ee("",qm);return He(e,"text-color"),e}});constructor(e){super(),this.renderer=e;const t=()=>{this.barlineMap.clear(),this.barlineLabelMap.clear(),this.barlinePool.destroyAll(),this.barlineLabelPool.destroyAll()};le.on("timeSigChanged",t),this.on("destroyed",()=>le.off("timeSigChanged",t)),this.addChild(this.barlinePool,this.barlineLabelPool)}update(e,t){this.visible=this.renderer.shouldDisplayBarlines();for(const[n,a]of this.renderer.chart.timingData.getMeasureBeats(e,t)){if(!this.barlineMap.has(n)){const r=this.barlinePool.createChild();if(!r)continue;Object.assign(r,{width:this.renderer.chart.gameType.notefieldWidth+128,height:a?4:1,visible:!0}),r.anchor.set(.5),this.barlineMap.set(n,r)}if(a&&!this.barlineLabelMap.has(n)){const r=this.barlineLabelPool.createChild();if(!r)continue;Object.assign(r,{x:(this.renderer.chart.gameType.notefieldWidth+128)/-2-16,text:`${Math.round(this.renderer.chart.timingData.getMeasure(n))}`,visible:!0}),r.anchor.set(1,.5),this.barlineLabelMap.set(n,r)}}for(const[n,a]of this.barlineMap.entries()){if(n<e||n>t){this.barlineMap.delete(n),this.barlinePool.destroyChild(a);continue}a.y=this.renderer.getYPosFromBeat(n)}for(const[n,a]of this.barlineLabelMap.entries()){if(n<e||n>t){this.barlineLabelMap.delete(n),this.barlineLabelPool.destroyChild(a);continue}a.y=this.renderer.getYPosFromBeat(n)}}}class $m extends ye{previewArea=new De(Se.WHITE);previewText=new Ee("SONG PREVIEW",{fontName:"Main",fontSize:13});renderer;constructor(e){super(),this.renderer=e,Object.assign(this.previewArea,{alpha:.2,tint:11052482,width:this.renderer.chart.gameType.notefieldWidth+96,height:64}),this.previewText.x=-this.previewArea.width/2+5,this.previewArea.anchor.x=.5,He(this.previewText,"text-color"),this.addChild(this.previewArea,this.previewText)}update(e,t){const n=Number(this.renderer.chart.sm.properties.SAMPLESTART),a=Number(this.renderer.chart.sm.properties.SAMPLELENGTH);if(Number.isNaN(n)||Number.isNaN(a)||!this.renderer.shouldDisplayBarlines()||this.renderer.chart.timingData.getBeatFromSeconds(n+a)<e||this.renderer.chart.timingData.getBeatFromSeconds(n)>t){this.visible=!1;return}this.visible=!0;let r=this.renderer.getYPosFromSecond(n),s=this.renderer.getYPosFromSecond(n+a);s<r&&([s,r]=[r,s]),this.previewArea.y=r,this.previewArea.height=s-r,this.previewText.anchor.y=y.chart.reverse?1:0,y.chart.reverse?this.previewText.y=Ae(this.renderer.getUpperBound()-35,this.previewArea.y+15,this.previewArea.y+this.previewArea.height-5):this.previewText.y=Ae(this.renderer.getUpperBound()+35,this.previewArea.y+5,this.previewArea.y+this.previewArea.height-15)}}class jm extends ye{renderer;scrollMap=new Map;receptors;topBound;bottomBound;topBoundBeat;bottomBoundBeat;topScreenBeat;bottomScreenBeat;topScreenBeatText;bottomScreenBeatText;children=[];constructor(e){super(),this.visible=!1,this.renderer=e,this.receptors=this.createBar(7829503),this.receptors.width=300,this.addChild(this.receptors),this.topBound=this.createBar(16711680),this.addChild(this.topBound),this.bottomBound=this.createBar(16711680),this.addChild(this.bottomBound),this.topBoundBeat=this.createBar(16777096),this.addChild(this.topBoundBeat),this.bottomBoundBeat=this.createBar(8978431),this.addChild(this.bottomBoundBeat),this.topScreenBeat=this.createBar(16746751),this.topScreenBeat.width=300,this.addChild(this.topScreenBeat),this.topScreenBeatText=new Ee("",{fontName:"Fancy",fontSize:50}),this.topScreenBeatText.anchor.x=.5,this.topScreenBeatText.anchor.y=.5,this.topScreenBeatText.tint=16746751,this.addChild(this.topScreenBeatText),this.bottomScreenBeat=this.createBar(16724991),this.bottomScreenBeat.width=300,this.addChild(this.bottomScreenBeat),this.bottomScreenBeatText=new Ee("",{fontName:"Fancy",fontSize:50}),this.bottomScreenBeatText.anchor.x=.5,this.bottomScreenBeatText.anchor.y=.5,this.bottomScreenBeatText.tint=16724991,this.addChild(this.bottomScreenBeatText),this.scale.x=.4,this.scale.y=.4}createBar(e){const t=new De(Se.WHITE);return Object.assign(t,{width:750,height:15,tint:e,opacity:.5}),t.anchor.set(.5),t}update(){if(this.visible=y.debug.showScroll,!this.visible)return;const e=this.renderer.chart.timingData.getTimingData("SCROLLS");this.x=this.renderer.chartManager.app.STAGE_WIDTH/4;for(const r of this.scrollMap.values())r.marked=!1;for(const r of e){if(r==e.at(-1))continue;if(this.scrollMap.has(r)){this.scrollMap.get(r).marked=!0;continue}const s=new ye,o=new De(Se.WHITE),l=new Ee("",{fontName:"Main",fontSize:25});o.alpha=.2,o.width=150,o.anchor.x=.5,l.anchor.x=.5,s.text=l,s.marked=!0,s.box=o,this.scrollMap.set(r,s),s.addChild(o,l),this.addChild(s)}const t=this.renderer.chartManager.beat;for(let r=0;r<e.length-1;r++){let s=this.renderer.getYPosFromBeat(e[r].beat),o=this.renderer.getYPosFromBeat(e[r+1].beat);const l=this.scrollMap.get(e[r]);if(!this.inBounds(o)&&!this.inBounds(s)&&s*o>=0){l.visible=!1;continue}if(Math.abs(e[r].beat-t)>20&&Math.abs(e[r+1].beat-t)>20&&!(t>e[r].beat&&t<e[r+1].beat)){l.visible=!1;continue}l.text.text=`yStart:${ue(s,1)}
yEnd:${ue(o,1)}
val:${e[r].value}
h:${ue(o-s,1)}`,o<s&&([s,o]=[o,s]),l.visible=!0,l.y=s,l.box.height=o-s,l.box.tint=16777215,l.text.tint=16777215,t>e[r].beat&&t<e[r+1].beat&&(l.text.y=Math.max(this.renderer.getActualReceptorYPos()-s,0),l.box.tint=8978312),t<e[r].beat&&(l.text.y=0),t>e[r+1].beat&&(l.text.y=l.box.height),l.x=(r%4-1.5)*150}for(const[r,s]of this.scrollMap.entries())if(!s.marked){this.scrollMap.delete(r),s.destroy();continue}const n=this.renderer.findFirstOnScreenScroll(),a=this.renderer.findLastOnScreenScroll();{const r=this.scrollMap.get(n);r&&(r.text.text+=`
start`,r.box.tint==16777215&&(r.box.tint=16777096),r.text.tint=16777096)}{const r=this.scrollMap.get(a);r&&(r.text.text+=`
end`,r.box.tint==16777215&&(r.box.tint=8978431),r.text.tint=8978431)}this.receptors.y=this.renderer.getActualReceptorYPos(),this.topBound.y=this.renderer.getUpperBound(),this.bottomBound.y=this.renderer.getLowerBound(),this.topBoundBeat.y=this.renderer.getYPosFromBeat(this.renderer.getVisualBeat()-y.chart.maxDrawBeatsBack),this.bottomBoundBeat.y=this.renderer.getYPosFromBeat(this.renderer.getVisualBeat()+y.chart.maxDrawBeats),this.topScreenBeat.y=this.renderer.getYPosFromBeat(this.renderer.getTopOnScreenBeat()),this.bottomScreenBeat.y=this.renderer.getYPosFromBeat(this.renderer.getBottomOnScreenBeat()),this.topScreenBeatText.y=this.topScreenBeat.y,this.topScreenBeatText.text=ue(this.renderer.getTopOnScreenBeat(),3)+"",this.bottomScreenBeatText.y=this.bottomScreenBeat.y,this.bottomScreenBeatText.text=ue(this.renderer.getBottomOnScreenBeat(),3)+""}inBounds(e){const t=this.renderer.chartManager.app.STAGE_HEIGHT/this.scale.y;return Math.abs(e)<t}}class Ym extends ye{startMarker=new De(Se.WHITE);selectionArea=new De(Se.WHITE);renderer;constructor(e){super(),this.renderer=e,Object.assign(this.startMarker,{alpha:0,width:this.renderer.chart.gameType.notefieldWidth,height:64}),Object.assign(this.selectionArea,{alpha:0,tint:5140387,width:this.renderer.chart.gameType.notefieldWidth,height:64}),this.startMarker.anchor.set(.5),this.selectionArea.anchor.x=.5,this.addChild(this.selectionArea,this.startMarker)}update(){if(this.renderer.chartManager.getMode()==$.Play||this.renderer.chartManager.app.capturing){this.visible=!1;return}this.visible=!0;const e=this.renderer.chartManager.startRegion,t=this.renderer.chartManager.endRegion;e!==void 0&&t===void 0?(this.startMarker.alpha=Math.sin(Date.now()/320)*.1+.3,this.startMarker.y=this.renderer.getYPosFromBeat(e)):this.startMarker.alpha=0,e!==void 0&&t!==void 0?(this.selectionArea.alpha=Math.sin(Date.now()/320)*.1+.3,this.selectionArea.y=this.renderer.getYPosFromBeat(Math.min(e,t)),this.selectionArea.height=this.renderer.getYPosFromBeat(Math.max(e,t))-this.selectionArea.y):this.selectionArea.alpha=0}}class Km extends De{renderer;constructor(e){super(Se.WHITE),this.renderer=e,this.visible=!1,this.alpha=.2,this.eventMode="none"}update(){const e=this.renderer.getSelectionBounds();if(this.visible=!!e,e){const t=this.renderer.getYPosFromBeat(e?.startBeat),n=this.renderer.getYPosFromBeat(e?.endBeat);this.position.x=Math.min(e.startX,e.endX),this.position.y=Math.min(t,n),this.width=Math.abs(e.endX-e.startX),this.height=Math.abs(n-t)}}}const Xm=3500;class Zm extends De{lineContainer=new Ns(1500,{position:!0,scale:!0,tint:!0,alpha:!0},16384,!0);waveformTex;renderer;rawData=[];filteredRawData=[];speed;lastSpeed;lastSpeedTimeout;sampleRate=44100;poolSearch=0;trackedVariables=new Map;drawDirty=!0;blockCache=new Map;colorCache=new L("black");filteredColorCache=new L("black");constructor(e){super(),this.renderer=e,this.waveformTex=_i.create({resolution:Math.min(1,y.performance.resolution)}),this.texture=this.waveformTex,this.speed=this.getSpeed(),this.lastSpeed=this.getSpeed(),this.trackVariable(()=>this.renderer.getVisualBeat()),this.trackVariable(()=>this.renderer.getVisualTime()),this.trackVariable(()=>y.chart.speed),this.trackVariable(()=>this.getSpeed(),r=>{this.speed=r,clearTimeout(this.lastSpeedTimeout),this.lastSpeedTimeout=setTimeout(()=>{this.blockCache.clear(),this.lastSpeed=this.speed,this.drawDirty=!0},200)}),this.trackVariable(()=>y.chart.zoom),this.trackVariable(()=>y.chart.CMod),this.trackVariable(()=>y.chart.doSpeedChanges),this.trackVariable(()=>y.chart.waveform.allowFilter),this.trackVariable(()=>y.chart.reverse),this.trackVariable(()=>y.chart.waveform.antialiasing,r=>{this.filters=r?[new Co]:[]}),this.trackVariable(()=>this.renderer.chartManager.app.STAGE_WIDTH,()=>this.resizeWaveform()),this.trackVariable(()=>this.renderer.chartManager.app.STAGE_HEIGHT,()=>this.resizeWaveform()),this.trackVariable(()=>y.chart.waveform.filteredColor),this.trackVariable(()=>y.chart.waveform.color),this.trackVariable(()=>y.chart.waveform.speedChanges),this.trackVariable(()=>y.chart.receptorYPos),this.trackVariable(()=>y.chart.waveform.lineHeight,()=>{y.chart.waveform.lineHeight<=0&&(y.chart.waveform.lineHeight=1),this.updateLineHeight()}),this.trackVariable(()=>y.chart.zoom,()=>this.resizeWaveform()),this.trackVariable(()=>this.renderer.chartManager.chartAudio.hasFilters());const t=()=>this.getData();this.anchor.set(.5),this.renderer.chartManager.chartAudio.onUpdate(t),this.getData(),this.resizeWaveform(),this.filters=y.chart.waveform.antialiasing?[new Co]:[];const n=()=>this.drawDirty=!0,a=()=>{this.getData(),this.resizeWaveform(),this.renderer.chartManager.chartAudio.onUpdate(t)};le.on("timingModified",n),this.on("destroyed",()=>{le.off("timingModified",n)}),le.on("audioLoaded",a),this.on("destroyed",()=>{le.off("audioLoaded",a),this.renderer.chartManager.chartAudio.offUpdate(t)})}getData(){this.rawData=this.renderer.chartManager.chartAudio.getRawData(),this.filteredRawData=this.renderer.chartManager.chartAudio.getFilteredRawData(),this.sampleRate=this.renderer.chartManager.chartAudio.getSampleRate(),this.blockCache.clear(),this.drawDirty=!0}resizeWaveform(){this.waveformTex.resize(Ae((this.rawData?.length??0)*288*y.chart.zoom,1,this.renderer.chartManager.app.STAGE_WIDTH),this.renderer.chartManager.app.STAGE_HEIGHT)}update(){this.visible=y.chart.waveform.enabled&&this.renderer.shouldDisplayBarlines(),y.chart.waveform.enabled&&((this.drawDirty||this.variableChanged())&&(this.colorCache.toHexa()!=y.chart.waveform.color&&(this.colorCache=zn(y.chart.waveform.color)),this.filteredColorCache.toHexa()!=y.chart.waveform.filteredColor&&(this.filteredColorCache=zn(y.chart.waveform.filteredColor)),this.drawDirty=!1,this.renderData(),this.renderer.chartManager.app.renderer.render(this.lineContainer,{renderTexture:this.waveformTex})),this.scale.set(1/y.chart.zoom))}trackVariable(e,t){this.trackedVariables.set(e,{value:e(),cb:t})}variableChanged(){let e=!1;for(const[t,n]of this.trackedVariables.entries())t()!=n.value&&(this.trackedVariables.get(t).value=t(),this.trackedVariables.get(t).cb?.(t()),e=!0);return e}getSample(e,t,n){if(t<0)return 0;const a=this.sampleRate/(this.lastSpeed*4),r=Math.floor(t*this.lastSpeed*4);if(this.blockCache.get(n)?.[r]!==void 0)return this.blockCache.get(n)[r];const s=Math.floor(r*a),o=e.slice(s,Math.floor(s+a)).reduce((l,u)=>l+Math.abs(u),0)/a;return this.blockCache.has(n)||this.blockCache.set(n,[]),this.blockCache.get(n)[r]=o,o}renderData(){this.resetPool();const e=y.chart.waveform.allowFilter&&this.renderer.chartManager.chartAudio.hasFilters(),t={data:{bpms:[],bpmIndex:0,timing:[],timingIndex:0,offset:0,lastBeat:-999,timingData:null},init(a){if(this.data.bpms=a.getTimingData("BPMS"),this.data.timing=a.getBeatTiming(),this.data.offset=a.getOffset(),this.data.bpms[0]?.beat!==0){const r=structuredClone(this.data.bpms[0])??{value:120,type:"BPMS",beat:0};r.beat=0,this.data.bpms.unshift(r)}this.data.timing.length==0&&this.data.timing.unshift({beat:0,secondBefore:-this.data.offset,secondAfter:-this.data.offset,secondClamp:-this.data.offset,secondOf:-this.data.offset,warped:!1,bpm:120}),this.data.timingData=a},getBPM(a){for(;a>this.data.bpms[this.data.bpmIndex+1]?.beat;)this.data.bpmIndex++;return this.data.bpms[this.data.bpmIndex].value},getSecond(a){const r=Math.floor(a*48)/48;if(a<=0)return-this.data.offset+a*60/this.getBPM(a);if(r>=this.data.timing[this.data.timingIndex+1]?.beat){for(;r>=this.data.timing[this.data.timingIndex+1]?.beat;)this.data.timingIndex++;return this.data.timingData.getSecondsFromBeat(a)}else{const s=this.data.timing[this.data.timingIndex];let l=(a-s.beat)*60/s.bpm;return s.warped&&(l=0),Math.max(s.secondClamp,s.secondAfter+l)}}},n=this.renderer.chartManager.app.STAGE_HEIGHT;if(y.chart.waveform.speedChanges&&!y.chart.CMod&&y.chart.doSpeedChanges){const a=y.chart.speed,r=this.renderer.getCurrentSpeedMult(),s=this.renderer.getTopOnScreenBeat(),o=this.renderer.getBottomOnScreenBeat(),l=Math.min(s,o),u=Math.max(s,o),f=this.renderer.findFirstOnScreenScroll(),c=this.renderer.findLastOnScreenScroll(),d=[...this.renderer.chart.timingData.getTimingData("SCROLLS")];d[0]?.beat!=0&&d.unshift({type:"SCROLLS",beat:0,value:d[0]?.value??1}),t.init(this.renderer.chart.timingData);const h=d.findIndex(v=>v.beat==f.beat),p=d.findIndex(v=>v.beat==c.beat),m=100/a/Math.abs(r)/64/y.chart.zoom;let g=l,b=Math.round(this.renderer.getYPosFromBeat(g)*y.chart.zoom+n/2),x=this.renderer.chart.getSecondsFromBeat(g);for(const v of d.slice(h,p+1)){if(v.value==0)continue;const C=m/Math.abs(v.value);v.beat!=f.beat?g=v.beat:g=Math.round((g-v.beat)/C)*C+v.beat,b=Math.round(this.renderer.getYPosFromBeat(g)*y.chart.zoom+n/2),x=this.renderer.chart.getSecondsFromBeat(g);const E=this.renderer.getScrollDirection(v.value),R=d[d.indexOf(v)+1]?.beat??Number.MAX_VALUE;for(;g<Math.min(R,u);){if(b<0){if(E<0){g=R;break}g+=C*-b,b=0;continue}if(b>n){if(E>0){g=R;break}g+=C*(b-n),b=n;continue}g+=C*y.chart.waveform.lineHeight,b+=E*y.chart.waveform.lineHeight,x=t.getSecond(g),this.drawLine(x,b,e)}}}else if(y.chart.CMod){let a=this.renderer.getSecondFromYPos((-n/2+(y.chart.reverse?this.renderer.chartManager.app.STAGE_HEIGHT:0))/y.chart.zoom);const r=this.renderer.getPixelsToSecondsRatio()/y.chart.zoom;a=Math.floor(a/r)*r;const s=o=>{a+=r*y.chart.waveform.lineHeight,this.drawLine(a,o,e)};if(y.chart.reverse)for(let o=this.renderer.chartManager.app.STAGE_HEIGHT;o>=0;o-=y.chart.waveform.lineHeight)s(o);else for(let o=0;o<=this.renderer.chartManager.app.STAGE_HEIGHT;o+=y.chart.waveform.lineHeight)s(o)}else{let a=this.renderer.getBeatFromYPos((-n/2+(y.chart.reverse?this.renderer.chartManager.app.STAGE_HEIGHT:0))/y.chart.zoom);t.init(this.renderer.chart.timingData);const r=this.renderer.getPixelsToEffectiveBeatsRatio()/y.chart.zoom;a=Math.floor(a/r)*r;let s=this.renderer.chart.getSecondsFromBeat(a);const o=l=>{a+=r*y.chart.waveform.lineHeight,s=t.getSecond(a),this.drawLine(s,l,e)};if(y.chart.reverse)for(let l=this.renderer.chartManager.app.STAGE_HEIGHT;l>=0;l-=y.chart.waveform.lineHeight)o(l);else for(let l=0;l<=this.renderer.chartManager.app.STAGE_HEIGHT;l+=y.chart.waveform.lineHeight)o(l)}this.purgePool()}drawLine(e,t,n){if(!(e<0))for(let a=0;a<this.rawData.length;a++){const r=this.getLine();if(r.scale.x=this.getSample(this.rawData[a],e,"main")*16*y.chart.zoom,r.y=t,r.tint=this.colorCache,r.alpha=this.colorCache.alpha,r.x=this.waveformTex.width/2+288*(a+.5-this.rawData.length/2)*y.chart.zoom,!n)continue;const s=this.getLine();s.scale.x=this.getSample(this.filteredRawData[a],e,"filter")*16*y.chart.zoom,s.tint=this.filteredColorCache,s.alpha=this.filteredColorCache.alpha,s.y=t,s.x=this.waveformTex.width/2+288*(a+.5-this.filteredRawData.length/2)*y.chart.zoom}}resetPool(){this.poolSearch=0}purgePool(){si(this.lineContainer.children,(e,t)=>t>=this.poolSearch)}updateLineHeight(){for(const e of this.lineContainer.children){const t=e;t.height=y.chart.waveform.lineHeight}}getLine(){if(this.lineContainer.children[this.poolSearch]){const t=this.lineContainer.children[this.poolSearch];return t.visible=!0,this.poolSearch++,t}const e=new De(Se.WHITE);return e.height=y.chart.waveform.lineHeight,e.anchor.set(.5),e.visible=!0,this.poolSearch++,this.lineContainer.addChild(e),e}getSpeed(){return Math.min(y.chart.speed,Xm)}}const Qm="/smeditor/assets/missing-Dwhls35X.png",zu=Se.from(Qm),Jm={HoldBodyTopOffset:0,HoldBodyBottomOffset:0,RollBodyTopOffset:0,RollBodyBottomOffset:0};class eg{renderer;options;objects=[];updateHooks=new Set;hooks={};metrics;constructor(e,t){this.renderer=e,this.options=t,this.options.init?.(e),this.metrics={...Jm,...this.options.metrics}}update(e){this.options.update?.(e),this.updateHooks.forEach(({item:t,cb:n})=>{t.destroyed||n(e)})}getPlaceholderSprite(){const e=new De(zu);return e.anchor.set(.5),e}getBlankSprite(){return new De(Se.EMPTY)}getElement(e,t={}){try{return this.options.load?this.options.load.bind(this)(e,{noteskin:this,columnName:e.columnName,columnNumber:e.columnNumber,...t})??this.getPlaceholderSprite():this.loadElement(e,t)??this.getPlaceholderSprite()}catch(n){return console.error(n),y.debug.showNoteskinErrors&&de.createFormatted("Noteskin Error: "+n,"error"),this.getPlaceholderSprite()}}loadElement(e,t={}){const n=this.followRedirs(e);return n===void 0?(y.debug.showNoteskinErrors&&de.createFormatted(`Noteskin element ${e.columnName} ${e.element} failed to load for noteskin: Redirect loop`,"error"),this.getPlaceholderSprite()):n({noteskin:this,columnName:e.columnName,columnNumber:e.columnNumber,...t})}followRedirs(e){const t=[e];let n=e;for(;;){const a=this.options.elements[n.columnName]?.[n.element];if(a===void 0)return;if(typeof a=="function")return a;if(n={columnName:a.columnName??n.columnName,columnNumber:a.columnNumber??n.columnNumber,element:a.element},t.some(r=>n.columnName==r.columnName&&n.element==r.element))return;t.push(n)}}on(e,t,n){this.hooks[t]===void 0&&(this.hooks[t]=new Set);const a={item:e,cb:n};this.hooks[t].add(a),e.once("destroyed",()=>this.hooks[t].delete(a))}onUpdate(e,t){const n={item:e,cb:t};this.updateHooks.add(n),e.once("destroyed",()=>this.updateHooks.delete(n))}broadcast(e){if(this.hooks[e.type]===void 0)return;this.hooks[e.type].forEach(({item:n,cb:a})=>{n.destroyed||a(e)})}}const tg="/smeditor/assets/hold_judgement-BL12d-N2.png";class zi extends ye{children=[];static held_tex;static dropped_tex;notefield;constructor(e){super(),zi.held_tex||this.loadTex(),this.notefield=e}async loadTex(){const e=await Ju.load(tg),t=e.height,n=e.width;zi.held_tex=new Se(e,new gs(0,0,n,t/2)),zi.dropped_tex=new Se(e,new gs(0,t/2,n,t/2))}update(){this.y=this.notefield.renderer.getActualReceptorYPos()+(y.chart.reverse?-48:48);for(const e of this.children){const t=(Date.now()-e.createTime)/1e3;if(t<.1){const n=1-(1-t/.1)*(1-t/.1);e.scale.set(.3*n)}else if(t>.6&&t<.8){const n=(t-.6)/.2*(t-.6)/.2;e.scale.set(.3*(1-n))}}si(this.children,e=>Date.now()-e.createTime>800)}addJudge(e,t){if(!Pn(t)&&!sn(t))return;const n=new De(Pn(t)?zi.dropped_tex:zi.held_tex);n.anchor.set(.5),n.x=this.notefield.getColumnX(e),n.createTime=Date.now(),n.scale.set(0),this.addChild(n)}}const ig={L:233724,l:11261687,R:16559363,r:16442809};class ng extends ye{notefield;arrowMap=new Map;notesDirty=!1;children=[];constructor(e){super(),this.notefield=e,this.sortableChildren=!0;const t=()=>{this.arrowMap.clear(),this.removeChildren()},n=()=>this.notesDirty=!0;le.on("timeSigChanged",t),le.on("chartModified",n),this.on("destroyed",()=>{le.off("timeSigChanged",t),le.off("chartModified",n)})}update(e,t){const n=this.notefield.renderer.chart.getNotedata();if(this.notesDirty){for(const[a,r]of this.arrowMap.entries())n.includes(a)||(r.destroy(),this.arrowMap.delete(a));this.notesDirty=!1}for(const a of n){if(a.beat>t)break;if(this.shouldDisplayNote(a,e,t)&&!this.arrowMap.has(a)){const r=new ye,s=this.notefield.createNote(a);Object.assign(r,{x:this.notefield.getColumnX(a.col),zIndex:a.beat});const o=new De(Se.WHITE),l=s.getBounds();o.x=l.x,o.y=l.y,o.width=l.width,o.height=l.height,o.alpha=0;const u=new De(Se.WHITE);u.x=l.x,u.y=l.y,u.width=l.width,u.height=l.height,u.alpha=0,this.notefield.renderer.registerDragNote(r,a),r.wrapper=s,r.selection=o,r.parity=u,r.lastActive=!1,this.arrowMap.set(a,r),r.addChild(s,o,u),this.addChild(r)}}for(const[a,r]of this.arrowMap.entries()){if(!this.shouldDisplayNote(a,e,t)){r.destroy(),this.arrowMap.delete(a);continue}if(r.y=this.notefield.renderer.getActualReceptorYPos(),(!Re(a)||!a.gameplay?.lastHoldActivation||this.notefield.renderer.getVisualBeat()<a.beat)&&(r.y=this.notefield.renderer.getYPosFromBeat(a.beat)),Re(a)&&a.gameplay?.droppedHoldBeat&&(r.y=this.notefield.renderer.getYPosFromBeat(a.gameplay.droppedHoldBeat)),Re(a)){const s=this.notefield.renderer.getYPosFromBeat(Vi(a))-r.y,o=r.wrapper.object;if(o.setLength(s),a.gameplay?.lastHoldActivation){let l=(Date.now()-a.gameplay.lastHoldActivation)/wt.getCollection(y.play.timingCollection).getHeldJudgement(a).getTimingWindowMS();l=Math.min(1.2,l),o.setBrightness(1-l*.7)}else o.setBrightness(1);a.gameplay?o.setActive(!(a.gameplay.lastHoldActivation===void 0||a.gameplay.droppedHoldBeat!==void 0)):o.setActive(!1)}if(this.notefield.renderer.chartManager.editTimingMode==Ce.Off){const s=this.notefield.renderer.shouldDisplayNoteSelection(a);if(r.selection.alpha=s?Math.sin(Date.now()/320)*.1+.3:0,s&&r.wrapper.object.type=="hold"){const l=r.wrapper.getLocalBounds();r.selection.x=l.x,r.selection.y=l.y,r.selection.width=l.width,r.selection.height=l.height}r.visible=!s||!this.notefield.renderer.chartManager.selection.shift;const o=this.notefield.renderer.selectionTest(r.wrapper);!s&&o&&this.notefield.renderer.chartManager.addNoteToDragSelection(a),s&&!o&&this.notefield.renderer.chartManager.removeNoteFromDragSelection(a)}r.parity.alpha=a.parity?.4:0,r.parity.tint=a.parity!==void 0?ig[a.parity]:16777215}}shouldDisplayNote(e,t,n){return e.gameplay?.hideNote||y.chart.CMod&&e.fake&&y.chart.hideFakedArrows||y.chart.CMod&&y.chart.hideWarpedArrows&&e.warped||Vi(e)<t?!1:e.beat<=n}}class ag extends ye{notefield;children=[];constructor(e){super(),this.notefield=e,this.eventMode="none";for(let t=0;t<this.notefield.gameType.numCols;t++){const n=this.notefield.getElement({element:"NoteFlash",columnName:this.notefield.getColumnName(t),columnNumber:t});n.x=this.notefield.getColumnX(t),this.addChild(n)}}update(){this.y=this.notefield.renderer.getActualReceptorYPos()}}class rg extends ye{notefield;children=[];dragStart=null;dragOptionsStart=null;optionUpdate=e=>{e=="chart.allowReceptorDrag"&&(this.eventMode=y.chart.allowReceptorDrag?"static":"passive")};constructor(e){super(),this.notefield=e;for(let a=0;a<this.notefield.gameType.numCols;a++){const r=this.notefield.getElement({element:"Receptor",columnName:this.notefield.getColumnName(a),columnNumber:a});r.x=this.notefield.getColumnX(a),this.addChild(r)}const t=a=>{!this.dragStart||!this.dragOptionsStart||(y.chart.receptorXPos=Math.round(this.dragOptionsStart[0]+a.global.x-this.dragStart.x),y.chart.receptorYPos=Math.round(this.dragOptionsStart[1]+(a.global.y-this.dragStart.y)*(y.chart.reverse?-1:1)))},n=()=>{this.notefield.renderer.off("pointermove",t),window.removeEventListener("pointerup",n)};this.on("pointerdown",a=>{this.dragStart=new ed(a.globalX,a.globalY),this.dragOptionsStart=[y.chart.receptorXPos,y.chart.receptorYPos],a.preventDefault(),a.stopImmediatePropagation(),this.notefield.renderer.on("pointermove",t),window.addEventListener("pointerup",n)}),le.on("userOptionUpdated",this.optionUpdate),this.optionUpdate("chart.allowReceptorDrag")}destroy(){le.off("userOptionUpdated",this.optionUpdate)}update(){this.y=this.notefield.renderer.getActualReceptorYPos()}}class sg extends ye{notefield;arrowMap=new Map;children=[];lastBeatShift=0;lastColShift=0;constructor(e){super(),this.notefield=e,this.sortableChildren=!0}update(e,t){if(!this.notefield.renderer.chartManager.selection.shift){this.removeChildren(),this.arrowMap.clear();return}const n=this.notefield.renderer.chartManager.selection.shift.beatShift,a=this.notefield.renderer.chartManager.selection.shift.columnShift;if(this.lastBeatShift!=n||this.lastColShift!=a){this.lastBeatShift=n,this.lastColShift=a;for(const[r,s]of this.arrowMap.entries()){const o=this.notefield.renderer.chartManager.loadedChart.computeNote({...r,beat:r.beat+n,col:r.col+a});s.x=this.notefield.getColumnX(o.col),s.wrapper.destroy(),s.wrapper.alpha=.4,s.wrapper=this.notefield.createNote(o);const l=s.wrapper.getBounds();s.selection.x=l.x,s.selection.y=l.y,s.selection.width=l.width,s.selection.height=l.height,s.addChild(s.wrapper,s.selection)}}for(const r of this.notefield.renderer.chartManager.selection.notes)if(!(r.beat+n+(Re(r)?r.hold:0)<e)&&!(r.beat+n>t)&&!this.arrowMap.has(r)){const s={...r,beat:r.beat+n,col:r.col+a},o=new ye,l=this.notefield.createNote(s);Object.assign(o,{x:this.notefield.getColumnX(s.col),zIndex:s.beat,alpha:.4});const u=new De(Se.WHITE),f=l.getBounds();u.x=f.x,u.y=f.y,u.width=f.width,u.height=f.height,u.alpha=0,this.notefield.renderer.registerDragNote(l,s),o.wrapper=l,o.selection=u,this.arrowMap.set(r,o),o.addChild(l,u),this.addChild(o)}for(const[r,s]of this.arrowMap.entries()){if(r.beat+n+(Re(r)?r.hold:0)<e||r.beat+n>t){s.destroy(),this.arrowMap.delete(r);continue}const o=r.beat+n;if(s.y=this.notefield.renderer.getYPosFromBeat(o),s.selection.alpha=Math.sin(Date.now()/320)*.1+.3,Re(r)){const l=this.notefield.renderer.getYPosFromBeat(o+(Re(r)?r.hold:0))-s.y,u=s.wrapper.object;u.setLength(l),u.setBrightness(1);const f=s.wrapper.getLocalBounds();s.selection.x=f.x,s.selection.y=f.y,s.selection.width=f.width,s.selection.height=f.height}}}}const og="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAMAAABHPGVmAAAAAXNSR0IB2cksfwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAZ5QTFRFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8fHx9vb29PT0AAAA+fn5/////f39AAAAAAAAAAAAAAAA/v7+AAAAAAAA9vb2AAAAAAAA8/PzAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv401VgAAAIp0Uk5TABZHbpW80t3u+bttRhUKT5H+/9GQTgkCPJnxok0DCGreaQd05nLf41Qgs7EeUFYTx8QSGtYdKOLhJxvg5B/VxZRS8O+ysHVw5fv28fRn7v/qvtwBQeo+nvKb8vRLwr2Mz/0URGuSudPt6/jOSp2aQD3bZnNJrkxRjgYP0NQmGREEiFVvM+yNRZO6TR9aLAAABG9JREFUeJzt2VloFEkYAOD/T2aSzJh0gmSM7kbFQYOJGWJWNB6oefBYjAdeeBCMB3iB7IPHgw/isoIu6y6yeIDZNQaVhYjghSd44IO6G6IxwSsq4n2GGE2Midr2SI4+/uqq6h5lhfkfcnRX1dfddXRVNcJXCIwiUSSKfGsItgWoquppjkd8HVlEQWzsZE6qxmjiswghaVpZTYxzCdq5++6RHoj1tgkavsM77hAlgLW8y4DO+NT+OuyRdP8LLhGOAF53imTiEyEiHN2w2hESqvELG1oTSL0ijwRrYySIcMT7WA2AheTgPUkDoCdWSCEDqhKlDe3u8T8JZBDWODAAMvC8MDIUrzkyALLwnCCS4+V1YXZkvyHqhUCCinydd0TovvUKCSSf3eBF4mOdANJXaPS2iZzTXCSz22WXSG6zufItyChGh5KIASc5SOihawPA/8AWUUJOe4ihlEZjvZqQMeURMAAGHrdBghn/RgTp3GzoakakJzXLydMmC+9pPCtFmx5dJE4MO8RE0nzEuzrPi+FJ11miqJGqqs2MWgglH/exkGmniJIGe8M/495blZGe5vCvlgtErlFlLGSGuYGHY4gHaKXVAN8JItfYfxiIMv4YkXxoLJBKmwGJR4lc/at1rViPJMcSqSErVaWUdgOryZnZuN00kkJPHQqaWouL259EHPQdJnNNKKWROMZ7nVC4BkzcSSKYwpq6tD+atidmOWCNSbiDQmJSGOkt98K/Dy0m/00hscnMDEZFyIApf1GIR2Hn0CszhQyYWkwh/gSbLLpqAG59fI5p2ylk0V67PB330hr296GV/JJChnHeV0aFZ4Byl0IWl1lTMhWuATO2UYjPx8mmU/gGzNzqGtGNMFKI3OPiKvTjkqx4nkJXvGwT5ih0E/4qnVFwWPGp1PvFGvSwIjZAam2XfItZgh4ghYb6z/1DSKGH+iRPRF9aFZUUIvD6be/n/HuZtaXjbz2S+lHUEFBYE4nAByo1d0rURM6TZ2+mESWR2qBzNrnLrdHN6w11vWwPkdzZNLXwT90/BuSnXURyZxPuOZtYSFpdJ2tyR0uHonvMpQP0ekUUlYfKG8YiaJAnsZ5cBM39Q//fl1nOBVoMex+mTr68JCLIK2NnMC+xu4ptn9pHfrlxC8g8XK3YAe5DvzahEOj32LWx4DfTAQuSnXbJpdEYMu9EWkf3VcXuvqmoC381HyIKZKzqRGPhBsshanuwe5ULoyB9vQgCq3EbcVQslh4R2+h0s2Ub8FLfBehKHqLedGRkjP6FOsxoSWu2qA6M7Lcy2+gAPyTJ135B8Gf6BLNPrMVNcv1FVZdY2xUHAUh+J/WRZvEa5jm7qx1eKz6OLThDVwcX0YaYMvvPbm3RMH233WnOc++S23CVSwQKi+0/IXArN9jPe8Y2QRHGsypcGNFi3caVvzNO9b/xY90+xjk5BKDHiPQneMB0cJL/+0cHhT61iPeF+X1u98b6jfNKoahkxfPgLbW8kp9JFnERUSSKRJH/CfIJY3BkdLZ23K0AAAAASUVORK5CYII=",lg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAMAAABHPGVmAAAAAXNSR0IB2cksfwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAapQTFRFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/v7+/v7+AAAA////AAAAAAAAAAAAAAAAAAAAAAAAAAAA+Pj4AAAAAAAA+fn5////AAAAAAAAAAAAAAAAAAAA/Pz8AAAAAAAAAAAAAAAAAAAAAAAA+Pj4AAAA////AAAA9fX19PT0+/v7AAAA+fn5/v7+AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAE+ClvgAAAI50Uk5TABZHbpW80t3u+bttRhUKT5H+/9GQTgkCPJnxok0DCGreaQd05nLf41Qgs7EeUFYTx8QSGtYdKOLhJxvg5B/VxZRS8O+ysHVw5f/+Z//cAUE+nptL+IzP+P79FOxEa/SS7bnT6/j55/Lo+/328vfzzkqdmkA922ZzSa5MUY7CBg/Q1CYZEQSIVW8zjUWTutnbD5QAAARSSURBVHic7dlpSBRRHADw918tz1axVjNTyQ+S6WIWnVKoWUInHWAKRRcERUX0oYMo6EA6iOpDQQcihV0UJYREQUREJ5UZlgVR2U1JnpWV02y17s6b/7t2pijY/wdx33s7v5l99xsgfyEgiASRIPK/IeANomlaaEcYQIu9iBOgPYouqjl08Z1NSIJ+rc+MvHA9r8E6kgLQzC3Q1geeWEOcLmgU3QaJg7f8++AjfSPfCwlPuOBhoEgGvJEiPJEI9wNC3I8jpQ29CfS6p46kNToUCE+ERbAaAAvJhueKBiGpcFsJGVwbrWzoTw83FZCh8DgAg5B0uCqNjIQHARmEDIDLkkh2N1EXZkdWK1IvCJLmVK9zX7gbzHeIIHnsBi8TnR8lkP5Sozcnsi8KkYzEuxaRnA668k1IIaNDKcTg8wLE/dKyQUjkCy7idAfaQwxXaTfWK4WMu2WDQciQcxwkLf2GLUhch6GrGZFU8SpnmL4kui4sNeIsE0mI4M/Vegz3zDKd10TFcqGKhUzBRjezIaOMPs1Cpl6SMySUvFMMJD5L0NmH+2ZkkRL+za8V+yMxIdKGWMk/iSOx/KVDgXGtKlDGnMCR7tx5vYBeD/OVwuMoArG8ld7Ytt//RJNWGaUIKjHEEcv5TtdzRIe8cUkp4w9jSEiMlFFNcqSUCYcwJNQpNuK+V+t/pZRJFRgSGc4q31UfcY5fo8Xkz14lip6gumJKOYbMO40U9QT1HJ7wPQtTgQ8YksuYrxBDRnE+xZA5VeaSLENCmXoQQyIiFAxdSfJu9HBl2gFphGkIFRzBfi6OIVLwnwupeK4hUPCKNzdhgcFX8CZs6ozTX3sNB97w9F7Z6VUST1JZeGekV/Mz4KXI8FOS4LgxBx9WosKMpYobxIafknzMmIEPkNHdjaVmPpcwfErKUWM6PtT3CKUmrZJnEoZXST1iTC2qq8EQ0lMzliv9eYBWSUSBlpu1y/e/P9KrU3g9+WAtJFzfbURm78QR4eJOIQbeZyzuyPIKumzAMWeH3wcDsqKc2BXztrOQhI9RNhnz65lbB9KvySZkwVb/T39mO+f6ajj7oDr5yv22IE3GzkBvsXvLHZ/yI7fGeAREr7FX7bMByafmFtNCPvM1naIcC8uoBBOSlXDHotHupk8izVuSNXutvVPRFm2mk5ALCnZ1oli0yZSEHQ8m11owFsMGGYSsh90BG8vOyB10WjmydXXD3gvglTxCexSQkT5+HZbMaEkbd2p4BjeyPqkcoxMyqId67S8OW4tnMPvEZtim1l80bam5XQkQQmK+KL2kWbKamce721GN8uPYwgt4dQgRfYipFB7l/Yy2ifSaXgEh8TltdULCNXcP/xWCsHLTMhxXuAXmQzirwqURPbaUTcA3Wvoarj6/WbQgl33BnDIk41HIOSqxKD7p1SmpVy3yfaE05142tJSVHCPFR1Y/y6zRamvEX1JFLEQQCSJB5B9BfgCwNDJ0if9eSgAAAABJRU5ErkJggg==";class cg extends kc{offsetY=0;setY=0;_last=0;_lastTop=!1;constructor(e){super(e,0,0,0,0),this.scale.cb=()=>{this.refresh()}}cropBottom(e,t=!1){this._last==e&&!this._lastTop&&!t||(this._last=e,this._lastTop=!1,this._height=this.texture.height-e/Math.abs(this.scale.y),this._bottomHeight=0,this.offsetY=0,this.topHeight=this.texture.height-e/Math.abs(this.scale.y),this._updateY())}cropTop(e,t=!1){this._last==e&&this._lastTop&&!t||(this._last=e,this._lastTop=!0,this._height=this.texture.height-e/Math.abs(this.scale.y),this._topHeight=0,this.bottomHeight=this.texture.height-e/Math.abs(this.scale.y),this.offsetY=e/Math.abs(this.scale.y),this._updateY())}get y(){return this.setY}set y(e){this.setY=e,this._updateY()}_updateY(){super.y=this.setY+this.offsetY*Math.abs(this.scale.y)}refresh(){this._lastTop?this.cropTop(this._last,!0):this.cropBottom(this._last,!0)}}class Vu extends cg{constructor(e,t=64){super(e),this.scale.set(t/this.texture.width),this.pivot.x=t/2/this.scale.x,this.texture.on("update",()=>{this.width=this.texture.width,this.height=this.texture.height,this.scale.set(t/this.texture.width),this.pivot.x=t/2/this.scale.x,this.refresh()})}}class Lg extends Vu{_playing=!1;_autoUpdate=!1;_isConnectedToTicker=!1;_tickerUpdate=this.update.bind(this);_currentTime=0;_textures;_previousFrame=null;onComplete=null;onLoop=null;onFrameChange=null;animationSpeed=1;loop=!1;updateAnchor=!1;constructor(e,t){super(e[0],t),this.textures=e}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(At.shared.remove(this._tickerUpdate),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(At.shared.add(this._tickerUpdate,this,Ac.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(e){this.stop(),this.currentFrame=e}gotoAndPlay(e){this.currentFrame=e,this.play()}update(e){if(!this._playing)return;const t=this.animationSpeed*e,n=this.currentFrame;this._currentTime+=t,this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete?.()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete?.()):n!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<n||this.animationSpeed<0&&this.currentFrame>n)&&this.onLoop(),this.updateTexture())}updateTexture(){const e=this.currentFrame;this._previousFrame!==e&&(this._previousFrame=e,this.texture=this._textures[e],this.onFrameChange?.(this.currentFrame))}destroy(e){this.stop(),super.destroy(e),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}get totalFrames(){return this._textures?.length??0}get textures(){return this._textures??[]}set textures(e){this._textures=e,this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()}get currentFrame(){let e=Math.floor(this._currentTime)%this._textures.length;return e<0&&(e+=this._textures.length),e}set currentFrame(e){if(e<0||e>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${e}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const t=this.currentFrame;this._currentTime=e,t!==this.currentFrame&&this.updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(At.shared.remove(this._tickerUpdate),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(At.shared.add(this._tickerUpdate),this._isConnectedToTicker=!0))}}const ug={Fake:Se.from(og),Lift:Se.from(lg)};class gc extends ye{object;icon;constructor(e){super(),this.object=e,this.icon=new De(ug[e.note.type]),this.icon.anchor.set(.5),this.icon.scale.set(.3),this.icon.alpha=.8,this.icon.visible=!1,this.addChild(e,this.icon),e.nf.noteskin===void 0?le.on("noteskinLoaded",()=>this.loadEventHandler()):this.loadEventHandler()}loadEventHandler(){this.object.nf.noteskin.onUpdate(this,e=>{if(!y.chart.drawIcons){this.icon.visible=!1;return}if(this.object.nf.noteskinOptions?.hideIcons?.includes(this.object.note.type)){this.icon.visible=!1;return}this.icon.visible=!0,this.object.note.type=="Fake"&&(this.icon.visible=e.chartManager.getMode()!=$.Play)})}}class dg extends ye{type="note";note;nf;constructor(e,t){super(),this.note=t,this.nf=e,this.nf.noteskin===void 0?le.on("noteskinLoaded",()=>{this.loadElement(t)}):this.loadElement(t)}loadElement(e){const t=this.nf.noteskin.getElement({element:e.type,columnName:this.nf.getColumnName(e.col),columnNumber:e.col},{note:e});this.addChild(t)}}function hg(i){return i.cropTop!==void 0}class fg extends ye{type="hold";note;active;inactive;wasActive=!1;lastLength=null;elements;metrics;ns;nf;loaded=!1;constructor(e,t){super();const n=new ye,a=new ye;this.note=t,this.ns=e.noteskin,this.nf=e,this.metrics=this.ns.metrics,n.visible=!1,this.active=n,this.inactive=a,this.addChild(a,n),e.noteskin===void 0?le.on("noteskinLoaded",()=>{this.loadElements()}):this.loadElements()}loadElements(){if(!this.loaded){this.elements={};for(const e of["Active","Inactive"]){this.elements[e]={};for(const t of["BottomCap","Body","TopCap","Head"]){const n=this.getNoteskinElement(`${e} ${t}`);t=="BottomCap"?hg(n)?this.elements[e][t]=n:(y.debug.showNoteskinErrors&&de.createFormatted(`Noteskin Error: invalid tail found for ${e} ${t}!`,"error"),this.elements[e][t]=new Vu(zu,64)):this.elements[e][t]=n,(e=="Active"?this.active:this.inactive).addChild(this.elements[e][t])}}this.loaded=!0}}getNoteskinElement(e){return this.ns.getElement({element:`${this.note.type} ${e}`,columnName:this.nf.getColumnName(this.note.col),columnNumber:this.note.col},{note:this.note})}setActive(e){this.wasActive!=e&&(this.wasActive=e,this.active.visible=e,this.inactive.visible=!e)}setBrightness(e){if(!this.loaded)return;const t=["Active","Inactive"],n=["Body","TopCap","BottomCap"];for(const a of t)for(const r of n)"tint"in this.elements[a][r]&&(this.elements[a][r].tint=Js(e*255,e*255,e*255))}setLength(e){if(!this.loaded||this.lastLength==e)return;this.lastLength=e;const t=this.metrics[`${this.note.type}BodyBottomOffset`],n=this.metrics[`${this.note.type}BodyTopOffset`],a=["Active","Inactive"],r=e>=0?1:-1,s=Math.abs(e);for(const o of a){this.elements[o].Body.height=Math.max(0,s+t-n),this.elements[o].Body.y=s+t,this.elements[o].BottomCap.y=s+t,this.elements[o].BottomCap.y<0?(this.elements[o].BottomCap.cropTop(-this.elements[o].BottomCap.y),e<0&&(this.elements[o].BottomCap.y-=this.elements[o].BottomCap.y/Math.abs(this.elements[o].BottomCap.scale.y))):this.elements[o].BottomCap.cropTop(0),this.elements[o].TopCap.y=n;const l=Math.abs(this.elements[o].BottomCap.scale.y);this.elements[o].BottomCap.scale.y=e<0?-l:l;const u=Math.abs(this.elements[o].TopCap.scale.y);this.elements[o].TopCap.scale.y=e<0?-u:u,this.elements[o].Body.height*=r,this.elements[o].Body.y*=r,this.elements[o].BottomCap.y*=r,this.elements[o].TopCap.y*=r}}}class bc extends ye{noteskinOptions;noteskin;gameType;renderer;receptors;notes;selectionNotes;flashes;holdJudges;ghostNote;ghostNoteEntry;columnX=[];constructor(e){super(),this.renderer=e,this.gameType=e.chart.gameType,et.getNoteskin(this.gameType,y.chart.noteskin.name).then(t=>{if(!t){de.createFormatted("Couldn't find an available noteskin!","error");return}let n=0;for(let a=0;a<this.gameType.numCols;a++){const r=this.gameType.columnWidths[a];this.columnX.push(n-this.gameType.notefieldWidth/2+r/2),n+=r}this.noteskinOptions=t,this.noteskin=new eg(this.renderer,t),this.receptors=new rg(this),this.flashes=new ag(this),this.notes=new ng(this),this.selectionNotes=new sg(this),this.holdJudges=new zi(this),this.addChild(this.receptors,this.notes,this.selectionNotes,this.flashes,this.holdJudges),le.emit("noteskinLoaded")})}setGhostNote(e){this.ghostNote?.destroy(),this.ghostNote=void 0,this.ghostNoteEntry=e,e&&(this.ghostNote=this.createNote(e),this.addChildAt(this.ghostNote,1),this.ghostNote.alpha=.4,this.ghostNote.x=this.getColumnX(e.col),this.ghostNote.y=this.renderer.getYPosFromBeat(e.beat))}getElement(e,t={}){return this.noteskin.getElement(e,t)}update(e,t){this.noteskin!==void 0&&(this.noteskin.update(this.renderer),this.receptors.update(),this.flashes.update(),this.notes.update(e,t),this.selectionNotes.update(e,t),this.holdJudges.update(),this.ghostNote&&(this.ghostNote.y=this.renderer.getYPosFromBeat(this.ghostNoteEntry.beat),this.ghostNote.visible=y.chart.mousePlacement&&this.renderer.chartManager.getMode()==$.Edit&&this.renderer.chartManager.editTimingMode==Ce.Off&&this.ghostNoteEntry.beat>=e&&this.ghostNoteEntry.beat<=t&&this.ghostNoteEntry.beat>=0))}onJudgement(e,t){this.noteskin!==void 0&&(this.renderer.chartManager.getMode()==$.Play&&this.holdJudges.addJudge(e,t),pi(t)&&this.noteskin.broadcast({type:"hit",judgement:t,columnName:this.getColumnName(e),columnNumber:e}),sn(t)&&this.noteskin.broadcast({type:"held",columnName:this.getColumnName(e),columnNumber:e}),Pn(t)&&this.noteskin.broadcast({type:"letgo",columnName:this.getColumnName(e),columnNumber:e}),oi(t)&&this.noteskin.broadcast({type:"miss",judgement:t,columnName:this.getColumnName(e),columnNumber:e}),Os(t)&&this.noteskin.broadcast({type:"hitmine",columnName:this.getColumnName(e),columnNumber:e}))}startPlay(){}endPlay(){if(this.noteskin!==void 0)for(let e=0;e<this.gameType.numCols;e++)this.noteskin.broadcast({type:"holdoff",columnName:this.getColumnName(e),columnNumber:e}),this.noteskin.broadcast({type:"rolloff",columnName:this.getColumnName(e),columnNumber:e}),this.noteskin.broadcast({type:"lift",columnName:this.getColumnName(e),columnNumber:e})}press(e){this.noteskin!==void 0&&this.noteskin.broadcast({type:"press",columnName:this.getColumnName(e),columnNumber:e})}lift(e){this.noteskin!==void 0&&this.noteskin.broadcast({type:"lift",columnName:this.getColumnName(e),columnNumber:e})}ghostTap(e){this.noteskin!==void 0&&this.noteskin.broadcast({type:"ghosttap",columnName:this.getColumnName(e),columnNumber:e})}activateHold(e){this.noteskin!==void 0&&this.noteskin.broadcast({type:"holdon",columnName:this.getColumnName(e),columnNumber:e})}releaseHold(e){this.noteskin!==void 0&&this.noteskin.broadcast({type:"holdoff",columnName:this.getColumnName(e),columnNumber:e})}activateRoll(e){this.noteskin!==void 0&&this.noteskin.broadcast({type:"rollon",columnName:this.getColumnName(e),columnNumber:e})}releaseRoll(e){this.noteskin!==void 0&&this.noteskin.broadcast({type:"rolloff",columnName:this.getColumnName(e),columnNumber:e})}getColumnX(e){return this.columnX[e]??0}getColumnWidth(e){return this.gameType.columnWidths[e]}getColumnName(e){return this.gameType.columnNames[e]}createNote(e){return Re(e)?new gc(new fg(this,e)):new gc(new dg(this,e))}}class pg extends Ee{renderer;constructor(e){super("",{fontName:"Fancy"}),this.anchor.set(.5),this.renderer=e}update(){this.y=y.chart.reverse?-50:50;const e=this.renderer.chartManager.gameStats;if(this.visible=this.renderer.chartManager.getMode()==$.Play,!e)return;const t=e.getCombo()==0?e.getMissCombo():e.getCombo();t<4?this.text="":this.text=t+"",e.getCombo()==0?this.tint=wt.getCollection(y.play.timingCollection).getMissJudgement().color:e.getBestJudge()?this.tint=eo(e.getBestJudge().color,Math.sin(Date.now()/225)*.2+1.2):this.tint=16777215}}const mg=1,yc=15,gg={fontName:"Fancy",fontSize:12};class bg extends ye{barlines=new ye;barline;currentMedian;errorText=new Ee("",gg);errorTextTime=-1;renderer;target=0;constructor(e){super(),this.renderer=e,this.barline=new De(Se.WHITE),this.barline.anchor.set(.5),this.barline.height=1,this.barline.alpha=.5,He(this.barline,"text-color");const t=new De(Se.WHITE);t.width=2,t.height=yc,t.anchor.set(.5),He(t,"text-color"),this.currentMedian=new Ra,this.currentMedian.beginFill(16777215),this.currentMedian.moveTo(0,-10),this.currentMedian.lineTo(5,-15),this.currentMedian.lineTo(-5,-15),this.currentMedian.lineTo(0,-10),He(this.currentMedian,"text-color"),this.errorText.y=-25,this.errorText.anchor.set(.5),this.addChild(this.barline,t,this.barlines,this.currentMedian,this.errorText)}update(){this.y=y.chart.reverse?-10:10,this.errorText.y=y.chart.reverse?25:-25,this.visible=this.renderer.chartManager.getMode()==$.Play;for(const e of this.barlines.children){const t=(Date.now()-e.createTime)/5e3;t<.05?e.alpha=1:t<.3?e.alpha=xt(1,.2,(t-.05)/.25):t<.9?e.alpha=.2:e.alpha=(1-t)*3}this.errorText.alpha=Ae((2e3-(Date.now()-this.errorTextTime))/1e3,0,1),this.barline.width=wt.getCollection(y.play.timingCollection).maxWindowMS()/1e3*2*400,si(this.barlines.children,e=>Date.now()-e.createTime>5e3),y.general.smoothAnimations?this.currentMedian.x=(this.currentMedian.x-this.target)*.8+this.target:this.currentMedian.x=this.target}addBar(e,t){if(e==null||!oi(t)&&!pi(t))return;const n=new De(Se.WHITE);n.width=mg,n.height=yc,n.anchor.set(.5),n.x=e*400,n.tint=t.color,n.createTime=Date.now(),n.miss=oi(t),n.ms=Math.round(e*1e3),this.errorText.tint=t.color,this.errorText.text=(e*1e3).toFixed(1)+"ms",this.errorTextTime=Date.now(),this.barlines.addChild(n),this.target=Ia(this.barlines.children.filter(a=>!a.miss).map(a=>a.ms))*.4}reset(){this.currentMedian.x=0,this.target=0,si(this.barlines.children,()=>!0)}}class yg extends De{createTime=-1;active=!1;type=Ps;constructor(){super(),this.anchor.set(.5)}update(){if(this.y=y.chart.reverse?40:-40,this.visible=this.active,this.active){const e=(Date.now()-this.createTime)/1e3;let t=1.2;if(wt.getCollection(y.play.timingCollection).shouldHideNote(this.type)||(t=.8),e<.1){const n=1-(1-e/.1)*(1-e/.1),a=(1-t)*n+t;this.scale.x=.4*a,this.scale.y=.4*a}else if(e>.6&&e<.8){const n=(e-.6)/.2*(e-.6)/.2;this.scale.x=.4*(1-n),this.scale.y=.4*(1-n)}else e>.8&&(this.active=!1)}}doJudge(e,t){if(e==null&&(e=0),!pi(t)&&!oi(t))return;const n=t.judgementTexture.getTexture(e,t);n&&(this.texture=n,this.texture.updateUvs(),this.active=!0,this.type=t,this.createTime=Date.now(),y.play.judgementTilt?this.rotation=Ae(e,-.05,.05)*300/180*Math.PI:this.rotation=0)}reset(){this.active=!1}}class di extends ea{static options;static convertText;static convertBtnOne;static convertBtnTwo;static onTimingChange=this.updateValues.bind(this);onConfirm=()=>{};persistent=!1;static open(e){super._open({...e,title:"Column",description:"",width:255,editable:!0,cancelableOnOpen:!1}),le.on("timingModified",this.onTimingChange),this.updateValues()}static buildContent(){const e=document.createElement("div");e.style.display="flex",e.style.gap="0.25rem",e.style.alignItems="center",e.style.flexDirection="column",e.style.marginTop="0.6rem",e.style.fontSize="0.75rem";const t=document.createElement("div"),n=document.createElement("button"),a=document.createElement("button");this.convertBtnOne=n,this.convertBtnTwo=a,this.convertText=t,e.replaceChildren(t,n,a),this.view.appendChild(e)}static close(){!this.popup||!this.active||(super.close(),le.off("timingModified",this.onTimingChange))}static updateValues(){const e=this.options.timingData.isPropertyChartSpecific(this.options.type),t=e?"chart":"song";this.title.innerText=Ge[t].title,this.desc.innerText=Ge[t].desc,this.convertText.innerText=Ge[t].convertText,this.convertBtnOne.innerText=Ge[t].buttonOne.text,this.convertBtnTwo.innerText=Ge[t].buttonTwo.text,this.convertBtnTwo.classList.toggle("delete",e),Ke(this.convertBtnOne,{content:Ge[t].buttonOne.tooltip}),Ke(this.convertBtnTwo,{content:Ge[t].buttonTwo.tooltip}),this.convertBtnOne.onclick=()=>{Ge[t].buttonOne.action(this.options.timingData,this.options.type),this.close()},this.convertBtnTwo.onclick=()=>{Ge[t].buttonTwo.action(this.options.timingData,this.options.type),this.close()}}}const fa={BPMS:{title:"BPM Event",rows:[{label:"Tempo",key:"value",input:{type:"spinner"}}]},STOPS:{title:"Stop Event",description:"Stops for a number of seconds. Notes on this beat are hit before the stop occurs.",rows:[{label:"Seconds",key:"value",input:{type:"spinner"}}]},WARPS:{title:"Warp Event",description:"Warps ahead a number of beats. Warped notes do not count towards score.",rows:[{label:"Beats",key:"value",input:{type:"spinner",min:0}}]},DELAYS:{title:"Delay Event",description:"Stops for a number of seconds. Notes on this beat are hit after the delay occurs.",rows:[{label:"Seconds",key:"value",input:{type:"spinner"}}]},SCROLLS:{title:"Scroll Event",description:"Notes after this event will scroll at the specified speed.",rows:[{label:"Multiplier",key:"value",input:{type:"spinner"}}]},TICKCOUNTS:{title:"Tickcount Event",description:"Number of ticks per beat in a hold. Only applies to pump gamemodes.",rows:[{label:"Ticks",key:"value",input:{type:"spinner",step:1,precision:0,minPrecision:null,min:0}}]},FAKES:{title:"Fake Event",description:"Creates an area of notes that cannot be hit and do not count towards score.",rows:[{label:"Beats",key:"value",input:{type:"spinner",min:0}}]},LABELS:{title:"Label Event",rows:[{label:"Label",key:"value",input:{type:"text"}}]},SPEEDS:{title:"Speed Event",width:200,description:"The entire playfield scrolls at the specified speed. Can slowly ease over a certain amount of time.",rows:[{label:"Multiplier",key:"value",input:{type:"spinner"}},{label:"Ease time",key:"delay",input:{type:"spinner",min:0}},{label:"Ease unit",key:"unit",input:{type:"dropdown",items:["Beats","Seconds"],transformers:{serialize:i=>i=="B"?"Beats":"Seconds",deserialize:i=>i=="Beats"?"B":"T"}}}]},TIMESIGNATURES:{title:"Time Signature Event",width:200,rows:[{label:"Upper",key:"upper",input:{type:"spinner",step:1,precision:0,minPrecision:null,min:1}},{label:"Lower",key:"lower",input:{type:"spinner",step:1,precision:0,minPrecision:null,min:1}}]},COMBOS:{title:"Combo Event",width:200,description:"Multiplies the combo gained from hitting/missing notes after this event.",rows:[{label:"Hit multiplier",key:"hitMult",input:{type:"spinner",step:1,precision:0,minPrecision:null,min:0}},{label:"Miss multiplier",key:"missMult",input:{type:"spinner",step:1,precision:0,minPrecision:null,min:0}}]},ATTACKS:{title:"Attack Event",width:200,description:"Applies a modifier to the playfield. Can specify the length of the applied attack in seconds or the end time of the attack.",rows:[{label:"Timing type",key:"endType",input:{type:"dropdown",items:["Length","End"],transformers:{serialize:i=>i=="LEN"?"Length":"End",deserialize:i=>i=="Length"?"LEN":"END"}}},{label:"Seconds",key:"value",input:{type:"spinner"}},{label:"Mods",key:"mods",input:{type:"text"}}]},BGCHANGES:{title:"BG Change Event",width:250,rows:[{label:"File",key:"file",input:{type:"text"}},{label:"Update rate",key:"updateRate",input:{type:"spinner",precision:3,min:0}},{label:"Crossfade",key:"crossfade",input:{type:"checkbox"}},{label:"StretchRewind",key:"stretchRewind",input:{type:"checkbox"}},{label:"StretchNoLoop",key:"StretchNoLoop",input:{type:"checkbox"}},{label:"Effect",key:"effect",input:{type:"text"}},{label:"File2",key:"file2",input:{type:"text"}},{label:"Transition",key:"transition",input:{type:"text"}},{label:"Color1",key:"color1",input:{type:"text"}},{label:"Color2",key:"color2",input:{type:"text"}}]},FGCHANGES:{title:"FG Change Event",width:250,rows:[{label:"File",key:"file",input:{type:"text"}},{label:"Update rate",key:"updateRate",input:{type:"spinner",precision:3,min:0}},{label:"Crossfade",key:"crossfade",input:{type:"checkbox"}},{label:"StretchRewind",key:"stretchRewind",input:{type:"checkbox"}},{label:"StretchNoLoop",key:"StretchNoLoop",input:{type:"checkbox"}},{label:"Effect",key:"effect",input:{type:"text"}},{label:"File2",key:"file2",input:{type:"text"}},{label:"Transition",key:"transition",input:{type:"text"}},{label:"Color1",key:"color1",input:{type:"text"}},{label:"Color2",key:"color2",input:{type:"text"}}]}};class Ye extends ea{static options;static cachedEvent;static rows=[];static onTimingChange;static open(e){this.active||(super._open({...e,attach:e.box.backgroundObj,title:fa[e.box.event.type].title,description:fa[e.box.event.type].description,width:fa[e.box.event.type].width??150,editable:!0,cancelableOnOpen:!1,background:Sa(mi[e.box.event.type].toString(16).padStart(6,"0"),"#333333",.75),textColor:"#ffffff",options:[{label:"Ok",type:"confirm",callback:()=>{this.close(),this.options.onConfirm(this.cachedEvent)}},{label:"Delete",type:"delete",callback:()=>{this.options.modifyBox||this.options.timingData.delete([{type:this.cachedEvent.type,[this.cachedEvent.type=="ATTACKS"?"second":"beat"]:this.cachedEvent.type=="ATTACKS"?this.cachedEvent.second:this.cachedEvent.beat}]),this.close()}}]}),this.cachedEvent=structuredClone(e.box.event),this.onTimingChange=this.updateValues.bind(this),le.on("timingModified",this.onTimingChange))}static buildContent(){const e=fa[this.options.box.event.type],t=document.createElement("div");t.classList.add("popup-grid"),this.view.appendChild(t),e.rows.forEach(n=>t.append(...this.buildRow(n)))}static buildRow(e){const t=structuredClone(this.options.box.event),n=document.createElement("div");n.innerText=e.label,n.classList.add("popup-label");const a=[];switch(a.push(n),e.input.type){case"spinner":{const r=lt.create({value:t[e.key],precision:Cc,minPrecision:xi,...e.input});r.onchange=s=>{s!==void 0&&this.modifyEvent(e.key,s)},this.rows.push({data:e,el:r}),a.push(r.view);break}case"text":{const r=document.createElement("input");r.type="text",r.autocomplete="off",r.spellcheck=!1,r.onkeydown=s=>{s.key=="Enter"&&r.blur()},r.onblur=()=>{this.modifyEvent(e.key,r.value)},r.value=t[e.key],this.rows.push({data:e,el:r}),a.push(r);break}case"dropdown":{if(e.input.transformers){const r=e.input.transformers.deserialize,s=e.input.transformers.serialize,o=li.create(e.input.items,s(t[e.key]));o.onChange(l=>{this.modifyEvent(e.key,r(l))}),this.rows.push({data:e,el:o}),a.push(o.view)}else{const r=li.create(e.input.items,t[e.key]);r.onChange(s=>{this.modifyEvent(e.key,s)}),this.rows.push({data:e,el:r}),a.push(r.view)}break}case"checkbox":{const r=document.createElement("input");r.type="checkbox",r.checked=t[e.key],r.onchange=()=>{this.modifyEvent(e.key,r.checked)},this.rows.push({data:e,el:r}),a.push(r);break}}return a}static modifyEvent(e,t){this.options.modifyBox?Object.assign(this.options.box.event,{[e]:t}):this.options.timingData.modify([[structuredClone(this.options.box.event),Object.assign(this.options.box.event,{[e]:t})]]),this.cachedEvent=structuredClone(this.options.box.event)}static updateValues(){const e=this.options.timingData.getEventAtBeat(this.options.box.event.type,this.options.box.event.beat,!1);if(!this.options.box||!e||e.beat!=this.options.box.event.beat){this.close();return}this.rows.forEach(t=>{switch(t.data.input.type){case"spinner":{t.el.value=e[t.data.key];break}case"text":{t.el.value=e[t.data.key];break}case"dropdown":{const n=t.el;t.data.input.transformers?n.setSelected(t.data.input.transformers.serialize(e[t.data.key])):n.setSelected(e[t.data.key]);break}case"checkbox":{t.el.checked=e[t.data.key];break}}})}static close(){this.active&&(super.close(),le.off("timingModified",this.onTimingChange))}static getEvent(){return this.cachedEvent}static attach(e){super.attach(e.backgroundObj),this.options.box=e,this.cachedEvent=e.event}}const xa={fontName:"Main",fontSize:15},ei={BPMS:55,STOPS:55,DELAYS:55,WARPS:55,FAKES:55,COMBOS:40,SPEEDS:80,LABELS:80,SCROLLS:55,TIMESIGNATURES:40,TICKCOUNTS:40,BGCHANGES:55,FGCHANGES:55,ATTACKS:55};class wg extends ye{tracks=new ye;renderer;timingBoxMap=new Map;wasEditingTiming=!1;boxPool=new Yn({create:()=>{const e=new ye;return e.textObj=new Ee("",xa),e.backgroundObj=new mt,e.selection=new mt("onlyBorder"),e.selection.tint=3841008,e.addChild(e.backgroundObj,e.textObj,e.selection),e}});ghostBox;timingDirty=!1;tracksDirty=!0;constructor(e){super(),this.renderer=e,this.boxPool.sortableChildren=!0,this.sortableChildren=!0,this.addChild(this.tracks,this.boxPool);const t=()=>{this.timingDirty=!0,this.tracksDirty=!0},n=a=>{a.startsWith("chart.timingEventOrder")&&(this.tracksDirty=!0)};le.on("timingModified",t),le.on("userOptionUpdated",n),this.on("destroyed",()=>{le.off("timingModified",t),le.off("userOptionUpdated",n)})}update(e,t){this.renderer.chartManager.editTimingMode!=Ce.Add&&(this.ghostBox?.removeFromParent(),this.ghostBox?.destroy(),this.ghostBox=void 0),this.updateTracks(),this.updateBoxes(e,t)}createTrack(e,t){const n=Object.assign(new ye,{alpha:0,name:e,x:t,type:e,timingMode:"song",background:new De(Se.WHITE),btns:new ye});n.background=new De(Se.WHITE),n.background.width=ei[e],n.background.height=5e3,n.background.tint=2503250,n.background.anchor.y=.5,n.background.alpha=0,n.btns.y=this.renderer.getActualReceptorYPos()+(y.chart.reverse?50:-50);const a=new ye,r=new mt,s=new Ee(e,xa);return r.width=20,r.height=20,He(r,"widget-bg"),r.pivot.set(10,10),s.anchor.set(.5,.55),s.text="S",He(s,"text-color"),a.alpha=.4,a.name="timingTypeBtn",a.eventMode="static",a.on("mouseenter",()=>{di.persistent||di.open({attach:a,type:e,timingData:this.renderer.chart.timingData})}),a.on("mouseleave",()=>{di.persistent||di.close()}),a.on("pointerdown",()=>{di.persistent&&di.open({attach:a,type:e,timingData:this.renderer.chart.timingData}),di.select()}),a.addChild(r,s),n.btns.addChild(a),n.addChild(n.background,n.btns),this.tracks.addChild(n),n}initializeBox(e,t){if(ii.stop(e.animationId),Object.assign(e,{event:t,lastX:void 0,lastAnchor:void 0,animationId:void 0,zIndex:t.beat,eventMode:"static"}),e.textObj.text=this.getLabelFromEvent(t),e.textObj.anchor.set(.5,.55),e.backgroundObj.width=e.textObj.width+10,e.backgroundObj.height=25,e.backgroundObj.position.x=-e.backgroundObj.width/2,e.backgroundObj.position.y=-25/2,e.selection.width=e.textObj.width+10,e.selection.height=25,e.selection.position=e.backgroundObj.position,Ye.active){const n=Ye.getEvent();n.type=="ATTACKS"&&t.type=="ATTACKS"&&n.second==t.second&&Ye.attach(e),n.type!="ATTACKS"&&t.type!="ATTACKS"&&n.type==t.type&&n.beat==t.beat&&Ye.attach(e)}}addDragListeners(e,t){e.on("mouseenter",()=>{Ye.persistent||this.renderer.chartManager.eventSelection.timingEvents.length>0||this.renderer.isDragSelecting()||(Ye.active&&Ye.close(),this.renderer.chartManager.getMode()==$.Edit&&Ye.open({box:e,timingData:this.getTargetTimingData(e.event),modifyBox:!1,onConfirm:()=>{this.renderer.chartManager.removeEventFromSelection(t)}}))}),e.on("mouseleave",()=>{Ye.persistent||Ye.close()});let n=0,a;const r=s=>{const o=a,l=this.toLocal(s.global);if(Math.abs(l.y-n)<32){this.renderer.chartManager.eventSelection.shift&&(this.renderer.chartManager.eventSelection.shift={beatShift:0});return}Ye.close();const u=this.renderer.getBeatFromYPos(l.y),f=y.chart.snap==0?1/48:y.chart.snap;let c=Math.round(u/f)*f;Math.abs(c-u)>Math.abs(u-o.beat)&&(c=o.beat),this.renderer.chartManager.eventSelection.shift||={beatShift:0},this.renderer.chartManager.eventSelection.shift.beatShift=Math.max(-Math.min(...this.renderer.chartManager.eventSelection.timingEvents.map(d=>d.beat)),c-o.beat)};e.on("pointerdown",s=>{if(bs(s)){this.renderer.chartManager.clearSelections(),this.renderer.chartManager.addEventToSelection(t),Ye.close();return}if(s.stopImmediatePropagation(),this.renderer.chartManager.isEventInSelection(t)?(s.getModifierState("Control")||s.getModifierState("Meta"))&&this.renderer.chartManager.removeEventFromSelection(t):(!s.getModifierState("Control")&&!s.getModifierState("Meta")&&!s.getModifierState("Shift")&&this.renderer.chartManager.clearSelections(),this.renderer.chartManager.addEventToSelection(t)),this.renderer.chartManager.getMode()==$.Edit&&this.renderer.chartManager.eventSelection.timingEvents.length==1&&Ye.options?.box!=e&&(Ye.close(),Ye.open({box:e,timingData:this.getTargetTimingData(e.event),modifyBox:!1,onConfirm:()=>{this.renderer.chartManager.removeEventFromSelection(t)}})),Ye.active&&!s.getModifierState("Control")&&!s.getModifierState("Meta")&&!s.getModifierState("Shift")?Ye.select():Ye.close(),n=e.y,a=t,this.renderer.chartManager.editTimingMode==Ce.Add)return;this.renderer.on("pointermove",r);const o=()=>{this.renderer.off("pointermove",r),this.renderer.off("pointerup",o),(this.renderer.chartManager.eventSelection.shift?.beatShift??0)!=0&&this.renderer.chartManager.modifyEventSelection(l=>(l.type=="ATTACKS"&&(l.second=this.renderer.chart.timingData.getSecondsFromBeat(l.beat+this.renderer.chartManager.eventSelection.shift.beatShift)),l.beat+=this.renderer.chartManager.eventSelection.shift.beatShift,l)),this.renderer.chartManager.eventSelection.shift=void 0};this.renderer.on("pointerup",o)})}updateTracks(){const e=this.renderer.chartManager.editTimingMode!=Ce.Off&&this.renderer.chartManager.getMode()==$.Edit;if(e&&this.tracks.children.forEach(s=>{s.btns.y=this.renderer.getActualReceptorYPos()+(y.chart.reverse?50:-50)}),!this.tracksDirty&&this.wasEditingTiming==e)return;this.wasEditingTiming=e,this.tracksDirty=!1;const t=y.chart.timingEventOrder.left,n=y.chart.timingEventOrder.right;this.tracks.children.forEach(s=>{s.visible=!1});let a=-this.renderer.chart.gameType.notefieldWidth*.5-128;const r=(s,o,l,u,f)=>{ii.animate(s,{0:{[o]:"inherit"},1:{[o]:l}},u,fi(0,0,.16,1.01),()=>{},f)};for(let s=t.length-1;s>=0;s--){const o=t[s],l=this.tracks.getChildByName(o)??this.createTrack(o,a);l.visible=!0;const u=s%2==0?.1:0;r(l,"x",a,.3,`track-${o}-x`),r(l.btns,"x",-ei[o]/2,.3,`track-${o}-btn-x`),r(l.background,"anchor.x",1,.3,`track-${o}-anchor-x`),r(l.background,"alpha",e?u:0,.3,`track-${o}-bg-alpha`),a-=ei[o]}a=this.renderer.chart.gameType.notefieldWidth*.5+128;for(let s=0;s<n.length;s++){const o=n[s],l=this.tracks.getChildByName(o)??this.createTrack(o,a);l.visible=!0;const u=s%2==0?.1:0;r(l,"x",a,.3,`track-${o}-x`),r(l.btns,"x",ei[o]/2,.3,`track-${o}-btn-x`),r(l.background,"anchor.x",0,.3,`track-${o}-anchor-x`),r(l.background,"alpha",e?u:0,.3,`track-${o}-bg-alpha`),a+=ei[o]}for(const s of this.tracks.children)r(s,"alpha",e?1:0,.3,`track-${s.type}-alpha`);e||di.close(),this.tracks.children.forEach(s=>{const o=s.btns.getChildByName("timingTypeBtn"),l=o?.children[1];o&&(o.eventMode=e?"static":"none"),l&&(l.text=this.renderer.chart.timingData.isPropertyChartSpecific(s.type)?"C":"S")})}updateBoxes(e,t){this.timingDirty&&(this.timingBoxMap.clear(),this.boxPool.destroyAll(),this.timingDirty=!1);const n=this.renderer.chartManager.editTimingMode!=Ce.Off&&this.renderer.chartManager.getMode()==$.Edit;this.boxPool.visible=this.renderer.shouldDisplayBarlines(),this.ghostBox&&(this.ghostBox.visible=this.renderer.shouldDisplayBarlines()&&n);for(const r of this.renderer.chart.timingData.getTimingData()){if(t<r.beat)break;if(!(!y.chart.timingEventOrder.left.includes(r.type)&&!y.chart.timingEventOrder.right.includes(r.type))&&!(e>r.beat)&&!this.timingBoxMap.has(r)){const s=this.boxPool.createChild();if(!s)break;this.initializeBox(s,r),this.addDragListeners(s,r),this.timingBoxMap.set(r,s)}}const a={beat:-Number.MAX_SAFE_INTEGER,second:-Number.MAX_SAFE_INTEGER,leftOffset:0,rightOffset:0};for(const[r,s]of this.timingBoxMap.entries()){if(r.beat<e||r.beat>t||!y.chart.timingEventOrder.left.includes(r.type)&&!y.chart.timingEventOrder.right.includes(r.type)){this.timingBoxMap.delete(r),Ye.options?.box==s?Ye.detach():Ye.persistent||Ye.close(),this.boxPool.destroyChild(s);continue}let o=0,l=0;const u=s.backgroundObj.width,f=y.chart.timingEventOrder.right.includes(r.type)?"right":"left";n?(o=this.tracks.getChildByName(r.type)?.x??s.x,o+=ei[r.type]/2*(o>0?1:-1),l=.5):(o=(f=="right"?1:-1)*(this.renderer.chart.gameType.notefieldWidth*.5+80),f=="left"&&(o-=30),(a.beat!=r.beat||r.second&&a.second!=r.second)&&(a.leftOffset=0,a.rightOffset=0,a.beat=r.beat,a.second=r.second),f=="left"?(o-=a.leftOffset,a.leftOffset+=u+5):(o+=a.rightOffset,a.rightOffset+=u+5),l=f=="right"?0:1),s.lastX===void 0||s.lastAnchor===void 0?(s.x=o,s.pivot.x=(l-.5)*u):(s.lastX!=o||s.lastAnchor!=l)&&(s.animationId=ii.animate(s,{0:{x:"inherit","pivot.x":"inherit"},1:{x:o,"pivot.x":(l-.5)*u}},.3,fi(0,0,.16,1.01),()=>{},s.animationId)),s.lastX=o,s.lastAnchor=l,s.y=y.chart.CMod&&r.type=="ATTACKS"?this.renderer.getYPosFromSecond(r.second):this.renderer.getYPosFromBeat(r.beat);const c=this.renderer.shouldDisplayEventSelection(r);if(s.backgroundObj.tint=c?eo(mi[r.type]??0,Math.sin(Date.now()/320)*.4+1.5):mi[r.type]??0,s.selection.alpha=c?1:0,s.visible=!c||!this.renderer.chartManager.eventSelection.shift,this.renderer.chartManager.editTimingMode!=Ce.Off){const d=this.renderer.selectionTest(s);!c&&d&&this.renderer.chartManager.addEventToDragSelection(r),c&&!d&&this.renderer.chartManager.removeEventFromDragSelection(r)}}}updateGhostEvent(e){const t=y.chart.snap==0?.020833333333333332:y.chart.snap,n=Math.round(this.renderer.getBeatFromYPos(e.y)/t)*t,a=Ye.active&&Ye.options?.box==this.ghostBox,r=a?this.ghostBox.event.type:this.getClosestTrack(e.x)?.name;if(!r){this.ghostBox?.removeFromParent(),this.ghostBox?.destroy(),this.ghostBox=void 0;return}if(!this.ghostBox){const l=new ye;l.textObj=new Ee("",xa),l.backgroundObj=new mt,l.selection=new mt("onlyBorder"),l.guideLine=new De(Se.WHITE),l.selection.tint=3841008,l.selection.alpha=0,l.addChild(l.guideLine,l.backgroundObj,l.textObj,l.selection),this.addChild(l),l.visible=this.renderer.shouldDisplayBarlines(),l.textObj.anchor.set(.5,.55),l.backgroundObj.height=25,l.selection.height=25,l.guideLine.height=1,l.guideLine.anchor.y=.5,this.ghostBox=l}!a&&(this.ghostBox.event?.beat!=n||this.ghostBox.event?.type!=r)&&(this.ghostBox.event=structuredClone(this.renderer.chart.timingData.getEventAtBeat(r,n))??this.renderer.chart.timingData.getDefaultEvent(r,n),this.ghostBox.event.beat=n,r=="ATTACKS"&&(this.ghostBox.event.second=this.renderer.chart.getSecondsFromBeat(n)),this.ghostBox.textObj.text=this.getLabelFromEvent(this.ghostBox.event),this.ghostBox.backgroundObj.width=this.ghostBox.textObj.width+10,this.ghostBox.selection.width=this.ghostBox.textObj.width+10),this.ghostBox.alpha=a?1:.4,this.ghostBox.selection.alpha=a?1:0,this.ghostBox.name=r;const s=this.renderer.getYPosFromBeat(a?this.ghostBox.event.beat:n);let o=this.tracks.getChildByName(r).x;o+=ei[r]/2*(o>0?1:-1),this.ghostBox.position.x=o,this.ghostBox.backgroundObj.tint=mi[r]??0,this.ghostBox.backgroundObj.position.x=-this.ghostBox.backgroundObj.width/2,this.ghostBox.backgroundObj.position.y=-25/2,this.ghostBox.guideLine.anchor.x=o<0?0:1,this.ghostBox.guideLine.width=Math.abs(this.ghostBox.position.x)+192-this.ghostBox.backgroundObj.width/2,this.ghostBox.guideLine.position.x=(o<0?1:-1)*this.ghostBox.backgroundObj.width/2,this.ghostBox.y=s,this.ghostBox.selection.position=this.ghostBox.backgroundObj.position}placeGhostEvent(){if(!this.ghostBox)return;const e=this.renderer.chart.timingData.getEventAtBeat(this.ghostBox.event.type,this.ghostBox.event.beat,!1);this.ghostBox.event.type=="ATTACKS"&&this.ghostBox.event.second==e?.second||this.ghostBox.event.type!="ATTACKS"&&this.ghostBox.event.beat==e?.beat||(this.renderer.chartManager.clearSelections(),Ye.open({box:this.ghostBox,timingData:this.getTargetTimingData(this.ghostBox.event),modifyBox:!0,onConfirm:t=>{this.getTargetTimingData(this.ghostBox.event).insert([t])}}),Ye.select())}getClosestTrack(e){let t=Number.MAX_SAFE_INTEGER,n=this.tracks.children[0];for(const a of this.tracks.children){const r=Math.abs(a.x+(.5-a.background.anchor.x)*a.width-e);r<t&&(n=a,t=r)}if(!(t>n.width))return n}getLabelFromEvent(e){let t="";switch(e.type){case"BPMS":case"STOPS":case"WARPS":case"DELAYS":case"TICKCOUNTS":case"FAKES":case"SCROLLS":t=ue(e.value,xi).toString();break;case"SPEEDS":t=`${ue(e.value,xi)}/${ue(e.delay,xi)}/${e.unit}`;break;case"LABELS":t=e.value;break;case"TIMESIGNATURES":t=`${ue(e.upper,xi)}/${ue(e.lower,xi)}`;break;case"COMBOS":t=`${ue(e.hitMult,xi)}/${ue(e.missMult,3)}`;break;case"BGCHANGES":case"FGCHANGES":t=e.file;break;case"ATTACKS":t=`${e.mods}`}return t}getTargetTimingData(e){return this.renderer.chart.timingData.isPropertyChartSpecific(e.type)?this.renderer.chart.timingData:this.renderer.chart.timingData.songTimingData}}class vg extends ye{children=[];renderer;timingBoxMap=new Map;trackPosCache=new Map;timingBoxPool=new Yn({create:()=>{const e=new ye;return e.guideLine=new De(Se.WHITE),e.textObj=new Ee("",xa),e.backgroundObj=new mt,e.addChild(e.guideLine,e.backgroundObj,e.textObj),e}});constructor(e){super(),this.renderer=e,this.timingBoxPool.sortableChildren=!0,this.addChild(this.timingBoxPool)}update(e,t){if(!this.renderer.chartManager.eventSelection.shift){this.timingBoxPool.destroyAll(),this.timingBoxMap.clear(),this.trackPosCache.clear();return}const n=this.renderer.chartManager.eventSelection.shift.beatShift;for(const a of this.renderer.chartManager.eventSelection.timingEvents)if(!(t<a.beat+n)&&!(e>a.beat+n)&&!this.timingBoxMap.has(a)){const r=this.timingBoxPool.createChild();if(!r)continue;this.timingBoxMap.set(a,r);let s="";switch(a.type){case"BPMS":case"STOPS":case"WARPS":case"DELAYS":case"TICKCOUNTS":case"FAKES":case"SCROLLS":s=ue(a.value,3).toString();break;case"SPEEDS":s=`${ue(a.value,3)}/${ue(a.delay,3)}/${a.unit}`;break;case"LABELS":s=a.value;break;case"TIMESIGNATURES":s=`${ue(a.upper,3)}/${ue(a.lower,3)}`;break;case"COMBOS":s=`${ue(a.hitMult,3)}/${ue(a.missMult,3)}`;break;case"BGCHANGES":case"FGCHANGES":s=a.file;break;case"ATTACKS":s=`${a.mods} (${a.endType}=${a.value})`}const o=y.chart.timingEventOrder.right.includes(a.type)?"right":"left";if(Object.assign(r,{alpha:.4,zIndex:a.beat}),r.textObj.text=s,r.textObj.anchor.set(.5,.55),r.backgroundObj.width=r.textObj.width+10,r.backgroundObj.height=25,r.backgroundObj.tint=mi[a.type]??0,r.backgroundObj.position.x=-r.backgroundObj.width/2,r.backgroundObj.position.y=-r.backgroundObj.height/2,r.guideLine.height=1,r.guideLine.anchor.set(o=="left"?0:1,.5),r.guideLine.width=Math.abs(r.position.x)+192-r.backgroundObj.width/2,r.guideLine.position.x=(o=="left"?1:-1)*r.backgroundObj.width/2,this.renderer.chartManager.editTimingMode!=Ce.Off){let l=this.getTrackPos(a.type);l+=ei[a.type]/2*(l>0?1:-1),r.position.x=l,r.pivot.x=0}else{let l=(o=="right"?1:-1)*(this.renderer.chart.gameType.notefieldWidth*.5+80);o=="left"&&(l-=30),r.position.x=l,r.pivot.x=o=="right"?-r.backgroundObj.width/2:r.backgroundObj.width/2}}for(const[a,r]of this.timingBoxMap.entries()){if(t<a.beat+n||e>a.beat+n){this.timingBoxPool.destroyChild(r),this.timingBoxMap.delete(a);continue}r.y=y.chart.CMod&&a.second?this.renderer.getYPosFromSecond(a.second):this.renderer.getYPosFromBeat(a.beat+n)}}getTrackPos(e){if(this.trackPosCache.has(e))return this.trackPosCache.get(e);const t=y.chart.timingEventOrder.left,n=y.chart.timingEventOrder.right;let a=-this.renderer.chart.gameType.notefieldWidth*.5-128;for(let r=t.length-1;r>=0;r--){const s=t[r];this.trackPosCache.set(s,a),a-=ei[s]}a=this.renderer.chart.gameType.notefieldWidth*.5+128;for(let r=0;r<n.length;r++){const s=n[r];this.trackPosCache.set(s,a),a+=ei[s]}return this.trackPosCache.get(e)??0}}class xg extends ye{chartManager;chart;speedMult=1;lastMousePos;lastMouseBeat=-1;lastMouseCol=-1;lastNoteType=null;lastHoldBeat=null;editingCol=-1;cachedBeat=0;cachedTime=0;waveform;barlines;timingAreas;timingTracks;selectedEvents;timingBar;notefield;snapDisplay;judgement;combo;selectionBoundary;selectionArea;previewArea;scrollDebug;selectionBounds;constructor(e){super(),this.chartManager=e,this.chart=e.loadedChart,this.waveform=new Zm(this),this.barlines=new Gm(this),this.timingAreas=new xm(this),this.timingTracks=new wg(this),this.selectedEvents=new vg(this),this.timingBar=new bg(this),this.notefield=new bc(this),this.snapDisplay=new bm(this),this.previewArea=new $m(this),this.selectionArea=new Ym(this),this.judgement=new yg,this.combo=new pg(this),this.selectionBoundary=new Km(this),this.scrollDebug=new jm(this),this.addChild(this.waveform,this.barlines,this.timingAreas,this.previewArea,this.selectionArea,this.timingTracks,this.selectedEvents,this.timingBar,this.combo,this.notefield,this.snapDisplay,this.judgement,this.selectionBoundary,this.scrollDebug),this.chartManager.app.stage.addChild(this),this.eventMode="static",this.hitArea=new gs(-1e5,-1e5,2e5,2e5);const t=r=>{if(this.editingCol!=-1){const s=y.chart.snap==0?.020833333333333332:y.chart.snap,o=Math.round(this.getBeatFromYPos(this.lastMousePos.y)/s)*s;this.chartManager.editHoldBeat(this.editingCol,o,r.shiftKey)}};let n=0;const a=()=>{this.selectionBounds&&(this.selectionBounds.lastKnownBeat!=this.cachedBeat&&(this.selectionBounds.endBeat+=this.cachedBeat-this.selectionBounds.lastKnownBeat,this.selectionBounds.lastKnownBeat=this.cachedBeat,this.selectionBoundary.update()),n!=0&&(this.chartManager.beat=Math.max(0,this.chartManager.beat+n),this.selectionBounds.endBeat+=n,this.selectionBoundary.update()))};At.shared.add(a),window.addEventListener("keydown",t),this.on("destroyed",()=>{window.removeEventListener("keydown",t),this.removeAllListeners(),At.shared.remove(a)}),this.on("pointerdown",r=>{bs(r)||this.chartManager.getMode()==$.Play||this.chartManager.getMode()==$.View||(this.chartManager.editTimingMode==Ce.Add&&this.lastMousePos?this.timingTracks.placeGhostEvent():this.chartManager.editTimingMode==Ce.Off&&y.chart.mousePlacement&&this.lastMouseBeat!=-1&&this.lastMouseCol!=-1&&!r.getModifierState("Shift")?(this.chartManager.clearSelections(),this.editingCol=this.lastMouseCol,this.lastHoldBeat=null,this.chartManager.setNote(this.lastMouseCol,"mouse",this.lastMouseBeat)):(!r.getModifierState("Control")&&!r.getModifierState("Meta")&&!r.getModifierState("Shift")&&this.chartManager.clearSelections(),this.chartManager[this.chartManager.editTimingMode==Ce.Off?"startDragSelection":"startDragEventSelection"](),this.selectionBounds={startX:this.toLocal(r.global).x,startBeat:this.getBeatFromYPos(this.toLocal(r.global).y),endX:this.toLocal(r.global).x,endBeat:this.getBeatFromYPos(this.toLocal(r.global).y),lastKnownBeat:this.cachedBeat},this.selectionBoundary.update()))}),this.on("mousemove",r=>{if(this.lastMousePos=this.toLocal(r.global),this.editingCol!=-1){const s=y.chart.snap==0?.020833333333333332:y.chart.snap,o=Math.round(this.getBeatFromYPos(this.lastMousePos.y)/s)*s;this.lastHoldBeat!=o&&(this.lastHoldBeat=o,this.chartManager.editHoldBeat(this.editingCol,o,r.shiftKey))}this.selectionBounds&&(this.selectionBounds.endBeat=this.getBeatFromYPos(this.toLocal(r.global).y),this.selectionBounds.endX=this.toLocal(r.global).x,this.selectionBounds.lastKnownBeat=this.cachedBeat,this.selectionBoundary.update()),n=Math.max(0,this.lastMousePos.y-this.getLowerBound()+100)/600,this.lastMousePos.y<0&&(n=Math.min(0,this.lastMousePos.y-this.getUpperBound()-100)/600),y.chart.reverse&&(n=Math.max(0,this.getUpperBound()-this.lastMousePos.y+100)/600,this.lastMousePos.y>0&&(n=Math.min(0,this.getLowerBound()-this.lastMousePos.y-100)/600))}),this.on("pointerup",()=>{this.editingCol!=-1&&(this.chartManager.endEditing(this.editingCol),this.editingCol=-1),this.chartManager[this.chartManager.editTimingMode==Ce.Off?"endDragSelection":"endDragEventSelection"](),this.selectionBounds=void 0,this.selectionBoundary.update(),n=0})}isDragSelecting(){return!!this.selectionBounds}doJudgement(e,t,n){this.chartManager.getMode()==$.Play&&(this.judgement.doJudge(t,n),this.timingBar.addBar(t,n)),this.notefield.onJudgement(e.col,n)}startPlay(){this.notefield.startPlay()}endPlay(){this.notefield.endPlay(),this.timingBar.reset(),this.judgement.reset()}update(){if(this.destroyed)return;this.cachedBeat=this.chartManager.beat,this.cachedTime=this.chartManager.time,this.x=y.chart.receptorXPos,this.speedMult=y.chart.doSpeedChanges?this.getCurrentSpeedMult():1;const e=this.getTopOnScreenBeat(),t=this.getBottomOnScreenBeat(),n=Math.min(e,t),a=Math.max(e,t);if(this.scale.x=y.chart.zoom,this.scale.y=y.chart.zoom,this.children.forEach(r=>r.update(n,a)),this.notefield.alpha=this.chartManager.editTimingMode==Ce.Off||this.chartManager.getMode()==$.Play?1:.3,y.chart.mousePlacement&&this.lastMousePos&&this.chartManager.getMode()!=$.Play){const r=y.chart.snap==0?.020833333333333332:y.chart.snap,s=Math.round(this.getBeatFromYPos(this.lastMousePos.y)/r)*r;let o=-1;for(let l=0;l<this.chart.gameType.numCols;l++){const u=this.chart.gameType.columnWidths[l],f=this.notefield.getColumnX(l);if(this.lastMousePos.x<f+u/2&&this.lastMousePos.x>f-u/2){o=l;break}}(s!=this.lastMouseBeat||o!=this.lastMouseCol||this.chartManager.getEditingNoteType()!=this.lastNoteType)&&(this.lastMouseBeat=s,this.lastMouseCol=o,this.lastNoteType=this.chartManager.getEditingNoteType(),this.editingCol!=-1&&this.chartManager.editHoldBeat(this.editingCol,s,!1),o===-1?(this.lastMouseBeat=-1,this.lastMouseCol=-1,this.notefield.setGhostNote()):this.notefield.setGhostNote(this.chart.computeNote({beat:s,col:this.lastMouseCol,type:this.chartManager.getEditingNoteType()})))}this.lastMousePos&&this.chartManager.editTimingMode==Ce.Add&&this.timingTracks.updateGhostEvent(this.lastMousePos)}getTimeWithOffset(){let e=this.cachedTime;return(this.chartManager.getMode()==$.Play||this.chartManager.getMode()==$.Record)&&(e+=y.play.offset*y.audio.rate),e}getBeatWithOffset(){let e=this.cachedBeat;return(this.chartManager.getMode()==$.Play||this.chartManager.getMode()==$.Record)&&(e=this.chart.getBeatFromSeconds(this.getTimeWithOffset())),e}getVisualTime(){let e=this.cachedTime;return(this.chartManager.getMode()==$.Play||this.chartManager.getMode()==$.Record)&&(e+=(y.play.offset+y.play.visualOffset)*y.audio.rate),e}getVisualBeat(){let e=this.cachedBeat;return(this.chartManager.getMode()==$.Play||this.chartManager.getMode()==$.Record)&&(e=this.chart.getBeatFromSeconds(this.getVisualTime())),e}getYPosFromBeat(e){const t=this.getVisualTime(),n=this.getVisualBeat(),a=y.chart.reverse?-1:1;return y.chart.CMod?(this.chart.getSecondsFromBeat(e)-t)*this.getSecondsToPixelsRatio()*a+this.getActualReceptorYPos():n==e?this.getActualReceptorYPos():(y.chart.doSpeedChanges?this.chart.timingData.getEffectiveBeat(e)-this.chart.timingData.getEffectiveBeat(n):e-n)*this.getEffectiveBeatsToPixelsRatio()*a+this.getActualReceptorYPos()}getYPosFromSecond(e){const t=this.getVisualTime(),n=y.chart.reverse?-1:1;return y.chart.CMod?(e-t)*this.getSecondsToPixelsRatio()*n+this.getActualReceptorYPos():this.getYPosFromBeat(this.chart.timingData.getBeatFromSeconds(e))}getSecondFromYPos(e){const t=y.chart.reverse?-1:1;if(y.chart.CMod){const n=this.getPixelsToSecondsRatio(),a=this.getVisualTime(),s=(e-this.getActualReceptorYPos())*n*t;return a+s}return this.chart.getSecondsFromBeat(this.getBeatFromYPos(e))}getBeatFromYPos(e,t){const n=this.getVisualBeat(),a=y.chart.reverse?-1:1;if(y.chart.CMod)return this.chart.getBeatFromSeconds(this.getSecondFromYPos(e));const s=(e-this.getActualReceptorYPos())*this.getPixelsToEffectiveBeatsRatio()*a;if(y.chart.doSpeedChanges&&!t){const o=this.chart.timingData.getEffectiveBeat(n)+s;return this.chart.getBeatFromEffectiveBeat(o)}return n+s}getColumnFromXPos(e){const t=this.chart.gameType;let n=null;for(let a=0;a<t.numCols;a++){const r=Math.abs(this.notefield.getColumnX(a)-e);if(n!==null&&r>n)return a-1;n=r}return t.numCols-1}getActualReceptorYPos(){return y.chart.receptorYPos/y.chart.zoom*(y.chart.reverse?-1:1)}getEffectiveBeatsToPixelsRatio(){return y.chart.speed/100*64*this.speedMult}getPixelsToEffectiveBeatsRatio(){return 1/this.getEffectiveBeatsToPixelsRatio()}getSecondsToPixelsRatio(){return y.chart.speed/100*64*4}getPixelsToSecondsRatio(){return 1/this.getSecondsToPixelsRatio()}isNegScroll(e){return y.chart.doSpeedChanges&&(this.speedMult<0||(this.chart.timingData.getEventAtBeat("SCROLLS",e)?.value??1)<0||(this.chart.timingData.getEventAtBeat("BPMS",e)?.value??120)<0)}getUpperBound(){return-this.chartManager.app.STAGE_HEIGHT/2/y.chart.zoom-64}getLowerBound(){return this.chartManager.app.STAGE_HEIGHT/2/y.chart.zoom+64}findFirstOnScreenScroll(){const e=[...this.chart.timingData.getTimingData("SCROLLS")];e[0]?.beat!=0&&e.splice(0,0,{beat:0,value:e[0]?.value??1,type:"SCROLLS"});let t=qt(e,this.getVisualBeat()-y.chart.maxDrawBeatsBack,n=>n.beat);for(;t<e.length&&(e[t].beat??0)<this.getVisualBeat()+y.chart.maxDrawBeats;){const n=e[t];t++;const a=n===void 0?-1/0*this.getScrollDirection(e[0]?.value??1):this.getYPosFromBeat(n.beat??0),r=e[t]===void 0?1/0*this.getScrollDirection(n.value):this.getYPosFromBeat(e[t].beat);if(this.isAreaOnScreen(a,r))return n}return e.at(-1)??{beat:0,value:1,type:"SCROLLS"}}findLastOnScreenScroll(){const e=[...this.chart.timingData.getTimingData("SCROLLS")];e[0]?.beat!=0&&e.splice(0,0,{beat:0,value:e[0]?.value??1,type:"SCROLLS"});let t=qt(e,this.getVisualBeat()+y.chart.maxDrawBeats,a=>a.beat);const n=qt(e,this.getVisualBeat()-y.chart.maxDrawBeatsBack,a=>a.beat);for(;t>=n;){const a=e[t];t--;const r=a===void 0?-1/0*this.getScrollDirection(e[0]?.value??1):this.getYPosFromBeat(a.beat??0),s=e[t+2]===void 0?1/0*this.getScrollDirection(a.value):this.getYPosFromBeat(e[t+2].beat);if(this.isAreaOnScreen(r,s))return a}return{beat:0,value:1,type:"SCROLLS"}}getTopOnScreenBeat(){if(y.chart.waveform.speedChanges&&!y.chart.CMod&&y.chart.doSpeedChanges){const e=this.findFirstOnScreenScroll(),t=1/Math.abs(this.getEffectiveBeatsToPixelsRatio()),n=this.getYPosFromBeat(e.beat),a=t/Math.abs(e.value),r=this.getScrollDirection(e.value),s=r==1?this.getUpperBound():this.getLowerBound(),o=r*(s-n)*a+e.beat;return Math.max(this.getVisualBeat()-y.chart.maxDrawBeatsBack,o)}return y.chart.CMod?this.getBeatFromYPos(this.getUpperBound()):Math.max(this.getVisualBeat()-y.chart.maxDrawBeatsBack,this.getBeatFromYPos(this.getUpperBound()))}getBottomOnScreenBeat(){if(y.chart.waveform.speedChanges&&!y.chart.CMod&&y.chart.doSpeedChanges){const e=this.findLastOnScreenScroll(),t=1/Math.abs(this.getEffectiveBeatsToPixelsRatio()),n=this.getYPosFromBeat(e.beat),a=t/Math.abs(e.value),r=this.getScrollDirection(e.value),s=r==1?this.getLowerBound():this.getUpperBound(),o=r*(s-n)*a+e.beat;return Math.min(this.getVisualBeat()+y.chart.maxDrawBeats,o)}return y.chart.CMod?this.getBeatFromYPos(this.getLowerBound()):Math.min(this.getVisualBeat()+y.chart.maxDrawBeats,this.getBeatFromYPos(this.getLowerBound()))}isAreaOnScreen(e,t){t<e&&([e,t]=[t,e]);const n=this.getUpperBound(),a=this.getLowerBound();return e<a&&t>n}getCurrentSpeedMult(){return this.chart.timingData.getSpeedMult(this.getVisualBeat(),this.getVisualTime())}getScrollDirection(e){let t=1;return this.getCurrentSpeedMult()<0&&(t*=-1),y.chart.reverse&&(t*=-1),e<0&&(t*=-1),t}getUpperBoundBeat(){if(y.chart.waveform.speedChanges&&!y.chart.CMod&&y.chart.doSpeedChanges){const e=y.chart.speed,t=this.chart.timingData.getSpeedMult(this.getVisualBeat(),this.getVisualTime()),n=t>=0!=y.chart.reverse?1:-1,a=this.chart.timingData.getTimingData("SCROLLS"),r=100/e/Math.abs(t)/64/y.chart.zoom,s=this.getUpperBound(),o=this.getLowerBound();let l=qt(a,this.getVisualBeat()-y.chart.maxDrawBeatsBack,m=>m.beat);for(this.getVisualBeat()-y.chart.maxDrawBeatsBack<a[0]?.beat&&(l=-1);l<a.length&&(a[l]?.beat??0)<this.getVisualBeat()+y.chart.maxDrawBeats;){const m=a[l],g=this.getYPosFromBeat(m?.beat??0),b=a[l+1]?.beat??this.getVisualBeat()+y.chart.maxDrawBeats,x=this.getYPosFromBeat(b);if((m?.value??1)*n>0&&x>s&&(g<s||!a[l-1]||a[l-1].beat<this.getVisualBeat()-y.chart.maxDrawBeatsBack||a[l-1].value==0)||(m?.value??1)*n<0&&x<s&&(g>s||!a[l-1]||a[l-1].beat<this.getVisualBeat()-y.chart.maxDrawBeatsBack||a[l-1].value==0))break;l++}const u=a[l]?.beat??0,f=this.getYPosFromBeat(u),c=a[l]?.value??1,d=r/Math.abs(c)*y.chart.zoom,h=y.chart.reverse?s:o,p=y.chart.reverse?o:s;return c*n>0?a[l-1]?.value==0&&this.getYPosFromBeat(a[l-1].beat)>p?this.getVisualBeat()-y.chart.maxDrawBeatsBack:Math.max(this.getVisualBeat()-y.chart.maxDrawBeatsBack,u+d*(p-f)):a[l-1]?.value==0&&this.getYPosFromBeat(a[l-1].beat)<h?this.getVisualBeat()-y.chart.maxDrawBeatsBack:Math.max(this.getVisualBeat()-y.chart.maxDrawBeatsBack,u+d*(f-h))}return y.chart.CMod?this.getBeatFromYPos(this.getUpperBound()):Math.max(this.getVisualBeat()-y.chart.maxDrawBeatsBack,this.getBeatFromYPos(this.getUpperBound()))}getLowerBoundBeat(){if(y.chart.waveform.speedChanges&&!y.chart.CMod&&y.chart.doSpeedChanges){const e=y.chart.speed,t=this.chart.timingData.getSpeedMult(this.getVisualBeat(),this.getVisualTime()),n=t>=0!=y.chart.reverse?1:-1,a=this.chart.timingData.getTimingData("SCROLLS"),r=100/e/Math.abs(t)/64/y.chart.zoom,s=this.getUpperBound(),o=this.getLowerBound();let l=qt(a,this.getVisualBeat()+y.chart.maxDrawBeats,m=>m.beat);for(;l<a.length&&l>=0&&(a[l].beat??0)>this.getVisualBeat()-y.chart.maxDrawBeatsBack;){const m=a[l],g=this.getYPosFromBeat(m?.beat??0),b=a[l+1]?.beat??this.getVisualBeat()+y.chart.maxDrawBeats,x=this.getYPosFromBeat(b);if((m?.value??1)*n>0&&g<o&&(x>o||!a[l+1]||a[l+1].beat>this.getVisualBeat()+y.chart.maxDrawBeatsBack||a[l+1].value==0)||(m?.value??1)*n<0&&g>o&&(x<o||!a[l+1]||a[l+1].beat>this.getVisualBeat()+y.chart.maxDrawBeatsBack||a[l+1].value==0))break;l--}const u=a[l]?.beat??0,f=this.getYPosFromBeat(u),c=a[l]?.value??1,d=r/Math.abs(c)*y.chart.zoom,h=y.chart.reverse?o:s,p=y.chart.reverse?s:o;return c*n>0?a[l+1]?.value==0&&this.getYPosFromBeat(a[l+1].beat)<p?this.getVisualBeat()+y.chart.maxDrawBeats:Math.min(this.getVisualBeat()+y.chart.maxDrawBeats,u+d*(p-f)):a[l+1]?.value==0&&this.getYPosFromBeat(a[l+1].beat)>h?this.getVisualBeat()+y.chart.maxDrawBeats:Math.min(this.getVisualBeat()+y.chart.maxDrawBeats,u+d*(f-h))}return y.chart.CMod?this.getBeatFromYPos(this.getLowerBound()):Math.min(this.getVisualBeat()+y.chart.maxDrawBeats,this.getBeatFromYPos(this.getLowerBound()))}selectionTest(e){if(!this.selectionBounds)return!1;const t=this.selectionBoundary.getBounds(),n=e.getBounds(),a=16*y.chart.zoom;return t.x+t.width>n.x+a&&t.x<n.x+n.width-a&&t.y+t.height>n.y+a&&t.y<n.y+n.height-a}registerDragNote(e,t){e.eventMode="static",e.removeAllListeners();let n=0,a=0,r=0,s=0,o;const l=u=>{const f=o,c=this.toLocal(u.global);if(Math.abs(c.y-s-r)**2+Math.abs(c.x-a)**2<32*32){this.chartManager.selection.shift&&(this.chartManager.selection.shift={columnShift:0,beatShift:0});return}const d=this.getBeatFromYPos(c.y-s),h=y.chart.snap==0?1/48:y.chart.snap;let p=Math.round(d/h)*h;Math.abs(p-d)>Math.abs(d-f.beat)&&(p=f.beat);const m=this.getColumnFromXPos(c.x);this.chartManager.selection.shift||={columnShift:0,beatShift:0},n!=m-f.col&&(n=m-f.col,this.chartManager.selection.notes.every(g=>{const b=g.col+n;return b>=0&&b<this.chartManager.loadedChart.gameType.numCols})&&(this.chartManager.selection.shift.columnShift=m-f.col)),this.chartManager.selection.shift.beatShift=Math.max(-Math.min(...this.chartManager.selection.notes.map(g=>g.beat)),p-f.beat)};e.on("pointerdown",u=>{if(this.chartManager.getMode()==$.View)return;if(bs(u)){this.chartManager.isNoteInSelection(t)||(this.chartManager.clearSelections(),this.chartManager.addNoteToSelection(t)),Rs.open(this.chartManager.app,u),u.preventDefault();return}if(y.chart.mousePlacement&&!u.getModifierState("Meta")&&!u.getModifierState("Control")&&!u.getModifierState("Shift")&&!this.chartManager.isNoteInSelection(t))return;u.stopImmediatePropagation(),this.chartManager.isNoteInSelection(t)?(u.getModifierState("Control")||u.getModifierState("Meta"))&&this.chartManager.removeNoteFromSelection(t):(!u.getModifierState("Control")&&!u.getModifierState("Meta")&&!u.getModifierState("Shift")&&this.chartManager.clearSelections(),this.chartManager.addNoteToSelection(t)),a=e.x,r=e.y,s=this.toLocal(u.global).y-e.y,o=t,this.on("pointermove",l);const f=()=>{this.off("pointermove",l),this.off("pointerup",f),((this.chartManager.selection.shift?.beatShift??0)!=0||(this.chartManager.selection.shift?.columnShift??0)!=0)&&this.chartManager.modifySelection(c=>(c.beat+=this.chartManager.selection.shift.beatShift,c.col+=this.chartManager.selection.shift.columnShift,c)),this.chartManager.selection.shift=void 0};this.on("pointerup",f)}),e.on("destroyed",()=>{e?.removeAllListeners()})}getNotefield(){return this.notefield}swapNoteskin(e){y.chart.noteskin.name=e,y.chart.lastNoteskins[this.chart.gameType.id]=e,this.reloadNotefield()}reloadNotefield(){const e=new bc(this);this.addChildAt(e,this.children.indexOf(this.notefield)),this.notefield.destroy(),this.notefield=e}getSelectionBounds(){return this.selectionBounds}shouldDisplayBarlines(){return(this.chartManager.getMode()!=$.Play||!y.play.hideBarlines)&&he.barlines}shouldDisplayNoteSelection(e){return this.chartManager.getMode()!=$.Play&&!this.chartManager.app.capturing&&this.chartManager.isNoteInSelection(e)}shouldDisplayEventSelection(e){return this.chartManager.getMode()!=$.Play&&!this.chartManager.app.capturing&&this.chartManager.isEventInSelection(e)}}class yo extends AudioBufferSourceNode{started=!1;start(e,t,n){this.started||super.start(e,t,n),this.started=!0}stop(e){this.started&&super.stop(e),this.started=!1}static create(e){const t=e;return t.started=!1,Object.setPrototypeOf(t,yo.prototype),t}}class _g extends BiquadFilterNode{enabled=!1;static create(e){const t=e;return t.enabled=!1,t}}class pa{_audioAnalyzer;_filteredAudioAnalyzer;_freqData;_filteredFreqData;_gainNode;type;_audioContext=new AudioContext;_source;_playbackTime=0;_startTimestamp=0;_rate=1;_isPlaying=!1;_buffer;_filteredBuffer;_loadedBuffer;_delay;_loadListeners=[];_updateListeners=[];_volume=1;_destroyed=!1;_renderTimeout;_filters=[this.createFilter({type:"highpass",frequency:20,Q:.71}),this.createFilter({type:"lowshelf",frequency:75,gain:0}),this.createFilter({type:"peaking",frequency:100,gain:0,Q:.6}),this.createFilter({type:"peaking",frequency:250,gain:0,Q:.3}),this.createFilter({type:"peaking",frequency:1040,gain:0,Q:.41}),this.createFilter({type:"peaking",frequency:2500,gain:0,Q:.2}),this.createFilter({type:"highshelf",frequency:7500,gain:0}),this.createFilter({type:"lowpass",frequency:2e4,Q:.71})];_filtersEnabled=!1;onStop;loaded;constructor(e,t){this.type=t??"",this._filters[0].gain.value=-25,this._audioAnalyzer=this._audioContext.createAnalyser(),this._audioAnalyzer.fftSize=4096,this._audioAnalyzer.maxDecibels=0,this._freqData=new Uint8Array(this._audioAnalyzer.frequencyBinCount),this._filteredAudioAnalyzer=this._audioContext.createAnalyser(),this._filteredAudioAnalyzer.fftSize=4096,this._filteredAudioAnalyzer.maxDecibels=0,this._filteredFreqData=new Uint8Array(this._filteredAudioAnalyzer.frequencyBinCount),this._gainNode=this._audioContext.createGain(),this._buffer=this._audioContext.createBuffer(2,1,44100),this._filteredBuffer=this._audioContext.createBuffer(2,1,44100),this._loadedBuffer=this._audioContext.createBuffer(2,1,44100),this.initSource(),this.loaded=new Promise(n=>{this.decodeData(e).then(a=>{if(a)return this._loadedBuffer=a,a}).then(async a=>(await this.renderBuffer(a),await this.renderFilteredBuffer(a),a)).catch(a=>{a.name=="EncodingError"?de.createFormatted("Failed to load audio: file format not supported","error"):de.createFormatted("Failed to load audio: "+a.message,"error")}).finally(()=>{this.initSource(),this.callLoadListeners(),this.callUpdateListeners(),n()})})}async renderBuffer(e){if(!e)return;const t=new OfflineAudioContext(e.numberOfChannels,e.length,e.sampleRate),n=t.createBufferSource();return n.buffer=e,n.connect(t.destination),n.start(),await t.startRendering().then(a=>{this._buffer=a}).catch(()=>{de.createFormatted("Failed to load audio: audio rendering failed","error")})}async renderFilteredBuffer(e){if(!e)return;const t=new OfflineAudioContext(e.numberOfChannels,e.length,e.sampleRate),n=t.createBufferSource();n.buffer=e;let a=n;for(const r of this._filters){if(!r.enabled)continue;const s=t.createBiquadFilter();s.type=r.type,s.Q.setValueAtTime(r.Q.value,0),s.frequency.setValueAtTime(r.frequency.value,0),s.gain.setValueAtTime(r.gain.value,0),a.connect(s),a=s}return a.connect(t.destination),n.start(),await t.startRendering().then(r=>{this._filteredBuffer=r}).catch(()=>{de.createFormatted("Failed to load audio: audio rendering failed","error")})}createFilter(e){const t=_g.create(this._audioContext.createBiquadFilter());return t.type=e.type,e.Q!==void 0&&(t.Q.value=e.Q),e.gain!==void 0&&(t.gain.value=e.gain),e.frequency!==void 0&&(t.frequency.value=e.frequency),t}getFilters(){return this._filters}getFilter(e){return this._filters[e]}updateFilter(e,t){this._filters[e]&&(t.Q!==void 0&&(this._filters[e].Q.value=t.Q),t.frequency!==void 0&&(this._filters[e].frequency.value=t.frequency),t.gain!==void 0&&(this._filters[e].gain.value=t.gain),clearTimeout(this._renderTimeout),this._renderTimeout=setTimeout(()=>this.renderFilteredBuffer(this._loadedBuffer).then(()=>this.callUpdateListeners()),500))}enableFilter(e){this._filters[e].enabled=!0,this.initSource(),clearTimeout(this._renderTimeout),this._renderTimeout=setTimeout(()=>this.renderFilteredBuffer(this._loadedBuffer).then(()=>this.callUpdateListeners()),500),this._filtersEnabled=!0}disableFilter(e){this._filters[e].enabled=!1,this.initSource(),clearTimeout(this._renderTimeout),this._renderTimeout=setTimeout(()=>this.renderFilteredBuffer(this._loadedBuffer).then(()=>this.callUpdateListeners()),500),this._filtersEnabled=this._filters.some(t=>t.enabled)}hasFilters(){return this._filtersEnabled}onLoad(e){this._loadListeners.push(e)}offLoad(e){this._loadListeners=this._loadListeners.filter(t=>t!=e)}onUpdate(e){this._updateListeners.push(e)}offUpdate(e){this._updateListeners=this._updateListeners.filter(t=>t!=e)}getSongLength(){return this._buffer.length/this._buffer.sampleRate}getFrequencyData(){return this._destroyed?new Uint8Array:(this._audioAnalyzer.getByteFrequencyData(this._freqData),this._freqData)}getFilteredFrequencyData(){return this._destroyed?new Uint8Array:(this._filteredAudioAnalyzer.getByteFrequencyData(this._filteredFreqData),this._filteredFreqData)}getSampleRate(){return this._buffer.sampleRate}getFFTSize(){return this._audioAnalyzer.fftSize}getRawData(){if(this._destroyed)return[];const e=[];for(let t=0;t<this._buffer.numberOfChannels;t++){const n=new Float32Array(this._buffer.length);this._buffer.copyFromChannel(n,t),e.push(n)}return e}getFilteredRawData(){if(this._destroyed)return[];const e=[];for(let t=0;t<this._filteredBuffer.numberOfChannels;t++){const n=new Float32Array(this._filteredBuffer.length);this._filteredBuffer.copyFromChannel(n,t),e.push(n)}return e}getBuffer(){return this._loadedBuffer}isPlaying(){return this._destroyed?!1:this._isPlaying}reload(){this.initSource()}destroy(){this._destroyed||(this.stop(),this._buffer=this._audioContext.createBuffer(2,1,44100),this._updateListeners=[],clearTimeout(this._delay),this._destroyed=!0)}getFrequencyResponse(e){const t=new Float32Array(e);return this._filters.some(n=>n.enabled)?this._filters.filter(n=>n.enabled).map(n=>{const a=new Float32Array(e.length);return n.getFrequencyResponse(t,a,new Float32Array(e.length)),[...a]}).reduce((n,a)=>n.map((r,s)=>r*a[s])):new Array(e.length).fill(1)}callLoadListeners(){this._loadListeners.forEach(e=>e())}callUpdateListeners(){this._updateListeners.forEach(e=>e())}async decodeData(e){return new Promise((t,n)=>{if(!e){t();return}(async()=>{try{t(await this._audioContext.decodeAudioData(e))}catch(a){if(this.type==".ogg"){const r=(await We(async()=>{const{default:s}=await import("./OggDec-BmLxerny.js");return{default:s}},[])).default;try{t(await r.decodeOggData(e))}catch(s){n(s)}return}n(a)}})()})}initSource(){for(const t of this._filters)t.disconnect();this._audioAnalyzer.disconnect(),this._filteredAudioAnalyzer.disconnect(),this._gainNode.disconnect(),this._audioContext.destination.disconnect(),this._source?.stop(),this._source=yo.create(this._audioContext.createBufferSource()),this._source.buffer=this._buffer,this._source.connect(this._audioAnalyzer);let e=this._audioAnalyzer;for(const t of this._filters)t.enabled&&(e.connect(t),e=t);e.connect(this._filteredAudioAnalyzer),y.audio.allowFilter?this._filteredAudioAnalyzer.connect(this._gainNode):this._audioAnalyzer.connect(this._gainNode),this._gainNode.connect(this._audioContext.destination),this._source.playbackRate.value=this._rate,this._isPlaying&&(this.pause(),this.play())}volume(e){this._destroyed||this._volume!=e&&(this._volume=e,this._gainNode.gain.setValueAtTime(e,this._audioContext.currentTime))}rate(e){this._destroyed||this._rate!=e&&(this._rate=e,this._source&&(this._isPlaying&&(this._playbackTime+=(this._audioContext.currentTime-this._startTimestamp)*this._source.playbackRate.value),this._startTimestamp=this._audioContext.currentTime,this._source.playbackRate.value=e))}play(){this._destroyed||this._source&&(this._isPlaying||(this.initSource(),this._playbackTime<=this._buffer.duration&&this._source.start(Math.max(0,this._audioContext.currentTime-this._playbackTime/y.audio.rate),Math.max(0,this._playbackTime)),this._startTimestamp=this._audioContext.currentTime,this._isPlaying=!0))}seek(e){if(e===void 0)return this._destroyed?this._playbackTime:this._source?this._isPlaying?(this._audioContext.currentTime-this._startTimestamp)*this._source.playbackRate.value+this._playbackTime:this._playbackTime:this._playbackTime;this._isPlaying?(this.stop(),this._playbackTime=e,this.play()):this._playbackTime=e}pause(){this._destroyed||this.stop(!0)}stop(e){this._destroyed||this._source&&this._isPlaying&&(this.onStop?.(),clearTimeout(this._delay),this._isPlaying=!1,this._playbackTime<=this._buffer.duration&&this._source.stop(),this._playbackTime=e?(this._audioContext.currentTime-this._startTimestamp)*this._source.playbackRate.value+this._playbackTime:0)}}class Cg{judgementCounts=new Map;holdJudgementCounts=new Map;dancePoints=0;maxCumulativeDancePoints=0;maxDancePoints=0;chartManager;notedata;dataPoints=[];handlers=[];combo=0;missCombo=0;maxCombo=0;bestJudge;constructor(e){this.notedata=e.loadedChart.getNotedata(),this.chartManager=e,this.bestJudge=wt.getCollection(y.play.timingCollection).getStandardWindows()[0],this.calculateMaxDP()}onJudge(e){this.handlers.push(e)}applyOffset(e){this.dataPoints=this.dataPoints.map(t=>oi(t.judgement)||!pi(t.judgement)?t:{...t,error:t.error!==null?t.error+e:null})}addDataPoint(e,t,n){this.judgementCounts.has(t)||this.judgementCounts.set(t,0),this.judgementCounts.set(t,this.judgementCounts.get(t)+1),this.dancePoints+=t.dancePoints;const a=this.chartManager.loadedChart.timingData.getEventAtBeat("COMBOS",e[0].beat),r=a?.hitMult??1,s=a?.missMult??1;Os(t)||(this.maxCumulativeDancePoints+=wt.getCollection(y.play.timingCollection).getMaxDancePoints()),oi(t)?(this.chartManager.loadedChart.gameType.gameLogic.usesHoldTicks||(this.maxCumulativeDancePoints+=e.filter(Re).reduce((o,l)=>o+wt.getCollection(y.play.timingCollection).getMaxHoldDancePoints(l.type),0)),this.combo=0,this.chartManager.loadedChart.gameType.gameLogic.missComboIsPerRow?this.missCombo+=e.length*s:this.missCombo+=s,this.bestJudge=void 0):pi(t)&&(wt.getCollection(y.play.timingCollection).shouldHideNote(t)?(this.chartManager.loadedChart.gameType.gameLogic.comboIsPerRow?this.combo+=e.length*r:this.combo+=r,this.combo>this.maxCombo&&(this.maxCombo=this.combo),this.missCombo=0,this.bestJudge&&t.getTimingWindowMS()>this.bestJudge.getTimingWindowMS()&&(this.bestJudge=t)):(this.bestJudge=void 0,this.combo=0)),this.handlers.forEach(o=>o(n,t)),this.dataPoints.push({second:e[0].second,error:n,judgement:t,notes:e})}addHoldDataPoint(e,t){this.judgementCounts.has(t)||this.judgementCounts.set(t,0),this.judgementCounts.set(t,this.judgementCounts.get(t)+1);const n=wt.getCollection(y.play.timingCollection).getHeldJudgement(e);this.holdJudgementCounts.has(n)||this.holdJudgementCounts.set(n,[0,0]);const a=this.holdJudgementCounts.get(n);sn(t)?a[0]++:a[1]++,this.holdJudgementCounts.set(n,a),this.dancePoints+=t.dancePoints,this.maxCumulativeDancePoints+=wt.getCollection(y.play.timingCollection).getMaxHoldDancePoints(e.type),this.handlers.forEach(r=>r(0,t)),Pn(t)&&(this.bestJudge=void 0)}getScore(){return this.maxDancePoints==0?0:this.dancePoints/this.maxDancePoints}getCumulativeScore(){return this.maxCumulativeDancePoints==0?0:this.dancePoints/this.maxCumulativeDancePoints}getDataPoints(){return this.dataPoints}getMedian(){return Ia(this.dataPoints.filter(e=>!oi(e.judgement)&&pi(e.judgement)&&e.error!=null).map(e=>e.error))}getMaxCombo(){return this.maxCombo}calculateMaxDP(){this.maxDancePoints=this.chartManager.loadedChart.gameType.gameLogic.calculateMaxDP(this.notedata,this.chartManager.loadedChart.timingData)}getCount(e){return this.judgementCounts.get(e)??0}getCombo(){return this.combo}getMissCombo(){return this.missCombo}getBestJudge(){return this.bestJudge}}const Ot=[1,2,3,4,6,8,12,16,24,48,-1],wc=.2;var $=(i=>(i.View="View Mode",i.Edit="Edit Mode",i.Play="Play Mode",i.Record="Record Mode",i))($||{}),Ce=(i=>(i[i.Off=0]="Off",i[i.Edit=1]="Edit",i[i.Add=2]="Add",i))(Ce||{});class Eg{app;chartAudio=new pa;chartView;widgetManager;assistTick=new ps({src:Ud,volume:.5});me_high=new ps({src:Bc,volume:.5});me_low=new ps({src:Fc,volume:.5});mine=new ys.Howl({src:qd,volume:.5});loadedSM;smPath="";loadedChart;selection={notes:[],inProgressNotes:[]};eventSelection={timingEvents:[],inProgressTimingEvents:[]};editTimingMode=0;holdEditing=[];editNoteTypeIndex=0;partialScroll=0;noteFlashIndex=0;assistTickIndex=0;lastMetronomeDivision=-1;lastMetronomeMeasure=-1;holdFlashes=[];lastSong=null;mode="Edit Mode";lastMode="Edit Mode";_beat=0;noChartTextA;noChartTextB;loadingText;shiftPressed=0;virtualClipboard="";lastAutoSave=0;startRegion;endRegion;gameStats;constructor(e){this.app=e,document.addEventListener("keydown",t=>{t.key=="Shift"&&this.shiftPressed++}),document.addEventListener("keyup",t=>{t.key=="Shift"&&(this.shiftPressed=Math.max(this.shiftPressed-1,0))}),document.addEventListener("cut",t=>{if(t.target.classList.contains("inlineEdit")||t.target instanceof HTMLTextAreaElement||t.target instanceof HTMLInputElement||this.mode!="Edit Mode")return;const n=this.copy();n&&t.clipboardData?.setData("text/plain",n),this.eventSelection.timingEvents.length>0?this.deleteEventSelection():this.deleteSelection(),t.preventDefault()},!0),document.addEventListener("copy",t=>{if(t.target.classList.contains("inlineEdit")||t.target instanceof HTMLTextAreaElement||t.target instanceof HTMLInputElement||this.mode!="Edit Mode")return;const n=this.copy();n&&t.clipboardData?.setData("text/plain",n),t.preventDefault(),t.stopImmediatePropagation()},!0),document.addEventListener("paste",t=>{if(t.target.classList.contains("inlineEdit")||t.target instanceof HTMLTextAreaElement||t.target instanceof HTMLInputElement||this.mode!="Edit Mode")return;const n=t.clipboardData?.getData("text/plain");n&&this.paste(n,this.shiftPressed>0),t.preventDefault(),t.stopImmediatePropagation()},!0),e.view.addEventListener?.("wheel",t=>{if(!(this.loadedSM==null||this.loadedChart==null||this.chartView==null))if(t.preventDefault(),ni&&t.metaKey||!ni&&t.ctrlKey){const n=t.deltaY/5*y.chart.scroll.scrollSensitivity*(y.chart.scroll.invertZoomScroll?-1:1);y.chart.speed=Ae(y.chart.speed*Math.pow(1.01,n),10,35e3)}else{if(this.mode=="Play Mode"||this.mode=="Record Mode")return;let n=this.beat;const a=y.chart.snap;let r=t.deltaY/y.chart.speed*y.chart.scroll.scrollSensitivity;if(y.chart.reverse&&y.chart.scroll.invertReverseScroll&&(r*=-1),y.chart.scroll.invertScroll&&(r*=-1),a==0?(this.partialScroll=0,n=this.beat+r):y.chart.scroll.scrollSnapEveryScroll?r<0?n=Math.round((this.beat-a)/a)*a:n=Math.round((this.beat+a)/a)*a:(this.partialScroll+=r,Math.abs(this.partialScroll)>a&&(this.partialScroll<0?n=Math.round((this.beat+Math.ceil(this.partialScroll/a)*a)/a)*a:n=Math.round((this.beat+Math.floor(this.partialScroll/a)*a)/a)*a,this.partialScroll%=a)),n=Math.max(0,n),n!=this.beat&&(this.beat=n),!this.holdEditing.every(s=>s==null))for(let s=0;s<this.holdEditing.length;s++)!this.holdEditing[s]||this.holdEditing[s].type=="mouse"||this.editHoldBeat(s,this.beat,t.shiftKey)}}),this.widgetManager=new Cm(this),this.app.stage.addChild(this.widgetManager),this.noChartTextA=new Ee("No Chart",{fontName:"Main",fontSize:30}),this.noChartTextA.anchor.set(.5),this.noChartTextA.tint=5592405,this.app.stage.addChild(this.noChartTextA),this.noChartTextB=new Ee("Create a new chart",{fontName:"Main",fontSize:15}),this.noChartTextB.anchor.set(.5),this.noChartTextB.tint=5596791,this.noChartTextB.eventMode="static",this.noChartTextB.on("mouseover",()=>{this.noChartTextB.tint=8952234}),this.noChartTextB.on("mouseleave",()=>{this.noChartTextB.tint=5596791}),this.noChartTextB.on("mousedown",()=>{this.app.windowManager.openWindow(new Su(e,ft.getGameType("dance-single")))}),this.noChartTextA.visible=!1,this.noChartTextB.visible=!1,this.app.stage.addChild(this.noChartTextB),this.loadingText=new Ee("Loading simfile...",{fontName:"Main",fontSize:20}),this.loadingText.anchor.set(.5),this.loadingText.tint=5592405,this.app.stage.addChild(this.loadingText),this.loadingText.visible=!1,this.noChartTextA.x=0,this.noChartTextA.y=-20,this.noChartTextB.x=0,this.noChartTextB.y=10,this.loadingText.x=0,this.loadingText.y=0,setInterval(()=>{if(!this.loadedSM||!this.loadedChart||!this.chartView)return;const t=performance.now(),n=this.chartAudio.seek();if(this.chartAudio.isPlaying()&&!this.holdEditing.every(r=>!r))for(let r=0;r<this.holdEditing.length;r++){if(!this.holdEditing[r]||this.holdEditing[r].type=="mouse")continue;let s=this.beat;this.mode=="Record Mode"&&(s=this.loadedChart.getBeatFromSeconds(this.time+y.play.offset));const o=y.chart.snap==0?1/48:y.chart.snap,l=Math.round(s/o)*o,u=this.holdEditing[r];(Math.max(0,Math.round(Math.max(this.beat,u.endBeat)*48)/48)-Math.max(0,Math.round(Math.min(this.beat,u.startBeat)*48)/48))*60/(this.loadedChart.timingData.getEventAtBeat("BPMS",this.beat)?.value??120)>.3&&this.editHoldBeat(r,l,!1)}const a=this.loadedChart.getNotedata();if(this.chartAudio.isPlaying()){this._beat=this.loadedChart?.getBeatFromSeconds(this.time)??0;let r=a[this.noteFlashIndex];for(;this.noteFlashIndex<a.length&&n>r.second;)this.mode!="Record Mode"&&this.loadedChart.gameType.gameLogic.shouldAssistTick(r)&&this.mode!="Play Mode"&&(this.chartView.doJudgement(r,0,Ps),Re(r)&&(r.type=="Hold"&&this.chartView.getNotefield().activateHold(r.col),r.type=="Roll"&&this.chartView.getNotefield().activateRoll(r.col),this.holdFlashes.push(r))),this.noteFlashIndex++,r=a[this.noteFlashIndex];this.holdFlashes=this.holdFlashes.filter(o=>this._beat<o.beat+o.hold?!0:(this.chartView&&(o.type=="Hold"&&this.chartView.getNotefield().releaseHold(o.col),o.type=="Roll"&&this.chartView.getNotefield().releaseRoll(o.col),this.chartView.doJudgement(o,null,wt.getCollection(y.play.timingCollection).getHeldJudgement(o))),!1));const s=new Set;for(;this.assistTickIndex<a.length&&n>a[this.assistTickIndex].second+y.play.effectOffset-wc;){if(s.has(a[this.assistTickIndex].second)||a[this.assistTickIndex].second+y.play.effectOffset-n<0){this.assistTickIndex++;continue}this.mode!="Record Mode"&&this.loadedChart.gameType.gameLogic.shouldAssistTick(a[this.assistTickIndex])&&(y.audio.assistTick&&he.assist&&this.assistTick.play((a[this.assistTickIndex].second+y.play.effectOffset-n)/y.audio.rate),s.add(a[this.assistTickIndex].second)),this.assistTickIndex++}}if(this.chartAudio.isPlaying()&&y.audio.metronome&&he.assist){const r=this.loadedChart.timingData,s=this.loadedChart.getBeatFromSeconds(this.time+y.play.effectOffset+wc),o=new Set,l=r.getBeatFromMeasure(this.lastMetronomeMeasure),u=r.getDivisionLength(l),f=l+u*this.lastMetronomeDivision,c=[...r.getMeasureBeats(f,s)].slice(1);for(const[d,h]of c){if(this.beat>d)continue;const p=r.getSecondsFromBeat(d);if(o.has(p))continue;o.add(p);const m=(p+y.play.effectOffset-this.time)/y.audio.rate;h?this.me_high.play(m):this.me_low.play(m)}if(c.length>0){const d=c.at(-1)[0];this.lastMetronomeMeasure=Math.floor(r.getMeasure(d)),this.lastMetronomeDivision=Math.round(r.getDivisionOfMeasure(d))}}this.mode=="Play Mode"&&this.loadedChart.gameType.gameLogic.update(this),this.lastAutoSave+y.general.autosaveInterval*1e3<Date.now()&&(this.lastAutoSave=Date.now(),Lt.instance.isDirty()&&this.autosave()),this.updateSoundProperties(),fm(),qi.instance?.addUpdateTimeValue(performance.now()-t)},5),le.on("chartModified",()=>{this.loadedChart&&(this.setNoteIndex(),le.emit("chartModifiedAfter"))}),le.on("userOptionUpdated",t=>{t!="audio.rate"&&t!="play.effectOffset"&&t!="audio.assistTick"&&t!="audio.metronome"||(this.assistTick.stop(),this.me_low.stop(),this.me_high.stop(),this.setNoteIndex())}),window.addEventListener("keyup",t=>{if(this.mode=="Edit Mode"&&t.code.startsWith("Digit")){let n=parseInt(t.code.slice(5))-1;n==-1&&(n=9),this.endEditing(n)}},!0),window.addEventListener("keydown",t=>{const n=ve.getKeyNameFromEvent(t);if(this.mode=="Edit Mode"&&!t.target.classList.contains("inlineEdit")&&!(t.target instanceof HTMLTextAreaElement)&&!(t.target instanceof HTMLInputElement)&&!un.active){if(t.code.startsWith("Digit")&&!t.repeat&&!t.ctrlKey&&!t.metaKey&&!t.altKey&&!t.ctrlKey){let a=parseInt(t.code.slice(5))-1;a==-1&&(a=9),a<(this.loadedChart?.gameType.numCols??4)&&(this.setNote(a,"key"),t.preventDefault(),t.stopImmediatePropagation())}if(!this.holdEditing.every(a=>a==null)){const a=["cursorUp","cursorDown","previousNote","nextNote","previousMeasure","nextMeasure","jumpChartStart","jumpChartEnd","jumpSongStart","jumpSongEnd"];for(const r of a)if(ve.getCombosForKeybind(r).map(s=>s.key).includes(n)){t.preventDefault(),t.stopImmediatePropagation(),$e[r].callback(this.app);for(let s=0;s<this.holdEditing.length;s++)!this.holdEditing[s]||this.holdEditing[s].type=="mouse"||this.editHoldBeat(s,this.beat,t.shiftKey);return}for(const r of["undo","redo"])if(ve.getCombosForKeybind(r).map(s=>s.key).includes(n)){this.holdEditing=[];return}}}},!0),window.addEventListener("keydown",t=>{this.mode!="Play Mode"&&this.mode!="Record Mode"||t.key=="Escape"&&(this.setMode(this.lastMode),this.chartAudio.pause())},!0)}get beat(){return this.loadedChart?this.chartAudio.isPlaying()?this.loadedChart.getBeatFromSeconds(this.time):this._beat:0}set beat(e){this.loadedChart&&(this.chartAudio.seek(this.loadedChart.getSecondsFromBeat(e)),this._beat=e,this.setNoteIndex(),this.lastMetronomeMeasure=Math.floor(this.loadedChart.timingData.getMeasure(this.beat)),this.lastMetronomeDivision=Math.floor(this.loadedChart.timingData.getDivisionOfMeasure(this.beat)))}get time(){return this.chartAudio.seek()}set time(e){this.loadedChart&&(this.chartAudio.seek(e),this._beat=this.loadedChart.getBeatFromSeconds(e),this.setNoteIndex())}async loadSM(e){if(Iu.close(),Ru.close(),dm.close(),Lt.instance.isDirty()){const s=new $n(this.app,"Save","Do you wish to save the current file?",[{label:"Cancel",type:"default"},{label:"No",type:"default"},{label:"Yes",type:"confirm"}]);this.app.windowManager.openWindow(s);const o=await s.resolved;if(o=="Cancel")return;o=="Yes"&&this.save(),o=="No"&&await this.removeAutosaves()}if(!e){this.smPath="",this.loadedSM=void 0,this.chartAudio.stop(),this.noChartTextA.visible=!1,this.noChartTextB.visible=!1,this.chartView?.destroy({children:!0});return}this.chartAudio.stop(),this.chartAudio.seek(0),this.lastSong=null,this.smPath=e,this.loadingText.visible=!0;let t=this.smPath;const n=this.getSMPath(".smebak");if(await _e.hasFile(n)){const s=new $n(this.app,"Autosave","An autosave was found. Do you wish to load the autosave?",[{label:"No",type:"default"},{label:"Yes",type:"confirm"}]);this.app.windowManager.openWindow(s),await s.resolved=="Yes"&&(t=n)}const a=await _e.getFileHandle(t);if(!a){de.createFormatted("Couldn't load the file at "+t,"error"),this.app.windowManager.openWindow(new po(this.app)),this.loadingText.visible=!1;return}const r=await a.getFile();this.loadedSM=new xc(r),await this.loadedSM.loaded,this.loadingText.visible=!1,this.noChartTextA.visible=!0,this.noChartTextB.visible=!0,this.editTimingMode=0,le.emit("smLoaded"),await this.loadChart(),le.emit("smLoadedAfter"),this.beat=0,Tu.addSM(this.smPath,this.loadedSM)}async loadChart(e){if(this.loadedSM==null)return;if(e==null){if(this.loadedChart){const a=this.loadedSM.charts[this.loadedChart.gameType.id];a&&a.length>0&&(e=a.at(-1))}if(!e)for(const a of ft.getPriority()){const r=this.loadedSM.charts[a.id];if(r&&r.length>0){e=r.at(-1);break}}if(!e){this.chartView?.destroy({children:!0}),this.chartView?.removeChildren(),this.beat=0,this.loadedChart=void 0,this.chartView=void 0,this.noChartTextA.visible=!0,this.noChartTextB.visible=!0,le.emit("chartLoaded"),le.emit("chartModified");return}}if(e==this.loadedChart)return;this.chartView?.destroy({children:!0}),this.chartView?.removeChildren(),this.clearSelections(),this.loadedChart=e,this.beat=this.loadedChart.getBeatFromSeconds(this.time),Lt.instance.reset(),y.play.timingCollection="ITG";for(const[a,r]of Object.entries(y.play.defaultTimingCollections))if(e.gameType.id.startsWith(a)){y.play.timingCollection=r;break}const t=ft.getGameType(y.chart.noteskin.type),n={type:e.gameType.id,name:y.chart.lastNoteskins[e.gameType.id]??"default"};if(t){const a=et.getNoteskinData(t,y.chart.noteskin.name);a?.gameTypes.includes(e.gameType.id)&&(n.name=a.id)}if(y.chart.noteskin=n,y.chart.lastNoteskins[e.gameType.id]=n.name,this.setNoteIndex(),this.chartView=new xg(this),(this.mode=="Play Mode"||this.mode=="Record Mode")&&this.setMode(this.lastMode),he.viewMode&&this.setMode("View Mode"),this.noChartTextA.visible=!1,this.noChartTextB.visible=!1,this.loadedChart.getMusicPath()!=this.lastSong){this.lastSong=this.loadedChart.getMusicPath();const a=this.chartAudio.isPlaying();await this.loadAudio(),le.emit("audioLoaded"),a&&this.chartAudio.play()}de.create("Loaded chart "+e.difficulty+" "+e.meter+" "+e.gameType.id),le.emit("chartLoaded"),le.emit("audioLoaded"),le.emit("chartModified"),this.loadedChart.gameType.id=="dance-single"?window.Parity=new zm(this.app,this.loadedChart.gameType.id):window.Parity=void 0,he.autoPlay&&this.playPause()}async loadAudio(){if(!this.loadedSM||!this.loadedChart)return;this.chartAudio.stop(),this.chartAudio?.destroy();const e=this.loadedChart.getMusicPath();if(de.create("Loading audio..."),e==""){de.createFormatted("Failed to load audio: no audio file","error");const r=Math.max(0,this.beat);this.chartAudio=new pa(void 0),this.beat=r;return}const t=await this.getAudioHandle(e);if(t==null){de.createFormatted("Failed to load audio: couldn't find audio file "+e,"error");const r=Math.max(0,this.beat);this.chartAudio=new pa(void 0),this.beat=r;return}const n=await t.getFile(),a=Math.max(0,this.beat);this.chartAudio=new pa(await n.arrayBuffer(),kt(n.name)),this.chartAudio.onLoad(()=>{de.create("Loaded audio")}),this.beat=a,this.chartAudio.onStop=()=>{this.assistTick.stop(),this.me_high.stop(),this.me_low.stop()},this.setNoteIndex()}async getAudioHandle(e){let t=await _e.getFileHandleRelativeTo(this.smPath,e);if(t)return t;try{const n=await _e.getDirectoryFiles(rt(this.smPath));if(t=n.filter(a=>a.name.toLowerCase()==Et(e).toLowerCase())[0],t)return de.createFormatted("Failed to locate audio file "+e+", using file "+t.name+" instead","warn"),t;t=n.filter(a=>Va.includes(kt(a.name)))[0],t&&de.createFormatted("Failed to locate audio file "+e+", using file "+t.name+" instead","warn")}catch{return}return t}getAudio(){return this.chartAudio}updateSoundProperties(){this.setEffectVolume(y.audio.soundEffectVolume*y.audio.masterVolume),this.setVolume(y.audio.songVolume*y.audio.masterVolume),this.setRate(y.audio.rate)}setRate(e){this.chartAudio.rate(e)}setVolume(e){this.chartAudio.volume(e)}setEffectVolume(e){this.assistTick.volume(e),this.me_high.volume(e),this.me_low.volume(e),this.mine.volume()!=e&&this.mine.volume(e)}setNoteIndex(){if(this.loadedSM==null||this.loadedChart==null||this.chartView==null||this.loadedChart.getNotedata().length==0){this.noteFlashIndex=0,this.assistTickIndex=0;return}this.assistTick.stop(),this.noteFlashIndex=qt(this.loadedChart.getNotedata(),this.time,e=>e.second)+1,this.noteFlashIndex>=1&&this.time<=this.loadedChart.getNotedata()[this.noteFlashIndex-1].second&&this.noteFlashIndex--,this.assistTickIndex=this.noteFlashIndex;for(const e of this.holdFlashes)e.type=="Hold"?this.chartView.getNotefield().releaseHold(e.col):e.type=="Roll"&&this.chartView.getNotefield().releaseRoll(e.col);this.holdFlashes=[]}playPause(){this.setNoteIndex(),this.chartAudio.isPlaying()?(this.chartAudio.pause(),this._beat=this.loadedChart?.getBeatFromSeconds(this.time)??0):this.chartAudio.play()}getClosestTick(e,t){if(!this.loadedChart)return 0;const n=Math.max(.001,4/t),a=this.loadedChart.timingData.getBeatOfMeasure(e),r=e-a,s=Math.round(a/n)*n;return Math.max(0,r+s)}snapToNearestTick(e){this.beat=Math.max(0,this.getClosestTick(e,4/y.chart.snap))}snapToPreviousTick(){if(!this.loadedChart)return;const e=Math.max(.001,y.chart.snap),t=Math.floor(this.loadedChart.timingData.getMeasure(this.beat)),n=this.loadedChart.timingData.getBeatFromMeasure(t),a=Math.floor((this.beat-n)/e)*e,r=Math.abs(a-(this.beat-n))<5e-4?a-e:a,s=r+n;if(r<0){const o=this.loadedChart.timingData.getBeatFromMeasure(t-1),l=Math.round((s-o)/e)*e;this.beat=Math.max(0,o+l);return}this.beat=Math.max(0,s)}snapToNextTick(){if(!this.loadedChart)return;const e=Math.max(.001,y.chart.snap),t=Math.floor(this.loadedChart.timingData.getMeasure(this.beat)),n=this.loadedChart.timingData.getBeatFromMeasure(t),s=Math.floor((this.beat-n+5e-4)/e)*e+e+n,o=this.loadedChart.timingData.getBeatFromMeasure(t+1);if(s>o){this.beat=o;return}this.beat=s}previousSnap(){let e=this.getSnapIndex()-1;e=(e+Ot.length)%Ot.length,y.chart.snap=Ot[e]==-1?0:1/Ot[e],le.emit("snapChanged")}nextSnap(){let e=this.getSnapIndex();(e==Ot.length-1||Math.abs(1/y.chart.snap-Ot[e])<=5e-4)&&e++,e=(e+Ot.length)%Ot.length,y.chart.snap=Ot[e]==-1?0:1/Ot[e],le.emit("snapChanged")}getSnapIndex(){return y.chart.snap==0?Ot.length-1:Ot.findIndex(e=>1/e<=y.chart.snap)}removeDuplicateBeats(e){if(e.length===0)return e;const t=[e[0]];for(let n=1;n<e.length;n++)e[n-1]!==e[n]&&t.push(e[n]);return t}getRows(){if(this.loadedSM==null||this.loadedChart==null||this.chartView==null)return[];if(this.loadedChart.getNotedata().length==0)return[];const e=this.loadedChart.getNotedata().filter(Re).map(n=>n.beat+n.hold),t=this.loadedChart.getNotedata().map(n=>n.beat).concat(e).sort((n,a)=>n-a);return this.removeDuplicateBeats(t)}previousNote(){const e=this.getRows();if(e.length==0)return;let t=qt(e,this.beat);this.beat==e[t]&&t--,this.beat=e[Math.max(0,t)]}nextNote(){const e=this.getRows();if(e.length==0)return;let t=qt(e,this.beat);this.beat>=e[t]&&t++,this.beat=e[Math.min(e.length-1,t)]}firstNote(){if(this.loadedSM==null||this.loadedChart==null||this.chartView==null)return;const e=this.loadedChart.getNotedata();e.length!=0&&(this.beat=e[0].beat)}lastNote(){if(this.loadedSM==null||this.loadedChart==null||this.chartView==null)return;const e=this.loadedChart.getNotedata();if(e.length==0)return;const t=e[e.length-1];this.beat=Vi(t)}truncateHold(e,t){const n=Ae(Math.round((t-Math.max(.020833333333333332,y.chart.snap))*48)/48,e.beat,e.beat+e.hold-.020833333333333332);return n==e.beat?{beat:e.beat,col:e.col,type:"Tap"}:{beat:e.beat,col:e.col,type:e.type,hold:n-e.beat}}setNote(e,t,n=this.beat){if(this.loadedSM==null||this.loadedChart==null||this.chartView==null)return;if(n=Math.max(0,Math.round(n*48)/48),y.chart.forceSnapNotes){const o=y.chart.snap==0?.020833333333333332:y.chart.snap;n=Math.round(n/o)*o}const a=this.loadedChart.getNotedata().filter(o=>o.col!=e?!1:Math.abs(o.beat-n)<.003?!0:Re(o)&&o.beat==n),r=this.loadedChart.getNotedata().filter(o=>Re(o)&&o.col==e&&n>o.beat&&n<=Math.round((o.beat+o.hold)*48)/48).map(o=>({oldNote:o,newNote:this.truncateHold(o,n)})),s={startBeat:n,endBeat:n,roll:!1,originalNote:void 0,type:t,removedNotes:a,truncatedHolds:r,direction:null};this.holdEditing[e]=s,a.length==0&&(s.originalNote={beat:n,col:e,type:this.getEditingNoteType()}),this.setNoteIndex(),this.app.actionHistory.run({action:()=>{s.removedNotes.forEach(o=>{this.loadedChart.removeNote(o),this.removeNoteFromSelection(o)}),s.truncatedHolds.forEach(o=>this.loadedChart.modifyNote(o.oldNote,o.newNote)),s.originalNote&&this.loadedChart.addNote(s.originalNote)},undo:()=>{s.originalNote&&this.loadedChart.removeNote(s.originalNote),s.truncatedHolds.forEach(o=>this.loadedChart.modifyNote(o.newNote,o.oldNote)),s.removedNotes.forEach(o=>this.loadedChart.addNote(o))}})}editHoldBeat(e,t,n){if(this.loadedSM==null||this.loadedChart==null||this.chartView==null)return;const a=this.holdEditing[e];if(a==null||(t=Math.round(t*48)/48,t==a.startBeat&&t==a.endBeat))return;if(a.direction===null&&(t<a.startBeat?a.direction="up":a.direction="down"),y.chart.defaultHoldPlacement?a.direction=="up"?a.startBeat=Math.min(a.endBeat,Math.round(t*48)/48):a.endBeat=Math.max(a.startBeat,Math.round(t*48)/48):(a.startBeat=Math.min(a.startBeat,Math.round(t*48)/48),a.endBeat=Math.max(a.endBeat,Math.round(t*48)/48)),a.roll||=n,a.originalNote){const s={beat:a.startBeat,type:a.roll?"Roll":"Hold",hold:a.endBeat-a.startBeat};a.endBeat-a.startBeat==0&&(s.hold=void 0,s.type="Tap"),(s.beat!=a.originalNote.beat||s.type!=a.originalNote.type||Re(a.originalNote)&&s.hold!=a.originalNote.hold)&&this.loadedChart.modifyNote(a.originalNote,s)}else{const s={beat:a.startBeat,col:e,type:a.roll?"Roll":"Hold",hold:a.endBeat-a.startBeat};a.endBeat-a.startBeat==0&&(s.type="Tap",Object.assign(s,{hold:void 0})),this.loadedChart.addNote(s)}a.originalNote={beat:a.startBeat,col:e,type:a.endBeat-a.startBeat==0?"Tap":a.roll?"Roll":"Hold",hold:a.endBeat-a.startBeat==0?void 0:a.endBeat-a.startBeat};const r=this.loadedChart.getNotedata().filter(s=>s.beat==a.originalNote.beat&&s.col==a.originalNote.col||s.col!=e?!1:s.beat>=a.startBeat&&s.beat<=a.endBeat?!0:Re(s)&&s.beat+s.hold>=a.startBeat&&s.beat+s.hold<=a.endBeat);a.removedNotes=a.removedNotes.concat(r),r.forEach(s=>this.loadedChart.removeNote(s)),this.setNoteIndex()}endEditing(e){this.holdEditing[e]=void 0}previousNoteType(){const e=this.loadedChart?.gameType.editNoteTypes.length??0;this.editNoteTypeIndex=(this.editNoteTypeIndex-1+e)%e}nextNoteType(){const e=this.loadedChart?.gameType.editNoteTypes.length??0;this.editNoteTypeIndex=(this.editNoteTypeIndex+1+e)%e}getEditingNoteType(){return this.loadedChart?.gameType.editNoteTypes[this.editNoteTypeIndex]??null}setEditingNoteType(e){if(!this.loadedChart)return;const n=(this.loadedChart?.gameType.editNoteTypes).indexOf(e);n!=-1&&(this.editNoteTypeIndex=n)}getMode(){return this.mode}setMode(e){if(!this.loadedChart||!this.chartView)return;if(this.mode==e){(e=="Play Mode"||e=="Record Mode")&&(this.setMode(this.lastMode),this.setNoteIndex(),this.chartAudio.pause());return}(this.mode=="View Mode"||this.mode=="Edit Mode")&&(this.lastMode=this.mode),this.mode=e;const t=this.loadedChart.getNotedata();if(this.mode=="Play Mode"){t.forEach(n=>{n.gameplay={hideNote:!1,hasHit:!1}}),this.holdFlashes=[];for(let n=0;n<this.loadedChart.gameType.numCols;n++)this.chartView.getNotefield().releaseHold(n),this.chartView.getNotefield().releaseRoll(n);for(const n of t)if(n.second<this.time)n.gameplay.hasHit=!0;else break;this.gameStats=new Cg(this),this.widgetManager.startPlay(),this.chartAudio.seek(Math.max(0,this.time)-1),this.loadedChart.gameType.gameLogic.startPlay(this),this.chartAudio.play(),this.chartView.startPlay()}else this.mode=="Record Mode"?(this.chartAudio.seek(Math.max(0,this.time)-1),this.chartAudio.play()):(this.chartView.endPlay(),t.forEach(n=>n.gameplay=void 0))}judgeCol(e){if(!(!this.loadedChart||!this.chartView)){if(this.mode=="Play Mode")this.loadedChart.gameType.gameLogic.keyDown(this,e);else if(this.mode=="Record Mode"){const t=this.loadedChart.getBeatFromSeconds(this.time+y.play.offset),n=y.chart.snap==0?1/48:y.chart.snap,a=Math.round(t/n)*n;this.setNote(e,"key",a)}}}judgeColUp(e){!this.loadedChart||!this.chartView||(this.mode=="Play Mode"?this.loadedChart.gameType.gameLogic.keyUp(this,e):this.mode=="Record Mode"&&this.endEditing(e))}async save(){if(!this.loadedSM||this.smPath.startsWith("https://")||this.smPath.startsWith("http://"))return;const e=this.getSMPath(".sm"),t=this.getSMPath(".ssc");let n=null;!this.loadedSM.usesChartTiming()&&await _e.getFileHandle(this.getSMPath(".sm"))&&await _e.writeFile(e,this.loadedSM.serialize("sm")).catch(a=>{const r=a.message;r.includes(An.GONE[0])||(n=r)}),(this.loadedSM.requiresSSC()||await _e.getFileHandle(t))&&await _e.writeFile(t,this.loadedSM.serialize("ssc")).catch(a=>{const r=a.message;r.includes(An.GONE[0])||(n=r)}),n==null?(this.loadedSM.usesChartTiming()?de.create("Saved. No SM file since split timing was used."):de.create("Saved"),await this.removeAutosaves()):de.createFormatted("Failed to save file: "+n,"error"),Lt.instance.setLimit()}getSMPath(e){if(window.nw){const t=window.nw.require("path"),n=t.parse(this.smPath);return t.resolve(n.dir,n.name+e)}else{const t=rt(this.smPath),n=Et(this.smPath),a=n.includes(".")?n.split(".").slice(0,-1).join("."):n;return t+"/"+a+e}}async removeAutosaves(){await _e.removeFile(this.getSMPath(".smebak")).catch(()=>{})}async autosave(){if(!this.loadedSM||this.smPath.startsWith("https://")||this.smPath.startsWith("http://"))return;let e=null;await _e.writeFile(this.getSMPath(".smebak"),this.loadedSM.serialize("ssc")).catch(t=>{const n=t.message;n.includes(An.GONE[0])||(e=n)}),e==null?de.create("Autosaved"):de.createFormatted("Failed to autosave file: "+e,"error")}hasSelection(){return this.hasNoteSelection()||this.hasEventSelection()}hasNoteSelection(){return this.selection.notes.length>0||this.startRegion!==void 0&&this.endRegion!==void 0}hasEventSelection(){return this.eventSelection.timingEvents.length>0}hasRange(){return this.selection.notes.length>1||this.eventSelection.timingEvents.length>1||this.startRegion!==void 0&&this.endRegion!==void 0}clearSelections(){this.selection={notes:[],inProgressNotes:[]},this.eventSelection={timingEvents:[],inProgressTimingEvents:[]}}startDragSelection(){this.selection.inProgressNotes=[]}endDragSelection(){let e=0,t=0;const n=[],a=this.selection.inProgressNotes,r=this.selection.notes,s=(o,l)=>o.beat==l.beat?o.col-l.col:o.beat-l.beat;if(a.length==0||r.length==0){this.selection.notes=a.concat(r),this.selection.inProgressNotes=[];return}for(;;)if(s(a[e],r[t])<0){if(n.push(a[e]),e++,e>=a.length){this.selection.notes=n.concat(r.slice(t));break}}else if(n.push(r[t]),t++,t>=r.length){this.selection.notes=n.concat(a.slice(e));break}this.selection.inProgressNotes=[]}startDragEventSelection(){this.eventSelection.inProgressTimingEvents=[]}endDragEventSelection(){let e=0,t=0;const n=[],a=this.eventSelection.inProgressTimingEvents,r=this.eventSelection.timingEvents,s=(o,l)=>o.beat-l.beat;if(a.length==0||r.length==0){this.eventSelection.timingEvents=a.concat(r),this.eventSelection.inProgressTimingEvents=[];return}for(;;)if(s(a[e],r[t])<0){if(n.push(a[e]),e++,e>=a.length){this.eventSelection.timingEvents=n.concat(r.slice(t));break}}else if(n.push(r[t]),t++,t>=r.length){this.eventSelection.timingEvents=n.concat(a.slice(e));break}this.eventSelection.inProgressTimingEvents=[]}addNoteToDragSelection(e){this.addNoteSelection(this.selection.inProgressNotes,e)}removeNoteFromDragSelection(e){this.removeNoteSelection(this.selection.inProgressNotes,e)}addEventToDragSelection(e){this.addEventSelection(this.eventSelection.inProgressTimingEvents,e)}removeEventFromDragSelection(e){this.removeEventSelection(this.eventSelection.inProgressTimingEvents,e)}addNoteToSelection(e){this.addNoteSelection(this.selection.notes,e)}removeNoteFromSelection(e){this.removeNoteSelection(this.selection.notes,e)}setNoteSelection(e){this.selection.inProgressNotes=[],this.selection.notes=[...e].sort((t,n)=>t.beat==n.beat?t.col-n.col:t.beat-n.beat)}addEventToSelection(e){this.addEventSelection(this.eventSelection.timingEvents,e)}removeEventFromSelection(e){this.removeEventSelection(this.eventSelection.timingEvents,e)}setEventSelection(e){this.eventSelection.inProgressTimingEvents=[],this.eventSelection.timingEvents=e.sort((t,n)=>t.beat-n.beat)}isNoteInSelection(e){return this.getNoteSelectionIndex(this.selection.notes,e)!=-1||this.getNoteSelectionIndex(this.selection.inProgressNotes,e)!=-1}isEventInSelection(e){return this.getEventSelectionIndex(this.eventSelection.timingEvents,e)!=-1||this.getEventSelectionIndex(this.eventSelection.inProgressTimingEvents,e)!=-1}addNoteSelection(e,t){let n=ta(e,t.beat,a=>a.beat);for(;e[n]&&(e[n].beat<t.beat||e[n].beat==t.beat&&e[n].col<t.col);)n++;e.splice(n,0,t)}removeNoteSelection(e,t){const n=this.getNoteSelectionIndex(e,t);n!=-1&&e.splice(n,1)}getNoteSelectionIndex(e,t){let n=ta(e,t.beat,a=>a.beat);for(;e[n]&&e[n].beat==t.beat;){if(Eo(e[n],t))return n;n++}return-1}addEventSelection(e,t){let n=ta(e,t.beat,a=>a.beat);for(;e[n]&&e[n].beat<=t.beat;)n++;e.splice(n,0,t)}removeEventSelection(e,t){const n=this.getEventSelectionIndex(e,t);n!=-1&&e.splice(n,1)}getEventSelectionIndex(e,t){let n=ta(e,t.beat,a=>a.beat);for(;e[n]&&e[n].beat==t.beat;){if(Eo(e[n],t))return n;n++}return-1}selectRegion(){if(this.loadedChart){if(this.endRegion!==void 0&&(this.startRegion=void 0,this.endRegion=void 0),this.startRegion===void 0){this.clearSelections(),this.startRegion=this.beat;return}this.endRegion=this.beat,this.endRegion<this.startRegion&&(this.endRegion=this.startRegion,this.startRegion=this.beat),le.emit("regionChanged",this.startRegion,this.endRegion),this.editTimingMode==0?this.setNoteSelection(this.loadedChart.getNotedataInRange(this.startRegion,this.endRegion)):this.setEventSelection(_a.flatMap(e=>this.loadedChart.timingData.getColumn(e).events).filter(e=>e.beat>=this.startRegion&&e.beat<=this.endRegion))}}modifySelection(e,t=!1){if(!this.loadedChart)return;const n=this.selection.notes,a=structuredClone(this.selection.notes).map(e).sort((l,u)=>l.beat==u.beat?l.col-u.col:l.beat-u.beat);if(a.length==0)return;const r=[];for(const l of a){const u=r.at(-1);u!==void 0&&u.beat==l.beat&&u.col==l.col||r.push(l)}if(r.length==0)return;const{removedNotes:s,truncatedHolds:o}=this.checkConflicts(r,n);if(t){const l=r.map(h=>Vi(h));let u=0;for(const h of l)h>u&&(u=h);const f=new Array(this.loadedChart.gameType.numCols).fill(0).map((h,p)=>({type:"Hold",hold:u-r[0].beat,col:p,beat:r[0].beat})),{removedNotes:c,truncatedHolds:d}=this.checkConflicts(f,n);c.forEach(h=>{s.includes(h)||s.push(h)}),d.forEach(h=>{const p=o.find(m=>m.oldNote==h.oldNote);if(p){const m=Re(p.newNote)?p.newNote.hold:0,g=Re(p.newNote)?p.newNote.hold:0,b=Math.min(m,g);b==0?p.newNote={beat:p.newNote.beat,col:p.newNote.col,type:"Tap"}:p.newNote={beat:p.newNote.beat,col:p.newNote.col,type:p.newNote.type,hold:b}}}),s.sort((h,p)=>h.beat==p.beat?h.col-p.col:h.beat-p.beat),o.sort((h,p)=>h.newNote.beat==p.newNote.beat?h.newNote.col-p.newNote.col:h.newNote.beat-p.newNote.beat)}this.app.actionHistory.run({action:()=>{this.loadedChart.removeNotes(n.concat(s),!1),o.forEach(l=>this.loadedChart.modifyNote(l.oldNote,l.newNote,!1)),this.clearSelections(),this.setNoteSelection(this.loadedChart.addNotes(r))},undo:()=>{this.loadedChart.removeNotes(r,!1),o.forEach(l=>this.loadedChart.modifyNote(l.newNote,l.oldNote,!1)),this.loadedChart.addNotes(s,!1),this.clearSelections(),this.setNoteSelection(this.loadedChart.addNotes(n))}})}checkConflicts(e,t=[]){if(e.length==0)return{removedNotes:[],truncatedHolds:[]};const n=this.loadedChart.getNotedata(),a=this.loadedChart.gameType.numCols,r=new Array(a).fill(0).map(f=>[]);for(const f of n)r[f.col].push(f);const s=new Array(a).fill(0).map(f=>[]);for(const f of e)f.col>a||s[f.col].push(f);const o=[],l=[],u=[];for(let f=0;f<a;f++){if(s[f].length==0)continue;let c=r[f].findIndex(d=>s[f][0].beat<=(Re(d)?d.beat+d.hold:d.beat));for(const d of s[f])for(;r[f][c];){const h=r[f][c],p=Re(d)?d.beat+d.hold:d.beat;if(!t.includes(h)&&!u.includes(h)&&(d.beat<=h.beat&&p>=h.beat?(u.push(h),o.push(h)):Re(h)&&h.beat+h.hold>=d.beat&&h.beat<d.beat&&(u.push(h),l.push({oldNote:h,newNote:this.truncateHold(h,d.beat)}))),r[f][c+1]?.beat>p)break;c++}}return o.sort((f,c)=>f.beat==c.beat?f.col-c.col:f.beat-c.beat),l.sort((f,c)=>f.newNote.beat==c.newNote.beat?f.newNote.col-c.newNote.col:f.newNote.beat-c.newNote.beat),{removedNotes:o,truncatedHolds:l}}modifyEventSelection(e){if(!this.loadedChart||!this.loadedSM)return;const t=this.eventSelection.timingEvents.map(n=>[n,e(structuredClone(n))]);this.loadedChart.timingData.modifyColumnEvents(t)}deleteSelection(){if(this.selection.notes.length==0)return;const e=this.selection.notes;this.app.actionHistory.run({action:()=>{this.loadedChart.removeNotes(e),this.clearSelections()},undo:()=>{this.selection.notes=this.loadedChart.addNotes(e)}})}deleteEventSelection(){this.eventSelection.timingEvents.length!=0&&(!this.loadedChart||!this.loadedSM||this.loadedChart.timingData.deleteColumnEvents(this.eventSelection.timingEvents))}paste(e,t=!1){if(this.loadedChart&&(e.startsWith("ArrowVortex:notes:")&&(this.pasteNotes(e,t)||this.pasteNotes(this.virtualClipboard,t)),e.startsWith("ArrowVortex:tempo:")||e.startsWith("SMEditor:tempo:"))){this.pasteTempo(e)||this.pasteTempo(this.virtualClipboard);return}}pasteNotes(e,t=!1){if(!this.loadedChart)return!0;const n=km(e);return!n||n.length==0?!1:(this.insertNotes(n.map(a=>(a.beat+=this.beat,a.beat=Math.round(a.beat*48)/48,a)),t),!0)}insertNotes(e,t=!1){e.sort((r,s)=>r.beat==s.beat?r.col-s.col:r.beat-s.beat);const{removedNotes:n,truncatedHolds:a}=this.checkConflicts(e);if(t){const r=e.map(f=>Vi(f));let s=0;for(const f of r)f>s&&(s=f);const o=new Array(this.loadedChart.gameType.numCols).fill(0).map((f,c)=>({type:"Hold",hold:s-e[0].beat,col:c,beat:e[0].beat})),{removedNotes:l,truncatedHolds:u}=this.checkConflicts(o);l.forEach(f=>{n.includes(f)||n.push(f)}),u.forEach(f=>{const c=a.find(d=>d.oldNote==f.oldNote);if(c){const d=Re(c.newNote)?c.newNote.hold:0,h=Re(c.newNote)?c.newNote.hold:0,p=Math.min(d,h);p==0?c.newNote={beat:c.newNote.beat,col:c.newNote.col,type:"Tap"}:c.newNote={beat:c.newNote.beat,col:c.newNote.col,type:c.newNote.type,hold:p}}}),n.sort((f,c)=>f.beat==c.beat?f.col-c.col:f.beat-c.beat),a.sort((f,c)=>f.newNote.beat==c.newNote.beat?f.newNote.col-c.newNote.col:f.newNote.beat-c.newNote.beat)}this.app.actionHistory.run({action:()=>{this.loadedChart.removeNotes(n,!1),a.forEach(r=>{this.loadedChart.modifyNote(r.oldNote,r.newNote,!1)}),this.clearSelections(),this.setNoteSelection(this.loadedChart.addNotes(e))},undo:()=>{this.loadedChart.removeNotes(e,!1),a.forEach(r=>{this.loadedChart.modifyNote(r.newNote,r.oldNote,!1)}),this.setNoteSelection(this.loadedChart.addNotes(n)),this.clearSelections()}})}pasteTempo(e){if(!this.loadedChart||!this.loadedSM)return!0;const t=Fm(e);return!t||t.length==0?!1:(t.forEach(n=>{n.type=="ATTACKS"?n.second+=this.time:n.beat+=this.beat}),this.loadedChart.timingData.insertColumnEvents(t),!0)}copy(){if(this.selection.notes.length!=0){const e=Math.min(...this.selection.notes.map(a=>a.beat)),t=structuredClone(this.selection.notes).map(a=>(a.beat-=e,a)).sort((a,r)=>a.beat==r.beat?a.col-r.col:a.beat-r.beat),n=Sm(t);return this.virtualClipboard=n,n}else if(this.eventSelection.timingEvents.length!=0){const e=Math.min(...this.eventSelection.timingEvents.map(r=>r.beat)),t=this.loadedChart.timingData.getSecondsFromBeat(e),n=structuredClone(this.eventSelection.timingEvents).map(r=>r.type=="ATTACKS"?(r.second-=t,r):(r.beat-=e,r)).sort((r,s)=>r.type!=s.type?r.type.localeCompare(s.type):r.type=="ATTACKS"?r.second-s.second:r.beat-s.beat),a=Dm(n);return this.virtualClipboard=a,a}}}class Ag{app;view;constructor(e,t){if(this.app=e,this.view=t,!he.menuBar)return;const n=Object.values(rn).map(a=>this.createElement(a));t.replaceChildren(...n)}createElement(e){if(e.type=="separator"){const t=document.createElement("div");return t.classList.add("separator"),t}if(e.type=="selection"||e.type=="checkbox"||e.type=="dropdown"){const t=document.createElement("div"),n=document.createElement("div"),a=document.createElement("div");let r;if(e.type=="selection"||e.type=="checkbox"){const s=$e[e.id]??{label:e.id,combos:[],callback:()=>{}};r=document.createElement("div"),r.innerText=ve.getKeybindString(e.id),r.classList.add("keybind","unselectable"),a.innerText=s.label;let o=s.disabled;typeof o=="function"&&(o=o(this.app)),o&&t.classList.add("disabled"),t.addEventListener("click",()=>{if(o)return;s.callback(this.app),t.closest(".menu-main").querySelector(".menubar-dropdown").replaceChildren()})}else r=pe.getIcon("CHEVRON",16),r.style.transform="rotate(-90deg)",a.innerText=typeof e.title=="function"?e.title(this.app):e.title;if(n.appendChild(a),n.appendChild(r),t.appendChild(n),t.classList.add("menu-item"),n.classList.add("menu-item-title","menu-hover"),a.classList.add("title","unselectable"),e.type=="dropdown"){const s=document.createElement("div");t.appendChild(s),s.classList.add("menubar-dropdown"),e.options.map(o=>this.createElement(o)).forEach(o=>s.appendChild(o))}if(e.type=="checkbox"){let s=e.checked;typeof s=="function"&&(s=s(this.app)),s&&(a.innerText="✓ "+a.innerText)}return t}if(e.type=="menu"){const t=document.createElement("div"),n=document.createElement("div"),a=document.createElement("div");return t.appendChild(n),n.innerText=e.title,t.appendChild(a),n.classList.add("title","unselectable"),t.classList.add("menu-item","menu-main"),n.classList.add("menu-hover"),a.classList.add("menubar-dropdown","unselectable"),t.onmouseenter=()=>{a.replaceChildren(...e.options.map(r=>this.createElement(r)))},t.onmouseleave=()=>{a.replaceChildren()},t}return document.createElement("div")}}class kg{view;windows=[];app;constructor(e,t){this.app=e,this.view=t}unfocusAll(){for(const e of this.view.querySelectorAll(".focused"))e.classList.remove("focused")}getFocusedWindow(){for(const e of this.windows)if(e.windowElement.classList.contains("focused"))return e;return null}isBlocked(){return!this.windows.every(e=>!e.options.blocking)}openWindow(e){if(e.options.win_id){const t=this.getWindowById(e.options.win_id);if(t){t.focus();return}}e.addToManager(this),this.windows.push(e)}removeWindow(e){this.windows.splice(this.windows.indexOf(e),1)}getWindowById(e){for(const t of this.windows)if(t.options.win_id==e)return t}}const ms=960;class Sg{VERSION="1.3.0";options=y;events=le;themes=Be;renderer;stage;view;chartManager;windowManager;menubarManager;actionHistory;capturing=!1;STAGE_HEIGHT=ms;STAGE_WIDTH=ms;lastWidth=-1;lastHeight=-1;constructor(){if(Ke.setDefaultProps({duration:[200,100],theme:"sm"}),y.loadOptions(),td(),ve.load(this),window.nw){const e=nw.Window.get();y.app.fullscreen?e.enterFullscreen():e.resizeTo(y.app.width,y.app.height)}if(setInterval(()=>{this.capturing||y.saveOptions()},1e4),y.general.smoothAnimations&&document.body.classList.add("animated"),document.body.parentElement.style.fontSize=`${y.general.uiScale*100}%`,this.registerFonts(),this.view=document.getElementById("pixi"),document.oncontextmenu=e=>{e.preventDefault(),this.chartManager.loadedChart&&e.target==this.view&&Rs.open(this,e)},this.view.onmousedown=()=>{Rs.close()},this.stage=new ye,this.stage.sortableChildren=!0,this.renderer=new id({backgroundColor:1579292,antialias:y.performance.antialiasing,width:this.view.clientWidth,height:this.view.clientHeight,resolution:y.performance.resolution,autoDensity:!0,view:this.view,powerPreference:"low-power"}),At.shared.maxFPS=0,At.shared.add(()=>{const e=performance.now();this.chartManager.widgetManager.update(),this.chartManager.loadedSM&&this.chartManager.loadedChart&&this.chartManager.chartView&&this.chartManager.chartView.update(),qi.instance?.addDrawUpdateTimeValue(performance.now()-e);const t=performance.now();this.renderer.render(this.stage),qi.instance?.addFrameTimeValue(performance.now()-t),performance.memory?.usedJSHeapSize&&qi.instance?.addMemoryTimeValue(performance.memory.usedJSHeapSize),hm()},Ac.HIGH),At.shared.start(),mt.init(this.renderer),this.chartManager=new Eg(this),this.menubarManager=new Ag(this,document.getElementById("menubar")),this.windowManager=new kg(this,document.getElementById("windows")),this.actionHistory=new Lt(this),this.registerListeners(),!he.hidePoweredByText&&nd()){const e=document.getElementById("embed");e.appendChild(document.createTextNode("Powered by "));const t=document.createElement("a");if(t.href="https://tillvit.github.io/smeditor/",t.innerText="SMEditor",t.target="_blank",e.appendChild(t),he.url!=null){e.appendChild(document.createTextNode(" | Open this chart in a "));const n=document.createElement("a"),a=new URL(location.origin+"/smeditor/app/");n.innerText="new tab",n.target="_blank",a.searchParams.append("url",he.url),he.chartType!==null&&a.searchParams.append("chartType",he.chartType),he.chartIndex!==null&&a.searchParams.append("chartIndex",he.chartIndex+""),n.href=a.toString(),e.appendChild(n)}}_e.initFileSystem().then(()=>{if(he.url){this.chartManager.loadSM(he.url).then(()=>{const e=this.chartManager.loadedSM;if(!e)return;let t;if(he.chartType!=null&&(t=e.charts[he.chartType],t===void 0)){de.createFormatted(`Couldn't find chart with type ${he.chartType}`,"warn");return}if(t===void 0){const a=Object.keys(e.charts);if(a.length==0||(t=e.charts[a[0]],t.length==0))return}let n;if(he.chartIndex!=null&&(n=t.at(he.chartIndex),n===void 0)){de.createFormatted(`Couldn't find chart with index ${he.chartIndex}`,"warn");return}n===void 0&&(n=t.at(-1),!n)||this.chartManager.loadChart(n)});return}if(this.windowManager.openWindow(new po(this)),window.nw){const e=nw.Window.get();nw.App.on("open",t=>{if(!t||t?.length===0){nw.Window.open(window.location.href);return}let n="";for(let a of t)if(a.startsWith("file://")&&(a=a.substring(7)),kt(a)==".ssc"){n=a;break}else n==""&&kt(a)==".sm"&&(n=a);n!=""&&(this.chartManager.loadSM(n),this.windowManager.getWindowById("select_sm_initial")?.closeWindow())}),window.addEventListener("keydown",t=>{t.key=="r"&&(t.metaKey||t.ctrlKey)&&(t.preventDefault(),e.reload()),t.code=="KeyW"&&(t.metaKey||t.ctrlKey)&&(t.preventDefault(),e.close()),process.versions["nw-flavor"]=="sdk"&&t.code=="KeyI"&&t.metaKey&&t.altKey&&(t.preventDefault(),e.showDevTools())}),e.on("enter-fullscreen",()=>{y.app.fullscreen=e.isFullscreen}),e.on("resize",(t,n)=>{e.isFullscreen||(y.app.width=t,y.app.height=n)}),e.on("restore",()=>{y.app.fullscreen=e.isFullscreen}),this.checkAppVersion()}this.checkCoreVersion()}),window.onbeforeunload=e=>{if(Lt.instance.isDirty()&&y.general.warnBeforeExit)return e.preventDefault(),e.returnValue="Are you sure you want to exit?"},window.onpagehide=()=>{this.capturing||y.saveOptions()},Be.loadTheme(y.general.theme)}registerFonts(){Ao.from("Main",{fontFamily:"Assistant",fontSize:20,fill:"white"},{chars:[["a","z"],["A","Z"],"!@#$%^&*()~{}[]:.-?=,_","0123456789/"," "],resolution:window.devicePixelRatio}),Ao.from("Fancy",{fontFamily:"Assistant",fontSize:40,fontWeight:"700",fill:["#dddddd","#ffffff"],fillGradientType:ad.LINEAR_VERTICAL,stroke:11184810,strokeThickness:3},{chars:[["a","z"],["A","Z"],"!@#$%^&*()~{}[]:.-?=,_","0123456789/"," "],resolution:window.devicePixelRatio})}registerListeners(){this.view.addEventListener("mousedown",()=>{this.windowManager.unfocusAll()}),le.on("themeChanged",()=>{this.renderer.background.color=new L(Be.getCurrentTheme()["editor-bg"]).toNumber()}),le.on("userOptionUpdated",e=>{e=="general.uiScale"&&this.updateSize()}),window.addEventListener("keydown",function(e){e.code=="Enter"&&e.target instanceof HTMLButtonElement&&e.preventDefault()}),window.addEventListener("dragstart",function(e){e.target instanceof HTMLImageElement&&e.preventDefault()}),setInterval(()=>{if(this.capturing)return;const e=window.innerWidth,t=this.getCanvasHeight();(this.lastHeight!=t||this.lastWidth!=e)&&(this.lastHeight=t,this.lastWidth=e,this.onResize(e,t),le.emit("resize"))},100),window.addEventListener("dragover",e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy"}),window.addEventListener("drop",e=>{if(window.nw){e.stopPropagation(),e.preventDefault();let t="";for(const n of e.dataTransfer.files)if(n.path)if(kt(n.path)==".ssc"){t=n.path;break}else t==""&&kt(n.path)==".sm"&&(t=n.path);t!=""&&(this.chartManager.loadSM(t),this.windowManager.getWindowById("select_sm_initial")?.closeWindow())}else _e.handleDropEvent(e).then(t=>{const n=new Ya(this,{title:"Select an sm/ssc file...",accepted_file_types:[".sm",".ssc"],disableClose:!0,callback:a=>{this.chartManager.loadSM(a),this.windowManager.getWindowById("select_sm_initial")?.closeWindow()},onload:()=>{n.getAcceptableFile(t??"").then(a=>n.selectPath(a))}});this.windowManager.openWindow(n)})})}onResize(e,t){this.renderer.screen.width=e,this.renderer.screen.height=t,this.view.width=e*this.renderer.resolution,this.view.height=t*this.renderer.resolution,this.view.style.width=`${e}px`,this.view.style.height=`${t}px`,this.STAGE_HEIGHT=ms/y.general.uiScale;const n=t/this.STAGE_HEIGHT;this.stage.scale.set(n),this.stage.position.set(e/2,t/2),this.STAGE_WIDTH=e/n}updateSize(){const e=window.innerWidth,t=this.getCanvasHeight();this.lastHeight=t,this.lastWidth=e,this.onResize(e,t),le.emit("resize")}getCanvasHeight(){return window.innerHeight-(document.getElementById("menubar")?.clientHeight??0)-(document.getElementById("playback-options")?.clientHeight??0)}checkAppVersion(){if(!window.nw)return;const e=nw.require("nw.gui"),t={stable:3,beta:2,alpha:1,nightly:0};let n="win";process.platform=="darwin"?n=nw.require("os").arch()=="arm64"?"mac-arm":"mac-x64":process.platform=="linux"&&(n="linux"),fetch("/smeditor/assets/app/versions.json").then(a=>a.json()).then(a=>{a=a.sort((s,o)=>t[s.type]!=t[o.type]?t[o.type]-t[s.type]:o.date-s.date);const r=a[0];bl.lt(e.App.manifest.version,r.version)&&localStorage.getItem("downloadedVersion")!==r.version&&Iu.open(r.version,r.downloads[n])})}checkCoreVersion(){const e=Rd({});navigator.serviceWorker.addEventListener("controllerchange",()=>{Ru.open(e),console.log("Found new version")});const t=localStorage.getItem("coreVersion");t!==null&&bl.lt(t,this.VERSION)&&this.windowManager.openWindow(new _u(this)),localStorage.setItem("coreVersion",this.VERSION)}}document.querySelector("body").innerHTML=`<div id="popups"></div>
          <div id="view-wrapper">
            <div id="menubar"></div>
            <div id="waterfall"><div id="waterfall-container"></div></div>
            <canvas id="pixi"></canvas>
          </div>
          <div id="context-menu"></div>
          <div id="blocker" style="display: none"></div>
          <div id="windows"></div>
          <div id="embed"></div>
        `;Nd.load({custom:{families:["Assistant"]},active:vc,inactive:vc,classes:!1});function vc(){const i=document.createElement("canvas");i.getContext("webgl")||i.getContext("experimental-webgl")?(window.app=new Sg,window.GameTypeRegistry=ft,window.NoteskinRegistry=et):document.querySelector("body").innerHTML=`<div class='browser-unsupported'>
      <div class='browser-unsupported-item'>
      <h1>WebGL is not enabled</h1>
      <div>Please visit your browser settings and enable WebGL.</div>
      </div>
    </div>`}export{Lg as A,ii as B,ji as F,Vu as H,We as _,Gn as a,fi as b,An as e,Hd as i,Js as r};
